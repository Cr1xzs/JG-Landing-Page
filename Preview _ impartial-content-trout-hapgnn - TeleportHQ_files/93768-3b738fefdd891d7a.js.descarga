(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[93768,41730],{830938:function(e,t,o){var n={"./banner/1":[589439,89439],"./banner/1.ts":[589439,89439],"./banner/2":[657828,57828],"./banner/2.ts":[657828,57828],"./banner/3":[846679,46679],"./banner/3.ts":[846679,46679],"./blog-post-header/1":[777650,77650],"./blog-post-header/1.ts":[777650,77650],"./blog-post-header/10":[883212,83212],"./blog-post-header/10.ts":[883212,83212],"./blog-post-header/11":[613473,13473],"./blog-post-header/11.ts":[613473,13473],"./blog-post-header/12":[890438,90438],"./blog-post-header/12.ts":[890438,90438],"./blog-post-header/2":[95672,95672],"./blog-post-header/2.ts":[95672,95672],"./blog-post-header/3":[150994,50994],"./blog-post-header/3.ts":[150994,50994],"./blog-post-header/4":[857577,57577],"./blog-post-header/4.ts":[857577,57577],"./blog-post-header/5":[604425,4425],"./blog-post-header/5.ts":[604425,4425],"./blog-post-header/6":[417846,17846],"./blog-post-header/6.ts":[417846,17846],"./blog-post-header/7":[719310,19310],"./blog-post-header/7.ts":[719310,19310],"./blog-post-header/8":[208608,8608],"./blog-post-header/8.ts":[208608,8608],"./blog-post-header/9":[856016,56016],"./blog-post-header/9.ts":[856016,56016],"./contact-form/1":[187208,87208],"./contact-form/1.ts":[187208,87208],"./contact-form/10":[294345,94345],"./contact-form/10.ts":[294345,94345],"./contact-form/11":[460154,60154],"./contact-form/11.ts":[460154,60154],"./contact-form/2":[468208,68208],"./contact-form/2.ts":[468208,68208],"./contact-form/3":[105361,5361],"./contact-form/3.ts":[105361,5361],"./contact-form/4":[696671,96671],"./contact-form/4.ts":[696671,96671],"./contact-form/5":[868898,68898],"./contact-form/5.ts":[868898,68898],"./contact-form/6":[696923,96923],"./contact-form/6.ts":[696923,96923],"./contact-form/7":[123270,23270],"./contact-form/7.ts":[123270,23270],"./contact-form/8":[242620,42620],"./contact-form/8.ts":[242620,42620],"./contact-form/9":[542470,42470],"./contact-form/9.ts":[542470,42470],"./contact/1":[39033,39033],"./contact/1.ts":[39033,39033],"./contact/10":[95475,95475],"./contact/10.ts":[95475,95475],"./contact/11":[798305,98305],"./contact/11.ts":[798305,98305],"./contact/12":[70914,70914],"./contact/12.ts":[70914,70914],"./contact/13":[857202,57202],"./contact/13.ts":[857202,57202],"./contact/14":[460993,60993],"./contact/14.ts":[460993,60993],"./contact/15":[939188,39188],"./contact/15.ts":[939188,39188],"./contact/16":[872896,72896],"./contact/16.ts":[872896,72896],"./contact/2":[663511,63511],"./contact/2.ts":[663511,63511],"./contact/3":[563613,63613],"./contact/3.ts":[563613,63613],"./contact/4":[810663,10663],"./contact/4.ts":[810663,10663],"./contact/5":[513098,13098],"./contact/5.ts":[513098,13098],"./contact/6":[629389,29389],"./contact/6.ts":[629389,29389],"./contact/7":[612982,12982],"./contact/7.ts":[612982,12982],"./contact/8":[745812,45812],"./contact/8.ts":[745812,45812],"./contact/9":[942145,42145],"./contact/9.ts":[942145,42145],"./content-list/1":[770618,70618],"./content-list/1.ts":[770618,70618],"./content-list/2":[332081,32081],"./content-list/2.ts":[332081,32081],"./content-list/3":[603070,3070],"./content-list/3.ts":[603070,3070],"./content-list/4":[79921,79921],"./content-list/4.ts":[79921,79921],"./content-list/5":[145801,45801],"./content-list/5.ts":[145801,45801],"./content-list/6":[690809,90809],"./content-list/6.ts":[690809,90809],"./cta/1":[424123,24123],"./cta/1.ts":[424123,24123],"./cta/10":[738665,38665],"./cta/10.ts":[738665,38665],"./cta/11":[895985,95985],"./cta/11.ts":[895985,95985],"./cta/12":[380515,80515],"./cta/12.ts":[380515,80515],"./cta/13":[843910,43910],"./cta/13.ts":[843910,43910],"./cta/14":[246625,46625],"./cta/14.ts":[246625,46625],"./cta/15":[253213,53213],"./cta/15.ts":[253213,53213],"./cta/16":[193164,93164],"./cta/16.ts":[193164,93164],"./cta/17":[438554,38554],"./cta/17.ts":[438554,38554],"./cta/18":[430958,30958],"./cta/18.ts":[430958,30958],"./cta/19":[41022,41022],"./cta/19.ts":[41022,41022],"./cta/2":[770683,70683],"./cta/2.ts":[770683,70683],"./cta/20":[677455,77455],"./cta/20.ts":[677455,77455],"./cta/21":[893541,93541],"./cta/21.ts":[893541,93541],"./cta/22":[459163,59163],"./cta/22.ts":[459163,59163],"./cta/23":[574713,74713],"./cta/23.ts":[574713,74713],"./cta/24":[510169,10169],"./cta/24.ts":[510169,10169],"./cta/25":[603190,3190],"./cta/25.ts":[603190,3190],"./cta/26":[500575,575],"./cta/26.ts":[500575,575],"./cta/3":[384570,84570],"./cta/3.ts":[384570,84570],"./cta/4":[172064,72064],"./cta/4.ts":[172064,72064],"./cta/5":[446866,46866],"./cta/5.ts":[446866,46866],"./cta/6":[105737,5737],"./cta/6.ts":[105737,5737],"./cta/7":[30807,30807],"./cta/7.ts":[30807,30807],"./cta/8":[211613,11613],"./cta/8.ts":[211613,11613],"./cta/9":[143417,43417],"./cta/9.ts":[143417,43417],"./faq/1":[330625,30625],"./faq/1.ts":[330625,30625],"./faq/10":[679434,79434],"./faq/10.ts":[679434,79434],"./faq/11":[245402,45402],"./faq/11.ts":[245402,45402],"./faq/12":[80032,80032],"./faq/12.ts":[80032,80032],"./faq/13":[980206,80206],"./faq/13.ts":[980206,80206],"./faq/14":[856132,56132],"./faq/14.ts":[856132,56132],"./faq/15":[449817,49817],"./faq/15.ts":[449817,49817],"./faq/2":[106152,6152],"./faq/2.ts":[106152,6152],"./faq/3":[739146,39146],"./faq/3.ts":[739146,39146],"./faq/4":[48465,48465],"./faq/4.ts":[48465,48465],"./faq/5":[446926,46926],"./faq/5.ts":[446926,46926],"./faq/6":[581438,81438],"./faq/6.ts":[581438,81438],"./faq/7":[276788,86748],"./faq/7.ts":[276788,86748],"./faq/8":[723394,23394],"./faq/8.ts":[723394,23394],"./faq/9":[741159,41159],"./faq/9.ts":[741159,41159],"./feature-card/1":[157132,57132],"./feature-card/1.ts":[157132,57132],"./feature-card/2":[609099,9099],"./feature-card/2.ts":[609099,9099],"./features/1":[777858,77858],"./features/1.ts":[777858,77858],"./features/10":[218362,18362],"./features/10.ts":[218362,18362],"./features/11":[340316,40316],"./features/11.ts":[340316,40316],"./features/12":[698180,98180],"./features/12.ts":[698180,98180],"./features/13":[450282,50282],"./features/13.ts":[450282,50282],"./features/14":[484266,84266],"./features/14.ts":[484266,84266],"./features/15":[173906,73906],"./features/15.ts":[173906,73906],"./features/16":[789207,14371],"./features/16.ts":[789207,14371],"./features/17":[252093,52093],"./features/17.ts":[252093,52093],"./features/18":[730730,30730],"./features/18.ts":[730730,30730],"./features/19":[173124,73124],"./features/19.ts":[173124,73124],"./features/2":[936899,36899],"./features/2.ts":[936899,36899],"./features/20":[990172,90172],"./features/20.ts":[990172,90172],"./features/21":[88208,88208],"./features/21.ts":[88208,88208],"./features/22":[231135,31135],"./features/22.ts":[231135,31135],"./features/23":[948043,48043],"./features/23.ts":[948043,48043],"./features/24":[904939,4939],"./features/24.ts":[904939,4939],"./features/25":[6274,6274],"./features/25.ts":[6274,6274],"./features/26":[316550,16550],"./features/26.ts":[316550,16550],"./features/3":[917570,17570],"./features/3.ts":[917570,17570],"./features/4":[583990,83990],"./features/4.ts":[583990,83990],"./features/5":[980730,80730],"./features/5.ts":[980730,80730],"./features/6":[187825,87825],"./features/6.ts":[187825,87825],"./features/7":[707278,7278],"./features/7.ts":[707278,7278],"./features/8":[616615,16615],"./features/8.ts":[616615,16615],"./features/9":[219382,19382],"./features/9.ts":[219382,19382],"./footer/1":[556035,56035],"./footer/1.ts":[556035,56035],"./footer/10":[374491,74491],"./footer/10.ts":[374491,74491],"./footer/11":[83553,83553],"./footer/11.ts":[83553,83553],"./footer/12":[785035,85035],"./footer/12.ts":[785035,85035],"./footer/13":[597562,97562],"./footer/13.ts":[597562,97562],"./footer/14":[610160,10160],"./footer/14.ts":[610160,10160],"./footer/15":[500034,34],"./footer/15.ts":[500034,34],"./footer/2":[885693,85693],"./footer/2.ts":[885693,85693],"./footer/3":[462312,62312],"./footer/3.ts":[462312,62312],"./footer/4":[634204,34204],"./footer/4.ts":[634204,34204],"./footer/5":[457877,57877],"./footer/5.ts":[457877,57877],"./footer/6":[980765,80765],"./footer/6.ts":[980765,80765],"./footer/7":[670921,70921],"./footer/7.ts":[670921,70921],"./footer/8":[462511,62511],"./footer/8.ts":[462511,62511],"./footer/9":[329381,29381],"./footer/9.ts":[329381,29381],"./gallery/1":[294441,94441],"./gallery/1.ts":[294441,94441],"./gallery/10":[886668,86668],"./gallery/10.ts":[886668,86668],"./gallery/11":[834328,34328],"./gallery/11.ts":[834328,34328],"./gallery/12":[252199,52199],"./gallery/12.ts":[252199,52199],"./gallery/13":[293882,93882],"./gallery/13.ts":[293882,93882],"./gallery/14":[803799,3799],"./gallery/14.ts":[803799,3799],"./gallery/15":[77634,77634],"./gallery/15.ts":[77634,77634],"./gallery/2":[894211,94211],"./gallery/2.ts":[894211,94211],"./gallery/3":[890077,90077],"./gallery/3.ts":[890077,90077],"./gallery/4":[752275,52275],"./gallery/4.ts":[752275,52275],"./gallery/5":[490597,90597],"./gallery/5.ts":[490597,90597],"./gallery/6":[636144,36144],"./gallery/6.ts":[636144,36144],"./gallery/7":[649972,49972],"./gallery/7.ts":[649972,49972],"./gallery/8":[796074,96074],"./gallery/8.ts":[796074,96074],"./gallery/9":[725995,25995],"./gallery/9.ts":[725995,25995],"./hero/1":[910668,10668],"./hero/1.ts":[910668,10668],"./hero/10":[15717,15717],"./hero/10.ts":[15717,15717],"./hero/11":[415747,15747],"./hero/11.ts":[415747,15747],"./hero/12":[305580,5580],"./hero/12.ts":[305580,5580],"./hero/13":[84430,84430],"./hero/13.ts":[84430,84430],"./hero/14":[745925,45925],"./hero/14.ts":[745925,45925],"./hero/15":[247994,47994],"./hero/15.ts":[247994,47994],"./hero/16":[664621,64621],"./hero/16.ts":[664621,64621],"./hero/17":[912476,12476],"./hero/17.ts":[912476,12476],"./hero/18":[642919,42919],"./hero/18.ts":[642919,42919],"./hero/2":[324255,24255],"./hero/2.ts":[324255,24255],"./hero/3":[690707,90707],"./hero/3.ts":[690707,90707],"./hero/4":[247044,47044],"./hero/4.ts":[247044,47044],"./hero/5":[340209,40209],"./hero/5.ts":[340209,40209],"./hero/6":[568398,68398],"./hero/6.ts":[568398,68398],"./hero/7":[794214,94214],"./hero/7.ts":[794214,94214],"./hero/8":[457419,57419],"./hero/8.ts":[457419,57419],"./hero/9":[814209,14209],"./hero/9.ts":[814209,14209],"./logos/1":[297900,97900],"./logos/1.ts":[297900,97900],"./logos/2":[913455,13455],"./logos/2.ts":[913455,13455],"./logos/3":[613719,13719],"./logos/3.ts":[613719,13719],"./logos/4":[434617,34617],"./logos/4.ts":[434617,34617],"./logos/5":[754776,54776],"./logos/5.ts":[754776,54776],"./logos/6":[316466,16466],"./logos/6.ts":[316466,16466],"./logos/7":[838218,38218],"./logos/7.ts":[838218,38218],"./logos/8":[594747,94747],"./logos/8.ts":[594747,94747],"./logos/9":[980542,80542],"./logos/9.ts":[980542,80542],"./navbar/1":[834934,34934],"./navbar/1.ts":[834934,34934],"./navbar/2":[962300,62300],"./navbar/2.ts":[962300,62300],"./navbar/3":[263801,63801],"./navbar/3.ts":[263801,63801],"./navbar/4":[320098,20098],"./navbar/4.ts":[320098,20098],"./navbar/5":[619709,19709],"./navbar/5.ts":[619709,19709],"./navbar/6":[741570,41570],"./navbar/6.ts":[741570,41570],"./navbar/7":[935967,35967],"./navbar/7.ts":[935967,35967],"./navbar/8":[246470,46470],"./navbar/8.ts":[246470,46470],"./not-found/1":[452807,52807],"./not-found/1.ts":[452807,52807],"./not-found/2":[797571,97571],"./not-found/2.ts":[797571,97571],"./not-found/3":[560348,60348],"./not-found/3.ts":[560348,60348],"./not-found/4":[747952,47952],"./not-found/4.ts":[747952,47952],"./pricing/1":[114264,14264],"./pricing/1.ts":[114264,14264],"./pricing/10":[570183,70183],"./pricing/10.ts":[570183,70183],"./pricing/11":[570965,70965],"./pricing/11.ts":[570965,70965],"./pricing/12":[712755,38771],"./pricing/12.ts":[712755,38771],"./pricing/13":[242780,42780],"./pricing/13.ts":[242780,42780],"./pricing/14":[30074,30074],"./pricing/14.ts":[30074,30074],"./pricing/15":[416726,16726],"./pricing/15.ts":[416726,16726],"./pricing/2":[55559,55559],"./pricing/2.ts":[55559,55559],"./pricing/3":[604570,4570],"./pricing/3.ts":[604570,4570],"./pricing/4":[769478,69478],"./pricing/4.ts":[769478,69478],"./pricing/5":[40669,40669],"./pricing/5.ts":[40669,40669],"./pricing/6":[981114,81114],"./pricing/6.ts":[981114,81114],"./pricing/7":[486848,86848],"./pricing/7.ts":[486848,86848],"./pricing/8":[54371,54371],"./pricing/8.ts":[54371,54371],"./pricing/9":[734967,34967],"./pricing/9.ts":[734967,34967],"./sign-in/1":[933150,33150],"./sign-in/1.ts":[933150,33150],"./sign-in/10":[237018,37018],"./sign-in/10.ts":[237018,37018],"./sign-in/2":[574877,74877],"./sign-in/2.ts":[574877,74877],"./sign-in/3":[788282,88282],"./sign-in/3.ts":[788282,88282],"./sign-in/4":[94835,94835],"./sign-in/4.ts":[94835,94835],"./sign-in/5":[489146,89146],"./sign-in/5.ts":[489146,89146],"./sign-in/6":[268469,68469],"./sign-in/6.ts":[268469,68469],"./sign-in/7":[683751,83751],"./sign-in/7.ts":[683751,83751],"./sign-in/8":[370842,70842],"./sign-in/8.ts":[370842,70842],"./sign-in/9":[912369,12369],"./sign-in/9.ts":[912369,12369],"./sign-up/1":[910441,10441],"./sign-up/1.ts":[910441,10441],"./sign-up/10":[545078,45078],"./sign-up/10.ts":[545078,45078],"./sign-up/2":[391310,91310],"./sign-up/2.ts":[391310,91310],"./sign-up/3":[336565,36565],"./sign-up/3.ts":[336565,36565],"./sign-up/4":[576651,76651],"./sign-up/4.ts":[576651,76651],"./sign-up/5":[7587,7587],"./sign-up/5.ts":[7587,7587],"./sign-up/6":[222598,22598],"./sign-up/6.ts":[222598,22598],"./sign-up/7":[893762,93762],"./sign-up/7.ts":[893762,93762],"./sign-up/8":[701890,1890],"./sign-up/8.ts":[701890,1890],"./sign-up/9":[652512,52512],"./sign-up/9.ts":[652512,52512],"./stats/1":[32970,32970],"./stats/1.ts":[32970,32970],"./stats/10":[177169,77169],"./stats/10.ts":[177169,77169],"./stats/11":[216544,16544],"./stats/11.ts":[216544,16544],"./stats/12":[87978,87978],"./stats/12.ts":[87978,87978],"./stats/13":[54541,54541],"./stats/13.ts":[54541,54541],"./stats/14":[745935,45935],"./stats/14.ts":[745935,45935],"./stats/15":[881899,81899],"./stats/15.ts":[881899,81899],"./stats/16":[991873,91873],"./stats/16.ts":[991873,91873],"./stats/17":[208095,8095],"./stats/17.ts":[208095,8095],"./stats/18":[614823,14823],"./stats/18.ts":[614823,14823],"./stats/19":[112030,12030],"./stats/19.ts":[112030,12030],"./stats/2":[388651,88651],"./stats/2.ts":[388651,88651],"./stats/20":[812822,12822],"./stats/20.ts":[812822,12822],"./stats/21":[359991,59991],"./stats/21.ts":[359991,59991],"./stats/3":[214050,14050],"./stats/3.ts":[214050,14050],"./stats/4":[374765,74765],"./stats/4.ts":[374765,74765],"./stats/5":[837299,37299],"./stats/5.ts":[837299,37299],"./stats/6":[669949,69949],"./stats/6.ts":[669949,69949],"./stats/7":[21543,21543],"./stats/7.ts":[21543,21543],"./stats/8":[646062,46062],"./stats/8.ts":[646062,46062],"./stats/9":[615322,15322],"./stats/9.ts":[615322,15322],"./steps/1":[484874,84874],"./steps/1.ts":[484874,84874],"./steps/2":[185768,85768],"./steps/2.ts":[185768,85768],"./team/1":[151929,51929],"./team/1.ts":[151929,51929],"./team/10":[734332,34332],"./team/10.ts":[734332,34332],"./team/11":[420507,20507],"./team/11.ts":[420507,20507],"./team/12":[105823,5823],"./team/12.ts":[105823,5823],"./team/13":[684245,84245],"./team/13.ts":[684245,84245],"./team/14":[302264,2264],"./team/14.ts":[302264,2264],"./team/2":[593310,93310],"./team/2.ts":[593310,93310],"./team/3":[516325,16325],"./team/3.ts":[516325,16325],"./team/4":[823949,23949],"./team/4.ts":[823949,23949],"./team/5":[640108,40108],"./team/5.ts":[640108,40108],"./team/6":[423574,23574],"./team/6.ts":[423574,23574],"./team/7":[744759,44759],"./team/7.ts":[744759,44759],"./team/8":[997083,97083],"./team/8.ts":[997083,97083],"./team/9":[830365,30365],"./team/9.ts":[830365,30365],"./testimonial/1":[94912,94912],"./testimonial/1.ts":[94912,94912],"./testimonial/10":[303399,3399],"./testimonial/10.ts":[303399,3399],"./testimonial/11":[901808,1808],"./testimonial/11.ts":[901808,1808],"./testimonial/12":[523473,23473],"./testimonial/12.ts":[523473,23473],"./testimonial/13":[556223,56223],"./testimonial/13.ts":[556223,56223],"./testimonial/14":[861220,61220],"./testimonial/14.ts":[861220,61220],"./testimonial/15":[497079,97079],"./testimonial/15.ts":[497079,97079],"./testimonial/16":[138197,38197],"./testimonial/16.ts":[138197,38197],"./testimonial/17":[492568,92568],"./testimonial/17.ts":[492568,92568],"./testimonial/18":[969795,69795],"./testimonial/18.ts":[969795,69795],"./testimonial/2":[890918,90918],"./testimonial/2.ts":[890918,90918],"./testimonial/3":[342791,42791],"./testimonial/3.ts":[342791,42791],"./testimonial/4":[881727,81727],"./testimonial/4.ts":[881727,81727],"./testimonial/5":[63494,63494],"./testimonial/5.ts":[63494,63494],"./testimonial/6":[114792,14792],"./testimonial/6.ts":[114792,14792],"./testimonial/7":[532162,32162],"./testimonial/7.ts":[532162,32162],"./testimonial/8":[631113,31113],"./testimonial/8.ts":[631113,31113],"./testimonial/9":[570836,70836],"./testimonial/9.ts":[570836,70836],"./timeline/1":[599663,99663],"./timeline/1.ts":[599663,99663],"./timeline/10":[623187,23187],"./timeline/10.ts":[623187,23187],"./timeline/11":[815183,15183],"./timeline/11.ts":[815183,15183],"./timeline/2":[223203,23203],"./timeline/2.ts":[223203,23203],"./timeline/3":[754220,54220],"./timeline/3.ts":[754220,54220],"./timeline/4":[487123,87123],"./timeline/4.ts":[487123,87123],"./timeline/5":[411986,11986],"./timeline/5.ts":[411986,11986],"./timeline/6":[737203,37203],"./timeline/6.ts":[737203,37203],"./timeline/7":[614733,14733],"./timeline/7.ts":[614733,14733],"./timeline/8":[359653,59653],"./timeline/8.ts":[359653,59653],"./timeline/9":[502916,2916],"./timeline/9.ts":[502916,2916],"./toast/1":[957330,57330],"./toast/1.ts":[957330,57330],"./toast/2":[217725,17725],"./toast/2.ts":[217725,17725],"./toast/3":[950927,50927],"./toast/3.ts":[950927,50927],"./toast/4":[897479,97479],"./toast/4.ts":[897479,97479],"./toast/5":[847700,47700],"./toast/5.ts":[847700,47700],"./toast/6":[527519,27519],"./toast/6.ts":[527519,27519]};function i(e){if(!o.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return o.e(t[1]).then((function(){return o(i)}))}i.keys=function(){return Object.keys(n)},i.id=830938,e.exports=i},701652:function(e,t,o){var n={"./onboarding":[724256,24256],"./onboarding/":[724256,24256],"./onboarding/card-content":[692173,92173],"./onboarding/card-content.tsx":[692173,92173],"./onboarding/index":[724256,24256],"./onboarding/index.tsx":[724256,24256],"./onboarding/styles":[113997,13997],"./onboarding/styles.ts":[113997,13997],"./theme":[873876,73876],"./theme/":[873876,73876],"./theme/card-content":[827759,27759],"./theme/card-content.tsx":[827759,27759],"./theme/index":[873876,73876],"./theme/index.tsx":[873876,73876],"./theme/styles":[209855,9855],"./theme/styles.ts":[209855,9855],"./video":[556570,56570],"./video/":[556570,56570],"./video/card-content":[32229,68066],"./video/card-content.tsx":[32229,68066],"./video/index":[556570,56570],"./video/index.tsx":[556570,56570],"./video/styles":[644060,44060],"./video/styles.ts":[644060,44060]};function i(e){if(!o.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return o.e(t[1]).then((function(){return o(i)}))}i.keys=function(){return Object.keys(n)},i.id=701652,e.exports=i},230264:function(e){let t=0;const o={existsSync:function(){return!1},statSync:e=>"sourcePath"===e?{mtimeMs:self.BUILD_ID}:{mtimeMs:++t},readFileSync:e=>self[e]||"",readFile:e=>self[e]||"",writeFile:(e,t)=>{}};e.exports=o},309425:function(e,t,o){var n={"./accordion.json":[140593,40593],"./banner1.json":[645356,45356],"./banner2.json":[761944,61944],"./banner3.json":[634988,34988],"./banner4.json":[354766,54766],"./banner5.json":[713319,13319],"./blog1.json":[348371,48371],"./blog2.json":[483578,83578],"./blog3.json":[4806,4806],"./blog4.json":[109711,9711],"./blogpostcard1.json":[88049,88049],"./blogpostcard2.json":[555181,55181],"./blogpostcard3.json":[81329,81329],"./blogpostcard4.json":[53089,53089],"./dropdown.json":[7100,7100],"./featurecard1.json":[987114,87114],"./featurecard2.json":[708781,8781],"./featurecard3.json":[690784,90784],"./featurecard4.json":[950490,50490],"./features1.json":[979094,79094],"./features2.json":[521271,21271],"./features3.json":[95924,95924],"./features4.json":[121993,21993],"./footer1.json":[773014,73014],"./footer2.json":[427281,27281],"./footer3.json":[622945,22945],"./footer4.json":[431298,31298],"./gallery1.json":[626062,26062],"./gallery2.json":[698899,98899],"./gallery3.json":[512874,12874],"./gallery4.json":[16883,16883],"./gallerycard1.json":[50456,50456],"./gallerycard2.json":[152641,52641],"./gallerycard3.json":[702256,2256],"./header1.json":[57722,57722],"./header2.json":[731848,31848],"./header3.json":[990547,90547],"./header4.json":[803693,3693],"./header5.json":[685724,85724],"./header6.json":[503479,3479],"./hero1.json":[764907,64907],"./hero2.json":[772127,72127],"./hero3.json":[225263,25263],"./hero4.json":[369036,69036],"./hero5.json":[490489,90489],"./hero6.json":[953882,53882],"./lang-switcher.json":[436224,36224],"./navbar.json":[108701,8701],"./navigationlinks.json":[395591,95591],"./pricing1.json":[429476,29476],"./pricing2.json":[944411,44411],"./pricing3.json":[149954,49954],"./sidebar1.json":[224934,24934],"./sidebar2.json":[490335,90335],"./sidebar3.json":[182083,82083],"./slider.json":[203368,3368],"./socialbar.json":[107614,7614],"./stats1.json":[737266,37266],"./stats2.json":[650250,50250],"./steps1.json":[865969,65969],"./steps2.json":[987347,87347],"./testimonial1.json":[968187,68187],"./testimonial2.json":[487651,87651],"./testimonial3.json":[198240,98240],"./testimonial4.json":[72306,72306],"./testimonialcard1.json":[273110,73110],"./testimonialcard2.json":[163509,63509],"./testimonialcard3.json":[28492,28492],"./testimonialcard4.json":[988856,88856]};function i(e){if(!o.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return o.e(t[1]).then((function(){return o.t(i,19)}))}i.keys=function(){return Object.keys(n)},i.id=309425,e.exports=i},973274:function(e,t,o){var n={"./thq-dropdown/thq-dropdown-arrow.json":[529882,29882],"./thq-dropdown/thq-dropdown-list.json":[863697,63697]};function i(e){if(!o.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return o.e(t[1]).then((function(){return o.t(i,19)}))}i.keys=function(){return Object.keys(n)},i.id=973274,e.exports=i},646559:function(e,t,o){"use strict";var n=o(503348),i=o(777460),r=o(918437),s=o(395942),a=o(302503),c=(o(202784),o(505892));const l=[{headline:"Localization - add any language to your projects",date:"13 December 2024",version:"5.0.0",text:["Our biggest update this time is Localization. You can now enable any language on your projects, add a language switcher that cycles through those languages, and manage your texts in a very organized way.","Together with AI translate, this feature lets you localize your website in seconds with amazing benefits to traffic, user experience, and SEO.","!!! Code export for projects with localization enabled is only available for Next.js at the moment."],image:"1.gif"},{headline:"Component Dynamic Properties",date:"13 December 2024",version:"5.0.0",text:["We have brought a massive update on the ability to create dynamic properties inside components. By opening the Setup Panel inside components you will now be able to create props from there directly.","Added support for Boolean, Number, Array, Object and Function props. This update will unlock a multitude of building capabilities in respect to using components."],image:"2.gif"},{headline:"Accordion element",date:"13 December 2024",version:"5.0.0",text:["We've added a new Accordion element under Interactive elements. This one uses just plain HTML to function, so there's no side JS loaded for it!"],image:"3.gif"},{headline:"New Google Maps element",date:"13 December 2024",version:"5.0.0",text:["This new element is a simple iframe wrapper pointing to Google Maps. It should simplify the process of adding maps to your project, and it also comes with support for component props.","Changes to the location may require a refresh (page change) as that wasn't caught in this patch, but it will be fixed."],image:"4.gif"},{headline:"Page-level Ask AI",date:"13 December 2024",version:"5.0.0",text:["We\u2019ve added a page-level Ask AI functionality in the form of a new button in the top-left of the canvas. This new functionality will attempt to change all the images, texts, or videos on the page or component you are currently editing.","You can rewrite, translate, or change the tone of texts, and search for new images/videos with a certain theme immediately. Do note that for large pages it might take a while."],image:"5.gif"},{headline:"Render Conditionally by PROPS and general improvements for Conditional Rendering",date:"13 December 2024",version:"5.0.0",text:["We've upgraded the conditional rendering to support multiple operations (<, >, =, !=, etc.), added support for prop conditional rendering, and updated icons and general UX for the feature.","With this feature, you can easily create variants for your components."],image:"6.gif"},{headline:"Gradient tokens",date:"13 December 2024",version:"5.0.0",text:["When creating a token you can now choose if you want it to be a gradient or a regular color token.","Gradients have an easy-to-use interface, so it should be quite easy to pick the colors you want now and create beautiful sections. You can even update theme tokens to gradients if you wish!"],image:"7.gif"},{headline:"Eye dropper functionality",date:"13 December 2024",version:"5.0.0",text:["The Eye Dropper functionality lets you pick a specific color from somewhere on the screen.","You can find it in the regular color picker UI. It is only available in Chromium browsers though."],image:"8.gif"},{headline:"Reorganized Project Menu and Advanced features",date:"13 December 2024",version:"5.0.0",text:["You can now toggle advanced features on or off from Project Menu -> Advanced Features, directly in the project. No more going into Project Settings required! (though, the options are still there for any who liked the previous location)","We\u2019ve also reorganized and detailed all of the features in the project menu under the Edit, Advanced features, and View menus.","In a future update, videos and tooltips will be added, as well as more options to configure projects to your liking."],image:"9.gif"},{headline:"More control over prop behavior",date:"13 December 2024",version:"5.0.0",text:["There is now an option under Project Menu -> Edit to change the behavior of props when duplicating nodes.","It's been quite debated which behavior is better for this case, so why not make everyone happy?"],image:"10.gif"},{headline:"Grid element",date:"13 December 2024",version:"5.0.0",text:["We\u2019ve added grids back as elements but this time with support for them in the visual inspector!"],image:"11.gif"},{headline:"Visual inspector improvements",date:"13 December 2024",version:"5.0.0",text:["We made a visual update to the Margin/Padding sections to make them more easily recognizable, added Overflow and Ratio fields to the size section, added Fixed, Relative, and Sticky to Position section, and enabled support for Flex, Grid, and Block in the Inner layout sections."],image:"12.gif"},{headline:"Bulk style deletion",date:"13 December 2024",version:"5.0.0",text:["In the Advanced inspector tab you can now bulk delete all the styles on a media query.","It's only available in the Advanced Inspector for now, but if you enjoy this one we can add it to classes and maybe other places as well. The operation is undoable."],image:"13.gif"},{headline:"Enabled Advanced Inspector for component instances.",date:"13 December 2024",version:"5.0.0",text:["This gives you a lot more flexibility over component instance styling. You can add custom styles manually in the Advanced panel for each individual instance of a component."],image:"14.gif"},{headline:"Search for Pages, Components, and Layers",date:"13 December 2024",version:"5.0.0",text:["We've finally added a little search for pages,  components, and layers.","Now you'll find pages/comps/layers much more easily. For layers search, you can now easily find nodes linked to a certain class or with some ID, or maybe those elusive Code Embed nodes that can only be seen in the tree view."],image:"15.gif"},{headline:"New Functions folder",date:"13 December 2024",version:"5.0.0",text:["You can now upload JS files to this folder to be run as cloud functions that run post-deployments.","Furthermore, if you need to access an external package in the cloud function, you just need to import them like you normally would and the code generation pipeline will take care of having the package available in package.json. You can find this folder in the Assets Manager -> Functions."],image:"16.gif"},{headline:"Icons library update",date:"13 December 2024",version:"5.0.0",text:["We\u2019ve added over 100k new icons for you to play with(including animated ones). You can find them all under Assets Manager -> Icons. Hope you\u2019ll enjoy exploring the new additions!"],image:"17.gif"},{headline:"Resize code editor",date:"13 December 2024",version:"5.0.0",text:["A nice quality-of-life improvement, you can now resize the code editor of code embeds and code imports to your liking. This also applies to the code previewer & publish tab. Should help improve readability quite a bit!"],image:"18.gif"},{headline:"Create and delete CMS pages",date:"13 December 2024",version:"5.0.0",text:["We have added the ability to create and delete CMS list and details pages.",'You can now create a new CMS page by clicking the "+" button in the Layers view -> New Page -> CMS Pages.',"From the Layers view, just right click on the page that you want to delete. A contextual menu will appear with the option to delete the page."],image:"19.gif"},{headline:"Improvements & Fixes",date:"13 December 2024",version:"5.0.0",text:["\u2022 Browser back and forward buttons will work to cycle through the accessed pages/components","\u2022 Position and zoom on pages and components will be tracked and applied when switching between them","\u2022 Array Mapper is available inside components","\u2022 Added support for Array props in components","\u2022 Added support for Object props in components","\u2022 Added support for Function props in components (limited to React/NextJS exports - working with our publish mechanism)","\u2022 Limits for Array Mappers: you can now define a start and end for array mapper elements if you want to show just a portion of the array."]},{headline:"Future releases",date:"13 December 2024",version:"5.0.0",text:["\u2022 The TeleportHQ AI Copilot will simplify implementing advanced TeleportHQ features that typically require deep technical expertise. For example, Copilot will automatically generate a function to fetch data from any source and connect it directly to a UI component in your project.","\u2022 Organizing components and pages in folders.","\u2022 Version control for projects. Create snapshots of your project and revert to them if needed.","\u2022 Built-in Form support.","\u2022 Built-in Authentication support.","\u2022 Enabling Events and State Definitions on pages","\u2022 Global state management. This will be a big one in terms of building more complex applications.","\u2022 Component Marketplace. Share your components with the world and use components created by others.","\u2022 Right to left layout support.","\u2022 Tables, Modal, Chart interactive Elements."],image:"future-releases.png"}],d="https://teleporthq.io/docs",p="https://teleporthq.io/release-notes-latest",u="v5.0.0";var h=o(884481),m=o(552322);const y=e=>{const{releases:t,onDismiss:o}=e;return(0,m.jsxs)("div",{className:"release-notes-modal",children:[(0,m.jsxs)("div",{className:"release-notes-header",children:[(0,m.jsx)("span",{children:"What's new?"}),(0,m.jsx)("div",{onClick:o,children:(0,m.jsx)(c.J,{type:"actions/close",size:12})})]}),(0,m.jsx)("div",{className:"release-notes-content",children:(0,m.jsx)("ul",{className:"releases-list",children:t.map(((e,t)=>(0,m.jsxs)("li",{children:[(0,m.jsx)("p",{className:"section-title",children:e.headline}),(0,m.jsxs)("div",{className:"section-subtitle",children:[(0,m.jsx)("span",{children:e.date})," ","|"," ",(0,m.jsxs)("span",{children:["v",e.version]})]}),(0,m.jsx)("ul",{className:"paragraphs-list",children:e.text.map((e=>(0,m.jsx)("li",{children:e},e)))}),e.video&&(0,m.jsx)("video",{width:"100%",autoPlay:!0,loop:!0,muted:!0,children:(0,m.jsx)("source",{src:`/release-notes/${e.video}`,type:"video/mp4"})}),e.image&&(0,m.jsx)("img",{style:{maxHeight:"350px",width:"100%"},src:`/release-notes/${e.image}`,alt:e.headline})]},t)))})}),(0,m.jsxs)("div",{className:"release-notes-footer",children:[(0,m.jsxs)("a",{href:p,target:"_blank",rel:"noreferrer noopener",children:["View Release Notes",(0,m.jsx)(c.J,{type:"actions/follow-link",size:12})]}),(0,m.jsxs)("a",{href:d,target:"_blank",rel:"noreferrer noopener",children:[(0,m.jsx)(c.J,{type:"docs",size:12}),"Help Center"]})]}),(0,m.jsx)("style",{children:h.ET})]})};var g,f,b,I,v,w,N,j,S,D=o(422169),T=o(781872);g=(0,a.provide)("releaseNotesFlow"),f=(0,a.inject)("userAccountRepository"),b=(0,a.inject)("modalManagementFlow"),I=(0,a.inject)("globalAppState"),g((w=class{constructor(){(0,n.Z)(this,"userAccountRepository",N,this),(0,n.Z)(this,"modalManagementFlow",j,this),(0,n.Z)(this,"globalAppState",S,this),(0,i.Z)(this,"lastSeenVersion",null),(0,i.Z)(this,"updateUserData",(async()=>{const{userData:e}=this.globalAppState.user;if(e){(0,s.mutate)(this.globalAppState,(({user:e})=>{e&&e.userData&&(e.userData.meta.lastSeenVersion={APP_VERSION:u})})),this.lastSeenVersion={APP_VERSION:u};try{await this.userAccountRepository.update({meta:e.meta})}catch(t){}}})),(0,i.Z)(this,"resetVersion",(()=>{this.lastSeenVersion={APP_VERSION:u},this.modalManagementFlow.hideModal()})),(0,i.Z)(this,"showReleaseNotes",(()=>{const e=D.d.createCustomModal({Component:y,onDismiss:this.resetVersion,data:{releases:l}});this.modalManagementFlow.showModal(e,{backgroundColor:T.DM.GRAY_200,padding:0,borderRadius:8})}))}init(e){var t,o;const{userData:n}=this.globalAppState.user;if(n){var i;if(!this.lastSeenVersion)this.lastSeenVersion=(null===(i=n.meta)||void 0===i?void 0:i.lastSeenVersion)||{APP_VERSION:""};if(!this.globalAppState.modal.component)if(null!==(t=this.lastSeenVersion)&&void 0!==t&&t.APP_VERSION){if(u!==this.lastSeenVersion.APP_VERSION&&null!==n&&void 0!==n&&null!==(o=n.meta)&&void 0!==o&&o.preferences&&!n.isAnonymous&&"dashboard"===e){this.updateUserData();const e=D.d.createCustomModal({Component:y,onDismiss:this.resetVersion,data:{releases:l}});this.modalManagementFlow.showModal(e,{backgroundColor:T.DM.GRAY_200,padding:0,borderRadius:8})}}else this.updateUserData()}}},N=(0,r.Z)(w.prototype,"userAccountRepository",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j=(0,r.Z)(w.prototype,"modalManagementFlow",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=(0,r.Z)(w.prototype,"globalAppState",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=w))},909967:function(e,t,o){"use strict";o.d(t,{S:function(){return F}});var n=o(503348),i=o(777460),r=o(735468),s=o(889371),a=o(918437),c=o(676422),l=o.n(c),d=o(282147),p=o(505892),u=o(781872),h=o(202784);const m="thq-ai-generation-overlay",y=[`.${m}.jsx-1555975409{width:100%;min-width:580px;height:100%;position:absolute;top:0;left:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;z-index:${u.kg.ONEHUNDRED};-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;background-color:hsla(0,0%,10%,0.7);}`,`.${m}.jsx-1555975409 .modalContainer.jsx-1555975409{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;max-width:580px;padding:24px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;gap:16px;background-color:#121212;border-radius:8px;position:relative;}`,`.${m}.jsx-1555975409 .logo.jsx-1555975409{position:absolute;bottom:64px;}`,`.${m}.jsx-1555975409 .heading.jsx-1555975409{font-size:24px;font-weight:600;}`,`.${m}.jsx-1555975409 .subheadingContainer.jsx-1555975409{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;}`,`.${m}.jsx-1555975409 .subheading.jsx-1555975409{font-size:12px;font-weight:400;}`,`.${m}.jsx-1555975409 .sectionContainer.jsx-1555975409{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-align-self:stretch;-ms-flex-item-align:stretch;align-self:stretch;font-size:16px;font-weight:600;}`,`.${m}.jsx-1555975409 .sectionCopiedMsg.jsx-1555975409{font-size:12px;color:${u.DM.GRAY_700};font-weight:400;}`,`.${m}.jsx-1555975409 .generationProgressContainer.jsx-1555975409{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:24px;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-align-self:stretch;-ms-flex-item-align:stretch;align-self:stretch;gap:8px;border-radius:8px;border:0.5px solid ${u.DM.GRAY_700};}`,`.${m}.jsx-1555975409 .spinnerWrapper.jsx-1555975409{position:relative;margin:0;top:-2px;left:-2px;}`,`.${m}.jsx-1555975409 .progressContainer.jsx-1555975409{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;width:24px;height:24px;}`,`.${m}.jsx-1555975409 .statusText.jsx-1555975409{font-size:12px;width:100%;text-align:right;font-weight:500;margin-top:8px;}`,`.${m}.jsx-1555975409 .modalActions.jsx-1555975409{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;-webkit-box-pack:right;-webkit-justify-content:right;-ms-flex-pack:right;justify-content:right;gap:16px;margin-top:16px;}`,`.${m}.jsx-1555975409 .closeActionContainer.jsx-1555975409{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:absolute;top:10px;right:10px;}`,`@media (max-width:767px){.${m}.jsx-1555975409{min-width:100%;min-height:100%;}}`];y.__hash="1555975409";var g,f,b,I,v=o(173541),w=o(302503),N=o(440516),j=o(395942),S=o(638852),D=o(552322);function T(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function O(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?T(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):T(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let F=(g=(0,w.inject)("projectUIState"),I=new WeakMap,f=class extends h.PureComponent{constructor(e){super(e),(0,n.Z)(this,"projectUIState",b,this),I.set(this,{writable:!0,value:[]}),(0,i.Z)(this,"renderSpinnerBasedOnStatus",(e=>{switch(e){case N.Jj.IN_PROGRESS:return(0,D.jsxs)("div",{className:`jsx-${y.__hash} spinnerWrapper`,children:[(0,D.jsx)(d.$,{color:"#30C151"}),(0,D.jsx)(l(),{id:y.__hash,children:y})]});case N.Jj.COMPLETED:case N.Jj.COPIED_FROM_HOME:return(0,D.jsx)(p.J,{color:"#30C151",size:20,type:"checkmark"});case N.Jj.ERROR:return(0,D.jsx)(p.J,{color:u.DM.DANGER,size:20,type:"actions/close"});default:return null}})),(0,i.Z)(this,"handleGoToPage",(()=>{S.Z.mixpanelEvent(S.Z.AnalyticsEvents.AI_GENERATION_MODAL_GO_TO_PAGE),this.props.onDismiss()})),(0,i.Z)(this,"handleCloseModal",(()=>{S.Z.mixpanelEvent(S.Z.AnalyticsEvents.AI_GENERATION_MODAL_CLOSE),this.props.onDismiss()})),this.projectUIState.pageList.pageUnderCreate.sectionsGenerationStatus&&(this.state={pageGenerationStatus:this.projectUIState.pageList.pageUnderCreate.creationStatus,sectionsGenerationStatus:this.projectUIState.pageList.pageUnderCreate.sectionsGenerationStatus})}componentDidMount(){const e=(0,j.select)(this.projectUIState,["pageList/pageUnderCreate/sectionsGenerationStatus/*"],(e=>{e.pageList.pageUnderCreate.sectionsGenerationStatus&&this.setState({sectionsGenerationStatus:O({},e.pageList.pageUnderCreate.sectionsGenerationStatus)})}),"sectionsStatusSub"),t=(0,j.select)(this.projectUIState,["pageList/pageUnderCreate/creationStatus"],(e=>{e.pageList.pageUnderCreate.sectionsGenerationStatus&&this.setState({pageGenerationStatus:e.pageList.pageUnderCreate.creationStatus})}),"pageStatusSub");(0,s.Z)(this,I,[()=>e.dispose()]),(0,s.Z)(this,I,[()=>t.dispose()])}componentWillUnmount(){(0,r.Z)(this,I).forEach((e=>e())),(0,s.Z)(this,I,[])}render(){const{sectionsGenerationStatus:e,pageGenerationStatus:t}=this.state;return(0,D.jsxs)("div",{className:`jsx-${y.__hash} thq-ai-generation-overlay`,children:[(0,D.jsxs)("div",{className:`jsx-${y.__hash} modalContainer`,children:[(0,D.jsxs)("div",{className:`jsx-${y.__hash}`,children:[(0,D.jsx)("h1",{className:`jsx-${y.__hash} heading`,children:t===N.Jj.COMPLETED?"The content has been generated \ud83d\udca5":"The content is being generated...\ud83d\udca5"}),(0,D.jsxs)("div",{className:`jsx-${y.__hash} subheadingContainer`,children:[(0,D.jsx)(p.J,{size:12,color:"#FFA500",type:"warning"}),(0,D.jsx)("span",{className:`jsx-${y.__hash} subheading`,children:"Please wait until all sections are completed."})]})]}),(0,D.jsx)("div",{className:`jsx-${y.__hash} closeActionContainer`,children:(0,D.jsx)(v.z,{style:"transparent",onClick:this.handleCloseModal,children:(0,D.jsx)(p.J,{type:"actions/close",size:14,color:u.DM.GRAY_600})})}),(0,D.jsx)("div",{className:`jsx-${y.__hash} generationProgressContainer`,children:Object.entries(e).map((([e,t])=>(0,D.jsx)(h.Fragment,{children:(0,D.jsxs)("div",{className:`jsx-${y.__hash} sectionContainer`,children:[(0,D.jsxs)("div",{className:`jsx-${y.__hash}`,children:[(0,D.jsx)("span",{style:{textTransform:"capitalize"},className:`jsx-${y.__hash}`,children:e}),t===N.Jj.COPIED_FROM_HOME&&(0,D.jsx)("p",{className:`jsx-${y.__hash} sectionCopiedMsg`,children:"Section was copied from the Homepage"})]}),(0,D.jsx)("div",{className:`jsx-${y.__hash} progressContainer`,children:this.renderSpinnerBasedOnStatus(t)})]})},e)))}),t===N.Jj.COMPLETED&&(0,D.jsx)("div",{className:`jsx-${y.__hash} modalActions`,children:(0,D.jsx)(v.z,{refAttrs:{autoFocus:!0},colorScheme:"accent",onClick:this.handleGoToPage,children:"Go to the page \u2192"})})]}),(0,D.jsx)(l(),{id:y.__hash,children:y})]})}},b=(0,a.Z)(f.prototype,"projectUIState",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f)},893398:function(e,t,o){"use strict";o.d(t,{h_:function(){return r}});var n=o(202784),i=o(928316);o(552322);const r=({children:e,target:t,className:o})=>{const{0:r,1:s}=(0,n.useState)(null);return(0,n.useEffect)((()=>{let e=null;if(e="string"===typeof t?document.querySelector(t):t instanceof HTMLElement?t:document.body,e){const t=document.createElement("div");return o&&(t.className=o),e.appendChild(t),s(t),()=>{e&&t&&e.contains(t)&&e.removeChild(t)}}}),[t,o]),r?(0,i.createPortal)(e,r):null}},6033:function(e,t,o){"use strict";var n,i,r,s,a,c=o(503348),l=o(918437),d=o(302503);n=(0,d.provide)("uidlDownloadService"),i=(0,d.inject)("sentryService"),n((s=class{constructor(){(0,c.Z)(this,"sentryService",a,this)}async fetchUIDL(e){const t=await fetch(`https://us-central1-croapp-dev.cloudfunctions.net/repl-api/fetch-uidl/${e}`);if(200!==t.status){const e=new Error(t.statusText);throw this.sentryService.captureException(new Error(`Fetch uidl: ${e.message}`)),e}return(await t.json()).uidl}async fetchLocalUIDL(e){const t=await fetch(e);if(200!==t.status){const e=new Error(t.statusText);throw this.sentryService.captureException(new Error(`Fetch local uidl: ${e.message}`)),e}return await t.json()}},a=(0,l.Z)(s.prototype,"sentryService",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r=s))},168185:function(e,t,o){"use strict";var n,i,r,s,a,c=o(503348),l=o(918437),d=o(302503);n=(0,d.provide)("uidlUploadService"),i=(0,d.inject)("sentryService"),n((s=class{constructor(){(0,c.Z)(this,"sentryService",a,this)}async upload(e,t="component"){const o=await fetch("https://us-central1-croapp-dev.cloudfunctions.net/repl-api/upload-uidl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uidl:e,type:t})});if(200!==o.status){const e=new Error(o.statusText);throw this.sentryService.captureException(new Error(`Uidl upload: ${e.message}`)),e}return(await o.json()).fileName}},a=(0,l.Z)(s.prototype,"sentryService",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r=s))},647571:function(e,t,o){"use strict";o.d(t,{u:function(){return h}});var n=o(676422),i=o.n(n),r=o(686646),s=o(376897),a=o(173541),c=o(505892),l=o(834273),d=o.n(l),p=o(302503),u=o(552322);const h=e=>{const{value:t,iconSize:o=14}=e,n=p.DIContainer.getInstance().getSingletonClassInstance("notificationsManagementFlow");return(0,u.jsxs)("div",{onClick:()=>(t=>{e.showNotification&&n.createNotification(r.k$.INFO,"Copied to clipboard"),d()(t)})(t),"data-tooltip-name":"copy-to-clipboard-icon",className:"jsx-3555482767 copy-icon-wrapper",children:[(0,u.jsx)(a.z,{size:"small",colorScheme:"neutral",style:"transparent",children:(0,u.jsx)(c.J,{type:"copy",size:o})}),(0,u.jsx)(s._,{name:"copy-to-clipboard-icon",children:(0,u.jsx)(u.Fragment,{children:"Copy to Clipboard"})}),(0,u.jsx)(i(),{id:"3555482767",children:[".copy-icon-wrapper.jsx-3555482767{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}"]})]})}},389561:function(e,t,o){"use strict";o.d(t,{F:function(){return n},$:function(){return i}});const n={ADD_PAGE:"Create new page",ADD_COMPONENT:"Create new component",PREVIEW_COMPONENT:"Preview component",PUBLISH_PROJECT:"Publish project",VIEW_CODE:"View generated code",DOWNLOAD_REACT:"Export as React project",DOWNLOAD_ANGULAR:"Export as Angular project",DOWNLOAD_VUE:"Export as Vue project",DOWNLOAD_NEXT:"Export as Next project",DOWNLOAD_NUXT:"Export as Nuxt project",CONTINUE_ON_SANDBOX:"Continue on CodeSandbox",CONTINUE_ON_GITHUB:"Continue on Github",DISABLE_OPTIMISATIONS_FOR_IMAGES:"Disable optimisations for all images",ENABLE_OPTIMISATIONS_FOR_IMAGES:"Enable optimisations for all images",DELETE_ALL_UNUSED_ASSETS:"Delete all unused assets",PROJECT_SETTINGS:"Project settings"},i={PRETTIER:"Run Prettier"}},591774:function(e,t,o){"use strict";o.d(t,{b:function(){return n}});const n={NONE:"None",SLIDE_FROM_TOP:"Slide from Top",SLIDE_FROM_LEFT:"Slide from Left",SLIDE_FROM_RIGHT:"Slide from Right"}},351686:function(e,t,o){"use strict";o.d(t,{U:function(){return _}});var n,i,r,s,a,c,l,d,p,u,h,m,y,g,f,b,I,v=o(503348),w=o(777460),N=o(918437),j=o(302503),S=o(395942),D=o(757156),T=o(255328),O=o(236711),F=o(233475),C=o(813244);function E(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function x(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?E(Object(o),!0).forEach((function(t){(0,w.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):E(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let _=(n=(0,j.inject)("projectDoc"),i=(0,j.inject)("projectUIState"),r=(0,j.inject)("sharedbProjectSyncService"),s=(0,j.inject)("nodeAttributeManagmentFlow"),a=(0,j.inject)("nodeSelectionFlow"),c=(0,j.inject)("assetsManagementFlow"),l=(0,j.inject)("nodeManagementFlow"),I=b=class{constructor(){(0,v.Z)(this,"projectDoc",p,this),(0,v.Z)(this,"projectUIState",u,this),(0,v.Z)(this,"dbSync",h,this),(0,v.Z)(this,"nodeAttributeManagmentFlow",m,this),(0,v.Z)(this,"nodeSelectionFlow",y,this),(0,v.Z)(this,"assetsManagementFlow",g,this),(0,v.Z)(this,"nodeManagementFlow",f,this),(0,w.Z)(this,"cmsUIState",D.H.Instance)}static get Instance(){return this._instance||(this._instance=new this)}upsertMixedTypeNodeMapping(e,t){this.dbSync.mutate(this.projectDoc,(o=>{const n=o.nodes.getById(e);if(!n)throw new Error("Could not find mixed type node");if("cms-mixed-type-node"!==n.type)throw new Error("Found node but it is not of mixed-type");if(!n.mappings[t.typeId]){if(!t.pos){const e=Math.max(...Object.values(n.mappings).map((e=>{var t;return null!==(t=e.pos)&&void 0!==t?t:0})));t.pos=e+Number.MAX_SAFE_INTEGER}return void(n.mappings[t.typeId]=t)}const i=n.mappings[t.typeId];if(t.componentId!==i.componentId){const r=this.createComponentInstanceForMapping(t.componentId,n.id);i.componentInstanceId&&o.deleteNodesById({nodeIds:[i.componentInstanceId]}),r&&(o.nodes.add(r),o.addAttributesFromPropsUseCase({doc:o,node:r}),t.componentInstanceId=r.id);const s=o.getComponentIdForNode(e,!0);if(t.componentId){const e=o.components.byId[t.componentId];e&&t.componentInstanceId&&(e.instantiatedByNodes[t.componentInstanceId]=!0),o.addUsedComponentRelation({toAddComponentId:s,linkedComponentId:t.componentId})}if(i.componentId){const e=o.components.byId[i.componentId];e&&i.componentInstanceId&&delete e.instantiatedByNodes[i.componentInstanceId],o.removeUsedComponentRelation({toRemoveComponentId:s,linkedComponentId:i.componentId})}}n.mappings[t.typeId]=t}))}createComponentInstanceForMapping(e,t){return e?new O.F({primitiveType:F.sO.COMPONENT,compIdOfCompInstance:e,parentId:t}):null}removeMixedTypeNodeMappingAttribute(e){const{nodeId:t,defaultPropValue:o,mappingId:n,doc:i}=e;if(!i)return;const r=i.nodes.getById(t);if(!r)throw new Error(`Node that needs mapping attr removal not found - ${t}`);if(!("mappings"in r))return;if(!r.mappings[n])throw new Error(`Mapping that needs attr removal not found - ${n} from node ${t}`);this.updateMixedTypeNodeMappingAttribute(x(x({},e),{},{doc:i,value:o}))}async updateSelectedMixedTypeNodeMappingCompImageAttr(e){var t,o,n;const{imgSrc:i,downloadLink:r}=e,s=null===(t=this.projectUIState.userInteractions.focusedImgAttr)||void 0===t?void 0:t.attrName,a=this.nodeSelectionFlow.getSelectedNodesIds()[0],c=null===(o=this.projectUIState.userInteractions.focusedImgAttr)||void 0===o||null===(n=o.meta)||void 0===n?void 0:n.mappingId;if(!c||!s||!a)return;const l=await this.assetsManagementFlow.getAssetSrc(i,{downloadLink:r,targetNodeId:a});this.updateMixedTypeNodeMappingAttribute({value:l,property:s,nodeId:a,mappingId:c})}updateMixedTypeNodeMappingAttribute(e){const{value:t="",property:o,mappingId:n,nodeId:i,doc:r}=e;if(!r)return;const s=r.nodes.getById(i);if(!s)throw new Error("Could not find mixed type node");if("cms-mixed-type-node"!==s.type)throw new Error("Found node but it is not of mixed-type");const a=s.mappings[n];if(!a)throw new Error(`Could not update attr for mapping ${n} in node ${i}`);if(!a.componentInstanceId)throw new Error("Attempted to update mapping attribute without having an associated component instance!");const{propId:c,stateId:l,ctxId:d,refPath:p}=e;this.nodeAttributeManagmentFlow.updateAttrByKey({nodeId:a.componentInstanceId,key:o,value:t,propId:c,stateId:l,ctxId:d,refPath:p,doc:r})}unbindComponentFromMapping(e){const{mappingId:t,nodeId:o,doc:n}=e;if(!n)return;const i=n.nodes.getById(o);if(!i)throw new Error("Could not find mixed type node");if("cms-mixed-type-node"!==i.type)throw new Error("Found node but it is not of mixed-type");const r=i.mappings[t];if(!r)throw new Error(`Could not find mapping ${t} for node ${o}`);if(!r.componentId)throw new Error(`Attempted to unbind a component from mapping ${t} of node ${o} that has no bound component id`);n.removeUsedComponentRelation({toRemoveComponentId:n.getComponentIdForNode(o,!0)||"",linkedComponentId:r.componentId});const s=n.components.byId[r.componentId];r.componentId=void 0,r.componentInstanceId&&(s&&delete s.instantiatedByNodes[r.componentInstanceId],n.deleteNodesById({nodeIds:[r.componentInstanceId]}),r.componentInstanceId=void 0)}deleteMixedTypeNodeMapping(e,t){this.dbSync.mutate(this.projectDoc,(o=>{const n=o.nodes.getById(e);if(!n)throw new Error("Could not find mixed type node");if("cms-mixed-type-node"!==n.type)throw new Error("Found node but it is not of mixed-type");if(n.mappings[t].componentInstanceId&&o.deleteNodesById({nodeIds:[n.mappings[t].componentInstanceId]}),n.mappings[t].componentId){const e=o.getComponentIdForNode(n.id,!0);o.removeUsedComponentRelation({toRemoveComponentId:e,linkedComponentId:n.mappings[t].componentId})}this.deleteMappingForNode({mappingId:t,node:n,doc:o})})),this.cmsUIState.mixedTypesInPreview[e]===t&&this.stopMixedTypeInPreviewForNode(e)}toggleMixedTypeInPreviewForNode(e,t){const o=this.projectDoc.nodes.getById(e);if(!o)throw new Error(`Tried to toggle mixed type preview but node was not found: ${e}`);if("cms-mixed-type-node"!==o.type)throw new Error(`Tried to toggle mixed type preview but node is not mixed type: ${e}`);(0,S.mutate)(this.cmsUIState,(o=>{o.mixedTypesInPreview[e]?o.mixedTypesInPreview[e]!==t?o.mixedTypesInPreview[e]=t:delete o.mixedTypesInPreview[e]:o.mixedTypesInPreview[e]=t}))}stopMixedTypeInPreviewForNode(e){(0,S.mutate)(this.cmsUIState,(t=>{delete t.mixedTypesInPreview[e]}))}setMixedTypeMappingFallbackValue(e){const{nodeId:t,mappingId:o,value:n,property:i,doc:r}=e;if(!r)return;const s=r.nodes.getById(t);if(!s)return;if(!("mappings"in s))throw new Error("Cannot set fallback value because mappings were not found");const a=s.mappings[o];if(!a)throw new Error(`Could not find mapping ${o} for node ${t}`);const c=a.componentInstanceId;if(!c)throw new Error(`Could not find component instance for mapping ${o} for node ${t} to update fallback value`);this.nodeManagementFlow.setFallbackValueForNode({nodeId:c,value:n,location:C.mH.ATTR,property:i,doc:r})}deleteMappingForNode(e){const{node:t,mappingId:o,doc:n}=e;if(!n)return;const i=t.mappings[o];if(!i)throw new Error(`Could not find mapping ${o} for node ${t.id}`);const r=i.componentInstanceId;if(i.componentId&&r){const e=n.components.byId[i.componentId];if(!e)return;delete e.instantiatedByNodes[r]}delete t.mappings[o]}},(0,w.Z)(b,"_instance",void 0),d=I,p=(0,N.Z)(d.prototype,"projectDoc",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=(0,N.Z)(d.prototype,"projectUIState",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=(0,N.Z)(d.prototype,"dbSync",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=(0,N.Z)(d.prototype,"nodeAttributeManagmentFlow",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=(0,N.Z)(d.prototype,"nodeSelectionFlow",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=(0,N.Z)(d.prototype,"assetsManagementFlow",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=(0,N.Z)(d.prototype,"nodeManagementFlow",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,N.Z)(d.prototype,"removeMixedTypeNodeMappingAttribute",[T.P],Object.getOwnPropertyDescriptor(d.prototype,"removeMixedTypeNodeMappingAttribute"),d.prototype),(0,N.Z)(d.prototype,"updateMixedTypeNodeMappingAttribute",[T.P],Object.getOwnPropertyDescriptor(d.prototype,"updateMixedTypeNodeMappingAttribute"),d.prototype),(0,N.Z)(d.prototype,"unbindComponentFromMapping",[T.P],Object.getOwnPropertyDescriptor(d.prototype,"unbindComponentFromMapping"),d.prototype),(0,N.Z)(d.prototype,"setMixedTypeMappingFallbackValue",[T.P],Object.getOwnPropertyDescriptor(d.prototype,"setMixedTypeMappingFallbackValue"),d.prototype),(0,N.Z)(d.prototype,"deleteMappingForNode",[T.P],Object.getOwnPropertyDescriptor(d.prototype,"deleteMappingForNode"),d.prototype),d)},558683:function(e,t,o){"use strict";o.d(t,{u:function(){return w}});var n,i,r,s,a,c,l,d,p,u=o(503348),h=o(777460),m=o(918437),y=o(255328),g=o(302503),f=o(633958),b=o.n(f);function I(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function v(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?I(Object(o),!0).forEach((function(t){(0,h.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):I(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let w=(n=(0,g.inject)("projectDoc"),i=(0,g.inject)("projectUIState"),r=(0,g.inject)("sharedbProjectSyncService"),p=d=class{constructor(){(0,u.Z)(this,"projectDoc",a,this),(0,u.Z)(this,"projectUIState",c,this),(0,u.Z)(this,"dbSync",l,this)}static get Instance(){return this._instance||(this._instance=new this)}toggleWebhookSystem(e){var t,o;const{doc:n,status:i,publishOption:r}=e;if(!n)return;let s;switch(r){case"teleport":const e=null===(t=n.stats.deployments)||void 0===t?void 0:t.teleport;if(!e)throw new Error("Teleport URL is not set");s=e;break;case"vercel":const i=null===(o=n.stats.deployments)||void 0===o?void 0:o.vercel;if(!i)throw new Error("Vercel URL is not set");s=i}n.cms.webhook.config[r]=i?{url:s,revalidate:null}:null}updateWebhookConfig(e){const{publishOption:t,key:o,value:n,doc:i}=e,r=null===i||void 0===i?void 0:i.cms.webhook.config[t];if(!i||!r)return;const s=v(v({},r),{},{[o]:n});Object.keys(s).forEach((e=>{const t=s[e];null===t||t||delete s[e]})),i.cms.webhook.config[t]=v({},s)}updateWebhookLastPublished(e){const{url:t,revalidate:o,secret:n,publishOption:i,optedOut:r,doc:s}=e;if(!s)return;if(r)return void(s.cms.webhook.lastPublishedConfig[i]=null);const a={url:t,revalidate:o,secret:n};Object.keys(a).forEach((e=>{const t=a[e];null===t||t||delete a[e]}));s.cms.webhook.lastPublishedConfig[i]=a}isConfigDifferentFromLastPublished(e){var t,o;const n=null===(t=this.projectDoc.cms.webhook)||void 0===t?void 0:t.config,i=null===(o=this.projectDoc.cms.webhook)||void 0===o?void 0:o.lastPublishedConfig;return!(null!==i&&void 0!==i&&i[e]||null!==n&&void 0!==n&&n[e])||b()(null===n||void 0===n?void 0:n[e],null===i||void 0===i?void 0:i[e])}},(0,h.Z)(d,"_instance",void 0),s=p,a=(0,m.Z)(s.prototype,"projectDoc",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=(0,m.Z)(s.prototype,"projectUIState",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=(0,m.Z)(s.prototype,"dbSync",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,m.Z)(s.prototype,"toggleWebhookSystem",[y.P],Object.getOwnPropertyDescriptor(s.prototype,"toggleWebhookSystem"),s.prototype),(0,m.Z)(s.prototype,"updateWebhookConfig",[y.P],Object.getOwnPropertyDescriptor(s.prototype,"updateWebhookConfig"),s.prototype),(0,m.Z)(s.prototype,"updateWebhookLastPublished",[y.P],Object.getOwnPropertyDescriptor(s.prototype,"updateWebhookLastPublished"),s.prototype),s)},542890:function(e,t,o){"use strict";o.d(t,{Xu:function(){return n},tH:function(){return i},fy:function(){return r}});const n={BLUEPRINT_FIELD_TYPE_STRING:"string",BLUEPRINT_FIELD_TYPE_COLOR:"string",BLUEPRINT_FIELD_TYPE_SELECT:"string",BLUEPRINT_FIELD_TYPE_BOOLEAN:"boolean",BLUEPRINT_FIELD_TYPE_GEOPOINT:"location",BLUEPRINT_FIELD_TYPE_INT:"number",BLUEPRINT_FIELD_TYPE_FLOAT:"number",BLUEPRINT_FIELD_TYPE_DATETIME:"datetime"},i="https://cloud.caisy.io/caisy/graphql",r="https://cloud.caisy.io/api/v3/e/"},762869:function(e,t,o){"use strict";o.d(t,{O:function(){return n},Fb:function(){return i},$G:function(){return r},NB:function(){return s},Fe:function(){return a}});const n=["blueprintId","createdAt","name","title","single","system","variant"],i=["hasNextPage","hasPreviousPage","endCursor"],r=["required","disableInApi"],s=["createdAt","updatedAt","id"],a=["description","height","id","src","title","width"]},995234:function(e,t,o){"use strict";o.d(t,{v2:function(){return y},WM:function(){return h},LK:function(){return m}});var n=o(967802),i=o(429952),r=o(585655);const s=e=>{if(0!==e.length){if(1===e.length){const t=e[0],o=t.order===n.X.ASCENDING?"ASC":"DESC";return`sort:{${t.attrName}:${o}}`}return`sort:[${e.map((e=>{const t=e.order===n.X.ASCENDING?"ASC":"DESC";return`{${e.attrName}:${t}}`})).join(",")}]`}},a=(e,t,o,n,r)=>{if("boolean"===o)return`${e}:${t}`;return`${e}:{${i.E7[n||"eq"]}:${["string","color"].includes(o)&&!r?`"${t}"`:t}}`},c=()=>"first: $first, after: $after",l=(e,t)=>{let o="$first: Int, $after: String, $locale: String";return e&&e.content?(e.content.forEach((({path:e},n)=>{let r="String";const s=(0,i.AJ)(e);if(s&&t&&t.attributes[s])switch(t.attributes[s].type){case"boolean":r="Boolean";break;case"number":r="Int";break;case"datetime":r="DateTime";break;default:r="String"}o=o.concat(`, $filterParam${n}: ${r}`)})),o):o},d=(e,t,o)=>t&&t.length>0?((e,t)=>{if(0!==e.length){if(1===e.length){const o=e[0],n=(0,i.AJ)(o.path),r=t.attributes[n].type;return`where:{${a(n,o.value,r,o.operand)}}`}return`where:[${e.map((e=>{const o=(0,i.AJ)(e.path),n=t.attributes[o].type;return`{${a(o,e.value,n,e.operand)}}`})).join(",")}]`}})(t,e):null!==o&&void 0!==o&&o.content?((e,t)=>{if(!Array.isArray(e.content))throw new Error("Filter attribute is not of type array");const o=e.content;if(0!==o.length){if(1===o.length){const e=o[0],n=(0,i.AJ)(e.path),r=t.attributes[n].type;return`where:{${a(n,"$filterParam0",r,e.operand,!0)}}`}return`where:[${o.map(((e,o)=>{const n=(0,i.AJ)(e.path),r=t.attributes[n].type;return`{${a(n,`$filterParam${o}`,r,e.operand,!0)}}`})).join(",")}]`}})(o,e):void 0;var p=o(523148),u=o(733790);const h=(e,t,o)=>{const n=e[t];return"singleType"in n&&n.singleType?(0,p._)({contentAndComponentTypes:e,contentTypeId:n.uid}):(0,u.e)(e,n.uid,o)},m=e=>{const{contentAndComponentTypes:t,contentTypeId:o}=e,n=t[o];return"singleType"in n&&n.singleType?(0,p._)({contentAndComponentTypes:t,contentTypeId:n.uid}):(e=>{const{contentAndComponentTypes:t,contentTypeId:o,sortings:n,resolvedFiltersAttr:i,unresolvedFiltersAttr:a}=e,p="all"+(0,r.F)(t[o].name),u=n&&s(n),h=d(t[o],i,a),m="locale: $locale",y=c(),g=u||h||y;return`query MyQuery(${l(a,t[o])}){${p}${g?`(${[m,u,h,y].filter((e=>!!e)).join(",")})`:""}{pageInfo{endCursor,hasNextPage,hasPreviousPage}edges{node{${(0,r.i)(t,o,0,2)}}}}}`})(e)},y=(e,t,o)=>{const n=e[o];return"singleType"in n&&n.singleType?((e,t,o)=>`{${(0,r.F)(e[o].name)}{${t}}}`)(e,t,n.uid):((e,t,o)=>`{${"all"+(0,r.F)(e[o].name)}{edges{node{${t}}}}}`)(e,t,n.uid)}},733790:function(e,t,o){"use strict";o.d(t,{J:function(){return i},e:function(){return r}});var n=o(585655);const i=(e,t)=>{const o=(0,n.F)(e[t].name);return`query ${o}(${["$value:ID!","$locale:String"].join(",")}){${o}(${["id:$value","locale:$locale"].join(",")}){${(0,n.i)(e,t,0,2)}}}`},r=(e,t,o)=>{if("id"===o)return i(e,t);const r="all"+(0,n.F)(e[t].name);return`query MyQuery(${["$value:String","$locale:String"].join(",")}){${r}(${["locale:$locale"].join(",")}, where: {${o}:{eq: $value}}){edges{node{${(0,n.i)(e,t,0,2)}}}}}`}},523148:function(e,t,o){"use strict";o.d(t,{_:function(){return i}});var n=o(585655);const i=e=>{const{contentAndComponentTypes:t,contentTypeId:o}=e,i=(0,n.F)(t[o].name);return`query MyQuery(${["$locale:String"].join(",")}){${i}(${["locale:$locale"].join(",")}){${(0,n.i)(t,o,0,2)}}}`}},585655:function(e,t,o){"use strict";o.d(t,{F:function(){return i},i:function(){return r}});var n=o(762869);function i(e){return e.split("").map(((e,t,o)=>0===t||" "===o[t-1]||void 0===o[t-1]||e.toUpperCase()===e&&o[t+1]&&o[t+1].toUpperCase()!==o[t+1]?e.toUpperCase():e.toUpperCase()===e&&o[t-1]&&o[t-1].toUpperCase()===o[t-1]?e.toLowerCase():e)).join("")}const r=(e,t,o=0,a=1,c=6)=>{if(!e[t])return"id";const l=e[t],d=Object.keys(l.attributes),p=`_meta{${n.NB.join(" ")}}`;let u="";return d.map((t=>{const d=l.attributes[t];if(n.NB.includes(t))return"";if("richtext"===d.type)return s(t,d);if("location"===d.type)return`${t}{formattedAddress latitude longitude zoom}`;if("media"===d.type||"relation"===d.type&&d.relationToAssetsType)return"media"===d.type?`${t}{__typename _meta{${n.NB.join(" ")}}${n.Fe.join(" ")}}`:`${t}{__typename ...on Asset{ _meta{${n.NB.join(" ")}}${n.Fe.join(" ")}}}`;if("relation"===d.type){const n=d.relationContentTypeIds||d.relationComponentTypeIds;return n?`${t}{__typename${(null!==n&&void 0!==n?n:[]).map((t=>{const n=e[t];if(!n)return"";if("componentType"===n.type){if(o>=c)return""}else if(o>=a)return"";return`...on ${i(e[t].name)}{${r(e,t,o+1,a,c)}}`})).join("")}}`:t}return t})).forEach(((e,t)=>{""!==e&&("}"!==e[e.length-1]&&t!==d.length-1?u+=e+" ":u+=e+"")})),p+u},s=(e,t)=>`${e}{json connections{__typename ${t.hasAssetLinking?`...on Asset{${n.Fe.join(" ")}}`:""} }}`},429952:function(e,t,o){"use strict";o.d(t,{zh:function(){return r},AJ:function(){return s},E7:function(){return a}});var n=o(465951),i=o(237584);const r=(e,t)=>{if(!Array.isArray(e.content))throw new Error("Filter attribute is not of type array");const o=e.content,n={};return o.forEach((({value:e},o)=>{n[`filterParam${o}`]=(0,i.aD)(e,t)})),n},s=e=>e.reduce(((e,t,o)=>{if("relation"===t.type)throw new Error("Caisy does not support relation filters");return 0===o?t.content.toString():`${e}.${t.content.toString()}`}),""),a={[n.nS.eq]:"eq",[n.nS.neq]:"neq",[n.nS.lt]:"lt",[n.nS.gt]:"gt",[n.nS.lte]:"lte",[n.nS.gte]:"gte"}},648126:function(e,t,o){"use strict";o.d(t,{MC:function(){return n},z6:function(){return i},t0:function(){return r}});const n={Symbol:"string",Boolean:"boolean",Location:"location",Integer:"number",Number:"number",Date:"datetime",Object:"json"},i="https://api.contentful.com",r="https://cdn.contentful.com"},109751:function(e,t,o){"use strict";o.d(t,{Hi:function(){return p},Pm:function(){return u},d_:function(){return y}});var n=o(777460),i=o(967802),r=o(648126),s=o(811752),a=o(682562),c=o(354163);function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function d(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const p=["id","createdAt","updatedAt"],u=e=>{const t=e.reduce(((e,t)=>("ContentType"!==t.sys.type||e.push(t.sys.id),e)),[]);return e.reduce(((e,o)=>("ContentType"!==o.sys.type||(e[o.sys.id]={type:"contentType",name:(0,c.L7)(o.name),uid:o.sys.id,attributes:h(o.fields,t)}),e)),{})},h=(e,t)=>{let o=e.reduce(((e,o)=>{var n,s;const a=o.type;if("Link"===a&&"Asset"===o.linkType)return e[o.id]={type:"media"},e;if("Link"===a&&"Entry"===o.linkType){var c;const n=(null===(c=o.validations)||void 0===c?void 0:c[0].linkContentType)||t,r={type:"relation",relationType:i.t.SIMPLE,relationContentTypeIds:[...n]};return e[o.id]=r,e}if("Array"===a&&"Asset"===(null===(n=o.items)||void 0===n?void 0:n.linkType))return e[o.id]={type:"relation",relationToAssetsType:!0,relationType:i.t.MULTIPLE},e;if("Array"===a&&"Entry"===(null===(s=o.items)||void 0===s?void 0:s.linkType)){var l,d,p;const n=(null===(l=o.items)||void 0===l||null===(d=l.validations)||void 0===d||null===(p=d[0])||void 0===p?void 0:p.linkContentType)||t;return e[o.id]={type:"relation",relationContentTypeIds:n,relationType:i.t.MULTIPLE},e}return"RichText"===a?(e[o.id]={type:"richtext"},e):(e[o.id]={type:r.MC[a]||"string"},e)}),{});return o=d(d({},o),{},{createdAt:{type:"datetime"},updatedAt:{type:"datetime"},id:{type:"string"}}),o},m=e=>{var t,o,n,i,r,s,a,c,l,p,u;const h=null===e||void 0===e?void 0:e.fields;if(null===e||void 0===e||null===(t=e.sys)||void 0===t||!t.id)return null;const m={id:null===e||void 0===e||null===(o=e.sys)||void 0===o?void 0:o.id,name:null===h||void 0===h?void 0:h.title,url:null===h||void 0===h||null===(n=h.file)||void 0===n?void 0:n.url,assetType:null===h||void 0===h||null===(i=h.file)||void 0===i?void 0:i.contentType};return"text/html"===(null===h||void 0===h||null===(r=h.file)||void 0===r?void 0:r.contentType)?m:d(d({},m),{},{size:{height:null===h||void 0===h||null===(s=h.file)||void 0===s||null===(a=s.details)||void 0===a||null===(c=a.image)||void 0===c?void 0:c.height,width:null===h||void 0===h||null===(l=h.file)||void 0===l||null===(p=l.details)||void 0===p||null===(u=p.image)||void 0===u?void 0:u.width}})},y=(e,t)=>{const o=t.attributes;return e.map((e=>d({id:e.sys.id,createdAt:e.sys.createdAt,updatedAt:e.sys.updatedAt},((e,t)=>Object.keys(t).reduce(((o,n)=>{const r=e[n],s=t[n];switch(null===r||void 0===r?void 0:r.type){case"string":case"json":case"number":case"datetime":case"boolean":if(p.includes(n))break;o[n]=s;break;case"richtext":o[n]=g(s);break;case"location":o[n]={lat:s.lat,lon:s.lon};break;case"media":{const e=m(s);if(!e)break;o[n]=e;break}case"array":break;case"relation":{if(r.relationType===i.t.SIMPLE){o[n]=s;break}if(r.relationToAssetsType){o[n]=s.map((e=>{const t=m(e);if(t)return t})).filter((e=>e));break}const e=s;o[n]=e.map((e=>e));break}}return o}),{}))(o,e))))},g=e=>(0,s.S)(e,{renderNode:{[a.BLOCKS.EMBEDDED_ASSET]:e=>`<img src="${e.data.target.fields.file.url}"/>`}})},541730:function(e,t,o){"use strict";o.d(t,{PN:function(){return a},iv:function(){return c},$8:function(){return l},zh:function(){return d}});var n=o(465951),i=o(967802),r=o(109751),s=o(237584);const a=e=>{if(!Array.isArray(e))throw new Error("Sort attribute is not of type array");let t="";return e.forEach((({attrName:e,order:o},n)=>{const s=o===i.X.DESCENDING?"-":"",a=r.Hi.includes(e)?"sys":"fields";t=t.concat(`${n>0?",":""}${s}${a}.${e}`)})),t},c=e=>{if(!Array.isArray(e))throw new Error("Filter attribute is not of type array");const t={};return e.forEach((({path:e,value:o,operand:i})=>{const{parsedPathName:r,extraFilterQueries:s}=p(e);t[`fields.${r}[${u[i||n.nS.eq]}]`]=o,Object.entries(s).forEach((([e,o])=>{t[e]=o}))})),t},l=e=>{if("dynamic"===e.type)throw new Error("dynamic values for sort not handled yet");if(!Array.isArray(e.content))throw new Error("Sort attribute is not of type array");const t=e.content;let o="";return t.forEach((({attrName:e,order:t},n)=>{const s=t===i.X.DESCENDING?"-":"",a=r.Hi.includes(e)?"sys":"fields";o=o.concat(`${n>0?",":""}${s}${a}.${e}`)})),o},d=(e,t)=>{if(!Array.isArray(e.content))throw new Error("Filter attribute is not of type array");const o=e.content,i={};return o.forEach((({path:e,value:o,operand:r})=>{const{parsedPathName:a,extraFilterQueries:c}=p(e);i[`fields.${a}[${u[r||n.nS.eq]}]`]=(0,s.aD)(o,t),Object.entries(c).forEach((([e,t])=>{i[e]={type:"static",content:t}}))})),i},p=e=>{const t={};return{parsedPathName:e.reduce(((e,o,n)=>0===n?"content"in o?o.content.toString():o.contentTypeName:"relation"===o.type?(t[`fields.${o.contentTypeName}.sys.contentType.sys.id`]=o.contentTypeId,`${e}.fields.${o.contentTypeName.toString()}`):`${e}.${o.content.toString()}`),""),extraFilterQueries:t}},u={[n.nS.eq]:"equals",[n.nS.neq]:"ne",[n.nS.lt]:"lt",[n.nS.gt]:"gt",[n.nS.lte]:"lte",[n.nS.gte]:"gte"}},934777:function(e,t,o){"use strict";o.d(t,{PN:function(){return s},iv:function(){return a},zh:function(){return c},$8:function(){return l}});var n=o(465951),i=o(967802),r=o(237584);const s=e=>{const t={};if(!e)return t;if(!Array.isArray(e))throw new Error("Sort attribute is not of type array");return e.map((({attrName:e,order:o})=>{const n=o===i.X.DESCENDING?"desc":"asc";t.order_by=e,t.order_direction=n})),t},a=e=>{if(!Array.isArray(e))throw new Error("Filter attribute is not of type array");const t={};return e.forEach((({path:e,value:o,operand:i})=>{t[d(e)]={type:p[i||n.nS.eq],filter:o.toString()}})),JSON.stringify(t)},c=(e,t)=>{if(!Array.isArray(e.content))throw new Error("Filter attribute is not of type array");const o=e.content,i={},s={};return o.forEach((({path:e,value:o,operand:a})=>{const c=(0,r.aD)(o,t),l=d(e);let u="";"static"===c.type&&(u=c.content.toString()),"dynamic"!==c.type&&"expr"!==c.type||(u=`\${params['${l}']}`,s[l]=c),i[l]={type:p[a||n.nS.eq],filter:u}})),{queryParamsForFetcher:i,queryParamsToSendToFetcher:s}},l=e=>{const t={};if(!e)return t;if("dynamic"===e.type)throw new Error("dynamic values for sort not handled yet");if(!Array.isArray(e.content))throw new Error("Sort attribute is not of type array");return e.content.map((({attrName:e,order:o})=>{const n=o===i.X.DESCENDING?"desc":"asc";t.order_by=e,t.order_direction=n})),t},d=e=>e.reduce(((e,t,o)=>0===o?`${"content"in t?t.content:t.contentTypeName}`:`${e}[*].${"content"in t?t.content:t.contentTypeName}`),""),p={[n.nS.eq]:"equals",[n.nS.neq]:"notEqual",[n.nS.lt]:"lessThan",[n.nS.gt]:"greaterThan",[n.nS.lte]:"lessThanOrEqual",[n.nS.gte]:"greaterThanOrEqual"}},768818:function(e,t,o){"use strict";o.d(t,{iv:function(){return s},PN:function(){return a},zh:function(){return c},$8:function(){return l},vP:function(){return u}});var n=o(465951),i=o(967802),r=o(237584);const s=e=>{if(!Array.isArray(e))throw new Error("Filter attribute is not of type array");const t={};return e.forEach((({path:e,value:o,operand:i})=>{const r=d(e);t[`filters${r}[${p[i||n.nS.eq]}]`]=o})),t},a=e=>{const t={};if(!e)return t;if(!Array.isArray(e))throw new Error("Sort attribute is not of type array");return e.map((({attrName:e,order:o},n)=>{const r=o===i.X.DESCENDING?"desc":"asc";t[`sort[${n}]`]=`${e}:${r}`})),t},c=(e,t)=>{if(!Array.isArray(e.content))throw new Error("Filter attribute is not of type array");const o=e.content,i={};return o.forEach((({path:e,value:o,operand:s})=>{const a=d(e);i[`filters${a}[${p[s||n.nS.eq]}]`]=(0,r.aD)(o,t)})),i},l=e=>{const t={};if(!e)return t;if("dynamic"===e.type)throw new Error("dynamic values for sort not handled yet");if(!Array.isArray(e.content))throw new Error("Sort attribute is not of type array");return e.content.map((({attrName:e,order:o},n)=>{const r=o===i.X.DESCENDING?"desc":"asc";t[`sort[${n}]`]=`${e}:${r}`})),t},d=e=>e.reduce(((e,t,o)=>0===o?`[${"content"in t?t.content:t.contentTypeName}]`:`${e}[${"content"in t?t.content:t.contentTypeName}]`),""),p={[n.nS.eq]:"$eq",[n.nS.neq]:"$ne",[n.nS.lt]:"$lt",[n.nS.gt]:"$gt",[n.nS.lte]:"$lte",[n.nS.gte]:"$gte"},u=(e,t)=>{const o=new URLSearchParams;return Object.entries(e).forEach((([e,n])=>{((e,t,o,n)=>{var i;if("relation"===t.type)null===(i=t.relationComponentTypeIds)||void 0===i||i.forEach((t=>{const i=null===n||void 0===n?void 0:n[t];i&&Object.entries(i.attributes).forEach((([t,n])=>{o.set(`populate[${e}][populate][${t}][populate]`,"*"),n.type}))})),o.set(`populate[${e}][populate]`,"*");else if("array"===t.type){var r;o.set(`populate[${e}][populate]`,"*"),null!==(r=t.itemsMultipleTypeIds)&&void 0!==r&&r.length&&t.itemsMultipleTypeIds.forEach((t=>{const i=null===n||void 0===n?void 0:n[t];i&&Object.entries(i.attributes).forEach((([t,n])=>{"relation"===n.type&&o.set(`populate[${e}][populate][${t}][populate]`,"*")}))}))}else"media"===t.type&&o.set(`populate[${e}][populate]`,"*")})(e,n,o,t)})),o}},399295:function(e,t,o){"use strict";o.d(t,{o:function(){return n}});const n={id:{wordpressKey:"include",type:"number"},slug:{wordpressKey:"slug",type:"string"},status:{wordpressKey:"status",type:"string"}}},52718:function(e,t,o){"use strict";o.d(t,{x:function(){return i},g:function(){return s}});var n=o(830195);let i;!function(e){e.NONE="None",e.APPLICATION_PASSWORD="Application Password",e.BASIC="Basic",e.JWT="JWT"}(i||(i={}));const r=n.z.lazy((()=>n.z.object({type:n.z.union([n.z.string(),n.z.array(n.z.string())]),description:n.z.string().optional(),properties:n.z.union([n.z.record(n.z.string(),r).optional(),n.z.array(r)]),readonly:n.z.boolean().optional(),required:n.z.boolean().optional()}))),s=n.z.object({title:n.z.string(),type:n.z.string(),properties:n.z.record(n.z.string(),r)})},300457:function(e,t,o){"use strict";o.d(t,{PN:function(){return r},$8:function(){return s},iv:function(){return a},zh:function(){return c}});var n=o(237584),i=o(399295);const r=e=>{var t;if(!Array.isArray(e))throw new Error("Sort attribute is not of type array");if(e.length>1)throw new Error("Only one sort attribute is supported in wordpress");const o=e[0];return{orderby:o.attrName,order:"descending"===(null===(t=o.order)||void 0===t?void 0:t.toLowerCase())?"desc":"asc"}},s=e=>{var t;if("dynamic"===e.type)throw new Error("dynamic values for sort not handled yet");if(!Array.isArray(e.content))throw new Error("Sort attribute is not of type array");if(e.content.length>1)throw new Error("Only one sort attribute is supported in wordpress");const o=e.content[0];return{orderby:o.attrName,order:"descending"===(null===(t=o.order)||void 0===t?void 0:t.toLowerCase())?"desc":"asc"}},a=e=>{if(!Array.isArray(e))throw new Error("Filter attribute is not of type array");const t=e.reduce(((e,t)=>{const{path:o,value:n}=t,i="content"in o[0]?o[0].content.toString():o[0].contentTypeName;return e[i]?e[i].push(n):e[i]=[n],e}),{});return Object.keys(t).reduce(((e,o)=>{const n=i.o[o].wordpressKey;if(!n)throw new Error("Tried to filter by an attribute that is not allowed");return e[n]=t[o],e}),{})},c=(e,t)=>{if(!Array.isArray(e.content))throw new Error("Filter attribute is not of type array");const o=(e.content||[]).reduce(((e,o)=>{const{value:i,path:r}=o,s="content"in r[0]?r[0].content.toString():r[0].contentTypeName;return e[s],e[s]=(0,n.aD)(i,t),e}),{});return Object.keys(o).reduce(((e,t)=>{const n=i.o[t].wordpressKey;if(!n)throw new Error("Tried to filter by an attribute that is not allowed");return e[n]=o[t],e}),{})}},354163:function(e,t,o){"use strict";o.d(t,{Dw:function(){return l},ui:function(){return d},DN:function(){return p},KT:function(){return u},pi:function(){return h},tn:function(){return m},dz:function(){return y},L7:function(){return g}});var n=o(138640),i=o(830195),r=o(415066),s=o(686646),a=o(189603),c=o(263108);const l=(e,t)=>{const o=e();if(!o)throw new Error("Could not find parent node with context id");const n=o||(null!==t&&void 0!==t?t:"remoteData");return(0,a.cx)(n)};function d(e,t,o){if(e instanceof i.jm)throw t.captureException(`There was a problem reading the ${o} data from the CMS: ${(0,n.CC)(e).message}`,{type:r.U.CRITICAL}),new s.ZN(`There was a problem reading the ${o} data from the CMS. Please contact us.`);if(t.captureException(e),e instanceof Error)throw new s.ZN(e.message)}const p=e=>e.sort(((e,t)=>{const o=e.id,n=t.id;return"string"===typeof o&&"string"===typeof n?o.localeCompare(n):e.id-t.id})),u=e=>{const{page:t,usedContentTypes:o}=e;if(!("contentType"in t)||!t.contentType)throw new Error(`Page ${t.id} is not a CMS page because it does not have a contentType.`);return o[t.contentType]},h=(e,t)=>{var o,n;const i=e.cmsPages.byId[t];if(!i)throw new Error(`Could not find CMS page: ${t}`);if(!i.mainNodeId)throw new Error(`Could not find root node for page: ${t}`);if("cms-listing-page"!==i.type)return null;const r=e.nodes.getById(i.mainNodeId);if(!r)throw new Error(`Could not find main node for page: ${t}`);return"cms-collection-list-node"===r.type&&null!==(o=r.attrs)&&void 0!==o&&null!==(n=o.perPage)&&void 0!==n&&n.content?parseInt(r.attrs.perPage.content):10},m=(e,t)=>{if("dynamic"===e.type)throw new Error("unuspported (yet) dynamic value for property");if("string"!==typeof e.content)throw new Error("unuspported (yet) complex static value for property");return t?t(e.content):e.content},y=(e,t,o)=>{var n;return(null===o||void 0===o?void 0:o.type)===t?o.contentTypeName||(null===(n=e[o.contentType])||void 0===n?void 0:n.name)||"Invalid source":""},g=e=>{const t=e.trim().replace(/\s/g,"");return c.removeIllegalCharacters(t)}},237584:function(e,t,o){"use strict";o.d(t,{rk:function(){return r},aD:function(){return s},Sy:function(){return a},CR:function(){return c},Ze:function(){return h}});var n=o(354163),i=o(189603);const r=(e,t=[],o,n)=>{if(!e.html||"static"===e.html.type)throw new Error("Could not generate node expression for cms rich text node");const{refPath:r=[],fallbackValue:s}=e.html.content;let a=(null===t||void 0===t?void 0:t.length)>0&&null!==t&&void 0!==t&&t[0]?[...t,...r]:r;if("dynamic"===e.html.type){const{referenceType:t}=e.html.content;var c;if("state"===t)throw new Error(`State reference type is not supported for CMS rich text node for state ${null===n||void 0===n||null===(c=n[e.html.content.id])||void 0===c?void 0:c.id}`);if("prop"===t){const t=(0,i.bC)(o,e.html.content.id);if(!t)throw new Error(`Could not find prop name for id ${e.html.content.id}`);a=[`props?.${t}`,...a];const n=(0,i.hm)(s);return{type:"expr",content:`${a.join("?.")}${n?` || ${n}`:""}`}}}const l=(0,i.hm)(s);return{type:"expr",content:`${a.join("?.")}${l?` || ${l}`:""}`}},s=(e,t)=>"static"===e.type?{type:"static",content:e.content.toString()}:function(e,t){if("ctx"===e.content.referenceType){var o;if(!e.content.ctxId)throw new Error("Ctx reference type must have a ctxId");return{type:"expr",content:`${t.getCMSIdentifier(e.content.ctxId)}?.${(null===(o=e.content.refPath)||void 0===o?void 0:o.join("?."))||""}`}}const n=e.content.id,{propDefinitions:i,stateDefinitions:r}=t;var s;return"state"===e.content.referenceType?{type:"dynamic",content:{referenceType:"state",id:(null===r||void 0===r||null===(s=r[n])||void 0===s?void 0:s.name)||""}}:{type:"dynamic",content:{id:`${null===i||void 0===i?void 0:i[n].name}`,referenceType:"prop"}}}(e,t),a=e=>{const{attrName:t,attribute:o,defaultValue:r}=e,s={},a={};if(!o)return r?(a[t]={type:"dynamic",content:{referenceType:"prop",id:t}},s[t]={type:"static",content:r},{paramsForFetcher:a,paramsToSendToFetcher:s}):{paramsForFetcher:a,paramsToSendToFetcher:s};a[t]={type:"dynamic",content:{referenceType:"prop",id:t}};const{staticValueTransform:c=l}=e;if("static"===o.type)return s[t]={type:"expr",content:(0,n.tn)(o,c)},{paramsForFetcher:a,paramsToSendToFetcher:s};const{dynamicValue:p}=u(o,e)||{},{dynamicValueTransform:h=d}=e,m=`${h(p)}`,y=(0,i.hm)(o.content.fallbackValue);return s[t]={type:"expr",content:`${m}${y?` || ${y}`:""}`},{paramsForFetcher:a,paramsToSendToFetcher:s}},c=e=>{const{attrName:t,attribute:o,defaultValue:r}=e,s={},a={};if(!o)return r?(a[t]={type:"static",content:r},{paramsForFetcher:a,paramsToSendToFetcher:s}):{paramsForFetcher:a,paramsToSendToFetcher:s};const{staticValueTransform:c=l}=e;if("static"===o.type)return a[t]={type:"static",content:(0,n.tn)(o,c)},{paramsForFetcher:a,paramsToSendToFetcher:s};const{type:h,dynamicValue:m,defaultValue:y}=u(o,e);a[t]={type:"dynamic",content:{referenceType:"state"===h?"state":"prop",id:t}};const{dynamicValueTransform:g=d}=e,f=(null===r||void 0===r?void 0:r.toString())||y,b=(0,i.hm)(o.content.fallbackValue),{toSendToFetcherExpressionBuilder:I=p}=e,v=I(g(m),b?b.toString():f?c(f,!0):"");return s[t]={type:"expr",content:v},{paramsForFetcher:a,paramsToSendToFetcher:s}},l=e=>{const t=Number(e);return isNaN(t)?`"${e}"`:parseInt(e,10)},d=e=>e,p=(e,t)=>`${e}${t?" || "+("string"===typeof t?`'${t}'`:`${t}`):""}`;function u(e,t){if("ctx"===e.content.referenceType){var o;if(!e.content.ctxId)throw new Error("Ctx reference type must have a ctxId");return{type:"ctx",dynamicValue:`${t.getCMSIdentifier(e.content.ctxId)}?.${(null===(o=e.content.refPath)||void 0===o?void 0:o.join("?."))||""}`}}const n=e.content.id,{propDefinitions:i,stateDefinitions:r}=t;var s;return"state"===e.content.referenceType?{type:"state",dynamicValue:(null===r||void 0===r||null===(s=r[n])||void 0===s?void 0:s.name)||""}:{type:"props",dynamicValue:`props['${null===i||void 0===i?void 0:i[n].name}']`,defaultValue:h(null===i||void 0===i?void 0:i[n].defaultValue)}}function h(e){return e?["array","object"].includes(typeof e)?JSON.stringify(e):e.toString():""}},250542:function(e,t,o){"use strict";o.d(t,{b:function(){return s}});var n=o(676422),i=o.n(n),r=o(552322);const s=e=>{const{title:t,selections:o}=e;return(0,r.jsxs)("div",{title:t,className:"jsx-449592994 file-selection-root",children:[o.map(((e,t)=>(0,r.jsx)("div",{style:{backgroundColor:null===e||void 0===e?void 0:e.color},className:"jsx-449592994 selection-item"},t))),(0,r.jsx)(i(),{id:"449592994",children:[".file-selection-root.jsx-449592994{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;max-height:25px;width:30px;}",".selection-item.jsx-449592994{height:7px;width:7px;border-radius:50%;}"]})]})}},42781:function(e,t,o){"use strict";o.d(t,{a:function(){return z}});var n=o(777460),i=o(676422),r=o.n(i),s=o(202784),a=o(5220),c=o(505892),l=o(21023),d=o(781872),p=o(246183),u=o(983331),h=o(774468),m=o(414326),y=o(258298),g=o(90895),f=o(250542),b=o(552322);const I=e=>{const{fileSelections:t,path:o,isFolderPath:n=!1}=e,i=t.map(((e,t)=>{var n;if(!(-1!==(null===(n=e.selectedFile)||void 0===n?void 0:n.indexOf(o))))return null;const i=t++%g.q.length;return{selection:e,color:g.q[i]}})).filter(Boolean),r=n?"folder":"file",s=`${i.length} active ${1===i.length?"user":"users"} inside this ${r}`;return(0,b.jsx)(f.b,{title:s,selections:i})},v=[".item-root.jsx-1481424000{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-left:4px;}",".file-details.jsx-1481424000{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}",".icon-name-wrapper.jsx-1481424000{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}",".file-name-wrapper.jsx-1481424000{margin-left:6px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}",".collaborators-selection.jsx-1481424000{width:30px;}",".lock-icon.jsx-1481424000{display:inline-block;margin-left:4px;}",".file-status-wrapper.jsx-1481424000{line-height:1.7;margin-left:2px;}",`.hover-action-item.jsx-1481424000{border-radius:${d.n_.DEFAULT};padding:0 6px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.hover-action-item.jsx-1481424000:hover{background-color:${d.DM.GRAY_400};}`,`.code-file-item:hover{border-color:transparent !important;color:${d.DM.GRAY_800} !important;}`];v.__hash="1481424000";var w=o(333408);const N=e=>{const t=`file-type/${e}`;return Object.values(m.Tv).includes(t)?t:"custom-files/file"},j=e=>{const{files:t,path:o,selectedFilePath:n,selectedFolder:i,fileDragInProgress:a,pathUnderRename:p,collaboratorsSelectedFiles:m,hoverAction:g,onRename:f}=e,{0:j,1:S}=(0,s.useState)(""),D=e=>{if(!e.status)return null;switch(e.status){case w.E.ADDED:return(0,b.jsxs)("span",{style:{color:d.DM.SUCCESS},title:"Added",children:["A"," "]});case w.E.NEW:return(0,b.jsxs)("span",{style:{color:d.DM.SUCCESS},title:"Untracked",children:[" ","U"]});case w.E.MODIFIED:return(0,b.jsxs)("span",{style:{color:d.DM.WARNING_DARK},title:"Modified",children:["M"," "]});case w.E.REMOVED:return(0,b.jsxs)("span",{style:{color:d.DM.DANGER_LIGHT},title:"Deleted",children:["D"," "]});case w.E.STAGED:return null;case w.E.RENAMED:return(0,b.jsxs)("span",{style:{color:d.DM.WARNING_DARK},title:"Renamed",children:["R"," "]});case w.E.CONFLICT:return(0,b.jsx)(c.J,{type:"custom-code/danger",size:16,color:d.DM.WARNING_DARK});case w.E.RESOLVED:return(0,b.jsx)(c.J,{type:"checkmark",size:16,color:d.DM.SUCCESS})}};return(0,b.jsx)(b.Fragment,{children:t.sort(((e,t)=>e.name.localeCompare(t.name))).map(((t,s)=>((t,s)=>{const d=`${t.name}.${t.fileType}`,T=(0,l.join)(o,d),O=!!g&&(j===T||T===n);return e.searchWord&&!t.name.includes(e.searchWord)?null:(0,b.jsxs)("div",{"data-file-id":T,className:`jsx-${v.__hash} item-root`,children:[(0,b.jsx)(u.p,{className:a?"code-file-item":"",selected:n===T&&""===i,itemId:T,dataAttrs:{"data-file-type":t.fileType,"data-drag-file-id":T},displayChecked:!1,refAttrs:{style:{paddingLeft:4,height:28,width:"calc(100% - 30px)"}},onMouseEnter:()=>S(T),onMouseLeave:()=>S(""),children:(0,b.jsxs)("div",{className:`jsx-${v.__hash} file-details`,children:[(0,b.jsxs)("div",{style:{width:t.status?O?"calc(100% - 40px)":"calc(100% - 12px)":"100%"},className:`jsx-${v.__hash} icon-name-wrapper`,children:[h.n1.includes(t.fileType)&&t.content?(0,b.jsx)("img",{loading:"lazy",src:t.content,alt:"playground_asset",width:20,height:20,onError:({currentTarget:e})=>{e.src=h.i$},style:{objectFit:"cover"},className:`jsx-${v.__hash}`}):h.kN.includes(t.fileType)&&t.content?(0,b.jsx)("video",{src:t.content,width:20,height:20,className:`jsx-${v.__hash}`}):(0,b.jsx)(c.J,{type:N(t.fileType),size:14}),(0,b.jsx)("span",{title:d,className:`jsx-${v.__hash} file-name-wrapper`,children:p===T?(0,b.jsx)(y.E,{className:"code-editor-sidebar-input",id:T,initialValue:d||"",selectOnFocus:!0,inputSize:"sm",onConfirmChange:f}):(0,b.jsx)("span",{style:(null===t||void 0===t?void 0:t.status)===w.E.REMOVED?{textDecoration:"line-through"}:{},className:`jsx-${v.__hash}`,children:d})}),t.isProtected?(0,b.jsx)("span",{className:`jsx-${v.__hash} lock-icon`,children:(0,b.jsx)(c.J,{type:"lock",size:8})}):null]}),O?(0,b.jsx)("div",{"data-tooltip-name":null===g||void 0===g?void 0:g.title,"data-tooltip-direction":"vertical",onClick:e=>{e.stopPropagation(),null===g||void 0===g||g.action(T)},className:`jsx-${v.__hash} hover-action-item`,children:g?(0,b.jsx)(c.J,{type:null===g||void 0===g?void 0:g.icon,size:12}):null}):null,(0,b.jsx)("div",{className:`jsx-${v.__hash} file-status-wrapper`,children:D(t)})]})}),(0,b.jsx)("div",{className:`jsx-${v.__hash} collaborators-selection`,children:(0,b.jsx)(I,{path:T,fileSelections:m})}),(0,b.jsx)(r(),{id:v.__hash,children:v})]},s)})(t,s)))})};var S,D,T,O,F,C,E=o(503348),x=o(889371),_=o(735468),M=o(918437),P=o(302503),A=o(395942),k=o(492080),U=o(704614);let R=(S=(0,P.inject)("projectUIState"),D=(0,P.inject)("projectDoc"),C=new WeakMap,T=class extends s.Component{constructor(...e){super(...e),(0,E.Z)(this,"projectUIState",O,this),(0,E.Z)(this,"projectDoc",F,this),C.set(this,{writable:!0,value:[]}),(0,n.Z)(this,"state",{acceptedDropTarget:null,dragInProgress:!1,overForbiddenFolder:!1}),(0,n.Z)(this,"resetState",(()=>{this.setState({acceptedDropTarget:null,dragInProgress:!1,overForbiddenFolder:!1})}))}componentDidMount(){const e=(0,A.select)(this.projectUIState,["drag/draggedEntity","dropFlowStates/folder/**"],(e=>{const t=e.dropFlowStates.folder.acceptedDropTarget,o=null===t||void 0===t?void 0:t.dataset.folderId,n=-1!==(null===o||void 0===o?void 0:o.indexOf(k.Xh)),i=-1!==(null===o||void 0===o?void 0:o.indexOf(k.Wn));if(!o)return;const r=e.drag.draggedEntity;if((null===r||void 0===r?void 0:r.type)!==U.Z.FILE||r.content.draggingForbidden)return void this.resetState();const s=r.content.filePath.split("/");s.pop(),o!==s.join("/")?this.setState({acceptedDropTarget:t,dragInProgress:!!r,overForbiddenFolder:n||i}):this.resetState()}),"ColorTokenDropIndicatorWrapper");(0,_.Z)(this,C).push((()=>{e.dispose()}))}componentWillUnmount(){(0,_.Z)(this,C).forEach((e=>e())),(0,x.Z)(this,C,[])}render(){const{folderId:e}=this.props,{acceptedDropTarget:t,overForbiddenFolder:o}=this.state;return t&&t.dataset.folderId===e?(0,b.jsx)("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,border:o?"none":`1px solid ${d.DM.ACCENT_500}`,background:o?"":"rgba(194, 240, 255, 0.1)",cursor:o?"not-allowed":"default"}}):null}},O=(0,M.Z)(T.prototype,"projectUIState",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=(0,M.Z)(T.prototype,"projectDoc",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T);const Z=[".thq-select-list-item.jsx-2015160481{padding-right:8px;}",".code-folder.jsx-2015160481{padding:0 !important;line-height:26px;width:100%;}",`.folder-name-root.jsx-2015160481{height:25px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:calc(100% - 30px);border-radius:${d.n_.DEFAULT};border:1px solid transparent;padding-left:4px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.folder-name-root.selected.jsx-2015160481{color:${d.DM.GRAY_1000};background-color:${d.DM.GRAY_300};}`,`.folder-name-root.jsx-2015160481:hover{border:1px solid ${d.DM.GRAY_500};color:${d.DM.GRAY_1000};}`,`.sidebar-title.jsx-2015160481{font-size:${d.um.HEADING};color:${d.DM.GRAY_1000};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:8px 8px 8px 12px;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;font-weight:${d.Xw.MEDIUM_500};}`,`.right-addon.jsx-2015160481{font-size:${d.um.DEFAULT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:10px;}`,".expand-icon.jsx-2015160481{-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg);margin-right:4px;}",".folder-name-root.jsx-2015160481>.expand-icon.jsx-2015160481{line-height:10px;}",`.expanded.jsx-2015160481{-webkit-transition:${d.OK.MOVE};transition:${d.OK.MOVE};-webkit-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}`,".code-editor-sidebar-input{padding-left:0 !important;}"];Z.__hash="2015160481";var L=o(892170),$=o(173541),B=o(332139);function G(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function H(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?G(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):G(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const z=e=>{var t,o;const{files:n,path:i,selectedFilePath:u,selectedFolder:h,pathUnderRename:m,expandedFolders:g={},sidebarTitle:f,collaboratorsSelectedFiles:v,handleRootContextMenu:w,actions:N,meta:S,hoverAction:D}=e,{isRoot:T=!0,fileDragInProgress:O,autoExpandToSelectedFile:F=!1,rootSectionName:C="main",handleFolderExpand:E=!1,canCollapseAll:x}=S,{selectFile:_,onFolderContextMenu:M,onFileContextMenu:P,onAssetsContextMenu:A,onRename:k,expandFolder:U,setPathUnderRename:G,setSelectedFolder:Y,setCanCollapseAll:V}=N,{0:W,1:K}=(0,s.useState)(null===(t=e.meta.rootExpanded)||void 0===t||t),{0:q,1:J}=(0,s.useState)(!!E||(!!T||g[i])),{0:X,1:Q}=(0,s.useState)(!1),{0:ee,1:te}=(0,s.useState)("");(0,s.useEffect)((()=>{var t,o;K(null===(t=null===(o=e.meta)||void 0===o?void 0:o.rootExpanded)||void 0===t||t)}),[e.meta.rootExpanded]),(0,s.useEffect)((()=>{J(!!E||(!!T||!!g[i]))}),[g]),(0,s.useEffect)((()=>{e.searchWord&&J(!0)}),[e.searchWord]),(0,s.useEffect)((()=>{F&&u&&i&&0===u.indexOf(`${i}/`)&&(U&&U(i,!0),i.indexOf("/")>-1&&V&&V(!0))}),[F,u,i]),(0,s.useEffect)((()=>{E&&J(!0)}),[E]);const oe=(e,t)=>{t.forEach((t=>{const o=`${e}/${t.name}`;U&&U(o,!0),oe(o,t.subFolders)}))},ne=(0,s.useCallback)((()=>{if(m)return;const e=Object.keys(g).filter((e=>{if(g[e]&&2===e.split("/").length)return!0}));1===e.length&&e[0]===i?V&&V(!1):V&&V(!0),E?J(!q):U&&U(i,!q)}),[q,g,E,i,m]),ie=(0,s.useCallback)((()=>{i&&Y&&Y(i)}),[i]),re=e=>{te(e)};return(0,b.jsxs)("div",H(H(H({style:H({position:"relative"},T?{height:"100%"}:{}),"data-folder-id":i},T?{"data-project-files":C}:{}),T&&w?{onContextMenu:w}:{}),{},{className:`jsx-${Z.__hash} jsx-${L.W.__hash} jsx-${p.W.__hash}`,children:[(0,b.jsx)(R,{folderId:i}),T&&!!f&&(0,b.jsxs)("div",{className:`jsx-${Z.__hash} jsx-${L.W.__hash} jsx-${p.W.__hash} sidebar-title`,children:[(0,b.jsx)("span",{className:`jsx-${Z.__hash} jsx-${L.W.__hash} jsx-${p.W.__hash}`,children:f}),(0,b.jsxs)("div",{className:`jsx-${Z.__hash} jsx-${L.W.__hash} jsx-${p.W.__hash} right-addon`,children:[X?(0,b.jsx)(B.M,{id:"layers-search",onType:re}):(0,b.jsx)(b.Fragment,{children:(0,b.jsx)($.z,{title:"Search",style:"transparent",shape:"square",colorScheme:"neutral",onClick:()=>{X&&re(""),Q(!X)},children:(0,b.jsx)(c.J,{type:"search",size:12})})}),"Explorer"===f&&(0,b.jsx)($.z,{title:x?"Collapse Folders":"Expand Folders",style:"transparent",shape:"square",colorScheme:"neutral",onClick:()=>((e=!0)=>{n&&(e?oe("teleport-project-react",n.subFolders):Object.keys(g).forEach((e=>{U&&U(e,!1)})),V&&V(e))})(!x),children:(0,b.jsx)(c.J,{type:x?"dev-mode/collapse":"dev-mode/expand",size:12})})]})]}),!T&&(0,b.jsxs)("div",{onClick:e=>{e.stopPropagation(),ne()},onContextMenu:e=>{if(e.preventDefault(),i.includes("playground_assets"))return e.stopPropagation(),void(A&&A(e));M&&M(i,e)},className:`jsx-${Z.__hash} jsx-${L.W.__hash} jsx-${p.W.__hash} folder-header code-folder`,children:[(0,b.jsxs)("div",{onClick:ie,className:`jsx-${Z.__hash} jsx-${L.W.__hash} jsx-${p.W.__hash} folder-name-root`+(h===i?" selected":""),children:[(0,b.jsx)("div",{className:`jsx-${Z.__hash} jsx-${L.W.__hash} jsx-${p.W.__hash} expand-icon `+(q?"expanded":""),children:(0,b.jsx)(c.J,{type:"expand",size:12})}),(0,b.jsx)("div",{className:`jsx-${Z.__hash} jsx-${L.W.__hash} jsx-${p.W.__hash} folder-icon`,children:(0,b.jsx)(c.J,{type:q?"folder-open":"folder",size:16,color:d.DM.GRAY_700})}),m===i?(0,b.jsx)(y.E,{id:i,className:"code-editor-sidebar-input",initialValue:(null===n||void 0===n?void 0:n.name)||"",selectOnFocus:!0,inputSize:"sm",onConfirmChange:(e,t)=>{k&&k(e,t,!0)}}):(0,b.jsx)(b.Fragment,{children:null===n||void 0===n?void 0:n.name})]}),!q&&(0,b.jsx)(I,{isFolderPath:!0,path:i,fileSelections:v})]}),(0,b.jsx)("div",{style:{paddingLeft:T?11:12,display:q&&null!==n&&void 0!==n&&n.files&&W?"block":"none"},className:`jsx-${Z.__hash} jsx-${L.W.__hash} jsx-${p.W.__hash}`,children:(0,b.jsxs)(a.E,{onSelect:(e,t)=>{t&&(t.stopPropagation(),_(e),Y&&Y(""))},dataAttrs:{"item-type":"page"},noPadding:!0,onContextMenu:(e,t)=>{t.preventDefault(),P&&P(e,t)},onDoubleClick:G,children:[(0,b.jsx)(b.Fragment,{children:null===n||void 0===n||null===(o=n.subFolders)||void 0===o?void 0:o.map(((t,o)=>(0,b.jsx)(z,{files:t,searchWord:ee||e.searchWord,pathUnderRename:m,expandedFolders:g,selectedFilePath:u,selectedFolder:h,collaboratorsSelectedFiles:v,path:(0,l.join)(i,t.name),meta:H(H({},S),{},{rootExpanded:W,isRoot:!1}),actions:N,hoverAction:D},o)))}),(0,b.jsx)(j,{files:(null===n||void 0===n?void 0:n.files)||[],path:i,searchWord:ee||e.searchWord,selectedFilePath:u,selectedFolder:h,pathUnderRename:m,collaboratorsSelectedFiles:v,onRename:(e,t)=>{k&&k(e,t,!1)},fileDragInProgress:O,hoverAction:D})]})}),(0,b.jsx)(r(),{id:Z.__hash,children:Z}),(0,b.jsx)(r(),{id:L.W.__hash,children:L.W}),(0,b.jsx)(r(),{id:p.W.__hash,children:p.W})]}))}},892170:function(e,t,o){"use strict";o.d(t,{W:function(){return i}});var n=o(781872);const i=[".expand-icon.jsx-2689011778{-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg);margin-right:4px;height:12px;}",`.expanded.jsx-2689011778{-webkit-transition:${n.OK.MOVE};transition:${n.OK.MOVE};-webkit-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}`];i.__hash="2689011778"},138743:function(e,t,o){"use strict";o.d(t,{N:function(){return u},p:function(){return h}});var n=o(777460),i=o(676422),r=o.n(i),s=(o(202784),o(781872)),a=o(505892),c=o(376897),l=o(552322);function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const u=e=>Object.keys(e||{}).reduce(((t,o)=>{const n=e[o];return"string"!==typeof n&&"number"!==typeof n||(t[o]=n),t}),{}),h=({tokenInfo:e,tokenCategory:t,onDelete:o,onClick:n,onContextMenu:i})=>{var d,h,m,y,g,f,b,I;const{id:v,content:w,name:N,role:j}=e,S=`${null!==(d=null===(h=w.fontSize)||void 0===h?void 0:h.content)&&void 0!==d?d:""}\n${null!==(m=null===(y=w.fontFamily)||void 0===y?void 0:y.content)&&void 0!==m?m:""} ${null!==(g=null===(f=w.fontWeight)||void 0===f?void 0:f.content)&&void 0!==g?g:""} ${null!==(b=null===(I=w.fontStyle)||void 0===I?void 0:I.content)&&void 0!==b?b:""}`;return(0,l.jsxs)("div",{"data-token-id":v,onClick:()=>n(t.id,v),onContextMenu:i,"data-tooltip-name":j?N:null,className:r().dynamic([["3989544770",[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500]]])+" token-preview-wrapper",children:[(0,l.jsxs)("div",{style:{display:"flex"},className:r().dynamic([["3989544770",[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500]]]),children:[(0,l.jsx)("div",{style:p(p({},u(w)),{},{fontSize:"14px",letterSpacing:"normal",color:`${s.DM.GRAY_700}`}),className:r().dynamic([["3989544770",[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500]]])+" preview",children:"Aa"}),(0,l.jsxs)("div",{className:r().dynamic([["3989544770",[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500]]])+" token-info-container",children:[(0,l.jsxs)("div",{className:r().dynamic([["3989544770",[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500]]])+" token-name-role",children:[(0,l.jsx)("span",{className:r().dynamic([["3989544770",[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500]]])+" token-name",children:N})," ",j&&(0,l.jsx)("span",{className:r().dynamic([["3989544770",[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500]]])+" token-role",children:j})]}),(0,l.jsx)("span",{className:r().dynamic([["3989544770",[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500]]])+" token-meta",children:S})]})]}),(0,l.jsx)(c._,{name:N,children:(0,l.jsx)("div",{className:r().dynamic([["3989544770",[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500]]])+" default-text-style-tooltip",children:"The default text style will be applied to all the text elements in your project."})}),!j&&(0,l.jsx)("button",{onClick:e=>((e,t)=>{e.stopPropagation(),o(t)})(e,v),className:r().dynamic([["3989544770",[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500]]])+" delete-btn",children:(0,l.jsx)(a.J,{type:"actions/close",size:12,color:s.DM.GRAY_1000})}),(0,l.jsx)(r(),{id:"3989544770",dynamic:[s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO,s.um.INFO,s.DM.GRAY_800,s.N_.UNIT,s.n_.DEFAULT,s.DM.GRAY_300,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.Xw.MEDIUM_500],children:[".token-preview-wrapper.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;position:relative;}",".token-preview-wrapper.__jsx-style-dynamic-selector:hover .delete-btn.__jsx-style-dynamic-selector{opacity:1;}",".token-preview-wrapper.__jsx-style-dynamic-selector:hover .token-meta.__jsx-style-dynamic-selector{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;}",".token-info-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:relative;}",".token-name-role.__jsx-style-dynamic-selector{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}",`.token-name.__jsx-style-dynamic-selector{font-size:${s.um.DEFAULT};max-width:150px;text-overflow:ellipsis;overflow:hidden;}`,`.token-role.__jsx-style-dynamic-selector{padding:0 ${s.N_.UNIT};background-color:${s.DM.GRAY_400};border-radius:${s.n_.DEFAULT};margin-left:${s.N_.UNIT};font-size:${s.um.INFO};height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;text-transform:capitalize;}`,`.token-meta.__jsx-style-dynamic-selector{display:none;font-size:${s.um.INFO};font-style:italic;color:${s.DM.GRAY_800};position:absolute;bottom:-${s.N_.UNIT};white-space:nowrap;}`,`.delete-btn.__jsx-style-dynamic-selector{background:transparent;width:24px;height:24px;border-radius:${s.n_.DEFAULT};opacity:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`,`.delete-btn.__jsx-style-dynamic-selector:hover,.delete-btn.__jsx-style-dynamic-selector:focus{background-color:${s.DM.GRAY_300};box-shadow:4px 4px 8px 1px rgba(18,18,18,0.5);}`,`.preview.__jsx-style-dynamic-selector{border:1px solid ${s.DM.GRAY_500};border-radius:${s.n_.DEFAULT};padding:${s.N_.UNIT};margin-right:${s.N_.TWO_UNITS};width:32px;height:32px;text-align:center;text-transform:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`,`.default-text-style-tooltip.__jsx-style-dynamic-selector{font-weight:${s.Xw.MEDIUM_500};}`]})]},v)}},246183:function(e,t,o){"use strict";o.d(t,{W:function(){return i},H:function(){return r}});var n=o(781872);const i=[`.folder-header.jsx-237766277{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-weight:${n.Xw.MEDIUM_500};padding:0 ${n.N_.TWO_UNITS};height:26px;color:${n.DM.GRAY_800};font-size:${n.um.DEFAULT};cursor:pointer;border-radius:4px;width:100%;}`,`.folder-header.jsx-237766277:hover{color:${n.DM.GRAY_1000};}`,`.folder-header.jsx-237766277 *.jsx-237766277{margin-right:${n.N_.HALF_UNIT};}`,`.folder-header.jsx-237766277 .folder-icon.jsx-237766277{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:${n.N_.UNIT};}`,`.folder-header.jsx-237766277>span.jsx-237766277{font-weight:${n.Xw.REGULAR_400};color:${n.DM.GRAY_900};}`,".expand-icon.jsx-237766277{height:12px;-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg);}",`.expanded.jsx-237766277{-webkit-transition:${n.OK.MOVE};transition:${n.OK.MOVE};-webkit-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}`,`.empty.jsx-237766277{opacity:0;-webkit-transition:${n.OK.MOVE};transition:${n.OK.MOVE};}`,`.folder-header.selected.jsx-237766277{background-color:${n.DM.ACCENT_200};color:${n.DM.GRAY_1000};}`,`.folder-header.jsx-237766277:hover .folder-title.jsx-237766277{color:${n.DM.GRAY_1000};}`];i.__hash="237766277";const r=[`.gutter-row.jsx-2671980815{grid-column:1/-1;cursor:row-resize;grid-row:2;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:5px;-webkit-transition:0.4s all;transition:0.4s all;z-index:10;border-top:1px solid ${n.DM.GRAY_400};}`,`.gutter-row.jsx-2671980815:hover,.gutter-row.jsx-2671980815:active{background-color:${n.DM.ACCENT_500};}`];r.__hash="2671980815"},316246:function(e,t,o){"use strict";o.d(t,{I:function(){return a}});var n=o(676422),i=o.n(n),r=o(781872),s=o(552322);const a=e=>{const{domainPublishStatus:t}=e;return(0,s.jsxs)("div",{className:i().dynamic([["556627367",[r.N_.HALF_UNIT,r.N_.UNIT,r.N_.UNIT,r.DM.SUCCESS,r.DM.DANGER_DARK]]])+" deployment-status-wrapper",children:[(0,s.jsx)("span",{className:i().dynamic([["556627367",[r.N_.HALF_UNIT,r.N_.UNIT,r.N_.UNIT,r.DM.SUCCESS,r.DM.DANGER_DARK]]])+" "+`circle ${t}`}),(0,s.jsx)("span",{className:i().dynamic([["556627367",[r.N_.HALF_UNIT,r.N_.UNIT,r.N_.UNIT,r.DM.SUCCESS,r.DM.DANGER_DARK]]])+" publish-status",children:t.toLowerCase()}),(0,s.jsx)(i(),{id:"556627367",dynamic:[r.N_.HALF_UNIT,r.N_.UNIT,r.N_.UNIT,r.DM.SUCCESS,r.DM.DANGER_DARK],children:[`.deployment-status-wrapper.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:${r.N_.HALF_UNIT};cursor:default;}`,".publish-status.__jsx-style-dynamic-selector{white-space:nowrap;text-transform:capitalize;}",`.circle.__jsx-style-dynamic-selector{height:${r.N_.UNIT};width:${r.N_.UNIT};border-radius:50%;}`,`.circle.READY.__jsx-style-dynamic-selector,.circle.ENABLED.__jsx-style-dynamic-selector{background-color:${r.DM.SUCCESS};}`,`.circle.ERROR.__jsx-style-dynamic-selector{background-color:${r.DM.DANGER_DARK};}`,".circle.BUILDING.__jsx-style-dynamic-selector,.circle.QUEUED.__jsx-style-dynamic-selector{background-color:orange;}"]})]})}},774296:function(e,t,o){"use strict";o.d(t,{W:function(){return c}});var n=o(676422),i=o.n(n),r=o(721403),s=o(781872),a=(o(202784),o(552322));const c=e=>(0,a.jsxs)("div",{className:i().dynamic([["672991690",[s.Xw.REGULAR_400,s.DM.GRAY_300,s.N_.UNIT,s.N_.UNIT,s.um.HEADING,s.N_.HALF_UNIT,s.um.DEFAULT,s.DM.GRAY_700]]])+" publish-section-header",children:[(0,a.jsxs)("div",{className:i().dynamic([["672991690",[s.Xw.REGULAR_400,s.DM.GRAY_300,s.N_.UNIT,s.N_.UNIT,s.um.HEADING,s.N_.HALF_UNIT,s.um.DEFAULT,s.DM.GRAY_700]]])+" header-title",children:[(0,a.jsx)("p",{className:i().dynamic([["672991690",[s.Xw.REGULAR_400,s.DM.GRAY_300,s.N_.UNIT,s.N_.UNIT,s.um.HEADING,s.N_.HALF_UNIT,s.um.DEFAULT,s.DM.GRAY_700]]]),children:e.title}),e.showPROLabel?(0,a.jsx)(r.b,{text:"PRO"}):null]}),(0,a.jsx)("p",{className:i().dynamic([["672991690",[s.Xw.REGULAR_400,s.DM.GRAY_300,s.N_.UNIT,s.N_.UNIT,s.um.HEADING,s.N_.HALF_UNIT,s.um.DEFAULT,s.DM.GRAY_700]]])+" header-subtitle",children:e.description}),(0,a.jsx)(i(),{id:"672991690",dynamic:[s.Xw.REGULAR_400,s.DM.GRAY_300,s.N_.UNIT,s.N_.UNIT,s.um.HEADING,s.N_.HALF_UNIT,s.um.DEFAULT,s.DM.GRAY_700],children:[`.publish-section-header.__jsx-style-dynamic-selector{font-weight:${s.Xw.REGULAR_400};width:100%;border-bottom:1px solid ${s.DM.GRAY_300};padding-bottom:${s.N_.UNIT};margin-bottom:${s.N_.UNIT};}`,`.header-title.__jsx-style-dynamic-selector{font-size:${s.um.HEADING};margin-bottom:${s.N_.HALF_UNIT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.header-subtitle.__jsx-style-dynamic-selector{font-size:${s.um.DEFAULT};color:${s.DM.GRAY_700};}`]})]})},483955:function(e,t,o){"use strict";o.d(t,{D:function(){return w},R:function(){return N}});var n=o(676422),i=o.n(n),r=o(505892),s=o(774296),a=o(399179),c=o(781872);const l=[`.deploy-row.jsx-4260151599{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;margin-bottom:${c.N_.TWO_UNITS};gap:${c.N_.UNIT};}`,`.deploy-link-details.jsx-4260151599{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:${c.N_.HALF_UNIT};}`,`.deploy-details.jsx-4260151599{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:${c.N_.UNIT};}`,".deploy-details-text.jsx-4260151599:hover .copy-icon.jsx-4260151599{display:block;}",".deploy-details-text-url.jsx-4260151599{width:260px;text-overflow:ellipsis;display:block;overflow:hidden;white-space:nowrap;}",`.deploy-details-date.jsx-4260151599{color:${c.DM.GRAY_700};font-size:${c.um.INFO};}`,".deploy-alias.jsx-4260151599{width:70px;text-transform:capitalize;}",".copy-icon.jsx-4260151599{display:none;height:16px;}",`.deploy-details-text.jsx-4260151599{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:${c.N_.HALF_UNIT};width:310px;height:15px;}`,`.deployments-btn.jsx-4260151599{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-top:${c.N_.TWO_UNITS};-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`,".deploy-ctx-menu.jsx-4260151599{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:16px;height:16px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}",`.deploy-build-logs.jsx-4260151599{background-color:${c.DM.GRAY_100};padding:${c.N_.UNIT};height:250px;border-radius:${c.n_.DEFAULT};margin-bottom:${c.N_.TWO_UNITS};width:550px;overflow:scroll;}`];l.__hash="4260151599";var d=o(376897),p=o(647571),u=o(316246),h=o(173541),m=o(202784),y=o(895563),g=o(793206),f=o(552322);const b=e=>(0,f.jsxs)(y.a,{header:(0,f.jsxs)("div",{className:i().dynamic([["3802525165",[c.um.DEFAULT,c.DM.GRAY_100,c.um.HEADING,c.Xw.MEDIUM_600]]])+" log-header",children:[(0,f.jsx)("div",{className:i().dynamic([["3802525165",[c.um.DEFAULT,c.DM.GRAY_100,c.um.HEADING,c.Xw.MEDIUM_600]]])+" log-heading",children:"Build Logs"})," ",(0,f.jsx)(h.z,{size:"small",colorScheme:"neutral",style:"outline",onClick:e.onDismiss,children:"Close"})]}),children:[(0,f.jsx)("div",{className:i().dynamic([["3802525165",[c.um.DEFAULT,c.DM.GRAY_100,c.um.HEADING,c.Xw.MEDIUM_600]]])+" log-content",children:(e.logs||[]).sort(((e,t)=>e.created-t.created)).map((e=>(0,f.jsx)(g.v,{textColor:"stderr"===e.type?c.DM.WARNING_DARK:c.DM.GRAY_950,font:"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace",children:(0,f.jsx)("span",{className:i().dynamic([["3802525165",[c.um.DEFAULT,c.DM.GRAY_100,c.um.HEADING,c.Xw.MEDIUM_600]]])+" log-text",children:e.payload.text})},e.created)))}),(0,f.jsx)(i(),{id:"3802525165",dynamic:[c.um.DEFAULT,c.DM.GRAY_100,c.um.HEADING,c.Xw.MEDIUM_600],children:[`.log-text.__jsx-style-dynamic-selector{font-size:${c.um.DEFAULT};word-break:break-all;}`,".log-header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex:1;-ms-flex:1;flex:1;}",`.log-content.__jsx-style-dynamic-selector{overflow-x:hidden;overflow-y:scroll;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;background-color:${c.DM.GRAY_100};list-style:none;}`,`.log-heading.__jsx-style-dynamic-selector{font-size:${c.um.HEADING};font-weight:${c.Xw.MEDIUM_600};}`]})]}),I=e=>{const t=(0,m.useMemo)((()=>e.deployment.alias.find((e=>null===e||void 0===e?void 0:e.includes("teleport")))),[e.deployment]);return t?(0,f.jsx)("a",{href:`https://${t}`,target:"_blank",rel:"noreferrer",children:(0,f.jsxs)("div",{"data-tooltip-name":`alias-url-${t}`,className:i().dynamic([["2143933376",[c.DM.GRAY_400,c.n_.DEFAULT,c.N_.HALF_UNIT]]])+" alias-box",children:["+1",(0,f.jsx)(d._,{name:`alias-url-${t}`,children:(0,f.jsx)(f.Fragment,{children:t})}),(0,f.jsx)(i(),{id:"2143933376",dynamic:[c.DM.GRAY_400,c.n_.DEFAULT,c.N_.HALF_UNIT],children:[`.alias-box.__jsx-style-dynamic-selector{height:16px;background-color:${c.DM.GRAY_400};border-radius:${c.n_.DEFAULT};padding:0 ${c.N_.HALF_UNIT};}`]})]})}):null};var v=o(282147);let w;!function(e){e.DELETE="Delete",e.PROMOTE_TO_PRODUCTION="Promote to Production",e.REDEPLOY="Redeploy",e.VIEW_LOGS="Build Logs"}(w||(w={}));const N=e=>{const{isLoading:t,isLoadingMore:o,teleportVercelAlias:n,deployments:y,hideBuildLogs:g,buildLogs:w,projectCustomDomain:N,deploymentsUnderWork:D,findCurrentTeleportDeployment:T,findCurrentProductionDeployment:O}=e,F=()=>{e.onLoadMoreClick()},C=(0,m.useCallback)((()=>{const e=null===y||void 0===y?void 0:y.deployments;if(t)return(0,f.jsx)(a.Z,{});if(!e||0===e.length)return(0,f.jsx)("div",{children:"No available deployments"});const o=T(),s=O();return e.map((e=>{var t;const a=e.uid===s&&N,c=e.uid===o,m=a?N:c?e.alias.find((e=>null===e||void 0===e?void 0:e.includes("teleport")))||`${n}.teleporthq.app`:j(e.url),y=a?N:c?e.alias.find((e=>null===e||void 0===e?void 0:e.includes("teleport")))||`${n}.teleporthq.app`:e.url;return(0,f.jsxs)("div",{className:`jsx-${l.__hash}`,children:[(0,f.jsxs)("div",{className:`jsx-${l.__hash} deploy-row`,children:[(0,f.jsxs)("div",{className:`jsx-${l.__hash} deploy-details`,children:[(0,f.jsx)(r.J,{type:"deploy-url",size:16}),(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column"},className:`jsx-${l.__hash}`,children:[(0,f.jsxs)("div",{"data-tooltip-name":`deploy-url-${e.url}`,className:`jsx-${l.__hash} deploy-details-text`,children:[(0,f.jsx)("a",{href:`https://${y}`,target:"_blank",rel:"noreferrer noopener",className:`jsx-${l.__hash}`,children:(0,f.jsx)("span",{className:`jsx-${l.__hash} deploy-details-text-url`,children:m})}),a?(0,f.jsx)(I,{deployment:e}):null,(0,f.jsx)("div",{className:`jsx-${l.__hash} copy-icon`,children:(0,f.jsx)(p.u,{value:e.url,showNotification:!0})}),(0,f.jsx)(d._,{name:`deploy-url-${e.url}`,children:(0,f.jsx)("span",{className:`jsx-${l.__hash}`,children:y})})]}),(0,f.jsx)("span",{className:`jsx-${l.__hash} deploy-details-date`,children:S(e.createdAt)})]})]}),(0,f.jsx)("div",{className:`jsx-${l.__hash}`,children:(0,f.jsx)(u.I,{domainPublishStatus:e.state||e.readyState})}),(0,f.jsx)("span",{className:`jsx-${l.__hash} deploy-alias`,children:null!==(t=e.target)&&void 0!==t?t:"Preview"}),(0,f.jsx)("div",{className:`jsx-${l.__hash} deploy-ctx-menu`,children:D[e.uid]?(0,f.jsx)(v.$,{}):(0,f.jsx)(h.z,{size:"small",shape:"square",colorScheme:"neutral",style:"transparent",onClick:t=>((e,t)=>{if(!e)return;const o=new CustomEvent("publish-deploy-url:contextualmenu",{detail:{deployment:t,originalEvent:e},bubbles:!0,composed:!0});document.dispatchEvent(o)})(t,e),children:(0,f.jsx)(r.J,{type:"more",size:12})})})]}),e.url===(null===w||void 0===w?void 0:w.deployUrl)&&(0,f.jsx)("div",{className:`jsx-${l.__hash} deploy-build-logs`,children:(0,f.jsx)(b,{logs:w.logs,onDismiss:g})}),(0,f.jsx)(i(),{id:l.__hash,children:l})]},e.uid)}))}),[y,t,w,D]),E=(0,m.useCallback)((()=>null===y||void 0===y||!y.deployments||t?null:null===(null===y||void 0===y?void 0:y.pagination.next)?(0,f.jsx)("span",{style:{color:c.DM.GRAY_700},children:" All data loaded"}):(0,f.jsx)(h.z,{style:"outline",colorScheme:"neutral",size:"small",isLoading:o,onClick:F,dataAttrs:{"data-action-name":"load-more-deploys"},children:"Load more"})),[y,o,t,F]);return(0,f.jsxs)("main",{tabIndex:0,className:`jsx-${l.__hash}`,children:[(0,f.jsx)(s.W,{title:"Deployments",description:"A list of all your Vercel deployments"}),(0,f.jsx)("div",{className:`jsx-${l.__hash}`,children:C()}),(0,f.jsx)("div",{className:`jsx-${l.__hash} deployments-btn`,children:E()}),(0,f.jsx)(i(),{id:l.__hash,children:l})]})},j=e=>e.substring(0,e.indexOf(".vercel.app")),S=e=>new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0})},135670:function(e,t,o){"use strict";o.d(t,{x2:function(){return i},Mz:function(){return r},W2:function(){return s}});var n=o(781872);const i="thq-header",r=50,s=[`.${i}.jsx-4216955724{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:${r}px;background:${n.DM.GRAY_300};border-bottom:2px solid ${n.DM.GRAY_200};-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;position:relative;}`,`.${i}.jsx-4216955724 .pt-btn.transparent{cursor:default;}`,`.${i}.jsx-4216955724 .left-side.jsx-4216955724{z-index:${n.kg.TEN};}`,`.${i}.jsx-4216955724 .left-side.jsx-4216955724,.${i}.jsx-4216955724 .middle-side.jsx-4216955724{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;gap:${n.N_.ONE_AND_HALF};}`,`.${i}.jsx-4216955724 .middle-side.jsx-4216955724{width:100%;position:absolute;}`,`.${i}.jsx-4216955724 .options-right.jsx-4216955724{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:stretch;-webkit-justify-content:stretch;-ms-flex-pack:stretch;justify-content:stretch;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.peer-icon.jsx-4216955724{width:26px;height:26px;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;background-color:${n.DM.GRAY_500};-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:50%;margin-right:-${n.N_.HALF_UNIT};}`,`.text-button.jsx-4216955724{margin:0 ${n.N_.TWO_UNITS};}`,`#navbar-upgrade-button{margin-right:${n.N_.TWO_UNITS} !important;}`,`@media (max-width:1400px){.${i}.jsx-4216955724 .middle-side.jsx-4216955724{width:auto;position:initial;}}`];s.__hash="4216955724"},285835:function(e,t,o){"use strict";o.d(t,{zC:function(){return d},zl:function(){return p},jx:function(){return u},Jw:function(){return m}});var n=o(777460),i=o(378888),r=o(463540),s=o(555362);function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const l=["inherit","initial","revert","unset"],d=["zoom"],p=(e,t)=>{if(e&&t&&null!==t&&void 0!==t&&t.cssKeyValue){const o=null===t||void 0===t?void 0:t.cssKeyValue[e];if(o){let e=[...o.values];return"color"===o.type&&e.push(...Object.keys(null===t||void 0===t?void 0:t.cssColors)),e.push(...l),e=e.sort(),e}}return[]},u=(e,t,o,n)=>Object.keys(e).reduce(((r,a)=>{let l={[a]:e[a]};return a===t&&(l={[(0,i._A)(o)]:n?new s.P({content:{referenceType:"token",id:n}}):e[a]}),c(c({},r),l)}),{}),h={[r.i.COLOR]:["color","fill","stroke"],[r.i.GRADIENT]:["backgroundImage","background","borderImage","maskImage","listStyleImage","borderImageSource"],[r.i.SIZE]:["width","height"],[r.i.SPACE]:["margin","padding","gap"],[r.i.RADIUS]:["radius"]},m=(e,t)=>/border.*width/.test(e)?[]:t.filter((t=>{const o=t.type;switch(o){case"radius":return e.toLowerCase().includes(o);case"space":if(h.space.find((t=>e.includes(t))))return"space"===o;break;case"color":if(h.color.find((t=>e.includes(t))))return"color"===o;break;case"gradient":if(h.gradient.find((t=>e===t)))return"gradient"===o;break;case"size":if(h.size.find((t=>e.includes(t))))return"size"===o;break;default:return[]}}))},587767:function(e,t,o){"use strict";o.d(t,{i:function(){return R},w:function(){return Z}});var n,i,r,s,a,c,l,d,p,u,h,m=o(676422),y=o.n(m),g=o(781872),f=o(202784),b=o(503348),I=o(777460),v=o(889371),w=o(735468),N=o(918437),j=o(302503),S=o(395942),D=o(237759),T=o(930613),O=o(238405),F=o(387117),C=o(704614),E=o(986897),x=o(440516),_=o(333408),M=o(492080),P=o(552322);let A=(n=(0,j.inject)("projectDoc"),i=(0,j.inject)("projectUIState"),r=(0,j.inject)("navbarFlow"),s=(0,j.inject)("absolutePositionedLayerFlow"),u=new WeakMap,h=new WeakMap,a=class extends f.Component{constructor(e){super(e),(0,b.Z)(this,"projectDoc",c,this),(0,b.Z)(this,"projectUIState",l,this),(0,b.Z)(this,"navbarFlow",d,this),(0,b.Z)(this,"absolutePositionedLayerFlow",p,this),u.set(this,{writable:!0,value:[]}),h.set(this,{writable:!0,value:null}),(0,I.Z)(this,"handleDeleteTab",(e=>{this.navbarFlow.deleteTab(e),this.props.isDevMode&&this.props.setHoveredPath&&this.props.setHoveredPath("")})),(0,I.Z)(this,"handleSelectTab",(e=>{this.navbarFlow.selectTab({tabId:e})})),(0,I.Z)(this,"computeTabName",(e=>{if(this.projectUIState.layout.mainPanel!==x.iW.DEV){const t=this.projectDoc.getProjectPageOrComponent(e.entityId);return(null===t||void 0===t?void 0:t.title)||""}if("git-file"!==e.type&&"staged-file"!==e.type&&"commited-file"!==e.type)return e.entityId.split("/").slice(-1)[0];const t=e.entityId.split("-").slice(-1)[0],o=e.entityId.replace(`-${t}`,"").split("/").slice(-1)[0];if("staged-file"===e.type)return o+"(Staged)";if("commited-file"===e.type)return e.entityId.replace(M.Vf,"").split("/").slice(-1)[0];let n="";switch(t){case _.E.MODIFIED:n="(Working tree) M";break;case _.E.NEW:n="(Untracked) U";break;case _.E.REMOVED:n="(Deleted)"}return o+n})),(0,I.Z)(this,"handleMouseOverTab",(e=>{if(this.props.isDevMode&&this.props.setHoveredPath){const e=this.state.tabData.entityId;this.props.setHoveredPath(e)}const t=this.projectUIState.drag.draggedEntity;(0,w.Z)(this,h)||this.props.isSelected||(null===t||void 0===t?void 0:t.type)!==C.Z.SUB_HIERARCHY||t.content.isNew&&t.content.hierarchyType===C.h.COMPONENT||(0,v.Z)(this,h,setTimeout((()=>{this.handleSelectTab(e),(0,v.Z)(this,h,null)}),E.UQ))})),(0,I.Z)(this,"handleMouseOutOfTab",(()=>{this.props.isDevMode&&this.props.setHoveredPath&&this.props.setHoveredPath(""),(0,w.Z)(this,h)&&(clearTimeout((0,w.Z)(this,h)),(0,v.Z)(this,h,null))})),(0,I.Z)(this,"handleContextMenu",((e,t)=>{t.preventDefault(),t.stopPropagation();const o=Object.keys(this.navbarFlow.getCurrentTabs()),n=this.navbarFlow.getNextTab(e),i=[{label:T.dU.TAB.CLOSE,action:()=>this.navbarFlow.deleteTab(e),disabled:!this.props.isDevMode&&o.length<2},{label:T.dU.TAB.CLOSE_OTHERS,action:()=>this.navbarFlow.deleteOtherTabs(e),disabled:o.length<2},{label:T.dU.TAB.CLOSE_RIGHT,action:()=>this.navbarFlow.deleteTabsToTheRight(e),disabled:!n}];this.props.isDevMode&&i.push({label:T.dU.TAB.CLOSE_ALL,action:()=>this.navbarFlow.deleteAllDevModeTabs(),disabled:!1}),this.absolutePositionedLayerFlow.showContextMenu((0,P.jsx)(F.x,{menuItems:i}),(0,O.FG)(t))})),(0,I.Z)(this,"handleTabDoubleClick",(e=>{this.navbarFlow.getCurrentNewTabId()===e&&this.navbarFlow.saveNewTab()}));const t=this.navbarFlow.getCurrentTabs()[e.id];this.state={tabName:this.computeTabName(t),acceptingDrop:null,isNew:this.navbarFlow.getCurrentNewTabId()===this.props.id,tabData:t}}componentDidMount(){const e=this.state.tabData.entityId;if(this.props.isDevMode){const e=(0,S.select)(this.projectUIState,["navbar/devModeTabs/*","navbar/devModeTabs/**"],(()=>{const e=this.navbarFlow.getCurrentTabs()[this.props.id];e&&"file"===e.type&&this.setState({tabData:e,tabName:e.entityId.split("/").slice(-1)[0]}),!e||"git-file"!==e.type&&"staged-file"!==e.type||this.setState({tabData:e,tabName:this.computeTabName(e)})}),"TabWrapper");(0,w.Z)(this,u).push((()=>e.dispose()))}else{const t=(0,S.select)(this.projectDoc,[`pages/byId/${e}/title`,`cmsPages/byId/${e}/title`,`components/byId/${e}/title`],(()=>{const t=this.projectDoc.getProjectPageOrComponent(e),o=(null===t||void 0===t?void 0:t.title)||"";this.setState({tabName:o||""})}),"TabWrapper2");(0,w.Z)(this,u).push((()=>t.dispose()))}const t=(0,S.select)(this.projectUIState,["dropFlowStates/navbar/**"],(({dropFlowStates:{navbar:e}})=>{var t;this.setState({acceptingDrop:(null===(t=e.acceptingTab)||void 0===t?void 0:t.dataset.tabId)===this.props.id?e.dropPosition:null})}),"TabWrapper3"),o=(0,S.select)(this.projectUIState,["drag/draggedEntity"],(()=>{(0,w.Z)(this,h)&&(clearTimeout((0,w.Z)(this,h)),(0,v.Z)(this,h,null))}),"TabWrapper4");if(this.props.id===this.navbarFlow.getCurrentNewTabId()){const e=this.props.isDevMode?"navbar/newDevTabId":"navbar/newTabId",t=(0,S.select)(this.projectUIState,[e],(()=>{this.setState({isNew:this.props.id===this.navbarFlow.getCurrentNewTabId()})}),"TabWrapper5");(0,w.Z)(this,u).push((()=>t.dispose()));const o=this.projectUIState.devMode.selectedBranch,n=this.props.isDevMode?`projectFiles/local/${o}/byId/**`:"nodes/byId/**",i=(0,S.select)(this.projectDoc,[n],((e,t)=>{const o=t.some((e=>{const{pathArray:t}=e;return-1!==t.indexOf("pages")&&3===t.length||-1!==t.indexOf("components")&&3===t.length||-1!==t.indexOf("projectFiles")&&3===t.length}));this.state.isNew&&!o&&(this.navbarFlow.saveNewTab(),this.setState({isNew:!1}))}),"TabWrapper6");(0,w.Z)(this,u).push((()=>i.dispose()))}(0,w.Z)(this,u).push((()=>t.dispose()),(()=>o.dispose()))}componentWillUnmount(){(0,w.Z)(this,u).forEach((e=>e())),(0,v.Z)(this,u,[])}render(){const{type:e,id:t,entityId:o}=this.state.tabData;return(0,P.jsx)(D.OK,{isSelected:this.props.isSelected,type:e,onDelete:this.props.canBeDeleted?this.handleDeleteTab:void 0,onSelect:this.handleSelectTab,content:this.state.tabName||"",id:t,isNew:this.state.isNew,acceptingDrop:this.state.acceptingDrop,entityId:o,onDoubleClick:this.handleTabDoubleClick,onMouseOver:this.handleMouseOverTab,onMouseOut:this.handleMouseOutOfTab,onContextMenu:this.handleContextMenu,isDevMode:this.props.isDevMode})}},c=(0,N.Z)(a.prototype,"projectDoc",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=(0,N.Z)(a.prototype,"projectUIState",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=(0,N.Z)(a.prototype,"navbarFlow",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=(0,N.Z)(a.prototype,"absolutePositionedLayerFlow",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a);var k=o(990997);const U="thq-navbar",R=32,Z=e=>{const{tabIds:t=[],onScroll:o,initialScroll:n=0,selectedTab:i,tabWidths:r=[],isDevMode:s,setHoveredPath:a,sidebarWidth:c}=e,l=(0,f.useRef)(null),{0:d,1:p}=(0,f.useState)(!1),{0:u,1:h}=(0,f.useState)(0),m=e=>{e.preventDefault(),e.stopPropagation()};return(0,f.useEffect)((()=>{h((e=>e+1))}),[e.tabIds]),(0,f.useEffect)((()=>{setTimeout((()=>{if(!l.current)return;let e=n;const s=t.findIndex((e=>e===i)),a=r.slice(0,s).reduce(((e,t)=>e+t),0);l.current.removeAttribute("style"),p(!0);const c=n+l.current.clientWidth;return(a>c||a<n)&&(e=a),a>c-r[s]&&(e+=r[s]),l.current.scrollTo({left:e}),o(l.current.scrollLeft),"GestureEvent"in window&&(l.current.addEventListener("gesturestart",m),l.current.addEventListener("gesturechange",m),l.current.addEventListener("gestureend",m)),()=>{var e,t,o;null===(e=l.current)||void 0===e||e.removeEventListener("gesturestart",m),null===(t=l.current)||void 0===t||t.removeEventListener("gesturechange",m),null===(o=l.current)||void 0===o||o.removeEventListener("gestureend",m)}}))}),[i,u]),(0,P.jsxs)("div",{className:y().dynamic([["2078723183",[U,R,g.kg.TEN,g.DM.GRAY_200,U,g.DM.GRAY_100,U,U,g.DM.GRAY_200,g.kg.TWENTY,s?"relative":"fixed",c+48,c+48+k.BL,g.DM.GRAY_200,g.kg.TEN]]])+" navbar-wrapper",children:[(0,P.jsx)("div",{ref:l,style:d?void 0:{left:`-${n}px`,width:"1500%"},onWheelCapture:e=>{e.ctrlKey||e.metaKey||(e.stopPropagation(),e.currentTarget.scrollLeft+=(e.deltaY||0)+(e.deltaX||0),o(e.currentTarget.scrollLeft))},id:"thq-navbar",className:y().dynamic([["2078723183",[U,R,g.kg.TEN,g.DM.GRAY_200,U,g.DM.GRAY_100,U,U,g.DM.GRAY_200,g.kg.TWENTY,s?"relative":"fixed",c+48,c+48+k.BL,g.DM.GRAY_200,g.kg.TEN]]])+" thq-navbar"+(s?" dev-mode":""),children:t.map((e=>(0,P.jsx)(A,{canBeDeleted:t.length>1||!!s,isSelected:i===e,id:e,isDevMode:s,setHoveredPath:a},e+u)))}),(0,P.jsx)("div",{className:y().dynamic([["2078723183",[U,R,g.kg.TEN,g.DM.GRAY_200,U,g.DM.GRAY_100,U,U,g.DM.GRAY_200,g.kg.TWENTY,s?"relative":"fixed",c+48,c+48+k.BL,g.DM.GRAY_200,g.kg.TEN]]])+" navbar-addons",children:e.children}),(0,P.jsx)(y(),{id:"2078723183",dynamic:[U,R,g.kg.TEN,g.DM.GRAY_200,U,g.DM.GRAY_100,U,U,g.DM.GRAY_200,g.kg.TWENTY,s?"relative":"fixed",c+48,c+48+k.BL,g.DM.GRAY_200,g.kg.TEN],children:[`.thq-navbar.__jsx-style-dynamic-selector{height:${R}px;z-index:${g.kg.TEN};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;overflow:scroll;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-scrollbar-width:none;-moz-scrollbar-width:none;-ms-scrollbar-width:none;scrollbar-width:none;background-color:${g.DM.GRAY_200};}`,`.thq-navbar.__jsx-style-dynamic-selector:not(.dev-mode){border-left:1px solid ${g.DM.GRAY_100};}`,".thq-navbar.dev-mode.__jsx-style-dynamic-selector{height:30px;position:static;width:100%;}",".thq-navbar.__jsx-style-dynamic-selector::-webkit-scrollbar{display:none;}",`.navbar-addons.__jsx-style-dynamic-selector{background:${g.DM.GRAY_200};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;z-index:${g.kg.TWENTY};}`,`.navbar-wrapper.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:${s?"relative":"fixed"};top:50px;left:${c+48}px;width:calc(100% - ${c+48+k.BL}px);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:${g.DM.GRAY_200};border-left:1px solid black;isolation:isolate;z-index:${g.kg.TEN};}`]})]})}},237759:function(e,t,o){"use strict";o.d(t,{d:function(){return p},FL:function(){return u},OK:function(){return h}});var n=o(676422),i=o.n(n),r=o(492080),s=o(505892),a=o(781872),c=o(202784),l=o(552322);const d="thq-tab",p=181,u=45,h=e=>{const{type:t,content:o,isNew:n,id:p,onDelete:u,isSelected:h,onSelect:m,entityId:y,acceptingDrop:g,onMouseOver:f,onMouseOut:b,onDoubleClick:I,onContextMenu:v,isDevMode:w}=e,N=(0,c.useRef)(null),j=(0,c.useRef)(null);(0,c.useEffect)((()=>{var e,t;if(j.current&&N.current){if((null===(e=N.current)||void 0===e?void 0:e.offsetWidth)<(null===(t=N.current)||void 0===t?void 0:t.scrollWidth))return j.current.dataset.tooltipName=o,void(j.current.dataset.tooltipDirection="vertical");delete j.current.dataset.tooltipName,delete j.current.dataset.tooltipDirection}}),[j.current,o]);return(0,l.jsxs)("div",{ref:j,onClick:()=>m(p),onContextMenu:e=>v(p,e.nativeEvent),onMouseOver:()=>f(p),onMouseOut:b,onDoubleClick:()=>I(p),"data-drag-component-id":"component"===t?y:void 0,"data-drag-page-id":"page"===t?y:void 0,"data-drag-file-id":"file"===t?y:void 0,"data-tab-id":p,className:i().dynamic([["3313901401",[d,h?a.DM.GRAY_100:a.DM.GRAY_200,a.DM.GRAY_100,d,d,a.DM.ACCENT_500,d,a.DM.ACCENT_500,d,h?a.DM.GRAY_100:a.DM.GRAY_400,d,h?"600":"400",a.N_.HALF_UNIT,h?a.DM.GRAY_1000:a.DM.GRAY_700,d,a.DM.GRAY_1000,a.N_.HALF_UNIT,n&&"font-style: italic;",d,d,a.DM.GRAY_500,a.n_.DEFAULT,d,d,d,a.DM.GRAY_200,d,a.DM.GRAY_100,d,d]]])+" "+`thq-tab${h?" selected":""}${w?" dev-mode":""}`,children:[(0,l.jsxs)("div",{className:i().dynamic([["3313901401",[d,h?a.DM.GRAY_100:a.DM.GRAY_200,a.DM.GRAY_100,d,d,a.DM.ACCENT_500,d,a.DM.ACCENT_500,d,h?a.DM.GRAY_100:a.DM.GRAY_400,d,h?"600":"400",a.N_.HALF_UNIT,h?a.DM.GRAY_1000:a.DM.GRAY_700,d,a.DM.GRAY_1000,a.N_.HALF_UNIT,n&&"font-style: italic;",d,d,a.DM.GRAY_500,a.n_.DEFAULT,d,d,d,a.DM.GRAY_200,d,a.DM.GRAY_100,d,d]]])+" name-container",children:[(()=>{if("file"===t)return(0,l.jsx)(s.J,{type:`file-type/${y.split(".").slice(-1)[0]}`,size:12});if("git-file"===t||"staged-file"===t){const e=y.split("-").slice(-1)[0],t=y.replace(`-${e}`,"").split("/").slice(-1)[0];return(0,l.jsx)(s.J,{type:`file-type/${t.split(".").slice(-1)[0]}`,size:12})}if("commited-file"===t){const e=y.split("-").slice(-2)[0],t=y.replace(`-${e}${r.Vf}`,"").split("/").slice(-1)[0];return(0,l.jsx)(s.J,{type:`file-type/${t.split(".").slice(-1)[0]}`,size:12})}return"component"===t||"page"===t?(0,l.jsx)(s.J,{type:t,size:12,color:h?a.DM.ACCENT_500:void 0}):null})(),(0,l.jsx)("span",{ref:N,className:i().dynamic([["3313901401",[d,h?a.DM.GRAY_100:a.DM.GRAY_200,a.DM.GRAY_100,d,d,a.DM.ACCENT_500,d,a.DM.ACCENT_500,d,h?a.DM.GRAY_100:a.DM.GRAY_400,d,h?"600":"400",a.N_.HALF_UNIT,h?a.DM.GRAY_1000:a.DM.GRAY_700,d,a.DM.GRAY_1000,a.N_.HALF_UNIT,n&&"font-style: italic;",d,d,a.DM.GRAY_500,a.n_.DEFAULT,d,d,d,a.DM.GRAY_200,d,a.DM.GRAY_100,d,d]]])+" name",children:o})]}),u&&(0,l.jsx)("div",{onClick:()=>u(p),className:i().dynamic([["3313901401",[d,h?a.DM.GRAY_100:a.DM.GRAY_200,a.DM.GRAY_100,d,d,a.DM.ACCENT_500,d,a.DM.ACCENT_500,d,h?a.DM.GRAY_100:a.DM.GRAY_400,d,h?"600":"400",a.N_.HALF_UNIT,h?a.DM.GRAY_1000:a.DM.GRAY_700,d,a.DM.GRAY_1000,a.N_.HALF_UNIT,n&&"font-style: italic;",d,d,a.DM.GRAY_500,a.n_.DEFAULT,d,d,d,a.DM.GRAY_200,d,a.DM.GRAY_100,d,d]]])+" close",children:(0,l.jsx)(s.J,{type:"actions/close",size:12})}),g&&(0,l.jsx)("div",{className:i().dynamic([["3313901401",[d,h?a.DM.GRAY_100:a.DM.GRAY_200,a.DM.GRAY_100,d,d,a.DM.ACCENT_500,d,a.DM.ACCENT_500,d,h?a.DM.GRAY_100:a.DM.GRAY_400,d,h?"600":"400",a.N_.HALF_UNIT,h?a.DM.GRAY_1000:a.DM.GRAY_700,d,a.DM.GRAY_1000,a.N_.HALF_UNIT,n&&"font-style: italic;",d,d,a.DM.GRAY_500,a.n_.DEFAULT,d,d,d,a.DM.GRAY_200,d,a.DM.GRAY_100,d,d]]])+" "+`drop-indicator ${g}`}),(0,l.jsx)(i(),{id:"3313901401",dynamic:[d,h?a.DM.GRAY_100:a.DM.GRAY_200,a.DM.GRAY_100,d,d,a.DM.ACCENT_500,d,a.DM.ACCENT_500,d,h?a.DM.GRAY_100:a.DM.GRAY_400,d,h?"600":"400",a.N_.HALF_UNIT,h?a.DM.GRAY_1000:a.DM.GRAY_700,d,a.DM.GRAY_1000,a.N_.HALF_UNIT,n&&"font-style: italic;",d,d,a.DM.GRAY_500,a.n_.DEFAULT,d,d,d,a.DM.GRAY_200,d,a.DM.GRAY_100,d,d],children:[`.thq-tab.__jsx-style-dynamic-selector{position:relative;height:100%;padding:0px 4px;background:${h?a.DM.GRAY_100:a.DM.GRAY_200};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;border-right:1px solid ${a.DM.GRAY_100};}`,".thq-tab.__jsx-style-dynamic-selector .drop-indicator.__jsx-style-dynamic-selector{position:absolute;height:100%;width:100%;left:0;}",`.thq-tab.__jsx-style-dynamic-selector .drop-indicator.before.__jsx-style-dynamic-selector{border-left:2px solid ${a.DM.ACCENT_500};}`,`.thq-tab.__jsx-style-dynamic-selector .drop-indicator.after.__jsx-style-dynamic-selector{border-right:2px solid ${a.DM.ACCENT_500};}`,`.thq-tab.__jsx-style-dynamic-selector:hover{background:${h?a.DM.GRAY_100:a.DM.GRAY_400};}`,`.thq-tab.__jsx-style-dynamic-selector .name-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-width:156px;font-weight:${h?"600":"400"};padding:0 ${a.N_.HALF_UNIT};color:${h?a.DM.GRAY_1000:a.DM.GRAY_700};}`,`.thq-tab.__jsx-style-dynamic-selector:hover .name-container.__jsx-style-dynamic-selector{color:${a.DM.GRAY_1000};}`,`.name.__jsx-style-dynamic-selector{padding:${a.N_.HALF_UNIT};padding-right:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;${n&&"font-style: italic;"};}`,".thq-tab.__jsx-style-dynamic-selector .close.__jsx-style-dynamic-selector{padding:2px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;opacity:0;}",`.thq-tab.__jsx-style-dynamic-selector .close.__jsx-style-dynamic-selector:hover{background-color:${a.DM.GRAY_500};border-radius:${a.n_.DEFAULT};}`,".thq-tab.__jsx-style-dynamic-selector:hover .close.__jsx-style-dynamic-selector{opacity:1;}",".thq-tab.selected.__jsx-style-dynamic-selector .close.__jsx-style-dynamic-selector{opacity:1;}",`.thq-tab.dev-mode.__jsx-style-dynamic-selector{background:${a.DM.GRAY_200};}`,`.thq-tab.selected.dev-mode.__jsx-style-dynamic-selector{background:${a.DM.GRAY_100};}`,".thq-tab.dev-mode.__jsx-style-dynamic-selector .name-container.__jsx-style-dynamic-selector{color:#8c8c8c;font-weight:400;}",".thq-tab.selected.dev-mode.__jsx-style-dynamic-selector .name-container.__jsx-style-dynamic-selector{color:#dadada;}"]})]})}},503266:function(e,t,o){"use strict";o.d(t,{R:function(){return c}});var n=o(676422),i=o.n(n),r=(o(202784),o(636201)),s=o(781872),a=o(552322);const c=({value:e,onChange:t,autofocusOnMount:o})=>(0,a.jsxs)("div",{className:i().dynamic([["238527212",[s.N_.ONE_AND_HALF]]])+" search-box",children:[(0,a.jsx)(r.S,{style:"boxed",size:"flexible",label:"Search",value:e,onChange:t,autofocusOnMount:o}),(0,a.jsx)(i(),{id:"238527212",dynamic:[s.N_.ONE_AND_HALF],children:[`.search-box.__jsx-style-dynamic-selector{padding:${s.N_.ONE_AND_HALF};}`]})]})},324438:function(e,t,o){"use strict";o.d(t,{D:function(){return L},J:function(){return $}});var n,i,r,s,a,c,l,d,p,u,h,m,y,g,f,b,I,v,w=o(503348),N=o(777460),j=o(889371),S=o(735468),D=o(918437),T=o(676422),O=o.n(T),F=o(202784),C=o(928316),E=o(302503),x=o(395942),_=o(781872),M=o(20079),P=o(378888),A=o(986897),k=o(233475),U=o(971162),R=o(68311),Z=o(552322);const L="tree-list-item";let $=(n=(0,E.inject)("projectDoc"),i=(0,E.inject)("projectUIState"),r=(0,E.inject)("nodeSelectionFlow"),s=(0,E.inject)("notificationsManagementFlow"),a=(0,E.inject)("positioningService"),c=(0,E.inject)("nodeManagementFlow"),l=(0,E.inject)("localHistoryStackFlow"),d=(0,E.inject)("domainNodeToTreeNodeMapper"),v=new WeakMap,p=class extends F.PureComponent{constructor(...e){super(...e),(0,w.Z)(this,"projectDoc",u,this),(0,w.Z)(this,"projectUIState",h,this),(0,w.Z)(this,"nodeSelectionFlow",m,this),(0,w.Z)(this,"notificationsManagementFlow",y,this),(0,w.Z)(this,"positioningService",g,this),(0,w.Z)(this,"nodeManagementFlow",f,this),(0,w.Z)(this,"localHistoryStackFlow",b,this),(0,w.Z)(this,"domainNodeToTreeNodeMapper",I,this),(0,N.Z)(this,"nodeHierarchyKeyboardShorcutsSensor",new M.U),(0,N.Z)(this,"rootRef",F.createRef()),(0,N.Z)(this,"rootNodeId",null),(0,N.Z)(this,"nodeIdNodeElement",{}),(0,N.Z)(this,"state",{targetComponentRootNode:null,treeviewIsSearched:!1}),(0,N.Z)(this,"unsubs",[]),v.set(this,{writable:!0,value:null}),(0,N.Z)(this,"savedScroll",0),(0,N.Z)(this,"handleParentScroll",(()=>{var e,t;null!==(e=this.rootRef.current)&&void 0!==e&&null!==(t=e.parentElement)&&void 0!==t&&t.scrollTop&&(this.savedScroll=this.rootRef.current.parentElement.scrollTop)})),(0,N.Z)(this,"handleFocus",(()=>{var e,t;this.savedScroll&&(null===(e=this.rootRef.current)||void 0===e||null===(t=e.parentElement)||void 0===t||t.scrollTo({top:this.savedScroll}))})),(0,N.Z)(this,"handleBlur",(()=>{var e,t;null!==(e=this.rootRef.current)&&void 0!==e&&null!==(t=e.parentElement)&&void 0!==t&&t.scrollTop?this.savedScroll=this.rootRef.current.parentElement.scrollTop:this.savedScroll=0})),(0,N.Z)(this,"handleShortcutsOnTreeNode",(e=>{const t="KeyZ"===e.code&&(e.ctrlKey||e.metaKey),o="KeyV"===e.code&&(e.ctrlKey||e.metaKey);t||o||e.preventDefault(),t&&(e.shiftKey?this.localHistoryStackFlow.redo():this.localHistoryStackFlow.undo())})),(0,N.Z)(this,"createAndAddNewNode",(e=>{var t,o;const{nodeId:n,depth:i,compInstanceId:r="root",slotParentCompInstanceId:s,parentNodeId:a=""}=e,c=this.projectDoc.nodes.getById(n),l=this.projectDoc.nodes.getById(a);if(null!==(t=this.nodeIdNodeElement[r])&&void 0!==t&&t[n]&&this.removeNodeAndDescendantsFromDOM(n,r),null===c||void 0===c||!c.getNodeAllowedOps(l).interactWithPointer||"disabled"in c&&c.disabled)return;const d=document.createElement("div"),p=document.createElement("div");if(d.classList.add("tree-node-wrapper"),p.classList.add(L),d.append(p),(null===c||void 0===c?void 0:c.primitiveType)===k.sO.CONTAINER&&!c.compIdOfRootNode){const e=document.createElement("div");e.classList.add("fake-element"),Object.assign(e.dataset,{nodeId:n,fakeTreeviewElem:!0}),d.appendChild(e)}this.domainNodeToTreeNodeMapper.renderDomainNodeIntoTreeNode({nodeId:n,depth:i-1,compInstanceId:r,treeNode:p}),this.nodeIdNodeElement[r]||(this.nodeIdNodeElement[r]={}),this.nodeIdNodeElement[r][n]={domNode:d,id:n,pos:(null===c||void 0===c?void 0:c.pos)||"0"};const u=null===(o=this.nodeIdNodeElement[s||r][a])||void 0===o?void 0:o.domNode;if(u){var h;const e=this.nodeManagementFlow.getNodeChildren((null===l||void 0===l?void 0:l.id)||"",r),t=Object.keys(this.nodeIdNodeElement[r]).filter((t=>-1!==e.indexOf(t))),o=null===(h=this.positioningService.getNextEntity({entitiyCollection:this.nodeIdNodeElement[r],entity:this.nodeIdNodeElement[r][n],entitiesOfInterest:t}))||void 0===h?void 0:h.domNode;o&&(0,P.l8)(u,o)?u.insertBefore(d,o):u.append(d)}Object.keys(this.projectUIState.selection.expandedTreeNodes[s||r]||{}).includes((null===l||void 0===l?void 0:l.id)||"")||(null===l||void 0===l?void 0:l.id)===this.rootNodeId||null!==c&&void 0!==c&&c.compIdOfRootNode||(this.nodeIdNodeElement[r][n].domNode.style.display="none")})),(0,N.Z)(this,"subscribeForTreeViewExpand",(()=>{const e=(0,x.select)(this.projectUIState,["selection/expandedTreeNodes/**"],((e,t)=>{t.forEach((e=>{const{op:t,pathArray:o}=e;o.length>2&&"expandedTreeNodes"===o[1]&&("add"===t&&this.toggleAndUntoggleNodes(o[3],"",o[2]),"remove"===t&&this.toggleAndUntoggleNodes(o[3],"none",o[2]))}))}),"TreeViewWrapper1");this.unsubs.push((()=>e.dispose()))})),(0,N.Z)(this,"subscribeForNodeParentOrPositionUpdates",(()=>{const e=(0,x.select)(this.projectDoc,["nodes/byId/*/parentId","nodes/byId/*/pos","nodes/byId/*/slotId","nodes/byId/*/compInstanceId"],((e,t)=>{const o=[],n=["compInstanceId","parentId","slotId"];t.forEach((t=>{const{op:i,pathArray:r}=t;if("nodes"!==r[0]||"byId"!==r[1]||4!==r.length||"pos"!==r[3]&&!n.includes(r[3]))return;const s=r[2],{compInstanceId:a}=e.nodes.getSlotAndCompInstanceIdForNodeById(s);if("replace"!==i)"remove"===i&&n.includes(r[3])?this.removeNodeAndDescendantsFromDOM(s):"add"===i&&n.includes(r[3])&&this.renderSubtree(s,a);else{if(-1!==o.indexOf(s))return;o.push(s)}})),o.sort(((t,o)=>{const n=e.nodes.getById(t),i=e.nodes.getById(o),r=parseFloat(null===n||void 0===n?void 0:n.pos),s=parseFloat(null===i||void 0===i?void 0:i.pos);return(0,U.F0)(s)-(0,U.F0)(r)})).forEach((e=>{const{compInstanceId:t}=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e);this.removeNodeAndDescendantsFromDOM(e),this.renderSubtree(e,t)}))}),"TreeViewWrapper3");this.unsubs.push((()=>e.dispose()))})),(0,N.Z)(this,"subscribeForSlotUpdates",(()=>{const e=(0,x.select)(this.projectDoc,["components/byId/*/slots/**"],((e,t)=>{t.forEach((e=>{const{pathArray:t}=e;if("components"!==t[0]||"byId"!==t[1]||"slots"!==t[3])return;const o=t[4];o&&(this.removeNodeAndDescendantsFromDOM(o),this.renderSubtree(o))}))}),"TreeViewWrapperSlots");this.unsubs.push((()=>e.dispose()))})),(0,N.Z)(this,"subscribeForNodeUpdates",(()=>{const e=(0,x.select)(this.projectDoc,["nodes/byId/*"],((e,t)=>{t.forEach((t=>{const{op:o,pathArray:n,old:i}=t;if(3===n.length&&"nodes"===n[0]&&"byId"===n[1]){if("add"===o&&!i){const t=n[2],o=e.nodes.getById(t);if(!o)return;if(e.getComponentIdForNode(t)!==this.projectUIState.selection.componentId)return;const{compInstanceId:i="root"}=e.nodes.getSlotAndCompInstanceIdForNodeById(t);if(o.primitiveType===k.sO.COMPONENT)return void this.renderSubtree(t,i);if(!o.compIdOfRootNode){var r;const n=o.slotId||o.parentId||"";if(null!==(r=this.nodeIdNodeElement[i])&&void 0!==r&&r[n]){const r=e.nodes.getNodesDepthInTree(t);this.createAndAddNewNode({nodeId:o.id,parentNodeId:n,depth:r,compInstanceId:i})}return}}if("remove"===o&&"nodes"===n[0]&&i){const{id:e}=i;this.removeNodeAndDescendantsFromDOM(e)}else if("replace"===o){const t=n[2],o=e.nodes.getById(t);if(!o||o.slotId)return;const{compInstanceId:i}=e.nodes.getSlotAndCompInstanceIdForNodeById(t);this.removeNodeAndDescendantsFromDOM(t,i),this.renderSubtree(t,i)}}}))}),"TreeViewWrapper4");this.unsubs.push((()=>e.dispose()))})),(0,N.Z)(this,"subscribeForDragAnchorChanges",(()=>{const e=(0,x.select)(this.projectUIState,["dropFlowStates/treeView/dropAnchor"],(e=>{var t;const o=e.dropFlowStates.treeView.dropAnchor,n=this.nodeSelectionFlow.getArrayOfHoveredNodeIds();if((null===(t=this.projectDoc.nodes.getById(n[0]))||void 0===t?void 0:t.primitiveType)===k.sO.COMPONENT||o&&-1!==(null===o||void 0===o?void 0:o.indexOf("inside"))){if(!n.length||!this.nodeManagementFlow.getNodeChildren(n[0]).length||(0,S.Z)(this,v))return;(0,j.Z)(this,v,setTimeout((()=>{this.nodeSelectionFlow.setExpandedTreeNodeValue(n[0],!0)}),A.iS))}else(0,S.Z)(this,v)&&(clearTimeout((0,S.Z)(this,v)),(0,j.Z)(this,v,null))}),"TreeViewWrapper5");this.unsubs.push((()=>e.dispose()))})),(0,N.Z)(this,"semanticTypeUpdate",(()=>{const e=(0,x.select)(this.projectDoc,["nodes/byId/*/semanticType"],((e,t)=>{t.forEach((t=>{const{pathArray:o}=t;if(4===o.length&&"semanticType"===o[3]){const t=o[2],n=e.nodes.getById(t);if(null!==n&&void 0!==n&&n.compIdOfRootNode)return;const{compInstanceId:i}=e.nodes.getSlotAndCompInstanceIdForNodeById(t);if(this.removeNodeAndDescendantsFromDOM(t,i),this.rootNodeId===t)return void this.renderTreeNodesFromRoot(this.rootNodeId);this.renderSubtree(t,i)}}))}),"TreeViewWrapper6");this.unsubs.push((()=>e.dispose()))})),(0,N.Z)(this,"disableNodeUpdate",(()=>{const e=(0,x.select)(this.projectDoc,["nodes/byId/*/disabled"],((e,t)=>{t.forEach((t=>{const{pathArray:o,value:n}=t;if(4===o.length&&"disabled"===o[3]){const t=o[2],{compInstanceId:i}=e.nodes.getSlotAndCompInstanceIdForNodeById(t);if(n)return void this.removeNodeAndDescendantsFromDOM(t,i);this.renderSubtree(t,i)}}))}),"TreeViewWrapper7");this.unsubs.push((()=>e.dispose()))})),(0,N.Z)(this,"subscribeForSelectedPage",(()=>{const e=(0,x.select)(this.projectUIState,["selection/componentId"],(({selection:e})=>{if(this.rootNodeId&&this.removeNodeAndDescendantsFromDOM(this.rootNodeId),e.componentId&&(this.rootNodeId=this.projectDoc.getRootNodeIdForPageOrComponent(e.componentId),this.rootNodeId))try{"requestIdleCallback"in window&&"function"===typeof requestIdleCallback?requestIdleCallback((()=>{this.rootNodeId&&this.renderTreeNodesFromRoot(this.rootNodeId)})):this.renderTreeNodesFromRoot(this.rootNodeId)}catch(t){this.notificationsManagementFlow.handleErrorAndLogToSentry(t)}}),"TreeViewWrapper7");this.unsubs.push((()=>e.dispose()))})),(0,N.Z)(this,"subscribeForTreeviewSearch",(()=>{const e=(0,x.select)(this.projectUIState,["treeviewSearch/searchTerm"],(({treeviewSearch:e})=>{this.setState({treeviewIsSearched:!!e.searchTerm})}),"TreeViewWrapper8");this.unsubs.push((()=>e.dispose()))})),(0,N.Z)(this,"removeNodeAndDescendantsFromDOM",((e,t)=>{t?this.removeNodeDOM(e,t):Object.keys(this.nodeIdNodeElement).forEach((t=>{this.removeNodeDOM(e,t)}))}))}componentDidMount(){const e=this.projectUIState.selection.componentId;this.rootNodeId=this.projectDoc.getRootNodeIdForPageOrComponent(e||"");try{"requestIdleCallback"in window&&"function"===typeof requestIdleCallback?requestIdleCallback((()=>{this.rootNodeId&&this.renderTreeNodesFromRoot(this.rootNodeId)})):this.rootNodeId&&this.renderTreeNodesFromRoot(this.rootNodeId)}catch(o){this.notificationsManagementFlow.handleErrorAndLogToSentry(o)}var t;(this.subscribeForSelectedPage(),this.subscribeForNodeUpdates(),this.subscribeForTreeViewExpand(),this.subscribeForNodeParentOrPositionUpdates(),this.subscribeForDragAnchorChanges(),this.semanticTypeUpdate(),this.disableNodeUpdate(),this.subscribeForSlotUpdates(),this.subscribeForTreeviewSearch(),this.rootRef.current)&&(this.rootRef.current.addEventListener("keydown",this.handleShortcutsOnTreeNode),this.rootRef.current.addEventListener("focus",this.handleFocus),this.rootRef.current.addEventListener("blur",this.handleBlur),null===(t=this.rootRef.current.parentElement)||void 0===t||t.addEventListener("scroll",this.handleParentScroll),this.nodeHierarchyKeyboardShorcutsSensor.attach(this.rootRef.current))}renderTreeNodesFromRoot(e){var t,o;const n=(null===(t=this.rootRef.current)||void 0===t?void 0:t.children)||[];Array.from(n).forEach((e=>e.remove())),this.projectDoc.nodes.bfs(e,((e,t)=>{this.createAndAddNewNode({nodeId:e.id,parentNodeId:e.slotId||e.parentId||"",depth:t}),this.renderSlotsForNode(e,t,"root")}));const i=null===(o=this.nodeIdNodeElement.root[e])||void 0===o?void 0:o.domNode;var r;i&&(null===(r=this.rootRef.current)||void 0===r||r.append(i))}renderSlotsForNode(e,t,o){if(!("slottedNodes"in e))return;let n=Object.keys(e.slottedNodes||{});if(this.projectDoc.nodes.nodeIsCompInstance(e)){const t=this.projectDoc.components.byId[e.compIdOfCompInstance];n=Object.keys((null===t||void 0===t?void 0:t.slots)||{})}n.forEach((n=>{var i;this.createAndAddNewNode({nodeId:n,depth:t+1,compInstanceId:e.id,parentNodeId:e.id,slotParentCompInstanceId:o}),this.projectDoc.nodes.orderChildrenIds(Object.keys((null===(i=e.slottedNodes)||void 0===i?void 0:i[n])||{})).forEach((t=>{this.renderSubtree(t,e.id)}))}))}renderSubtree(e,t){const o=this.projectDoc.nodes.getNodesDepthInTree(e);this.projectDoc.nodes.bfs(e,((e,n)=>{this.createAndAddNewNode({nodeId:e.id,parentNodeId:e.slotId||e.parentId||"",depth:o+n,compInstanceId:t}),this.renderSlotsForNode(e,n+o,t||"root")}))}toggleAndUntoggleNodes(e,t,o){const n=this.projectDoc.nodes.getById(e);if(n&&this.projectDoc.nodes.nodeIsCompInstance(n)){const e=this.projectDoc.components.byId[n.compIdOfCompInstance];Object.keys((null===e||void 0===e?void 0:e.slots)||{}).forEach((e=>{var o,i;const r=null===(o=this.nodeIdNodeElement[n.id])||void 0===o||null===(i=o[e])||void 0===i?void 0:i.domNode;r&&(r.style.display=t)}))}else if((null===n||void 0===n?void 0:n.primitiveType)!==k.sO.SLOT)Object.keys(n&&"childrenIds"in n?n.childrenIds:{}).forEach((e=>{var n,i;const r=null===(n=this.nodeIdNodeElement[o])||void 0===n||null===(i=n[e])||void 0===i?void 0:i.domNode;r&&(r.style.display=t)})),Object.keys(n&&"slottedNodes"in n?n.slottedNodes:{}).forEach((o=>{var n;const i=null===(n=this.nodeIdNodeElement[e][o])||void 0===n?void 0:n.domNode;i&&(i.style.display=t)})),Object.values(n&&"stateNodeRoots"in n?n.stateNodeRoots:{}).forEach((e=>{var n,i;const r=null===(n=this.nodeIdNodeElement[o])||void 0===n||null===(i=n[e])||void 0===i?void 0:i.domNode;r&&(r.style.display=t)})),Object.values(n&&"mappings"in n?n.mappings:{}).forEach((e=>{var n,i;if(!e.componentInstanceId)return;const r=null===(n=this.nodeIdNodeElement[o])||void 0===n||null===(i=n[e.componentInstanceId])||void 0===i?void 0:i.domNode;r&&(r.style.display=t)}));else{const e=this.projectDoc.nodes.getById(o);Object.keys((null===e||void 0===e?void 0:e.slottedNodes[n.id])||{}).forEach((e=>{var n,i;const r=null===(n=this.nodeIdNodeElement[o])||void 0===n||null===(i=n[e])||void 0===i?void 0:i.domNode;r&&(r.style.display=t)}))}}removeNodeDOM(e,t){var o,n,i;const r=null===(o=this.nodeIdNodeElement[t])||void 0===o||null===(n=o[e])||void 0===n?void 0:n.domNode;if(!r)return;this.nodeManagementFlow.getNodeChildren(e,t).forEach((e=>this.removeNodeAndDescendantsFromDOM(e))),C.unmountComponentAtNode(r.children[0]),null===(i=this.nodeIdNodeElement[t][e])||void 0===i||i.domNode.remove(),delete this.nodeIdNodeElement[t][e]}componentWillUnmount(){var e,t,o,n,i;this.rootNodeId&&this.removeNodeAndDescendantsFromDOM(this.rootNodeId),this.unsubs.forEach((e=>e())),this.unsubs=[],this.nodeHierarchyKeyboardShorcutsSensor.detach(),null===(e=this.rootRef.current)||void 0===e||e.removeEventListener("keydown",this.handleShortcutsOnTreeNode),null===(t=this.rootRef.current)||void 0===t||t.removeEventListener("focus",this.handleFocus),null===(o=this.rootRef.current)||void 0===o||o.removeEventListener("blur",this.handleBlur),null===(n=this.rootRef.current)||void 0===n||null===(i=n.parentElement)||void 0===i||i.removeEventListener("scroll",this.handleParentScroll)}render(){return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(R.b,{area:"treeview"}),(0,Z.jsx)("div",{ref:this.rootRef,tabIndex:0,"data-component-id":this.projectUIState.selection.componentId,"data-tree-view":!0,contentEditable:!0,spellCheck:!1,className:"jsx-2750565031 "+O().dynamic([["3301785389",[_.DM.GRAY_800,this.state.treeviewIsSearched?"display: initial !important;":"",L]]])+" tree-view"}),(0,Z.jsx)(O(),{id:"3301785389",dynamic:[_.DM.GRAY_800,this.state.treeviewIsSearched?"display: initial !important;":"",L],children:[`.tree-node-wrapper{color:${_.DM.GRAY_800};position:relative;width:100%;${this.state.treeviewIsSearched?"display: initial !important;":""};}`,".fake-element{content:'';position:absolute;top:0;left:-1px;height:100%;}",`.${L}{position:relative;z-index:10;width:100%;}`]}),(0,Z.jsx)(O(),{id:"2750565031",children:["[data-component-id].jsx-2750565031{-webkit-flex:1;-ms-flex:1;flex:1;position:relative;}",".tree-view.jsx-2750565031{outline:none;box-shadow:none;padding-top:2px;cursor:default;caret-color:transparent;}"]})]})}},u=(0,D.Z)(p.prototype,"projectDoc",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=(0,D.Z)(p.prototype,"projectUIState",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=(0,D.Z)(p.prototype,"nodeSelectionFlow",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=(0,D.Z)(p.prototype,"notificationsManagementFlow",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=(0,D.Z)(p.prototype,"positioningService",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=(0,D.Z)(p.prototype,"nodeManagementFlow",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=(0,D.Z)(p.prototype,"localHistoryStackFlow",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=(0,D.Z)(p.prototype,"domainNodeToTreeNodeMapper",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p)},68311:function(e,t,o){"use strict";o.d(t,{b:function(){return I}});var n,i,r,s=o(503348),a=o(777460),c=o(918437),l=o(676422),d=o.n(l),p=o(202784),u=o(302503),h=o(332139),m=o(395942),y=o(505892),g=o(173541),f=o(781872),b=o(552322);let I=(n=(0,u.inject)("projectUIState"),i=class extends p.PureComponent{constructor(...e){super(...e),(0,s.Z)(this,"projectUIState",r,this),(0,a.Z)(this,"state",{expanded:!1}),(0,a.Z)(this,"handleSearch",(e=>{switch(this.props.area){case"treeview":(0,m.mutate)(this.projectUIState,(t=>{t.treeviewSearch.searchTerm=e}));break;case"layers":(0,m.mutate)(this.projectUIState,(t=>{t.layersSearchText=e,t.componentList.currentComponentSearch=e}))}})),(0,a.Z)(this,"handleToggleExpanded",(()=>{this.handleReset(),this.setState({expanded:!this.state.expanded})}))}handleReset(){switch(this.props.area){case"treeview":(0,m.mutate)(this.projectUIState,(e=>{e.treeviewSearch.searchTerm=""}));break;case"layers":(0,m.mutate)(this.projectUIState,(e=>{e.layersSearchText="",e.componentList.currentComponentSearch=""}))}}render(){let e="";switch(this.props.area){case"treeview":e="Name, Id, Class, Tag...";break;case"layers":e="Search by Name..."}return(0,b.jsxs)("div",{className:d().dynamic([["3426192578",[f.kg.ONEHUNDRED,this.state.expanded?"100%":"32px",f.N_.HALF_UNIT,this.state.expanded?f.DM.GRAY_200:"transparent",f.N_.HALF_UNIT,this.state.expanded?"0":f.N_.HALF_UNIT]]])+" search-wrapper",children:[this.state.expanded?(0,b.jsxs)("div",{className:d().dynamic([["3426192578",[f.kg.ONEHUNDRED,this.state.expanded?"100%":"32px",f.N_.HALF_UNIT,this.state.expanded?f.DM.GRAY_200:"transparent",f.N_.HALF_UNIT,this.state.expanded?"0":f.N_.HALF_UNIT]]])+" search-bar-wrapper",children:[(0,b.jsx)("div",{className:d().dynamic([["3426192578",[f.kg.ONEHUNDRED,this.state.expanded?"100%":"32px",f.N_.HALF_UNIT,this.state.expanded?f.DM.GRAY_200:"transparent",f.N_.HALF_UNIT,this.state.expanded?"0":f.N_.HALF_UNIT]]])+" input-wrapper",children:(0,b.jsx)(h.M,{id:"treeview-search",onType:this.handleSearch,initialValue:this.projectUIState.treeviewSearch.searchTerm,placeholder:e,autofocusOnMount:!0})}),(0,b.jsx)(g.z,{style:"transparent",shape:"square",colorScheme:"neutral",onClick:this.handleToggleExpanded,children:(0,b.jsx)(y.J,{type:"actions/close",size:12})})]}):(0,b.jsx)("div",{className:d().dynamic([["3426192578",[f.kg.ONEHUNDRED,this.state.expanded?"100%":"32px",f.N_.HALF_UNIT,this.state.expanded?f.DM.GRAY_200:"transparent",f.N_.HALF_UNIT,this.state.expanded?"0":f.N_.HALF_UNIT]]])+" toggle-button-wrapper",children:(0,b.jsx)(g.z,{onClick:this.handleToggleExpanded,shape:"square",style:"transparent",colorScheme:"neutral",children:(0,b.jsx)(y.J,{type:"search",size:12})})}),(0,b.jsx)(d(),{id:"3426192578",dynamic:[f.kg.ONEHUNDRED,this.state.expanded?"100%":"32px",f.N_.HALF_UNIT,this.state.expanded?f.DM.GRAY_200:"transparent",f.N_.HALF_UNIT,this.state.expanded?"0":f.N_.HALF_UNIT],children:[`.search-wrapper.__jsx-style-dynamic-selector{position:absolute;right:0;z-index:${f.kg.ONEHUNDRED};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:${this.state.expanded?"100%":"32px"};min-height:32px;padding:0 ${f.N_.HALF_UNIT};background-color:${this.state.expanded?f.DM.GRAY_200:"transparent"};}`,`.search-bar-wrapper.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;gap:${f.N_.HALF_UNIT};}`,".input-wrapper.__jsx-style-dynamic-selector{-webkit-flex:1;-ms-flex:1;flex:1;}",`.toggle-button-wrapper.__jsx-style-dynamic-selector{position:absolute;right:0px;top:0px;padding-right:${this.state.expanded?"0":f.N_.HALF_UNIT};}`]})]})}},r=(0,c.Z)(i.prototype,"projectUIState",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i)},424879:function(e,t,o){"use strict";o.d(t,{C:function(){return n},E:function(){return i}});const n=["selection/nodes","selection/nodes/*","selection/nodeInstanceIds/*","selection/nodeInstanceIds"],i=["hover/hoveredNodeInstanceId"]},465951:function(e,t,o){"use strict";o.d(t,{WW:function(){return n},nS:function(){return i},tB:function(){return r}});const n=["error","loading","empty"];let i;!function(e){e.eq="eq",e.neq="neq",e.gt="gt",e.lt="lt",e.gte="gte",e.lte="lte"}(i||(i={}));const r={[i.eq]:"=",[i.neq]:"\u2260",[i.gt]:">",[i.lt]:"<",[i.gte]:">=",[i.lte]:"<="}},322831:function(e,t,o){"use strict";o.d(t,{w:function(){return q}});var n=o(503348),i=o(777460),r=o(918437),s=o(302503),a=o(395942),c=o(500310),l=o(444370);function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const u=e=>({name:e,node:{type:"element",content:{elementType:"container",semanticType:"div",name:e,referencedStyles:{},abilities:{},style:{flex:{type:"static",content:"0 0 auto"},width:{type:"static",content:"100%"},height:{type:"static",content:"auto"},display:{type:"static",content:"flex"},alignItems:{type:"static",content:"center"},justifyContent:{type:"static",content:"center"}},children:[]}}}),h=(p({},u("Features")),p({},u("Pricing")),p({},u("Banner")),p({},u("FAQ")),p({},u("Footer")),e=>({name:e+"Instance",node:{type:"element",content:{elementType:"component",dependency:{type:"local"},semanticType:e,referencedStyles:{},abilities:{},attrs:{rootClassName:{type:"comp-style",content:"rootClassName"}},children:[]}}}));var m,y,g,f,b,I,v,w,N,j,S,D,T,O,F,C,E,x,_,M,P,A,k,U,R,Z=o(641673),L=o(255328),$=o(442657),B=o(422169),G=o(909967),H=o(781872),z=o(986897),Y=o(378888),V=o(436035);function W(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function K(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?W(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):W(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let q;!function(e){e.NOT_ENOUGH_WORDS="NOT_ENOUGH_WORDS",e.NO_TEXT="NO_TEXT"}(q||(q={}));const J=["avatar","profile","person","face","character","people"],X=["googlemap","url"];m=(0,s.provide)("aiContentGenerationFlow"),y=(0,s.inject)("projectUIState"),g=(0,s.inject)("projectDoc"),f=(0,s.inject)("sharedbProjectSyncService"),b=(0,s.inject)("sessionStorageService"),I=(0,s.inject)("clipboardFlow"),v=(0,s.inject)("aiRepository"),w=(0,s.inject)("unsplashFlow"),N=(0,s.inject)("nodeManagementFlow"),j=(0,s.inject)("pexelFlow"),S=(0,s.inject)("predefinedPagesManagementFlow"),D=(0,s.inject)("modalManagementFlow"),m((O=class{constructor(){(0,n.Z)(this,"projectUIState",F,this),(0,n.Z)(this,"projectDoc",C,this),(0,n.Z)(this,"dbSync",E,this),(0,n.Z)(this,"sessionStorageService",x,this),(0,n.Z)(this,"clipboardFlow",_,this),(0,n.Z)(this,"aiRepository",M,this),(0,n.Z)(this,"unsplashFlow",P,this),(0,n.Z)(this,"nodeManagementFlow",A,this),(0,n.Z)(this,"pexelFlow",k,this),(0,n.Z)(this,"predefinedPagesManagementFlow",U,this),(0,n.Z)(this,"modalManagementFlow",R,this),(0,i.Z)(this,"generateTextAlternative",(async e=>{var t;const{currentLanguage:o=V.P}=null!==(t=this.projectUIState.internationalization)&&void 0!==t?t:{},{pageSummary:n,initialText:i,textElementType:r,pageName:s,command:a}=e;try{return await this.aiRepository.generateTextAlternative(this.projectDoc.id,i,r,a,s,n,o.name)}catch(c){return null}})),(0,i.Z)(this,"generateTextAlternativeForMultipleTexts",(async e=>{const{metadata:t,maxBatchSize:o=10}=e,n={},i=t.map((e=>{var t,o,i;if(!e.nodeData)return K({},e);const r=(0,Y.Ox)();n[r]=e.nodeData;const s=1===Object.keys(e.textsToRewrite).length,a=(null===(t=Object.values(e.textsToRewrite)[0])||void 0===t?void 0:t.length)<3;return s&&a?null:K(K({},e),{},{textsOrder:null!==(o=e.textsOrder)&&void 0!==o&&o.length?e.textsOrder:void 0,contextTextContent:null!==(i=e.contextTextContent)&&void 0!==i&&i.length?e.contextTextContent:void 0,nodeData:void 0,nodeDataMappingId:r})})).filter((e=>e)),r=(null!==i&&void 0!==i?i:[]).filter((e=>{var t;return Object.keys(null!==(t=null===e||void 0===e?void 0:e.textsToRewrite)&&void 0!==t?t:{}).length}));if(!r.length)return[];const s=Array.from({length:Math.ceil(r.length/o)},((e,t)=>r.slice(t*o,(t+1)*o))).map(((t,o)=>new Promise((n=>{const i=1200*Math.floor(o/5);setTimeout((async()=>{try{const o=await this.fetchNodesAlternativeAndParse(e,t);n(o)}catch(o){console.error(`Could not generate text alternatives for multiple nodes: ${o}`),n(null)}}),i)})))),a=(await Promise.all(s)).filter((e=>e)).reduce(((e,t)=>(t&&e.push(...t),e)),[]);try{return a.map((e=>Object.keys(e).length?e.nodeDataMappingId&&n[e.nodeDataMappingId]?K(K({},e),{},{nodeData:n[e.nodeDataMappingId]}):K({},e):null)).filter((e=>!!e))}catch(c){throw new Error("invalid_response")}})),(0,i.Z)(this,"fetchNodesAlternativeAndParse",(async(e,t,o=0)=>{const{summary:n,pageName:i="Home",command:r,newLanguage:s}=e;if(o>3)return null;try{const c=await this.aiRepository.generateTextAlternativeForMultipleNodes(this.projectDoc.id,t,r,i,n,s);if("string"===typeof c){let n="";try{n=this.removeCommentsAndNewlines(c);const i=JSON.parse(n);return Array.isArray(i)?i:(console.error(`Invalid AI response: ${c}`),await new Promise((e=>setTimeout(e,200))),this.fetchNodesAlternativeAndParse(e,t,o+1))}catch(a){return console.error(`Could not parse AI response: ${c}`),await new Promise((e=>setTimeout(e,200))),this.fetchNodesAlternativeAndParse(e,t,o+1)}}if(Array.isArray(c))return c}catch(a){if(o<3)return await new Promise((e=>setTimeout(e,500))),this.fetchNodesAlternativeAndParse(e,t,o+1)}return null})),(0,i.Z)(this,"generateContentForSection",(async(e,t,o)=>{const n={summary:"",keywords:[]};let{summary:i,keywords:r}=o?n:await this.generateSummaryForCurrentPage(!0)||n;if(!i&&o){var s;const e=this.sessionStorageService.get(c.f.AI_DATA);if(!e)return{};const t=await this.aiRepository.getSummaryFromText(this.projectDoc.id,e.prompt);r=null!==(s=t.keywords)&&void 0!==s?s:[e.prompt],i=t.summary.length>e.prompt.length?t.summary:e.prompt}const a={},l={},d={};Object.keys(t).forEach((e=>{X.some((t=>e.toLowerCase().includes(t)))||(-1!==e.toLowerCase().indexOf("src")?-1!==e.toLowerCase().indexOf("video")?d[e]=t[e]:l[e]=t[e]:a[e]=`Example value for ${e}`)}));const[p,u,h]=await Promise.all([this.generateContentForTextFields(i,e,a),this.generateContentForImageFields(l,r),this.generateContentForVideoFields(d,r)]);return K(K(K({},p),u),h)})),(0,i.Z)(this,"extractSummaryFromPage",(async e=>{var t,o,n,i,r;const{pageId:s,allowOlderSummaryInMinutes:a,minWords:c,useAIProjectPromptAsFallback:l=!0}=null!==e&&void 0!==e?e:{},d=this.projectDoc.pages.getHomePageId(),p=null!==s&&void 0!==s?s:d;if(!p)return null;let u=this.projectDoc.getProjectPageOrComponent(p);if("component"===(null===(t=u)||void 0===t?void 0:t.type)&&d&&(u=this.projectDoc.getProjectPageOrComponent(d)),!u||!u.rootNodeId||"component"===(null===(o=u)||void 0===o?void 0:o.type))return null;if(a&&Object.keys(null!==(n=u.aiGeneratedSummaries)&&void 0!==n?n:{})){var h;const e=Object.keys(null!==(h=u.aiGeneratedSummaries)&&void 0!==h?h:{}).find((e=>{const t=new Date(e);return((new Date).getTime()-t.getTime())/6e4<a}));if(e)return u.aiGeneratedSummaries[e]}const m=this.extractTextNodesFromPage(u).filter((e=>e.length>3));if(!m.length)throw new Error(q.NO_TEXT);if(c){if(m.join(" ").split(" ").length<c)throw new Error(q.NOT_ENOUGH_WORDS)}const y=Array.from(new Set(m)).join("__"),g=await this.aiRepository.getSummaryFromText(this.projectDoc.id,y),f=null!==(i=g.keywords)&&void 0!==i?i:[];let b=g.summary;return b||l?(null!==(r=b)&&void 0!==r&&r.length&&this.dbSync.mutate(this.projectDoc,(e=>{const t=e.pages.byId[p];t&&(t.aiGeneratedSummaries||(t.aiGeneratedSummaries={}),t.aiGeneratedSummaries[(new Date).toISOString()]={summary:b,keywords:f})})),!b&&l&&(b=this.projectUIState.AIProjectPrompts.map((e=>e.prompt)).join("\n")),{keywords:f,summary:b}):null})),(0,i.Z)(this,"checkAndBeginGeneration",(async()=>{const e=this.sessionStorageService.get(c.f.AI_DATA);if(!e)return;const{version:t}=e,o=this.projectDoc.pages.getHomePageId();if(!o)return;const n=this.predefinedPagesManagementFlow.populatePage({pageType:$.pV.Landing,version:t||0,withAI:!0,targetPageId:o,useAIPrompt:!0}),i=B.d.createCustomModal({Component:G.S,onDismiss:()=>{this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(i,{},!1,!1,{zIndex:H.kg.MAX}),await n,setTimeout((()=>this.modalManagementFlow.hideModal()),z.gS),this.sessionStorageService.set(c.f.AI_DATA,void 0)})),(0,i.Z)(this,"checkAndUpdateZoomLevel",(()=>{this.sessionStorageService.get(c.f.AI_DATA)&&(0,a.mutate)(this.projectUIState,(({userPreferences:e})=>{e.zoomLevel=l.k[1]}))})),(0,i.Z)(this,"extractTextNodesStartingFromNode",((e,t)=>{const o=[];return this.projectDoc.nodes.bfs(e,(e=>{if("component-instance-node"!==e.type)"element-node"===e.type&&e.contentChildren&&Object.values(e.contentChildren).forEach((e=>{if("static"===e.type&&o.push(`${e.content}`),"dynamic"===e.type&&"prop"===e.content.referenceType){const n=t[e.content.id];if(!n)return;if("richtext"===n.type)return void o.push(...this.extractTextNodesStartingFromNode(n.defaultHierarchyRootId,t));o.push(`${n.defaultValue}`)}}));else{const t=this.projectDoc.components.byId[e.compIdOfCompInstance];if(!t)return;o.push(...this.extractTextNodesFromPage(t))}})),o})),(0,i.Z)(this,"addUIDLToNode",(async(e,t,o,n,i)=>{const r=Array.isArray(e)?e:[e];await this.clipboardFlow.pasteCopiedUIDL({nodeId:o,elementUIDLs:[...r],componentUIDLs:t,designTokens:{},textStyles:{},classes:{},globals:{settings:{title:"AI Generate Page",language:"english"},meta:[],assets:[]},assetNames:{},doc:n,isForPreview:i})})),(0,i.Z)(this,"removeCommentsAndNewlines",(e=>{(e=(e=(e=(e=e.replace(/\/\/.*(?=\n)/g,"")).replace(/\/\*[\s\S]*?\*\//g,"")).replace(/\n/g,"").trim()).replace(/\.\.\./g,"")).startsWith("[{")&&e.endsWith("}]}")&&(e=e.slice(0,-1));return this.checkImproperDoubleQuotesInString(e)&&(e=this.fixImproperDoubleQuotesInString(e)),e})),(0,i.Z)(this,"fixImproperDoubleQuotesInString",(e=>e.replace(/"([^"]+)":\s*""([^"]*)""/g,((e,t,o)=>`"${t}": "${o}"`)))),(0,i.Z)(this,"checkImproperDoubleQuotesInString",(e=>null!==/"([^"]+)":\s*""[^"]*""/g.exec(e))),(0,i.Z)(this,"generateContentForTextFields",(async(e,t,o)=>{var n;if(!Object.keys(o).length)return{};const{currentLanguage:i=V.P}=null!==(n=this.projectUIState.internationalization)&&void 0!==n?n:{};return await this.aiRepository.generateContentForSection(e,`For a ${t} section. ONLY OUTPUT JSON, NO OTHER EXPLANATIONS.\n      Example: ${JSON.stringify(o,null,2)}`,null===i||void 0===i?void 0:i.name)})),(0,i.Z)(this,"generateContentForImageFields",(async(e,t)=>{if(!Object.keys(e).length||!t.length)return{};const o=[];Object.keys(e).forEach((t=>{(-1!==t.toLowerCase().indexOf("avatar")||-1!==t.toLowerCase().indexOf("author")||-1!==t.toLowerCase().indexOf("member"))&&(o.push(t),delete e[t])})),Object.keys(e).forEach((t=>{-1!==t.toLowerCase().indexOf("logo")&&delete e[t]}));const[n,i]=await Promise.all([this.unsplashFlow.getRandomPhotoUrls(t,Object.keys(e).length),o.length?this.unsplashFlow.getRandomPhotoUrls(J,o.length):[]]),r=Object.keys(e).reduce(((e,t,o)=>(e[t]=n[o],e)),{}),s=o.reduce(((e,t,o)=>(e[t]=i[o],e)),{});return K(K({},r),s)})),(0,i.Z)(this,"generateContentForVideoFields",(async(e,t)=>{if(!Object.keys(e).length||!t.length)return{};const o=await this.pexelFlow.getRandomVideoUrls(t,Object.keys(e).length);return Object.keys(e).reduce(((e,t,n)=>{var i,r;const s=t.replace("Src","Poster");return e[t]=null!==(i=o[n].url)&&void 0!==i?i:"",e[s]=null!==(r=o[n].poster)&&void 0!==r?r:"Video Poster",e}),{})}))}async addDefaultNodesForSectionsToPreviewPage(e){const{sections:t,pageId:o,doc:n}=e;if(!n)return;const i=n.pages.byId[o];if(!i||!i.rootNodeId)return;const r=n.pages.getHomePageId(),s=n.pages.byId[null!==r&&void 0!==r?r:""];if(!s||!s.rootNodeId)throw new Error("Tried to add default node for sections and home page is missing or it does not have a root node.");const a=t.map((e=>{const t=(0,Z.kC)(e);return u(t)})),c=n.components.getComponentByName("header",!0),l=n.components.getComponentByName("footer",!0);if(c){const e=h(c.title);a.unshift(e)}if(l){const e=h(l.title);a.push(e)}if(!c){let e=null;n.nodes.bfs(s.rootNodeId,(t=>{var o;"header"===(null===(o=t.name)||void 0===o?void 0:o.toLowerCase())&&(e=t)})),e&&this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:[e],targetId:i.rootNodeId,doc:n})}if(await this.addUIDLToNode(a,{},i.rootNodeId,n,!0),!l){let e=null;n.nodes.bfs(s.rootNodeId,(t=>{var o;"footer"===(null===(o=t.name)||void 0===o?void 0:o.toLowerCase())&&(e=t)})),e&&this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:[e],targetId:i.rootNodeId,doc:n})}}async generateSummaryForCurrentPage(e=!1){const t=this.projectUIState.selection.componentId;if(!t&&!e)return this.generateSummaryForCurrentPage(!0);try{return await this.extractSummaryFromPage(K(K({},e||!t?{}:{pageId:t}),{},{minWords:20,allowOlderSummaryInMinutes:1,useAIProjectPromptAsFallback:!1}))}catch(o){if((o.message===q.NOT_ENOUGH_WORDS||o.message===q.NO_TEXT)&&!e){return this.projectDoc.pages.getHomePageId()===t?null:this.generateSummaryForCurrentPage(!0)}return null}}extractTextNodesFromPage(e){var t;if(null===e||void 0===e||!e.rootNodeId)return[];const o=null!==(t=e.propDefinitions)&&void 0!==t?t:{};return this.extractTextNodesStartingFromNode(e.rootNodeId,o)}},F=(0,r.Z)(O.prototype,"projectUIState",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=(0,r.Z)(O.prototype,"projectDoc",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=(0,r.Z)(O.prototype,"dbSync",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=(0,r.Z)(O.prototype,"sessionStorageService",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=(0,r.Z)(O.prototype,"clipboardFlow",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=(0,r.Z)(O.prototype,"aiRepository",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=(0,r.Z)(O.prototype,"unsplashFlow",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=(0,r.Z)(O.prototype,"nodeManagementFlow",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=(0,r.Z)(O.prototype,"pexelFlow",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=(0,r.Z)(O.prototype,"predefinedPagesManagementFlow",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=(0,r.Z)(O.prototype,"modalManagementFlow",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,r.Z)(O.prototype,"addDefaultNodesForSectionsToPreviewPage",[L.P],Object.getOwnPropertyDescriptor(O.prototype,"addDefaultNodesForSectionsToPreviewPage"),O.prototype),T=O))},174832:function(e,t,o){"use strict";o.d(t,{AS:function(){return f},NN:function(){return b},wp:function(){return I},tx:function(){return v},AM:function(){return w},ML:function(){return N},d1:function(){return j},ru:function(){return S},H:function(){return D},Uz:function(){return T},TU:function(){return O},cq:function(){return F},S3:function(){return C},$x:function(){return E},jV:function(){return x},y9:function(){return _},$p:function(){return M}});var n=o(777460),i=o(676422),r=o.n(i),s=(o(202784),o(781872)),a=o(641673),c=o(138743),l=o(505892),d=o(829470),p=o(492080),u=o(378888),h=o(329852),m=o(552322);function y(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function g(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?y(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):y(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const f=e=>-1!==e.indexOf(p.Xh)||-1!==e.indexOf(p.Wn),b=(e,t,o)=>Math.hypot(t.x-e.x,t.y-e.y)>o,I=e=>!!e.includes(h.D.PRIVATE_ASSETS)||!!e.includes(h.D.PUBLIC_ASSETS),v=(e,t,o)=>{let n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const a=[];e.length?e.forEach((e=>{const t=o({nodeInstanceId:e});if(!t)return{};a.push(t)})):t.forEach((e=>{const t=o({nodeId:e});if(!t)return{};a.push(t)})),a.forEach((e=>{const t=e.getBoundingClientRect(),o=(0,u.AO)(e),{bottom:a,left:c,right:l,top:d}=t;c*o<n&&(n=c*o),d*o<i&&(i=d*o),l*o>r&&(r=l*o),a*o>s&&(s=a*o)}));return{selectionLeft:n,selectionRight:r,selectionTop:i,selectionBottom:s,width:r-n,height:s-i}},w=(e,t)=>(0,m.jsx)("div",{className:r().dynamic([["126585125",[e,t,s.DM.ACCENT_500]]])+" drag-indicator-rectangle",children:(0,m.jsx)(r(),{id:"126585125",dynamic:[e,t,s.DM.ACCENT_500],children:[`.drag-indicator-rectangle.__jsx-style-dynamic-selector{width:${e}px;height:${t}px;position:relative;background-color:rgba(0,0,0,0.1);border-width:1px;border-style:dashed;border-color:${s.DM.ACCENT_500};}`]})}),N=e=>{const t=e.split("/"),o=-1!==e.indexOf(p.Xh),n=-1!==e.indexOf(p.Wn),i=!o&&!n,a=t[t.length-1];return(0,m.jsxs)("div",{className:r().dynamic([["3581742910",[s.DM.GRAY_400,s.N_.HALF_UNIT]]])+" file-drag-indicator-root",children:[i?a:`Cannot drag from or inside ${o?"teleport":"public"} folder`,(0,m.jsx)(r(),{id:"3581742910",dynamic:[s.DM.GRAY_400,s.N_.HALF_UNIT],children:[`.file-drag-indicator-root.__jsx-style-dynamic-selector{background:${s.DM.GRAY_400};padding:${s.N_.HALF_UNIT};}`]})]})},j=(e,t,o)=>{if(I(t))return null;const n=t.length+o.length;return(0,m.jsxs)("div",{className:r().dynamic([["998047635",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT,s.DM.ACCENT_500,s.n_.ROUND,s.DM.GRAY_1000]]])+" asset-folder-drag-indicator",children:[e.icon&&(0,m.jsx)(l.J,{type:e.icon,size:32}),(0,m.jsx)("div",{className:r().dynamic([["998047635",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT,s.DM.ACCENT_500,s.n_.ROUND,s.DM.GRAY_1000]]])+" name-wrapper",children:(0,m.jsx)("span",{className:r().dynamic([["998047635",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT,s.DM.ACCENT_500,s.n_.ROUND,s.DM.GRAY_1000]]]),children:e.name})}),n>1&&(0,m.jsx)("div",{className:r().dynamic([["998047635",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT,s.DM.ACCENT_500,s.n_.ROUND,s.DM.GRAY_1000]]])+" item-count",children:n}),(0,m.jsx)(r(),{id:"998047635",dynamic:[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT,s.DM.ACCENT_500,s.n_.ROUND,s.DM.GRAY_1000],children:[`.asset-folder-drag-indicator.__jsx-style-dynamic-selector{width:88px;height:88px;border-radius:${s.n_.DEFAULT};background-color:${s.DM.GRAY_100};padding:8px 10px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`,`.name-wrapper.__jsx-style-dynamic-selector{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-top:${s.N_.UNIT};}`,".name-wrapper.__jsx-style-dynamic-selector span.__jsx-style-dynamic-selector{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}",`.item-count.__jsx-style-dynamic-selector{position:absolute;top:-10px;right:-10px;width:20px;height:20px;background-color:${s.DM.ACCENT_500};border-radius:${s.n_.ROUND};color:${s.DM.GRAY_1000};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`]})]})},S=e=>(0,m.jsxs)("div",{className:r().dynamic([["4247556767",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT]]])+" folder-drag-indicator",children:[e.icon&&(0,m.jsx)(l.J,{type:e.icon,size:32}),(0,m.jsx)("div",{className:r().dynamic([["4247556767",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT]]])+" name-wrapper",children:(0,m.jsx)("span",{className:r().dynamic([["4247556767",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT]]]),children:e.name})}),(0,m.jsx)(r(),{id:"4247556767",dynamic:[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT],children:[`.folder-drag-indicator.__jsx-style-dynamic-selector{width:88px;height:88px;border-radius:${s.n_.DEFAULT};background-color:${s.DM.GRAY_100};padding:8px 10px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`,`.name-wrapper.__jsx-style-dynamic-selector{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-top:${s.N_.UNIT};}`,".name-wrapper.__jsx-style-dynamic-selector span.__jsx-style-dynamic-selector{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}"]})]}),D=(e,t,o)=>(0,m.jsxs)("div",{className:r().dynamic([["3375063513",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT,s.DM.GRAY_900,s.DM.ACCENT_500,s.n_.ROUND,s.DM.GRAY_1000]]])+" drag-indicator",children:[(0,m.jsx)(l.J,{type:e,size:32}),t&&(0,m.jsx)("div",{className:r().dynamic([["3375063513",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT,s.DM.GRAY_900,s.DM.ACCENT_500,s.n_.ROUND,s.DM.GRAY_1000]]])+" drag-label-wrapper",children:(0,m.jsx)("span",{className:r().dynamic([["3375063513",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT,s.DM.GRAY_900,s.DM.ACCENT_500,s.n_.ROUND,s.DM.GRAY_1000]]]),children:t})}),o&&o>1&&(0,m.jsx)("div",{className:r().dynamic([["3375063513",[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT,s.DM.GRAY_900,s.DM.ACCENT_500,s.n_.ROUND,s.DM.GRAY_1000]]])+" item-count",children:o}),(0,m.jsx)(r(),{id:"3375063513",dynamic:[s.n_.DEFAULT,s.DM.GRAY_100,s.N_.UNIT,s.DM.GRAY_900,s.DM.ACCENT_500,s.n_.ROUND,s.DM.GRAY_1000],children:[`.drag-indicator.__jsx-style-dynamic-selector{width:88px;height:88px;border-radius:${s.n_.DEFAULT};background-color:${s.DM.GRAY_100};padding:8px 10px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`,`.drag-label-wrapper.__jsx-style-dynamic-selector{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-top:${s.N_.UNIT};}`,"span.__jsx-style-dynamic-selector{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}",`.drag-indicator.__jsx-style-dynamic-selector svg{fill:${s.DM.GRAY_900};}`,`.item-count.__jsx-style-dynamic-selector{position:absolute;top:-10px;right:-10px;width:20px;height:20px;background-color:${s.DM.ACCENT_500};border-radius:${s.n_.ROUND};color:${s.DM.GRAY_1000};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`]})]}),T=e=>(0,m.jsxs)("div",{className:r().dynamic([["3334341047",[e.value,s.E6.DARK_DROP_DOWN,(0,a.lF)(e.value)]]])+" color-token-square",children:[(0,m.jsx)("span",{className:r().dynamic([["3334341047",[e.value,s.E6.DARK_DROP_DOWN,(0,a.lF)(e.value)]]])+" token-name",children:e.name}),(0,m.jsx)(r(),{id:"3334341047",dynamic:[e.value,s.E6.DARK_DROP_DOWN,(0,a.lF)(e.value)],children:[`.color-token-square.__jsx-style-dynamic-selector{width:35px;height:35px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:${e.value};box-shadow:${s.E6.DARK_DROP_DOWN};border-radius:4px;}`,`.token-name.__jsx-style-dynamic-selector{font-size:11px;font-weight:700;max-width:100;text-overflow:ellipsis;padding:2px;overflow:hidden;color:${(0,a.lF)(e.value)};}`]})]}),O=e=>(0,m.jsxs)("div",{className:r().dynamic([["777324625",[s.N_.UNIT,s.N_.TWO_UNITS,s.DM.GRAY_300,s.N_.UNIT,s.DM.GRAY_700,s.N_.UNIT]]])+" layout-token-container",children:[(0,m.jsx)("span",{className:r().dynamic([["777324625",[s.N_.UNIT,s.N_.TWO_UNITS,s.DM.GRAY_300,s.N_.UNIT,s.DM.GRAY_700,s.N_.UNIT]]])+" layout-token-name",children:e.name}),(0,m.jsx)("span",{className:r().dynamic([["777324625",[s.N_.UNIT,s.N_.TWO_UNITS,s.DM.GRAY_300,s.N_.UNIT,s.DM.GRAY_700,s.N_.UNIT]]])+" layout-token-value",children:e.value}),(0,m.jsx)(r(),{id:"777324625",dynamic:[s.N_.UNIT,s.N_.TWO_UNITS,s.DM.GRAY_300,s.N_.UNIT,s.DM.GRAY_700,s.N_.UNIT],children:[`.layout-token-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:${s.N_.UNIT} ${s.N_.TWO_UNITS};width:180px;background-color:${s.DM.GRAY_300};}`,`.layout-token-name.__jsx-style-dynamic-selector{margin-right:${s.N_.UNIT};width:90px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}`,`.layout-token-value.__jsx-style-dynamic-selector{text-align:center;color:${s.DM.GRAY_700};margin-left:${s.N_.UNIT};white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}`]})]}),F=e=>{var t,o,n,i,a,l,d,p;const u=`${null!==(t=null===e||void 0===e||null===(o=e.content.fontSize)||void 0===o?void 0:o.content)&&void 0!==t?t:""}\n    ${null!==(n=null===e||void 0===e||null===(i=e.content.fontFamily)||void 0===i?void 0:i.content)&&void 0!==n?n:""} ${null!==(a=null===e||void 0===e||null===(l=e.content.fontWeight)||void 0===l?void 0:l.content)&&void 0!==a?a:""} ${null!==(d=null===e||void 0===e||null===(p=e.content.fontStyle)||void 0===p?void 0:p.content)&&void 0!==d?d:""}`;return(0,m.jsxs)("div",{className:r().dynamic([["1460311921",[s.N_.UNIT,s.N_.ONE_AND_HALF,s.DM.GRAY_300,s.n_.DISCRETE,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO]]])+" text-style-container",children:[(0,m.jsx)("div",{style:g(g({},(0,c.N)(e.content)),{},{fontSize:"14px",letterSpacing:"normal",color:`${s.DM.GRAY_700}`}),className:r().dynamic([["1460311921",[s.N_.UNIT,s.N_.ONE_AND_HALF,s.DM.GRAY_300,s.n_.DISCRETE,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO]]])+" preview",children:"Aa"}),(0,m.jsxs)("div",{className:r().dynamic([["1460311921",[s.N_.UNIT,s.N_.ONE_AND_HALF,s.DM.GRAY_300,s.n_.DISCRETE,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO]]])+" token-info-container",children:[(0,m.jsxs)("div",{className:r().dynamic([["1460311921",[s.N_.UNIT,s.N_.ONE_AND_HALF,s.DM.GRAY_300,s.n_.DISCRETE,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO]]])+" token-name",children:[(0,m.jsx)("span",{className:r().dynamic([["1460311921",[s.N_.UNIT,s.N_.ONE_AND_HALF,s.DM.GRAY_300,s.n_.DISCRETE,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO]]]),children:e.name})," ",e.role&&(0,m.jsx)("span",{className:r().dynamic([["1460311921",[s.N_.UNIT,s.N_.ONE_AND_HALF,s.DM.GRAY_300,s.n_.DISCRETE,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO]]])+" token-role",children:e.role})]}),(0,m.jsx)("span",{className:r().dynamic([["1460311921",[s.N_.UNIT,s.N_.ONE_AND_HALF,s.DM.GRAY_300,s.n_.DISCRETE,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO]]])+" token-meta",children:u})]}),(0,m.jsx)(r(),{id:"1460311921",dynamic:[s.N_.UNIT,s.N_.ONE_AND_HALF,s.DM.GRAY_300,s.n_.DISCRETE,s.DM.GRAY_500,s.n_.DEFAULT,s.N_.UNIT,s.N_.TWO_UNITS,s.um.DEFAULT,s.N_.UNIT,s.DM.GRAY_400,s.n_.DEFAULT,s.N_.UNIT,s.um.INFO],children:[`.text-style-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:${s.N_.UNIT} ${s.N_.ONE_AND_HALF};background-color:${s.DM.GRAY_300};border-radius:${s.n_.DISCRETE};}`,`.preview.__jsx-style-dynamic-selector{border:1px solid ${s.DM.GRAY_500};border-radius:${s.n_.DEFAULT};padding:${s.N_.UNIT};margin-right:${s.N_.TWO_UNITS};width:32px;height:32px;text-align:center;text-transform:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`,".token-info-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:relative;}",`.token-name.__jsx-style-dynamic-selector{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:${s.um.DEFAULT};}`,`.token-role.__jsx-style-dynamic-selector{padding:0 ${s.N_.UNIT};background-color:${s.DM.GRAY_400};border-radius:${s.n_.DEFAULT};margin-left:${s.N_.UNIT};font-size:${s.um.INFO};height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;text-transform:capitalize;}`]})]})},C=(e,t)=>{const{y:o}=e,{top:n,height:i}=t;return o>=n&&o<=n+i?o<n+5?"before":o<n+i/2?"inside-before":o<n+i-5?"inside-after":"after":null},E=(e,t,o,n,i)=>{const{x:r,y:s}=n,a=e.top*i*t+o.top,c=e.left*i*t+o.left,l=e.right*i*t+o.left,d=e.bottom*i*t+o.top,p=r<=l&&r>=c&&s>=a&&s<=d,u=Math.max(c-r,0,r-l),h=Math.max(a-s,0,s-d);return{inside:p,distance:{absolute:Math.hypot(u,h),horizontal:u,vertical:h,left:Math.abs(c-r),right:Math.abs(r-l),bottom:Math.abs(s-d),top:Math.abs(a-s)}}},x=(e,t,o,n,i,r)=>{let s,a=0,{distance:c,inside:l}=E(t[0],o[0],n,e,i);s=t[0];for(let d=1;d<t.length;d+=1){const p=E(t[d],o[d],n,e,i),u=r?"row"===r?"horizontal":"vertical":"absolute";c[u]>p.distance[u]&&(a=d,c=g({},p.distance),l=p.inside,s=t[d])}return{edgeData:{edge:A(t[a],n,e,i),distance:c,inside:l},targetRect:s,targetPointIdx:a}},_=(e,t,o,n,i,r)=>{const{x:s,y:a}=e,{top:c,left:l,right:d,bottom:p,width:u,height:h}=t,m=c*n+o.top,y=l*n+o.left,g=d*n+o.left,f=p*n+o.top,b=u*n,I=h*n;if(b<=i&&I<=r)return"center";const v=b/2,w=I/2,N=[s,a],j=[y,m],S=[y,f],D=[g,m],T=[g,f],O=[y+v,m],F=[y+v,f],C=[y,m+w],E=[g,m+w],x=[y+v,m+w],_=new Map,M=[j,S,D,T,O,F,C,E,x];let P,A,k=1/0,U=j;for(let R=0;R<M.length;R+=1)P=M[R],A=Math.hypot(P[0]-N[0],P[1]-N[1]),_.set(P,A),k>A&&(U=P,k=A);switch(U){case j:return b<=i?"top-middle":I<=r?"left-middle":"top-left";case S:return b<=i?"bottom-middle":I<=r?"left-middle":"bottom-left";case D:return b<=i?"top-middle":I<=r?"right-middle":"top-right";case T:return b<=i?"bottom-middle":I<=r?"right-middle":"bottom-right";case O:return"top-middle";case F:return"bottom-middle";case C:return"left-middle";case E:return"right-middle";case x:return"center"}},M=(e,t,o,n)=>{const{x:i,y:r}=e,{top:s,left:a,right:c,bottom:l,width:p,height:u}=t,h=s*n+o.top,m=a*n+o.left,y=c*n+o.left,g=l*n+o.top,f=(0,d.uZ)(u*n/10,8,15),b=(0,d.uZ)(p*n/10,8,15),I=f/2,v=b/2,w={absolute:0,left:0,right:0,top:0,bottom:0,horizontal:0,vertical:0};return h<r&&r+f>g?(w.absolute=r-g,{edge:"bottom",distance:w,inside:!1,shouldDropIntoComputedParent:r+I>g}):h+f>r&&r<g?(w.absolute=h-r,{edge:"top",distance:w,inside:!1,shouldDropIntoComputedParent:h+I>r}):m<i&&i+b>y?(w.absolute=i-y,{edge:"right",distance:w,inside:!1,shouldDropIntoComputedParent:i+v>y}):m+b>i&&i<y?(w.absolute=m-i,{edge:"left",distance:w,inside:!1,shouldDropIntoComputedParent:m+v>i}):null},P=(e,t)=>{const{p1:o,p2:n}=e,i=(0,d.uZ)((n.y-o.y)/(n.x-o.x),-10,10),r=o.y-i*o.x;return t.y<(s=t.x,i*s+r);var s},A=(e,t,o,n)=>{const i=e.top*n+t.top,r=e.left*n+t.left,s=e.right*n+t.left,a=e.bottom*n+t.top,c={x:s,y:i},l={x:r,y:a},d=P({p1:{x:r,y:i},p2:{x:s,y:a}},o),p=P({p1:l,p2:c},o);return d&&p?"top":d&&!p?"right":!d&&p?"left":"bottom"}},738470:function(e,t,o){"use strict";o.d(t,{FP:function(){return i},nY:function(){return r},tf:function(){return s},xu:function(){return a},HT:function(){return c},H4:function(){return l},n2:function(){return d}});var n=o(233475);function i(e){try{if(JSON.parse(e))return!1}catch(o){}const t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.body.childNodes).some((e=>1===e.nodeType))}function r(e){try{if(JSON.parse(e))return!1}catch(o){}const t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.head.childNodes).some((e=>"STYLE"===e.nodeName))}function s(e){try{if(JSON.parse(e))return!1}catch(o){}const t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.body.childNodes).some((e=>"SCRIPT"===e.nodeName))||Array.from(t.head.childNodes).some((e=>"SCRIPT"===e.nodeName))}function a(e){switch(e){case"img":return n.sO.IMAGE;case"svg":case"path":return n.sO.ICON;case"input":return n.sO.TEXTINPUT;case"a":return n.sO.TEXT;case"hr":return n.sO.HORIZONTAL_RULE;default:return e}}function c(e){const t=e.match(/^(\.[^#.:>~+\s\[]+)([#.:>~+\s\[].*)?$/);return t?{mainSelector:t[1],remainingPart:t[2]||""}:null}function l(e){return`(function(){${e}})()`}const d=(e,t)=>{const o=`<${t}>`,n=`</${t}>`,i=e.indexOf(o),r=e.indexOf(n);return-1===i?[]:e.slice(i+1,r)}},209294:function(e,t,o){"use strict";o.d(t,{a:function(){return i}});var n=o(233475);const i=e=>{let t=null;for(const o of e){const e=null===o||void 0===o?void 0:o.primitiveType;!t&&e&&(t=e),t!==e&&(t=n.sO.MIXED)}return t}},704614:function(e,t,o){"use strict";let n,i;o.d(t,{Z:function(){return n},h:function(){return i}}),function(e){e.SUB_HIERARCHY="sub-hierarchy",e.ABSOLUTE_SUB_HIERARCHY="absolute-sub-hierarchy",e.INTERACTIVE_ELEMENT="interactive-element",e.PAGE="page",e.SECTION_TEMPLATE="section-template",e.FILE="file",e.TOKEN="token",e.STYLE="style",e.ASSET_FOLDER="asset-folder",e.FOLDER="folder",e.EDITABLE_FILE="editable-file"}(n||(n={})),function(e){e.EXISTING="existing",e.COMPONENT="component",e.PRIMITIVE="primitive"}(i||(i={}))},442657:function(e,t,o){"use strict";o.d(t,{pV:function(){return i},e0:function(){return r},Ir:function(){return s}});var n=o(933162);let i,r;!function(e){e.Landing="Landing",e.About="About",e.Legal="Legal",e.Contact="Contact",e.Pricing="Pricing"}(i||(i={})),function(e){e.List="CMS List",e.Details="CMS Details"}(r||(r={}));const s={Landing:{versions:[{getLayout:()=>[{section:n.N.Navbar,version:8,id:1},{section:n.N.Hero,version:17,id:2},{section:n.N.Features,version:24,id:3},{section:n.N.CTA,version:26,id:4},{section:n.N.Features,version:25,id:5},{section:n.N.Pricing,version:14,id:6},{section:n.N.Steps,version:2,id:7},{section:n.N.Testimonial,version:17,id:8},{section:n.N.Contact,version:10,id:9},{section:n.N.Footer,version:4,id:10}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Hero,version:9,id:2},{section:n.N.Features,version:1,id:3},{section:n.N.Contact,version:3,id:4},{section:n.N.Footer,version:1,id:5}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Hero,version:3,id:2},{section:n.N.Logos,version:9,id:3},{section:n.N.Gallery,version:1,id:4},{section:n.N.Features,version:17,id:5},{section:n.N.Features,version:18,id:6},{section:n.N.Features,version:17,id:7},{section:n.N.CTA,version:1,id:8},{section:n.N.FAQ,version:1,id:9},{section:n.N.Contact,version:4,id:10},{section:n.N.Footer,version:15,id:11}]},{getLayout:()=>[{section:n.N.Navbar,version:3,id:1},{section:n.N.Hero,version:7,id:2},{section:n.N.Gallery,version:3,id:3},{section:n.N.Features,version:10,id:4},{section:n.N.Testimonial,version:12,id:5},{section:n.N.Contact,version:3,id:6},{section:n.N.Footer,version:4,id:7}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Hero,version:9,id:2},{section:n.N.Features,version:22,id:3},{section:n.N.Gallery,version:7,id:4},{section:n.N.Team,version:14,id:5},{section:n.N.Contact,version:3,id:6},{section:n.N.Footer,version:2,id:7}]},{getLayout:()=>[{section:n.N.Navbar,version:7,id:1},{section:n.N.Hero,version:13,id:2},{section:n.N.Features,version:23,id:3},{section:n.N.Gallery,version:2,id:4},{section:n.N.Team,version:7,id:5},{section:n.N.Contact,version:6,id:6},{section:n.N.FAQ,version:14,id:7},{section:n.N.CTA,version:3,id:8},{section:n.N.Footer,version:5,id:9}]}],type:i.Landing},About:{versions:[{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Hero,version:8,id:2},{section:n.N.Stats,version:2,id:3},{section:n.N.Logos,version:1,id:4},{section:n.N.Features,version:1,id:5},{section:n.N.Team,version:1,id:6},{section:n.N.Footer,version:1,id:7}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Hero,version:8,id:2},{section:n.N.Timeline,version:4,id:3},{section:n.N.Stats,version:3,id:4},{section:n.N.Logos,version:2,id:5},{section:n.N.Testimonial,version:6,id:6},{section:n.N.Team,version:7,id:7},{section:n.N.Footer,version:15,id:8}]},{getLayout:()=>[{section:n.N.Navbar,version:3,id:1},{section:n.N.Hero,version:2,id:2},{section:n.N.Stats,version:1,id:3},{section:n.N.Testimonial,version:16,id:4},{section:n.N.Features,version:23,id:5},{section:n.N.Team,version:3,id:6},{section:n.N.Footer,version:4,id:7}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Banner,version:1,id:2},{section:n.N.Features,version:16,id:3},{section:n.N.Logos,version:8,id:4},{section:n.N.Stats,version:32,id:5},{section:n.N.Team,version:14,id:6},{section:n.N.CTA,version:15,id:7},{section:n.N.Footer,version:2,id:8}]},{getLayout:()=>[{section:n.N.Navbar,version:7,id:1},{section:n.N.Hero,version:7,id:2},{section:n.N.Features,version:18,id:3},{section:n.N.Team,version:5,id:4},{section:n.N.Testimonial,version:2,id:5},{section:n.N.Contact,version:11,id:6},{section:n.N.Footer,version:5,id:7}]}],type:i.About},Legal:{versions:[{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.CTA,version:1,id:2},{section:n.N["Content List"],version:1,id:3},{section:n.N.Footer,version:1,id:4}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.CTA,version:2,id:2},{section:n.N["Content List"],version:2,id:3},{section:n.N.FAQ,version:1,id:4},{section:n.N.Contact,version:4,id:5},{section:n.N.Footer,version:15,id:6}]},{getLayout:()=>[{section:n.N.Navbar,version:3,id:1},{section:n.N.Hero,version:7,id:2},{section:n.N["Content List"],version:3,id:3},{section:n.N.Contact,version:3,id:4},{section:n.N.Footer,version:4,id:5}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Hero,version:9,id:2},{section:n.N["Content List"],version:4,id:3},{section:n.N.Contact,version:3,id:4},{section:n.N.Footer,version:2,id:5}]},{getLayout:()=>[{section:n.N.Navbar,version:7,id:1},{section:n.N.Hero,version:9,id:2},{section:n.N["Content List"],version:5,id:3},{section:n.N.FAQ,version:14,id:4},{section:n.N.CTA,version:3,id:5},{section:n.N.Footer,version:1,id:6}]}],type:i.Legal},Contact:{versions:[{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N["Contact Form"],version:3,id:2},{section:n.N.Contact,version:14,id:3},{section:n.N.Contact,version:7,id:4},{section:n.N.Footer,version:1,id:5}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Contact,version:11,id:2},{section:n.N.Logos,version:3,id:3},{section:n.N.Footer,version:15,id:4}]},{getLayout:()=>[{section:n.N.Navbar,version:3,id:1},{section:n.N["Contact Form"],version:7,id:2},{section:n.N.Logos,version:2,id:3},{section:n.N.Testimonial,version:13,id:4},{section:n.N.Footer,version:4,id:5}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Contact,version:2,id:2},{section:n.N.Logos,version:1,id:3},{section:n.N.Stats,version:2,id:4},{section:n.N.Footer,version:2,id:5}]},{getLayout:()=>[{section:n.N.Navbar,version:7,id:1},{section:n.N["Contact Form"],version:5,id:2},{section:n.N.Contact,version:8,id:3},{section:n.N.Footer,version:5,id:4}]}],type:i.Contact},Pricing:{versions:[{getLayout:()=>[{section:n.N.Navbar,version:6,id:1},{section:n.N.Hero,version:9,id:2},{section:n.N.Pricing,version:8,id:3},{section:n.N.Pricing,version:10,id:4},{section:n.N.Testimonial,version:18,id:5},{section:n.N.FAQ,version:11,id:6},{section:n.N.CTA,version:26,id:7},{section:n.N.Footer,version:1,id:8}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Pricing,version:6,id:2},{section:n.N.Logos,version:1,id:3},{section:n.N.Features,version:1,id:4},{section:n.N.FAQ,version:11,id:5},{section:n.N.Footer,version:1,id:6}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Pricing,version:8,id:2},{section:n.N.Logos,version:2,id:3},{section:n.N.Features,version:10,id:4},{section:n.N.FAQ,version:12,id:5},{section:n.N.CTA,version:12,id:6},{section:n.N.Footer,version:15,id:7}]},{getLayout:()=>[{section:n.N.Navbar,version:3,id:1},{section:n.N.Pricing,version:7,id:2},{section:n.N.FAQ,version:4,id:3},{section:n.N.Testimonial,version:14,id:4},{section:n.N.CTA,version:4,id:5},{section:n.N.Footer,version:4,id:6}]},{getLayout:()=>[{section:n.N.Navbar,version:4,id:1},{section:n.N.Pricing,version:14,id:2},{section:n.N.Logos,version:8,id:3},{section:n.N.Features,version:16,id:4},{section:n.N.FAQ,version:14,id:5},{section:n.N.Footer,version:2,id:6}]},{getLayout:()=>[{section:n.N.Navbar,version:7,id:1},{section:n.N.CTA,version:3,id:2},{section:n.N.Pricing,version:6,id:3},{section:n.N.Testimonial,version:6,id:4},{section:n.N.FAQ,version:14,id:5},{section:n.N.CTA,version:22,id:6},{section:n.N.Footer,version:5,id:7}]}],type:i.Pricing}}},882465:function(e,t,o){"use strict";o.d(t,{e:function(){return a}});var n=o(777460),i=o(933162);function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}class a{constructor(){(0,n.Z)(this,"sections",Object.keys(i.N).reduce(((e,t)=>(e[t]={},e)),{})),(0,n.Z)(this,"getSectionsByType",(async e=>(Object.keys(this.sections[e]).length||await this.preloadSectionsByType(e),this.sections[e]))),(0,n.Z)(this,"getAllSections",(()=>Object.values(this.sections).reduce(((e,t)=>s(s({},e),t)),{}))),(0,n.Z)(this,"preloadSectionsByType",(async e=>{if(!this.sections[e]||Object.keys(this.sections[e]).length)return;const t=this.getFolderNameBySectionType(e);let n=!0,i=1;for(;n&&i<5e3;)try{const r=await o(830938)(`./${t}/${i}`);r.defaultLayout?(this.sections[e][`${e}${i}`]=s(s({},r.defaultLayout),{},{type:e}),i+=1):n=!1}catch(r){n=!1}}))}static get Instance(){return this._instance||(this._instance=new this)}getFolderNameBySectionType(e){return 0!==e.indexOf("CTA")&&0!==e.indexOf("FAQ")||(e=e.toLowerCase()),(e[0].toLowerCase()+e.slice(1)).replace(/[0-9]/g,"").replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`)).replaceAll(" ","")}}(0,n.Z)(a,"_instance",void 0)},933162:function(e,t,o){"use strict";let n;o.d(t,{N:function(){return n}}),function(e){e.Banner="Banner",e.Contact="Contact",e["Contact Form"]="Contact Form",e["Content List"]="Content List",e.CTA="CTA",e.Hero="Hero",e.Logos="Logos",e["Not Found"]="Not Found",e.Navbar="Navbar",e.Footer="Footer",e.Gallery="Gallery",e.FAQ="FAQ",e.Features="Features",e.Pricing="Pricing",e.Team="Team",e.Testimonial="Testimonial",e["Sign Up"]="Sign Up",e["Sign In"]="Sign In",e["Blog Post Header"]="Blog Post Header",e.Timeline="Timeline",e.Stats="Stats",e.Steps="Steps",e.Toast="Toast"}(n||(n={}))},446909:function(e,t,o){"use strict";o.d(t,{ZR:function(){return c},RY:function(){return l},VM:function(){return d},oI:function(){return u}});var n=o(777460),i=o(930613),r=o(813244);function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const c=(e,t)=>{var o;if(!("contentChildren"in e)||0===Object.keys(null!==(o=e.contentChildren)&&void 0!==o?o:{}).length)return{};const{contentChildren:n={}}=e;return Object.keys(n).reduce(((e,o)=>{const i=n[o];if("static"===i.type)return e[o]=i,e;if("dynamic"===i.type&&t){const n=t(i);return e[o]=n,e}return e}),{})},l=(e,t)=>{if(!("attrs"in e))return{};const{attrs:o={}}=e;return Object.keys(o).reduce(((e,n)=>{const i=o[n];if("static"===i.type||"comp-style"===i.type){if("string"!==typeof i.content&&"number"!==typeof i.content)throw new Error(`Attribute value must be a string or a number. Found ${typeof i.content} for ${n} nodeId: ${i.id}`);return e[n]=o[n],e}if(!t||"cms-filter"===i.type)return e;const r=t(i);if(r){if("string"!==typeof r.content&&"number"!==typeof r.content)throw new Error(`Attribute value must be a string or a number. Found ${typeof r.content} for ${n} nodeId: ${r.id}`);e[n]=r}return e}),{})},d=(e,t)=>{var o;if(!("abilities"in e)||0===Object.keys(null!==(o=e.abilities)&&void 0!==o?o:{}).length)return{};const{abilities:n}=e;return Object.keys(n).reduce(((e,o)=>{const r=n[o],{type:s,content:c}=r;switch(s){case i.RZ.URL:const n=c,l=p(n.url,t);e[o]={type:s,content:a(a({},n),{},{url:l})};break;case i.RZ.MAIL:const d=c,u=p(d.mail,t),h=d.body?p(d.body,t):"",m=d.subject?p(d.subject,t):"";e[o]={type:s,content:a(a({},d),{},{mail:u,body:h,subject:m})};break;case i.RZ.PHONE:const y=c,g=p(y.phone,t);e[o]={type:s,content:a(a({},y),{},{phone:g})};break;default:e[o]=r}return e}),{})},p=(e,t)=>{var o;return"string"===typeof e?e:"static"===e.type?e.content:null===(o=t(e))||void 0===o?void 0:o.content},u=e=>{switch(e){case"array":return r.SO.ARRAY;case"boolean":return r.SO.BOOLEAN;case"func":return r.SO.FUNCTION;case"number":return r.SO.NUMBER;case"object":return r.SO.OBJECT;case"richtext":return r.SO.RICH_TEXT;default:return r.SO.TEXT}}},444370:function(e,t,o){"use strict";o.d(t,{k:function(){return h}});var n,i,r,s,a,c=o(503348),l=o(918437),d=o(302503),p=o(395942),u=o(412940);const h=[.25,.5,.75,1,1.25,1.5,1.75,2,3,4,5,6];n=(0,d.provide)("zoomControlFlow"),i=(0,d.inject)("projectUIState"),n((s=class{constructor(){(0,c.Z)(this,"projectUIState",a,this)}zoomOut(){if(this.projectUIState.drag.draggedEntity||this.projectUIState.selection.dragSelection)return;const e=this.projectUIState.stage.webComp.controlValues.scale;(0,p.mutate)(this.projectUIState,(({stage:t,userPreferences:o})=>{for(let n=h.length-1;n>=0;n-=1)if(e>h[n])return t.webComp.controlValues.scale=h[n],void(o.zoomLevel=h[n])}))}zoomIn(){if(this.projectUIState.drag.draggedEntity||this.projectUIState.selection.dragSelection)return;const e=this.projectUIState.stage.webComp.controlValues.scale;(0,p.mutate)(this.projectUIState,(({stage:t,userPreferences:o})=>{for(const n of h)if(e<n)return t.webComp.controlValues.scale=n,void(o.zoomLevel=n)}))}resetScaleValue(){(0,p.mutate)(this.projectUIState,(({stage:e,userPreferences:t})=>{e.webComp.controlValues.scale=u.m7.controlValues.scale,t.zoomLevel=u.m7.controlValues.scale}))}adjustStageZoomLevelToScreenResolution(e){(0,p.mutate)(this.projectUIState,(({stage:t})=>{e<1440&&(t.webComp.controlValues.scale=h[1]),e>=1440&&e<1800&&(t.webComp.controlValues.scale=h[2]),e>=1800&&(t.webComp.controlValues.scale=h[3])}))}setStageZoomLevel(e){(0,p.mutate)(this.projectUIState,(({stage:t})=>{t.webComp.controlValues.scale=e}))}},a=(0,l.Z)(s.prototype,"projectUIState",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r=s))},639887:function(e,t,o){"use strict";o.d(t,{h:function(){return n}});const n=(e,t,o,n)=>{let i={};o&&n&&(i={width:{type:"static",content:o},height:{type:"static",content:n}});return{name:"pastedImage",node:{type:"element",content:{elementType:"image",name:"pastedImage",style:i,attrs:{alt:{type:"static",content:"pastedImage"},src:{type:"static",content:e+t}}}}}}},402817:function(e,t,o){"use strict";o(27092);var n=o(171625),i=(o(932433),o(51261),o(741023),o(93087),o(646559),o(503348)),r=o(777460),s=o(918437),a=o(395942),c=o(302503),l=o(491463),d=o(686646),p=o(440516),u=o(785978),h=o(327089),m=o(255328),y=o(638852),g=o(559196),f=o(142678),b=o(422169),I=o(676422),v=o.n(I),w=o(202784),N=o(781872),j=o(173541),S=o(505892),D=o(893291),T=o(442657),O=o(909967),F=o(552322);const C=w.memo((e=>{const{leftMenu:t,header:o}=e;return(0,F.jsxs)("div",{className:v().dynamic([["2601394507",[N.N_.THREE_UNITS,N.N_.SIX_UNITS,N.N_.UNIT,N.N_.UNIT]]])+" "+`main-wrapper ${e.style||""}`,children:[o?(0,F.jsx)("div",{className:v().dynamic([["2601394507",[N.N_.THREE_UNITS,N.N_.SIX_UNITS,N.N_.UNIT,N.N_.UNIT]]])+" header",children:o}):null,(0,F.jsxs)("div",{className:v().dynamic([["2601394507",[N.N_.THREE_UNITS,N.N_.SIX_UNITS,N.N_.UNIT,N.N_.UNIT]]])+" main-section-row",children:[(0,F.jsx)("nav",{className:v().dynamic([["2601394507",[N.N_.THREE_UNITS,N.N_.SIX_UNITS,N.N_.UNIT,N.N_.UNIT]]])+" left-menu-wrapper",children:t}),e.children]}),(0,F.jsx)(v(),{id:"2601394507",dynamic:[N.N_.THREE_UNITS,N.N_.SIX_UNITS,N.N_.UNIT,N.N_.UNIT],children:[".main-wrapper.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}",`.left-menu-wrapper.__jsx-style-dynamic-selector{min-width:180px;margin-top:${N.N_.THREE_UNITS};margin-right:${N.N_.SIX_UNITS};padding-bottom:${N.N_.UNIT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;overflow:auto;}`,`.left-menu-wrapper.__jsx-style-dynamic-selector>* + *{margin-top:${N.N_.UNIT};mergin-left:0px;}`,".main-section-row.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:100%;}"]})]})}));var E=o(479998),x=o(84615),_=o(889729);class M{async runBefore(e){var t,o,n,i;return e.strategy.components.postprocessors=[_.Z],e.strategy.pages.postprocessors=[_.Z],null===(t=e.strategy.router)||void 0===t||null===(o=t.postprocessors)||void 0===o||o.push(_.Z),null===(n=e.strategy.entry)||void 0===n||null===(i=n.postprocessors)||void 0===i||i.push(_.Z),e}async runAfter(e){return e}}const P=(e,t="")=>{const o={},n=t?`${t}/${e.name}`:e.name;return e.files&&e.files.forEach((e=>{const t=`${n}/${e.name}.${e.fileType||"txt"}`;o[t]=e.content})),e.subFolders&&e.subFolders.forEach((e=>{const t=P(e,n);Object.assign(o,t)})),o};const A=new(o(333395).Subject)("idle");const k=new class{constructor(){(0,r.Z)(this,"frame",void 0),(0,r.Z)(this,"sendFiles",(e=>{this.send({type:"add-files",message:{files:e,entry:"teleport-project-react/src/index.js"}})})),(0,r.Z)(this,"send",(e=>{var t;null===(t=this.frame.contentWindow)||void 0===t||t.postMessage(e,"*")})),(0,r.Z)(this,"listener",(e=>{const{data:t}=e,{type:o,message:n}=t;if(null!==t&&void 0!==t&&t.bundler)switch(o){case"bundler-status":A.next(n.status)}})),this.send=this.send.bind(this),this.sendFiles=this.sendFiles.bind(this)}registerIFrame(e){var t;this.frame=e,null===(t=this.frame.contentWindow)||void 0===t||t.postMessage({type:"handshake"},"*")}},U=({handleFrameLoad:e})=>{const t=(0,w.useRef)(null);return(0,F.jsx)("iframe",{src:"https://esm-preview-git-feat-ligh-weight-preview-teleport-team.vercel.app/",ref:t,style:{borderWidth:"0px",transform:"scale(0.75)",transformOrigin:"0 0",width:"133%",height:"133%"},onLoad:()=>{t.current&&e(t)}})};class R{constructor(){(0,r.Z)(this,"queue",[]),(0,r.Z)(this,"running",!1)}enqueue(e,t){this.queue.push({name:e,task:t}),this.run()}async run(){if(!this.running){for(this.running=!0;this.queue.length>0;){const{task:e}=this.queue.shift();await e()}this.running=!1}}clearQueue(){this.queue=[]}getPendingTasksCount(){return this.queue.length}isRunning(){return this.running}}let Z;const L=(0,o(225237).default)((()=>Promise.resolve(U)),{ssr:!1}),$=e=>{const{uidl:t}=e;(0,w.useEffect)((()=>(Z=new R,window.addEventListener("message",k.listener),()=>{window.removeEventListener("message",k.listener)})),[]),(0,w.useEffect)((()=>{Z.clearQueue(),Z.enqueue("Initial bundling",o)}),[t]);const o=async()=>{try{const e=await(async e=>{const t=await(0,E.packProject)(e,{projectType:x.cd.REACT,plugins:[new M]});if(!1!==t.success)return P(t.payload)})(t);if(void 0===e)throw new Error("Error in generating project");if("building"===A.value)return;if(!k.frame)return;Z.enqueue("Bundling",(()=>k.sendFiles(e)))}catch(e){console.error(`Error in generating project for preview: ${e}`)}};return(0,F.jsx)(L,{handleFrameLoad:e=>{e.current&&(k.registerIFrame(e.current),Z.enqueue("Initial bundling",o))}})};var B=o(282147);const G=e=>{const{previewUIDL:t,isLoading:o}=e;return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"jsx-478700359 preview-content",children:[!!t&&(0,F.jsx)("div",{style:{display:o?"none":"contents"},className:"jsx-478700359",children:(0,F.jsx)($,{isLoading:"success",uidl:t})}),!t||o&&(0,F.jsx)(B.$,{fullHeight:!0})]}),(0,F.jsx)(v(),{id:"478700359",children:[".preview-content.jsx-478700359{width:100%;height:100%;position:relative;}"]})]})};var H,z,Y,V=o(451510),W=o(817374),K=o(757156),q=o(344627),J=o(216372);function X(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Q(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?X(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):X(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let ee=(H=(0,c.inject)("projectDoc"),z=class extends w.PureComponent{constructor(...e){var t;super(...e),(0,i.Z)(this,"projectDoc",Y,this),(0,r.Z)(this,"cmsMainFlow",q.c.Instance),(0,r.Z)(this,"cmsContentBuilder",W.N.Instance),(0,r.Z)(this,"unsubs",[]),(0,r.Z)(this,"cmsUIState",K.H.Instance),(0,r.Z)(this,"state",{usedContentTypes:null!==(t=this.cmsUIState.usedContentTypes)&&void 0!==t?t:{},cmsStatus:this.projectDoc.cms.status}),(0,r.Z)(this,"handleOnClickType",((e,t)=>{if(!e){const e=Q({},this.props.selectedContentTypes);return delete e[t.uid],void this.props.updateSelectedCMSTypes(e)}this.props.updateSelectedCMSTypes(Q(Q({},this.props.selectedContentTypes),{},{[t.uid]:!0}))}))}componentDidMount(){const e=(0,a.select)(this.cmsUIState,["usedContentTypes","usedContentTypes/*"],(({usedContentTypes:e})=>{this.setState({usedContentTypes:e})}),"UsedContentTypesCMSWrapper"),t=(0,a.select)(this.projectDoc,["cms/status"],(({cms:e})=>{this.setState({cmsStatus:e.status})}),"UsedContentTypesCMSWrapper");this.unsubs.push((()=>e.dispose()),(()=>t.dispose()))}componentWillUnmount(){this.unsubs.forEach((e=>e()))}render(){if(!Object.keys(this.state.usedContentTypes).length||"unset"===this.state.cmsStatus||"ready"!==this.state.cmsStatus.state)return null;const e=this.props.selectedPageType===T.e0.Details?this.cmsMainFlow.getUsedContentTypesForDetailsPages():this.cmsMainFlow.getUsedContentTypesForListPages();return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:v().dynamic([["1941950893",[N.N_.UNIT,N.um.INFO,N.DM.GRAY_700,N.N_.HALF_UNIT,N.N_.UNIT,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]])+" preview-content",children:[(0,F.jsxs)("p",{className:v().dynamic([["1941950893",[N.N_.UNIT,N.um.INFO,N.DM.GRAY_700,N.N_.HALF_UNIT,N.N_.UNIT,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]]),children:["Make a selection from the existing types to create ",this.props.selectedPageType," pages for:"]}),(0,F.jsx)("ul",{className:v().dynamic([["1941950893",[N.N_.UNIT,N.um.INFO,N.DM.GRAY_700,N.N_.HALF_UNIT,N.N_.UNIT,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]]),children:Object.values(this.state.usedContentTypes).sort(((t,o)=>e[t.uid]&&!e[o.uid]?-1:1)).map((t=>(0,F.jsxs)("li",{onClick:o=>{e[t.uid]||(this.handleOnClickType(!this.props.selectedContentTypes[t.uid],t),o.preventDefault())},className:v().dynamic([["1941950893",[N.N_.UNIT,N.um.INFO,N.DM.GRAY_700,N.N_.HALF_UNIT,N.N_.UNIT,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]])+" option",children:[(0,F.jsx)(S.J,{type:"database",size:16}),(0,F.jsx)("div",{className:v().dynamic([["1941950893",[N.N_.UNIT,N.um.INFO,N.DM.GRAY_700,N.N_.HALF_UNIT,N.N_.UNIT,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]])+" type-label-wrapper",children:(0,F.jsx)("p",{className:v().dynamic([["1941950893",[N.N_.UNIT,N.um.INFO,N.DM.GRAY_700,N.N_.HALF_UNIT,N.N_.UNIT,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]])+" type-name",children:t.name})}),(0,F.jsx)(J.X,{value:e[t.uid]?e[t.uid]:this.props.selectedContentTypes[t.uid],disabled:e[t.uid],onChange:e=>this.handleOnClickType(e.currentTarget.checked,t)})]},t.uid)))}),(0,F.jsx)("p",{className:v().dynamic([["1941950893",[N.N_.UNIT,N.um.INFO,N.DM.GRAY_700,N.N_.HALF_UNIT,N.N_.UNIT,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]])+" note-text",children:"Note: If you can't find a content type in the list, please update the data from the CMS Connection Tab Menu."})]}),(0,F.jsx)(v(),{id:"1941950893",dynamic:[N.N_.UNIT,N.um.INFO,N.DM.GRAY_700,N.N_.HALF_UNIT,N.N_.UNIT,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500],children:[`.preview-content.__jsx-style-dynamic-selector{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin-top:25px;overflow-y:auto;gap:${N.N_.UNIT};}`,`.note-text.__jsx-style-dynamic-selector{font-style:italic;font-size:${N.um.INFO};color:${N.DM.GRAY_700};}`,`.type-row.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:${N.N_.HALF_UNIT};margin:${N.N_.UNIT} 0px;}`,`.type-label-wrapper.__jsx-style-dynamic-selector{margin-left:${N.N_.ONE_AND_HALF};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex:1;-ms-flex:1;flex:1;}`,".type-name.__jsx-style-dynamic-selector{text-transform:capitalize;}",`.option.__jsx-style-dynamic-selector{list-style:none;line-height:2;padding:${N.N_.HALF_UNIT} ${N.N_.UNIT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-radius:${N.n_.DEFAULT};cursor:default;text-transform:capitalize;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;white-space:nowrap;gap:${N.N_.UNIT};}`,`.option.__jsx-style-dynamic-selector:hover.__jsx-style-dynamic-selector:not(.selected){background-color:${N.DM.GRAY_300};}`,`.option.selected.__jsx-style-dynamic-selector{background-color:${N.DM.GRAY_300};font-weight:${N.Xw.MEDIUM_500};}`]})]})}},Y=(0,s.Z)(z.prototype,"projectDoc",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z);const te=w.memo((e=>{const{changeSelectedPage:t,selectedPage:o,cmsStatus:n,forPopulateCurrentPage:i}=e,r="unset"===n||"ready"!==(null===n||void 0===n?void 0:n.state)||i;return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("p",{className:v().dynamic([["267977946",[N.Xw.MEDIUM_600,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]])+" template-title",children:"Page Templates"}),[...Object.keys(T.Ir)].map((e=>(0,F.jsxs)("li",{onClick:()=>t(e),"data-tab-name":e,className:v().dynamic([["267977946",[N.Xw.MEDIUM_600,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]])+" "+(o===e?"selected":"")+" option",children:[e.replace("-"," ")," Pages"]},e))),!r&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{style:{marginTop:"12px",display:"flex",gap:"4px"},className:v().dynamic([["267977946",[N.Xw.MEDIUM_600,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]])+" template-title",children:[(0,F.jsx)(S.J,{type:"database",size:16,color:N.DM.SUCCESS}),(0,F.jsx)("p",{className:v().dynamic([["267977946",[N.Xw.MEDIUM_600,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]]),children:"CMS Pages"})]}),["CMS List","CMS Details"].map((e=>(0,F.jsxs)("li",{onClick:()=>t(e),"data-tab-name":e,className:v().dynamic([["267977946",[N.Xw.MEDIUM_600,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500]]])+" "+(o===e?"selected":"")+" option",children:[e.replace("-"," ")," Pages"]},e)))]}),(0,F.jsx)(v(),{id:"267977946",dynamic:[N.Xw.MEDIUM_600,N.N_.HALF_UNIT,N.N_.UNIT,N.n_.DEFAULT,N.DM.GRAY_300,N.DM.GRAY_300,N.Xw.MEDIUM_500],children:[`.template-title.__jsx-style-dynamic-selector{text-transform:uppercase;min-width:180px;font-weight:${N.Xw.MEDIUM_600};}`,`.option.__jsx-style-dynamic-selector{list-style:none;line-height:2;padding:${N.N_.HALF_UNIT} ${N.N_.UNIT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-radius:${N.n_.DEFAULT};cursor:default;text-transform:capitalize;white-space:nowrap;}`,`.option.__jsx-style-dynamic-selector:hover.__jsx-style-dynamic-selector:not(.selected){background-color:${N.DM.GRAY_300};}`,`.option.selected.__jsx-style-dynamic-selector{background-color:${N.DM.GRAY_300};font-weight:${N.Xw.MEDIUM_500};}`]})]})}));var oe,ne,ie,re,se,ae,ce,le,de,pe,ue,he,me,ye,ge,fe,be;function Ie(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function ve(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ie(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let we=(oe=(0,c.inject)("projectUIState"),ne=(0,c.inject)("pageManagementFlow"),ie=(0,c.inject)("layoutManagementFlow"),re=(0,c.inject)("folderManagementFlow"),se=(0,c.inject)("predefinedPagesManagementFlow"),ae=(0,c.inject)("modalManagementFlow"),ce=(0,c.inject)("notificationsManagementFlow"),le=(0,c.inject)("projectDoc"),de=class extends w.PureComponent{constructor(...e){super(...e),(0,i.Z)(this,"projectUIState",pe,this),(0,i.Z)(this,"pageManagementFlow",ue,this),(0,i.Z)(this,"layoutManagementFlow",he,this),(0,i.Z)(this,"folderManagementFlow",me,this),(0,i.Z)(this,"predefinedPagesManagementFlow",ye,this),(0,i.Z)(this,"modalManagementFlow",ge,this),(0,i.Z)(this,"notificationsManagementFlow",fe,this),(0,i.Z)(this,"projectDoc",be,this),(0,r.Z)(this,"cmsContentBuilder",W.N.Instance),(0,r.Z)(this,"state",{useAIForContent:!0,selectedPageType:T.pV.Landing,previewUIDL:null,selectedPreviewPage:null,loadingUIDL:!1,selectedContentTypes:{}}),(0,r.Z)(this,"toggleAIForContent",(()=>{y.Z.mixpanelEvent(y.Z.AnalyticsEvents.NEW_PAGE_AI_CONTENT_SWITCH,{value:!this.state.useAIForContent}),this.setState({useAIForContent:!this.state.useAIForContent})})),(0,r.Z)(this,"createBlankNewPage",(()=>{const{parentFolderId:e}=this.props;this.projectUIState.folders.expandedFolders[e]||this.folderManagementFlow.updateFolderExpandStatus(e,!0),this.projectUIState.userInteractions.isNodeInPreviewMode&&this.layoutManagementFlow.stopElementPreviewMode(),this.pageManagementFlow.createEmptyPage({parentFolderId:e}),y.Z.mixpanelEvent(y.Z.AnalyticsEvents.NEW_PAGE_USE_BLANK),this.props.onDismiss()})),(0,r.Z)(this,"changeSelectedPage",(async e=>{if(y.Z.mixpanelEvent(y.Z.AnalyticsEvents.NEW_PAGE_PAGE_TYPE_SELECT,{pageType:e}),e===T.e0.Details||e===T.e0.List)return void this.setState({selectedPageType:e,previewUIDL:void 0,selectedPreviewPage:null,selectedContentTypes:{}});this.setState({loadingUIDL:!0});const t=await this.generatePreviewUIDL(e,0);t&&(this.setState({selectedPageType:e,previewUIDL:t,selectedPreviewPage:"0",selectedContentTypes:{}}),setTimeout((()=>{this.setState({loadingUIDL:!1})}),600))})),(0,r.Z)(this,"handleDismiss",(()=>{y.Z.mixpanelEvent(y.Z.AnalyticsEvents.NEW_PAGE_CLOSE),this.props.onDismiss()})),(0,r.Z)(this,"updateSelectedCMSTypes",(e=>{this.setState({selectedContentTypes:ve({},e)})})),(0,r.Z)(this,"handleCreateCMSPages",(async e=>{try{if(e===T.e0.Details)return await this.cmsContentBuilder.buildDetailPages(this.state.selectedContentTypes),this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,"Details page(s) created successfully"),void this.props.onDismiss();await this.cmsContentBuilder.buildListPages(this.state.selectedContentTypes),this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,"List page(s) created successfully"),this.props.onDismiss()}catch(t){this.notificationsManagementFlow.handleError(t.message)}})),(0,r.Z)(this,"renderTemplatePreviewOptions",(()=>{var e,t;const{useAIForContent:o,selectedPageType:n,selectedPreviewPage:i}=this.state;return"CMS List"===n||"CMS Details"===n?null:(0,F.jsxs)("div",{className:v().dynamic([["26597958",[N.N_.TWO_UNITS,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT]]])+" preview-header",children:[(0,F.jsxs)("div",{className:v().dynamic([["26597958",[N.N_.TWO_UNITS,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT]]]),children:[(0,F.jsx)("span",{style:{marginRight:N.N_.UNIT},className:v().dynamic([["26597958",[N.N_.TWO_UNITS,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT]]]),children:"Preview"}),(0,F.jsx)(V.P,{options:null===(e=null!==(t=T.Ir[n])&&void 0!==t?t:{versions:[]})||void 0===e?void 0:e.versions.reduce(((e,t,o)=>(e[`${o}`]=`${n} Page ${o+1}`,e)),{}),value:i||"",onChange:e=>{this.previewPredefinedPage(n,parseInt(e))},styleType:"outline"})]}),(0,F.jsxs)("div",{className:v().dynamic([["26597958",[N.N_.TWO_UNITS,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT]]])+" ai-switch",children:[(0,F.jsx)("p",{className:v().dynamic([["26597958",[N.N_.TWO_UNITS,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT]]]),children:"Use AI to generate content"}),(0,F.jsx)(D.r,{onChange:this.toggleAIForContent,value:o})]}),(0,F.jsx)(v(),{id:"26597958",dynamic:[N.N_.TWO_UNITS,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT],children:[`.preview-header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex:1;-ms-flex:1;flex:1;padding:${N.N_.TWO_UNITS} 0px;}`,`.ai-switch.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:${N.N_.UNIT};border-radius:${N.n_.DEFAULT};gap:${N.N_.UNIT};}`]})]})})),(0,r.Z)(this,"renderFooter",(()=>{const{selectedPageType:e,selectedPreviewPage:t}=this.state;return e===T.e0.Details||e===T.e0.List?(0,F.jsx)(j.z,{onClick:()=>this.handleCreateCMSPages(e),isDisabled:!Object.keys(this.state.selectedContentTypes).length,children:"Create CMS Pages"}):(0,F.jsxs)(F.Fragment,{children:[!this.props.forPopulateCurrentPage&&(0,F.jsx)(j.z,{style:"outline",onClick:this.createBlankNewPage,colorScheme:"neutral",children:"Use Blank"}),(0,F.jsx)(j.z,{onClick:()=>this.createPredefinedPage(e,parseInt(t||"")),isDisabled:!e||!t,children:"Use Template"})]})}))}componentDidMount(){const{selectedPageType:e}=this.state;"CMS List"!==e&&"CMS Details"!==e&&this.previewPredefinedPage(e,0)}createPredefinedPage(e,t){var o,n;this.props.onDismiss();const i=this.props.forPopulateCurrentPage&&null!==(o=this.projectUIState.selection.componentId)&&void 0!==o?o:void 0;this.predefinedPagesManagementFlow.populatePage({pageType:e,targetPageId:i,version:t,withAI:this.state.useAIForContent,parentFolderId:this.props.parentFolderId}),y.Z.mixpanelEvent(y.Z.AnalyticsEvents.NEW_PAGE_USE_TEMPLATE,{useAI:this.state.useAIForContent,pageType:e,pageVariant:t,populateNewPage:null!==(n=this.props.forPopulateCurrentPage)&&void 0!==n&&n});const r=b.d.createCustomModal({Component:O.S,onDismiss:()=>{this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(r,{},!1)}async previewPredefinedPage(e,t){this.setState({loadingUIDL:!0});const o=await this.generatePreviewUIDL(e,t);y.Z.mixpanelEvent(y.Z.AnalyticsEvents.NEW_PAGE_VARIANT_SELECT,{pageType:e,variant:t}),o&&(this.setState({previewUIDL:o,selectedPreviewPage:`${t}`}),setTimeout((()=>{this.setState({loadingUIDL:!1})}),600))}async generatePreviewUIDL(e,t){return await this.predefinedPagesManagementFlow.previewPage({pageType:e,version:t})}render(){const{forPopulateCurrentPage:e=!1}=this.props,{selectedPageType:t,previewUIDL:o}=this.state,n=t===T.e0.Details||t===T.e0.List;return(0,F.jsxs)("div",{className:v().dynamic([["4216540131",[N.N_.UNIT,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.FIVE,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.THREE_UNITS]]])+" content-wrapper",children:[(0,F.jsxs)("div",{className:v().dynamic([["4216540131",[N.N_.UNIT,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.FIVE,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.THREE_UNITS]]])+" content-modal-header",children:[(0,F.jsx)("p",{className:v().dynamic([["4216540131",[N.N_.UNIT,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.FIVE,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.THREE_UNITS]]]),children:e?"Populate Page":"Create Page"}),(0,F.jsx)(j.z,{style:"transparent",onClick:this.handleDismiss,shape:"square",children:(0,F.jsx)(S.J,{type:"actions/close",size:14,color:N.DM.GRAY_900})})]}),(0,F.jsx)("div",{className:v().dynamic([["4216540131",[N.N_.UNIT,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.FIVE,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.THREE_UNITS]]])+" content-root",children:(0,F.jsx)(C,{style:"wide",leftMenu:(0,F.jsx)(te,{selectedPage:this.state.selectedPageType,changeSelectedPage:this.changeSelectedPage,cmsStatus:this.projectDoc.cms.status,forPopulateCurrentPage:e}),children:(0,F.jsxs)("div",{className:v().dynamic([["4216540131",[N.N_.UNIT,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.FIVE,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.THREE_UNITS]]])+" use-templates-root",children:[this.renderTemplatePreviewOptions(),(0,F.jsx)("div",{className:v().dynamic([["4216540131",[N.N_.UNIT,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.FIVE,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.THREE_UNITS]]])+" previewer-wrapper",children:n?(0,F.jsx)(ee,{selectedPageType:t,selectedContentTypes:this.state.selectedContentTypes,updateSelectedCMSTypes:this.updateSelectedCMSTypes}):(0,F.jsx)(G,{previewUIDL:o,isLoading:this.state.loadingUIDL})})]})})}),(0,F.jsx)("div",{tabIndex:0,className:v().dynamic([["4216540131",[N.N_.UNIT,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.FIVE,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.THREE_UNITS]]])+" content-modal-footer",children:this.renderFooter()}),(0,F.jsx)("div",{tabIndex:0,className:v().dynamic([["4216540131",[N.N_.UNIT,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.FIVE,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.THREE_UNITS]]])}),(0,F.jsx)(v(),{id:"4216540131",dynamic:[N.N_.UNIT,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.DM.GRAY_400,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.FIVE,N.N_.UNIT,N.n_.DEFAULT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS,N.N_.THREE_UNITS],children:[".__jsx-style-dynamic-selector{--content-modal-header:48px;--content-modal-footer:64px;}",`.content-modal-header.__jsx-style-dynamic-selector{padding:0 ${N.N_.UNIT} 0 ${N.N_.TWO_UNITS} !important;height:var(--content-modal-header);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;border-bottom:1px solid ${N.DM.GRAY_400};}`,`.content-modal-footer.__jsx-style-dynamic-selector{padding:0 ${N.N_.TWO_UNITS} 0 ${N.N_.TWO_UNITS} !important;height:var(--content-modal-footer);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-top:1px solid ${N.DM.GRAY_400};gap:${N.N_.UNIT};}`,`.content-root.__jsx-style-dynamic-selector{padding:0 ${N.N_.TWO_UNITS};}`,`.template-title.__jsx-style-dynamic-selector{text-transform:uppercase;min-width:180px;margin-right:${N.N_.FIVE};margin-left:${N.N_.UNIT};}`,".use-templates-root.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}",`.previewer-wrapper.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;border-radius:${N.n_.DEFAULT};-webkit-aling-items:center;-webkit-box-aling:center;-ms-flex-aling:center;aling-items:center;height:640px;gap:${N.N_.UNIT};padding-bottom:${N.N_.UNIT};width:100%;}`,`@media (max-width:600px){.main.__jsx-style-dynamic-selector{padding:${N.N_.TWO_UNITS} ${N.N_.THREE_UNITS};}}`]})]})}},pe=(0,s.Z)(de.prototype,"projectUIState",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ue=(0,s.Z)(de.prototype,"pageManagementFlow",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),he=(0,s.Z)(de.prototype,"layoutManagementFlow",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me=(0,s.Z)(de.prototype,"folderManagementFlow",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ye=(0,s.Z)(de.prototype,"predefinedPagesManagementFlow",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ge=(0,s.Z)(de.prototype,"modalManagementFlow",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fe=(0,s.Z)(de.prototype,"notificationsManagementFlow",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),be=(0,s.Z)(de.prototype,"projectDoc",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),de);var Ne,je,Se,De,Te,Oe,Fe,Ce,Ee,xe,_e,Me,Pe,Ae,ke,Ue,Re,Ze,Le,$e,Be,Ge,He,ze,Ye,Ve,We,Ke,qe,Je,Xe,Qe,et,tt,ot,nt,it,rt,st,at,ct,lt,dt,pt,ut=o(329852);function ht(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function mt(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ht(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Ne=(0,c.provide)("pageManagementFlow"),je=(0,c.inject)("sharedbProjectSyncService"),Se=(0,c.inject)("projectDoc"),De=(0,c.inject)("projectUIState"),Te=(0,c.inject)("assetsEditFlow"),Oe=(0,c.inject)("assetsManagementFlow"),Fe=(0,c.inject)("nodeSelectionFlow"),Ce=(0,c.inject)("notificationsManagementFlow"),Ee=(0,c.inject)("layoutManagementFlow"),xe=(0,c.inject)("sentryService"),_e=(0,c.inject)("navbarFlow"),Me=(0,c.inject)("webRTCState"),Pe=(0,c.inject)("rtcFlow"),Ae=(0,c.inject)("collaboratorManagementFlow"),ke=(0,c.inject)("imageOptimisationFlow"),Ue=(0,c.inject)("pageSettingsManagementFlow"),Re=(0,c.inject)("projectInitFlow"),Ze=(0,c.inject)("modalManagementFlow"),Le=(0,c.inject)("folderManagementFlow"),$e=(0,h.G)(g.l.ENTER_RENAME_PAGE),Be=(0,h.G)(g.l.CREATE_PAGE),Ge=(0,h.G)(g.l.DELETE_PAGE),He=(0,h.G)(g.l.DELETE_PAGE),ze=(0,h.G)(g.l.DUPLICATE_PAGE),Ne((Ve=class{constructor(){(0,i.Z)(this,"dbSync",We,this),(0,i.Z)(this,"projectDoc",Ke,this),(0,i.Z)(this,"projectUIState",qe,this),(0,i.Z)(this,"assetsEditFlow",Je,this),(0,i.Z)(this,"assetsManagementFlow",Xe,this),(0,i.Z)(this,"nodeSelectionFlow",Qe,this),(0,i.Z)(this,"notificationsManagementFlow",et,this),(0,i.Z)(this,"layoutManagementFlow",tt,this),(0,i.Z)(this,"sentryService",ot,this),(0,i.Z)(this,"navbarFlow",nt,this),(0,i.Z)(this,"webRTCState",it,this),(0,i.Z)(this,"rtcFlow",rt,this),(0,i.Z)(this,"collaboratorManagementFlow",st,this),(0,i.Z)(this,"imageOptimisationFlow",at,this),(0,i.Z)(this,"pageSettingsManagementFlow",ct,this),(0,i.Z)(this,"projectInitFlow",lt,this),(0,i.Z)(this,"modalManagementFlow",dt,this),(0,i.Z)(this,"folderManagementFlow",pt,this),(0,r.Z)(this,"replacePageIdWithSlug",(e=>{const t=this.projectDoc.pages.byId[e||""];return t?t.resolvedUrl:e}))}async commitPage(e){const t=this.projectUIState.pageList.pageUnderLocalWork;t&&(this.renamePage({id:t.id,newName:e}),(0,a.mutate)(this.projectUIState,(e=>{e.pageList.pageUnderLocalWork=null})))}async beginEditing(e){const t=this.projectDoc.pages.byId[e||""];e&&t&&(0,a.mutate)(this.projectUIState,(e=>{e.pageList.pageUnderLocalWork=(new f.m).fromJSON(t.toJSON())}))}isPageValid(e){const t=this.projectDoc.getProjectPageOrComponent(e);if("cms-details-page"!==(null===t||void 0===t?void 0:t.type)&&"cms-listing-page"!==(null===t||void 0===t?void 0:t.type))return!0;return!!this.projectDoc.cms.usedContentTypes[t.contentType||""]}createEmptyPage(e){const{enterNameEditMode:t=!0,pageName:o,parentFolderId:n=ut.D.PAGES,doc:i}=e;if(!i)return null;const r=this.projectInitFlow.getProjectLimitations();if(Object.keys(this.projectDoc.pages.byId).length>=r.MAX_PAGES_IN_PROJECT)return this.notificationsManagementFlow.createNotification(d.k$.WARNING,"You reached the maximum number of pages allowed in a project."),null;this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId();const s=new f.m({title:this.projectDoc.getUniqueCompOrPageName(o||"Page"),pos:this.projectDoc.pages.getPositionAfterLast()});return i.addPage({page:s,folderId:n}),this.rtcFlow.notifySelectedComp(s.id),this.navbarFlow.selectOrCreateTabByEntityId(s.id),t&&(0,a.mutate)(this.projectUIState,(e=>{e.pageList.pageUnderLocalWork=(new f.m).fromJSON(s.toJSON())})),this.projectUIState.folders.expandedFolders[n]||this.folderManagementFlow.updateFolderExpandStatus(n,!0),(0,a.mutate)(this.projectUIState,(e=>{e.componentList.stateValues[s.id]={}})),s.id}async createHomePage(){this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId(),this.dbSync.mutate(this.projectDoc,(e=>{const t=new f.m({title:"Home",pos:`${Number.MAX_SAFE_INTEGER}`});t.isHomePage=!0,e.addPage({page:t})}))}async deletePageAndUpdateDependencies(e){const{doc:t,id:o}=e;if(!t||!o)return;const n=t.pages.byId[o];if(!n)throw new Error(`Attempted to delete page that does not exist! Id: ${o}`);this.updatePageDependenciesAfterDeletion({page:n,doc:t}),t.pages.removePage(o);const i=t.folders.getFolderOfChild(o);delete t.folders.byId[i.id].children[o],this.updateUIAfterPageDeletion(o)}async deleteCMSPageAndUpdateDependencies(e){const{doc:t,id:o}=e;if(!t||!o)return;const n=t.cmsPages.byId[o];if(!n)throw new Error(`Attempted to delete page that does not exist! Id: ${o}`);this.updatePageDependenciesAfterDeletion({page:n,doc:t}),delete t.cmsPages.byId[o],this.updateUIAfterPageDeletion(o)}updateUIAfterPageDeletion(e){var t;(0,a.mutate)(this.projectUIState,(e=>(e.userInteractions.isNodeInPreviewMode=!1,e))),this.projectUIState.selection.componentId===e&&this.nodeSelectionFlow.cleanSelectedExpandedAndEditedNodes(),this.navbarFlow.deleteTab((null===(t=this.navbarFlow.getTabByEntityId(e))||void 0===t?void 0:t.id)||"",!0)}openCreatePageModal(e={}){const{forPopulateCurrentPage:t,parentFolderId:o=ut.D.PAGES}=e,n=b.d.createCustomModal({data:{forPopulateCurrentPage:t,parentFolderId:o},onDismiss:()=>{this.modalManagementFlow.hideModal()},Component:we});this.modalManagementFlow.showModal(n,{width:"80%",maxWidth:"1000px",padding:"0px"},!1)}async updatePageDependenciesAfterDeletion(e){var t;const{page:o,doc:n}=e;if(!n)return;this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId(),this.nodeSelectionFlow.resetNodeSelection(),this.imageOptimisationFlow.removeAssetSizeForPageOrComp({id:o.id,doc:n}),n.comments.deleteCommentsForPageOrComponent(o.id),n.nodes.getAllNodes().forEach((e=>{var t;if(!e||!("abilities"in e)||!("attrs"in e))return;const n=null===e||void 0===e||null===(t=e.abilities)||void 0===t?void 0:t.link;"navlink"===(null===n||void 0===n?void 0:n.type)&&n.content.routeName===o.id&&(null===e||void 0===e||delete e.abilities.link),Object.keys(e.attrs||{}).forEach((t=>{const n=e.attrs[t];"static"===n.type&&n.content===o.id&&delete e.attrs[t]}))})),null!==o&&void 0!==o&&null!==(t=o.settings)&&void 0!==t&&t.socialImage&&"string"===typeof o.settings.socialImage&&this.assetsEditFlow.delete(o.settings.socialImage);const i=null===o||void 0===o?void 0:o.rootNodeId;i&&n.deleteNodesById({nodeIds:[i],skipRestoreParentsFakeSize:!0,deleteRoot:!0})}async duplicatePage(e){const{id:t}=e,o=this.projectInitFlow.getProjectLimitations();if(Object.keys(this.projectDoc.pages.byId).length>=o.MAX_PAGES_IN_PROJECT)return this.notificationsManagementFlow.createNotification(d.k$.WARNING,"You reached the maximum number of pages allowed in a project."),null;const n=this.projectDoc.pages.byId[t];if(n)try{var i;let e=null;if(null!==(i=n.settings)&&void 0!==i&&i.socialImage){const t=this.projectDoc.assets.byId[n.settings.socialImage];e=t?await this.assetsManagementFlow.duplicateAssets([t]):null}const o=e?e[0]:null;this.dbSync.mutate(this.projectDoc,(e=>{const n=e.duplicatePage({duplicatedSocialImage:o,doc:e,pageId:t}),i=this.projectDoc.getProjectPageOrComponent(n);if(!i||!i.rootNodeId)return;this.imageOptimisationFlow.getAssetsLinkedToNodes({nodeIds:[i.rootNodeId],withDescendants:!0}).forEach((o=>{const{sizePerComponent:i}=e.assets.byId[o];i&&(i[n]=i[t])})),(0,a.mutate)(this.projectUIState,(e=>{e.componentList.stateValues[n]={},Object.values(i.stateDefinitions).forEach((t=>{e.componentList.stateValues[n][t.id]={id:t.id,value:t.defaultValue,type:t.type,name:t.name,componentInstanceValues:{},meta:{highlightInTreeView:!1}}}))}))}))}catch(r){if(r.message.includes(u.N9.MAXIMUM_LIMIT_REACHED)||r.message.includes(u.N9.MAXIMUM_SIZE_LIMIT_REACHED))return y.Z.mixpanelEvent(y.Z.AnalyticsEvents.WORKSPACE_LIMIT_ASSETS_REACHED),void this.notificationsManagementFlow.createNotification(d.k$.ERROR,r.message);this.sentryService.captureException(r)}}async select(e){if(this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId(),e!==this.projectUIState.selection.componentId)this.navbarFlow.selectOrCreateTabByEntityId(e);else{const t=this.projectDoc.getProjectPageOrComponent(e);null!==t&&void 0!==t&&t.rootNodeId&&this.nodeSelectionFlow.setNodeSelection({nodeId:t.rootNodeId})}}async selectNextPage(){const e=this.projectUIState.selection.componentId,t=this.projectDoc.pages.getIdsOrderedByPageName();if(!e||t.length<=1)return;if(!this.projectDoc.pages.byId[e])return;let o=t.indexOf(e)+1;o>=t.length&&(o=0);this.projectUIState.layout.sidebarPanel!==p.tI.FILES&&this.layoutManagementFlow.changeActiveSidebar(p.tI.FILES),this.rtcFlow.notifySelectedComp(t[o]),this.navbarFlow.selectOrCreateTabByEntityId(t[o])}async selectPreviousPage(){const e=this.projectUIState.selection.componentId,t=this.projectDoc.pages.getIdsOrderedByPageName();if(!e||t.length<=1)return;if(!this.projectDoc.pages.byId[e])return;let o=t.indexOf(e)-1;o<0&&(o=t.length-1);this.projectUIState.layout.sidebarPanel!==p.tI.FILES&&this.layoutManagementFlow.changeActiveSidebar(p.tI.FILES),this.rtcFlow.notifySelectedComp(t[o]),this.navbarFlow.selectOrCreateTabByEntityId(t[o])}setAsHomePage(e){this.dbSync.mutate(this.projectDoc,(t=>{if(this.projectDoc.pages.getFallbackPageId()===e)return void this.notificationsManagementFlow.createNotification(d.k$.ERROR,"404 page can't be marked as home");const o=this.projectDoc.pages.getHomePageId();o&&(t.pages.byId[o].isHomePage=!1),t.pages.byId[e].isHomePage=!0}))}setAsFallbackPage(e){this.dbSync.mutate(this.projectDoc,(t=>{if(this.projectDoc.pages.getHomePageId()===e)return void this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Home page can't be marked as fallback");const o=this.projectDoc.pages.getFallbackPageId();o&&(t.pages.byId[o].isFallbackPage=!1),t.pages.byId[e].isFallbackPage=!0}))}openSettings(e){this.select(e),(0,a.mutate)(this.projectUIState,(e=>{e.previousSelectedPageOrCompId=e.selection.componentId,e.pageList.isSettingsPanelOpen=!0}))}closeSettings(){(0,a.mutate)(this.projectUIState,(e=>{e.pageList.isSettingsPanelOpen=!1}))}renamePage(e){var t;const{id:o,doc:n}=e;let{newName:i}=e;if(!n)return;i=i.replace(/\//g,"");const r=n.pages.byId[o];if(!r||r.title===i||!i)return;const s=n.getUniqueCompOrPageName(i);r.title=s;let a=!1,c=`/${(0,l.N0)(s)}`;null!==r&&void 0!==r&&null!==(t=r.settings)&&void 0!==t&&t.url||(a=!!this.pageSettingsManagementFlow.getOtherPageWithUrl(c,r.id),a&&(c=(0,l.Zu)(this.pageSettingsManagementFlow.getAllExistingPageUrls(),c),r.settings=mt(mt({},r.settings),{},{url:c})))}toggleRemoveFromCodeGeneration(e){const{doc:t,id:o}=e;if(!t||!o)return;const n=t.pages.byId[o];n&&(n.removeFromCodeGeneration=!n.removeFromCodeGeneration)}},We=(0,s.Z)(Ve.prototype,"dbSync",[je],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ke=(0,s.Z)(Ve.prototype,"projectDoc",[Se],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qe=(0,s.Z)(Ve.prototype,"projectUIState",[De],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Je=(0,s.Z)(Ve.prototype,"assetsEditFlow",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe=(0,s.Z)(Ve.prototype,"assetsManagementFlow",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe=(0,s.Z)(Ve.prototype,"nodeSelectionFlow",[Fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),et=(0,s.Z)(Ve.prototype,"notificationsManagementFlow",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tt=(0,s.Z)(Ve.prototype,"layoutManagementFlow",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ot=(0,s.Z)(Ve.prototype,"sentryService",[xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nt=(0,s.Z)(Ve.prototype,"navbarFlow",[_e],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),it=(0,s.Z)(Ve.prototype,"webRTCState",[Me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rt=(0,s.Z)(Ve.prototype,"rtcFlow",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st=(0,s.Z)(Ve.prototype,"collaboratorManagementFlow",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),at=(0,s.Z)(Ve.prototype,"imageOptimisationFlow",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ct=(0,s.Z)(Ve.prototype,"pageSettingsManagementFlow",[Ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lt=(0,s.Z)(Ve.prototype,"projectInitFlow",[Re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dt=(0,s.Z)(Ve.prototype,"modalManagementFlow",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pt=(0,s.Z)(Ve.prototype,"folderManagementFlow",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Ve.prototype,"beginEditing",[$e],Object.getOwnPropertyDescriptor(Ve.prototype,"beginEditing"),Ve.prototype),(0,s.Z)(Ve.prototype,"createEmptyPage",[Be,m.P],Object.getOwnPropertyDescriptor(Ve.prototype,"createEmptyPage"),Ve.prototype),(0,s.Z)(Ve.prototype,"deletePageAndUpdateDependencies",[Ge,m.P],Object.getOwnPropertyDescriptor(Ve.prototype,"deletePageAndUpdateDependencies"),Ve.prototype),(0,s.Z)(Ve.prototype,"deleteCMSPageAndUpdateDependencies",[He,m.P],Object.getOwnPropertyDescriptor(Ve.prototype,"deleteCMSPageAndUpdateDependencies"),Ve.prototype),(0,s.Z)(Ve.prototype,"updatePageDependenciesAfterDeletion",[m.P],Object.getOwnPropertyDescriptor(Ve.prototype,"updatePageDependenciesAfterDeletion"),Ve.prototype),(0,s.Z)(Ve.prototype,"duplicatePage",[ze],Object.getOwnPropertyDescriptor(Ve.prototype,"duplicatePage"),Ve.prototype),(0,s.Z)(Ve.prototype,"renamePage",[m.P],Object.getOwnPropertyDescriptor(Ve.prototype,"renamePage"),Ve.prototype),(0,s.Z)(Ve.prototype,"toggleRemoveFromCodeGeneration",[m.P],Object.getOwnPropertyDescriptor(Ve.prototype,"toggleRemoveFromCodeGeneration"),Ve.prototype),Ye=Ve));var yt,gt,ft,bt,It,vt,wt,Nt,jt,St,Dt,Tt,Ot,Ft,Ct,Et,xt,_t=o(405741),Mt=o(918939),Pt=o(239031),At=o(883970),kt=o(286873);function Ut(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Rt(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ut(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ut(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Zt=["url","seoNoIndex","socialImage"],Lt=(e,t)=>e.pages.byId[t]||e.cmsPages.byId[t];yt=(0,c.provide)("pageSettingsManagementFlow"),gt=(0,c.inject)("sharedbProjectSyncService"),ft=(0,c.inject)("projectDoc"),bt=(0,c.inject)("projectUIState"),It=(0,c.inject)("assetsUploadFlow"),vt=(0,c.inject)("assetsEditFlow"),wt=(0,c.inject)("rtcFlow"),Nt=(0,c.inject)("sentryService"),yt((St=class{constructor(){(0,i.Z)(this,"dbSync",Dt,this),(0,i.Z)(this,"projectDoc",Tt,this),(0,i.Z)(this,"projectUIState",Ot,this),(0,i.Z)(this,"assetsUploadFlow",Ft,this),(0,i.Z)(this,"assetsEditFlow",Ct,this),(0,i.Z)(this,"rtcFlow",Et,this),(0,i.Z)(this,"sentryService",xt,this),(0,r.Z)(this,"internationalizationFlow",Pt.q.Instance),(0,r.Z)(this,"translationManagerFlow",At.K.Instance),(0,r.Z)(this,"internationalizationUtils",kt.V.Instance),(0,r.Z)(this,"pageSettingsTranslationTimeout",{})}updateSettingsByKey(e){const{key:t,value:o}=e,n=this.projectUIState.selection.componentId;if(!n||!Lt(this.projectDoc,n))return"";switch(t){case"title":const t=Lt(this.projectDoc,n).title;if(o&&o!==t&&"string"===typeof o){if(!!this.pageNameExists(o))return _t.lH;this.updateSettingsOrTranslationByKey(e)}break;case"url":const i=this.projectDoc.pages.byId[n]||this.projectDoc.cmsPages.byId[n];if(!i)throw new Error("Page not found to change url");if("cms-details-page"===(null===i||void 0===i?void 0:i.type))throw new Error("Cannot change URL for CMS Details Page");const r=i.settings.url;if(o&&o!==r&&"string"===typeof o){const t=`/${(0,l.N0)(o)}`,r=this.getOtherPageWithUrl(t,n);if(r)return`${_t.qz} This URL is used by page '${r.title}'.`;if("/"===t&&!i.isHomePage)return _t.PX;this.updateSettingsOrTranslationByKey(e)}if(!o&&r){const t=`/${(0,l.N0)(i.title)}`,o=this.getOtherPageWithUrl(t,n);if(o)return`${_t.Zu} The URL is used on page '${o.title}'.`;this.updateSettingsOrTranslationByKey(e)}break;default:this.updateSettingsOrTranslationByKey(e)}return this.translateUpdatedSettingsKey(Rt(Rt({},e),{},{pageId:n})),""}translateUpdatedSettingsKey(e){var t;const o=this.projectDoc.internationalization.enabled;if(!this.projectUIState.userPreferences.automaticallyTranslateTextElements||!o)return;const{language:n,pageId:i,key:r}=e;this.internationalizationUtils.showPageSettingsAutomaticTranslationDialog();const{mainLanguage:s,translations:a,availableLanguages:c}=this.projectDoc.internationalization;if(n!==(null===s||void 0===s?void 0:s.short)||Zt.includes(r))return;if(Object.keys(null!==c&&void 0!==c?c:{}).length<=1)return;const l=null===(t=this.pageSettingsTranslationTimeout[i])||void 0===t?void 0:t[r];l&&clearTimeout(l);const d=Object.keys(a).filter((e=>e!==(null===s||void 0===s?void 0:s.short)));this.pageSettingsTranslationTimeout[i]=Rt(Rt({},this.pageSettingsTranslationTimeout[i]),{},{[r]:setTimeout((async()=>{var e,t;const o=Lt(this.projectDoc,i);if(!o)return;const n=o.settings[r];if(!n)return;if("string"===typeof n||"boolean"===typeof n)return;const s=null===(e=n.content)||void 0===e||null===(t=e.refPath)||void 0===t?void 0:t[0];if(s)try{this.rtcFlow.lockPageSettingsKey(i,r,d),await this.translationManagerFlow.translateStaticValueInEveryLanguage(s)}catch(a){const e=`Error translating page settings key: ${r}, ${a}`;console.error(e),this.sentryService.captureException(e)}finally{this.rtcFlow.unlockPageSettingsKey(i,r,d)}}),300)})}updateSettingsOrTranslationByKey(e){const{key:t,value:o,language:n}=e,i=this.projectUIState.selection.componentId;i&&this.dbSync.mutate(this.projectDoc,(e=>{const{mainLanguage:r,enabled:s}=e.internationalization,a=Lt(e,i);if(!a)throw new Error("Page not found to update settings");if(Zt.includes(t))return void(a.settings=Rt(Rt({},a.settings),{},{[t]:o}));const c=a.settings[t];if(c&&"string"!==typeof c){if("boolean"===typeof c||"boolean"===typeof o)return o?void(a.settings=Rt(Rt({},a.settings),{},{[t]:o})):void delete a.settings[t];if(!n)throw new Error("Language is required to update translation");var l,d;if(null===o&&(a.settings=Rt(Rt({},a.settings),{},{[t]:void 0})),s)this.internationalizationFlow.updateStaticTextTranslation({doc:e,lang:n,key:null!==(l=null===(d=c.content.refPath)||void 0===d?void 0:d[0])&&void 0!==l?l:"",value:o})}else{if(s){const i=this.internationalizationFlow.linkStaticTextToTranslation({doc:e,initialValue:o,initialLanguage:n,defaultValueForOtherLanguages:(null===r||void 0===r?void 0:r.short)===n?void 0:""});return void(a.settings=Rt(Rt({},a.settings),{},{[t]:i}))}a.settings=Rt(Rt({},a.settings),{},{[t]:o})}}))}pageNameExists(e){if(!e)throw new Error("Could not check if project name exists. Name was not provided");return this.projectDoc.pages.getIds().some((t=>{var o;return(null===(o=this.projectDoc.pages.byId[t])||void 0===o?void 0:o.title)===e}))}getOtherPageWithUrl(e,t){return Object.values(Rt(Rt({},this.projectDoc.pages.byId),this.projectDoc.cmsPages.byId)).find((o=>!(!o||!o.settings||o.id===t)&&("cms-details-page"!==o.type&&(o.settings.url?o.settings.url===e:`/${(0,l.N0)(o.title)}`===e))))}getAllExistingPageUrls(){return Object.values(this.projectDoc.pages.byId).map((e=>{var t;return null!==e&&void 0!==e&&null!==(t=e.settings)&&void 0!==t&&t.url?e.settings.url:null!==e&&void 0!==e&&e.title?`/${(0,l.N0)(null===e||void 0===e?void 0:e.title)}`:""}))}async uploadSocialImage(e){const{files:t,oldAssetId:o}=e,n=await this.assetsUploadFlow.upload({files:t,assetType:Mt.K.PAGE_OG_IMAGE,parentFolderId:ut.D.PUBLIC_ASSETS});return o&&n&&this.assetsEditFlow.delete([o]),n}async deleteSocialImage(e){const t=await this.assetsEditFlow.delete(e),o=this.projectUIState.selection.componentId;return t&&o&&this.dbSync.mutate(this.projectDoc,(e=>{const t=Lt(e,o);if(!t)throw new Error(`Page ${o} not found to delete social image`);delete t.settings.socialImage})),t}},Dt=(0,s.Z)(St.prototype,"dbSync",[gt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tt=(0,s.Z)(St.prototype,"projectDoc",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ot=(0,s.Z)(St.prototype,"projectUIState",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ft=(0,s.Z)(St.prototype,"assetsUploadFlow",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ct=(0,s.Z)(St.prototype,"assetsEditFlow",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Et=(0,s.Z)(St.prototype,"rtcFlow",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xt=(0,s.Z)(St.prototype,"sentryService",[Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jt=St));var $t,Bt,Gt,Ht,zt,Yt,Vt,Wt,Kt,qt,Jt,Xt,Qt,eo,to,oo,no,io,ro,so=o(476535),ao=o(961852),co=o(341327),lo=o.n(co),po=o(646138),uo=o(65982);let ho=($t=(0,c.inject)("projectUIState"),Bt=(0,c.inject)("notificationsManagementFlow"),Gt=(0,c.inject)("commentsFlow"),Ht=(0,c.inject)("projectDoc"),zt=(0,c.inject)("layoutManagementFlow"),Yt=(0,c.inject)("sentryService"),Vt=(0,c.inject)("nodeSelectionFlow"),Wt=(0,c.inject)("elementRefProvider"),Kt=(0,c.inject)("globalAppState"),qt=class extends w.Component{constructor(...e){super(...e),(0,i.Z)(this,"uiState",Jt,this),(0,i.Z)(this,"notificationsFlow",Xt,this),(0,i.Z)(this,"commentsFlow",Qt,this),(0,i.Z)(this,"projectDoc",eo,this),(0,i.Z)(this,"layoutManagementFlow",to,this),(0,i.Z)(this,"sentryService",oo,this),(0,i.Z)(this,"nodeSelectionFlow",no,this),(0,i.Z)(this,"elementRefProvider",io,this),(0,i.Z)(this,"globalAppState",ro,this),(0,r.Z)(this,"ref",w.createRef()),(0,r.Z)(this,"unsubs",[]),(0,r.Z)(this,"errors",{nodeIdNotFound:{sentry:"nodeIdNotFound",userMessage:"You can only add a comment to a node or a component"},multipleNodes:{sentry:"multipleNodes",userMessage:"You can only add a comment to one node at a time"}}),(0,r.Z)(this,"determineCommentType",((e,t)=>{const o=!this.projectDoc.components.byId[e];return 0===t.length?o?"page":"component":"element-node"})),(0,r.Z)(this,"state",{commentValue:"",commentMentions:{},selectedComponentId:this.uiState.selection.componentId,selectedComponentInstanceId:this.uiState.selection.compInstanceId,selectedNodeInstanceIds:this.nodeSelectionFlow.getSelectedNodeInstanceIds(),commentType:this.determineCommentType(this.uiState.selection.componentId,Object.values(this.uiState.selection.nodes))}),(0,r.Z)(this,"addComment",(()=>{if(this.state.selectedNodeInstanceIds.length>1)return this.notificationsFlow.createNotification(d.k$.WARNING,this.errors.multipleNodes.userMessage),void this.sentryService.captureException(this.errors.multipleNodes.sentry);let e=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(this.state.selectedNodeInstanceIds[0]);const t=this.state.selectedComponentId;if(!e&&t){const o=this.projectDoc.getProjectPageOrComponent(t);e=(null===o||void 0===o?void 0:o.rootNodeId)||""}const o=this.elementRefProvider.getDomNodeElementRefByNodeId(e||""),n=this.projectDoc.nodes.getById(e||"");if(o&&n&&Object.keys(n.getDynamicProperties()||{}).length>0){const t=o.getAttribute("data-comp-instance-id");t&&(this.notificationsFlow.createNotification(d.k$.WARNING,"You have tried adding a comment to a dynamic node inside a Component Instance. The comment was placed on the Component Instance, not on the dynamic node."),e=t)}if(!e)return this.notificationsFlow.createNotification(d.k$.WARNING,"You can only add a comment to a node or a component"),void this.sentryService.captureException(this.errors.nodeIdNotFound.sentry);if(0===this.state.commentValue.trim().length)return void this.commentsFlow.notifications.commentCantBeEmpty();const i={value:this.state.commentValue,type:this.state.commentType,nodeId:e,mentions:this.state.commentMentions};this.commentsFlow.addComment(i),this.props.onClose(),this.notificationsFlow.createNotification(d.k$.SUCCESS,"Comment added successfully"),this.layoutManagementFlow.comments.show()}))}componentDidMount(){const e=(0,a.select)(this.uiState,["selection/nodeInstanceIds/*","selection/componentId"],(e=>{const{nodeInstanceIds:t,componentId:o}=e.selection,n=this.determineCommentType(o,Object.values(t));this.setState({selectedNodeInstanceIds:Object.values(t),selectedComponentId:o,commentType:n})}),"CommentsDraggable");this.unsubs=[()=>e.dispose()]}componentWillUnmount(){this.unsubs.forEach((e=>e())),this.unsubs=[]}render(){var e,t;const{selectedComponentId:o,selectedNodeInstanceIds:n}=this.state,i=n.length>1;let r=null===(e=this.projectDoc.pages.byId[o||""])||void 0===e?void 0:e.title,s=null===(t=this.projectDoc.components.byId[o||""])||void 0===t?void 0:t.title;const a=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(this.state.selectedNodeInstanceIds[0]),c=this.projectDoc.nodes.getById(a||""),l=(null===c||void 0===c?void 0:c.name)||(null===c||void 0===c?void 0:c.primitiveType);l?(r="",s=""):s&&(r="");const d=this.globalAppState.user.userData,p=this.projectDoc.collaborators.getAll().map((e=>{var t,o,n,i,r;return{id:(null===(t=e.account)||void 0===t?void 0:t.id)||e.id,name:(0,uo.b3)(null===(o=e.account)||void 0===o?void 0:o.name,null===(n=e.account)||void 0===n?void 0:n.email),email:(null===(i=e.account)||void 0===i?void 0:i.email)||e.invitedEmail||"",avatar:(null===(r=e.account)||void 0===r?void 0:r.picture)||"/static/img/default-avatar.png"}})).filter((e=>e.id!==(null===d||void 0===d?void 0:d.id)));return(0,F.jsxs)("div",{ref:this.ref,className:v().dynamic([["4064637187",[N.N_.UNIT]]])+" add-new-comment-wrapper",children:[i?(0,F.jsx)("div",{className:v().dynamic([["4064637187",[N.N_.UNIT]]])+" multiple-selection-error",children:"You can only add a comment to one node at a time"}):(0,F.jsx)(po.K,{placeholder:l?`Add comment to "${l}"`:r?`Add comment to page "${r}"`:s?`Add comment to "${s}"`:"Add comment to node",value:this.state.commentValue,users:p,onChange:(e,t)=>{this.setState({commentValue:e,commentMentions:t})},autoFocus:!0,onSubmit:this.addComment}),(0,F.jsx)(v(),{id:"4064637187",dynamic:[N.N_.UNIT],children:[`.add-new-comment-wrapper.__jsx-style-dynamic-selector{position:relative;width:100%;padding:${N.N_.UNIT};}`,".multiple-selection-error.__jsx-style-dynamic-selector{color:red;margin-bottom:8px;}",".add-comment-textarea.__jsx-style-dynamic-selector{width:100%;}"]})]})}},Jt=(0,s.Z)(qt.prototype,"uiState",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt=(0,s.Z)(qt.prototype,"notificationsFlow",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qt=(0,s.Z)(qt.prototype,"commentsFlow",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo=(0,s.Z)(qt.prototype,"projectDoc",[Ht],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),to=(0,s.Z)(qt.prototype,"layoutManagementFlow",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oo=(0,s.Z)(qt.prototype,"sentryService",[Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),no=(0,s.Z)(qt.prototype,"nodeSelectionFlow",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),io=(0,s.Z)(qt.prototype,"elementRefProvider",[Wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ro=(0,s.Z)(qt.prototype,"globalAppState",[Kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qt);var mo,yo,go;let fo=(mo=(0,c.inject)("absolutePositionedLayerFlow"),yo=class extends w.Component{constructor(...e){super(...e),(0,i.Z)(this,"absolutePositionedLayerFlow",go,this),(0,r.Z)(this,"draggableRef",w.createRef()),(0,r.Z)(this,"getMiddlePosition",(()=>({x:(window.innerWidth-320)/2,y:200})))}render(){return(0,F.jsxs)("div",{className:v().dynamic([["331640165",[N.DM.GRAY_200,N.N_.UNIT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS]]])+" comment-draggable-wrapper",children:[(0,F.jsx)(lo(),{defaultPosition:this.getMiddlePosition(),nodeRef:this.draggableRef,children:(0,F.jsxs)("div",{ref:this.draggableRef,className:v().dynamic([["331640165",[N.DM.GRAY_200,N.N_.UNIT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS]]])+" content",children:[(0,F.jsxs)("div",{className:v().dynamic([["331640165",[N.DM.GRAY_200,N.N_.UNIT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS]]])+" title",children:[(0,F.jsx)("span",{className:v().dynamic([["331640165",[N.DM.GRAY_200,N.N_.UNIT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS]]]),children:"Add Comment"}),(0,F.jsx)(j.z,{shape:"square",style:"transparent",size:"tiny",onClick:this.props.onClose,children:(0,F.jsx)(S.J,{type:"actions/close",size:12})})]}),(0,F.jsx)("div",{onMouseDown:e=>{e.stopPropagation()},className:v().dynamic([["331640165",[N.DM.GRAY_200,N.N_.UNIT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS]]])+" body",children:(0,F.jsx)(ho,{onClose:this.absolutePositionedLayerFlow.hideElement})})]})}),(0,F.jsx)(v(),{id:"331640165",dynamic:[N.DM.GRAY_200,N.N_.UNIT,N.N_.UNIT,N.N_.UNIT,N.N_.TWO_UNITS],children:[".comment-draggable-wrapper.__jsx-style-dynamic-selector{position:fixed;z-index:1000;pointer-events:none;width:100%;height:100%;}",`.content.__jsx-style-dynamic-selector{pointer-events:auto;width:320px;background-color:${N.DM.GRAY_200};}`,`.title.__jsx-style-dynamic-selector{padding:${N.N_.UNIT} ${N.N_.UNIT} ${N.N_.UNIT} ${N.N_.TWO_UNITS};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:1px solid var(--color-neutral-300);cursor:move;}`]})]})}},go=(0,s.Z)(yo.prototype,"absolutePositionedLayerFlow",[mo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yo);var bo,Io,vo,wo,No,jo,So,Do,To,Oo,Fo,Co,Eo,xo,_o,Mo,Po,Ao,ko,Uo,Ro,Zo,Lo,$o,Bo,Go,Ho,zo,Yo,Vo,Wo,Ko,qo;bo=(0,c.provide)("commentsFlow"),Io=(0,c.inject)("projectDoc"),vo=(0,c.inject)("projectUIState"),wo=(0,c.inject)("globalAppState"),No=(0,c.inject)("absolutePositionedLayerFlow"),jo=(0,c.inject)("notificationsManagementFlow"),So=(0,c.inject)("sentryService"),Do=(0,c.inject)("nodeSelectionFlow"),To=(0,c.inject)("stageScrollFlow"),Oo=(0,c.inject)("zoomControlFlow"),Fo=(0,c.inject)("stageMoveFlow"),Co=(0,c.inject)("notificationsManagementFlow"),Eo=(0,c.inject)("nodeEditingFlow"),xo=(0,c.inject)("navbarFlow"),_o=(0,c.inject)("layoutManagementFlow"),Mo=(0,c.inject)("elementRefProvider"),bo((Ao=class{constructor(){(0,i.Z)(this,"projectDoc",ko,this),(0,i.Z)(this,"projectUIState",Uo,this),(0,i.Z)(this,"globalAppState",Ro,this),(0,i.Z)(this,"absolutePositionedLayerFlow",Zo,this),(0,i.Z)(this,"notificationsFlow",Lo,this),(0,i.Z)(this,"sentryService",$o,this),(0,i.Z)(this,"nodeSelectionFlow",Bo,this),(0,i.Z)(this,"stageScrollFlow",Go,this),(0,i.Z)(this,"zoomControlFlow",Ho,this),(0,i.Z)(this,"stageMoveFlow",zo,this),(0,i.Z)(this,"notificationsManagementFlow",Yo,this),(0,i.Z)(this,"nodeEditingFlow",Vo,this),(0,i.Z)(this,"navbarFlow",Wo,this),(0,i.Z)(this,"layoutManagementFlow",Ko,this),(0,i.Z)(this,"elementRefProvider",qo,this),(0,r.Z)(this,"notifications",{commentCantBeEmpty:()=>this.notificationsFlow.createNotification(d.k$.WARNING,"Please enter a comment"),updateSuccess:()=>this.notificationsFlow.createNotification(d.k$.SUCCESS,"Comment updated"),createSuccess:()=>this.notificationsFlow.createNotification(d.k$.SUCCESS,"Comment created"),error:()=>this.notificationsFlow.createNotification(d.k$.ERROR,"An error occurred while processing the comment")}),(0,r.Z)(this,"errors",{DOC_IS_MISSING:"Document is missing",USER_ID_IS_MISSING:"User ID is missing",USER_EMAIL_IS_MISSING:"User email is missing"}),(0,r.Z)(this,"getAllComments",(()=>{const e=this.projectDoc.comments.byId;return void 0===e?{}:e})),(0,r.Z)(this,"getCommentsForNode",(e=>Object.values(this.getAllComments()).filter((t=>t.boundToEntityId===e)))),(0,r.Z)(this,"getRepliesForCommentId",(e=>{var t;return Object.values((null===(t=this.projectDoc.comments)||void 0===t?void 0:t.byId)||{}).filter((t=>t.replyToCommentId===e)).sort(((e,t)=>{var o,n;return(null!==(o=e.updatedAt)&&void 0!==o?o:e.createdAt)-(null!==(n=t.updatedAt)&&void 0!==n?n:t.createdAt)}))})),(0,r.Z)(this,"getFilteredAndSortedComments",((e="createdAt",t={})=>{var o;const n=null===(o=this.globalAppState.user.userData)||void 0===o?void 0:o.id,i={};let r=Object.values(this.projectDoc.comments.byId).filter((e=>!e.deletedByUserId));if(t.searchTerm&&t.searchTerm.trim()){const e=t.searchTerm.toLowerCase().trim(),o=r.filter((t=>t.value.toLowerCase().includes(e)||t.userInfo.name.toLowerCase().includes(e)||t.userInfo.email.toLowerCase().includes(e))),n=new Set;o.forEach((e=>{e.replyToCommentId?n.add(e.replyToCommentId):n.add(e.id)})),r=r.filter((e=>e.replyToCommentId?n.has(e.replyToCommentId):n.has(e.id)))}if(t.myThreadsOnly&&n){const e=new Set;r.forEach((t=>{t.userInfo.id===n&&(t.replyToCommentId?e.add(t.replyToCommentId):e.add(t.id))})),r=r.filter((t=>t.replyToCommentId?e.has(t.replyToCommentId):e.has(t.id)))}if(r=t.showResolved?r.filter((e=>!!e.replyToCommentId||e.resolvedByUser)):r.filter((e=>!!e.replyToCommentId||!e.resolvedByUser)),t.showOnlyCurrentPageOrComponent){const e=this.projectUIState.selection.componentId;e&&(r=r.filter((t=>t.pageOrComponentId===e)))}const s=r.sort(((t,o)=>{var i,r,s,a;switch(e){case"createdAt":return(null!==(i=o.createdAt)&&void 0!==i?i:o.updatedAt)-(null!==(r=t.createdAt)&&void 0!==r?r:t.updatedAt);case"unread":const e=!Object.keys(t.readBy||{}).includes(n||""),c=!Object.keys(o.readBy||{}).includes(n||"");return e&&!c?-1:!e&&c?1:(null!==(s=o.createdAt)&&void 0!==s?s:o.updatedAt)-(null!==(a=t.createdAt)&&void 0!==a?a:t.updatedAt);default:return 0}}));return s.forEach((e=>{e.replyToCommentId&&(i[e.replyToCommentId]||(i[e.replyToCommentId]=[]),i[e.replyToCommentId].push(e))})),{rootComments:s.filter((e=>!e.replyToCommentId)),replies:i}})),(0,r.Z)(this,"selectComment",(e=>{var t;const o=this.projectDoc.comments.byId[e];if(!o)return this.sentryService.captureException(new Error(`Comment with id ${e} not found`)),void this.notifications.error();this.projectUIState.layout.commentsTab!==p.Dn.HIDDEN||this.layoutManagementFlow.comments.show();const{boundToEntityId:n,pageOrComponentId:i}=o;let r=null===(t=this.projectDoc.nodes.getById(n))||void 0===t?void 0:t.id;if(!r){var s;const e=null===(s=this.projectDoc.getProjectPageOrComponent(i))||void 0===s?void 0:s.rootNodeId;if(!e)throw new Error(`Page or component with id ${i} not found`);r=e}const a=this.projectUIState.selection.componentId;a&&a!==o.pageOrComponentId?(this.navbarFlow.selectOrCreateTabByEntityId(o.pageOrComponentId),this.waitForCommentToBeVisible(r,e)):this.goToNodeComment(r,e)})),(0,r.Z)(this,"clearSelectedComment",(()=>{var e;const t=null===(e=this.globalAppState.user.userData)||void 0===e?void 0:e.id;if(!t)return;const o=this.projectUIState.selection.commentId;if(!o)return;const n=this.projectDoc.comments.byId[o];if(!n)return this.sentryService.captureException(new Error(`Comment with id ${o} not found`)),void this.notifications.error();n.readBy[t]||this.markAsRead({commentId:o}),(0,a.mutate)(this.projectUIState,(e=>{e.selection.commentId=null}))})),(0,r.Z)(this,"openCommentsDraggable",(({commentId:e})=>{setTimeout((()=>{this.absolutePositionedLayerFlow.showElement((0,F.jsx)(fo,{commentId:e,onClose:()=>this.absolutePositionedLayerFlow.hideElement()}),{x:0,y:0},!1)}),0)})),(0,r.Z)(this,"getCommentsWithMentions",(e=>this.projectDoc.comments.getCommentsWithMentions(e))),(0,r.Z)(this,"getResolvedComments",(()=>Object.values(this.getAllComments()).filter((e=>e.isResolved())))),(0,r.Z)(this,"getUnresolvedComments",(()=>Object.values(this.getAllComments()).filter((e=>!e.isResolved())))),(0,r.Z)(this,"getCommentsForPageOrComponent",(e=>this.projectDoc.comments.getCommentsForPageOrComponent(e))),(0,r.Z)(this,"getCommentsGroupedByPageOrComponent",(()=>this.projectDoc.comments.getCommentsGroupedByPageOrComponent())),(0,r.Z)(this,"updateSortRule",(e=>{(0,a.mutate)(this.projectUIState,(t=>{t.comments.activeSortRule=e}))})),(0,r.Z)(this,"toggleFilter",(e=>{(0,a.mutate)(this.projectUIState,(t=>{t.comments.activeFilters[e]=!t.comments.activeFilters[e]}))})),(0,r.Z)(this,"setSearchTerm",(e=>{(0,a.mutate)(this.projectUIState,(t=>{t.comments.activeFilters.searchTerm=e}))})),(0,r.Z)(this,"clearFilter",(e=>{(0,a.mutate)(this.projectUIState,(t=>{t.comments.activeFilters[e]=!1}))})),(0,r.Z)(this,"clearAllFilters",(()=>{(0,a.mutate)(this.projectUIState,(e=>{e.comments.activeFilters.myThreadsOnly=!1,e.comments.activeFilters.showResolved=!1,e.comments.activeFilters.showOnlyCurrentPageOrComponent=!1,e.comments.activeFilters.searchTerm=""}))})),(0,r.Z)(this,"updateNotificationSettings",(e=>{(0,a.mutate)(this.projectUIState,(t=>{t.comments.notifications=e}))}))}waitForCommentToBeVisible(e,t){let o=0;const n=()=>{o++;try{if(this.elementRefProvider.getIframeRoot()){if(this.elementRefProvider.getDomTargetNode({nodeId:e}))return void this.executePostIframeLoadOperations(e,t)}o<40?setTimeout(n,50):this.executePostIframeLoadOperations(e,t)}catch(i){o<40?setTimeout(n,50):this.executePostIframeLoadOperations(e,t)}};setTimeout(n,100)}executePostIframeLoadOperations(e,t){this.zoomControlFlow.setStageZoomLevel(.5),this.stageMoveFlow.centerStage(),this.goToNodeComment(e,t)}goToNodeComment(e,t){this.nodeSelectionFlow.setNodeSelection({nodeId:e,expandTreeView:!0}),this.stageScrollFlow.bringNodeIntoView({nodeId:e,verticalOffset:200}),(0,a.mutate)(this.projectUIState,(e=>{e.selection.commentId=t}))}addComment(e){const{doc:t,value:o,replyToCommentId:n,nodeId:i,type:r="reply",mentions:s={}}=e;if(!t)return;const{name:a,email:c,id:l,picture:d}=this.globalAppState.user.userData||{};if(!c||!l)return this.sentryService.captureException(new Error(this.errors.USER_EMAIL_IS_MISSING)),void this.notifications.error();let p=t.nodes.getComponentIdOf(i);var u;!p&&n&&(p=null===(u=t.comments.byId[n])||void 0===u?void 0:u.pageOrComponentId);if(!p)throw new Error("Bound Node does not belong to any page or component");t.comments.add(new ao.s({value:o,userInfo:{id:l,name:(0,uo.b3)(a,c),email:c,avatar:d},type:r,readBy:{[l]:(0,uo.b3)(a,c)},boundToEntityId:i,deletedByUserId:null,resolvedByUser:null,replyToCommentId:null!==n&&void 0!==n?n:null,createdAt:Date.now(),updatedAt:Date.now(),mentions:s,pageOrComponentId:p})),n&&this.handleThreadReadStatusAfterReply(n,l,t)}updateComment(e){const{doc:t,value:o,commentId:n,mentions:i={}}=e;if(!t)return this.sentryService.captureException(new Error(this.errors.DOC_IS_MISSING)),this.notifications.error(),!1;if(0===o.trim().length)return this.notifications.commentCantBeEmpty(),!1;const{email:r,id:s}=this.globalAppState.user.userData||{};if(!r||!s)return this.sentryService.captureException(new Error(this.errors.USER_EMAIL_IS_MISSING)),this.notifications.error(),!1;const a=t.comments.byId[n];return!(!a||a.userInfo.id!==s)&&(t.comments.updateComment({commentId:n,value:o}),Object.keys(i).length>0&&(a.mentions=i),!0)}deleteComment(e){const{doc:t}=e,{id:o}=this.globalAppState.user.userData||{};if(!t)return this.sentryService.captureException(new Error(this.errors.DOC_IS_MISSING)),this.notifications.error(),!1;if(!o)return this.sentryService.captureException(new Error(this.errors.USER_ID_IS_MISSING)),this.notifications.error(),!1;const{commentId:n}=e,i=t.comments.byId[n];return!(!i||i.userInfo.id!==o)&&t.comments.delete({commentId:n})}markAsRead(e){const{doc:t}=e;if(!t)return;const{commentId:o}=e,{id:n,name:i,email:r}=this.globalAppState.user.userData||{};n&&t.comments.markCommentAsRead(o,n,(0,uo.b3)(i,r))}markAllCommentsAsRead(e){var t,o,n;const{doc:i}=e;if(!i)return;const r=null===(t=this.globalAppState.user.userData)||void 0===t?void 0:t.id,s=null===(o=this.globalAppState.user.userData)||void 0===o?void 0:o.name,a=null===(n=this.globalAppState.user.userData)||void 0===n?void 0:n.email;if(!r)return;Object.values(this.projectDoc.comments.byId).filter((e=>!e.deletedByUserId)).forEach((e=>{e.readBy[r]||i.comments.markCommentAsRead(e.id,r,(0,uo.b3)(s,a))}))}markCommentAsUnread(e){const{doc:t}=e;if(!t)return this.sentryService.captureException(new Error(this.errors.DOC_IS_MISSING)),void this.notifications.error();const{commentId:o,forUserId:n}=e,{id:i}=this.globalAppState.user.userData||{};i&&t.comments.markCommentAsUnread(o,n||i)}handleThreadReadStatusAfterReply(e,t,o){const n=this.getAllComments(),i=n[e];if(!i)return;const r=i.replyToCommentId||e,s=Object.values(n).filter((e=>e.id===r||e.replyToCommentId===r)),a=new Set;s.forEach((e=>{a.add(e.userInfo.id),e.mentions&&Object.values(e.mentions).forEach((e=>{a.add(e.userId)}))}));const c=Array.from(a).filter((e=>e!==t));c.length>0&&(c.forEach((e=>{this.markCommentAsUnread({commentId:r,forUserId:e,doc:o})})),this.sendThreadForEmailNotification(s))}resolveComment(e){const{doc:t,commentId:o}=e;if(!t)return;const n=this.globalAppState.user.userData;if(!n)return;t.comments.byId[o]&&t.comments.resolveComment(o,{id:n.id,name:(0,uo.b3)(n.name,n.email)})}unresolveComment(e){const{doc:t,commentId:o}=e;if(!t)return;t.comments.byId[o]&&t.comments.unresolveComment(o)}showNotificationForMentionedUser(e){const t=this.globalAppState.user.userData;if(!t)return;if(e.userInfo.id===t.id)return;const o=this.projectUIState.comments.notifications;if("none"===o)return;const n=e.mentions&&Object.values(e.mentions).some((e=>e.userId===t.id)),i=e.replyToCommentId||e.id,r=this.getAllComments(),s=Object.values(r).filter((e=>e.id===i||e.replyToCommentId===i)).some((e=>e.userInfo.id===t.id||!(!e.mentions||!Object.values(e.mentions).some((e=>e.userId===t.id)))));let a=!1;if("all"===o?a=!0:"mentionsAndReplies"===o&&(a=n||s),a){const t=this.projectDoc.comments.byId[i];if(!t)return;const o=this.projectDoc.nodes.getById(t.boundToEntityId),n=this.projectDoc.getProjectPageOrComponent(t.pageOrComponentId);if(!o||!n)return;const r=this.nodeEditingFlow.getElementIconPath([o.id]),s=this.nodeEditingFlow.getNodeDisplayName([o.id]),a=(0,F.jsxs)("div",{className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]])+" notification-content",children:[(0,F.jsxs)("div",{className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]])+" notification-info",children:[(0,F.jsxs)("div",{className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]])+" user-info",children:[e.userInfo.avatar&&(0,F.jsx)("img",{src:e.userInfo.avatar,alt:e.userInfo.name,className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]])}),(0,F.jsx)("span",{className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]])+" user-name",children:e.userInfo.name})]}),(0,F.jsx)("span",{className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]]),children:"left a comment on"}),(0,F.jsxs)("div",{className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]])+" element-info",children:[(0,F.jsx)(S.J,{type:r,size:14,color:N.DM.GRAY_1000}),(0,F.jsx)("span",{className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]])+" element-name",children:s})]}),(0,F.jsx)("span",{className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]])+" in-text",children:"in"}),(0,F.jsxs)("div",{className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]])+" comp-info",children:[(0,F.jsx)(S.J,{type:n.type.includes("page")?"file":"component",size:14,color:N.DM.GRAY_1000}),(0,F.jsx)("span",{className:v().dynamic([["3684022827",[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000]]])+" comp-name",children:n.title})]})]}),(0,F.jsx)(j.z,{size:"small",colorScheme:"neutral",onClick:()=>this.selectComment(e.replyToCommentId||e.id),children:"View Comment"}),(0,F.jsx)(v(),{id:"3684022827",dynamic:[N.N_.TWO_UNITS,N.N_.ONE_AND_HALF,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000,N.DM.GRAY_1000],children:[`.notification-content.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:${N.N_.TWO_UNITS};padding-right:${N.N_.ONE_AND_HALF};-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;width:100%;}`,`.notification-info.__jsx-style-dynamic-selector{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;gap:${N.N_.HALF_UNIT};-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex:1;-ms-flex:1;flex:1;}`,`.user-info.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:${N.N_.HALF_UNIT};color:${N.DM.GRAY_1000};}`,`.user-name.__jsx-style-dynamic-selector{font-weight:600;color:${N.DM.GRAY_1000};}`,".user-info.__jsx-style-dynamic-selector img.__jsx-style-dynamic-selector{width:24px;height:24px;border-radius:50%;object-fit:cover;}",`.element-info.__jsx-style-dynamic-selector,.comp-info.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:2px;color:${N.DM.GRAY_1000};}`,`.element-name.__jsx-style-dynamic-selector,.comp-name.__jsx-style-dynamic-selector{font-weight:500;color:${N.DM.GRAY_1000};}`,`.in-text.__jsx-style-dynamic-selector{color:${N.DM.GRAY_1000};}`]})]});this.notificationsManagementFlow.createNotification(d.k$.DEFAULT,a,{duration:12e3})}}async sendThreadForEmailNotification(e){}},ko=(0,s.Z)(Ao.prototype,"projectDoc",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uo=(0,s.Z)(Ao.prototype,"projectUIState",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ro=(0,s.Z)(Ao.prototype,"globalAppState",[wo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zo=(0,s.Z)(Ao.prototype,"absolutePositionedLayerFlow",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lo=(0,s.Z)(Ao.prototype,"notificationsFlow",[jo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$o=(0,s.Z)(Ao.prototype,"sentryService",[So],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bo=(0,s.Z)(Ao.prototype,"nodeSelectionFlow",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Go=(0,s.Z)(Ao.prototype,"stageScrollFlow",[To],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ho=(0,s.Z)(Ao.prototype,"zoomControlFlow",[Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zo=(0,s.Z)(Ao.prototype,"stageMoveFlow",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yo=(0,s.Z)(Ao.prototype,"notificationsManagementFlow",[Co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vo=(0,s.Z)(Ao.prototype,"nodeEditingFlow",[Eo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wo=(0,s.Z)(Ao.prototype,"navbarFlow",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ko=(0,s.Z)(Ao.prototype,"layoutManagementFlow",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qo=(0,s.Z)(Ao.prototype,"elementRefProvider",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Ao.prototype,"addComment",[so.W],Object.getOwnPropertyDescriptor(Ao.prototype,"addComment"),Ao.prototype),(0,s.Z)(Ao.prototype,"updateComment",[so.W],Object.getOwnPropertyDescriptor(Ao.prototype,"updateComment"),Ao.prototype),(0,s.Z)(Ao.prototype,"deleteComment",[so.W],Object.getOwnPropertyDescriptor(Ao.prototype,"deleteComment"),Ao.prototype),(0,s.Z)(Ao.prototype,"markAsRead",[so.W],Object.getOwnPropertyDescriptor(Ao.prototype,"markAsRead"),Ao.prototype),(0,s.Z)(Ao.prototype,"markAllCommentsAsRead",[so.W],Object.getOwnPropertyDescriptor(Ao.prototype,"markAllCommentsAsRead"),Ao.prototype),(0,s.Z)(Ao.prototype,"markCommentAsUnread",[so.W],Object.getOwnPropertyDescriptor(Ao.prototype,"markCommentAsUnread"),Ao.prototype),(0,s.Z)(Ao.prototype,"resolveComment",[so.W],Object.getOwnPropertyDescriptor(Ao.prototype,"resolveComment"),Ao.prototype),(0,s.Z)(Ao.prototype,"unresolveComment",[so.W],Object.getOwnPropertyDescriptor(Ao.prototype,"unresolveComment"),Ao.prototype),Po=Ao));o(570735);var Jo=o(522788),Xo=o(415066);const Qo=e=>{const{onDismiss:t,onSubmit:o}=e;return(0,F.jsxs)("div",{className:v().dynamic([["1561848550",[N.DM.GRAY_200,N.GC.NEUTRAL,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.N_.TWO_UNITS]]])+" modal-wrapper",children:[(0,F.jsxs)("div",{className:v().dynamic([["1561848550",[N.DM.GRAY_200,N.GC.NEUTRAL,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.N_.TWO_UNITS]]])+" modal-header",children:[(0,F.jsx)("span",{className:v().dynamic([["1561848550",[N.DM.GRAY_200,N.GC.NEUTRAL,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.N_.TWO_UNITS]]])+" title",children:"Error occurred while publishing"}),(0,F.jsx)(j.z,{onClick:t,style:"transparent",size:"small",shape:"regular",children:(0,F.jsx)(S.J,{type:"actions/close",size:16})})]}),(0,F.jsxs)("span",{className:v().dynamic([["1561848550",[N.DM.GRAY_200,N.GC.NEUTRAL,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.N_.TWO_UNITS]]])+" modal-description",children:["We noticed that you have added private files, which could be causing the error. You can try to publish without including private files.",(0,F.jsx)("br",{className:v().dynamic([["1561848550",[N.DM.GRAY_200,N.GC.NEUTRAL,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.N_.TWO_UNITS]]])}),(0,F.jsx)("br",{className:v().dynamic([["1561848550",[N.DM.GRAY_200,N.GC.NEUTRAL,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.N_.TWO_UNITS]]])}),"(Enable Private folder's visibility from Project Settings ","-> ","Advanced features)"]}),(0,F.jsxs)("div",{className:v().dynamic([["1561848550",[N.DM.GRAY_200,N.GC.NEUTRAL,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.N_.TWO_UNITS]]])+" modal-buttons",children:[(0,F.jsx)(j.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Cancel"}),(0,F.jsx)(j.z,{style:"solid",colorScheme:"accent",onClick:()=>{o(),t()},children:"Publish without private files"})]}),(0,F.jsx)(v(),{id:"1561848550",dynamic:[N.DM.GRAY_200,N.GC.NEUTRAL,N.N_.TWO_UNITS,N.N_.TWO_UNITS,N.N_.TWO_UNITS],children:[".modal-wrapper.__jsx-style-dynamic-selector{max-width:420px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}",`.modal-content{background-color:${N.DM.GRAY_200} !important;}`,`.modal-header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-bottom:14px;border-bottom:1px solid ${N.GC.NEUTRAL};}`,`.modal-buttons.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:${N.N_.TWO_UNITS};margin-top:${N.N_.TWO_UNITS};}`,`.modal-description.__jsx-style-dynamic-selector{margin:${N.N_.TWO_UNITS} 0;}`,".title.__jsx-style-dynamic-selector{font-size:14px;}"]})]})};var en,tn,on,nn,rn,sn,an,cn,ln,dn,pn,un,hn,mn,yn,gn,fn,bn,In,vn,wn,Nn,jn,Sn,Dn,Tn,On,Fn,Cn,En=o(558683),xn=o(455245),_n=o(483955);function Mn(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Pn(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Mn(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Mn(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}en=(0,c.provide)("projectPublishFlow"),tn=(0,c.inject)("projectUIState"),on=(0,c.inject)("projectDoc"),nn=(0,c.inject)("globalAppState"),rn=(0,c.inject)("notificationsManagementFlow"),sn=(0,c.inject)("sentryService"),an=(0,c.inject)("vercelRepository"),cn=(0,c.inject)("assetsService"),ln=(0,c.inject)("sharedbProjectSyncService"),dn=(0,c.inject)("projectDownloadFlow"),pn=(0,c.inject)("projectFilesFlow"),un=(0,c.inject)("modalManagementFlow"),hn=(0,c.inject)("workspacesRepository"),mn=(0,h.G)(g.l.PUBLISH_TO_TELEPORT),yn=(0,h.G)(g.l.PUBLISH_USING_TOKEN),en((fn=class{constructor(){(0,i.Z)(this,"projectUIState",bn,this),(0,i.Z)(this,"projectDoc",In,this),(0,i.Z)(this,"globalAppState",vn,this),(0,i.Z)(this,"notificationsManagementFlow",wn,this),(0,i.Z)(this,"sentryService",Nn,this),(0,i.Z)(this,"vercelRepository",jn,this),(0,i.Z)(this,"assetsService",Sn,this),(0,i.Z)(this,"dbSync",Dn,this),(0,i.Z)(this,"projectDownloadFlow",Tn,this),(0,i.Z)(this,"projectFilesFlow",On,this),(0,i.Z)(this,"modalManagementFlow",Fn,this),(0,r.Z)(this,"cmsWebhookManagementFlow",En.u.Instance),(0,i.Z)(this,"workspacesRepository",Cn,this),(0,r.Z)(this,"addCustomDomain",(async(e,t)=>{try{return await this.vercelRepository.addCustomDomain(this.projectDoc.id,e,t),this.dbSync.mutate(this.projectDoc,(o=>{o.stats.validations={domain:!1},o.stats.deployments=Pn(Pn({},o.stats.deployments),{},{custom:e,customRedirectUrl:t})})),(0,a.mutate)(this.projectUIState,(e=>{e.projectPublish.customDomain.status="success"})),{success:!0}}catch(o){return this.sentryService.captureException(o.message,{type:Xo.U.CRITICAL}),this.notificationsManagementFlow.handleError(`An error occurred while adding the custom domain. Please try again or contact customer support <br/> <b>Error message:</b> ${o.message}`),{success:!1,errorMessage:o.message}}})),(0,r.Z)(this,"removeCustomDomain",(async()=>{try{var e;return!(null===(e=this.projectDoc.stats.deployments)||void 0===e||!e.custom)&&(await this.vercelRepository.removeCustomDomain(this.projectDoc.id),this.dbSync.mutate(this.projectDoc,(e=>{var t,o,n;delete e.stats.validations,null===(t=e.stats.deployments)||void 0===t||delete t.custom,null===(o=e.stats.deployments)||void 0===o||delete o.customRedirectUrl,null===(n=e.stats.deployments)||void 0===n||delete n.customDomainLastPublished})),(0,a.mutate)(this.projectUIState,(e=>{e.projectPublish.customDomain.status="initial"})),!0)}catch(t){return this.sentryService.captureException(t),this.notificationsManagementFlow.handleError(`Could not delete custom domain <br/> <b>Error message:</b> ${t.message}`),!1}})),(0,r.Z)(this,"verifyCustomDomain",(async()=>{try{this.dbSync.mutate(this.projectDoc,(e=>{e.stats.validations={domain:!1}}));const e=await this.vercelRepository.verifyCustomDomain(this.projectDoc.id);return this.dbSync.mutate(this.projectDoc,(t=>{t.stats.validations={domain:!!e.success}})),e}catch(e){throw this.sentryService.captureException(e),this.notificationsManagementFlow.handleError(`Could not verify custom domain <br/> <b>Error message:</b> ${e.message}`),e}})),(0,r.Z)(this,"requestMoreCustomDomains",(async()=>{const{id:e}=this.projectUIState.workspace;try{await this.workspacesRepository.requestMoreCustomDomains(e),this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,"We received your request and we will get back to you as soon as possible")}catch(t){if(-1!=(null===t||void 0===t?void 0:t.message.indexOf("was already sent")))return void this.notificationsManagementFlow.createNotification(d.k$.WARNING,"A request was already sent. You can only send one at every 24 hours");this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not request more custom domains")}})),(0,r.Z)(this,"checkCustomDomainLimitReached",(async e=>{try{var t,o;const{id:n}=this.projectUIState.workspace,i=this.projectUIState.workspace.subscriptionPlanType;if(!i)return!0;const r=await this.workspacesRepository.getCustomDomainsCount(n,e),s=null!==(t=null===(o=this.projectUIState.workspace.meta)||void 0===o?void 0:o.customDomainsLimit)&&void 0!==t?t:null;return s?r.domainsCount>=s:r.domainsCount>=Jo.cF[i].MAX_CUSTOM_DOMAINS}catch(n){return!0}})),(0,r.Z)(this,"offerToPublishWithoutPrivateFiles",((e,t,o)=>{const n=b.d.createCustomModal({Component:Qo,onSubmit:async()=>await this.deployProject({target:e,withCustomDomain:t,framework:o,skipPrivateFiles:!0})});this.modalManagementFlow.showModal(n)})),(0,r.Z)(this,"findCurrentProductionDeploymentId",(()=>{var e,t,o;const n=(null===(e=this.projectUIState.projectDeployments.deploymentsResponse)||void 0===e?void 0:e.deployments)||[],i=(null===(t=this.projectDoc.stats.deployments)||void 0===t?void 0:t.custom)||"";return i&&(null===(o=n.find((e=>e.alias.includes(i)&&"production"===e.target)))||void 0===o?void 0:o.uid)||null})),(0,r.Z)(this,"findCurrentTeleportDeploymentId",(()=>{var e,t,o;const n=(null===(e=this.projectUIState.projectDeployments.deploymentsResponse)||void 0===e?void 0:e.deployments)||[],i=(null===(t=this.projectDoc.stats.deployments)||void 0===t?void 0:t.deployUrl)||"";return i&&(null===(o=n.find((e=>e.url.includes(i))))||void 0===o?void 0:o.uid)||null})),(0,r.Z)(this,"updateLastPublishedWebhookConfig",(e=>{const t=this.projectDoc.cms.webhook.config[e],o=this.projectDoc.cms.webhook.lastPublishedConfig[e];t?this.cmsWebhookManagementFlow.updateWebhookLastPublished(Pn(Pn({},t),{},{publishOption:e})):o&&this.cmsWebhookManagementFlow.updateWebhookLastPublished({url:o.url,optedOut:!0,publishOption:e})}))}async publishToTeleport(e){await this.deployProject({target:p.Fb.TELEPORT,withCustomDomain:e}),this.updateLastPublishedWebhookConfig(p.Fb.TELEPORT)}async publishToVercel(){await this.deployProject({target:p.Fb.VERCEL}),this.updateLastPublishedWebhookConfig(p.Fb.VERCEL)}async deployProject(e){const{target:t,withCustomDomain:o,skipPrivateFiles:n}=e,i=Object.values(this.projectDoc.folders.byId[ut.D.PRIVATE_ASSETS].children).length;let r,{framework:s}=e||{framework:"nextjs"};(0,a.mutate)(this.projectUIState,(e=>{e.projectPublish[t].status="pending",e.userInteractions.publishInProgress=!0,o&&(e.projectPublish[p.Fb.CUSTOM_DOMAIN].status="pending")}));try{if(this.projectUIState.userPreferences.projectExportType===p.iW.DEV){const e=Object.values(this.projectDoc.assets.byId),t=await this.assetsService.downloadAssets(e,{skipDownload:!0});r=this.projectFilesFlow.getPackedDevProjectFromCurrentBranch(),s="create-react-app",r=this.projectDownloadFlow.mergeProjectWithTemplateForDeplyment(this.projectDownloadFlow.injectLocalAssetsIntoProject(r,t))}else r=await this.projectFilesFlow.getPackedDesignProject({projectType:xn.o.NEXT,includeAnalytics:!0,skipDownload:!0,skipPrivateFiles:n});const e=await this.vercelRepository.deploy({projectId:this.projectDoc.id,projectFolder:r,framework:s,isTeleportHosting:t===p.Fb.TELEPORT,target:o||t===p.Fb.VERCEL?"production":"staging"});if(e.success){var c;const i=e.payload,r=(null===i||void 0===i?void 0:i.alias[0])||i.url;this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,`Your application is ready at: https://${r}`,{duration:1e4});const s=`https://${r}`,l=i.url.split(`${this.projectUIState.slug}-`)[1];this.updateDeployedLink({key:t,url:s,target:t,deployUrl:l,skipPrivateFiles:n,withCustomDomain:o}),this.updatePasswordProtection({newPassword:i.passwordProtection}),null!==(c=this.globalAppState.user.userData)&&void 0!==c&&c.meta&&(0,a.mutate)(this.globalAppState.user.userData,(({meta:e})=>{e.deployedProjects?e.deployedProjects[this.projectDoc.id]=!0:e.deployedProjects={[this.projectDoc.id]:!0}})),(0,a.mutate)(this.projectUIState,(({projectPublish:e})=>{e[t].status=n?"success-without-private-files":"success",e[t].payload=s,o&&(e[p.Fb.CUSTOM_DOMAIN].status=n?"success-without-private-files":"success")}))}else this.notificationsManagementFlow.createNotification(d.k$.ERROR,e.payload),(0,a.mutate)(this.projectUIState,(({projectPublish:e})=>{e[t].status="error",o&&(e[p.Fb.CUSTOM_DOMAIN].status="error")})),!n&&i&&this.offerToPublishWithoutPrivateFiles(t,o,s)}catch(l){this.sentryService.captureException(l,{type:Xo.U.CRITICAL}),this.notificationsManagementFlow.createNotification(d.k$.ERROR,`An error occurred while publishing your application. Please try again. If the error persists, contact our support team. <br/> <b>Error message:</b> ${l.message}`),(0,a.mutate)(this.projectUIState,(({projectPublish:e})=>{e[t].status="error"})),!n&&i&&this.offerToPublishWithoutPrivateFiles(t,o,s)}finally{(0,a.mutate)(this.projectUIState,(e=>{e.userInteractions.publishInProgress=!1}))}}async checkIfVercelAliasIsAvailable(e){return await this.vercelRepository.checkIfVercelAliasIsAvailable(e)}async changeTeleportVercelAlias(e){try{await this.vercelRepository.updateVercelAlias(this.projectDoc.id,e),(0,a.mutate)(this.projectUIState,(t=>{t.teleportVercelAlias=e}))}catch(t){throw new Error("Could not update teleport vercel alias. Please try again!")}}async readBuildLogs(e){try{const t=await this.vercelRepository.getBuildLogs(this.projectDoc.id,e);(0,a.mutate)(this.projectUIState,(o=>{o.projectDeployments.buildLogs={deployUrl:e,logs:t}}))}catch(t){return this.notificationsManagementFlow.handleError(`An error occurred while fetching Vercel logs. Please try again. <br/> <b>Error message:</b> ${t.message}`),this.sentryService.captureException(t),null}}resetBuildLogs(){(0,a.mutate)(this.projectUIState,(e=>{delete e.projectDeployments.buildLogs}))}async getVercelDeployments(e,t){try{const o=await this.vercelRepository.getVercelDeploymentsWithPagination(this.projectDoc.id,e,t);return(0,a.mutate)(this.projectUIState,(e=>{e.projectDeployments.deploymentsResponse=o})),o}catch(o){return this.sentryService.captureException(o),null}}async loadMoreVercelDeployments(e,t){try{const{deploymentsResponse:o}=this.projectUIState.projectDeployments,n=await this.getVercelDeployments(e,t);if(!n)return;(0,a.mutate)(this.projectUIState,(e=>{var t;e.projectDeployments.deploymentsResponse={deployments:[...null!==(t=null===o||void 0===o?void 0:o.deployments)&&void 0!==t?t:[],...n.deployments],pagination:n.pagination}}))}catch(o){console.error(o)}}async resetPasswordProtection(){try{var e,t,o;const n=null!==(e=null===(t=this.projectDoc.stats.deployments)||void 0===t||null===(o=t.passwordProtection)||void 0===o?void 0:o.protectionType)&&void 0!==e?e:"prod_deployment_urls_and_all_previews",i=await this.vercelRepository.addPasswordProtection(this.projectDoc.id,n);i.success&&i.password&&(this.updatePasswordProtection({newPassword:i.password}),this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,"Standard protection for your deployments is enabled with the new password."))}catch(n){this.sentryService.captureException(n),this.notificationsManagementFlow.handleError(`Password could not be updated. <br/> <b>Error message:</b> ${n.message}`)}}async removePasswordProtection(){try{const e=await this.vercelRepository.deletePasswordProtection(this.projectDoc.id);e.success&&!e.password&&this.dbSync.mutate(this.projectDoc,(e=>{var t;null===(t=e.stats.deployments)||void 0===t||delete t.passwordProtection})),this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,"Standard protection for your deployments has been disabled. All deployments are now public.")}catch(e){this.sentryService.captureException(e),this.notificationsManagementFlow.handleError(`Password could not be deleted. <br/> <b>Error message:</b> ${e.message}`)}}async deleteDeploymentById(e){try{var t;(0,a.mutate)(this.projectUIState,(t=>{t.projectDeployments.deploymentsUnderWork[e]=_n.D.DELETE}));const o=(null===(t=this.projectUIState.projectDeployments.deploymentsResponse)||void 0===t?void 0:t.deployments)||[];if(!o.find((t=>t.uid===e)))throw new Error("Could not find deployment to delete among available deployments!");const n=await this.vercelRepository.deleteDeploymentById(this.projectDoc.id,e);return this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,"Deployment deleted succesfully"),this.updateDeploymentsAfterDeletion({deletedDeploymentId:e,newTeleportUrl:n.teleportAliasDeploymentUrl}),!0}catch(o){(0,a.mutate)(this.projectUIState,(t=>{delete t.projectDeployments.deploymentsUnderWork[e]})),this.sentryService.captureException(o),this.notificationsManagementFlow.handleError(`Deployment could not be deleted. <br/> <b>Error message:</b> ${o.message}`)}}async redeployDeploymentById(e){try{(0,a.mutate)(this.projectUIState,(t=>{t.projectDeployments.deploymentsUnderWork[e.uid]=_n.D.REDEPLOY,t.userInteractions.publishInProgress=!0}));const t=await this.vercelRepository.redeployDeploymentById(this.projectDoc.id,e.uid,!0,e.target);return this.updateStateOnSuccessfulRedeployOrPromote({newDeployment:t,oldDeploymentId:e.uid,notificationMessage:"Deployment successfully redeployed. You can check it out in the Deployments tab."}),!0}catch(t){this.sentryService.captureException(t),this.notificationsManagementFlow.handleError(`Deployment could not be deleted. <br/> <b>Error message:</b> ${t.message}`)}finally{(0,a.mutate)(this.projectUIState,(t=>{delete t.projectDeployments.deploymentsUnderWork[e.uid],t.userInteractions.publishInProgress=!1}))}}async promoteToProduction(e){try{(0,a.mutate)(this.projectUIState,(t=>{t.projectDeployments.deploymentsUnderWork[e.uid]=_n.D.PROMOTE_TO_PRODUCTION,t.userInteractions.publishInProgress=!0}));const t=await this.vercelRepository.promoteToProduction(this.projectDoc.id,e.uid,!0);return this.updateStateOnSuccessfulRedeployOrPromote({newDeployment:t,oldDeploymentId:e.uid,notificationMessage:"Deployment successfully promoted to production. You can check it out in the Deployments tab."}),(0,a.mutate)(this.projectUIState,(t=>{delete t.projectDeployments.deploymentsUnderWork[e.uid]})),!0}catch(t){this.sentryService.captureException(t),this.notificationsManagementFlow.handleError(`Deployment could not be promoted to production. <br/> <b>Error message:</b> ${t.message}`)}finally{(0,a.mutate)(this.projectUIState,(t=>{delete t.projectDeployments.deploymentsUnderWork[e.uid],t.userInteractions.publishInProgress=!1}))}}updateStateOnSuccessfulRedeployOrPromote(e){const{notificationMessage:t,newDeployment:o,oldDeploymentId:n,doc:i}=e;i&&(i.stats.deployments=Pn(Pn({},i.stats.deployments),{},{deployUrl:o.url}),(0,a.mutate)(this.projectUIState,(e=>{var t;if(delete e.projectDeployments.deploymentsUnderWork[n],null!==(t=e.projectDeployments.deploymentsResponse)&&void 0!==t&&t.deployments){if("production"===o.target){const t=e.projectDeployments.deploymentsResponse.deployments.find((e=>"production"===e.target));t&&(t.alias=[])}const t=e.projectDeployments.deploymentsResponse.deployments.findIndex((e=>e.uid===o.uid));if(-1!==t)return void(e.projectDeployments.deploymentsResponse.deployments[t]=o);e.projectDeployments.deploymentsResponse.deployments.unshift(o)}})),t&&this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,t))}updateDeploymentsAfterDeletion(e){const{deletedDeploymentId:t,newTeleportUrl:o,doc:n}=e;n&&(o&&(n.stats.deployments=Pn(Pn({},n.stats.deployments),{},{deployUrl:o})),(0,a.mutate)(this.projectUIState,(e=>{var o,n;delete e.projectDeployments.deploymentsUnderWork[t];const i=null===(o=e.projectDeployments.deploymentsResponse)||void 0===o?void 0:o.deployments,r=null===(n=e.projectDeployments.deploymentsResponse)||void 0===n?void 0:n.pagination;if(i&&r){const o=i.filter((e=>e.uid!==t));e.projectDeployments.deploymentsResponse={pagination:r,deployments:o}}})))}updatePasswordProtection(e){var t,o;const{doc:n,newPassword:i}=e;n&&(null===(t=n.stats.deployments)||void 0===t||null===(o=t.passwordProtection)||void 0===o?void 0:o.password)!==i&&(n.stats.deployments=Pn(Pn({},n.stats.deployments),{},{passwordProtection:{password:i,protectionType:"prod_deployment_urls_and_all_previews"}}))}updateDeployedLink(e){var t;const{doc:o,key:n,url:i,target:r,deployUrl:s,skipPrivateFiles:a,withCustomDomain:c}=e;o&&(o.stats.deployments=Pn(Pn(Pn({},o.stats.deployments),s&&{deployUrl:s}),{},{[n]:i,[r===p.Fb.VERCEL?"vercelLastPublished":"teleportLastPublished"]:(new Date).toISOString(),withoutPrivateFiles:Pn(Pn({},null===(t=o.stats.deployments)||void 0===t?void 0:t.withoutPrivateFiles),{},{[r]:a})}),c&&(o.stats.deployments.customDomainLastPublished=(new Date).toISOString()))}},bn=(0,s.Z)(fn.prototype,"projectUIState",[tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),In=(0,s.Z)(fn.prototype,"projectDoc",[on],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vn=(0,s.Z)(fn.prototype,"globalAppState",[nn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wn=(0,s.Z)(fn.prototype,"notificationsManagementFlow",[rn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nn=(0,s.Z)(fn.prototype,"sentryService",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jn=(0,s.Z)(fn.prototype,"vercelRepository",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sn=(0,s.Z)(fn.prototype,"assetsService",[cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn=(0,s.Z)(fn.prototype,"dbSync",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tn=(0,s.Z)(fn.prototype,"projectDownloadFlow",[dn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),On=(0,s.Z)(fn.prototype,"projectFilesFlow",[pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fn=(0,s.Z)(fn.prototype,"modalManagementFlow",[un],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cn=(0,s.Z)(fn.prototype,"workspacesRepository",[hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(fn.prototype,"publishToTeleport",[mn],Object.getOwnPropertyDescriptor(fn.prototype,"publishToTeleport"),fn.prototype),(0,s.Z)(fn.prototype,"publishToVercel",[yn],Object.getOwnPropertyDescriptor(fn.prototype,"publishToVercel"),fn.prototype),(0,s.Z)(fn.prototype,"updateStateOnSuccessfulRedeployOrPromote",[so.W],Object.getOwnPropertyDescriptor(fn.prototype,"updateStateOnSuccessfulRedeployOrPromote"),fn.prototype),(0,s.Z)(fn.prototype,"updateDeploymentsAfterDeletion",[so.W],Object.getOwnPropertyDescriptor(fn.prototype,"updateDeploymentsAfterDeletion"),fn.prototype),(0,s.Z)(fn.prototype,"updatePasswordProtection",[m.P],Object.getOwnPropertyDescriptor(fn.prototype,"updatePasswordProtection"),fn.prototype),(0,s.Z)(fn.prototype,"updateDeployedLink",[m.P],Object.getOwnPropertyDescriptor(fn.prototype,"updateDeployedLink"),fn.prototype),gn=fn));var An=o(243396),kn=o(21023),Un=o(461778),Rn=o(189603),Zn=o(233475),Ln=o(354163),$n=o(542890),Bn=o(995234),Gn=o(260356),Hn=o(237584);const zn=100;var Yn,Vn,Wn,Kn=o(429952);function qn(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Jn(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?qn(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):qn(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let Xn=(Yn=(0,c.inject)("projectDoc"),Vn=class{constructor(){(0,i.Z)(this,"projectDoc",Wn,this),(0,r.Z)(this,"cmsUIState",K.H.Instance),(0,r.Z)(this,"valuePath",[]),(0,r.Z)(this,"itemValuePath",["data","[0]"]),(0,r.Z)(this,"allItemsCountPath",{type:"body",path:["meta","pagination","total"]}),(0,r.Z)(this,"resourceMappers",[]),(0,r.Z)(this,"getProjectId",(()=>{var e;const{projectId:t}=this.projectDoc.cms.cmsConnectionData,{cms:o}=this.projectDoc;if("caisy.io"!==(null===(e=o.cmsConnectionData)||void 0===e?void 0:e.cmsType)||!t)throw new Error("Project ID was not found");return t}))}provideBaseUrl(){var e;const t=null===(e=this.projectDoc.cms)||void 0===e?void 0:e.cmsConnectionData;if(!t)throw new Error("Could not get url. Make sure CMS is active.");if("caisy.io"!==t.cmsType)throw new Error("Connection type is not Contentful.");const{projectId:o,personalAccessToken:n}=t;if(!o||!n)throw new Error("Could not get Caisy connection data");return`${$n.fy}${o}/graphql`}provideAccessToken(){var e;const t=null===(e=this.projectDoc.cms)||void 0===e?void 0:e.cmsConnectionData;if(!t)throw new Error("Could not get url. Make sure CMS is active.");if("caisy.io"!==t.cmsType)throw new Error("Connection type is not Contentful.");const{personalAccessToken:o}=t;if(!o)throw new Error("No access token available for Caisy");return o}getResourceMappersForResource(){return this.resourceMappers.map((e=>e.name))}getResourceMappers(){return this.resourceMappers.reduce(((e,t)=>(e[t.name]=t.resource,e)),{})}generateResourceForCMSItemNode(e){var t,o;const{node:n,contentType:i,compId:r}=e;if(!(null===(t=n.attrs)||void 0===t||null===(o=t.cmsItemId)||void 0===o?void 0:o.content)&&!i.singleType)return null;const s=this.cmsUIState.getAllCMSTypes(),a=(0,Bn.WM)(s,i.uid,"id"),c=this.projectDoc.components.byId[r],{paramsForFetcher:l,paramsToSendToFetcher:d}=(0,Hn.CR)({attrName:"id",defaultValue:void 0,attribute:(n.attrs||{}).cmsItemId,propDefinitions:null===c||void 0===c?void 0:c.propDefinitions,stateDefinitions:null===c||void 0===c?void 0:c.stateDefinitions,staticValueTransform:(e,t)=>t?`'${e}'`:e,getCMSIdentifier:e=>(0,Ln.Dw)((()=>this.projectDoc.getParentNodeIdentifierFromContextAndNodeId(e,n.id)))}),p=null!==d&&void 0!==d&&d.id?d:l;return{paramsToSendToFetcher:{},resource:{name:"getEntityByAttribute",dependency:oi("getEntityByAttribute"),params:Jn({projectId:{type:"static",content:this.getProjectId()},query:{type:"static",content:a},attribute:{type:"static",content:"id"},locale:{type:"expr",content:'(props?.locale ?? "")'}},p)}}}generateResourceForCMSListNode(e){const{node:t,contentType:o,compId:n}=e,i=this.projectDoc.components.byId[n],r=ei({mainNode:t,forPagination:!1,projectDoc:this.projectDoc,component:i,isPaginated:t.paginated}),s=(0,Bn.LK)({contentAndComponentTypes:this.cmsUIState.getAllCMSTypes(),contentTypeId:o.uid,sortings:r.sorting,unresolvedFiltersAttr:r.filtering.nodeAttributes}),a=o.singleType?"getSingleEntityType":"getEntitiesWithPagination";return{paramsToSendToFetcher:{},resource:{name:a,dependency:oi(a),params:Jn(Jn({projectId:{type:"static",content:this.getProjectId()},query:{type:"static",content:s},locale:{type:"expr",content:'(props?.locale ?? "")'}},r.pagination),r.filtering.queryParams)}}}generateInitialPathsForPage(e){var t,o;const{pageId:n,dynamicRouteAttribute:i}=e;if(!i)return null;const r=this.projectDoc.cmsPages.byId[n];if(!r)throw new Error(`Could not find CMS page: ${n}`);const{usedContentTypes:s}=this.projectDoc.cms,a=(0,Ln.KT)({page:r,usedContentTypes:s});if(!a)throw new Error(`Could not find content type for page: ${n}`);const c="cms-details-page"===r.type,l=c&&(null===(t=r.cmsDetailsPageAttributeDifferentiator)||void 0===t||null===(o=t.content.refPath)||void 0===o?void 0:o.slice(1))||["id"],d=(0,Bn.v2)(s,l[0],a.uid);return{consumer:{exposeAs:Jn({name:i,valuePath:["data"]},i&&c&&{itemValuePath:l}),resource:{name:"getEntities",dependency:oi("getEntities"),params:{projectId:{type:"static",content:this.getProjectId()},query:{type:"static",content:d},locale:{type:"expr",content:'(context?.locale ?? "")'}}}}}}generateInitialPropsForPage(e){const{pageId:t,propDefinition:o,dynamicRouteAttribute:n,forPagination:i}=e,r=this.projectDoc.cmsPages.byId[t];if(!r)throw new Error(`Could not find CMS page: ${t}`);const{usedContentTypes:s}=this.projectDoc.cms,a=(0,Ln.KT)({page:r,usedContentTypes:s});if(!a)throw new Error(`Could not find content type for page: ${t}`);let c={projectId:{type:"static",content:this.getProjectId()}},l=a.singleType?"getSingleEntityType":"getEntitiesWithPagination";if(n&&!i){const e=(0,Bn.WM)(this.cmsUIState.getAllCMSTypes(),a.uid,n);c=Jn(Jn({},c),{},{query:{type:"static",content:e},attribute:{type:"static",content:n},locale:{type:"expr",content:'(context?.locale ?? "")'}}),l="getEntityByAttribute"}else{const e=Qn(this.projectDoc,t,i),o=(0,Bn.LK)({contentAndComponentTypes:this.cmsUIState.getAllCMSTypes(),contentTypeId:a.uid,sortings:null===e||void 0===e?void 0:e.sorting,unresolvedFiltersAttr:null===e||void 0===e?void 0:e.filtering.nodeAttributes});c=Jn(Jn(Jn({},c),{},{query:{type:"static",content:o},locale:{type:"expr",content:'(context?.locale ?? "")'}},null===e||void 0===e?void 0:e.pagination),null===e||void 0===e?void 0:e.filtering.queryParams)}const d="cms-details-page"===r.type?this.itemValuePath:n&&!i?["data"]:this.valuePath;return{consumer:{exposeAs:{name:o.name,valuePath:d},resource:{name:l,dependency:oi(l),params:c}}}}generateUIDLForCMSRichText(e,t,o={},n,i){if(!e.html||"static"===e.html.type)return t;const r=(0,Hn.rk)(e,[o[e.html.content.ctxId||""]],n,i);return Jn(Jn({},t),{},{elementType:"caisy-richtext-node",semanticType:void 0,children:[],attrs:{node:r,overwrites:{type:"expr",content:"({documentLink: CaisyDocumentLink})"}},referencedStyles:{},style:{}})}},Wn=(0,s.Z)(Vn.prototype,"projectDoc",[Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vn);const Qn=(e,t,o)=>{const n=e.cmsPages.byId[t];if(!n)throw new Error(`Could not find CMS page: ${t}`);if(!n.mainNodeId)throw new Error(`Could not find root node for page: ${t}`);if("cms-listing-page"!==n.type)return null;const i=e.nodes.getById(n.mainNodeId);if(!i)throw new Error(`Could not find main node for page: ${t}`);if("cms-collection-list-node"!==i.type)throw new Error(`Main node is not of type cms-list-node: ${i.id}`);return ei({mainNode:i,projectDoc:e,forPagination:o})},ei=e=>{const{mainNode:t,projectDoc:o,forPagination:n,component:i,isPaginated:r}=e;let s,a={},c={page:{type:"static",content:"1"},perPage:{type:"static",content:"10"}};if(!t.attrs)return{sorting:s,filtering:a,pagination:c};const l=(0,Gn.CJ)(t,"sort");return l&&Array.isArray(l)&&(s=[...l]),a={nodeAttributes:t.attrs.filter,queryParams:t.attrs.filter?(0,Kn.zh)(t.attrs.filter,{propDefinitions:null===i||void 0===i?void 0:i.propDefinitions,stateDefinitions:null===i||void 0===i?void 0:i.stateDefinitions,getCMSIdentifier:e=>(0,Ln.Dw)((()=>o.getParentNodeIdentifierFromContextAndNodeId(e,t.id)))}):{}},c=ti(t.attrs,i,n,r),{sorting:s,filtering:a,pagination:c}},ti=(e,t,o,n,i=(()=>""))=>{var r;const s={page:{type:"static",content:"1"},perPage:{type:"static",content:"10"}},{paramsForFetcher:a,paramsToSendToFetcher:c}=(0,Hn.CR)({attrName:"perPage",attribute:e.perPage,defaultValue:zn,propDefinitions:null===t||void 0===t?void 0:t.propDefinitions,stateDefinitions:null===t||void 0===t?void 0:t.stateDefinitions,getCMSIdentifier:i});if(s.perPage=null!==(r=null===c||void 0===c?void 0:c.perPage)&&void 0!==r?r:a.perPage,o)return s.page={type:"expr",content:"(context.params.page)"},s;const l=n&&e.paginationQuery?(0,Hn.Sy)({attrName:"paginationQuery",attribute:e.paginationQuery,propDefinitions:null===t||void 0===t?void 0:t.propDefinitions,stateDefinitions:null===t||void 0===t?void 0:t.stateDefinitions,getCMSIdentifier:i,staticValueTransform:e=>`(parseInt(router.query?.['${e}'] ?? 1))`,dynamicValueTransform:e=>`(parseInt(router.query?.[${e}] ?? 1))`}):(0,Hn.CR)({attrName:"page",attribute:e.page,defaultValue:1,propDefinitions:null===t||void 0===t?void 0:t.propDefinitions,stateDefinitions:null===t||void 0===t?void 0:t.stateDefinitions,getCMSIdentifier:i,staticValueTransform:e=>{const t=Number(e);return isNaN(t)?e:parseInt(e,10)}});var d,p;l.paramsToSendToFetcher.paginationQuery?s.page=l.paramsToSendToFetcher.paginationQuery:s.page=null!==(d=null===(p=l.paramsToSendToFetcher)||void 0===p?void 0:p.page)&&void 0!==d?d:l.paramsForFetcher.page;return s},oi=e=>({type:"package",version:"latest",path:"@teleporthq/cms-mappers",meta:{namedImport:!0,importAlias:"@teleporthq/cms-mappers/caisy",originalName:e}});var ni=o(378888),ii=o(648126);const ri="CMS_URL",si="CMS_ACCESS_TOKEN",ai=["STRAPI_URL","STRAPI_ACCESS_TOKEN","CONTENTFUL_URL","CONTENTFUL_ACCESS_TOKEN","WORDPRESS_URL","WORDPRESS_ACCESS_TOKEN","CAISY_URL","CAISY_ACCESS_TOKEN","FLOTIQ_URL","FLOTIQ_ACCESS_TOKEN"],ci=[xn.o.ANGULAR,xn.o.VUE,xn.o.HTML,xn.o.NUXT,xn.o.HTML],li=["autoplay","background","controls","direction","hover","keepLastFrame","intermission","mode","renderer","speed","loop","src"];var di=o(541730),pi=o(263108);const ui=e=>{const t={},o={};for(const n in e){const i=e[n];t[n]=i,"dynamic"===i.type&&(o[i.content.id]=i),"expr"===i.type&&(o[i.content]=i,t[n]={type:i.type,content:`params['${i.content}']`})}return{filterParamsForFetcher:t,filterParamsToSendToFetcher:o}};var hi,mi,yi;function gi(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function fi(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?gi(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):gi(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let bi=(hi=(0,c.inject)("projectDoc"),mi=class{constructor(){(0,i.Z)(this,"projectDoc",yi,this),(0,r.Z)(this,"valuePath",[]),(0,r.Z)(this,"itemValuePath",["data","[0]"]),(0,r.Z)(this,"allItemsCountPath",{type:"body",path:["meta","pagination","total"]}),(0,r.Z)(this,"resourceMappers",[{name:"normalize",resource:{params:["response"],dependency:{type:"package",version:"latest",path:"@teleporthq/cms-mappers",meta:{namedImport:!0,originalName:"normalize",importAlias:"@teleporthq/cms-mappers/contentful"}}}}])}provideBaseUrl(){var e;const t=null===(e=this.projectDoc.cms)||void 0===e?void 0:e.cmsConnectionData;if(!t)throw new Error("Could not get url. Make sure CMS is active.");if("contentful"!==t.cmsType)throw new Error("Connection type is not Contentful.");const{spaceId:o,selectedEnvId:n}=t;if(!o||!n)throw new Error("Could not get Contentful spaceId or selectedEnvId.");return`${ii.t0}/spaces/${o}/environments/${n}`}provideAccessToken(){var e;const t=null===(e=this.projectDoc.cms)||void 0===e?void 0:e.cmsConnectionData;if(!t)throw new Error("Could not get url. Make sure CMS is active.");if("contentful"!==t.cmsType)throw new Error("Connection type is not Contentful.");return t.contentAPIToken}getResourceMappersForResource(){return this.resourceMappers.map((e=>e.name))}getResourceMappers(){return this.resourceMappers.reduce(((e,t)=>(e[t.name]=t.resource,e)),{})}generateResourceForCMSItemNode(e){var t,o;const{node:n,resourceName:i,contentType:r,compId:s}=e;if(!(null===(t=n.attrs)||void 0===t||null===(o=t.cmsItemId)||void 0===o?void 0:o.content))return null;const a=this.projectDoc.components.byId[s],{paramsForFetcher:c,paramsToSendToFetcher:l}=(0,Hn.CR)({attrName:"sys.id",defaultValue:void 0,attribute:(n.attrs||{}).cmsItemId,propDefinitions:null===a||void 0===a?void 0:a.propDefinitions,stateDefinitions:null===a||void 0===a?void 0:a.stateDefinitions,staticValueTransform:e=>{const t=Number(e);return isNaN(t)?`${e}`:parseInt(e,10)},getCMSIdentifier:e=>(0,Ln.Dw)((()=>this.projectDoc.getParentNodeIdentifierFromContextAndNodeId(e,n.id)))});return{resource:{id:(0,ni.Ox)(),name:i,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:"entries"}},headers:{authToken:{type:"env",content:si}},params:fi({content_type:{type:"static",content:r.uid},locale:{type:"dynamic",content:{referenceType:"prop",id:"locale"}}},c)},paramsToSendToFetcher:l}}generateResourceForCMSListNode(e){const{node:t,resourceName:o,contentType:n,compId:i}=e,r=this.projectDoc.components.byId[i],{paramsForFetcher:s,paramsToSendToFetcher:a}=Ii(t.attrs||{},!1,r,t.paginated,(e=>(0,Ln.Dw)((()=>this.projectDoc.getParentNodeIdentifierFromContextAndNodeId(e,t.id)))));return{resource:{id:(0,ni.Ox)(),name:o,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:"entries"}},headers:{authToken:{type:"env",content:si}},params:fi({content_type:{type:"static",content:n.uid},locale:{type:"dynamic",content:{referenceType:"prop",id:"locale"}}},s)},paramsToSendToFetcher:a}}generateInitialPathsForPage(e){var t,o;const{pageId:n,dynamicRouteAttribute:i,forPagination:r=!1}=e;if(!i)return null;const s=this.projectDoc.cmsPages.byId[n];if(!s)throw new Error(`Could not find CMS page: ${n}`);const{usedContentTypes:a}=this.projectDoc.cms,c=(0,Ln.KT)({page:s,usedContentTypes:a});if(!c)throw new Error(`Could not find content type for page: ${n}`);const l="cms-details-page"===s.type,d=l?(null===(t=s.cmsDetailsPageAttributeDifferentiator)||void 0===t||null===(o=t.content.refPath)||void 0===o?void 0:o.slice(1))||["id"]:[],p=[...1===d.length&&"id"===d[0]?["sys"]:["fields"],...d],u={},h={};u.content_type={type:"dynamic",content:{referenceType:"prop",id:"content_type"}},h.content_type={type:"static",content:String(c.uid)},i&&!r&&l?(u.select={type:"dynamic",content:{referenceType:"prop",id:"select"}},h.select={type:"static",content:String("id"===i?"sys.id":`fields.${i}`)}):u.limit={type:"static",content:1};const m=(0,ni.Ox)();return{resourceFetcher:{id:m,name:`${pi.removeIllegalCharacters(s.title)}-page-initial-paths-${m.slice(0,5)}`,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:"entries"}},headers:{authToken:{type:"env",content:si}},params:u},consumer:{exposeAs:fi({name:i,valuePath:["data"]},i&&l&&{itemValuePath:p}),resource:{id:m,params:h}}}}generateInitialPropsForPage(e){const{pageId:t,propDefinition:o,forPagination:n,dynamicRouteAttribute:i}=e,r=this.projectDoc.cmsPages.byId[t];if(!r)throw new Error(`Could not find CMS page: ${t}`);const{usedContentTypes:s}=this.projectDoc.cms,a=(0,Ln.KT)({page:r,usedContentTypes:s});if(!a)throw new Error(`Could not find content type for page: ${t}`);const c=vi(this.projectDoc,t,n);let l={content_type:{type:"static",content:a.uid},locale:{type:"dynamic",content:{referenceType:"prop",id:"locale"}}},d={};if(c&&"paramsForFetcher"in c&&(l=fi(fi({},l),c.paramsForFetcher)),i&&!n){l["id"===i?"sys.id":`fields.${i}`]={type:"dynamic",content:{referenceType:"prop",id:i}}}if(c&&"paramsToSendToFetcher"in c){const e="id"===i?"context.params.id":`context.params.fields.${i}`;d=fi(fi(fi({},d),c.paramsToSendToFetcher),r.contentType&&i&&!n&&{"sys.id":{type:"expr",content:e}})}const p=(0,ni.Ox)(),u={id:p,name:`${pi.removeIllegalCharacters(r.title)}-page-initial-props-${p.slice(0,5)}`,mappers:this.getResourceMappersForResource(),headers:{authToken:{type:"env",content:si}},path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:"entries"}},params:l},h="cms-details-page"===r.type?this.itemValuePath:this.valuePath;return{consumer:{exposeAs:{name:o.name,valuePath:h},resource:{id:p,params:d}},resourceFetcher:u}}generateUIDLForCMSRichText(e,t,o={},n,i){if(!e.html||"static"===e.html.type)return t;const r=(0,Hn.rk)(e,[o[e.html.content.ctxId||""]],n,i);return fi(fi({},t),{},{elementType:"contentful-richtext-node",semanticType:void 0,children:[],attrs:{richText:r},referencedStyles:{},style:{}})}},yi=(0,s.Z)(mi.prototype,"projectDoc",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mi);const Ii=(e,t,o,n,i=(()=>""))=>{const r={},s={},a=e.sort?(0,di.$8)(e.sort):void 0,c=e.filter?(0,di.zh)(e.filter,{propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,getCMSIdentifier:i}):void 0;a&&(s.order={type:"static",content:a});const l=(0,Hn.CR)({attrName:"limit",attribute:e.perPage,defaultValue:zn,propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,getCMSIdentifier:i});Object.assign(r,l.paramsToSendToFetcher),Object.assign(s,l.paramsForFetcher);const d=n&&e.paginationQuery?(0,Hn.Sy)({attrName:"skip",attribute:e.paginationQuery,defaultValue:0,propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,getCMSIdentifier:i,staticValueTransform:e=>{var t,o,n,i;return`(parseInt(router.query?.['${e}'] ?? 1) - 1) * ${null!==(t=null!==(o=null===(n=r.limit)||void 0===n?void 0:n.content)&&void 0!==o?o:null===(i=s.limit)||void 0===i?void 0:i.content)&&void 0!==t?t:zn}`},dynamicValueTransform:e=>{var t,o,n,i;return`(parseInt(router.query?.[${e}] ?? 1) - 1) * ${null!==(t=null!==(o=null===(n=r.limit)||void 0===n?void 0:n.content)&&void 0!==o?o:null===(i=s.limit)||void 0===i?void 0:i.content)&&void 0!==t?t:zn}`}}):(0,Hn.CR)({attrName:"skip",attribute:e.page,defaultValue:0,propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,getCMSIdentifier:i,staticValueTransform:e=>{const t=Number(e);if(isNaN(t))return e;const o=parseInt(e,10);return o>1?o:0},dynamicValueTransform:e=>{var t,o,n,i;return`(parseInt(${e}.toString() ?? 1) - 1) * (${null!==(t=null!==(o=null===(n=r.limit)||void 0===n?void 0:n.content)&&void 0!==o?o:null===(i=s.limit)||void 0===i?void 0:i.content)&&void 0!==t?t:zn})`}}),{filterParamsForFetcher:p,filterParamsToSendToFetcher:u}=ui(c||{});return Object.assign(r,fi(fi({},d.paramsToSendToFetcher),u)),Object.assign(s,fi(fi({},d.paramsForFetcher),p)),t&&(s.skip={type:"dynamic",content:{referenceType:"prop",id:"skip"}},r.skip={type:"expr",content:`(context.params.page - 1) * ${s.limit.content}`}),{paramsForFetcher:s,paramsToSendToFetcher:r}},vi=(e,t,o)=>{const n=e.cmsPages.byId[t];if(!n)throw new Error(`Could not find CMS page: ${t}`);if(!n.mainNodeId)throw new Error(`Could not find root node for page: ${t}`);if("cms-listing-page"!==n.type)return null;const i=e.nodes.getById(n.mainNodeId);if(!i)throw new Error(`Could not find main node for page: ${t}`);if("cms-collection-list-node"!==i.type)throw new Error(`Main node is not of type cms-list-node: ${i.id}`);return"attrs"in i&&i.attrs?Ii(i.attrs,o):{}};var wi,Ni,ji,Si=o(934777);function Di(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Ti(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Di(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Di(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let Oi=(wi=(0,c.inject)("projectDoc"),Ni=class{constructor(){(0,i.Z)(this,"projectDoc",ji,this),(0,r.Z)(this,"valuePath",[]),(0,r.Z)(this,"itemValuePath",["data","[0]"]),(0,r.Z)(this,"allItemsCountPath",{type:"body",path:[]}),(0,r.Z)(this,"resourceMappers",[{name:"normalize",resource:{params:["response"],dependency:{type:"package",version:"latest",path:"@teleporthq/cms-mappers",meta:{namedImport:!0,originalName:"normalize",importAlias:"@teleporthq/cms-mappers/flotiq"}}}}])}provideBaseUrl(){var e;const t=null===(e=this.projectDoc.cms)||void 0===e?void 0:e.cmsConnectionData;if(!t)throw new Error("Could not get url. Make sure CMS is active.");if("flotiq"!==t.cmsType)throw new Error("Connection type is not Flotiq.");return t.url}provideAccessToken(){var e;const t=null===(e=this.projectDoc.cms)||void 0===e?void 0:e.cmsConnectionData;if(!t)throw new Error("Could not get url. Make sure CMS is active.");if("flotiq"!==t.cmsType)throw new Error("Connection type is not Flotiq.");return t.accessToken}getResourceMappersForResource(){return this.resourceMappers.map((e=>e.name))}getResourceMappers(){return this.resourceMappers.reduce(((e,t)=>(e[t.name]=t.resource,e)),{})}generateResourceForCMSItemNode(e){var t,o;const{node:n,resourceName:i,contentType:r,compId:s}=e;if(!(null===(t=n.attrs)||void 0===t||null===(o=t.cmsItemId)||void 0===o?void 0:o.content))return null;const a=this.projectDoc.components.byId[s],{paramsForFetcher:c,paramsToSendToFetcher:l}=(0,Hn.CR)({attrName:"filters",defaultValue:void 0,attribute:(n.attrs||{}).cmsItemId,propDefinitions:null===a||void 0===a?void 0:a.propDefinitions,stateDefinitions:null===a||void 0===a?void 0:a.stateDefinitions,staticValueTransform:e=>JSON.stringify({id:{type:"equals",filter:e}}),dynamicValueTransform:e=>`JSON.stringify({\n          ['id']: { type: 'equals', filter: \`\${${e}}\` },\n        })`,toSendToFetcherExpressionBuilder:e=>e,getCMSIdentifier:e=>(0,Ln.Dw)((()=>this.projectDoc.getParentNodeIdentifierFromContextAndNodeId(e,n.id)))});return{resource:{id:(0,ni.Ox)(),name:i,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`api/v1/content/${r.name}`}},headers:{"X-AUTH-TOKEN":{type:"env",content:si}},params:Ti({hydrate:{type:"static",content:"2"}},c)},paramsToSendToFetcher:l}}generateResourceForCMSListNode(e){const{node:t,resourceName:o,contentType:n,compId:i}=e,r=this.projectDoc.components.byId[i],{paramsForFetcher:s,paramsToSendToFetcher:a}=Ci(t.attrs||{},!1,r,t.paginated,(e=>(0,Ln.Dw)((()=>this.projectDoc.getParentNodeIdentifierFromContextAndNodeId(e,t.id)))));return{resource:{id:(0,ni.Ox)(),name:o,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`api/v1/content/${n.name}`}},headers:{"X-AUTH-TOKEN":{type:"env",content:si}},params:Ti({hydrate:{type:"static",content:"2"}},s)},paramsToSendToFetcher:a}}generateInitialPathsForPage(e){var t,o;const{pageId:n,dynamicRouteAttribute:i,forPagination:r=!1}=e;if(!i)return null;const s=this.projectDoc.cmsPages.byId[n];if(!s)throw new Error(`Could not find CMS page: ${n}`);const{usedContentTypes:a}=this.projectDoc.cms,c=(0,Ln.KT)({page:s,usedContentTypes:a});if(!c)throw new Error(`Could not find content type for page: ${n}`);const l="cms-details-page"===s.type,d=[...l?(null===(t=s.cmsDetailsPageAttributeDifferentiator)||void 0===t||null===(o=t.content.refPath)||void 0===o?void 0:o.slice(1))||["id"]:[]],p={};!r&&l?p.filters={type:"expr",content:`JSON.stringify({\n          ['${i}']: { type: 'equals', filter: params['${i}'] },\n        })`}:p.page={type:"static",content:1};const u=(0,ni.Ox)(),h={id:u,name:`${pi.removeIllegalCharacters(s.title)}-page-initial-paths-${u.slice(0,5)}`,path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`api/v1/content/${c.name}`}},headers:{"X-AUTH-TOKEN":{type:"env",content:si}},params:p};return{consumer:{exposeAs:Ti({name:i,valuePath:["data"]},l?{itemValuePath:d}:{}),resource:{id:u,params:{}}},resourceFetcher:h}}generateInitialPropsForPage(e){const{pageId:t,propDefinition:o,dynamicRouteAttribute:n,forPagination:i}=e,r=this.projectDoc.cmsPages.byId[t];if(!r)throw new Error(`Could not find CMS page: ${t}`);const{usedContentTypes:s}=this.projectDoc.cms,a=(0,Ln.KT)({page:r,usedContentTypes:s});if(!a)throw new Error(`Could not find content type for page: ${t}`);const c=Fi(this.projectDoc,t,i)||{},l=Ti({},c.paramsForFetcher&&c.paramsForFetcher),d=Ti({},c.paramsToSendToFetcher&&c.paramsToSendToFetcher);l.hydrate={type:"static",content:"2"},null!==r&&void 0!==r&&r.contentType&&n&&!i&&(l.filters={type:"expr",content:`JSON.stringify({\n          ['${n}']: { type: 'equals', filter: params['${n}'] },\n        })`});const p=(0,ni.Ox)(),u={id:p,name:`${pi.removeIllegalCharacters(r.title)}-page-initial-props-${p.slice(0,5)}`,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`api/v1/content/${a.name}`}},headers:{"X-AUTH-TOKEN":{type:"env",content:si}},params:l},h="cms-details-page"===r.type?this.itemValuePath:["data"];return{consumer:{exposeAs:{name:o.name,valuePath:h},resource:{id:p,params:d}},resourceFetcher:u}}generateUIDLForCMSRichText(e,t,o={},n,i){if(!e.html||"static"===e.html.type)return t;const r=(0,Hn.rk)(e,[o[e.html.content.ctxId||""]],n,i);return Ti(Ti({},t),{},{elementType:"markdown-node",semanticType:void 0,children:[r],attrs:{},referencedStyles:{},style:{}})}},ji=(0,s.Z)(Ni.prototype,"projectDoc",[wi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ni);const Fi=(e,t,o)=>{const n=e.cmsPages.byId[t];if(!n)throw new Error(`Could not find CMS page: ${t}`);if(!n.mainNodeId)throw new Error(`Could not find root node for page: ${t}`);if("cms-listing-page"!==n.type)return null;const i=e.nodes.getById(n.mainNodeId);if(!i)throw new Error(`Could not find main node for page: ${t}`);if("cms-collection-list-node"!==i.type)throw new Error(`Main node is not of type cms-list-node: ${i.id}`);return"attrs"in i&&i.attrs?Ci(i.attrs,o):{}},Ci=(e,t,o,n,i=(()=>""))=>{const r={},s={},a=e.sort?(0,Si.$8)(e.sort):void 0,c=e.filter?(0,Si.zh)(e.filter,{propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,getCMSIdentifier:i}):void 0;for(const p in a)s[p]={type:"static",content:a[p]};const l=(0,Hn.CR)({attrName:"limit",attribute:e.perPage,defaultValue:zn,propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,getCMSIdentifier:i});Object.assign(r,l.paramsToSendToFetcher),Object.assign(s,l.paramsForFetcher);const d=n&&e.paginationQuery?(0,Hn.Sy)({attrName:"page",attribute:e.paginationQuery,defaultValue:1,propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,staticValueTransform:e=>`(parseInt(router.query?.['${e}'] ?? 1))`,dynamicValueTransform:e=>`(parseInt(router.query?.[${e}] ?? 1))`,getCMSIdentifier:i}):(0,Hn.CR)({attrName:"page",attribute:e.page,defaultValue:1,propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,staticValueTransform:e=>{const t=Number(e);if(isNaN(t))return e;const o=parseInt(e,10);return o>1?o:0},dynamicValueTransform:e=>`(parseInt(${e}.toString()))`,getCMSIdentifier:i});return Object.assign(r,d.paramsToSendToFetcher),Object.assign(s,d.paramsForFetcher),c&&(s.filters={type:"expr",content:`\`${JSON.stringify(c.queryParamsForFetcher)}\``},Object.keys(c.queryParamsToSendToFetcher).forEach((e=>{r[e]=c.queryParamsToSendToFetcher[e]}))),t&&(s.page={type:"dynamic",content:{referenceType:"prop",id:"page"}},r.page={type:"expr",content:"parseInt(context.params.page)"}),{paramsForFetcher:s,paramsToSendToFetcher:r}};var Ei,xi,_i,Mi=o(768818);function Pi(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Ai(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Pi(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Pi(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let ki=(Ei=(0,c.inject)("projectDoc"),xi=class{constructor(){(0,i.Z)(this,"projectDoc",_i,this),(0,r.Z)(this,"valuePath",[]),(0,r.Z)(this,"itemValuePath",["data","[0]"]),(0,r.Z)(this,"allItemsCountPath",{type:"body",path:["meta","pagination","total"]}),(0,r.Z)(this,"resourceMappers",[{name:"normalize",resource:{params:["response"],dependency:{type:"package",version:"latest",path:"@teleporthq/cms-mappers",meta:{namedImport:!0,originalName:"normalize",importAlias:"@teleporthq/cms-mappers/strapi"}}}}])}provideBaseUrl(){var e;const t=null===(e=this.projectDoc.cms)||void 0===e?void 0:e.cmsConnectionData;if(!t)throw new Error("Could not get url. Make sure CMS is active.");if("strapi"!==t.cmsType)throw new Error("Connection type is not Strapi.");return t.url}provideAccessToken(){var e;const t=null===(e=this.projectDoc.cms)||void 0===e?void 0:e.cmsConnectionData;if(!t)throw new Error("Could not get url. Make sure CMS is active.");if("strapi"!==t.cmsType)throw new Error("Connection type is not Strapi.");return t.accessToken}getResourceMappersForResource(){return this.resourceMappers.map((e=>e.name))}getResourceMappers(){return this.resourceMappers.reduce(((e,t)=>(e[t.name]=t.resource,e)),{})}generateResourceForCMSItemNode(e){var t,o,n;const{node:i,resourceName:r,contentType:s,compId:a}=e;if(!(null===(t=i.attrs)||void 0===t||null===(o=t.cmsItemId)||void 0===o?void 0:o.content))return null;const c=this.projectDoc.components.byId[a],{paramsForFetcher:l,paramsToSendToFetcher:d}=(0,Hn.CR)({attrName:"filters[id]",defaultValue:void 0,attribute:(i.attrs||{}).cmsItemId,propDefinitions:null===c||void 0===c?void 0:c.propDefinitions,stateDefinitions:null===c||void 0===c?void 0:c.stateDefinitions,staticValueTransform:void 0,getCMSIdentifier:e=>(0,Ln.Dw)((()=>this.projectDoc.getParentNodeIdentifierFromContextAndNodeId(e,i.id)))});let p={};(null===(n=this.projectDoc.cms)||void 0===n?void 0:n.cmsConnectionData).populateDeepPluginAdded?p.populate={type:"static",content:"deep"}:(p=Ri(s.attributes,this.projectDoc.cms.componentTypes),Object.keys(p).length||(p.populate={type:"static",content:"*"})),Object.keys(p||{}).length&&l&&(Object.assign(l,p),this.projectDoc.internationalization.enabled&&Object.assign(l,{locale:{type:"expr",content:"params?.locale"}})),Object.assign(d,{locale:{type:"expr",content:'props?.locale ?? ""'}});return{resource:{id:(0,ni.Ox)(),name:r,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`api/${s.name}`}},headers:{authToken:{type:"env",content:si}},params:Ai({},l)},paramsToSendToFetcher:d}}generateResourceForCMSListNode(e){var t;const{node:o,resourceName:n,contentType:i,compId:r}=e,s=this.projectDoc.components.byId[r],{paramsForFetcher:a,paramsToSendToFetcher:c}=Zi(o.attrs||{},!1,s,o.paginated,(e=>(0,Ln.Dw)((()=>this.projectDoc.getParentNodeIdentifierFromContextAndNodeId(e,o.id)))));let l={};(null===(t=this.projectDoc.cms)||void 0===t?void 0:t.cmsConnectionData).populateDeepPluginAdded?l.populate={type:"static",content:"deep"}:(l=Ri(i.attributes,this.projectDoc.cms.componentTypes),Object.keys(l).length||(l.populate={type:"static",content:"*"})),Object.keys(l||{}).length&&a&&(Object.assign(a,l),this.projectDoc.internationalization.enabled&&Object.assign(a,{locale:{type:"expr",content:"params?.locale"}})),Object.assign(c,{locale:{type:"expr",content:'props?.locale ?? ""'}});return{resource:{id:(0,ni.Ox)(),name:n,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`api/${i.name}`}},headers:{authToken:{type:"env",content:si}},params:Ai({},a)},paramsToSendToFetcher:c}}generateInitialPathsForPage(e){var t,o;const{pageId:n,dynamicRouteAttribute:i,forPagination:r=!1}=e;if(!i)return null;const s=this.projectDoc.cmsPages.byId[n];if(!s)throw new Error(`Could not find CMS page: ${n}`);const{usedContentTypes:a}=this.projectDoc.cms,c=(0,Ln.KT)({page:s,usedContentTypes:a});if(!c)throw new Error(`Could not find content type for page: ${n}`);const l="cms-details-page"===s.type,d=l?(null===(t=s.cmsDetailsPageAttributeDifferentiator)||void 0===t||null===(o=t.content.refPath)||void 0===o?void 0:o.slice(1))||["id"]:[],p=[...1===d.length&&"id"===d[0]?[]:["attributes"],...d],u={};!r&&l?u.fields={type:"static",content:i}:u["pagination[pageSize]"]={type:"static",content:1};const h=(0,ni.Ox)(),m={id:h,name:`${pi.removeIllegalCharacters(s.title)}-page-initial-paths-${h.slice(0,5)}`,path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`api/${c.name}`}},headers:{authToken:{type:"env",content:si}},params:u};return{consumer:{exposeAs:Ai({name:i,valuePath:["data"]},l&&{itemValuePath:p}),resource:{id:h,params:{}}},resourceFetcher:m}}generateInitialPropsForPage(e){var t;const{pageId:o,propDefinition:n,dynamicRouteAttribute:i,forPagination:r,defaultLocale:s}=e,a=this.projectDoc.cmsPages.byId[o];if(!a)throw new Error(`Could not find CMS page: ${o}`);const c="cms-details-page"===a.type,{usedContentTypes:l}=this.projectDoc.cms,d=(0,Ln.KT)({page:a,usedContentTypes:l});if(!d)throw new Error(`Could not find content type for page: ${o}`);const p=Ui(this.projectDoc,o,r)||{},u=Ai({},p.paramsForFetcher&&p.paramsForFetcher),h=Ai({},p.paramsToSendToFetcher&&p.paramsToSendToFetcher);null!==a&&void 0!==a&&a.contentType&&i&&!r&&(u[`filters[${i}][$eq]`]={type:"dynamic",content:{referenceType:"prop",id:i}});let m={};(null===(t=this.projectDoc.cms)||void 0===t?void 0:t.cmsConnectionData).populateDeepPluginAdded?m.populate={type:"static",content:"deep"}:(m=Ri(d.attributes,this.projectDoc.cms.componentTypes),Object.keys(m).length||(m.populate={type:"static",content:"*"})),Object.keys(m||{}).length&&Object.assign(u,m),s&&this.projectDoc.internationalization.enabled&&(Object.assign(u,{locale:{type:"expr",content:"params?.locale"}}),Object.assign(h,{locale:{type:"expr",content:`context?.locale ?? "${s}"`}}));const y=(0,ni.Ox)(),g={id:y,name:`${pi.removeIllegalCharacters(a.title)}-page-initial-props-${y.slice(0,5)}`,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`api/${d.name}`}},headers:{authToken:{type:"env",content:si}},params:u},f=c?this.itemValuePath:this.valuePath;return{consumer:{exposeAs:{name:n.name,valuePath:f},resource:{id:y,params:h}},resourceFetcher:g}}generateUIDLForCMSRichText(e,t,o={},n,i){if(!e.html||"static"===e.html.type)return t;const r=(0,Hn.rk)(e,[o[e.html.content.ctxId||""]],n,i);return Ai(Ai({},t),{},{elementType:"markdown-node",semanticType:void 0,children:[r],attrs:{},referencedStyles:{},style:{}})}},_i=(0,s.Z)(xi.prototype,"projectDoc",[Ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xi);const Ui=(e,t,o)=>{const n=e.cmsPages.byId[t];if(!n)throw new Error(`Could not find CMS page: ${t}`);if(!n.mainNodeId)throw new Error(`Could not find root node for page: ${t}`);if("cms-listing-page"!==n.type)return null;const i=e.nodes.getById(n.mainNodeId);if(!i)throw new Error(`Could not find main node for page: ${t}`);if("cms-collection-list-node"!==i.type)throw new Error(`Main node is not of type cms-list-node: ${i.id}`);return"attrs"in i&&i.attrs?Zi(i.attrs,o):{}},Ri=(e,t)=>Object.entries(e).reduce(((e,[o,n])=>{if("array"!==n.type&&"media"!==n.type||(e[`populate[${o}][populate]`]={type:"static",content:"*"}),"relation"===n.type){var i,r;const s=n;null!==(i=s.relationComponentTypeIds)&&void 0!==i&&i.length&&s.relationComponentTypeIds.forEach((n=>{const i=null===t||void 0===t?void 0:t[n];i&&Object.entries(i.attributes).forEach((([t,n])=>{e[`populate[${o}][populate][${t}][populate]`]={type:"static",content:"*"},"relation"===n.type&&(e[`populate[${o}][populate][${t}]`]={type:"static",content:"*"})}))})),null!==(r=s.relationContentTypeIds)&&void 0!==r&&r.length&&(e[`populate[${o}][populate]`]={type:"static",content:"*"})}return e}),{}),Zi=(e,t,o,n,i=(()=>""))=>{const r={},s={},a=e.sort?(0,Mi.$8)(e.sort):void 0,c=e.filter?(0,Mi.zh)(e.filter,{propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,getCMSIdentifier:i}):void 0;for(const h in a)s[h]={type:"static",content:a[h]};const l=(0,Hn.CR)({attrName:"pagination[limit]",attribute:e.perPage,defaultValue:zn,propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,getCMSIdentifier:i});Object.assign(r,l.paramsToSendToFetcher),Object.assign(s,l.paramsForFetcher);const d=n&&e.paginationQuery?(0,Hn.Sy)({attrName:"pagination[start]",attribute:e.paginationQuery,defaultValue:0,propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,staticValueTransform:e=>{var t,o,n,i;return`(parseInt(router.query?.['${e}'] ?? 1) - 1) * ${null!==(t=null!==(o=null===(n=r["pagination[limit]"])||void 0===n?void 0:n.content)&&void 0!==o?o:null===(i=s["pagination[limit]"])||void 0===i?void 0:i.content)&&void 0!==t?t:zn}`},dynamicValueTransform:e=>{var t,o,n,i;return`(parseInt(router.query?.[${e}] ?? 1) - 1) * ${null!==(t=null!==(o=null===(n=r["pagination[limit]"])||void 0===n?void 0:n.content)&&void 0!==o?o:null===(i=s["pagination[limit]"])||void 0===i?void 0:i.content)&&void 0!==t?t:zn}`},getCMSIdentifier:i}):(0,Hn.CR)({attrName:"pagination[start]",attribute:e.page,defaultValue:0,propDefinitions:null===o||void 0===o?void 0:o.propDefinitions,stateDefinitions:null===o||void 0===o?void 0:o.stateDefinitions,staticValueTransform:e=>{const t=Number(e);if(isNaN(t))return e;const o=parseInt(e,10);return o>1?o:0},dynamicValueTransform:e=>{var t,o,n,i;return`(parseInt(${e}.toString()) - 1) * (${null!==(t=null!==(o=null===(n=r["pagination[limit]"])||void 0===n?void 0:n.content)&&void 0!==o?o:null===(i=s["pagination[limit]"])||void 0===i?void 0:i.content)&&void 0!==t?t:zn})`},getCMSIdentifier:i}),{filterParamsForFetcher:p,filterParamsToSendToFetcher:u}=ui(c||{});return Object.assign(r,Ai(Ai({},d.paramsToSendToFetcher),u)),Object.assign(s,Ai(Ai({},d.paramsForFetcher),p)),t&&(s["pagination[start]"]={type:"dynamic",content:{referenceType:"prop",id:"start"}},r.start={type:"expr",content:`(context.params.page - 1) * ${s["pagination[limit]"].content}`}),{paramsForFetcher:s,paramsToSendToFetcher:r}};var Li,$i,Bi,Gi=o(52718),Hi=o(300457),zi=o(348834).Buffer;function Yi(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Vi(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Yi(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Yi(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let Wi=(Li=(0,c.inject)("projectDoc"),$i=class{constructor(){(0,i.Z)(this,"projectDoc",Bi,this),(0,r.Z)(this,"valuePath",[]),(0,r.Z)(this,"itemValuePath",["data","[0]"]),(0,r.Z)(this,"allItemsCountPath",{type:"headers",path:["x-wp-total"]}),(0,r.Z)(this,"resourceMappers",[{name:"normalize",resource:{params:["response","params"],dependency:{type:"package",version:"latest",path:"@teleporthq/cms-mappers",meta:{namedImport:!0,originalName:"normalize",importAlias:"@teleporthq/cms-mappers/wordpress"}}}}])}provideBaseUrl(){var e;const t=null===(e=this.projectDoc.cms)||void 0===e?void 0:e.cmsConnectionData;if(!t)throw new Error("Could not get url. Make sure CMS is active.");if("wordpress"!==t.cmsType)throw new Error("Connection type is not Wordpress");return t.url}provideAccessToken(){var e;const t=null===(e=this.projectDoc.cms)||void 0===e?void 0:e.cmsConnectionData;if(!t)throw new Error("Could not get url. Make sure CMS is active.");if("wordpress"!==t.cmsType)throw new Error("Connection type is not Wordpress");const{authType:o}=t;switch(o){case Gi.x.BASIC:case Gi.x.APPLICATION_PASSWORD:const{basicAuth:e,appPasswordAuth:o}=t,{username:n,password:i}=e||o||{};if(!n||!i)throw new Error("No username or password provided");return`Basic ${zi.from(`${n}:${i}`).toString("base64")}`;case Gi.x.JWT:const{accessToken:r}=t;if(!r)throw new Error("No Access Token provided");return`Bearer ${r}`;default:return""}}getResourceMappersForResource(){return this.resourceMappers.map((e=>e.name))}getResourceMappers(){return this.resourceMappers.reduce(((e,t)=>(e[t.name]=t.resource,e)),{})}generateResourceForCMSItemNode(e){var t,o;const{node:n,resourceName:i,contentType:r,compId:s}=e;if(!(null===(t=n.attrs)||void 0===t||null===(o=t.cmsItemId)||void 0===o?void 0:o.content))return null;const a=this.projectDoc.components.byId[s],{paramsForFetcher:c,paramsToSendToFetcher:l}=(0,Hn.CR)({attrName:"include",defaultValue:void 0,attribute:(n.attrs||{}).cmsItemId,propDefinitions:null===a||void 0===a?void 0:a.propDefinitions,stateDefinitions:null===a||void 0===a?void 0:a.stateDefinitions,staticValueTransform:void 0,getCMSIdentifier:e=>(0,Ln.Dw)((()=>this.projectDoc.getParentNodeIdentifierFromContextAndNodeId(e,n.id)))});return{resource:{id:(0,ni.Ox)(),name:i,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`wp-json/wp/v2/${r.uid}`}},headers:{authToken:{type:"env",content:si}},response:{type:"none"},params:Vi({},c)},paramsToSendToFetcher:l}}generateResourceForCMSListNode(e){const{resourceName:t,contentType:o,node:n,compId:i}=e,r=this.projectDoc.components.byId[i],{paramsForFetcher:s,paramsToSendToFetcher:a}=Ki(n.attrs||{},r,n.paginated,(e=>(0,Ln.Dw)((()=>this.projectDoc.getParentNodeIdentifierFromContextAndNodeId(e,n.id)))));return{resource:{id:(0,ni.Ox)(),name:t,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`wp-json/wp/v2/${o.uid}`}},headers:{authToken:{type:"env",content:si}},params:s,response:{type:"none"}},paramsToSendToFetcher:a}}generateInitialPathsForPage(e){var t,o;const{pageId:n,dynamicRouteAttribute:i,forPagination:r=!1}=e;if(!i)return null;const s=this.projectDoc.cmsPages.byId[n];if(!s)throw new Error(`Could not find CMS page: ${n}`);const{usedContentTypes:a}=this.projectDoc.cms,c=(0,Ln.KT)({page:s,usedContentTypes:a});if(!c)throw new Error(`Could not find content type for page: ${n}`);const l="cms-details-page"===s.type,d=[...l?(null===(t=s.cmsDetailsPageAttributeDifferentiator)||void 0===t||null===(o=t.content.refPath)||void 0===o?void 0:o.slice(1))||["id"]:[]],p=(0,ni.Ox)(),u=Vi({id:p,name:`${pi.removeIllegalCharacters(s.title)}-page-initial-paths-${p.slice(0,5)}`,path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`wp-json/wp/v2/${c.uid}`}},headers:{authToken:{type:"env",content:si}},params:Vi({},!r&&l?{per_page:{type:"static",content:"100"}}:{per_page:{type:"static",content:1}})},!r&&l?{}:{response:{type:"headers"}});return{consumer:{exposeAs:Vi({name:i,valuePath:this.valuePath},l?{itemValuePath:d}:{}),resource:{id:p}},resourceFetcher:u}}generateInitialPropsForPage(e){const{pageId:t,propDefinition:o,dynamicRouteAttribute:n,forPagination:i}=e,r=this.projectDoc.cmsPages.byId[t];if(!r)throw new Error(`Could not find CMS page: ${t}`);const s="cms-details-page"===r.type,{usedContentTypes:a}=this.projectDoc.cms,c=(0,Ln.KT)({page:r,usedContentTypes:a});if(!c)throw new Error(`Could not find content type for page: ${t}`);const l=(0,Ln.pi)(this.projectDoc,t),d=r.contentType&&n&&!i?this.getDynamicValueAttributeValue(n):null,p={};i?(p.page={type:"dynamic",content:{referenceType:"prop",id:"page"}},p.per_page={type:"static",content:`${l}`}):p.per_page={type:"static",content:`${l||50}`},d&&(p.include={type:"dynamic",content:{referenceType:"prop",id:d}});const u=(0,ni.Ox)(),h={id:u,name:`${pi.removeIllegalCharacters(r.title)}-page-initial-props-${u.slice(0,5)}`,mappers:this.getResourceMappersForResource(),path:{baseUrl:{type:"env",content:ri},route:{type:"static",content:`wp-json/wp/v2/${c.uid}`}},headers:{authToken:{type:"env",content:si}},params:p,response:{type:"none"}},m=s?this.itemValuePath:this.valuePath;return{consumer:{exposeAs:{name:o.name,valuePath:m},resource:{id:u,params:{}}},resourceFetcher:h}}generateUIDLForCMSRichText(e,t,o={},n,i){if(!e.html||"static"===e.html.type)return t;const r=(0,Hn.rk)(e,[o[e.html.content.ctxId||""]],n,i);return Vi(Vi({},t),{},{attrs:Vi(Vi({},t.attrs),{},{html:r}),elementType:"html-node"})}getDynamicValueAttributeValue(e){switch(e){case"slug":return"slug";case"id":return"id";default:return null}}},Bi=(0,s.Z)($i.prototype,"projectDoc",[Li],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$i);const Ki=(e,t,o,n=(()=>""))=>{let i={},r={};const s=(0,Hn.CR)({attrName:"per_page",attribute:e.perPage,defaultValue:zn,propDefinitions:null===t||void 0===t?void 0:t.propDefinitions,stateDefinitions:null===t||void 0===t?void 0:t.stateDefinitions,getCMSIdentifier:n});Object.assign(i,s.paramsToSendToFetcher),Object.assign(r,s.paramsForFetcher);const a=o?(0,Hn.Sy)({attrName:"page",attribute:e.paginationQuery,defaultValue:1,propDefinitions:null===t||void 0===t?void 0:t.propDefinitions,stateDefinitions:null===t||void 0===t?void 0:t.stateDefinitions,getCMSIdentifier:n,staticValueTransform:e=>`parseInt(router.query?.['${e}'] ?? 1)`,dynamicValueTransform:e=>`parseInt(router.query?.[${e}] ?? 1)`}):(0,Hn.CR)({attrName:"page",attribute:e.page,defaultValue:1,propDefinitions:null===t||void 0===t?void 0:t.propDefinitions,stateDefinitions:null===t||void 0===t?void 0:t.stateDefinitions,getCMSIdentifier:n});if(Object.assign(i,a.paramsToSendToFetcher),Object.assign(r,a.paramsForFetcher),null!==e&&void 0!==e&&e.sort){const{order:t,orderby:o}=(0,Hi.$8)(e.sort);t&&(r.order={type:"static",content:t}),o&&(r.orderby={type:"static",content:o})}if(null!==e&&void 0!==e&&e.filter){const o=(0,Hi.zh)(e.filter,{getCMSIdentifier:n,propDefinitions:null===t||void 0===t?void 0:t.propDefinitions,stateDefinitions:null===t||void 0===t?void 0:t.stateDefinitions}),{filterParamsForFetcher:s,filterParamsToSendToFetcher:a}=ui(o);r=Vi(Vi({},r),s),i=Vi(Vi({},i),a)}return{paramsToSendToFetcher:i,paramsForFetcher:r}};var qi,Ji,Xi,Qi,er;let tr=(qi=(0,c.inject)("projectDoc"),er=Qi=class{constructor(){(0,i.Z)(this,"projectDoc",Xi,this),(0,r.Z)(this,"mappers",{contentful:new bi,strapi:new ki,flotiq:new Oi,wordpress:new Wi,"caisy.io":new Xn})}static get Instance(){return this._instance||(this._instance=new this)}get itemValuePath(){var e,t,o;const n=null===(e=this.projectDoc)||void 0===e||null===(t=e.cms)||void 0===t||null===(o=t.cmsConnectionData)||void 0===o?void 0:o.cmsType;if(!n)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");return this.mappers[n].itemValuePath}get valuePath(){var e,t,o;const n=null===(e=this.projectDoc)||void 0===e||null===(t=e.cms)||void 0===t||null===(o=t.cmsConnectionData)||void 0===o?void 0:o.cmsType;if(!n)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");return this.mappers[n].valuePath}get allItemsCountPath(){var e,t,o;const n=null===(e=this.projectDoc)||void 0===e||null===(t=e.cms)||void 0===t||null===(o=t.cmsConnectionData)||void 0===o?void 0:o.cmsType;if(!n)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");return this.mappers[n].allItemsCountPath}get resourceMappers(){var e,t,o;const n=null===(e=this.projectDoc)||void 0===e||null===(t=e.cms)||void 0===t||null===(o=t.cmsConnectionData)||void 0===o?void 0:o.cmsType;if(!n)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");return this.mappers[n].resourceMappers}setMapper(e,t){this.mappers[e]=t}getMapper(e){return this.mappers[e]}provideBaseUrl(){var e,t,o;const n=null===(e=this.projectDoc)||void 0===e||null===(t=e.cms)||void 0===t||null===(o=t.cmsConnectionData)||void 0===o?void 0:o.cmsType;if(!n)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");const i=this.mappers[n].provideBaseUrl();return"string"===typeof i?i:`teleporthq.secrets.${i.content.id}`}provideAccessToken(){var e,t,o;const n=null===(e=this.projectDoc)||void 0===e||null===(t=e.cms)||void 0===t||null===(o=t.cmsConnectionData)||void 0===o?void 0:o.cmsType;if(!n)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");const i=this.mappers[n].provideAccessToken();return"string"===typeof i?i:`teleporthq.secrets.${i.content.id}`}provideWebhookSecret(){var e,t,o,n,i,r,s,a,c,l;return(null===(e=this.projectDoc)||void 0===e||null===(t=e.cms)||void 0===t||null===(o=t.webhook)||void 0===o||null===(n=o.config)||void 0===n||null===(i=n.teleport)||void 0===i?void 0:i.secret)||(null===(r=this.projectDoc)||void 0===r||null===(s=r.cms)||void 0===s||null===(a=s.webhook)||void 0===a||null===(c=a.config)||void 0===c||null===(l=c.vercel)||void 0===l?void 0:l.secret)}generateResourceForCMSItemNode(e){var t,o,n;const i=null===(t=this.projectDoc)||void 0===t||null===(o=t.cms)||void 0===o||null===(n=o.cmsConnectionData)||void 0===n?void 0:n.cmsType;if(!i)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");return this.mappers[i].generateResourceForCMSItemNode(e)}generateResourceForCMSListNode(e){var t,o,n;const i=null===(t=this.projectDoc)||void 0===t||null===(o=t.cms)||void 0===o||null===(n=o.cmsConnectionData)||void 0===n?void 0:n.cmsType;if(!i)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");return this.mappers[i].generateResourceForCMSListNode(e)}generateInitialPropsForPage(e){var t,o,n;const i=null===(t=this.projectDoc)||void 0===t||null===(o=t.cms)||void 0===o||null===(n=o.cmsConnectionData)||void 0===n?void 0:n.cmsType;if(!i)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");return this.mappers[i].generateInitialPropsForPage(e)}generateInitialPathsForPage(e){var t,o,n;const i=null===(t=this.projectDoc)||void 0===t||null===(o=t.cms)||void 0===o||null===(n=o.cmsConnectionData)||void 0===n?void 0:n.cmsType;if(!i)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");return this.mappers[i].generateInitialPathsForPage(e)}generateUIDLForCMSRichText(e,t,o,n,i){var r,s,a;const c=null===(r=this.projectDoc)||void 0===r||null===(s=r.cms)||void 0===s||null===(a=s.cmsConnectionData)||void 0===a?void 0:a.cmsType;if(!c)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");return this.mappers[c].generateUIDLForCMSRichText(e,t,o,n,i)}getResourceMappers(){var e,t,o;const n=null===(e=this.projectDoc)||void 0===e||null===(t=e.cms)||void 0===t||null===(o=t.cmsConnectionData)||void 0===o?void 0:o.cmsType;if(!n)throw new Error("No active cms domain to UIDL mapper. Make sure CMS is active.");return this.mappers[n].getResourceMappers()}},(0,r.Z)(Qi,"_instance",void 0),Ji=er,Xi=(0,s.Z)(Ji.prototype,"projectDoc",[qi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ji);var or=o(592681),nr=o(555362),ir=o(925984),rr=o(573448),sr=o(825504),ar=o(761328);const cr={[Zn.sO.CONTAINER]:"thqContainer",[Zn.sO.ICON]:"thqIcon",[Zn.sO.IMAGE]:"thqImage",[Zn.sO.LINK]:"thqLink",[Zn.sO.TEXT]:"thqText",[Zn.sO.COMPONENT]:"thqComponent",[Zn.RY.HEADING1]:"thqHeading1",[Zn.RY.HEADING2]:"thqHeading2",[Zn.RY.HEADING3]:"thqHeading3",[Zn.RY.HEADING4]:"thqHeading4",[Zn.RY.HEADING5]:"thqHeading5",[Zn.RY.HEADING6]:"thqHeading6"};var lr=o(229187),dr=o(641673),pr=o(352541);function ur(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function hr(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ur(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ur(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const mr=e=>{const{styleId:t,referenceId:o,propDefinitions:n,stateDefinitions:i,renderingConditions:r}=e;return{id:t,type:"style-map",content:{mapType:"project-referenced",referenceId:o,condition:r?{reference:r.reference,value:r.value,expression:r.condition?{conditions:r.condition.conditions.map((t=>{var o;const r=t.operand;if("object"===typeof r&&null!==r){let s;switch(r.content.referenceType){case"prop":s=Object.keys(n).find((e=>n[e].id===r.content.id));break;case"state":s=Object.keys(i).find((e=>i[e].id===r.content.id));break;case"ctx":return s=null===(o=e.cmsIdentifiersByCtxId)||void 0===o?void 0:o[r.content.id],hr(hr({},t),{},{operand:new nr.P({id:s,content:{referenceType:"local",id:s,refPath:r.content.refPath}}).toUIDL()})}const a=new nr.P({id:s,content:r.content}).toUIDL();if(!a)throw new Error("Invalid operand mapping");return hr(hr({},t),{},{operand:a})}return hr(hr({},t),{},{operand:t.operand})}))}:{conditions:[]}}:void 0}}},yr=e=>{var t;const{node:o,propDefinitions:n,stateDefinitions:i,projectDoc:r,defaultElementStyles:s,assetSrcMapping:a,cmsIdentifiersByCtxId:c}=e,l=r.nodes.getById(r.getOwnerIdOfDependentNode(o.id))||o;if(!("referencedStyles"in l))return{};const{referencedStyles:d,primitiveType:p}=l;let u={};Object.keys(ar.F).forEach((e=>{const t=Object.values(d||{}).find((t=>"inlined"===t.content.mapType&&t.content.conditions.length&&"element-state"===t.content.conditions[0].conditionType&&t.content.conditions[0].content===e));t&&(u[t.id]=(0,sr.$)(t,a,r))})),Object.values(d||{}).forEach((e=>{var t;if("design-language-referenced"===e.content.mapType){const t=r.designLanguage.textStyleSetsById[e.content.referenceId];if(!t)return;u[e.id]={type:"style-map",content:{mapType:"project-referenced",referenceId:(0,dr.hN)(t.name)}}}if("project-referenced"===e.content.mapType){const t=r.classes.byId[e.content.referenceId];if(Object.keys(t.usedInNodes).length||pr.j.addUsedInNodeToCssClass(t.id,l.id),!t)return;null!==t&&void 0!==t&&t.linkedTextStyles&&Object.keys(t.linkedTextStyles).forEach((e=>{const t=r.designLanguage.textStyleSetsById[e];if(!t)return;const o=mr({styleId:(0,ni.Ox)(),referenceId:(0,dr.hN)(t.name),propDefinitions:n,stateDefinitions:i});u[o.id]=o}));const s="conditionalReferencedProjectStyles"in o?(0,Rn._x)(o.conditionalReferencedProjectStyles,n,i):void 0,a=mr({styleId:e.id,referenceId:t.getName(r.classes.byId),propDefinitions:n,stateDefinitions:i,renderingConditions:null===s||void 0===s?void 0:s[e.id],cmsIdentifiersByCtxId:c});u[a.id]=a}if("inlined"===e.content.mapType&&e.content.conditions&&(null===(t=e.content)||void 0===t?void 0:t.conditions.length)>0&&"screen-size"===e.content.conditions[0].conditionType&&(u[e.id]=(0,sr.$)(e,a,r)),"component-referenced"===e.content.mapType){let t={};t="static"===e.content.content.type?{type:"static",content:e.content.content.content}:{type:"dynamic",content:{referenceType:e.content.content.content.referenceType,id:lr.Q}},u[e.id]={type:"style-map",content:{mapType:"component-referenced",content:hr({},t)}}}}));const h=Object.keys(s||{}).find((e=>e===cr[p]));if(h){const e=(0,ni.Ox)();u=hr(hr({},u),{},{[e]:{type:"style-map",content:{mapType:"project-referenced",referenceId:h}}})}const m=Object.keys(s||{}).find((e=>"thqLink"===e));if("abilities"in l&&null!==(t=l.abilities)&&void 0!==t&&t.link&&m){const e=(0,ni.Ox)();u=hr(hr({},u),{},{[e]:{type:"style-map",content:{mapType:"project-referenced",referenceId:m}}})}return u};function gr(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function fr(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?gr(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):gr(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const br=e=>{var t;const{states:o,cmsIdentifier:n,source:i,isCMSListRepeater:r=!1,node:s,assetSrcMapping:a,projectDoc:c,wrapInContainer:l,propDefinitions:d,stateDefinitions:p}=e,{list:u,empty:h}=o,m={type:"cms-list-repeater",content:fr(fr({elementType:"cms-list-repeater",nodes:{list:{type:"element",content:{elementType:"fragment",children:u.content.children}},empty:null!==h&&void 0!==h&&null!==(t=h.content.children)&&void 0!==t&&t.length?h:void 0}},i?{source:i}:{}),{},{renderPropIdentifier:n,isCMSListRepeater:r})};if(!l)return m;const y=yr({node:s,propDefinitions:d,stateDefinitions:p,projectDoc:c,defaultElementStyles:{},assetSrcMapping:a}),g="styles"in s?s.styles:{};return{type:"element",content:fr({elementType:"container",semanticType:"div",children:[m],referencedStyles:y},Object.keys(g||{}).length>0&&{style:(0,sr.q)(g,a,c)})}};function Ir(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function vr(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ir(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ir(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const wr=e=>{var t,o,n,i,r;const{node:s,component:a,cmsData:c,cmsNodes:l,valuePath:d,cmsIdentifier:p}=e,{success:u,loading:h,error:m}=l;if("uninitialised"===(null===(t=s.resourceDefinition)||void 0===t?void 0:t.type)||!s.resourceDefinition)throw new Error(`CMS Collection List Node is not initialised. Node: ${s.id}`);const{projectResources:y={},nodeParams:g={},cmsProps:f={},cmsStates:b={}}=c,I=b[s.id],v=a&&"mainNodeId"in a&&(null===a||void 0===a?void 0:a.mainNodeId)===s.id,w=y[s.id],N=w&&!v&&"id"in w?w.id:null,j=v?{referenceType:"prop",id:(null===(o=f[s.id])||void 0===o?void 0:o.name.replace(/ /g,""))||"unknownData"}:{referenceType:"state",id:(null===I||void 0===I?void 0:I.name.replace(/ /g,""))||"unknownData"},S=y[s.id],D=N?vr({id:N},g[s.id]&&{params:g[s.id]}):vr({},y[s.id]);return{type:"cms-list",content:vr(vr(vr({elementType:"DataProvider",resourceDefinition:s.resourceDefinition,dependency:(0,Rn.Yg)()},v&&j&&{initialData:{type:"dynamic",content:j}}),{},{renderPropIdentifier:p,nodes:{success:{type:"element",content:{elementType:"fragment",children:u.content.children}},loading:!v&&null!==h&&void 0!==h&&null!==(n=h.content.children)&&void 0!==n&&n.length?h:void 0,error:!v&&null!==m&&void 0!==m&&null!==(i=m.content.children)&&void 0!==i&&i.length?m:void 0},valuePath:d},(null===(r=s.attrs)||void 0===r?void 0:r.paginationQuery)&&{router:{type:"library",path:"next/router",version:"latest",meta:{namedImport:!0}}}),S?{resource:D}:null)}};function Nr(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function jr(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Nr(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Nr(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Sr=e=>{var t,o,n,i,r,s,a;const{success:c,error:l,loading:d}=e.cmsNodes,{node:p,component:u,cmsData:h,itemValuePath:m,cmsIdentifier:y}=e;if("uninitialised"===(null===(t=p.resourceDefinition)||void 0===t?void 0:t.type))throw new Error(`CMS Collection List Node is not initialised. Node: ${p.id}`);const{projectResources:g={},cmsProps:f={},nodeParams:b={},cmsStates:I={}}=h,v=I[p.id],w=u&&"mainNodeId"in u&&(null===u||void 0===u?void 0:u.mainNodeId)===p.id,N=w?{referenceType:"prop",id:(null===(o=f[p.id])||void 0===o?void 0:o.name)||"remoteData"}:{referenceType:"state",id:(null===v||void 0===v?void 0:v.name)||"unknownData"},j=g[p.id],S=!w&&j&&"id"in j?j.id:null,D=!!j,T=S?jr({id:S},b[p.id]&&{params:b[p.id]}):jr({},g[p.id]);return D||w?{type:"cms-item",content:jr(jr(jr({elementType:"DataProvider",resourceDefinition:p.resourceDefinition,dependency:(0,Rn.Yg)()},w&&N&&{initialData:{type:"dynamic",content:N}}),"cms-details-page"===(null===u||void 0===u?void 0:u.type)&&{entityKeyProperty:null===(n=u.cmsDetailsPageAttributeDifferentiator)||void 0===n||null===(i=n.content)||void 0===i||null===(r=i.refPath)||void 0===r?void 0:r.at(-1)}),{},{renderPropIdentifier:y,nodes:{success:{type:"element",content:{elementType:"fragment",children:c.content.children}},loading:!w&&null!==d&&void 0!==d&&null!==(s=d.content.children)&&void 0!==s&&s.length?d:void 0,error:!w&&null!==l&&void 0!==l&&null!==(a=l.content.children)&&void 0!==a&&a.length?l:void 0},valuePath:m},D?{resource:T}:null)}:{type:"element",content:{elementType:"fragment",children:[]}}};function Dr(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Tr(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Dr(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Dr(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var Or,Fr,Cr,Er,xr,_r=o(869425);const Mr=new(Or=(0,c.inject)("sentryService"),Fr=(0,c.inject)("selfHealingFlow"),Cr=class{constructor(){(0,i.Z)(this,"sentryService",Er,this),(0,i.Z)(this,"selfHealingFlow",xr,this)}},Er=(0,s.Z)(Cr.prototype,"sentryService",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xr=(0,s.Z)(Cr.prototype,"selfHealingFlow",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cr);Object.freeze(Mr);var Pr,Ar,kr,Ur,Rr,Zr,Lr,$r=o(930613),Br=o(774468),Gr=o(40835),Hr=o(393724);const zr=800;Pr=(0,c.provide)("assetsService"),Ar=(0,c.inject)("projectDoc"),kr=(0,c.inject)("sentryService"),Pr((Rr=class{constructor(){(0,i.Z)(this,"projectDoc",Zr,this),(0,i.Z)(this,"sentryService",Lr,this)}async downloadAssets(e,t={}){const o=e.map((e=>this.getAssetData(e,t)));return(await Promise.all(o)).filter((e=>e))}async fetchImageFromUrlAsBlob(e){return(await fetch(e,{headers:{accept:Br.un}})).blob()}async createOptimisedAssets(e){const t=[];e.forEach((e=>{var o,n;if(e.type!==Mt.K.IMAGE)return void t.push(e);const i=this.shouldApplyAdvancedOptimisationsToAsset(e)?this.changeAssetExtensionToWebP(e.name):e.name,r=i.split(".");if(r.length<2)throw new Error(`There is an asset without an extension: ${e.name}`);if(e.skipOptimisations||-1!==$r.ou.a.indexOf(r[r.length-1])){if(t.find((e=>e.name===i)))return;const o={name:i,type:e.type,bucket:e.bucket,mimetype:e.mimetype,usedInNodes:e.usedInNodes,usedInClasses:e.usedInClasses,path:e.path,id:e.id,size:"w="+3*Br.Cg,parentFolderId:e.parentFolderId,skipOptimisations:!0};return void t.push(new Gr.G(o))}const{sizePerComponent:s}=e;if(!s)return;let a=0;if(Object.keys(s).forEach((o=>{const n=s[o].split("="),i=[...r];i[i.length-2]=`${i[i.length-2]}-${n[1]}${n[0]}`;const c=i.join("."),l=parseInt(n[1]);l>a&&(a=l);for(let r=0;r<t.length;r++)if(t[r].size===s[o]&&t[r].name===c)return void Object.keys(e.usedInNodes).forEach((e=>{this.projectDoc.getComponentIdForNode(e)===o&&(t[r].usedInNodes[e]=!0)}));const d={};Object.keys(e.usedInNodes).forEach((e=>{this.projectDoc.getComponentIdForNode(e)===o&&(d[e]=!0)})),t.push(this.generateAssetForSize(e,c,s[o],d))})),null!==(o=this.projectDoc.settings)&&void 0!==o&&null!==(n=o.experimentalFeatures)&&void 0!==n&&n[_r.QR.ADVANCED_IMAGE_OPTIMISATIONS]){const o={},n=(n,i)=>{const s=[...r],a=i.split("=")[1],c=`${s[s.length-2]}${n}`,l=`${s[s.length-2]}-${a}w`;s[s.length-2]=c;const d=s.join(".");s[s.length-2]=l;const p=s.join("."),u=t.find((e=>e.size===i&&e.name===p));u?u.name=d:t.push(this.generateAssetForSize(e,d,i,o))};if(a>500){n("-mobile","w=500")}if(a>zr){n("-tablet","w=800")}}}));const o=[];return t.forEach((e=>{e.name=(0,l._x)(o,e.name),o.push(e.name)})),t}generateAssetForSize(e,t,o,n){const i={name:t,type:e.type,bucket:e.bucket,mimetype:e.mimetype,usedInNodes:n,usedInClasses:e.usedInClasses,path:e.path,id:e.id,size:o,parentFolderId:e.parentFolderId,skipOptimisations:e.skipOptimisations};return new Gr.G(i)}computeImageUrl(e){const t=e.size||this.computeAssetSize(e);return(0,ni.zo)(e,`&${t}`,this.shouldApplyAdvancedOptimisationsToAsset(e))}computeAssetSize(e){let t=100,o=100;if(!Object.keys(e.usedInNodes).length)return`w=${t}`;Object.keys(e.usedInNodes).forEach((e=>{const n=this.projectDoc.estimateNodeDimensionInPxByStyle("width",e),i=this.projectDoc.estimateNodeDimensionInPxByStyle("height",e);t=n>t?n:t,o=i>o?i:o}));const n=$r.ou.I1;return o=Math.ceil(o/n)*n,t=Math.ceil(t/n)*n,t>o?`w=${t}`:`h=${o}`}async getAssetData(e,t){const o=this.computeImageUrl(e);let n=[];e.folderPath&&"/"!==e.folderPath&&(n=e.folderPath.slice(0,-1).split("/"));const i=this.shouldApplyAdvancedOptimisationsToAsset(e)?this.changeAssetExtensionToWebP(e.name):e.name;if(t.skipDownload)return{content:o,name:i,location:"remote",path:n};try{const t=await fetch(o,{headers:{accept:Br.un}});if(e.type===Mt.K.EDITABLE_FILE){const e=await t.arrayBuffer();return{name:i,content:(new TextDecoder).decode(e),contentEncoding:"utf8",path:n}}const r=await t.blob();return{name:i,content:await this.blobToBase64(r),contentEncoding:"base64",path:n}}catch(r){r.message=`Asset ${e.name} failed to download: ${r.message}`,this.sentryService.captureException(new Error(`Get asset data: ${r.message}`))}}changeAssetExtensionToWebP(e){const t=e.split("."),o=t.pop();if(!Br.n1.includes(o||"")||Br.QH.includes(o||""))return e;return`${t.join(".")}.webp`}async blobToBase64(e){return new Promise(((t,o)=>{const n=new FileReader;n.readAsDataURL(e),n.onerror=o,n.onloadend=()=>{const e=n.result;if(!e)return t("");if("string"===typeof e||e instanceof String)return t(e.split(",")[1]);const o=new TextDecoder("base64").decode(e);t(o)}}))}nameIsValid(e){const t=e.split("."),o=`.${t.pop()}`,n=t.join("");if(n.length<1){return{isValid:!1,error:`Asset name must be between 1 and 100 characters (you have ${n.length}).`}}if(n.length+o.length>100){return{isValid:!1,error:`Asset name must be between 1 and 100 characters (you have ${n.length+o.length}).`}}return e.match(Hr.qg)?{isValid:!1,error:"Asset name cannot contain * : \" '  | < > ? / ` ( )"}:{isValid:!0}}shouldApplyAdvancedOptimisationsToAsset(e){var t;return(null===(t=this.projectDoc.settings.experimentalFeatures)||void 0===t?void 0:t[_r.QR.ADVANCED_IMAGE_OPTIMISATIONS])&&!e.skipOptimisations&&e.type===Mt.K.IMAGE}},Zr=(0,s.Z)(Rr.prototype,"projectDoc",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lr=(0,s.Z)(Rr.prototype,"sentryService",[kr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ur=Rr));var Yr=o(523689),Vr=o(890810);function Wr(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Kr(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Wr(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Wr(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function qr(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Jr(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?qr(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):qr(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Xr=(e,t)=>{let o=e;return t&&!ci.includes(t)&&(o=o.replaceAll("`","\\`").replaceAll("$","\\$")),t&&ci.includes(t)&&(o=o.replaceAll('"',"'")),o};function Qr(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function es(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Qr(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Qr(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function ts(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function os(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ts(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ts(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function ns(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function is(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ns(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ns(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const rs=e=>{const t=null===e||void 0===e?void 0:e.address,o=null===e||void 0===e?void 0:e.lat,n=null===e||void 0===e?void 0:e.lng,i=null===e||void 0===e?void 0:e.src;if(t){if("static"===t.type)return{src:{type:"static",content:`https://www.google.com/maps?q=${t.content}&output=embed`}};const e=ss(t);if(e)return{src:{type:"expr",content:`\`https://www.google.com/maps?q=\${${e}}&output=embed\``}}}if(o&&n){if("static"===o.type&&"static"===n.type)return{src:{type:"static",content:`https://www.google.com/maps?q=@${o.content},${n.content}&output=embed`}};const e=ss(o),t=ss(n);if(e&&t)return{src:{type:"expr",content:`\`https://www.google.com/maps?q=@\${${e}},\${${t}}&output=embed\``}}}return i?{src:i}:void 0},ss=e=>"dynamic"===e.type&&"prop"===e.content.referenceType?`props['${e.content.id}']`:"expr"===e.type?e.content:void 0;function as(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function cs(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?as(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):as(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const ls=e=>{var t,o,n,i,r,s,a,c;const{node:l,projectDoc:d,projectType:p,assetSrcMapping:u,stateDefinitions:h,defaultElementStyles:m,propDefinitions:y,useDefaultProps:g,experimentalFeatures:f,cmsIdentifiersByCtxId:b={},domainElementNodeToUIDL:I}=e,{semanticType:v,primitiveType:w,name:N}=l;let j;"HTML"===p&&"renderingConditions"in l&&"dynamic"===(null===(t=l.renderingConditions)||void 0===t?void 0:t.reference.type)&&"state"===(null===(o=l.renderingConditions)||void 0===o?void 0:o.reference.content.referenceType)&&(l.renderingConditions=null);const S=yr({node:l,propDefinitions:y,stateDefinitions:h,projectDoc:d,defaultElementStyles:m,assetSrcMapping:u,cmsIdentifiersByCtxId:b}),D=(0,ni.dE)(N||"");if(w===Zn.sO.DEV_COMPONENT&&"devComponentPath"in l&&"preview-root-node"!==l.type)return ps(l,D);const T=d.nodes.getById(null!==(n=l.parentId)&&void 0!==n?n:""),O="fragment"===(null===T||void 0===T?void 0:T.primitiveType)&&null!==(i=T.meta)&&void 0!==i&&i.isAttributeRoot?l:d.nodes.getById(d.getOwnerIdOfDependentNode(l.id))||l,F="styles"in O?O.styles:{},C=us({node:l,propDefinitions:y,stateDefinitions:h,experimentalFeatures:f,assetSrcMapping:u,useDefaultProps:g,cmsIdentifiersByCtxId:b,projectDoc:d,projectType:p,domainElementNodeToUIDL:I}),E=gs(d,l,y,h,g,b),x="events"in l?hs(l.events,y,h):void 0,_="abilities"in l?ms(l,d,y,g,b):void 0,M=d.nodes.getById(null!==(r=l.parentId)&&void 0!==r?r:""),P="fragment"===(null===M||void 0===M?void 0:M.primitiveType)&&"meta"in M&&((null===M||void 0===M||null===(s=M.meta)||void 0===s?void 0:s.isAttributeRoot)||(null===(a=M.meta)||void 0===a?void 0:a.isPropRoot)),A="fragment"===(null===M||void 0===M?void 0:M.primitiveType)&&"meta"in M&&(null===(c=M.meta)||void 0===c?void 0:c.isAttributeRoot);if(j=cs(cs(cs(cs({elementType:w},w===Zn.sO.COMPONENT&&{dependency:{type:"local"}}),{},{semanticType:"fragment"===v?"HTML"===p||"UIDL"===p?"fragment":void 0:A?"span":v||void 0},N&&(null===N||void 0===N?void 0:N.length)>0&&{name:D}),{},{referencedStyles:S,abilities:_,attrs:C},Object.keys(F||{}).length>0&&{style:(0,sr.q)(F,u,d)}),{},{children:E,events:x}),P&&"UIDL"!==p){var k;var U,R;if(!Object.keys((null===(k=j)||void 0===k?void 0:k.style)||{}).some((e=>"display"===e)))j.style=cs(cs({},null!==(U=null===(R=j)||void 0===R?void 0:R.style)&&void 0!==U?U:{}),{},{display:{type:"static",content:"inline-block"}})}if(d.nodes.nodeIsCompInstance(l))return j=cs(cs({},j),{},{semanticType:(0,ni.dE)(ds(l.compIdOfCompInstance,d.components))}),j;if(w===Zn.sO.CMS_RICHTEXT){if(!("cmsType"in l))throw new Error(`CMS type is missing for CMS_RICHTEXT node - ${l.id}`);return((e,t,o,n,i)=>{if(!e.cmsType)throw new Error(`CMS type is not defined on richtext node - ${e.id}`);const r={type:"element",content:tr.Instance.generateUIDLForCMSRichText(e,t,o,n,i)};return os(os({},t),{},{elementType:"container",semanticType:"div",children:[r]})})(l,j,b,y,h)}return w===Zn.sO.HTML_NODE&&"html"in l?((e,t,o)=>{var n;const i=null===(n=e.html)||void 0===n?void 0:n.content,r=Xr((null===i||void 0===i?void 0:i.toString())||"",t),s="string"!==typeof i&&i instanceof nr.P;return Jr(Jr({},o),{},{semanticType:void 0,children:[],attrs:Jr(Jr({},o.attrs),{},{html:{type:"raw",content:r,fallback:s?i.content.fallbackValue:void 0}})})})(l,p,j):w===Zn.sO.LOTTIE?((e,t)=>{let o=e.attrs||{};const n=Kr(Kr({},e),{},{semanticType:"UIDL"===t?e.semanticType:void 0,children:[],attrs:Kr({},o)});if(t===xn.o.NEXT){const t=Object.keys(o).reduce(((e,t)=>(li.includes(t)||(e[t]=o[t],delete o[t]),e)),{});return n.style={},n.referencedStyles={},Kr(Kr({},e),{},{attrs:t,elementType:"div",semanticType:"div",children:[{type:"element",content:n}]})}return t!==xn.o.VUE&&t!==xn.o.NUXT||(o=Object.keys(o).reduce(((e,t)=>{if(li.includes(t)){let n=o[t].content;"src"===t&&(n=`\`${n}\``),"background"===t&&(t="backgroundColor"),e[t]={type:"dynamic",content:{referenceType:"local",id:""===n?"true":n}}}else e[t]=o[t];return e}),{}),n.attrs=o),n})(j,p):w===Zn.sO.DATE_TIME&&"format"in l?((e,t)=>es(es({},t),{},{semanticType:Zn.RY.SPAN,children:[{type:"element",content:{elementType:"date-time-node",attrs:{format:{type:"static",content:e.format},date:es({},t.children[0])}}}]}))(l,j):w===Zn.sO.GOOGLE_MAPS&&"element-node"===l.type?(e=>{const{defaultElement:t}=e,o=rs(t.attrs);return is(is({},t),{},{children:[],attrs:is(is({},t.attrs),o)})})({defaultElement:j}):j},ds=(e,t)=>{const o=Object.values(t.byId||{}).find((t=>(null===t||void 0===t?void 0:t.id)===e));if(!o)throw new Error(`Component that the node is referring to is missing - ${e}`);return o.title},ps=(e,t)=>{const{attrs:o,devComponentPath:n}=e;if(!n)throw new Error(`Path for dev-component is missing - ${e.id}`);const i=(0,kn.parse)(n);return cs(cs({elementType:Zn.sO.COMPONENT,semanticType:e.name},t.length>0&&{name:t}),{},{dependency:{type:"library",version:"0.0.0",path:(0,kn.relative)("teleport-project-react/src/pages/index.tsx",`${i.dir}/${i.name}`)},attrs:Object.keys(o).reduce(((e,t)=>{if(!t.length)return e;const n=o[t];if(!("toUIDL"in n))return e;const i=n.toUIDL();return i?(e[t]=i,e):e}),{})})},us=e=>{var t;const{node:o,propDefinitions:n,stateDefinitions:i,experimentalFeatures:r,cmsIdentifiersByCtxId:s={},assetSrcMapping:a,useDefaultProps:c,projectDoc:l,projectType:d,domainElementNodeToUIDL:p}=e,{primitiveType:u}=o;let h="attrs"in o&&null!==(t=o.attrs)&&void 0!==t?t:{};if("compIdOfCompInstance"in o&&"component"===o.primitiveType){const e=l.components.byId[o.compIdOfCompInstance];if(!e)throw new Error(`Component data is missing for component instance - ${o.id}`);h=Object.keys(h).reduce(((t,o)=>{const n=h[o];if(!n)return t;if("hierarchy"!==n.type)return t[o]=n,t;const i=Object.values(e.propDefinitions).find((e=>e.name===o));return i?(Object.keys(i.locations).length&&(t[o]=n),t):t}),{})}return(0,Rn.g4)({attrs:h,projectDoc:l,propDefinitions:n,stateDefinitions:i,useDefaultProps:c,cmsIdentifiersByCtxId:s,projectType:d,customAttrParser:e=>{if(!u)return{parsedAttr:e};const t={};if(-1!==[Zn.sO.IMAGE,Zn.sO.VIDEO,Zn.sO.COMPONENT].indexOf(u)&&(null===a||void 0===a||a.forEach((o=>{if(e&&"string"===typeof e.content&&-1!==e.content.indexOf(o.id)&&(e.content=o.localPath,u===Zn.sO.IMAGE&&null!==r&&void 0!==r&&r[_r.QR.ADVANCED_IMAGE_OPTIMISATIONS]&&o.optimised)){const{name:e,ext:n}=(0,kn.parse)(o.localPath),i=e.split("-"),r=parseInt(i.pop()||""),s=i.join("-"),a=o.folderPath&&"/"!==o.folderPath?`/${o.folderPath}`:"/";if(r>500){const e=r>zr?`${a.length>1?a:""}${o.localPath} 1200w, ${a}${s}-tablet${n} 800w, ${a}${s}-mobile${n} 480w`:`${a.length>1?a:""}${o.localPath} 800w, ${a}${s}-mobile${n} 480w`,i=r>zr?"(min-width: 992px) 1200px, (min-width: 768px) 800px, 480px":"(min-width: 768px) 800px, 480px";t.srcset={type:"static",content:e},t.sizes={type:"static",content:i}}}}))),u===Zn.sO.COMPONENT&&"hierarchy"===e.type){const t=l.nodes.getById(e.content);if(!t)throw new Error(`Could not find node with id ${e.content}`);const a=l.getComponentIdForNode(o.id);if(!a)throw new Error(`Could not find component id for node with id ${o.id}`);const u=l.getProjectPageOrComponent(a);if(!u)throw new Error(`Could not find component with id ${o.id}`);e.type="element",e.content=p({nodeId:t.id,doc:l,propDefinitions:n,stateDefinitions:i,defaultElementStyles:{},options:{skipDevModeWidgets:!1},projectType:d,useDefaultProps:c,experimentalFeatures:r,component:u,cmsData:{cmsIdentifiersByCtxId:s}}).nodeHierarchy.content}return{parsedAttr:e,extraGeneratedAttrs:t}}})},hs=(e,t,o)=>Object.keys(e||{}).length>0?cs({},Object.keys(e||{}).reduce(((n,i)=>{const r=Object.values(e[i]);if(!r)return n;const s=r.map((e=>{switch(e.type){case"propCall":return{calls:e.calls,type:e.type,args:e.args,includeEventObject:e.includeEventObject};case"stateChange":const n=e.newState;let i;if("object"===typeof n){const e=n,r=e.content.referenceType;let s;s="prop"===r?(0,Rn.bC)(t,e.content.id):"state"===r?(0,Rn.bC)(o,e.content.id):e.content.id,i=new nr.P({id:s,content:{referenceType:e.content.referenceType,id:s}}).toUIDL()}else i=n;return{modifies:e.modifies,type:e.type,newState:i,includeEventObject:e.includeEventObject}}}));return s&&(n[i]=s),n}),{})):void 0,ms=(e,t,o,n,i={})=>{if(!("abilities"in e))return{};const{abilities:r}=e;return Object.keys(r).reduce(((s,a)=>{var c,l;const d=JSON.parse(JSON.stringify(r[a]));switch(d.type){case $r.RZ.CMS_NAVIGATION_BUTTON:let f=t.nodes.getById(e.parentId||"");for(;(null===(p=f)||void 0===p?void 0:p.primitiveType)!==Zn.sO.CMS_COLLECTION_LIST;){var p,u;f=t.nodes.getById((null===(u=f)||void 0===u?void 0:u.parentId)||"")}if(!f)throw new Error(`Did not find CMS list parent for CMS navigation button. Node: ${e.id}`);const b=null===(c=f.attrs)||void 0===c?void 0:c.paginationQuery,I=d.content.type.includes("next");if(d.content.type.includes("list-page")){const e=t.cmsPages.byId[d.content.pageOrCompId],o="?${new URLSearchParams({...(router?.query || {})})}";s[a]={type:"navlink",content:{routeName:{type:"expr",content:`\`/${(null===e||void 0===e?void 0:e.getStaticUrl())||(null===e||void 0===e?void 0:e.generateStaticUrl(t.cms.usedContentTypes))}/page/\${props?.pagination?.page ? parseInt(props?.pagination?.page) ${I?"+":"-"} 1 : ${I?"2":"1"}}${o}\``}}};break}let v;if("static"===(null===b||void 0===b?void 0:b.type))v=`'${b.content.toString()}'`;else if("prop"===(null===b||void 0===b?void 0:b.content).referenceType){const t=Object.keys(o).find((e=>o[e].id===(null===b||void 0===b?void 0:b.content).id));if(!t)throw new Error(`CMS Navigation button has a prop type reference but no prop found! Id: ${e.id}`);v=`${(null===b||void 0===b?void 0:b.content).referenceType}s.${t}`}else{if("ctx"!==(null===b||void 0===b?void 0:b.content).referenceType)throw new Error(`Only prop type dynamic pagination parameters are currently supported: ${e.id}`);{const{refPath:e=[],refPathPrefix:t=[],ctxId:o}=null===b||void 0===b?void 0:b.content;v=(0,Rn.SK)([...t,...e],[i[o||""]||""])}}s[a]={type:"navlink",content:{routeName:{type:"expr",content:`\`?\${new URLSearchParams({...router.query, [${v}]: parseInt(router.query[${v}]) ${I?"+":"-"} 1 || ${I?"2":"1"}})}\``}}};break;case $r.RZ.CMS_DETAILS_NAVLINK:const w=t.cmsPages.getOrderedDetailsPagesByPageName().find((e=>e.contentType===d.content.contentType));if(!w)throw new Error(`Could not find a CMS Details page for the content type ${d.content.contentType}`);const N=w.settings.staticUrl||new Yr.F({content:w.generateStaticUrl(t.cms.usedContentTypes)}),j=w.cmsDetailsPageAttributeDifferentiator;if(!j||!N)throw new Error(`The CMS Details page ${w.title} does not have a differentiator or a static part`);const S=j.content;if("prop"!==S.referenceType)throw new Error(`The CMS Details page ${w.title} does not have a differentiator that is a ctx reference`);if(2!==(null===(l=S.refPath)||void 0===l?void 0:l.length))throw new Error(`The CMS Details page ${w.title} does not have a refPath for the context reference`);let D=t.nodes.getById(e.parentId||e.compInstanceId||""),T=null;for(;D&&!T;){var h,m,y;if("resourceDefinition"in D&&("external-cms-item"===(null===(h=D.resourceDefinition)||void 0===h?void 0:h.type)||"external-cms-list"===(null===(m=D.resourceDefinition)||void 0===m?void 0:m.type))&&(null===(y=D.resourceDefinition)||void 0===y?void 0:y.contentType)===d.content.contentType){if("ctxId"in D){T=D.ctxId;continue}if("repeatableCtxId"in D){T=D.repeatableCtxId;continue}}if("cms-array-mapper"!==D.type&&"cms-mixed-type-node"!==D.type)if(t.nodes.getById(D.parentId||e.compInstanceId||""))D=t.nodes.getById(D.parentId||e.compInstanceId||"");else{if(!D.compIdOfRootNode)throw new Error(`The CMS Details Link ${w.title} reached a dead end when looking for the context provider of node ${D.id}`);const e=t.components.byId[D.compIdOfRootNode];if(!e)throw new Error(`The CMS Details Link reached a dead end looking for a component that does not exist ${D.compIdOfRootNode}`);const[o]=Object.keys(e.instantiatedByNodes);if(!o)throw new Error(`The CMS Details Link reached a dead end looking for a component that does not have any instantiations ${D.compIdOfRootNode}`);D=t.nodes.getById(o)}else T=D.ctxId}if(!T)break;const O=N.content.toString().startsWith("/")?N.content.toString().slice(1):N.content,F=(0,Rn.SK)(S.refPath.slice(1),[i[T||""]||""]);s[a]={type:"navlink",content:{routeName:{type:"expr",content:`\`/${O}/\${${F}}\``}}};break;case $r.RZ.NAVLINK:s[a]=r[a].toUIDL(t);break;case $r.RZ.SECTION:const C=d.content;if("string"===typeof C.section){s[a]=d;break}switch(C.section.content.referenceType){case"ctx":{const{section:{content:{refPath:e=[],refPathPrefix:t=[],ctxId:o}}}=C;e.length>0&&(s[a]={type:"section",content:{section:{type:"expr",content:(0,Rn.SK)([...t,...e],[i[o||""]||""])}}});break}}break;case $r.RZ.URL:const E=d.content;if("string"===typeof E.url){s[a]={type:"url",content:{url:{type:"static",content:E.url},newTab:!(null===E||void 0===E||!E.newTab)}};break}switch(E.url.content.referenceType){case"ctx":{const{url:{content:{refPath:o=[],refPathPrefix:n=[]}}}=E,r=ys(e.id,E.url,t,i);o.length>0&&(s[a]={type:"url",content:{url:{type:"expr",content:(0,Rn.SK)([...n,...o],r,E.url.content.fallbackValue)},newTab:!(null===E||void 0===E||!E.newTab)}});break}case"prop":{var g;const e=(0,Rn.bC)(o,E.url.content.id),t=(null===(g=E.url.content)||void 0===g?void 0:g.refPath)||[];if(n&&e){let n=o[e].defaultValue;for(const e of t)n=n[e]||n;s[a]={type:"url",content:{url:{type:"static",content:n},newTab:!(null===E||void 0===E||!E.newTab)}};break}if(!e)break;E.url.content.id=e,s[a]=d}}break;case $r.RZ.PHONE:const x=d.content;if("string"===typeof x.phone){s[a]=d;break}const _=(0,Rn.bC)(o,x.phone.content.id);if(n&&_){const e={phone:o[_].defaultValue};d.content=e,s[a]=d;break}x.phone.content.id=_,s[a]=d;break;case $r.RZ.MAIL:const M=d.content,{mail:P,subject:A}=M;if("string"===typeof P&&"string"===typeof A){s[a]=d;break}if("string"!==typeof P){const e=(0,Rn.bC)(o,M.mail.content.id);n&&e?d.content.mail=o[e].defaultValue:M.mail.content.id=e}else d.content.mail=P;if(A&&"string"!==typeof A){const e=(0,Rn.bC)(o,M.subject.content.id);n&&e?d.content.subject=o[e].defaultValue:M.subject.content.id=e}else d.content.subject=A||"";s[a]=d;break;default:s[a]=d}return s}),{})},ys=(e,t,o,n)=>{const i=((e,t)=>t.nodes.getAncestors({nodeId:e}).map((e=>t.nodes.getById(e))).find((e=>!(!e||!("listCtxId"in e))||!(!e||!("ctxId"in e))||void 0)))(e,o);var r,s,a;if("repeater"===(null===i||void 0===i?void 0:i.type))return[null!==(r=null===(s=i.attrs)||void 0===s||null===(a=s.contextName)||void 0===a?void 0:a.content.toString())&&void 0!==r?r:"item"];const c=o.cmsPages.getOrderedListingPagesByPageName().map((e=>e.mainNodeId)),l=i&&c.includes(i.id),{isReferencingMeta:d}=o.nodes.getAncestors({nodeId:e}).reduce(((e,n)=>{const i=o.nodes.getById(n);return i&&"cms-array-mapper"!==i.type&&"listCtxId"in i&&t.content.ctxId===i.listCtxId&&(e.isReferencingMeta=!0),e}),{isReferencingMeta:!1}),{ctxId:p}=t.content;return d?l?["props"]:["params?.meta"]:[(null===n||void 0===n?void 0:n[p||""])||""]},gs=(e,t,o,n,i,r)=>{if(!("contentChildren"in t)||!t.contentChildren)return[];const{contentChildren:s}=t;return Object.keys(s||{}).reduce(((a,c)=>{var l,d,p;const u=s[c];if("static"===u.type&&u.content&&u.content.toString().length>0){const t="string"===typeof u.content?u.content.replace(Vr.$m,""):u.content;if("string"!==typeof t&&"number"!==typeof t)throw new Error("The value was not a string or number. This case is not supported yet and might require a re-write of the rendering system.");if(a.push({type:"static",content:t}),"string"===typeof t&&" "===t[t.length-1]){e.internationalization.enabled||a.push({type:"raw",content:" "})}}if("dynamic"===u.type&&"ctx"===u.content.referenceType){const{refPath:o=[],refPathPrefix:n=[]}=u.content,i=ys(t.id,u,e,r),s=(0,Rn.SK)([...n,...o],i,u.content.fallbackValue);a.push({type:"expr",content:s})}else if("dynamic"===u.type){const r={referenceType:u.content.referenceType,defaultValue:u.content.defaultValue};switch(u.content.referenceType){case"prop":var h;if(r.id=(0,Rn.bC)(o,u.content.id),null!==(l=u.content)&&void 0!==l&&l.refPath)Object.assign(r,{refPath:null===(h=u.content)||void 0===h?void 0:h.refPath});break;case"locale":r.id=(null===(d=u.content.refPath)||void 0===d?void 0:d.join("_thq_"))||"";break;case"state":var m;if(r.id=(0,Rn.bC)(n,u.content.id),null!==(p=u.content)&&void 0!==p&&p.refPath)Object.assign(r,{refPath:null===(m=u.content)||void 0===m?void 0:m.refPath});break;case"global":r.referenceType="global";const e=(0,Rn.OP)(u);if(r.id=null===e||void 0===e?void 0:e.content,null!==e&&void 0!==e&&e.refPath){const t=e.refPath,o=t.filter(((e,o)=>t.indexOf(e)===o));Object.assign(r,{refPath:o})}}const s=r.id;if(!s){const o=e.components.byId[e.getComponentIdForNode(t.id)||""];return Mr.sentryService.captureException(new Error(`Found missing prop for content id ${s} on node id ${t.id} in component with name ${null===o||void 0===o?void 0:o.title}, id ${null===o||void 0===o?void 0:o.id}`)),a}if(i&&s)switch(u.content.referenceType){case"prop":if(void 0===o[s].defaultValue)throw new Error(`The prop ${s} does not have a default value`);a.push({type:"static",content:o[s].defaultValue});break;case"state":if(void 0===n[s].defaultValue)throw new Error(`The state ${s} does not have a default value`);a.push({type:"static",content:n[s].defaultValue.toString()});break;case"ctx":a.push({type:"static",content:"text"});break;case"locale":case"global":a.push({type:"dynamic",content:cs({},r)})}else a.push({type:"dynamic",content:cs({},r)})}return a}),[])};function fs(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function bs(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?fs(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):fs(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function Is(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function vs(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Is(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Is(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const ws=e=>{const{nodeParams:t,domainNode:o,cmsIdentifiersByCtxId:n,usedComponents:i,repeaterNodeIdentifier:r,domainElementNodeToUIDL:s}=e,a=vs(vs({},t),{},{cmsData:vs(vs({},t.cmsData),{},{cmsIdentifiersByCtxId:n,repeaterNodeIdentifier:r})}),c=s(vs(vs({},a),{},{nodeId:o.stateNodeRoots.success,usedComponents:i})),l=s(vs(vs({},a),{},{nodeId:o.stateNodeRoots.loading,usedComponents:i})),d=s(vs(vs({},a),{},{nodeId:o.stateNodeRoots.error,usedComponents:i}));return{cmsNodes:{success:c.nodeHierarchy,loading:l.nodeHierarchy,error:d.nodeHierarchy},codeSnippets:[...c.codeSnippets,...l.codeSnippets,...d.codeSnippets],importDefinitions:vs(vs(vs({},c.pageImportDefinitions),l.pageImportDefinitions),d.pageImportDefinitions)}};function Ns(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function js(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ns(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ns(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Ss=e=>{var t,o,n;const{nodeId:i,doc:r,propDefinitions:s,stateDefinitions:a,cmsData:c={cmsIdentifiersByCtxId:{}},defaultElementStyles:l,assetSrcMapping:d,options:p,projectType:u,usedComponents:h,useDefaultProps:m,component:y,experimentalFeatures:g}=e,{skipDevModeWidgets:f}=p,b=r.nodes.getById(i);if(!b)throw new Error(`Could not find node with id "${i}" in the document for the domainElementNodeToUIDL operation`);const I=[];let v={};"customCodeSnippet"in b&&b.primitiveType&&I.push(b.customCodeSnippet),"cms-html-node"===b.type&&"caisy.io"===b.cmsType&&(v.CaisyDocumentLink={type:"package",path:"@teleporthq/react-components",version:"latest",meta:{namedImport:!0,importAlias:"@teleporthq/react-components"}});const w=[];if("childrenIds"in b){const e=Object.keys(b.childrenIds).filter((e=>r.nodeCanBeMappedToUIDL(e)));w.push(...r.nodes.orderChildrenIds(e))}if("devComponentPath"in b&&b.devComponentPath&&f)return{nodeHierarchy:{type:"element",content:{elementType:"container",children:[{type:"static",content:`Placeholder for widget ${(0,rr.parse)(b.devComponentPath).name}`}]}},codeSnippets:I,pageImportDefinitions:v};if("compIdOfCompInstance"in b&&b.primitiveType===Zn.sO.COMPONENT){h&&!h.includes(b.compIdOfCompInstance)&&h.push(b.compIdOfCompInstance);const e=r.getSlotNodesForComp(b.compIdOfCompInstance);if(e.length>1)throw new Error(`Multiple slots in a component is not yet supported! Node: ${b.id}`);e.length&&"slottedNodes"in b&&w.push(...r.nodes.orderChildrenIds(Object.keys(b.slottedNodes[e[0].id]||{})))}const N=r.internationalization.enabled,j=w.map((t=>{const o=r.nodes.getById(t);if((null===o||void 0===o?void 0:o.primitiveType)===Zn.sO.SLOT)return Ds();const{nodeHierarchy:n,codeSnippets:i,pageImportDefinitions:s}=Ss(js(js({},e),{},{nodeId:t,usedComponents:h,useDefaultProps:m,component:y,experimentalFeatures:g}));return I.push(...i),v=js(js({},v),s),N&&"element"===n.type&&"br"===n.content.semanticType&&(n.content.selfClosing=!0),n}));if("cms-array-mapper"===b.type){var S,D,T,O,F,C,E,x,_,M,P,A,k,U,R;const t=js({},c.cmsIdentifiersByCtxId),o=(null===(S=b.attrs)||void 0===S||null===(D=S.contextName)||void 0===D?void 0:D.content.toString())||"";t[b.ctxId]=o,t[b.repeatableCtxId]=o,t[b.listCtxId]=o;const n=Ss(js(js({},e),{},{cmsData:js(js({},e.cmsData),{},{cmsIdentifiersByCtxId:t}),usedComponents:h,nodeId:b.stateNodeRoots.list})),i=Ss(js(js({},e),{},{cmsData:js(js({},e.cmsData),{},{cmsIdentifiersByCtxId:t}),usedComponents:h,nodeId:b.stateNodeRoots.empty})),{type:l}=(null===(T=b.attrs)||void 0===T?void 0:T.array)||{};if("hierarchy"===l)throw new Error(`Hierarchy node found on array mapper, which should not be possible. Node: ${b.id}`);const p=null===(O=b.attrs)||void 0===O||null===(F=O.start)||void 0===F?void 0:F.content,u=null===(C=b.attrs)||void 0===C||null===(E=C.end)||void 0===E?void 0:E.content,m=p||u?`?.slice(${parseInt(p||"0")}${u?`,${parseInt(u)}`:""})`:"",y="dynamic"===l?null===(x=(0,Rn.qp)(null===(_=b.attrs)||void 0===_?void 0:_.array,(null===e||void 0===e||null===(M=e.cmsData)||void 0===M?void 0:M.cmsIdentifiersByCtxId)||{},s,a,"[]",m))||void 0===x?void 0:x.content:JSON.stringify(null!==(P=null===(A=b.attrs)||void 0===A||null===(k=A.array)||void 0===k?void 0:k.content)&&void 0!==P?P:[]),g=r.nodes.getById(b.stateNodeRoots.list);return{nodeHierarchy:br({states:{list:n.nodeHierarchy,empty:i.nodeHierarchy},source:y,cmsIdentifier:(null===(U=b.attrs)||void 0===U||null===(R=U.contextName)||void 0===R?void 0:R.content.toString())||"",projectDoc:r,node:g,assetSrcMapping:null===d||void 0===d?void 0:d[g.id],propDefinitions:s,stateDefinitions:a}),codeSnippets:[...n.codeSnippets,...i.codeSnippets],pageImportDefinitions:js(js({},n.pageImportDefinitions),i.pageImportDefinitions)}}if("repeater"===b.type){var Z,L,$,B,G;const{type:e}=(null===(Z=b.attrs)||void 0===Z?void 0:Z.array)||{};if("dynamic"!==e)throw new Error(`Only dynamic array mapping is supported. Node: ${b.id}`);const t="repeater"===b.type?b:r.nodes.getById(null!==(L=b.parentId)&&void 0!==L?L:""),o=(null===t||void 0===t||null===($=t.attrs)||void 0===$||null===(B=$.contextName)||void 0===B?void 0:B.content.toString())||"item",n=(0,Rn.OP)(null===(G=b.attrs)||void 0===G?void 0:G.array);return{nodeHierarchy:{type:"element",content:{elementType:"container",semanticType:"div",children:[{type:"repeat",content:{node:{type:"element",content:{elementType:"fragment",children:j}},dataSource:{type:"dynamic",content:{id:null===n||void 0===n?void 0:n.content,referenceType:null===n||void 0===n?void 0:n.type,refPath:null===n||void 0===n?void 0:n.refPath}},meta:{useIndex:!0,iteratorName:o}}}]}},codeSnippets:I,pageImportDefinitions:v}}if("cms-collection-list-repeater-node"===b.type){var H;const t=null===(H=e.cmsData)||void 0===H?void 0:H.repeaterNodeIdentifier;if(!t)throw new Error("Attempted to generate a cms list repeater node but no cmsIdentifier was provided!");const{cmsNodes:o,codeSnippets:n,importDefinitions:i}=(e=>{const{nodeParams:t,domainNode:o,domainElementNodeToUIDL:n}=e,i=n(bs(bs({},t),{},{nodeId:o.stateNodeRoots.list})),r=n(bs(bs({},t),{},{nodeId:o.stateNodeRoots.empty}));return{cmsNodes:{list:i.nodeHierarchy,empty:r.nodeHierarchy},codeSnippets:[...i.codeSnippets,...r.codeSnippets],importDefinitions:bs(bs({},i.pageImportDefinitions),r.pageImportDefinitions)}})({nodeParams:js(js({},e),{},{usedComponents:h}),domainNode:b,domainElementNodeToUIDL:Ss});return I.push(...n),v=js(js({},v),i),{nodeHierarchy:br({states:o,cmsIdentifier:t,projectDoc:r,node:b,assetSrcMapping:null===d||void 0===d?void 0:d[b.id],wrapInContainer:!0,isCMSListRepeater:!0,propDefinitions:s,stateDefinitions:a}),codeSnippets:n,pageImportDefinitions:i}}if("cms-collection-list-node"===b.type){var z,Y;const t=(0,Rn.cx)((null===c||void 0===c||null===(z=c.cmsProps)||void 0===z||null===(Y=z[b.id])||void 0===Y?void 0:Y.name)||b.name||"remoteData"),o=js({},c.cmsIdentifiersByCtxId);o[b.listCtxId]=t,o[b.repeatableCtxId]=t;const{cmsNodes:n,codeSnippets:i,importDefinitions:r}=ws({nodeParams:e,domainNode:b,cmsIdentifiersByCtxId:o,repeaterNodeIdentifier:t,usedComponents:h,domainElementNodeToUIDL:Ss});I.push(...i),v=js(js({},v),r);const{resourceMappers:s,valuePath:a}=tr.Instance;return{nodeHierarchy:wr({component:y,cmsData:c,node:b,resourceMappers:s,valuePath:a,cmsIdentifier:t,cmsNodes:n}),codeSnippets:i,pageImportDefinitions:r}}if("cms-mixed-type-node"===b.type){var V;if(h){const e=Object.values(b.mappings).map((e=>e.componentId)).filter((e=>e));Array.from(new Set(e)).forEach((e=>{h.includes(e)||h.push(e)}))}const{nodeHierarchy:t,codeSnippets:o,pageImportDefinitions:n}=((e,t={},o,n)=>{var i;const{mappings:r}=e,s=Object.values(r).find((e=>"default"===e.type)),a=Object.values(r).find((e=>"error"===e.type)),c=Object.values(r).filter((e=>"cmsComponent"===e.type||"contentType"===e.type));let l=(0,Rn.ic)("Default Component. The provided element is not handled by any mappings."),d=(0,Rn.ic)("Error Component. Something wrong happend and you did not provide an error component.");const p=(0,Rn.ic)("Component instance not mapped to provided content");let u={};const h=[],m=e.attrs.source;if("dynamic"!==m.type)throw new Error("Source of the cms mixed type node is not dynamic");const y=(0,Rn.qp)(m,t,o.propDefinitions,o.stateDefinitions,""),g=(null===(i=o.cmsData)||void 0===i?void 0:i.cmsIdentifiersByCtxId)||{},f=[g[m.content.ctxId||""]||""];if(m.content.refPath&&(g[e.ctxId]=(0,Rn.SK)(m.content.refPath,f)),"prop"===m.content.referenceType&&null!==y&&void 0!==y&&y.content&&(g[e.ctxId]=`(${y.content})`),null!==s&&void 0!==s&&s.componentInstanceId&&o.doc.components.byId[s.componentId||""]){const{nodeHierarchy:e,pageImportDefinitions:t,codeSnippets:i}=n(Tr(Tr({},o),{},{nodeId:s.componentInstanceId}));l=e,u=Tr({},t),h.push(...i)}if(null!==a&&void 0!==a&&a.componentInstanceId&&o.doc.components.byId[a.componentId||""]){const{nodeHierarchy:e,pageImportDefinitions:t,codeSnippets:i}=n(Tr(Tr({},o),{},{nodeId:a.componentInstanceId}));d=e,u=Tr(Tr({},u),t),h.push(...i)}const b=c.reduce(((e,t)=>{if(!t.componentInstanceId||!o.doc.components.byId[t.componentId||""])return e[t.typeId]=p,e;const{nodeHierarchy:i,pageImportDefinitions:r,codeSnippets:s}=n(Tr(Tr({},o),{},{cmsData:Tr(Tr({},o.cmsData),{},{cmsIdentifiersByCtxId:g}),nodeId:t.componentInstanceId}));return e[t.typeId]=i,u=Tr(Tr({},u),r),h.push(...s),e}),{}),I=h.filter((e=>!!e&&("object"!==typeof e||Object.keys(e).length>0)));return{nodeHierarchy:{type:"cms-mixed-type",content:{elementType:"CMSMixedType",dependency:{type:"package",path:"@teleporthq/react-components",version:"latest",meta:{namedImport:!0}},attrs:{itemData:y},renderPropIdentifier:"cms_mixed_type",nodes:{fallback:l,error:d},mappings:Tr({},b)}},codeSnippets:I,pageImportDefinitions:u}})(b,null===(V=e.cmsData)||void 0===V?void 0:V.cmsIdentifiersByCtxId,js(js({},e),{},{usedComponents:h}),Ss);return I.push(...o),v=js(js({},v),n),{nodeHierarchy:t,codeSnippets:I,pageImportDefinitions:v}}if("cms-collection-item-node"===b.type){var W,K;const t=(0,Rn.cx)((null===c||void 0===c||null===(W=c.cmsProps)||void 0===W||null===(K=W[b.id])||void 0===K?void 0:K.name)||b.name||"remoteData"),o=c.cmsIdentifiersByCtxId;o[b.ctxId]=t;const{cmsNodes:n,codeSnippets:i,importDefinitions:r}=ws({nodeParams:js(js({},e),{},{usedComponents:h}),domainNode:b,cmsIdentifiersByCtxId:o,repeaterNodeIdentifier:t,usedComponents:h,domainElementNodeToUIDL:Ss});return I.push(...i),v=js(js({},v),r),{nodeHierarchy:Sr({component:y,cmsData:c,node:b,valuePath:tr.Instance.valuePath,itemValuePath:tr.Instance.itemValuePath,cmsIdentifier:t,cmsNodes:n}),codeSnippets:i,pageImportDefinitions:r}}const q=ls({node:b,propDefinitions:s,stateDefinitions:a,defaultElementStyles:l,projectDoc:r,projectType:u,assetSrcMapping:null===d||void 0===d?void 0:d[i],useDefaultProps:m,cmsIdentifiersByCtxId:null===e||void 0===e||null===(t=e.cmsData)||void 0===t?void 0:t.cmsIdentifiersByCtxId,experimentalFeatures:g,domainElementNodeToUIDL:Ss});if("renderingConditions"in b&&b.renderingConditions){var J,X;const{renderingConditions:t}=b,{value:o,condition:n}=t;let{reference:i}=t;for(const e of null!==(Q=null===n||void 0===n?void 0:n.conditions)&&void 0!==Q?Q:[]){var Q;"!="===e.operation&&(e.operation="!=="),"=="===e.operation&&(e.operation="===")}var ee,te;if("dynamic"===i.type&&"ctx"===i.content.referenceType)i=new nr.P({id:(null===e||void 0===e||null===(ee=e.cmsData)||void 0===ee?void 0:ee.cmsIdentifiersByCtxId[i.id])||i.id,content:{referenceType:"local",id:(null===e||void 0===e||null===(te=e.cmsData)||void 0===te?void 0:te.cmsIdentifiersByCtxId[i.id])||i.id,refPath:i.content.refPath}}).toUIDL();const r=i.id||i.content.id,c="prop"===i.content.referenceType?(0,Rn.bC)(s,r):(0,Rn.bC)(a,r);i.content.id=c;const l=(null===n||void 0===n||null===(J=n.conditions)||void 0===J?void 0:J.map((t=>{var o,n;if("object"===typeof t.operand){switch(t.operand.content.referenceType){case"ctx":return{operation:t.operation,operand:new nr.P({id:(null===e||void 0===e||null===(o=e.cmsData)||void 0===o?void 0:o.cmsIdentifiersByCtxId[t.operand.id])||t.operand.id,content:{referenceType:"local",id:(null===e||void 0===e||null===(n=e.cmsData)||void 0===n?void 0:n.cmsIdentifiersByCtxId[t.operand.id])||t.operand.id,refPath:t.operand.content.refPath}})};case"prop":const i=(0,Rn.bC)(s,t.operand.content.id);if(!i)throw new Error(`Prop "${t.operand.id}" not found in prop definitions`);return{operation:t.operation,operand:new nr.P({id:i,content:{referenceType:"prop",id:i,refPath:t.operand.content.refPath}}).toUIDL()};case"state":const r=(0,Rn.bC)(a,t.operand.content.id);if(!r)throw new Error(`State "${t.operand.id}" not found in state definitions`);return{operation:t.operation,operand:new nr.P({id:r,content:{referenceType:"state",id:r,refPath:t.operand.content.refPath}}).toUIDL()}}}return t})))||[];return 0===l.length&&void 0!==o&&l.push({operation:"=",operand:o}),{nodeHierarchy:{type:"conditional",content:{node:{type:"element",content:js(js({},q),{},{children:[...j,...null!==(X=q.children)&&void 0!==X?X:[]]})},reference:i,condition:{conditions:l}}},codeSnippets:I,pageImportDefinitions:v}}if("element-node"===b.type&&null!==(o=b.attrs)&&void 0!==o&&o[ir.E0]){var oe;if("static"===(null===(oe=b.attrs[ir.E0])||void 0===oe?void 0:oe.type)&&!0===JSON.parse(b.attrs[ir.E0].content||"false")){var ne;const e={type:"element",content:{elementType:"animate-on-reveal",semanticType:"animate-on-reveal",style:{},referencedStyles:{},attrs:Object.values(or.xK).reduce(((e,t)=>{var o,n;const i=null===q||void 0===q||null===(o=q.attrs)||void 0===o?void 0:o[t];return i&&"static"===i.type?(e[t]=i,null===q||void 0===q||(null===(n=q.attrs)||void 0===n||delete n[t]),e):e}),{}),children:[{type:"element",content:js(js({},q),{},{children:[...j,...null!==(ne=q.children)&&void 0!==ne?ne:[]]})}]}};return I.push({body:"https://unpkg.com/@teleporthq/react-components/dist/animate-on-reveal.umd.js"}),{nodeHierarchy:e,codeSnippets:I,pageImportDefinitions:v}}}return{nodeHierarchy:{type:"element",content:js(js({},q),{},{children:[...j,...null!==(n=q.children)&&void 0!==n?n:[]]})},codeSnippets:I,pageImportDefinitions:v}},Ds=()=>({type:"slot",content:{}});function Ts(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Os(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ts(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ts(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Fs=e=>{const{component:t,doc:o,options:n,projectType:i,cmsData:r={cmsIdentifiersByCtxId:{}},defaultElementStyles:s,assetSrcMapping:a,compTitle:c,useDefaultProps:l,experimentalFeatures:d}=e;if(!t.rootNodeId)throw new Error(`Expected a rootNodeId but did not find one for component "${t.id}"`);const p=t instanceof Un.n?(0,Rn.Dn)(t,a,(e=>Ss(Os(Os({},e),{},{doc:o}))),i,l):{},u=(0,Rn.wv)(t.stateDefinitions),{nodeHierarchy:h,codeSnippets:m,pageImportDefinitions:y}=Ss({doc:o,propDefinitions:p,stateDefinitions:u,defaultElementStyles:s,cmsData:r,assetSrcMapping:a,projectType:i,nodeId:t.rootNodeId,options:n,component:t,experimentalFeatures:d});if(!h)throw new Error(`The node hierarchy for "${t.id}" is invalid`);if("conditional"===h.type)throw new Error("Root node of the UIDL hierarchy can't be of type conditional");const g=(0,Rn.LK)(t.styleSetDefinitions||{},a);return{pageUIDL:{propDefinitions:p,stateDefinitions:u,node:h,name:c||t.title,styleSetDefinitions:g},codeSnippets:m,pageImportDefinitions:y}};var Cs=o(649182),Es=o(694829),xs=o(863111);function _s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Ms(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?_s(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):_s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Ps=e=>{const t=new n.n;t.fromJSON(Ms({},e.toJSON()));const o=t,i={},r={},s={};return Object.keys(Ms(Ms(Ms({},o.pages.byId),o.components.byId),o.cmsPages.byId)).forEach((e=>{const t=o.pages.byId[e]||o.components.byId[e]||o.cmsPages.byId[e];if(!t)return;const n=ks(o,t);if("cms-details-page"===t.type||"cms-listing-page"===t.type){const e=As(t,n.cmsProps);Object.assign(r,e)}Object.assign(i,n.projectResources),Object.assign(s,n.nodeParams)})),{projectResources:i,cmsStates:{},cmsProps:r,nodeParams:s,doc:o}},As=(e,t)=>Object.keys(t).reduce(((o,n)=>{const i=e.createPropDefinition(t[n]);return o[n]=i,o}),{}),ks=(e,t)=>{const o={},n={},i={},r={},s=e.cms.usedContentTypes;return e.nodes.bfs(t.rootNodeId,(e=>{if(e.canBeMappedToUIDL){if("cms-collection-list-node"===e.type){if(!e.resourceDefinition)throw new Error(`Resource definition not found on CMS Collection List Node: ${e.id}}`);if("uninitialised"===e.resourceDefinition.type)throw new Error(`Uninitialised resource definition found. Node: ${e.id}}`);const n=s[e.resourceDefinition.contentType];if(!n)return;if(("cms-listing-page"===t.type||"cms-details-page"===t.type)&&t.mainNodeId===e.id)return void(i[e.id]={id:(0,ni.Ox)(),name:(0,Rn.zj)(n,t.type),defaultValue:[],type:xs.l4.ARRAY});const{resource:a,paramsToSendToFetcher:c}=tr.Instance.generateResourceForCMSListNode({contentType:n,node:e,resourceName:t.title,compId:t.id});o[e.id]=a,r[e.id]=c}if("cms-collection-item-node"===e.type){if(!e.resourceDefinition)throw new Error(`Resource definition not found on CMS Collection Item Node. Node: ${e.id}`);if("uninitialised"===e.resourceDefinition.type)throw new Error(`Uninitialised resource definition found in cms collection item node: ${e.id}`);const a=s[e.resourceDefinition.contentType];if(!a)return;if(("cms-listing-page"===t.type||"cms-details-page"===t.type)&&t.mainNodeId===e.id)return void(i[e.id]={id:(0,ni.Ox)(),name:(0,Rn.zj)(a,t.type),defaultValue:[],type:xs.l4.ARRAY});const{resource:c,paramsToSendToFetcher:l}=tr.Instance.generateResourceForCMSItemNode({contentType:a,node:e,resourceName:a.name,compId:t.id})||{};c&&l&&(r[e.id]=l,o[e.id]=c,n[e.id]={id:(0,ni.Ox)(),name:`${a.name}Entity`,defaultValue:{},type:"object"})}}})),{projectResources:o,cmsStates:n,cmsProps:i,nodeParams:r}};var Us=o(616776);function Rs(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Zs(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Rs(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Rs(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Ls=async e=>{var t,i,r,s;const{title:a,slug:c,projectType:l,assetSrcMapping:d,options:p,applyForegroundTokenToFill:u}=e;let h=new n.n;h.fromJSON(JSON.parse(JSON.stringify(Zs({},e.doc.toJSON()))));let m={},y={},g={};const f=((e,t)=>{var o;const{availableLanguages:n,mainLanguage:i,translations:r,enabled:s,ignoreBrowserLanguage:a}=e.internationalization;if(!s)return;const c=e.pages.byId[null!==(o=e.pages.getHomePageId())&&void 0!==o?o:""];if(!c)return;const l={};return Object.keys(n).forEach((o=>{const n=r[o];if(!n)return;const i={};Object.keys(n).forEach((o=>{const r=n[o];if("static"===r.type)return void(i[o]={type:"static",content:r.content});const s=r.content,a=Ss({nodeId:s,doc:e,propDefinitions:{},stateDefinitions:{},defaultElementStyles:{},projectType:t,experimentalFeatures:{},options:{},component:c});i[o]=a.nodeHierarchy})),l[o]=i})),{main:{name:null===i||void 0===i?void 0:i.name,locale:null===i||void 0===i?void 0:i.short},languages:n,ignoreBrowserLanguage:a,translations:l}})(h,l),b={resources:{items:{}}},I={};if(h.cms.isEnabled){const e=Ps(h);b.resources.items=(0,Rn.qO)(e.projectResources),m=e.cmsStates,y=e.cmsProps,g=e.nodeParams,h=new n.n,h.fromJSON(e.doc.toJSON())}h=(0,Rn.PH)(h);const v=(null===p||void 0===p?void 0:p.skipDevModeWidgets)||!1,w=h.pages.getIds().filter((e=>{const t=h.pages.byId[e];return null===t||void 0===t||!t.removeFromCodeGeneration})),N=h.cmsPages.getIds().filter((e=>{const t=h.cmsPages.byId[e];return!!h.cms.usedContentTypes[(null===t||void 0===t?void 0:t.contentType)||""]})),j=h.components.getIds(),S=h.pages.getHomePageId(),D=S&&null!==(t=null===(i=h.pages.byId[S])||void 0===i?void 0:i.title)&&void 0!==t?t:"index",T={},O=l===xn.o.ANGULAR||l===xn.o.HTML?Zs(Zs({},h.settings.experimentalFeatures||{}),{},{[_r.QR.ADVANCED_IMAGE_OPTIMISATIONS]:!1}):h.settings.experimentalFeatures||{},F=Object.values(h.designLanguage.getTokensAsCustomProperties()||{}).reduce(((e,t)=>(e[t.name]={type:"static",content:t.value},e)),{}),C=(0,Rn.Wh)([...Object.values(h.pages.byId)||{},...Object.values(h.cmsPages.byId)||{}]),E={route:{type:"string",defaultValue:D,values:[...w.map((e=>Ys(a,c,e,h))),...N.map((e=>{var t,o,n;return Gs(Zs({title:a,slug:c,pageId:e,cmsProps:y,projectDoc:h,projectResources:b.resources,projectMappers:I,routesMetaData:T},"strapi"===(null===(t=h.cms.cmsConnectionData)||void 0===t?void 0:t.cmsType)&&null!==(o=h.cms)&&void 0!==o&&null!==(n=o.locales)&&void 0!==n&&n.defaultLocale?{defaultLocale:h.cms.locales.defaultLocale}:{}))})).flat()]}};if(h.cms.isEnabled&&!Object.keys(I).length){const e=tr.Instance.getResourceMappers();Object.assign(I,e)}const x=Zs(Zs({},null===b||void 0===b?void 0:b.resources),{},{resourceMappers:I,items:Object.keys(b.resources.items).reduce(((e,t)=>{const o=b.resources.items[t];return"id"in o?(e[o.id]=o,e):e}),{})}),_=(null===(r=h.cms.webhook.config)||void 0===r?void 0:r.teleport)||(null===(s=h.cms.webhook.config)||void 0===s?void 0:s.vercel);if(_){const{revalidate:e,url:t}=_;if(t){var M,P;const e=`@teleporthq/cms-mappers/${"caisy.io"===(null===(M=h.cms.cmsConnectionData)||void 0===M?void 0:M.cmsType)?"caisy":null===(P=h.cms.cmsConnectionData)||void 0===P?void 0:P.cmsType}/revalidate`;x.cache=Zs(Zs({},(null===x||void 0===x?void 0:x.cache)||{}),{},{webhook:{name:"revalidate",dependency:{type:"package",version:"latest",path:"@teleporthq/cms-mappers",meta:{namedImport:!0,importAlias:e}}}})}e&&(x.cache=Zs(Zs({},(null===x||void 0===x?void 0:x.cache)||{}),{},{revalidate:e}))}const A=[],k=j.reduce(((e,t)=>{var o;const n=h.components.byId[t];if(!n)throw new Error(`domainProjectToUIDL iterated over a componentId '${t}' that does not exist in the current project`);const i=Fs({component:n,doc:h,cmsData:{projectResources:(null===b||void 0===b||null===(o=b.resources)||void 0===o?void 0:o.items)||{},cmsStates:m,cmsProps:y,nodeParams:g,cmsIdentifiersByCtxId:{}},options:{skipDevModeWidgets:v},projectType:l,defaultElementStyles:{},assetSrcMapping:d,experimentalFeatures:O});e[n.title]=i.pageUIDL;const r=[],s=[];return i.codeSnippets.forEach((e=>{null!==e&&void 0!==e&&e.head&&r.push(null===e||void 0===e?void 0:e.head),null!==e&&void 0!==e&&e.body&&s.push(null===e||void 0===e?void 0:e.body)})),A.push({head:r,body:s}),e}),{}),U=[];if(!Object.values(h.pages.byId).some((e=>null===e||void 0===e?void 0:e.isFallbackPage))){E.route.values.push({value:"404 - Not Found",seo:{title:"404 - Not Found"},pageOptions:{fallback:!0}});const e=await o.e(52028).then(o.t.bind(o,452028,19));U.push(e.default)}[...w,...N].forEach((e=>{var t;const{pageUIDL:o,codeSnippets:n}=$s({pageId:e,projectDoc:h,cmsData:{projectResources:(null===b||void 0===b||null===(t=b.resources)||void 0===t?void 0:t.items)||{},cmsProps:y,cmsStates:m,nodeParams:g,cmsIdentifiersByCtxId:{}},options:{skipDevModeWidgets:v},defaultElementStyles:{},projectType:l,assetSrcMapping:d,experimentalFeatures:O});U.push(...o),A.push(n)}));const R={name:a,globals:Bs(a,h,e.secretKeys,p,u),internationalization:f,root:Zs(Zs({name:"App"},Object.values(F).length>0&&{designLanguage:{tokens:F}}),{},{styleSetDefinitions:Zs(Zs({},h.classes.toUIDL(d,h,e.exportUnusedClasses)),h.designLanguage.textStylesToUIDL()),stateDefinitions:E,propDefinitions:C,node:{type:"element",content:{elementType:"Router",children:U.flat()}}}),components:k,resources:x};return R.globals.customCode=(0,Rn.FW)(A,R.globals.customCode),{uidl:R,routesMetaData:T}},$s=e=>{const{pageId:t,projectDoc:o,cmsData:n,options:i,defaultElementStyles:r,projectType:s,assetSrcMapping:a,experimentalFeatures:c}=e,l=o.pages.byId[t]||o.cmsPages.byId[t];if(!l)throw new Error(`domainPageToUIDL received a pageId '${t}' that does not exist in the current project`);const{pageUIDL:d,codeSnippets:p,pageImportDefinitions:u}=Fs({component:l,doc:o,cmsData:n,options:i,projectType:s,defaultElementStyles:r,assetSrcMapping:a,experimentalFeatures:c}),h=[],m=[];p.forEach((e=>{null!==e&&void 0!==e&&e.head&&h.push(null===e||void 0===e?void 0:e.head),null!==e&&void 0!==e&&e.body&&m.push(null===e||void 0===e?void 0:e.body)}));let y=null;"cms-listing-page"!==l.type&&"cms-details-page"!==l.type||(y=l.getStaticUrl()||l.generateStaticUrl(o.cms.usedContentTypes));const g=[{type:"conditional",content:{node:d.node,value:"cms-details-page"===l.type||"cms-listing-page"===l.type?`${y}/`+l.title:l.title,reference:{type:"dynamic",content:{referenceType:"state",id:"route"}},importDefinitions:u}}];return"cms-listing-page"===l.type&&g.push({type:"conditional",content:{node:d.node,value:"cms-listing-page"===l.type?`${y}/page/`+l.title:l.title,reference:{type:"dynamic",content:{referenceType:"state",id:"route"}},importDefinitions:u}}),{pageUIDL:g,codeSnippets:{head:h,body:m}}},Bs=(e,t,o,n,i)=>{var r,s,a,c,l,d,p,u;const{settings:h}=t;let m;var y;(o.length&&(m=Zs({},Object.assign({},...null===o||void 0===o?void 0:o.filter((e=>!ai.some((t=>e.includes(t))))).map((e=>({[e]:`teleporthq.secrets.${e}`})))))),null!==(r=t.cms)&&void 0!==r&&r.cmsConnectionData)&&(m=Zs(Zs({},m),{},{[ri]:tr.Instance.provideBaseUrl(),[si]:tr.Instance.provideAccessToken(),WEBHOOK_SECRET:null!==(y=tr.Instance.provideWebhookSecret())&&void 0!==y?y:void 0}));const g={settings:{title:(null===(s=h.general)||void 0===s?void 0:s.title)||e,language:(null===(a=h.general)||void 0===a?void 0:a.language)||"en"},assets:[],env:Object.keys(m||{}).length?m:void 0,meta:[{name:"viewport",content:"width=device-width, initial-scale=1.0"},{charSet:"utf-8"},{property:"twitter:card",content:"summary_large_image"}]};if(null===n||void 0===n||!n.disableResetCSS){const e=(0,Es.w0)(t.designLanguage);g.assets.push({type:"style",attrs:{"data-tag":{type:"static",content:"reset-style-sheet"}},content:[...(0,Cs.D)().split("\n"),"html { scroll-behavior: smooth  }"].join("")},{type:"style",attrs:{"data-tag":{type:"static",content:"default-style-sheet"}},content:(0,Es.lf)(e,!1,i)})}if(g.assets.push({type:"style",path:Us.GS}),!h)return g;if(null!==(c=h.general)&&void 0!==c&&c.favicon){var f;const e=t.assets.byId[null===(f=h.general)||void 0===f?void 0:f.favicon];var b;if(e)null===(b=g.assets)||void 0===b||b.push({type:"icon",path:e.imageSrc,options:{iconType:"icon/png",iconSizes:"32x32"}})}var I,v,w;(Object.values(t.fonts.byId||{}).forEach((e=>{var o;e.isGoogleOrLegacyCustomFont()&&(null===(o=g.assets)||void 0===o||o.push(Zs({type:"font",path:(null===e||void 0===e?void 0:e.path)||""},(null===e||void 0===e?void 0:e.name)&&{attrs:{"data-tag":{type:"static",content:"font"}}})));if("custom"===e.type&&e.path&&null!==e&&void 0!==e&&e.properties){var n,i;const o=null===(n=e.path.split("/").slice(-1))||void 0===n?void 0:n[0],r=t.assets.byId[o];if(!r)return void console.error(`Font is connected to a asset with ${o} but missing in assets`);null===(i=g.assets)||void 0===i||i.push({type:"local-font",path:r.name,properties:Object.keys(e.properties).reduce(((t,o)=>(t[o]={type:"static",content:e.properties[o]},t)),{fontFamily:{type:"static",content:`"${e.name}"`}})})}})),null!==(l=h.code)&&void 0!==l&&l.googleAnalyticsId)&&(null===(I=g.assets)||void 0===I||I.push({type:"script",path:`https://www.googletagmanager.com/gtag/js?id=${h.code.googleAnalyticsId}`,options:{target:"body",async:!0}}),null===(v=g.assets)||void 0===v||v.push({type:"script",content:`window.dataLayer = window.dataLayer || [];\n        function gtag(){dataLayer.push(arguments);}\n        gtag('js', new Date());\n        gtag('config', '${h.code.googleAnalyticsId}');`,options:{target:"body"}}));null!==(d=h.code)&&void 0!==d&&d.tagManagerId&&(null===(w=g.assets)||void 0===w||w.push({type:"script",content:`(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\n        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\n        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n        })(window,document,'script','dataLayer','${h.code.tagManagerId}');`,options:{target:"body"}}));return g.customCode={},null!==(p=h.code)&&void 0!==p&&p.headTag&&(g.customCode.head=h.code.headTag),null!==(u=h.code)&&void 0!==u&&u.bodyTag&&(g.customCode.body=h.code.bodyTag),g.assets.push({type:"style",path:"https://unpkg.com/@teleporthq/teleport-custom-scripts/dist/style.css"}),g},Gs=e=>{var t,o,n,i,r,s,a;const{title:c,slug:l,pageId:d,cmsProps:p,projectDoc:u,projectResources:h,projectMappers:m,routesMetaData:y,defaultLocale:g}=e,f=u.cmsPages.byId[d],b=null===f||void 0===f?void 0:f.settings,I=u.settings;if(!f)throw new Error(`CMS Page ${d} could not be found in project ${l}`);if(!f.contentType)throw new Error(`CMS Page is not a details or list page. Page: ${f.id}`);const v=(0,Ln.KT)({page:f,usedContentTypes:u.cms.usedContentTypes});if(!v)throw new Error(`CMS Page is linked to any existing content type. Page: ${f.id}`);if(!b)return[{value:f.title}];const w=(null===(t=I.general)||void 0===t?void 0:t.title)||c,N=null!==f&&void 0!==f&&f.isHomePage?w:f.title+" - "+w,j=[{name:"description",content:Hs(b.seoDescription)||(null===(o=I.general)||void 0===o?void 0:o.description)},{property:"og:title",content:Hs(b.socialTitle)||Hs(b.seoTitle)||N},{property:"og:description",content:Hs(b.socialDescription)||(null===(n=I.social)||void 0===n?void 0:n.description)||Hs(b.seoDescription)||(null===(i=I.general)||void 0===i?void 0:i.description)}];if(b.socialImage){switch("string"===typeof b.socialImage?"string":b.socialImage.type){case"string":{var S;const e=b.socialImage,t=(null===(S=u.assets.byId[e])||void 0===S?void 0:S.remoteSrc)||e;j.push({property:"og:image",content:t});break}case"static":{var D;const e=b.socialImage.content,t=(null===(D=u.assets.byId[e])||void 0===D?void 0:D.remoteSrc)||e;j.push({property:"og:image",content:t});break}case"dynamic":b.socialImage.content&&j.push({property:"og:image",content:b.socialImage})}}null!==b&&void 0!==b&&b.seoNoIndex&&j.push({name:"robots",content:"noindex"});const T=j.filter((e=>e.content)),O={title:Hs(b.seoTitle)||N,metaTags:T},F=f.getStaticUrl()||f.generateStaticUrl(u.cms.usedContentTypes),C={value:`${F}/`+f.title,seo:O},E=zs(d,p,u,h,m,g);Object.assign(C,E);const x=null!==E&&void 0!==E&&null!==(r=E.pageOptions)&&void 0!==r&&r.dynamicRouteAttribute?(0,kn.join)("/",F,"${"+(null===(s=E.pageOptions)||void 0===s?void 0:s.dynamicRouteAttribute)+"}"):(0,kn.join)("/",F),_="wordpress"===(null===(a=u.cms.cmsConnectionData)||void 0===a?void 0:a.cmsType)&&null!==v&&void 0!==v&&v.slug?v.slug:v.uid;y[_]?y[_].push(x):y[_]=[x];const M=[C];if("cms-listing-page"===f.type){const e={value:`${F}/page/`+f.title,seo:O},t=(0,Ln.pi)(u,d),o=zs(d,p,u,h,m,g,{attribute:"page",pageSize:t||10,totalCountPath:tr.Instance.allItemsCountPath});Object.assign(e,o),M.push(e)}return M},Hs=e=>{var t;if(e)return"string"===typeof e?e:"static"===e.type?{type:"static",content:e.content}:"dynamic"===e.type&&"locale"===e.content.referenceType?{type:"dynamic",content:{referenceType:"locale",id:(null===(t=e.content.refPath)||void 0===t?void 0:t[0])||""}}:e},zs=(e,t,o,n,i,r,s)=>{var a,c,l,d;const p=o.cmsPages.byId[e];if(!p||!p.settings)return{};const u=p.settings,h=(0,Ln.KT)({page:p,usedContentTypes:o.cms.usedContentTypes});if(!h)return{};const m=t[p.mainNodeId],y=(null===s||void 0===s?void 0:s.attribute)||("cms-details-page"===p.type?[...null!==(a=null===(c=p.cmsDetailsPageAttributeDifferentiator)||void 0===c?void 0:c.content.refPath)&&void 0!==a?a:[]].pop():void 0),g="url"in u&&u.url?u.url:p.getStaticUrl()||p.generateStaticUrl(o.cms.usedContentTypes),f=!!s;if(f&&h.singleType)return{};const b=tr.Instance.generateInitialPathsForPage({pageId:e,dynamicRouteAttribute:y,forPagination:f}),I=tr.Instance.generateInitialPropsForPage({pageId:e,dynamicRouteAttribute:y,propDefinition:m,forPagination:f,defaultLocale:r}),v=(null===(l=o.cms.webhook.config)||void 0===l?void 0:l.teleport)||(null===(d=o.cms.webhook.config)||void 0===d?void 0:d.vercel),w=!(null!==v&&void 0!==v&&v.revalidate)&&(null===v||void 0===v?void 0:v.url);f&&w&&(I.consumer=Zs(Zs({},I.consumer),{},{cache:{revalidate:60}}));const N=tr.Instance.getResourceMappers();Object.assign(i,N),null!==b&&void 0!==b&&b.resourceFetcher&&(n.items=Zs(Zs({},n.items),{},{[null===b||void 0===b?void 0:b.resourceFetcher.id]:null===b||void 0===b?void 0:b.resourceFetcher})),null!==I&&void 0!==I&&I.resourceFetcher&&(n.items=Zs(Zs({},n.items),{},{[null===I||void 0===I?void 0:I.resourceFetcher.id]:null===I||void 0===I?void 0:I.resourceFetcher}));let j=g;if(y&&(j="/"===g?`/[${y}]`:`${g}/[${y}]`),"cms-listing-page"!==p.type||s||(j=`${g}/index`),"cms-listing-page"===p.type&&s&&(j=`${g}/page/[page]`),"cms-listing-page"===p.type&&!s&&y)throw new Error(`A Page can't have a index and have a dynamicRouteAttribute at the same time \n Received ${p}`);return{pageOptions:Zs(Zs(Zs(Zs({propDefinitions:(0,Rn.Dn)(p),stateDefinitions:(0,Rn.EY)(p.stateDefinitions),dynamicRouteAttribute:y},s&&{pagination:s}),{},{navLink:j.startsWith("/")?j:`/${j}`},p.isFallbackPage&&{fallback:p.isFallbackPage}),b?{initialPathsData:b.consumer}:{}),{},{initialPropsData:Zs({},I.consumer)})}},Ys=(e,t,o,n)=>{var i,r,s,a,c,l;const d=n.pages.byId[o],p=null===d||void 0===d?void 0:d.settings,u=n.settings;if(!d)throw new Error(`Page ${o} could not be found in project ${t}`);if(!p)return{value:d.title};const h=(null===(i=u.general)||void 0===i?void 0:i.title)||e,m=null!==d&&void 0!==d&&d.isHomePage?h:d.title+" - "+h,y=null!==(r=u.social)&&void 0!==r&&r.image?n.assets.byId[null===(s=u.social)||void 0===s?void 0:s.image]:void 0,g=p.socialImage?n.assets.byId[p.socialImage]:void 0,f=[{name:"description",content:Hs(p.seoDescription)||(null===(a=u.general)||void 0===a?void 0:a.description)},{property:"og:title",content:Hs(p.socialTitle)||Hs(p.seoTitle)||m},{property:"og:description",content:Hs(p.socialDescription)||(null===(c=u.social)||void 0===c?void 0:c.description)||Hs(p.seoDescription)||(null===(l=u.general)||void 0===l?void 0:l.description)},{property:"og:image",content:(null===g||void 0===g?void 0:g.remoteSrc)||(null===y||void 0===y?void 0:y.remoteSrc)}];null!==p&&void 0!==p&&p.seoNoIndex&&f.push({name:"robots",content:"noindex"});const b=f.filter((e=>e.content)),I={title:Hs(p.seoTitle)||m,metaTags:b},v={value:d.title,seo:I};return Object.assign(v,{pageOptions:Zs(Zs({stateDefinitions:(0,Rn.EY)(d.stateDefinitions),propDefinitions:(0,Rn.Dn)(d)},(null===p||void 0===p?void 0:p.url)&&{navLink:p.url}),d.isFallbackPage&&{fallback:d.isFallbackPage})}),v};var Vs=o(667917),Ws=o(369633),Ks=o(492080);var qs,Js,Xs,Qs,ea,ta,oa,na,ia,ra,sa,aa,ca,la,da,pa,ua,ha,ma,ya,ga,fa,ba,Ia,va,wa,Na,ja,Sa,Da,Ta,Oa,Fa={name:"teleport-project-react",subFolders:[],files:[{name:"package",fileType:x.Tv.JSON,content:'{\n  "name": "teleport-project-react",\n  "version": "0.0.0",\n  "scripts": {\n    "build": "vite build",\n    "preview": "vite preview",\n    "dev": "vite"\n  },\n  "devDependencies": {\n    "autoprefixer": "^9.8.6",\n    "postcss": "^8.2.15",\n    "tailwindcss": "^3.0.24",\n    "typescript": "^4.4.4",\n    "vite": "^4.1.1",\n    "vite-plugin-jspm": "^0.2.0"\n  }\n}'},{name:"vite.config",fileType:"mjs",content:'import { defineConfig } from "vite";\nimport jspmPlugin from "vite-plugin-jspm";\nimport { readFileSync } from "node:fs";\nconst config = JSON.parse(readFileSync("./teleport.config.json"));\n\nexport default defineConfig({\n  clearScreen: true,\n  build: {\n    outDir: "build",\n    polyfillModulePreload: false,\n    polyfillDynamicImport: false,\n  },\n  css: {\n    modules: {\n      scopeBehaviour: "local",\n    },\n  },\n  plugins: [\n    jspmPlugin({\n      inputMap: config.importmap,\n      downloadDeps: true,\n      resolutions: {\n        react: \'^17.0.2\',\n        \'react-dom\': \'^17.0.2\'\n      },\n      defaultProvider: \'jspm.io\'\n    })\n  ],\n});'},{name:"tsconfig",fileType:x.Tv.JSON,content:'{\n  "compilerOptions": {\n    "target": "ESNext",\n    "useDefineForClassFields": true,\n    "lib": ["DOM", "DOM.Iterable", "ESNext"],\n    "allowJs": false,\n    "skipLibCheck": false,\n    "esModuleInterop": false,\n    "allowSyntheticDefaultImports": true,\n    "strict": true,\n    "forceConsistentCasingInFileNames": true,\n    "module": "ESNext",\n    "moduleResolution": "Node",\n    "resolveJsonModule": true,\n    "isolatedModules": true,\n    "noEmit": true,\n    "jsx": "react-jsx"\n  },\n  "include": ["./src"]\n}'}]},Ca=o(239498);function Ea(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function xa(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ea(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ea(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const _a=new Date("2024-04-04");qs=(0,c.provide)("projectDownloadFlow"),Js=(0,c.inject)("projectUIState"),Xs=(0,c.inject)("globalAppState"),Qs=(0,c.inject)("projectDoc"),ea=(0,c.inject)("notificationsManagementFlow"),ta=(0,c.inject)("sentryService"),oa=(0,c.inject)("githubRepository"),na=(0,c.inject)("githubFlow"),ia=(0,c.inject)("assetsService"),ra=(0,c.inject)("assetsManagementFlow"),sa=(0,c.inject)("projectFilesFlow"),aa=(0,c.inject)("fileDownloadService"),ca=(0,c.inject)("workspacesRepository"),la=(0,c.inject)("projectInitFlow"),da=(0,h.G)(g.l.DOWNLOAD_ZIP_PROJECT),pa=(0,h.G)(g.l.EXPORT_TO_GITHUB),ua=(0,h.G)(g.l.EXPORT_TO_CODESANDBOX),qs((ma=class{constructor(){(0,i.Z)(this,"projectUIState",ya,this),(0,i.Z)(this,"globalAppState",ga,this),(0,i.Z)(this,"projectDoc",fa,this),(0,i.Z)(this,"notificationsManagementFlow",ba,this),(0,i.Z)(this,"sentryService",Ia,this),(0,i.Z)(this,"githubRepository",va,this),(0,i.Z)(this,"githubFlow",wa,this),(0,i.Z)(this,"assetsService",Na,this),(0,i.Z)(this,"assetsManagementFlow",ja,this),(0,i.Z)(this,"projectFilesFlow",Sa,this),(0,i.Z)(this,"fileDownloadService",Da,this),(0,i.Z)(this,"workspacesRepository",Ta,this),(0,i.Z)(this,"projectInitFlow",Oa,this),(0,r.Z)(this,"computeCodeViewsOrDownloadsLeft",(()=>{var e,t,o,n,i;const r=this.globalAppState.user.userData;if((0,Ca.m6)({id:null===r||void 0===r?void 0:r.id,email:null===r||void 0===r?void 0:r.email}))return Jo.E$;const s=this.projectInitFlow.getProjectLimitations();if(s.MAX_CODE_GENERATION===Jo.E$)return Jo.E$;const a=null!==(e=null===(t=this.projectUIState.workspace)||void 0===t||null===(o=t.meta)||void 0===o?void 0:o.codeGenerationCount)&&void 0!==e?e:0;return(null!==(n=s.MAX_CODE_GENERATION)&&void 0!==n?n:0)<=a?0:(null!==(i=s.MAX_CODE_GENERATION)&&void 0!==i?i:0)-a})),(0,r.Z)(this,"isOldUser",(()=>{const e=this.globalAppState.user.userData;return new Date((null===e||void 0===e?void 0:e.createdAt)||"")<=_a}))}updateProjectType(e){(0,a.mutate)(this.projectUIState,(({userPreferences:t})=>{t.projectType=e}))}updateProjectExportType(e){(0,a.mutate)(this.projectUIState,(({userPreferences:t})=>{t.projectType=xn.o.REACT,t.projectExportType=e}))}async incrementCodeViewCount(){const e=this.globalAppState.user.userData;if(!(0,Ca.m6)({id:null===e||void 0===e?void 0:e.id,email:null===e||void 0===e?void 0:e.email})){(0,a.mutate)(this.projectUIState,(e=>{e.workspace.meta.codeGenerationCount=(e.workspace.meta.codeGenerationCount||0)+1}));try{await this.workspacesRepository.incrementCodeViewOrDownloadUsage(this.projectUIState.workspace.id),y.Z.mixpanelEvent(y.Z.AnalyticsEvents.CODE_VIEW_DOWNLOAD_INCREMENT,{fromReadonlyProject:!!this.projectUIState.readonly})}catch(t){this.sentryService.captureException(`Failed to increment code view count: ${t.message}`)}}}async generateProjectCode(e){return await this.projectFilesFlow.getPackedDesignProject({projectType:e,projectCssFlavour:!0,includeAnalytics:!0})}async downloadZip(e,t){if(e!==xn.o.UIDL){(0,a.mutate)(this.projectUIState,(({projectDownload:e})=>{e.zip={status:"pending"}}));try{let o=null;const n=this.projectUIState.devMode.selectedBranch;if(this.projectUIState.userPreferences.projectExportType===p.iW.DEV&&Object.values(this.projectDoc.projectFiles.local[n].byId).length>0){const e=Object.values(this.projectDoc.assets.byId),t=await this.assetsService.downloadAssets(e,{}),n=(0,Ws.H)(),i=this.projectFilesFlow.getPackedDevProjectFromCurrentBranch();if(!i)throw new Error("Failed in generating prject from custom-code to export to Codesandbox");this.mergeProjectWithTemplateForDeplyment(this.injectLocalAssetsIntoProject(i,t)),n.setProject(i);const{success:r,payload:s}=await n.publish();r&&(o=s)}else o=await this.projectFilesFlow.getPackedDesignProject({projectType:e,publisher:x.Rl.ZIP,projectCssFlavour:!0,includeAnalytics:!0});const i=new Blob([o],{type:"application/zip"});i&&(this.fileDownloadService.promptDownload(i,`${this.projectUIState.title}-${e}.zip`.toLowerCase()),(0,a.mutate)(this.projectUIState,(({projectDownload:e})=>{e.zip={status:"success"}})),t&&t())}catch(o){(0,a.mutate)(this.projectUIState,(({projectDownload:e})=>{e.zip={status:"error"}}));const e=new Error(`Zip download failed: ${o.message}`);this.sentryService.captureException(e,{type:Xo.U.CRITICAL}),this.notificationsManagementFlow.createNotification(d.k$.ERROR,"An error occurred while downloading your zip application. Please try again later.")}}}async exportToGithub(e,t,o){const{displayNotification:n=!0,deployStagedOnly:i=!1,newDevRepository:r=!1}=t||{};if(e!==xn.o.UIDL){if((0,a.mutate)(this.projectUIState,(({projectDownload:e})=>{e.github={status:"pending"}})),i){if(!(await this.githubFlow.checkUserAccessToRepository()))return void this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Mare sure that the repository exists and you have proper permissions")}try{let l=null===t||void 0===t?void 0:t.repository;const{github:p}=this.projectDoc.stats;if(l=null!==p&&void 0!==p&&p.repositoryName&&(null===p||void 0===p?void 0:p.projectType)===e?p.repositoryName:(0,ni.dE)(`${this.projectUIState.title}-${e}`),r){if(await this.githubRepository.checkIfUserHasAccessToRepo(this.projectDoc.id,"",l))return void this.notificationsManagementFlow.createNotification(d.k$.ERROR,"A repository with the same name already exists")}const u=this.projectUIState.devMode.selectedBranch,{packedProject:h,assets:m}=await this.packProjectForGithubPublish(e,t),y=u||Ks.cY,g=this.projectDoc.projectFiles.remote[y];if(i&&!g){var s;const e=(null===t||void 0===t?void 0:t.repositoryOwner)||(null===(s=this.projectDoc.stats.github)||void 0===s?void 0:s.repositoryOwner);if(!e)throw new Error("Repository owner not found");await this.githubRepository.createBranch(this.projectDoc.id,{owner:e,repository:l,sourceBranch:Ks.cY,newBranch:y})}const{payload:f,success:b}=await this.githubRepository.deploy(this.projectDoc.id,h,xa(xa({},t),{},{repository:l,commitBranch:y}));if(b){var c;if(n)this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,`Your codebase is ready on GitHub: ${f}`,{duration:1e4}),null!==(c=this.projectDoc.stats.github)&&void 0!==c&&c.repositoryUrl||window.open(f,"_blank");(0,a.mutate)(this.projectUIState,(({projectDownload:e})=>{e.github={status:"success"}})),this.updateGithubLink({repoLink:f,repoName:l,projectType:e}),this.projectFilesFlow.transferLocalFilesToRemote({assets:m,branch:y,stagedOnly:i}),o&&o()}}catch(l){(0,a.mutate)(this.projectUIState,(({projectDownload:e})=>{e.github={status:"error"}})),this.sentryService.captureException(l,{type:Xo.U.CRITICAL}),this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not publish to GitHub. Make sure you are using a classic GitHub token and have proper credentials (repo) set on it.")}}}async exportToCodesandbox(e,t){if(e!==xn.o.UIDL){(0,a.mutate)(this.projectUIState,(({projectDownload:e})=>{e.codesandbox={status:"pending"}}));try{let o=null;if(this.projectUIState.userPreferences.projectExportType===p.iW.DEV){const e=Object.values(this.projectDoc.assets.byId),t=await this.assetsService.downloadAssets(e,{skipDownload:!0}),n=(0,Vs.A)(),i=this.projectFilesFlow.getPackedDevProjectFromCurrentBranch();n.setProject(this.mergeProjectWithTemplateForDeplyment(this.injectLocalAssetsIntoProject(i,t)));const{success:r,payload:s}=await n.publish();r&&(o=s)}else o=await this.projectFilesFlow.getPackedDesignProject({projectType:e,skipDownload:!0,publisher:x.Rl.CODESANDBOX});o&&(this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,`Your project is ready on CodeSandbox: ${o}`,{duration:1e4}),window.open(o,"_blank"),(0,a.mutate)(this.projectUIState,(({projectDownload:e})=>{e.codesandbox={status:"success"}})),t&&t())}catch(o){if((0,a.mutate)(this.projectUIState,(({projectDownload:e})=>{e.codesandbox={status:"error"}})),o instanceof An.nz)return void this.notificationsManagementFlow.createNotification(d.k$.ERROR,o.message);this.sentryService.captureException(o,{type:Xo.U.CRITICAL}),this.notificationsManagementFlow.createNotification(d.k$.ERROR,"An error occurred while publishing your application. Please try again later.")}}}async downloadProjectUIDL(){const e=await this.domainProjectToUIDL({skipDevModeWidgets:this.projectUIState.userPreferences.projectExportType!==p.iW.DEV,projectType:xn.o.UIDL}),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"});this.fileDownloadService.promptDownload(t,`${this.projectUIState.title}-uidl.json`)}async domainProjectToUIDL(e){const{assetsMapping:t,skipDevModeWidgets:o,projectType:n}=e,i=t||Object.values(this.projectDoc.assets.byId||{}).reduce(((e,t)=>(Object.keys(t.usedInNodes||{}).forEach((o=>{e[o]||(e[o]=[]),e[o].push({localPath:t.remoteSrc,id:t.id,optimised:!t.skipOptimisations,folderPath:t.folderPath})})),e)),{}),{uidl:r}=await Ls({title:this.projectUIState.title,slug:this.projectUIState.slug,doc:this.projectDoc,projectType:n,assetSrcMapping:i,secretKeys:Object.keys(this.projectUIState.secrets),options:{skipDevModeWidgets:o},applyForegroundTokenToFill:this.projectUIState.userPreferences.applyForegroundColorAsIconFill,exportUnusedClasses:this.projectUIState.userPreferences.exportUnusedClasses});return r}updateGithubLink(e){const{doc:t,repoLink:o,repoName:n,projectType:i}=e;if(!t)return;const r=o.split("https://github.com/")[1].split("/")[0];t.stats.github={repositoryUrl:o,repositoryName:n,repositoryOwner:r,projectType:i===xn.o.UIDL?xn.o.REACT:i}}mergeProjectWithTemplateForDeplyment(e){var t,o;e.files=[...(null===e||void 0===e?void 0:e.files)||[],...null===Fa||void 0===Fa?void 0:Fa.files];const n=null===(t=e.files.find((({name:e,fileType:t})=>"index"===e&&t===x.Tv.HTML)))||void 0===t?void 0:t.content,i=JSON.parse((null===(o=e.files.find((({name:e,fileType:t})=>"teleport.config"===e&&t===x.Tv.JSON)))||void 0===o?void 0:o.content)||"{}");if(!n||!i)throw new Error("Configuration files are missing for customc-code projects");const r=(new DOMParser).parseFromString(n,"text/html");r.querySelectorAll('[type="importmap"]').forEach((e=>e.remove()));const s=r.createElement("script");Object.assign(s,{type:"text/javascript"}),s.innerHTML="\nglobalThis.process = {\n  env: 'production'\n}\n";const a=r.getElementsByTagName("style")[0]||r.head.firstChild;r.head.insertBefore(s,a);const c=r.createElement("script");return Object.assign(c,{src:"./src/index.jsx",type:"module",async:!0}),r.body.append(c),e.files.forEach((e=>{"index"===e.name&&e.fileType===x.Tv.HTML&&(e.content=`\n<!DOCTYPE html>\n\n<html lang="en">\n\n${r.documentElement.innerHTML}\n\n</html>\n`)})),this.parseFolders("",e,((e,t)=>{e.includes("/teleporthq/")&&t.fileType===x.Tv.JS&&(t.fileType="jsx"),e.includes("/src")&&"index"===t.name&&t.fileType===x.Tv.JS&&(t.fileType="jsx")})),e}parseFolders(e,t,o){const{name:n,files:i,subFolders:r}=t;i.map((t=>o((0,kn.join)(e,n),t))),r.map((t=>this.parseFolders((0,kn.join)(e,n),t,o)))}injectLocalAssetsIntoProject(e,t){const o=null===e||void 0===e?void 0:e.subFolders.find((e=>"public"===e.name)),n={name:"playground_assets",files:t,subFolders:[]};return o?1===o.subFolders.length&&"playground_assets"===o.subFolders[0].name?o.subFolders=[n]:o.subFolders.push(n):e.subFolders.push({name:"public",files:[],subFolders:[n]}),e}async packProjectForGithubPublish(e,t){const{newDevRepository:o,deployStagedOnly:n}=t||{},i=this.projectUIState.devMode.selectedBranch,{projectExportType:r}=this.projectUIState.userPreferences;if(r===p.iW.DEV||o||n){var s;const e=Object.values(this.projectDoc.assets.byId);let t=await this.assetsService.downloadAssets(e,{skipDownload:!1});const o=this.projectDoc.projectFiles.staged[i].byId;n&&(t=t.filter((e=>{const t=`${Ks.Wn}/playground_assets/${e.name}`;if(o[t])return e})));const r=n?this.projectDoc.projectFiles.pack(xa({filesToPack:o,assets:{},toDeploy:!0},Object.keys((null===(s=this.projectDoc.customFiles)||void 0===s?void 0:s.byId)||{}).length>0&&{customFiles:this.projectDoc.customFiles.byId})):this.projectFilesFlow.getPackedDevProjectFromCurrentBranch();return this.injectLocalAssetsIntoProject(r,t),{packedProject:r,assets:t}}const a=await this.assetsManagementFlow.getOptimisedUsedAssets(),c=await this.assetsService.downloadAssets(a,{});return{packedProject:await this.projectFilesFlow.getPackedDesignProject({projectType:e}),assets:c}}},ya=(0,s.Z)(ma.prototype,"projectUIState",[Js],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ga=(0,s.Z)(ma.prototype,"globalAppState",[Xs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fa=(0,s.Z)(ma.prototype,"projectDoc",[Qs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ba=(0,s.Z)(ma.prototype,"notificationsManagementFlow",[ea],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ia=(0,s.Z)(ma.prototype,"sentryService",[ta],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),va=(0,s.Z)(ma.prototype,"githubRepository",[oa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wa=(0,s.Z)(ma.prototype,"githubFlow",[na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Na=(0,s.Z)(ma.prototype,"assetsService",[ia],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ja=(0,s.Z)(ma.prototype,"assetsManagementFlow",[ra],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sa=(0,s.Z)(ma.prototype,"projectFilesFlow",[sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Da=(0,s.Z)(ma.prototype,"fileDownloadService",[aa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta=(0,s.Z)(ma.prototype,"workspacesRepository",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa=(0,s.Z)(ma.prototype,"projectInitFlow",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(ma.prototype,"downloadZip",[da],Object.getOwnPropertyDescriptor(ma.prototype,"downloadZip"),ma.prototype),(0,s.Z)(ma.prototype,"exportToGithub",[pa],Object.getOwnPropertyDescriptor(ma.prototype,"exportToGithub"),ma.prototype),(0,s.Z)(ma.prototype,"exportToCodesandbox",[ua],Object.getOwnPropertyDescriptor(ma.prototype,"exportToCodesandbox"),ma.prototype),(0,s.Z)(ma.prototype,"updateGithubLink",[so.W],Object.getOwnPropertyDescriptor(ma.prototype,"updateGithubLink"),ma.prototype),ha=ma));var Ma,Pa,Aa,ka,Ua,Ra,Za,La,$a,Ba=o(205632),Ga=o(4427),Ha=o(517805),za=o(824497),Ya=o(975350),Va=o(188681);Ma=(0,c.provide)("projectChangesFlow"),Pa=(0,c.inject)("modalManagementFlow"),Aa=(0,c.inject)("projectUIState"),ka=(0,c.inject)("routerService"),Ma((Ra=class{constructor(){(0,i.Z)(this,"modalManagementFlow",Za,this),(0,i.Z)(this,"projectUIState",La,this),(0,i.Z)(this,"routerService",$a,this),(0,r.Z)(this,"handleLimitationIncrement",((e,t,o)=>{t&&o&&this.projectUIState.workspace.id===t&&this.projectUIState.workspace.meta[e]!==o&&(0,a.mutate)(this.projectUIState,(t=>{t.workspace.meta[e]=o}))})),(0,r.Z)(this,"handleProjectAccessDenied",(()=>{if(this.projectUIState.isLeavingProject)return;const e=b.d.createCustomModal({Component:Ha.n,data:{title:"Access denied",description:"Access to this project or it's workspace has been removed. You will be redirected to dashboard in a few moments...",buttonTitle:"Exit project"},onSubmit:()=>this.closeModalAndRedirect()});this.modalManagementFlow.showModal(e),setTimeout((()=>{this.closeModalAndRedirect()}),7e3)})),(0,r.Z)(this,"handleTooManyUserConnections",(()=>{const e=b.d.createCustomModal({Component:Ha.n,data:{title:"Real-time collaborators limit",description:"Unfortunately you can't access the project right now because there are too many live connections. Please try again later! You will be redirected to dashboard in a few moments...",buttonTitle:"Exit project"},onSubmit:()=>this.closeModalAndRedirect()});(0,Ga.G)().destroy(),this.modalManagementFlow.showModal(e),setTimeout((()=>{this.closeModalAndRedirect()}),5e3)})),(0,r.Z)(this,"handleProjectDeleted",(()=>{const e=b.d.createCustomModal({Component:Ha.n,data:{title:"Deleted project",description:"Unfortunately this project has been deleted by the project owner. You will be redirected to dashboard in a few moments...",buttonTitle:"Exit project"},onSubmit:()=>this.closeModalAndRedirect()});this.modalManagementFlow.showModal(e),setTimeout((()=>{this.closeModalAndRedirect()}),5e3)})),(0,r.Z)(this,"handleApplicationUpdate",(()=>{const e=b.d.createCustomModal({Component:Ha.n,data:{title:"New version of the app available",description:"A new version of the app is available. We will reload the page in a few moments to enjoy all the new updates.",buttonTitle:"Reload"},onSubmit:()=>this.closeModalAndReload()});this.modalManagementFlow.showModal(e),setTimeout((()=>{this.closeModalAndReload()}),5e3)})),(0,r.Z)(this,"handleCMSDisable",(()=>{const e=b.d.createCustomModal({Component:Ha.n,data:{title:"CMS was disabled for this project",description:"CMS was disabled for this project. We will reload the page in a moment to apply the changes",buttonTitle:"Reload"},onSubmit:()=>this.closeModalAndReload()});this.modalManagementFlow.showModal(e),setTimeout((()=>{this.closeModalAndReload()}),5e3)})),(0,r.Z)(this,"handleAccessTypeUpdate",(e=>{if(!e)return;const t={[za.Z.READ]:Va.u.VIEWER,[za.Z.WRITE]:Va.u.EDITOR,[za.Z.OWNER]:"Owner"},o=b.d.createCustomModal({Component:Ha.n,data:{title:"New project permission",description:`A new project permission was assigned to your account (${t[e]}). We will reload the page in a few moments.`,buttonTitle:"Reload"},onSubmit:()=>this.closeModalAndReload()});this.modalManagementFlow.showModal(o),setTimeout((()=>{this.closeModalAndReload()}),5e3)}))}closeModalAndReload(){this.modalManagementFlow.hideModal(),Ba.default.reload()}closeModalAndRedirect(){this.modalManagementFlow.hideModal(),Ba.default.push(Ya.Ql)}},Za=(0,s.Z)(Ra.prototype,"modalManagementFlow",[Pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La=(0,s.Z)(Ra.prototype,"projectUIState",[Aa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$a=(0,s.Z)(Ra.prototype,"routerService",[ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ua=Ra));var Wa,Ka,qa,Ja,Xa,Qa,ec,tc,oc,nc,ic,rc,sc,ac,cc,lc,dc,pc,uc,hc,mc,yc=o(463251),gc=o(86233),fc=o(358975),bc=o(330228),Ic=o(143180);Wa=(0,c.provide)("projectCloneFlow"),Ka=(0,c.inject)("projectDoc"),qa=(0,c.inject)("projectUIState"),Ja=(0,c.inject)("projectRepository"),Xa=(0,c.inject)("workspacesRepository"),Qa=(0,c.inject)("globalAppState"),ec=(0,c.inject)("notificationsManagementFlow"),tc=(0,c.inject)("routerService"),oc=(0,c.inject)("modalManagementFlow"),nc=(0,c.inject)("sentryService"),Wa((rc=class{constructor(){(0,i.Z)(this,"projectDoc",sc,this),(0,i.Z)(this,"projectUIState",ac,this),(0,i.Z)(this,"projectRepository",cc,this),(0,i.Z)(this,"workspacesRepository",lc,this),(0,i.Z)(this,"globalAppState",dc,this),(0,i.Z)(this,"notificationsManagementFlow",pc,this),(0,i.Z)(this,"routerService",uc,this),(0,i.Z)(this,"modalManagementFlow",hc,this),(0,i.Z)(this,"sentryService",mc,this),(0,r.Z)(this,"cloneProjectFromHeader",(async()=>{const e=await this.workspacesRepository.getAll();if(!e.length)throw new Error("No workspace found on cloning project");const t=b.d.createCustomModal({Component:bc.v,data:{projectType:"public",onUpgrade:()=>{var t;return Ba.default.push((0,Ya.Ol)((null===(t=e.find((e=>null===e.subscriptionItemId)))||void 0===t?void 0:t.slug)||"",fc.up.YEARLY))}},onSubmit:async t=>{var o;const n=null===(o=e.find((e=>e.id===t)))||void 0===o?void 0:o.slug;if(!n)return;const i=await this.workspacesRepository.getWorkspaceBySlug(n);await this.clone(i),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(t)})),(0,r.Z)(this,"duplicateProject",(async(e,t)=>{const o=this.globalAppState.user.userData;if(!o)throw new Error("Logged in user not found");const n=await this.workspacesRepository.getWorkspaceBySlug(e),{isProjectsLimitReached:i,projectsLimit:r}=(0,gc.Hr)(n,o);if(i){const e=b.d.createCustomModal({Component:Ic.$,data:{workspaceName:n.name,entity:"project",isWorkspaceOwner:t,showUpgradeBtn:!0,projectsLimit:r,onSubmit:()=>Ba.default.push((0,Ya.Ol)(n.slug,fc.up.YEARLY))}});this.modalManagementFlow.showModal(e)}else this.cloneProject(this.projectUIState.title,n.id)})),(0,r.Z)(this,"cloneProject",(async(e,t)=>{const o=await this.projectRepository.clone(this.projectDoc.id,e,t);await Ba.default.replace((0,Ya.S1)(o.project.slug)),Ba.default.reload()}))}async clone(e){const t=this.globalAppState.user.userData;if(!t)throw new Error("Logged in user not found");const{isProjectsLimitReached:o}=(0,gc.Hr)(e,t);if(o)return void this.notificationsManagementFlow.handleError(yc.MN);const n=e.projects.map((e=>e.name)),i=(0,l.Zu)(n,this.projectUIState.title);this.cloneProject(i,e.id)}},sc=(0,s.Z)(rc.prototype,"projectDoc",[Ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ac=(0,s.Z)(rc.prototype,"projectUIState",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cc=(0,s.Z)(rc.prototype,"projectRepository",[Ja],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lc=(0,s.Z)(rc.prototype,"workspacesRepository",[Xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dc=(0,s.Z)(rc.prototype,"globalAppState",[Qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pc=(0,s.Z)(rc.prototype,"notificationsManagementFlow",[ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uc=(0,s.Z)(rc.prototype,"routerService",[tc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hc=(0,s.Z)(rc.prototype,"modalManagementFlow",[oc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mc=(0,s.Z)(rc.prototype,"sentryService",[nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ic=rc));var vc,wc,Nc,jc,Sc,Dc,Tc,Oc,Fc,Cc,Ec,xc,_c,Mc,Pc,Ac,kc,Uc=o(609850),Rc=o.n(Uc);function Zc(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Lc(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Zc(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Zc(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}vc=(0,c.provide)("componentCodeGenerationFlow"),wc=(0,c.inject)("projectUIState"),Nc=(0,c.inject)("projectDoc"),jc=(0,c.inject)("packerService"),Sc=(0,c.inject)("assetsManagementFlow"),Dc=(0,c.inject)("assetFoldersFlow"),Tc=(0,c.inject)("selfHealingFlow"),Oc=(0,c.inject)("sentryService"),vc((Cc=class{constructor(){(0,i.Z)(this,"projectUIState",Ec,this),(0,i.Z)(this,"projectDoc",xc,this),(0,i.Z)(this,"packerService",_c,this),(0,i.Z)(this,"assetsManagementFlow",Mc,this),(0,i.Z)(this,"assetFoldersFlow",Pc,this),(0,i.Z)(this,"selfHealingFlow",Ac,this),(0,i.Z)(this,"sentryService",kc,this)}updateCodeType(e){(0,a.mutate)(this.projectUIState,(({userPreferences:t})=>{t.codeType=e;const o=x.vi[e];t.codeStyleVariation=o||void 0}))}updateStyleVariation(e){(0,a.mutate)(this.projectUIState,(({userPreferences:t})=>{t.codeStyleVariation=e}))}async generateComponentUIDLcomponent(e,t){const o=await this.assetsManagementFlow.getOptimisedUsedAssets();o.forEach((e=>e.folderPath=this.assetFoldersFlow.getAncestorsPath(e.parentFolderId)));const n=this.projectDoc.assets.mapClassesAndNodesToOptimisedAssets(o),i=e.title,r=(0,ni.dE)(i)||`Component-${i}`;this.selfHealingFlow.fixMultipleDynamicVariantsForCompRootNode({component:e});const s=Rc()(this.projectDoc);return Fs({component:e,doc:s,options:{skipDevModeWidgets:this.projectUIState.userPreferences.projectExportType===p.iW.DEV},projectType:t,defaultElementStyles:{},assetSrcMapping:n,compTitle:r,experimentalFeatures:this.projectDoc.settings.experimentalFeatures||{}}).pageUIDL}async generateComponentCode(e){var t;const{codeStyleVariation:o,codeType:n}=this.projectUIState.userPreferences,i=await this.generateComponentUIDLcomponent(e,n),r={};if(n===x.cd.HTML)for(const a of Object.values(this.projectDoc.components.byId)){if(!a){this.sentryService.captureException("A component was skiped when generating code");continue}const e=await this.generateComponentUIDLcomponent(a,n);r[a.title]=e}if("UIDL"===n){return{files:[{name:`${i.name}-uidl`,fileType:"json",content:JSON.stringify(i,null,2)}],dependencies:{}}}const s={componentType:n,styleVariation:o,componentGeneratorOptions:{projectStyleSet:{styleSetDefinitions:Lc(Lc({},this.projectDoc.designLanguage.textStylesToUIDL()),this.projectDoc.classes.toUIDL()),fileName:"style",path:".",importFile:!0},moduleComponents:r}};return await this.packerService.generateComponentCode(i,Lc(Lc({},s),{},{advancedEmbeds:!(null===(t=this.projectDoc.settings.experimentalFeatures)||void 0===t||!t.advancedEmbeds)}))}},Ec=(0,s.Z)(Cc.prototype,"projectUIState",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xc=(0,s.Z)(Cc.prototype,"projectDoc",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_c=(0,s.Z)(Cc.prototype,"packerService",[jc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mc=(0,s.Z)(Cc.prototype,"assetsManagementFlow",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pc=(0,s.Z)(Cc.prototype,"assetFoldersFlow",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ac=(0,s.Z)(Cc.prototype,"selfHealingFlow",[Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kc=(0,s.Z)(Cc.prototype,"sentryService",[Oc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fc=Cc));var $c,Bc,Gc,Hc,zc,Yc,Vc,Wc,Kc,qc,Jc;$c=(0,c.provide)("nodeCodeGenerationFlow"),Bc=(0,c.inject)("projectUIState"),Gc=(0,c.inject)("projectDoc"),Hc=(0,c.inject)("assetsManagementFlow"),zc=(0,c.inject)("assetFoldersFlow"),$c((Vc=class{constructor(){(0,i.Z)(this,"projectUIState",Wc,this),(0,i.Z)(this,"projectDoc",Kc,this),(0,i.Z)(this,"assetsManagementFlow",qc,this),(0,i.Z)(this,"assetFoldersFlow",Jc,this)}async generateNodeUIDL(e){var t;const o=await this.assetsManagementFlow.getOptimisedUsedAssets();o.forEach((e=>e.folderPath=this.assetFoldersFlow.getAncestorsPath(e.parentFolderId)));const n=this.projectDoc.assets.mapClassesAndNodesToOptimisedAssets(o),i=this.projectDoc.getComponentIdForNode(e),r=this.projectDoc.getProjectPageOrComponent(i),s=r&&r instanceof Un.n?(0,Rn.Dn)(r,n):{},a=r?(0,Rn.wv)(r.stateDefinitions):{};let c={},l={},d={};const u={resources:{items:{}}};if(this.projectDoc.cms.isEnabled){const e=Ps(this.projectDoc);u.resources.items=(0,Rn.qO)(e.projectResources),c=e.cmsStates,l=e.cmsProps,d=e.nodeParams}const h=[],m=Rc()(this.projectDoc);return{nodeUIDL:Ss({doc:m,component:r,propDefinitions:s,stateDefinitions:a,defaultElementStyles:{},cmsData:{projectResources:(null===u||void 0===u||null===(t=u.resources)||void 0===t?void 0:t.items)||{},cmsStates:c,cmsProps:l,nodeParams:d,cmsIdentifiersByCtxId:{}},assetSrcMapping:n,projectType:xn.o.UIDL,nodeId:e,options:{skipDevModeWidgets:this.projectUIState.userPreferences.projectExportType===p.iW.DEV},usedComponents:h,useDefaultProps:!0,experimentalFeatures:this.projectDoc.settings.experimentalFeatures||{}}).nodeHierarchy,usedComponents:h}}},Wc=(0,s.Z)(Vc.prototype,"projectUIState",[Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kc=(0,s.Z)(Vc.prototype,"projectDoc",[Gc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qc=(0,s.Z)(Vc.prototype,"assetsManagementFlow",[Hc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jc=(0,s.Z)(Vc.prototype,"assetFoldersFlow",[zc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yc=Vc));var Xc=o(834630),Qc=o(134055),el=o(236711),tl=o(278702),ol=o(986897);class nl{constructor(){(0,r.Z)(this,"previewSelectedNode",null),(0,r.Z)(this,"existingSectionsUnderPreview",{}),(0,r.Z)(this,"addedPreviewComponents",[]),(0,r.Z)(this,"componentIsUnderPreview",(e=>Object.values(this.addedPreviewComponents).some((t=>t===e)))),(0,r.Z)(this,"resetData",(()=>{this.addedPreviewComponents=[],this.previewSelectedNode=null,this.existingSectionsUnderPreview={}}))}static get Instance(){return this._instance||(this._instance=new this)}}(0,r.Z)(nl,"_instance",void 0);var il,rl,sl,al,cl,ll,dl,pl,ul,hl,ml,yl=o(590196),gl=o(989993);let fl=(il=(0,c.inject)("projectDoc"),rl=(0,c.inject)("folderManagementFlow"),sl=(0,c.inject)("assetsRepository"),al=(0,c.inject)("imageOptimisationFlow"),ml=hl=class{constructor(){(0,i.Z)(this,"projectDoc",ll,this),(0,i.Z)(this,"folderManagementFlow",dl,this),(0,i.Z)(this,"assetsRepository",pl,this),(0,i.Z)(this,"imageOptimisationFlow",ul,this)}static get Instance(){return this._instance||(this._instance=new this)}async uploadAssets(e){for(const i of e)i.file=await i.file;const t=e.map((e=>e.file));if(!t.length)return;let o=Object.keys(this.projectDoc.folders.byId).filter((e=>"external"===this.projectDoc.folders.byId[e].name)).map((e=>this.projectDoc.folders.byId[e]))[0];o||(o=this.folderManagementFlow.create({folderName:"external",parentFolderId:ut.D.PUBLIC_ASSETS}));const n=(0,Xc.qw)(t).map((e=>this.assetsRepository.upload({files:e,projectId:this.projectDoc.id,parentFolderId:o?o.id:ut.D.PUBLIC_ASSETS})));return(await Promise.all(n)).flat().filter((e=>e))}linkAssetsToNodesOrProps(e){const{initialAssets:t,uploadedAssets:o,doc:n}=e;if(!n)return;const i=t.map((e=>e.file)),r=Object.values(n.components.byId).reduce(((e,t)=>{var o;return e.concat(Object.values(null!==(o=null===t||void 0===t?void 0:t.propDefinitions)&&void 0!==o?o:{}))}),[]);t.map(((e,t)=>{const s=i[t].name,a=null===o||void 0===o?void 0:o.find((e=>e.name===s)),c=n.nodes.getById(e.nodeId);if(!c)return;switch(e.type){case"image":if(!a)return void(c.attrs.src=new Yr.F({content:yl.b.image.src}));const t=new Yr.F({content:(0,ni.zo)(a,a.size.toString())});c.attrs.src=t;break;case"poster":if(!a)return void(c.attrs.poster=new Yr.F({content:yl.b.image.src}));const o=new Yr.F({content:(0,ni.zo)(a,a.size.toString())});c.attrs.poster=o;break;case"backgroundImage":if(!a||"undefined"==typeof e.bgImgOrder)return void(c.styles.backgroundImage=new Yr.F({content:`url("${yl.b.image.src}")`}));const n=(0,gl.BQ)(c.styles.backgroundImage.content);n[e.bgImgOrder]=a.id;const i=new Yr.F({content:n.join(",")});c.styles.backgroundImage=i;break;case"propDefinition":const s=r.find((t=>t.name===e.propName));if(!s)return;if(!a)return void(s.defaultValue=yl.b.image.src);s.defaultValue=a.path;break;case"prop":if(!a)return void(c.attrs[e.propName].content=yl.b.image.src);const l=new Yr.F({content:(0,ni.zo)(a,a.size.toString())});c.attrs[e.propName].content=l.content}if(!a)return;a.usedInNodes[e.nodeId]=!0,a.sizePerComponent=this.imageOptimisationFlow.computeAssetSizePerComponent([a])[a.id];const l={[a.id]:"asset"};n.folders.addChildToFolder({child:l,folderId:a.parentFolderId}),n.assets.add(a)}))}},(0,r.Z)(hl,"_instance",void 0),cl=ml,ll=(0,s.Z)(cl.prototype,"projectDoc",[il],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dl=(0,s.Z)(cl.prototype,"folderManagementFlow",[rl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pl=(0,s.Z)(cl.prototype,"assetsRepository",[sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ul=(0,s.Z)(cl.prototype,"imageOptimisationFlow",[al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cl);var bl,Il,vl,wl,Nl,jl,Sl,Dl,Tl,Ol,Fl,Cl,El,xl,_l,Ml,Pl,Al,kl,Ul,Rl,Zl,Ll,$l,Bl,Gl,Hl,zl,Yl,Vl,Wl,Kl,ql,Jl,Xl,Ql,ed,td,od,nd,id,rd,sd,ad,cd,ld,dd,pd;function ud(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function hd(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ud(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ud(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}bl=(0,c.provide)("componentManagementFlow"),Il=(0,c.inject)("sharedbProjectSyncService"),vl=(0,c.inject)("projectDoc"),wl=(0,c.inject)("projectUIState"),Nl=(0,c.inject)("nodeSelectionFlow"),jl=(0,c.inject)("notificationsManagementFlow"),Sl=(0,c.inject)("layoutManagementFlow"),Dl=(0,c.inject)("navbarFlow"),Tl=(0,c.inject)("uidlToComponentMapper"),Ol=(0,c.inject)("webRTCState"),Fl=(0,c.inject)("rtcFlow"),Cl=(0,c.inject)("nodeManagementFlow"),El=(0,c.inject)("collaboratorManagementFlow"),xl=(0,c.inject)("modalManagementFlow"),_l=(0,c.inject)("projectInitFlow"),Ml=(0,c.inject)("cloudComponentsFlow"),Pl=(0,c.inject)("imageOptimisationFlow"),Al=(0,c.inject)("selfHealingFlow"),kl=(0,c.inject)("sentryService"),Ul=(0,c.inject)("elementRefProvider"),Rl=(0,c.inject)("projectManagementFlow"),Zl=(0,h.G)(g.l.ENTER_RENAME_COMPONENT),Ll=(0,h.G)(g.l.CREATE_COMPONENT),$l=(0,h.G)(g.l.CREATE_COMPONENT),Bl=(0,h.G)(g.l.DELETE_COMPONENT),Gl=(0,h.G)(g.l.DUPLICATE_COMPONENT),bl((zl=class{constructor(){(0,i.Z)(this,"dbSync",Yl,this),(0,i.Z)(this,"projectDoc",Vl,this),(0,i.Z)(this,"projectUIState",Wl,this),(0,i.Z)(this,"nodeSelectionFlow",Kl,this),(0,i.Z)(this,"notificationsManagementFlow",ql,this),(0,i.Z)(this,"layoutManagementFlow",Jl,this),(0,i.Z)(this,"navbarFlow",Xl,this),(0,i.Z)(this,"uidlToComponentMapper",Ql,this),(0,i.Z)(this,"webRTCState",ed,this),(0,i.Z)(this,"rtcFlow",td,this),(0,i.Z)(this,"nodeManagementFlow",od,this),(0,i.Z)(this,"collaboratorManagementFlow",nd,this),(0,i.Z)(this,"modalManagementFlow",id,this),(0,i.Z)(this,"projectInitFlow",rd,this),(0,i.Z)(this,"cloudComponentsFlow",sd,this),(0,i.Z)(this,"imageOptimisationFlow",ad,this),(0,i.Z)(this,"selfHealingFlow",cd,this),(0,i.Z)(this,"sentryService",ld,this),(0,i.Z)(this,"elementRefProvider",dd,this),(0,i.Z)(this,"projectManagementFlow",pd,this),(0,r.Z)(this,"internationalizationFlow",Pt.q.Instance),(0,r.Z)(this,"translationManager",At.K.Instance),(0,r.Z)(this,"sectionsPreviewMetada",nl.Instance),(0,r.Z)(this,"uidlToDomainAssetsManager",fl.Instance)}async commitComponent(e){const t=this.projectUIState.componentList.componentUnderLocalWork;t&&(this.renameComponent({id:t.id,newName:e}),(0,a.mutate)(this.projectUIState,(e=>{e.componentList.componentUnderLocalWork=null})))}async beginEditing(e){e&&this.projectDoc.components.byId[e]&&(0,a.mutate)(this.projectUIState,(t=>{t.componentList.componentUnderLocalWork=(new Un.n).fromJSON(this.projectDoc.components.byId[e].toJSON())}))}createEmptyComponent(e){const{name:t,selectNewComponent:o=!0,parentFolderId:n=ut.D.COMPONENTS,doc:i}=e;if(this.checkComponentsLimitReached()||!i)return null;this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId();const r=new Un.n({title:this.projectDoc.getUniqueCompOrPageName(null!==t&&void 0!==t?t:"Component"),instantiatedByNodes:{},pos:this.projectDoc.components.getPositionAfterLast()});return i.addComponent({component:r,folderId:n,hasDefaultStyles:!0}),this.rtcFlow.notifySelectedComp(r.id),o&&this.navbarFlow.selectOrCreateTabByEntityId(r.id),(0,a.mutate)(this.projectUIState,(e=>{e.componentList.componentUnderLocalWork=(new Un.n).fromJSON(r.toJSON()),e.componentList.stateValues[r.id]={},e.componentList.propValues[r.id]={}})),r}checkComponentsLimitReached(){const e=this.projectInitFlow.getProjectLimitations();return Object.keys(this.projectDoc.components.byId).length>=e.MAX_COMPONENTS_IN_PROJECT&&(this.notificationsManagementFlow.createNotification(d.k$.WARNING,"You reached the maximum number of components allowed in a project."),!0)}handleMultipleActions(e){this.dbSync.mutate(this.projectDoc,(t=>{e(t)}))}importThqSectionSync(e){const{generatedComponent:t,nextSibling:o,thqPrimitiveType:n,doc:i}=e;let{compInstanceId:r}=e;if(!i)return;const s=this.computeTargetToAcceptElement(e.targetId,n),a=s.target;if(r=r||s.compInstanceId,!a)return;const c=i.nodes.getComponentIdOf(a);if(!c)return;this.replacePropsInGeneratedNodes(t);const l=[...t.nodes],d=[],p=[];for(;l.length;){const e=l.pop();if(!e||"component"!==e.primitiveType||!e.semanticType||n)continue;const o=e.semanticType,r=t.nodes.find((t=>t.id===e.id));if(!r||!i.nodes.nodeIsCompInstance(r))continue;const s=i.getUniqueCompOrPageName(o);if(s!==o&&t.usedComponents[t.components[0].id].forEach((e=>{e.componentName===o&&(e.componentName=s)})),-1===d.indexOf(o));else{const e=p.find((e=>e.components[0].title===s));e&&(r.compIdOfCompInstance=null===e||void 0===e?void 0:e.components[0].id,r.semanticType=null)}}const u=t.components[0].rootNodeId;if(!t.nodes.find((e=>e.id===u)))return;p.forEach((e=>this.addComponentMetaFromData({data:e,doc:i})));const{components:h,nodes:m,usedComponents:y,sectionIds:g}=t;m.forEach((e=>{e.compIdOfRootNode=null,"fakeSize"in e&&(e.fakeSize=!1);const t=(0,tl.kd)(e,ir.AS);t&&(e.primitiveType=t),e.id===u?i.addNodesToParentOrStage({nodes:[e],parentId:a,nextSibling:o,compInstanceId:r}):i.addNode(e)})),g[c]=g[h[0].id],y[c]=y[h[0].id],delete g[h[0].id],delete y[h[0].id],this.addComponentMetaFromData({doc:i,data:t,createComponentAndNodes:!1})}async importSectionComponent(e){const{sectionId:t,thqPrimitiveType:o,nextSibling:n,customCodeSnippet:i}=e;let{compInstanceId:r}=e;this.layoutManagementFlow.selectStyledSectionGroup(null);const s=this.computeTargetToAcceptElement(e.targetId,o),a=s.target;if(r=r||s.compInstanceId,!a)return;const c=this.projectDoc.nodes.getComponentIdOf(a);if(!c)return;const l=o?await this.generateInteractiveElement(t,o):await this.generateSectionComponent(t,!0);if(!l)return;this.replacePropsInGeneratedNodes(l);const d=[...l.nodes],p=[],u=[];for(;d.length;){const e=d.pop();if(!e||"component"!==e.primitiveType||!e.semanticType||o)continue;const t=e.semanticType,n=l.nodes.find((t=>t.id===e.id));if(!n||!this.projectDoc.nodes.nodeIsCompInstance(n))continue;const i=this.projectDoc.getUniqueCompOrPageName(t);if(i!==t&&l.usedComponents[l.components[0].id].forEach((e=>{e.componentName===t&&(e.componentName=i)})),-1!==p.indexOf(t)){const e=u.find((e=>e.components[0].title===i));e&&(n.compIdOfCompInstance=null===e||void 0===e?void 0:e.components[0].id,n.semanticType=null);continue}const r=await this.generateSectionComponent(e.semanticType);r&&(n.compIdOfCompInstance=r.components[0].id,n.semanticType=null,p.push(t),u.push(r))}const h=l.components[0].rootNodeId;this.dbSync.mutate(this.projectDoc,(e=>{if(!l.nodes.find((e=>e.id===h)))return;u.forEach((t=>this.addComponentMetaFromData({data:t,doc:e})));const{components:t,nodes:o,usedComponents:s,sectionIds:d}=l;o.forEach((t=>{t.compIdOfRootNode=null,"fakeSize"in t&&(t.fakeSize=!1);const o=(0,tl.kd)(t,ir.AS);o&&(t.primitiveType=o),"customCodeSnippet"in t&&(t.customCodeSnippet={},null!==i&&void 0!==i&&i.head&&(t.customCodeSnippet.head=null===i||void 0===i?void 0:i.head),null!==i&&void 0!==i&&i.body&&(t.customCodeSnippet.body=null===i||void 0===i?void 0:i.body)),t.id===h?e.addNodesToParentOrStage({nodes:[t],parentId:a,nextSibling:n,compInstanceId:r}):e.addNodesToParentOrStage({nodes:[t],parentId:t.parentId,keepOriginalParent:!0,nodePosition:t.pos})})),d[c]=d[t[0].id],s[c]=s[t[0].id],delete d[t[0].id],delete s[t[0].id],this.addComponentMetaFromData({doc:e,data:l,createComponentAndNodes:!1})})),h&&this.nodeSelectionFlow.setNodeSelection({nodeId:h,expandTreeView:!1})}async createFromUIDL(e){const{uidls:t}=e,o=this.uidlToComponentMapper.mapUIDLsToComponents({uidls:t.map((e=>({uidl:e}))),domainTranslations:null});if(!o)return[];const n=await this.uidlToDomainAssetsManager.uploadAssets(o.assetFiles);return this.addComponentMetaFromData({data:o,assets:n||[]})}addComponentMetaFromData(e){const{data:t,doc:o,assets:n,customSectionType:i,contentGeneratedByAI:r=!1,createComponentAndNodes:s=!0,forPreviewOnly:a=!1,translateStaticContent:c=!0}=e;if(!o)return[];const{nodes:l,assetFiles:p,propDefinitions:u,tokensInNodes:h,textStylesInNodes:m,fontsInNodes:y,sectionIds:g,usedComponents:f,nodesWithNavlinks:b}=t;c&&this.internationalizationFlow.linkStaticNodesToTranslations({nodes:l,doc:o});const I=t.components;if(s){let e=!1;I.forEach((t=>{i&&(t.customSectionType=i),t.contentGeneratedByAI=r,t.forPreviewOnly=a;const n=o.addComponent({component:t,folderId:"components"});Object.values(u[t.id]).forEach((e=>{const o=null===n||void 0===n?void 0:n.createPropDefinition(hd({},e));if(e.defaultHierarchyRootId){const n=l.find((t=>t.id===e.defaultHierarchyRootId));n&&"meta"in n&&(n.meta={isPropRoot:{compId:t.id,prop:o.id}})}})),e=e||!!Object.keys(t.stateDefinitions||{}).length})),l.forEach((e=>o.nodes.add(e)));if((!o.settings.experimentalFeatures&&e||o.settings.experimentalFeatures&&!o.settings.experimentalFeatures.conditionalRendering&&e)&&!a){const e={experimentalFeatures:hd(hd({},o.settings.experimentalFeatures),{},{conditionalRendering:!0})},t=hd(hd({},o.settings),e);this.projectManagementFlow.updateSettings(t),this.notificationsManagementFlow.createNotification(d.k$.INFO,"The following advanced feature has been activated: 'Conditional Rendering'")}}n&&this.uidlToDomainAssetsManager.linkAssetsToNodesOrProps({doc:o,initialAssets:p,uploadedAssets:n}),(0,Xc.Gw)(o,b),Object.keys(h).forEach((e=>{h[e].forEach((t=>{const n=o.designLanguage.tokensById[e].usedInNodes[t];o.designLanguage.tokensById[e].usedInNodes[t]=n?n+1:1}))})),Object.keys(m).forEach((e=>{m[e].forEach((t=>{o.designLanguage.textStyleSetsById[e].usedInNodes[t]=!0}))})),Object.keys(y).forEach((e=>{y[e].forEach((t=>{const n=o.fonts.byId[e].usedInNodes[t];o.fonts.byId[e].usedInNodes[t]=n?n+1:1}))})),(0,Xc.ng)({doc:o,usedComponents:f,sentryService:this.sentryService}),(0,Xc.cT)({doc:o,sectionIds:g,sentryService:this.sentryService});const v=I.map((e=>e.id));return setTimeout((()=>{const e=v.filter((e=>!this.sectionsPreviewMetada.componentIsUnderPreview(e)));e.length&&c&&this.translationManager.translateComponentsNodesInEveryLanguage({compIds:e})}),300),v}deleteComponent(e){const{id:t}=e,o=this.projectDoc.components.byId[t],n=Object.keys((null===o||void 0===o?void 0:o.instantiatedByNodes)||{}),i=Object.keys(this.projectDoc.cloudComponents.byId[t]||{}),r=()=>this.executeComponentDeletion({id:t});if(n.length&&0===i.length){const e=b.d.createDeleteModal({deletedEntity:"component",onSubmit:r});this.modalManagementFlow.showModal(e)}else if(!n.length&&i.length>0){const e=b.d.createDeleteModal({deletedEntity:"cloud-components",onSubmit:r});this.modalManagementFlow.showModal(e)}else if(n.length&&i.length>0){const e=b.d.createDeleteModal({deletedEntity:"component-cloud-components",onSubmit:r});this.modalManagementFlow.showModal(e)}else this.executeComponentDeletion({id:t}),this.modalManagementFlow.hideModal()}executeComponentDeletion(e){const{id:t,doc:o}=e;o&&(this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId(),this.nodeSelectionFlow.resetNodeSelection(),this.imageOptimisationFlow.removeAssetSizeForPageOrComp({id:t}),o.removeComponent(t),this.updateUIAfterCompDeletion(t),this.cloudComponentsFlow.deleteAllComponents({compId:t,doc:o}))}updateUIAfterCompDeletion(e){var t;this.projectUIState.selection.componentId===e&&this.nodeSelectionFlow.cleanSelectedExpandedAndEditedNodes(),this.navbarFlow.deleteTab((null===(t=this.navbarFlow.getTabByEntityId(e))||void 0===t?void 0:t.id)||"")}async duplicateComponent(e){const{doc:t,compId:o}=e;if(!t)return;const n=t.duplicateComponent(o,t),i=t.getProjectPageOrComponent(n);if(!i||!i.rootNodeId)return;this.imageOptimisationFlow.getAssetsLinkedToNodes({nodeIds:[i.rootNodeId],withDescendants:!0}).forEach((e=>{const{sizePerComponent:i}=t.assets.byId[e];i&&(i[n]=i[o])})),(0,a.mutate)(this.projectUIState,(e=>{e.componentList.propValues[n]={},e.componentList.stateValues[n]={},Object.values(i.propDefinitions).forEach((t=>{e.componentList.propValues[n][t.id]={id:t.id,value:t.defaultValue,type:t.type,name:t.name,meta:{highlightInTreeView:!1},componentInstanceValues:{}}})),Object.values(i.stateDefinitions).forEach((t=>{e.componentList.stateValues[n][t.id]={id:t.id,value:t.defaultValue,type:t.type,name:t.name,componentInstanceValues:{},meta:{highlightInTreeView:!1}}}))}))}async select(e,t,o){if(!t&&this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId(),e!==this.projectUIState.selection.componentId)this.navbarFlow.selectOrCreateTabByEntityId(e,void 0,o);else{const t=this.projectDoc.getProjectPageOrComponent(e);null!==t&&void 0!==t&&t.rootNodeId&&this.nodeSelectionFlow.setNodeSelection({nodeId:t.rootNodeId})}}async addComponentToSelectedElementPageOrComp(e){const{compId:t,doc:o}=e;if(!o)return;if(!o.components.byId[t])return void this.sentryService.captureException(`Cannot add a component ${t} that does not exist`);const{target:n,nextSibling:i}=this.computeTargetToAcceptElement();n&&this.addComponentToNode({compId:t,doc:o,targetId:n,nextSibling:i,selectAfterAdd:!1})}computeTargetToAcceptElement(e,t,o){const n=o||this.projectDoc;if(e){const o=n.nodes.getById(e);return this.projectDoc.isNodeAcceptingChildByElementType(o,Zn.sO.COMPONENT)||t?{target:e}:{target:(null===o||void 0===o?void 0:o.getActualParentId())||""}}const{componentId:i,compInstanceId:r}=this.projectUIState.selection;if(!i)return{};let s=this.nodeSelectionFlow.getSelectedNodesIds()[0];if(!s){const e=n.pages.byId[i]||n.components.byId[i];e&&(s=e.rootNodeId)}let a=null,c=n.nodes.getById(s);for(;c&&!this.projectDoc.isNodeAcceptingChildByElementType(c,Zn.sO.COMPONENT);)s=c.getActualParentId()||"",a=n.nodes.getNextSibling(c),c=n.nodes.getById(s);return{target:s,nextSibling:a,compInstanceId:r}}replaceSelectedNodeWithComponentInstance(e){const{compId:t,nodeIdToReplace:o,doc:n}=e;if(!n)return null;if(!n.components.byId[t])return this.sentryService.captureException(`Cannot replace node with component: ${t} that does not exist`),null;const i=n.nodes.getById(o);if(!i)return null;const r=this.addComponentToNode({compId:t,doc:n,nextSibling:i,targetId:i.getActualParentId(),selectAfterAdd:!1});return this.nodeManagementFlow.deleteNodesById({nodeIds:[o],doc:n}),null!==r&&void 0!==r?r:null}addComponentToNode(e){const{compId:t,nextSibling:o,position:n,isPreviewComponent:i,selectAfterAdd:r=!0,targetId:s,doc:a,translateStaticContent:c=!0}=e;if(!a)return;if(!a.components.byId[t])return void this.sentryService.captureException(`Cannot add a component ${t} that does not exist`);const l=new el.F({primitiveType:Zn.sO.COMPONENT,isPreviewComponent:i});l.compIdOfCompInstance=t;const d=a.nodes.getSlotAndCompInstanceIdForNodeById(s).compInstanceId||this.projectUIState.selection.compInstanceId;return this.nodeManagementFlow.addNodesToParentOrStage({parentId:s,nodes:[l],nextSibling:o,nodePosition:n,compInstanceId:d,translateStaticContent:c,doc:a}),r&&setTimeout((()=>{this.nodeSelectionFlow.setNodeSelection({nodeId:l.id,expandTreeView:!0,compInstanceId:l.id})}),ol.x1.SIXTY),l.id}async addComponentToLastVisitedPage(e){const{compId:t,doc:o}=e;if(!o)return;if(!o.components.byId[t])return void this.sentryService.captureException(`Cannot add a component ${t} that does not exist`);const{lastVisitedPage:n}=this.projectUIState;if(!n)return;const i=this.projectDoc.pages.byId[n]||this.projectDoc.cmsPages.byId[n],r=null===i||void 0===i?void 0:i.rootNodeId;this.addComponentToNode({compId:t,doc:o,targetId:r})}getActiveComponentSectionIdsList(e){if(!e)return[];const t=this.projectDoc.getProjectPageOrComponent(e);if(!t)return[];const o=Object.values(t.sectionIds).map((e=>({sectionId:e,ownerCompRootNodeId:t.rootNodeId}))),n=[...Object.keys((null===t||void 0===t?void 0:t.usedComponents)||{})];for(;n.length;){const e=n.shift(),i=this.projectDoc.components.byId[e];if(!i)throw new Error("Component not found");n.push(...Object.keys(null===i||void 0===i?void 0:i.usedComponents));for(let n=0;n<t.usedComponents[e];n++)o.push(...Object.values(i.sectionIds).map((e=>({sectionId:e,ownerCompRootNodeId:i.rootNodeId}))))}const i=[],r=new Map;for(const s of o){const e=s.ownerCompRootNodeId,t=e?this.projectDoc.nodes.getNodeSubtreeIds(e).reduce(((e,t)=>{const o=this.projectDoc.nodes.getById(t);return o&&(0,tl.kd)(o,"id")===s.sectionId&&e.push(o),e}),[]):[];s.sectionId&&!r.has(s.sectionId)&&(r.set(s.sectionId,!0),i.push({id:s,duplicate:Object.keys(t).length>1,boundNodes:t}))}return i.length&&this.selfHealingFlow.removeSectionIdsWithoutBoundNodes({sectionIds:i,currentComponent:t}),i.filter((e=>e)).sort(((e,t)=>{var o,n,i,r;return(null===(o=e.id)||void 0===o||null===(n=o.sectionId)||void 0===n?void 0:n.toString().toLowerCase())>(null===(i=t.id)||void 0===i||null===(r=i.sectionId)||void 0===r?void 0:r.toString().toLowerCase())?1:-1}))}addIdToComponentSectionIds(e){const{nodeId:t,compId:o,sectionId:n,doc:i}=e;if(!i)return;const r=i.getProjectPageOrComponent(o);if(!r)throw new Error("Component not found");r.sectionIds[t]=n}removeIdFromComponentSectionIds(e){const{compId:t,nodeId:o}=e;this.dbSync.mutate(this.projectDoc,(e=>{const n=e.getProjectPageOrComponent(t);if(!n)throw new Error("Component not found");(null===n||void 0===n?void 0:n.sectionIds[o])&&delete n.sectionIds[o]}))}detachComponentInstance(e){const{componentInstanceId:t,doc:o}=e;if(!o)return;const n=o.detachComponentInstance({nodeId:t,doc:o});if(!n)throw new Error("Failed in detaching component instance");if(n.length>0){const e=this.nodeSelectionFlow.getSelectedNodeInstanceIds()[0];let t;e&&(t=this.elementRefProvider.getClosestParentNodeInstanceId(e)),setTimeout((()=>{let e;var o;t&&(e=null===(o=this.elementRefProvider.getNodeInstanceForNodeIdInParentInstanceId(n[0].id,t))||void 0===o?void 0:o.nodeInstanceId);this.nodeSelectionFlow.setNodeSelection({nodeId:n[0].id,nodeInstanceId:e,isMultiSelectMode:!1})}),ol.x1.SIXTY)}else this.notificationsManagementFlow.createNotification(d.k$.WARNING,"No elements inside componet to detach")}setComponentPropsManageState(e,t){(0,a.mutate)(this.projectUIState,(o=>{o.dynamicNodeInteractionsData.isManagingProps=e,t&&(o.dynamicNodeInteractionsData.selectedPropId=t)}))}setComponentStateManageState(e){(0,a.mutate)(this.projectUIState,(t=>{t.dynamicNodeInteractionsData.isManagingState=e}))}async selectNextComponent(){this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId();const e=this.projectUIState.selection.componentId,t=this.projectDoc.components.getIdsOrderedByCompName();if(!e||t.length<=1)return;if(!this.projectDoc.components.byId[e])return;let o=t.indexOf(e)+1;o>=t.length&&(o=0);this.projectUIState.layout.sidebarPanel!==p.tI.FILES&&this.layoutManagementFlow.changeActiveSidebar(p.tI.FILES),this.navbarFlow.selectOrCreateTabByEntityId(t[o])}async selectPreviousComponent(){this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId();const e=this.projectUIState.selection.componentId,t=this.projectDoc.components.getIdsOrderedByCompName();if(!e||t.length<=1)return;if(!this.projectDoc.components.byId[e])return;let o=t.indexOf(e)-1;o<0&&(o=t.length-1);this.projectUIState.layout.sidebarPanel!==p.tI.FILES&&this.layoutManagementFlow.changeActiveSidebar(p.tI.FILES),this.navbarFlow.selectOrCreateTabByEntityId(t[o])}renameComponent(e){const{id:t,newName:o,doc:n}=e;if(!n)return;const i=n.components.byId[t];if(!i||i.title===o||!o)return;const r=n.getUniqueCompOrPageName(o).trim();i.title=r}getNodesWithLinkFromComp(e){const t=[];return this.getNodesWithLinkRecursively(e,t),t}replacePropsInGeneratedNodes(e,t){const o=Object.keys(e.propDefinitions)[0];o&&e.propDefinitions[o].forEach((o=>{var n;const i=t&&(null===(n=(0,tl.kd)(t,o.name))||void 0===n?void 0:n.toString());e.nodes.forEach((e=>{Qc.X.execute({node:e,propId:o.id,propDefinition:o,newValue:i||o.defaultValue})}))}))}async generateSectionComponent(e,t){const n=await o(309425)(`./${e.toLowerCase()}.json`);return this.uidlToComponentMapper.mapUIDLsToComponents({uidls:[{uidl:n,meta:{isPage:t}}],domainTranslations:null})}async generateInteractiveElement(e,t){const n=await o(973274)(`./${e.toLowerCase()}/${t.toLowerCase()}.json`);return this.uidlToComponentMapper.mapUIDLsToComponents({uidls:[{uidl:n}],domainTranslations:null})}getNodesWithLinkRecursively(e,t){const o=this.projectDoc.nodes.getById(e);o&&("abilities"in o&&Object.keys(o.abilities).length&&t.push(o),"childrenIds"in o&&Object.keys(o.childrenIds).forEach((e=>{this.getNodesWithLinkRecursively(e,t)})))}},Yl=(0,s.Z)(zl.prototype,"dbSync",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vl=(0,s.Z)(zl.prototype,"projectDoc",[vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl=(0,s.Z)(zl.prototype,"projectUIState",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kl=(0,s.Z)(zl.prototype,"nodeSelectionFlow",[Nl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ql=(0,s.Z)(zl.prototype,"notificationsManagementFlow",[jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jl=(0,s.Z)(zl.prototype,"layoutManagementFlow",[Sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xl=(0,s.Z)(zl.prototype,"navbarFlow",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ql=(0,s.Z)(zl.prototype,"uidlToComponentMapper",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed=(0,s.Z)(zl.prototype,"webRTCState",[Ol],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),td=(0,s.Z)(zl.prototype,"rtcFlow",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od=(0,s.Z)(zl.prototype,"nodeManagementFlow",[Cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nd=(0,s.Z)(zl.prototype,"collaboratorManagementFlow",[El],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),id=(0,s.Z)(zl.prototype,"modalManagementFlow",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rd=(0,s.Z)(zl.prototype,"projectInitFlow",[_l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sd=(0,s.Z)(zl.prototype,"cloudComponentsFlow",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad=(0,s.Z)(zl.prototype,"imageOptimisationFlow",[Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cd=(0,s.Z)(zl.prototype,"selfHealingFlow",[Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ld=(0,s.Z)(zl.prototype,"sentryService",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dd=(0,s.Z)(zl.prototype,"elementRefProvider",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pd=(0,s.Z)(zl.prototype,"projectManagementFlow",[Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(zl.prototype,"beginEditing",[Zl],Object.getOwnPropertyDescriptor(zl.prototype,"beginEditing"),zl.prototype),(0,s.Z)(zl.prototype,"createEmptyComponent",[Ll,m.P],Object.getOwnPropertyDescriptor(zl.prototype,"createEmptyComponent"),zl.prototype),(0,s.Z)(zl.prototype,"importThqSectionSync",[m.P],Object.getOwnPropertyDescriptor(zl.prototype,"importThqSectionSync"),zl.prototype),(0,s.Z)(zl.prototype,"createFromUIDL",[$l],Object.getOwnPropertyDescriptor(zl.prototype,"createFromUIDL"),zl.prototype),(0,s.Z)(zl.prototype,"addComponentMetaFromData",[m.P],Object.getOwnPropertyDescriptor(zl.prototype,"addComponentMetaFromData"),zl.prototype),(0,s.Z)(zl.prototype,"deleteComponent",[Bl],Object.getOwnPropertyDescriptor(zl.prototype,"deleteComponent"),zl.prototype),(0,s.Z)(zl.prototype,"executeComponentDeletion",[m.P],Object.getOwnPropertyDescriptor(zl.prototype,"executeComponentDeletion"),zl.prototype),(0,s.Z)(zl.prototype,"duplicateComponent",[Gl,m.P],Object.getOwnPropertyDescriptor(zl.prototype,"duplicateComponent"),zl.prototype),(0,s.Z)(zl.prototype,"addComponentToSelectedElementPageOrComp",[m.P],Object.getOwnPropertyDescriptor(zl.prototype,"addComponentToSelectedElementPageOrComp"),zl.prototype),(0,s.Z)(zl.prototype,"replaceSelectedNodeWithComponentInstance",[m.P],Object.getOwnPropertyDescriptor(zl.prototype,"replaceSelectedNodeWithComponentInstance"),zl.prototype),(0,s.Z)(zl.prototype,"addComponentToNode",[m.P],Object.getOwnPropertyDescriptor(zl.prototype,"addComponentToNode"),zl.prototype),(0,s.Z)(zl.prototype,"addComponentToLastVisitedPage",[m.P],Object.getOwnPropertyDescriptor(zl.prototype,"addComponentToLastVisitedPage"),zl.prototype),(0,s.Z)(zl.prototype,"addIdToComponentSectionIds",[m.P],Object.getOwnPropertyDescriptor(zl.prototype,"addIdToComponentSectionIds"),zl.prototype),(0,s.Z)(zl.prototype,"detachComponentInstance",[m.P],Object.getOwnPropertyDescriptor(zl.prototype,"detachComponentInstance"),zl.prototype),(0,s.Z)(zl.prototype,"renameComponent",[m.P],Object.getOwnPropertyDescriptor(zl.prototype,"renameComponent"),zl.prototype),Hl=zl));var md,yd,gd,fd,bd,Id,vd,wd,Nd,jd=o(813244),Sd=o(858342),Dd=o(867094);function Td(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Od(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Td(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Td(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}md=(0,c.provide)("componentStyleManagementFlow"),yd=(0,c.inject)("projectDoc"),gd=(0,c.inject)("nodeStyleManagmentFlow"),fd=(0,c.inject)("sentryService"),md((Id=class{constructor(){(0,i.Z)(this,"projectDoc",vd,this),(0,i.Z)(this,"nodeStyleManagementFlow",wd,this),(0,i.Z)(this,"sentryService",Nd,this)}addStyleToCompInstance(e){var t;const{doc:o,nodeId:n,key:i,value:r,tokenId:s}=e,a=null===o||void 0===o?void 0:o.nodes.getById(n);if(!o||!a||!o.nodes.nodeIsCompInstance(a))return;const c=o.components.byId[a.compIdOfCompInstance];if(!c)return void this.sentryService.captureException(`addStyleToCompInstance skipped. Component by ${a.compIdOfCompInstance} not found`);const l=(null===(t=a.attrs[lr.Q])||void 0===t?void 0:t.content)||c.getUniqueStyleSetName(o);this.addClassToCompInstance({className:l,compId:a.compIdOfCompInstance,compInstanceId:a.id,doc:o});const d=Od({},c.styleSetDefinitions[l].styles[i]);if(this.nodeStyleManagementFlow.updateNodeReferenceForTokenWhenRemovingStyle({tokenReference:d,nodeId:a.id}),s){const e=o.designLanguage.tokensById[s];if(!e)return;e.usedInNodes[a.id]?e.usedInNodes[a.id]+=1:e.usedInNodes[a.id]=1,c.styleSetDefinitions[l].styles[i]=new nr.P({content:{referenceType:"token",id:s}})}else c.styleSetDefinitions[l].styles[i]=new Yr.F({content:r}),o.syncAssetInNodeRelationByNewContent({node:a,oldContent:d,newContent:c.styleSetDefinitions[l].styles[i]});c.styleSetDefinitions[l].usedByInstances[a.id]=!0}addReferencedStyleToCompInstance(e){var t;const{doc:o,nodeId:n,condition:i,key:r,value:s,tokenId:a}=e;if(!o)return;const c=o.nodes.getById(n);if(!c||!o.nodes.nodeIsCompInstance(c))return;const l=null===c||void 0===c?void 0:c.compIdOfCompInstance,d=o.components.byId[l];if(!d)return void this.sentryService.captureException(`addReferencedStyleToCompInstance skipped. Component by ${c.compIdOfCompInstance} not found`);const p=(null===(t=c.attrs[lr.Q])||void 0===t?void 0:t.content.toString())||d.getUniqueStyleSetName(o);this.addClassToCompInstance({className:p,compId:d.id,compInstanceId:n});let u=d.getInlineConditionalStyleMapForClass(i,p),h=!1;u||(u={type:"style-map",id:(0,ni.Ox)(),content:{mapType:"inlined",conditions:[i],styles:{}}},h=!0);const m=Od({},u.content.styles[r]);if(this.nodeStyleManagementFlow.updateNodeReferenceForTokenWhenRemovingStyle({tokenReference:m,nodeId:c.id}),a||(u.content.styles[r]=new Yr.F({content:s}),o.syncAssetInNodeRelationByNewContent({node:c,oldContent:m,newContent:d.styleSetDefinitions[p].styles[r]}),h&&(d.styleSetDefinitions[p].referencedStyles[u.id]=u)),a){const e=o.designLanguage.tokensById[a];if(!e)return;e.usedInNodes[c.id]?e.usedInNodes[c.id]+=1:e.usedInNodes[c.id]=1,u.content.styles[r]=new nr.P({content:{referenceType:"token",id:a}}),h&&(d.styleSetDefinitions[p].referencedStyles[u.id]=u)}}removeStyleFromCompInstance(e){var t;const{nodeId:o,key:n,doc:i}=e;if(!i)return;const r=i.nodes.getById(o);if(!r||!i.nodes.nodeIsCompInstance(r))return;const s=i.components.byId[r.compIdOfCompInstance];if(!s)return void this.sentryService.captureException(`removeStyleFromCompInstance skipped. Component by ${r.compIdOfCompInstance} not found`);const a=null===(t=r.attrs[lr.Q])||void 0===t?void 0:t.content;if(!a)return;if(!s.styleSetDefinitions[a])return;const c=s.styleSetDefinitions[a].styles[n];this.nodeStyleManagementFlow.updateNodeReferenceForTokenWhenRemovingStyle({tokenReference:c,nodeId:r.id,doc:i}),delete s.styleSetDefinitions[a].styles[n]}removeConditionalStyleFromCompInstance(e){var t;const{nodeId:o,doc:n,key:i,condition:r}=e;if(!n)return;const s=n.nodes.getById(o);if(!s||!n.nodes.nodeIsCompInstance(s))return;const a=n.components.byId[s.compIdOfCompInstance];if(!a)return void this.sentryService.captureException(`Cannot find component by ${s.compIdOfCompInstance} when removing styles`);const c=null===(t=s.attrs[lr.Q])||void 0===t?void 0:t.content;if(!c)return;const l=a.getInlineConditionalStyleMapForClass(r,c);if(!l)return;const d=l.content.styles[i];this.nodeStyleManagementFlow.updateNodeReferenceForTokenWhenRemovingStyle({tokenReference:d,nodeId:s.id});const p=Object.keys(l.content.styles);1===p.length&&p[0]===i&&"element-state"!==r.conditionType?delete a.styleSetDefinitions[c].referencedStyles[l.id]:delete l.content.styles[i]}unbindTokenFromCompInstance(e){const{doc:t,tokenId:o,nodeId:n}=e;if(!t)return;const i=t.nodes.getById(n);if(!i||!t.nodes.nodeIsCompInstance(i))return;const r=t.components.byId[i.compIdOfCompInstance],s=t.designLanguage.tokensById[o];if(!r)return void this.sentryService.captureException(`unbindTokenFromCompInstance skipped. Component by ${i.compIdOfCompInstance} not found`);if(!s)return void this.sentryService.captureException(`unbindTokenFromCompInstance. Token by ${o} not found`);const a=i.attrs[lr.Q].content;a&&"string"===typeof a&&(Object.values(r.styleSetDefinitions[a].referencedStyles||{}).forEach((e=>{var t;"inlined"===e.content.mapType&&null!==(t=e.content)&&void 0!==t&&t.conditions.length&&Object.values(e.content.styles||{}).length>0&&Object.keys(e.content.styles).forEach((t=>{const n=e.content.styles[t];"dynamic"===n.type&&"token"===n.content.referenceType&&n.content.id===o&&(delete r.styleSetDefinitions[a].referencedStyles[e.id].content.styles[t],r.styleSetDefinitions[a].referencedStyles[e.id].content.styles[t]=new Yr.F({content:s.value}))}))})),Object.keys(r.styleSetDefinitions[a].styles||{}).forEach((e=>{const t=r.styleSetDefinitions[a].styles[e];"dynamic"===t.type&&"token"==t.content.referenceType&&t.content.id===o&&(delete r.styleSetDefinitions[a].styles[e],r.styleSetDefinitions[a].styles[e]=new Yr.F({content:s.value}))})))}getStylesInheritedFromComponentInstance(e,t){const o=this.projectDoc.nodes.getById(this.projectDoc.getOwnerIdOfDependentNode(e)),n={styles:{},referencedStyles:{}};if(!o||!("referencedStyles"in o))return n;const i=Object.values(o.referencedStyles).find((e=>"component-referenced"===e.content.mapType));if(i&&"dynamic"===i.content.content.type){var r;const e=this.projectDoc.nodes.getById(t);if(!e||!this.projectDoc.nodes.nodeIsCompInstance(e))return n;const o=this.projectDoc.components.byId[e.compIdOfCompInstance],s=Object.values((null===o||void 0===o?void 0:o.propDefinitions)||{}).find((e=>e.id===i.content.content.content.id)),a=null===o||void 0===o?void 0:o.styleSetDefinitions[(null===(r=e.attrs[(null===s||void 0===s?void 0:s.name)||""])||void 0===r?void 0:r.content)||""];if(a){const{styles:e,referencedStyles:t}=a;return n.styles=e,n.referencedStyles=t,n}}return n}addClassToCompInstance(e){const{className:t,compId:o,compInstanceId:n,doc:i}=e;if(!i)return;const r=i.components.byId[o];if(!r)return void this.sentryService.captureException(`addClassToCompInstance. Component by ${o} not found`);const s=i.nodes.getById(r.rootNodeId||"");if(!s)return void this.sentryService.captureException(`addClassToCompInstance. Root by ${r.rootNodeId} not found`);const a=i.nodes.getById(n);if(!a)return void this.sentryService.captureException(`addClassToCompInstance. CompInstanceId by ${n} not found`);r.initStyleSetForClass(t),r.styleSetDefinitions[t].usedByInstances[n]=!0;const c="attrs"in a?a.attrs:void 0;c&&!(0,tl.Uq)(a,lr.Q)&&(c[lr.Q]=new Dd.j(t));let l=!1,d=Object.values(r.propDefinitions).find((e=>e.name===lr.Q));if(d||(d=r.createPropDefinition({name:lr.Q,defaultValue:"",locations:{[s.id]:(0,Sd.B1)({base:jd.hD.STYLE,sufix:"componentRoot"})},id:(0,ni.Ox)(),type:"string",inputType:jd.SO.TEXT,hidden:!0}),l=!0),"referencedStyles"in s&&!Object.values(s.referencedStyles).find((e=>"component-referenced"===e.content.mapType))||l){const e={type:"style-map",id:(0,ni.Ox)(),content:{mapType:"component-referenced",content:{type:"dynamic",content:{referenceType:"prop",id:d.id}}}};"referencedStyles"in s&&(s.referencedStyles[e.id]=e)}}},vd=(0,s.Z)(Id.prototype,"projectDoc",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=(0,s.Z)(Id.prototype,"nodeStyleManagementFlow",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd=(0,s.Z)(Id.prototype,"sentryService",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Id.prototype,"addStyleToCompInstance",[m.P],Object.getOwnPropertyDescriptor(Id.prototype,"addStyleToCompInstance"),Id.prototype),(0,s.Z)(Id.prototype,"addReferencedStyleToCompInstance",[m.P],Object.getOwnPropertyDescriptor(Id.prototype,"addReferencedStyleToCompInstance"),Id.prototype),(0,s.Z)(Id.prototype,"removeStyleFromCompInstance",[m.P],Object.getOwnPropertyDescriptor(Id.prototype,"removeStyleFromCompInstance"),Id.prototype),(0,s.Z)(Id.prototype,"removeConditionalStyleFromCompInstance",[m.P],Object.getOwnPropertyDescriptor(Id.prototype,"removeConditionalStyleFromCompInstance"),Id.prototype),(0,s.Z)(Id.prototype,"unbindTokenFromCompInstance",[m.P],Object.getOwnPropertyDescriptor(Id.prototype,"unbindTokenFromCompInstance"),Id.prototype),(0,s.Z)(Id.prototype,"addClassToCompInstance",[m.P],Object.getOwnPropertyDescriptor(Id.prototype,"addClassToCompInstance"),Id.prototype),bd=Id));var Fd,Cd,Ed,xd,_d,Md,Pd,Ad,kd,Ud,Rd=o(735468),Zd=o(889371),Ld=o(135670),$d=o(587767);Fd=(0,c.provide)("stageScrollFlow"),Cd=(0,c.inject)("projectUIState"),Ed=(0,c.inject)("projectDoc"),xd=(0,c.inject)("elementRefProvider"),Fd((Ud=new WeakMap,Md=class{constructor(){(0,i.Z)(this,"projectUIState",Pd,this),(0,i.Z)(this,"projectDoc",Ad,this),(0,i.Z)(this,"elementRefProvider",kd,this),(0,r.Z)(this,"animationFrame",void 0),(0,r.Z)(this,"start",null),Ud.set(this,{writable:!0,value:null}),(0,r.Z)(this,"x",0),(0,r.Z)(this,"y",0),(0,r.Z)(this,"destinationY",0),(0,r.Z)(this,"stepY",0),(0,r.Z)(this,"signY",!1),(0,r.Z)(this,"lastFrameTimestamp",0),(0,r.Z)(this,"step",(e=>{null===this.start&&(this.start=e,this.lastFrameTimestamp=e);const t=e-this.start;if(t>=499)return this.setStageXY(this.x,this.destinationY),void this.resetState();const o=e-this.lastFrameTimestamp||16;this.lastFrameTimestamp=e,this.stepY=o*Math.abs(this.destinationY-this.y)/(500-t),this.signY?this.y=this.y<this.destinationY?this.y+this.stepY:this.destinationY:this.y=this.y>this.destinationY?this.y-this.stepY:this.destinationY,this.setStageXY(this.x,this.y),this.animationFrame=requestAnimationFrame(this.step)}))}bringNodeIntoView(e){const{nodeInstanceId:t,nodeId:o,verticalOffset:n=0}=e;this.resetState(),(0,Zd.Z)(this,Ud,document.getElementById("frame-container"));const i=this.projectDoc.getProjectPageOrComponent(this.projectUIState.selection.componentId);if(o===(null===i||void 0===i?void 0:i.rootNodeId))return;if(!(0,Rd.Z)(this,Ud))return;const r=this.elementRefProvider.getDomTargetNode({nodeId:o,nodeInstanceId:t});if(!r)return;const s=this.elementRefProvider.getVisibleChildrenForTransparentInstanceIds([r.dataset.nodeInstanceId||r.dataNodeInstanceId||""])[0],a=this.elementRefProvider.getDomTargetNode({nodeInstanceId:s}),c=null===a||void 0===a?void 0:a.getBoundingClientRect();if(c&&(0!==c.width||0!==c.left||0!==c.top||0!==c.height)&&(!this.elementRectVisibleInStage(c)||n)){const e=(0,Rd.Z)(this,Ud).getBoundingClientRect(),t=1-(c.top+c.height/2+n)*this.projectUIState.stage.webComp.controlValues.scale/e.height,o=this.projectUIState.stage.webComp,i=null===o||void 0===o?void 0:o.controlValues.x,r=null===o||void 0===o?void 0:o.controlValues.y;if(void 0===i||void 0===r)return;this.destinationY=t,this.signY=r-t<0,this.x=i,this.y=r,this.animationFrame=requestAnimationFrame(this.step)}}setStageXY(e,t){(0,a.mutate)(this.projectUIState,(o=>{o.stage.webComp.controlValues.x=e,o.stage.webComp.controlValues.y=t}))}resetState(){this.animationFrame&&cancelAnimationFrame(this.animationFrame),this.start=null}elementRectVisibleInStage(e){if(!(0,Rd.Z)(this,Ud))return;const t=(0,Rd.Z)(this,Ud).getBoundingClientRect(),o=e.bottom*this.projectUIState.stage.webComp.controlValues.scale,n=e.top*this.projectUIState.stage.webComp.controlValues.scale,i=t.top;return o+i>Ld.Mz+$d.i&&n+i<window.innerHeight}},Pd=(0,s.Z)(Md.prototype,"projectUIState",[Cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad=(0,s.Z)(Md.prototype,"projectDoc",[Ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kd=(0,s.Z)(Md.prototype,"elementRefProvider",[xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d=Md));var Bd=o(918628);[`.breakpoints-selector-overflow-container.jsx-4243409230{z-index:${N.kg.TEN};position:absolute;top:0;left:0;bottom:0;right:0;overflow:visible;background:${N.DM.GRAY_300};height:24px;box-shadow:${N.E6.DARK_DROP};}`,".breakpoints-selector.jsx-4243409230{height:24px;-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;left:0;position:relative;}",`.breakpoints-selector.jsx-4243409230 .breakpoint-bar{z-index:2;height:24px;background:${N.DM.GRAY_300};border-left:0.5px solid ${N.DM.GRAY_100};border-right:0.5px solid ${N.DM.GRAY_100};margin:0 auto;}`,`.breakpoints-selector.jsx-4243409230 .breakpoint-bar.selected{background:${N.DM.GRAY_200};}`,".current-breakpoint-indicator.jsx-4243409230{max-width:430px;height:24px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;pointer-events:none;z-index:3;position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;}",".viewport-icon.jsx-4243409230{margin-right:8px;line-height:0;}"].__hash="4243409230";var Gd,Hd,zd,Yd,Vd,Wd,Kd,qd=o(412940);Gd=(0,c.provide)("stageMoveFlow"),Hd=(0,c.inject)("projectUIState"),zd=(0,c.inject)("projectDoc"),Gd((Vd=class{constructor(){(0,i.Z)(this,"projectUIState",Wd,this),(0,i.Z)(this,"projectDoc",Kd,this),(0,r.Z)(this,"animationFrame",void 0),(0,r.Z)(this,"direction",null),(0,r.Z)(this,"position",{x:0,y:0}),(0,r.Z)(this,"move",(()=>{(0,a.mutate)(this.projectUIState,(({stage:e})=>{const t=this.projectUIState.stage.webComp,o=null===t||void 0===t?void 0:t.controlValues.scale,n=1/Math.max(o,1)/75;switch(this.direction){case"top":return void(e.webComp.controlValues.y=Math.min(e.webComp.controlValues.y+n,1));case"bottom":return void(e.webComp.controlValues.y=Math.max(e.webComp.controlValues.y-n,0));case"left":return void(e.webComp.controlValues.x=Math.min(e.webComp.controlValues.x+n,1));case"right":return void(e.webComp.controlValues.x=Math.max(e.webComp.controlValues.x-n,0))}}))})),(0,r.Z)(this,"getDragNearStageMarginValue",(e=>{const t=document.body.clientWidth,o=document.body.clientHeight;if(e.x>t-Bd.ak-50)return"right";const n=this.projectUIState.layout.sidebarPanel?Bd.ak+Bd.ZR:Bd.ZR;return e.x<n+50?"left":e.y>o-50?"bottom":e.y<Ld.Mz+24+50?"top":null})),this.moveStage=this.moveStage.bind(this)}checkAndMoveStage(e){this.resetState(),this.position=e,this.animationFrame=requestAnimationFrame(this.moveStage)}centerStage(){(0,a.mutate)(this.projectUIState,(e=>{e.stage.webComp.controlValues.x=qd.m7.controlValues.x,e.stage.webComp.controlValues.y=qd.m7.controlValues.y}))}moveStage(){this.direction=this.getDragNearStageMarginValue({x:this.position.x,y:this.position.y}),this.projectUIState.drag.draggedEntity?this.direction&&(this.move(),this.animationFrame=requestAnimationFrame(this.moveStage)):this.resetState()}resetState(){this.animationFrame&&cancelAnimationFrame(this.animationFrame)}},Wd=(0,s.Z)(Vd.prototype,"projectUIState",[Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kd=(0,s.Z)(Vd.prototype,"projectDoc",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yd=Vd));var Jd=o(231545),Xd=o(107547),Qd=o(37794),ep=o(254068),tp=o(884481);const op=e=>{const{onDismiss:t,classToDelete:o,onSubmit:n}=e;return(0,F.jsxs)("div",{className:"delete-token-modal",children:[(0,F.jsxs)("div",{className:"modal-title",children:["Delete project class-",o.getName()]}),(0,F.jsx)(S.J,{type:"error",size:32}),(0,F.jsx)("p",{className:"warning-message",children:"You are about to remove a project class that is bound to nodes in the project. Doing this will unbind the class from all the nodes."}),(0,F.jsxs)("p",{className:"warning-message",children:[Object.keys("usedInNodes"in o?o.usedInNodes:{}).length," node/s bound to the project class."]}),(0,F.jsxs)("p",{className:"warning-message",children:["Are you sure you want to delete project class: ",o.getName()," from the list?"]}),(0,F.jsxs)("div",{className:"modal-buttons",children:[(0,F.jsx)(j.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Cancel"}),(0,F.jsx)(j.z,{style:"solid",colorScheme:"danger",onClick:n,children:"Delete"})]}),(0,F.jsx)("style",{children:tp.mZ})]})};var np=o(328681),ip=o(197488),rp=o(971162),sp=o(256240);const ap=e=>{const{onDismiss:t,categoryToDelete:o,onSubmit:n}=e;return(0,F.jsxs)("div",{className:"delete-token-modal",children:[(0,F.jsxs)("div",{className:"modal-title",children:["Delete project category-",o.name]}),(0,F.jsx)(S.J,{type:"error",size:32}),(0,F.jsx)("p",{className:"warning-message",children:"You are about to remove a project category and all its classes. Doing this will unbind all the classes from all the nodes and delete them."}),(0,F.jsxs)("p",{className:"warning-message",children:["Are you sure you want to delete category ",o.name," from the list?"]}),(0,F.jsxs)("div",{className:"modal-buttons",children:[(0,F.jsx)(j.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Cancel"}),(0,F.jsx)(j.z,{style:"solid",colorScheme:"danger",onClick:n,children:"Delete"})]}),(0,F.jsx)("style",{children:tp.mZ})]})};var cp,lp,dp,pp,up,hp,mp,yp,gp,fp,bp,Ip,vp,wp,Np,jp,Sp,Dp,Tp,Op,Fp,Cp,Ep,xp,_p,Mp,Pp;function Ap(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function kp(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ap(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ap(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}cp=(0,c.provide)("projectClassManagementFlow"),lp=(0,c.inject)("projectDoc"),dp=(0,c.inject)("projectUIState"),pp=(0,c.inject)("nodeStyleManagmentFlow"),up=(0,c.inject)("sharedbProjectSyncService"),hp=(0,c.inject)("designLanguageManagementFlow"),mp=(0,c.inject)("modalManagementFlow"),yp=(0,c.inject)("positioningService"),gp=(0,c.inject)("assetsManagementFlow"),fp=(0,c.inject)("sentryService"),bp=(0,h.G)(g.l.ADD_PROJECT_CLASS),Ip=(0,h.G)(g.l.ADD_PROJECT_CLASS),vp=(0,h.G)(g.l.DELETE_AND_UNBIND_PROJECT_CLASS),wp=(0,ep.u)(ep.j.UPDATE_CLASS_STYLE),Np=(0,h.G)(g.l.ADD_OR_UPDATE_PROJECT_CLASS),jp=(0,ep.u)(ep.j.UPDATE_CLASS_STYLE),cp((Dp=class{constructor(){(0,i.Z)(this,"projectDoc",Tp,this),(0,i.Z)(this,"projectUIState",Op,this),(0,i.Z)(this,"nodeStyleManagmentFlow",Fp,this),(0,i.Z)(this,"dbSync",Cp,this),(0,i.Z)(this,"designLanguageManagementFlow",Ep,this),(0,i.Z)(this,"modalManagementFlow",xp,this),(0,i.Z)(this,"positioningService",_p,this),(0,i.Z)(this,"assetsManagementFlow",Mp,this),(0,i.Z)(this,"sentryService",Pp,this)}init(){this.dbSync.mutate(this.projectDoc,(e=>{e.classes.init(this.projectDoc.designLanguage,sp.fY)}))}setSelectedClassFromClassesSidebar(e){(0,a.mutate)(this.projectUIState,(t=>{t.selection.sidebarClassId=e}))}setSelectedClassFromInspector(e){(0,a.mutate)(this.projectUIState,(t=>{t.selection.inspectorClassId=e}))}updateSimpleClassName(e){const{doc:t,classId:o,name:n}=e;if(!t)return;const i=t.classes.byId[o];if("simple"!==i.classType)throw new Error("Attempted to update simple class name for non-simple class!");i.updateName(n)}updateSubselectors(e){const{doc:t,classId:o,subselectors:n}=e;if(!t)return;const i=t.classes.byId[o];if("compound"!==i.classType)throw new Error("Attempted to update subselectors class for non-compound class!");i.updateSubselectors(n)}toggleSimpleClassOnNodes(e){const{classId:t,nodeIds:o}=e;(0,a.mutate)(this.projectDoc,(e=>{const n=e.classes.byId[t];if("compound"===n.classType)throw new Error("Attempted to disable a compound class on nodes!");o.forEach((e=>{n.disabledInNodes||(n.disabledInNodes={}),n.disabledInNodes[e]=!n.disabledInNodes[e]}))}))}bindClassToNodes({doc:e,classId:t,nodeIds:o}){e&&o.forEach((o=>{this.nodeStyleManagmentFlow.bindProjectStyleToNode({doc:e,refId:t,nodeId:o})}))}bindDefaultClassByNodePrimitive(e){var t;const{node:o,doc:n}=e;if(!o.primitiveType||!n)return;const i=Qd.VM[o.primitiveType];if(!i)return;const r=null===(t=this.projectDoc.classes.getAll().find((e=>e.getName(this.projectDoc.classes.byId)===i)))||void 0===t?void 0:t.id;if(!r)return;const s={id:r,type:"style-map",content:{mapType:"project-referenced",referenceId:r}};if("referencedStyles"in o){o.referencedStyles[s.id]=s;const e=n.classes.byId[r];if(!e)throw new Error(`Project is missing class from the style sheet - ${r}`);if("simple"!==e.classType)throw new Error(`Attempted to bind non-simple class to nodes - ${r}`);e.usedInNodes[o.id]=!0}}removeAllClassesFromNode(e){const{doc:t,nodeId:o}=e;if(!t)return;const n=t.nodes.getById(o);if(n&&"referencedStyles"in n){Object.values((null===n||void 0===n?void 0:n.referencedStyles)||{}).filter((e=>"project-referenced"===e.content.mapType)).forEach((e=>{this.nodeStyleManagmentFlow.unbindProjectStyleFromNodeIds({doc:t,nodeIds:[o],classId:e.id})}))}}getClassesUsedByNodes(e){return this.projectDoc.getUsedProjectClassesForNodesByPos(e).map((e=>e.id))}removeFromNodes({doc:e,classId:t,nodeIds:o}){e&&this.nodeStyleManagmentFlow.unbindProjectStyleFromNodeIds({doc:e,classId:t,nodeIds:o})}addSimpleClass(e){const{classToAdd:t,doc:o}=e;if(!o)return;const n=this.positioningService.getHighestAvailablePosition({entitiyCollection:o.classes.byId});t.pos=n;Object.values(o.classes.byId).find((e=>e.getName(o.classes.byId)===t.getName()))?(t.updateName((0,rp.kF)(this.projectDoc,t.getName())),o.classes.byId[t.id]=t):o.classes.byId[t.id]=t}addCompoundClass(e){const{classToAdd:t,doc:o}=e;if(!o)return;const n=this.positioningService.getHighestAvailablePosition({entitiyCollection:o.classes.byId});t.pos=n;Object.values(o.classes.byId).find((e=>e.getName(o.classes.byId)===t.getName(o.classes.byId)))||(o.classes.byId[t.id]=t)}deleteSimpleClassAndUnbind({doc:e,classId:t}){if(!e||!t)return;const o=this.findClassFromDoc(t,e);if("simple"!==o.classType)throw new Error("Attempted to delete and unbind non-simple class!");this.nodeStyleManagmentFlow.unbindProjectStyleFromNodeIds({doc:e,classId:t,nodeIds:Object.keys((null===o||void 0===o?void 0:o.usedInNodes)||{})}),this.assetsManagementFlow.removeClassRelationsFromAssets({doc:e,classId:t}),e.classes.getCompoundClasses().forEach((o=>{(o.rootClassId===t||o.getSubselectors().includes(t))&&delete e.classes.byId[o.id]})),delete e.classes.byId[t]}deleteStyle(e){const{classId:t,doc:o,identifier:n,key:i}=e;if(!o)return;const r=this.findClassFromDoc(t,o);if("string"===typeof n)return"desktop"===n?void r.deletePropertyByKey(i,o.assets):void r.deletePropertyFromStateCondition(i,n,o.assets);"number"===typeof n&&r.deletePropertyFromMediaCondition(i,n,o.assets)}addOrUpdate(e){var t,o;const{doc:n,classId:i,key:r,identifier:s,tokenId:a,oldKey:c}=e;let{value:l}=e;if(!n)return;l=null!==(t=null===(o=Object.values(n.assets.byId).find((e=>e.name===l)))||void 0===o?void 0:o.id)&&void 0!==t?t:l;const d=this.findClassFromDoc(i,n),p=(0,gl.BQ)(l).map((e=>n.assets.byId[e]));if(c&&this.deleteStyle({doc:n,classId:i,key:c,identifier:s}),"string"===typeof s)return"desktop"===s?(d.addPropertyToContent(kp({key:r,value:l},a&&{tokenId:a})),void p.forEach((e=>null===e||void 0===e?void 0:e.addClassRelation(i)))):(d.addPropertyToStateCondition(kp({key:r,value:l,identifier:s},a&&{tokenId:a})),void p.forEach((e=>null===e||void 0===e?void 0:e.addClassRelation(i))));"number"===typeof s&&(d.addPropertyToMediaCondition(kp(kp({},a&&{tokenId:a}),{},{key:r,value:l,viewPort:s})),p.forEach((e=>null===e||void 0===e?void 0:e.addClassRelation(i))))}deleteClass({doc:e,classId:t}){const o=null===e||void 0===e?void 0:e.classes.byId[t];o&&("simple"!==o.classType?(this.assetsManagementFlow.removeClassRelationsFromAssets({doc:e,classId:t}),delete e.classes.byId[t]):this.deleteSimpleClassAndCheckBoundNodes({doc:e,classId:t}))}deleteSimpleClassAndCheckBoundNodes({doc:e,classId:t}){const o=null===e||void 0===e?void 0:e.classes.byId[t];if(!o)return;if("simple"!==o.classType)throw new Error("Attempted to delete non-simple class and unbind nodes");if(Object.keys(o.usedInNodes||{}).length){const e=b.d.createCustomModal({data:{classToDelete:o},Component:op,onSubmit:()=>{this.deleteSimpleClassAndUnbind({classId:t}),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(e)}else this.deleteSimpleClassAndUnbind({doc:e,classId:t})}createAndBindClassToNode(e){const{nodeId:t,name:o}=e,n=this.getNewSimpleClassObjectWithNodeStyles({name:o,nodeId:t});return n?(this.dbSync.mutate(this.projectDoc,(e=>{e.classes.addProjectClass(n),this.resetNodeStylesAfterExtract({doc:e,nodeId:t,classId:n.id}),this.nodeStyleManagmentFlow.bindProjectStyleToNode({doc:e,refId:n.id,nodeId:t})})),n.id):null}createSimpleEmptyClass(e){const t=new np.J({pos:this.positioningService.getHighestAvailablePosition({entitiyCollection:this.projectDoc.classes.byId}),content:{},conditions:{},name:(0,rp.kF)(this.projectDoc,"classname"),categoryId:e||"",linkedTextStyles:{}});return this.dbSync.mutate(this.projectDoc,(e=>{e.classes.addProjectClass(t)})),t.id}createCompoundEmptyClass(e,t){var o;const n=(null===(o=this.projectDoc.classes.byId[e])||void 0===o?void 0:o.categoryId)||"",i=new ip.a({pos:this.positioningService.getHighestAvailablePosition({entitiyCollection:this.projectDoc.classes.byId}),content:{},conditions:{},categoryId:n,linkedTextStyles:{},rootClassId:e,subselectors:t||"p"});return i.updateSubselectors(this.projectDoc.classes.getUniqueClassSubselector(i,i.getSubselectors())),this.dbSync.mutate(this.projectDoc,(e=>{e.classes.addProjectClass(i)})),i.id}createFromNodeStyles(e){const{name:t,nodeId:o}=e,n=this.getNewSimpleClassObjectWithNodeStyles({name:t,nodeId:o});return n?(this.dbSync.mutate(this.projectDoc,(e=>{e.classes.addProjectClass(n),this.resetNodeStylesAfterExtract({doc:e,nodeId:o,classId:n.id})})),n.id):null}getMissingStatesForClass(e){const t=new Set(Object.values(ar.F)),o=this.projectDoc.classes.byId[e];return o?o.getMissingStates():Array.from(t)}addStyleState(e){const{doc:t,classId:o,state:n}=e;if(!t)return;const i=t.classes.byId[o];if(!i)return;const r=(0,ni.Ox)(),s={id:r,type:"element-state",content:{},meta:{state:n}};i.conditions[r]=s}removeStyleState(e){const{doc:t,classId:o,state:n}=e;if(!t)return;const i=t.classes.byId[o];if(!i)return;const r=Object.values(i.conditions).find((e=>"element-state"===e.type&&e.meta.state===n));r&&delete i.conditions[r.id]}removeTextStyleReferenceFromAllClass(e){const{doc:t,textStyleId:o}=e;t&&Object.values(t.classes.byId).forEach((e=>{delete e.linkedTextStyles[o]}))}addTextStyleReferenceToClass(e){const{doc:t,textStyleId:o,classId:n}=e;if(!t)return;const i=t.classes.byId[n];if(!i)throw new Error(`Trying to bind a text style to a class that does not exists - ${n}`);i.linkedTextStyles[o]=!0}removeTextStyleReferenceFromClass(e){const{doc:t,textStyleId:o,classId:n}=e;if(!t)return;const i=t.classes.byId[n];if(!i)throw new Error(`Trying to bind a text style to a class that does not exists - ${n}`);delete i.linkedTextStyles[o]}unbindTokenFromClasses(e){const{doc:t,tokenId:o}=e;if(!t)return;const n=t.designLanguage.tokensById[o];if(!n)throw new Error(`Token which needs to unbind is not found in project - ${o}`);Object.values(t.classes.byId||{}).forEach((e=>{const{content:t,conditions:o}=e;this.replaceTokenToStatic(t,n.id,n.value),Object.values(o).forEach((e=>{null!==e&&void 0!==e&&e.content&&this.replaceTokenToStatic(e.content,n.id,n.value)}))}))}editContentKeysInClassWhereTokenIsUsed(e){const{doc:t,tokenId:o,keysToEdit:n}=e;t&&Object.values(t.classes.byId||{}).forEach((e=>{const{content:t,conditions:i}=e;this.replaceTokenKeyInContent(t,o,n),Object.values(i).forEach((e=>{null!==e&&void 0!==e&&e.content&&this.replaceTokenKeyInContent(e.content,o,n)}))}))}findTokenReferencesInClasses(e){const t={};return Object.values(this.projectDoc.classes.byId||{}).forEach((o=>{const{content:n,conditions:i}=o;let r=this.countTokenReferencesInContent(n,e);Object.values(i).forEach((t=>{null!==t&&void 0!==t&&t.content&&(r+=this.countTokenReferencesInContent(t.content,e))})),r&&(t[o.id]=r)})),t}countTokenReferencesInContent(e,t){let o=0;return Object.keys(e).forEach((n=>{const i=e[n];"dynamic"===i.type&&"token"===i.content.referenceType&&i.content.id===t&&o++})),o}duplicateClass(e){const{classId:t,doc:o}=e;if(!o)return;const n=this.projectDoc.classes.byId[t];if(!n)return null;const i=n.clone((0,rp.kF)(this.projectDoc,n.getName(this.projectDoc.classes.byId)));i.categoryId=n.categoryId,i.pos=this.positioningService.getPositionAfterEntity({entitiyCollection:this.projectDoc.classes.byId,entity:n}),"simple"===i.classType&&i.updateName(this.projectDoc.classes.getUniqueClassName(n.getName(o.classes.byId))),"compound"===i.classType&&i.updateSubselectors(this.projectDoc.classes.getUniqueClassSubselector(i,i.getSubselectors())),Object.values(o.assets.byId).forEach((e=>{var t;null!==(t=e.usedInClasses)&&void 0!==t&&t[n.id]&&(e.usedInClasses[i.id]=e.usedInClasses[n.id])})),o.classes.addProjectClass(i)}createDescendantClassWithStylesAndSelect(e){const{doc:t,classId:o}=e;if(!t)return;const n=t.classes.byId[o];if("simple"!==n.classType)throw new Error("Attempted to create descendat class from non-simple class!");const i=Object.values(this.projectDoc.classes.categoriesById||{})[0].id,r=new ip.a({pos:this.positioningService.getHighestAvailablePosition({entitiyCollection:this.projectDoc.classes.byId}),content:n.cloneStylesObject(n.content),conditions:n.cloneConditions(n.conditions),categoryId:i,linkedTextStyles:{},rootClassId:n.id,subselectors:"p"});r.updateSubselectors(this.projectDoc.classes.getUniqueClassSubselector(r,r.getSubselectors())),t.classes.addProjectClass(r),setTimeout((()=>{this.setSelectedClassFromClassesSidebar(r.id)}),50)}extractCurrentNodeStylesToClass(e){const{nodeId:t,classId:o,doc:n}=e;if(!n)return;let i={},r={},s={};const a=this.getNodeStylesForClass({nodeId:t});i=(null===a||void 0===a?void 0:a.styles)||{},r=(null===a||void 0===a?void 0:a.conditions)||{},s=(null===a||void 0===a?void 0:a.textStyles)||{};const c=n.classes.byId[o];c.content=i,c.conditions=r,c.linkedTextStyles=s,this.designLanguageManagementFlow.unBindTextStyleFromNodes({doc:n,nodeIds:[t],textStyleId:Object.keys(s)[0]}),this.resetNodeStylesAfterExtract({doc:n,nodeId:t,classId:o})}extractStylesFromClassToNode(e){var t;const{classId:o,doc:n,targetNodeId:i}=e;if(!n||!o||!i)return;const r=n.nodes.getById(i);if(!r)return;const s=n.classes.byId[o];if(!s)return;const a={},c=null===s||void 0===s?void 0:s.cloneStylesObject(null!==(t=null===s||void 0===s?void 0:s.content)&&void 0!==t?t:{},a),l=Object.values((null===s||void 0===s?void 0:s.conditions)||{}).reduce(((e,t)=>{const o={id:(0,ni.Ox)(),type:"style-map",content:{mapType:"inlined",conditions:"element-state"===t.type?[{conditionType:"element-state",content:t.meta.state}]:[{conditionType:"screen-size",maxWidth:t.meta.maxWidth}],styles:null===s||void 0===s?void 0:s.cloneStylesObject((null===t||void 0===t?void 0:t.content)||{},a)}};return e[o.id]=o,e}),{}),d=n.designLanguage.textStyleSetsById[Object.keys((null===s||void 0===s?void 0:s.linkedTextStyles)||{})[0]];if(d){const e={id:(0,ni.Ox)(),type:"style-map",content:{referenceId:d.id,mapType:"design-language-referenced"}};l[e.id]=e,d.usedInNodes[i]=!0}if(s.content={},s.conditions={},s.linkedTextStyles={},"referencedStyles"in r){const e=Object.values(r.referencedStyles).reduce(((e,t)=>("project-referenced"===t.content.mapType&&(e[t.id]=t),e)),{});r.referencedStyles=l,Object.entries(e).forEach((([e,t])=>{r.referencedStyles[e]=t})),r.styles=c,Object.entries(a).forEach((([e,t])=>{const o=n.designLanguage.tokensById[e];o&&(o.usedInNodes[i]=t)})),this.transferAssetRelationsFromClassToNode({doc:n,nodeId:i,classId:o})}}checkIfNodeStylesIsEmpty(e){const t=this.getNodeStylesForClass({nodeId:e});let o=!0;const n=(null===t||void 0===t?void 0:t.conditions)||{};for(const i in n)Object.keys(n[i].content).length>0&&(o=!1);return!(null!==t&&void 0!==t&&t.styles&&null!==t&&void 0!==t&&t.textStyles&&null!==t&&void 0!==t&&t.conditions&&(Object.keys(t.styles).length>0||Object.keys(t.textStyles).length>0||!o))}updateClassWithCurrentNodeStyles(e){const{classId:t,doc:o,nodeId:n}=e;if(!o||!t||!n)return;let i={},r={},s={};const a=this.getNodeStylesForClass({nodeId:n});i=(null===a||void 0===a?void 0:a.styles)||{},r=(null===a||void 0===a?void 0:a.conditions)||{},s=(null===a||void 0===a?void 0:a.textStyles)||{};const c=o.classes.byId[t];c.content=kp(kp({},c.content),i),Object.values(r).forEach((e=>{const t=Object.values(c.conditions).find((t=>"element-state"===t.type?t.type===e.type&&t.meta.state===e.meta.state:"screen-size"===t.type?t.type===e.type&&t.meta.maxWidth===e.meta.maxWidth:void 0));t?c.conditions[t.id].content=kp(kp({},t.content),e.content):c.conditions[e.id]=e}));const l=Object.keys(s)[0];l&&(Object.keys(c.linkedTextStyles).forEach((e=>{delete c.linkedTextStyles[e]})),c.linkedTextStyles[l]=!0,this.designLanguageManagementFlow.unBindTextStyleFromNodes({doc:o,nodeIds:[n],textStyleId:l})),this.resetNodeStylesAfterExtract({doc:o,nodeId:n,classId:t})}resetNodeStylesAfterExtract(e){const{doc:t,nodeId:o,classId:n}=e;if(!t||!o)return;const i=t.nodes.getById(o);if(i&&"referencedStyles"in i){if(i.styles={},Object.keys(i.referencedStyles||{}).forEach((e=>{"project-referenced"!==i.referencedStyles[e].content.mapType&&delete i.referencedStyles[e]})),i.primitiveType===Zn.sO.IMAGE||i.primitiveType===Zn.sO.VIDEO)return;n?this.transferAssetRelationsFromNodeToClass({nodeId:o,classId:n,doc:t}):this.assetsManagementFlow.removeNodeRelationsFromAssets({nodeId:o,doc:t})}}transferAssetRelationsFromNodeToClass(e){const{doc:t,nodeId:o,classId:n}=e;t&&Object.values(t.assets.byId).forEach((e=>{e.usedInNodes[o]&&(e.usedInClasses||(e.usedInClasses={}),e.usedInClasses[n]=1,delete e.usedInNodes[o])}))}transferAssetRelationsFromClassToNode(e){const{doc:t,nodeId:o,classId:n}=e;t&&Object.values(t.assets.byId).forEach((e=>{var t;null!==(t=e.usedInClasses)&&void 0!==t&&t[n]&&(e.usedInNodes[o]=!0,delete e.usedInClasses[n])}))}getNewSimpleClassObjectWithNodeStyles(e){const{name:t,nodeId:o}=e;if(this.projectDoc.classes.getAll().find((e=>e.getName(this.projectDoc.classes.byId).toLowerCase()===t.toLowerCase())))return null;let n={},i={},r={};if(o){const e=this.getNodeStylesForClass({nodeId:o});n=(null===e||void 0===e?void 0:e.styles)||{},i=(null===e||void 0===e?void 0:e.conditions)||{},r=(null===e||void 0===e?void 0:e.textStyles)||{}}const s=Object.values(this.projectDoc.classes.categoriesById||{})[0].id;return new np.J({pos:this.positioningService.getHighestAvailablePosition({entitiyCollection:this.projectDoc.classes.byId}),content:n,conditions:i,name:t,categoryId:s,linkedTextStyles:r})}findClassFromDoc(e,t){const o=t.classes.byId[e];if(!o)throw new Error(`Class is missing from project - ${e}`);return o}replaceTokenToStatic(e,t,o){Object.keys(e).forEach((n=>{const i=e[n];"dynamic"===i.type&&"token"===i.content.referenceType&&i.content.id===t&&(e[n]=new Yr.F({content:o}))}))}replaceTokenKeyInContent(e,t,o){Object.keys(e).forEach((n=>{const i=e[n];if("dynamic"===i.type&&"token"===i.content.referenceType&&i.content.id===t){const t=o[n];t&&(e[t]=i,delete e[n])}}))}getNodeStylesForClass({nodeId:e}){const t=this.projectDoc;if(!t.nodes.getById(e))return;const o=new Set(this.projectDoc.mediaQueryBreakpoints.getNonDefaultActiveMQBreakpointsInOrder().map((e=>e.maxWidth))),n=Xd.S.execute({doc:t,nodeId:e})||{},i=Jd.l.execute({doc:t,nodeId:e}),r={},s=Object.values(i||{}).reduce(((e,t)=>{var n,i;if("design-language-referenced"===t.content.mapType&&(r[t.content.referenceId]=!0),"inlined"===t.content.mapType&&1===(null===(n=t.content)||void 0===n||null===(i=n.conditions)||void 0===i?void 0:i.length))switch(t.content.conditions[0].conditionType){case"screen-size":{const n={id:(0,ni.Ox)(),type:"screen-size",content:t.content.styles,meta:{maxWidth:t.content.conditions[0].maxWidth}};o.has(n.meta.maxWidth)&&o.delete(n.meta.maxWidth),e[n.id]=n;break}case"element-state":{const o={id:(0,ni.Ox)(),type:"element-state",content:t.content.styles,meta:{state:t.content.conditions[0].content}};e[o.id]=o;break}}return e}),{});return o.size>0&&Array.from(o).forEach((e=>{const t={id:(0,ni.Ox)(),type:"screen-size",meta:{maxWidth:e},content:{}};s[t.id]=t})),{styles:n,conditions:s,textStyles:r}}updateCompoundClassRoot(e){const{doc:t,compoundClassId:o,newRootClassId:n}=e;if(!t)return;const i=t.classes.byId[o];if(!i||"compound"!==i.classType)throw new Error(`Attempted to update root class for class that's missing or is not compound! Id: ${o}`);const r=t.classes.byId[n];if(!r||"simple"!==r.classType)throw new Error(`Attempted to update root class for a compound class with a nonexisting or simple class! Compound class Id: ${o}, class id: ${n}`);const s=this.projectDoc.classes.getCompoundClassesForSimpleClass(n).map((e=>e.getSubselectors()));i.updateSubselectors((0,l.Zu)(s,i.getSubselectors())),i.updateRootClassId(n)}getResolvedStylesForRendering(e="stage"){const t=Object.values(this.projectDoc.classes.getSortedClassesListByPos()),o={},n={};let i="";return t.forEach((t=>{const{content:i,conditions:r}=t,s=this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:i,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:"stage"===e});o[t.getIdentifier(this.projectDoc.classes.byId)]=(0,dr.$e)(s,e),Object.keys(r).forEach((i=>{const s=r[i];if("preview"===e&&"element-state"===s.type&&Object.keys((null===s||void 0===s?void 0:s.content)||{}).length>0){const{state:n}=s.meta;o[`${t.getIdentifier(this.projectDoc.classes.byId)}:${n}`]=(0,dr.$e)(this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:s.content,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0}),e)}if("screen-size"===s.type&&Object.keys(s.content||{}).length>0){const{maxWidth:o}=s.meta;n[String(o)]=kp(kp({},n[String(o)]),{},{[t.getIdentifier(this.projectDoc.classes.byId)]:(0,dr.$e)(this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:s.content,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:"stage"===e}),e)})}}))})),i=(0,dr.f7)(o)+"\n",Object.keys(n).sort(((e,t)=>Number(e)-Number(t))).reverse().forEach((e=>{const t=n[e]||{};let o=`\n@media(max-width: ${e}px) {`;o=o+(0,dr.f7)(t)+"\n",o+="}\n",i+=o})),i}getResolvedInteractionStateForClasses(e){const t=this.positioningService.orderEntities({entitiyCollection:this.projectDoc.classes.byId,entitiesOfInterest:e});let o={};return t.forEach((e=>{const t=this.projectDoc.classes.byId[e];if(!t)return;const{conditions:n}=t;Object.keys(n).forEach((e=>{const t=n[e];"element-state"===t.type&&t.meta.state===this.projectUIState.stage.interactionState.state&&Object.keys((null===t||void 0===t?void 0:t.content)||{}).length>0&&(o=kp(kp({},o),this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:t.content,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0})))}))})),o}toggleClassPropertyByKey(e){const{classId:t,identifier:o,key:n}=e;(0,a.mutate)(this.projectDoc,(e=>{const i=this.findClassFromDoc(t,e);if("string"===typeof o)return"desktop"===o?void i.togglePropertyByKey(n):void i.togglePropertyFromStateCondition(n,o);"number"!==typeof o||i.togglePropertyFromMediaCondition(n,o)}))}checkForClassNameAndTextStyleNameCollision(e){const t=Object.values(this.projectDoc.classes.byId).map((e=>(null===e||void 0===e?void 0:e.getName(this.projectDoc.classes.byId))||"")),o=Object.values(this.projectDoc.designLanguage.textStyleSetsById).map((e=>(null===e||void 0===e?void 0:e.name)||""));return t.includes(e)||o.includes(e)}createClassCategory(e){const{categoryName:t,isDefault:o,doc:n}=e;if(!n)return;const i=(0,ni.Ox)(),r=(0,l.Zu)(Object.values(n.classes.categoriesById).map((e=>e.name)),t.slice(0,30));return n.classes.categoriesById[i]={name:r,id:i,isDefault:o},i}getOrCreateClassCategory(e){const{categoryName:t,doc:o}=e;if(!o)return;const n=Object.values(o.classes.categoriesById).find((e=>e.name===t));return n?n.id:this.createClassCategory({categoryName:t,doc:o})}renameClassCategory(e){const{categoryId:t,doc:o,newName:n}=e;if(!o)return;const i=o.classes.categoriesById[t];if(i)i.name=(0,l.Zu)(Object.values(o.classes.categoriesById).map((e=>e.name)),n.slice(0,30));else{const e=new Error(`Attempted to rename category with id ${t} but could not find it.`);this.sentryService.captureException(e)}}moveClassToCategory(e){const{classId:t,categoryId:o,doc:n}=e;if(!n)return;const i=n.classes.byId[t];if(!i){const e=new Error(`Attempted to move class with id ${t} to a new category but could not find it.`);return void this.sentryService.captureException(e)}const r="rootClassId"in i?i.rootClassId:i.id;Object.values(n.classes.byId).forEach((e=>{if(e.id===r||"rootClassId"in e&&e.rootClassId===r){if("Uncategorized"===o)return void(e.categoryId="");e.categoryId=o}}))}deleteClassCategory(e){const{categoryId:t,deleteClasses:o,doc:n}=e;if(!n)return;const i=n.classes.categoriesById[t];if(i.isDefault)return void this.sentryService.captureException("Attempted to delete default category!");const r=[];for(const s of Object.values(n.classes.byId))if(s.categoryId===t){if(s.isDefault&&o)return;r.push(s)}o&&r.length?this.deleteCategoryAndClassesWithConfirmation({classesToDelete:r,categoryToDelete:i}):(r.forEach((e=>{e.categoryId=""})),delete n.classes.categoriesById[t])}deleteCategoryAndClassesWithConfirmation(e){const{categoryToDelete:t}=e;if(!t)return;const o=b.d.createCustomModal({data:{categoryToDelete:t},Component:ap,onSubmit:()=>{this.deleteCategoryAndClasses(e),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(o)}deleteCategoryAndClasses(e){const{doc:t,classesToDelete:o,categoryToDelete:n}=e;t&&n&&(o.forEach((e=>{this.deleteClass({classId:e.id,doc:t})})),delete t.classes.categoriesById[n.id])}mergeAndOverwriteClassContent(e){const{classId:t,newStyles:o,conditions:n,doc:i}=e;if(!i)return;const r=this.findClassFromDoc(t,i);o&&(r.content=kp(kp({},r.content),o)),n&&(r.conditions=kp(kp({},r.conditions),n))}getResolvedCSSClassStylesheet(){const e=Object.values(this.projectDoc.classes.getSortedClassesListByPos()),t={},o={};let n="";return e.forEach((e=>{const{content:n,conditions:i}=e,r=this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:n,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:!0}),s=e.getName(this.projectDoc.classes.getSortedClassesListByPos());t[s]=(0,dr.$e)(r,"preview"),Object.keys(i).forEach((e=>{const n=i[e];if("element-state"===n.type&&n.meta.state===this.projectUIState.stage.interactionState.state&&Object.keys((null===n||void 0===n?void 0:n.content)||{}).length>0&&(t[`${s}:${n.meta.state}`]=(0,dr.$e)(this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:n.content,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0}),"preview")),"screen-size"===n.type&&Object.keys(n.content||{}).length>0){const{maxWidth:e}=n.meta;o[String(e)]=kp(kp({},o[String(e)]),{},{[s]:(0,dr.$e)(this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:n.content,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:!1}),"preview")})}}))})),n=(0,dr.f7)(t)+"\n",Object.keys(o).sort(((e,t)=>Number(e)-Number(t))).reverse().forEach((e=>{const t=o[e]||{};let i=`\n@media(max-width: ${e}px) {`;i=i+(0,dr.f7)(t)+"\n",i+="}\n",n+=i})),n}},Tp=(0,s.Z)(Dp.prototype,"projectDoc",[lp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Op=(0,s.Z)(Dp.prototype,"projectUIState",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fp=(0,s.Z)(Dp.prototype,"nodeStyleManagmentFlow",[pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cp=(0,s.Z)(Dp.prototype,"dbSync",[up],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ep=(0,s.Z)(Dp.prototype,"designLanguageManagementFlow",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp=(0,s.Z)(Dp.prototype,"modalManagementFlow",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_p=(0,s.Z)(Dp.prototype,"positioningService",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mp=(0,s.Z)(Dp.prototype,"assetsManagementFlow",[gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pp=(0,s.Z)(Dp.prototype,"sentryService",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Dp.prototype,"updateSimpleClassName",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"updateSimpleClassName"),Dp.prototype),(0,s.Z)(Dp.prototype,"updateSubselectors",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"updateSubselectors"),Dp.prototype),(0,s.Z)(Dp.prototype,"bindClassToNodes",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"bindClassToNodes"),Dp.prototype),(0,s.Z)(Dp.prototype,"bindDefaultClassByNodePrimitive",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"bindDefaultClassByNodePrimitive"),Dp.prototype),(0,s.Z)(Dp.prototype,"removeAllClassesFromNode",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"removeAllClassesFromNode"),Dp.prototype),(0,s.Z)(Dp.prototype,"removeFromNodes",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"removeFromNodes"),Dp.prototype),(0,s.Z)(Dp.prototype,"addSimpleClass",[bp,m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"addSimpleClass"),Dp.prototype),(0,s.Z)(Dp.prototype,"addCompoundClass",[Ip,m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"addCompoundClass"),Dp.prototype),(0,s.Z)(Dp.prototype,"deleteSimpleClassAndUnbind",[vp,m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"deleteSimpleClassAndUnbind"),Dp.prototype),(0,s.Z)(Dp.prototype,"deleteStyle",[m.P,wp],Object.getOwnPropertyDescriptor(Dp.prototype,"deleteStyle"),Dp.prototype),(0,s.Z)(Dp.prototype,"addOrUpdate",[Np,m.P,jp],Object.getOwnPropertyDescriptor(Dp.prototype,"addOrUpdate"),Dp.prototype),(0,s.Z)(Dp.prototype,"deleteClass",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"deleteClass"),Dp.prototype),(0,s.Z)(Dp.prototype,"deleteSimpleClassAndCheckBoundNodes",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"deleteSimpleClassAndCheckBoundNodes"),Dp.prototype),(0,s.Z)(Dp.prototype,"addStyleState",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"addStyleState"),Dp.prototype),(0,s.Z)(Dp.prototype,"removeStyleState",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"removeStyleState"),Dp.prototype),(0,s.Z)(Dp.prototype,"removeTextStyleReferenceFromAllClass",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"removeTextStyleReferenceFromAllClass"),Dp.prototype),(0,s.Z)(Dp.prototype,"addTextStyleReferenceToClass",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"addTextStyleReferenceToClass"),Dp.prototype),(0,s.Z)(Dp.prototype,"removeTextStyleReferenceFromClass",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"removeTextStyleReferenceFromClass"),Dp.prototype),(0,s.Z)(Dp.prototype,"editContentKeysInClassWhereTokenIsUsed",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"editContentKeysInClassWhereTokenIsUsed"),Dp.prototype),(0,s.Z)(Dp.prototype,"duplicateClass",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"duplicateClass"),Dp.prototype),(0,s.Z)(Dp.prototype,"createDescendantClassWithStylesAndSelect",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"createDescendantClassWithStylesAndSelect"),Dp.prototype),(0,s.Z)(Dp.prototype,"extractCurrentNodeStylesToClass",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"extractCurrentNodeStylesToClass"),Dp.prototype),(0,s.Z)(Dp.prototype,"extractStylesFromClassToNode",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"extractStylesFromClassToNode"),Dp.prototype),(0,s.Z)(Dp.prototype,"updateClassWithCurrentNodeStyles",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"updateClassWithCurrentNodeStyles"),Dp.prototype),(0,s.Z)(Dp.prototype,"resetNodeStylesAfterExtract",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"resetNodeStylesAfterExtract"),Dp.prototype),(0,s.Z)(Dp.prototype,"transferAssetRelationsFromNodeToClass",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"transferAssetRelationsFromNodeToClass"),Dp.prototype),(0,s.Z)(Dp.prototype,"transferAssetRelationsFromClassToNode",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"transferAssetRelationsFromClassToNode"),Dp.prototype),(0,s.Z)(Dp.prototype,"updateCompoundClassRoot",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"updateCompoundClassRoot"),Dp.prototype),(0,s.Z)(Dp.prototype,"createClassCategory",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"createClassCategory"),Dp.prototype),(0,s.Z)(Dp.prototype,"getOrCreateClassCategory",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"getOrCreateClassCategory"),Dp.prototype),(0,s.Z)(Dp.prototype,"renameClassCategory",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"renameClassCategory"),Dp.prototype),(0,s.Z)(Dp.prototype,"moveClassToCategory",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"moveClassToCategory"),Dp.prototype),(0,s.Z)(Dp.prototype,"deleteClassCategory",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"deleteClassCategory"),Dp.prototype),(0,s.Z)(Dp.prototype,"deleteCategoryAndClasses",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"deleteCategoryAndClasses"),Dp.prototype),(0,s.Z)(Dp.prototype,"mergeAndOverwriteClassContent",[m.P],Object.getOwnPropertyDescriptor(Dp.prototype,"mergeAndOverwriteClassContent"),Dp.prototype),Sp=Dp));var Up=o(622794),Rp=o(209294);const Zp=new class{constructor(){(0,r.Z)(this,"execute",(e=>{const{doc:t,targetNodeId:o,nodeId:n}=e;if(!t)return null;const i=t.nodes.getById(n);if(!i)throw new Error("Node to clone referencedStyles is missing");if(!("referencedStyles"in i))throw new Error("Node does not have referencedStyles abilities");return Object.keys(i.referencedStyles||{}).reduce(((e,n)=>{const r=i.referencedStyles[n],{type:s,content:a}=r;if("style-map"===s&&"project-referenced"===a.mapType){const n=a.referenceId;e[n]={id:n,type:"style-map",content:{mapType:"project-referenced",referenceId:a.referenceId}};const i=t.classes.byId[a.referenceId];if(!i||!o||!("usedInNodes"in i))return e;i.usedInNodes[o]=!0}return e}),{})}))}};Object.freeze(Zp);var Lp,$p,Bp,Gp,Hp,zp,Yp,Vp,Wp,Kp=o(738470);let qp;!function(e){e.ACTIONABLE="isActionable",e.CLASS_NAME="className"}(qp||(qp={}));Lp=(0,c.provide)("htmlValidator"),$p=(0,c.inject)("cssToDomainFlow"),Bp=(0,c.inject)("projectDoc"),Gp=(0,c.inject)("workersProvider"),Lp((zp=class{constructor(){(0,i.Z)(this,"cssToDomainFlow",Yp,this),(0,i.Z)(this,"projectDoc",Vp,this),(0,i.Z)(this,"workersProvider",Wp,this),(0,r.Z)(this,"validateHtmlCode",(async e=>{const{code:t,checkIfTeleportCompatible:o}=e,n=await this.workersProvider.generateHtmlTreeFromCode(t),i=[];return Object.values((null===n||void 0===n?void 0:n.nodes)||{}).map((e=>{if(!e.tag||!e.tagNumber)return;const r=e.isClosingTag?`/${e.tag}`:e.tag,s=[];if(o&&s.push(...this.checkIfNodeIsTeleportCompatible(e,n.nodes)),"style"===e.tag){const t=Object.values(e.children);var a;if(t.length>1)s.push({message:"Style tag should not host other tags.",type:"CSS",severity:"error"});else s.push(...this.processStyleTagContent({content:(null===(a=t[0])||void 0===a?void 0:a.content)||"",checkIfTeleportCompatible:o}))}if(e.ended||s.push({message:`Unended tag "${e.tag}"`,type:"HTML",severity:"error"}),e.closed||s.push({message:`Unclosed tag "${e.tag}"`,type:"HTML",severity:"error"}),e.error&&s.push({message:e.error,type:"HTML",severity:"error"}),s.length){const o=this.getNewlinesUpToNthWord(t,this.generateRegexForTag(r),e.tagNumber);s.forEach((e=>e.line=e.line?e.line+o:o)),i.push(...s)}})),i}))}checkIfNodeIsTeleportCompatible(e,t){var o;const n=[];this.checkIfTokenIsTeleportCompatible(e.tag)||n.push({message:`Tag "${e.tag}" cannot be imported to teleport.`,type:"HTML",severity:"error"});const i=Object.values(Zn.RY);"br"!==e.tag||i.includes((null===(o=t[e.parentId||""])||void 0===o?void 0:o.tag)||"")||n.push({message:"For a good experience, linebreaks should only be used inside text tags.",type:"HTML",severity:"warning"});const r=t[e.parentId||""],s=t[(null===r||void 0===r?void 0:r.parentId)||""];return i.includes(null===r||void 0===r?void 0:r.tag)&&(["br","span"].includes(e.tag)||n.push({message:'Only "span" and "br" tags are supported inside other text tags. We\'ll try to convert them.',type:"HTML",severity:"warning"}),e.attributes.class&&n.push({message:"Classes are not supported on nested text nodes. We will save the class styles onto the node itself.",type:"CSS",severity:"warning"})),i.includes(e.tag)&&i.includes(null===r||void 0===r?void 0:r.tag)&&i.includes(null===s||void 0===s?void 0:s.tag)&&n.push({message:"We only support up to two levels of nested text elements.",type:"HTML",severity:"error"}),n}processStyleTagContent(e){const{content:t,checkIfTeleportCompatible:o}=e,n=[];try{if(o){const e=this.cssToDomainFlow.convertCSSToClass(t).classes;Object.values(e).forEach((e=>{Object.values(this.projectDoc.classes.byId).find((t=>t.getName(this.projectDoc.classes.byId)===e.getName()))&&n.push({message:`Class "${e.getName()}" already in project. By default, we will merge and overwrite it with the contents in the style tag.`,type:"CSS",severity:"warning",meta:{[qp.CLASS_NAME]:e.getName(),[qp.ACTIONABLE]:!0}})}))}else(0,rr.parse)(t)}catch(i){const{message:e,line:t}=this.processCssError(i);n.push({message:e,type:"CSS",severity:"error",line:t})}finally{return n}}processCssError(e){var t;const o=e.message.split(" "),n=null===(t=o[1])||void 0===t?void 0:t.split(":"),i=o.join(" ");if(null===n||void 0===n||!n[1])return{message:i,line:0};return{message:i,line:parseInt(n[1])-2}}getNewlinesUpToNthWord(e,t,o){return e.split(t,o).join().split(/\r\n|\r|\n/).length}generateRegexForTag(e){return new RegExp(`<${e}[\n\rs> ]`,"gs")}checkIfTokenIsTeleportCompatible(e){return[...Object.values(Zn.qo),...Object.values(Zn.iX),...Object.values(Zn.gt),...Object.values(Zn.RY),...Object.values(Zn.mw),...Object.values(Zn.sO),"hr","style","script"].includes((0,Kp.xu)(e))}},Yp=(0,s.Z)(zp.prototype,"cssToDomainFlow",[$p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vp=(0,s.Z)(zp.prototype,"projectDoc",[Bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wp=(0,s.Z)(zp.prototype,"workersProvider",[Gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hp=zp));var Jp,Xp,Qp,eu,tu,ou,nu,iu,ru,su=o(180253);!function(e){e.MERGE_CLASS="Merge",e.DUPLICATE="Duplicate"}(ru||(ru={}));let au=(Jp=(0,c.inject)("htmlValidator"),Xp=(0,c.inject)("workersProvider"),Qp=(0,c.inject)("notificationsManagementFlow"),iu=new WeakMap,eu=class extends w.PureComponent{constructor(...e){super(...e),(0,i.Z)(this,"htmlValidator",tu,this),(0,i.Z)(this,"workersProvider",ou,this),(0,i.Z)(this,"notificationsManagementFlow",nu,this),(0,r.Z)(this,"state",{validationErrors:[],code:this.props.code||"",isFormatting:!1,classNamesToDuplicate:{},isSubmitting:!1}),iu.set(this,{writable:!0,value:null}),(0,r.Z)(this,"handleValidation",(()=>{(0,Rd.Z)(this,iu)&&clearTimeout((0,Rd.Z)(this,iu)),(0,Zd.Z)(this,iu,setTimeout((()=>{this.validateCode()}),350))})),(0,r.Z)(this,"handleSubmit",(async()=>{this.setState({isSubmitting:!0}),await this.props.onSubmit(this.state.code,this.state.classNamesToDuplicate),this.setState({isSubmitting:!1})})),(0,r.Z)(this,"toggleClassNameDuplication",(e=>{const t=this.state.classNamesToDuplicate;t[e]=!t[e],this.setState({classNamesToDuplicate:t})})),(0,r.Z)(this,"handlePrettify",(async()=>{this.setState({isFormatting:!0}),this.workersProvider.prettify(this.state.code,"code.html",(async e=>{this.validateCode(),this.setState({code:e,isFormatting:!1})}),(()=>{this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Failed to run prettier, please check the syntax."),this.setState({isFormatting:!1})}))})),(0,r.Z)(this,"handleChange",(e=>{this.setState({code:e}),this.handleValidation()}))}componentDidMount(){this.handleValidation()}componentWillUnmount(){(0,Rd.Z)(this,iu)&&clearTimeout((0,Rd.Z)(this,iu))}async validateCode(){const e=await this.htmlValidator.validateHtmlCode({code:this.state.code,checkIfTeleportCompatible:this.props.checkIfTeleportCompatible}),t=[];if(!e.length)return void this.setState({validationErrors:t});const o=[],n=[];e.forEach((e=>{const t=e.line?`Line ${e.line}: `:"",i=[];"HTML"!==e.type?(e.meta&&!0===e.meta[qp.ACTIONABLE]&&"string"===typeof e.meta[qp.CLASS_NAME]&&i.push({description:ru.DUPLICATE,onClick:()=>{var t;return this.toggleClassNameDuplication(null===(t=e.meta)||void 0===t?void 0:t[qp.CLASS_NAME])},state:this.state.classNamesToDuplicate[e.meta[qp.CLASS_NAME]]}),o.push({label:`${t}${e.message}`,line:e.line,message:e.message,severity:e.severity,actions:i})):n.push({label:`${t}${e.message}`,message:e.message,line:e.line,severity:e.severity,actions:i})})),n.length&&t.push({label:"HTML",issuesCount:n.length,displayInBottomBar:!0},...n),o.length&&t.push({label:"CSS",issuesCount:o.length,displayInBottomBar:!0},...o),(0,Zd.Z)(this,iu,null),this.setState({validationErrors:t})}render(){const{onDismiss:e,title:t,allowSaveWithErrors:o}=this.props,{validationErrors:n,code:i,isFormatting:r,isSubmitting:s}=this.state;return(0,F.jsx)(su.I,{title:t||"HTML Editor",submitButton:"Save",submitButtonState:{loading:s,colorScheme:"accent",style:"solid",disabled:!o&&n.some((e=>"error"===e.severity))},code:i,language:"html",validationErrors:n,onSubmit:this.handleSubmit,onDismiss:e,onFormat:this.handlePrettify,onChange:this.handleChange,isFormatting:r})}},tu=(0,s.Z)(eu.prototype,"htmlValidator",[Jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ou=(0,s.Z)(eu.prototype,"workersProvider",[Xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nu=(0,s.Z)(eu.prototype,"notificationsManagementFlow",[Qp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eu);var cu=o(704614),lu=o(751433),du=o(81359),pu=o(727309);const uu=["doc"];var hu,mu,yu,gu,fu,bu,Iu,vu,wu,Nu,ju,Su,Du,Tu,Ou,Fu,Cu,Eu,xu,_u,Mu,Pu,Au,ku,Uu,Ru,Zu,Lu,$u,Bu,Gu,Hu,zu,Yu,Vu,Wu,Ku,qu,Ju,Xu,Qu,eh,th,oh,nh,ih,rh,sh,ah,ch,lh,dh,ph,uh,hh,mh,yh,gh,fh,bh,Ih,vh,wh;function Nh(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function jh(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Nh(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Nh(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}hu=(0,c.provide)("nodeManagementFlow"),mu=(0,c.inject)("projectUIState"),yu=(0,c.inject)("nodeSelectionFlow"),gu=(0,c.inject)("projectDoc"),fu=(0,c.inject)("sharedbProjectSyncService"),bu=(0,c.inject)("componentManagementFlow"),Iu=(0,c.inject)("notificationsManagementFlow"),vu=(0,c.inject)("nodeStyleManagmentFlow"),wu=(0,c.inject)("nodeAttributeManagmentFlow"),Nu=(0,c.inject)("propDefinitionManagementFlow"),ju=(0,c.inject)("stateDefinitionManagementFlow"),Su=(0,c.inject)("elementRefProvider"),Du=(0,c.inject)("stageScrollFlow"),Tu=(0,c.inject)("freestyleNodeFlow"),Ou=(0,c.inject)("rtcFlow"),Fu=(0,c.inject)("imageOptimisationFlow"),Cu=(0,c.inject)("modalManagementFlow"),Eu=(0,c.inject)("sentryService"),xu=(0,h.G)(g.l.ENTER_RENAME_NODE),_u=(0,h.G)(g.l.DELETE_NODES),Mu=(0,ep.u)(ep.j.DELETE_NODES),Pu=(0,h.G)(g.l.DUPLICATE_NODES),Au=(0,h.G)(g.l.MOVE_NODES_TO_TARGET),ku=(0,ep.u)(ep.j.MOVE_NODES),Uu=(0,h.G)(g.l.COPY_NODES_TO_TARGET),Ru=(0,ep.u)(ep.j.COPY_NODES),Zu=(0,h.G)(g.l.ADD_NODES_TO_PARENT_OR_STAGE),Lu=(0,ep.u)(ep.j.ADD_NODES),$u=(0,h.G)(g.l.COPY_NODE_STYLES_TO_TARGET),Bu=(0,ep.u)(ep.j.COPY_STYLES),Gu=(0,h.G)(g.l.COPY_NODE_CLASSES_TO_TARGET),Hu=(0,h.G)(g.l.COPY_NODES_TO_TARGET),zu=(0,ep.u)(ep.j.COPY_NODES),Yu=(0,h.G)(g.l.GROUP_NODES),Vu=(0,h.G)(g.l.UNGROUP_NODES),Wu=(0,h.G)(g.l.ADD_PRIMITIVE),Ku=(0,h.G)(g.l.UPDATE_NODE_SEMANTIC),qu=(0,h.G)(g.l.MOVE_NODES_TO_TARGET),Ju=(0,h.G)(g.l.MOVE_NODES_TO_TARGET),Xu=(0,h.G)(g.l.ADD_PRIMITIVE),Qu=(0,h.G)(g.l.UPDATE_HTML_FOR_NODE),eh=(0,h.G)(g.l.REMOVE_HTML_FOR_NODE),th=(0,h.G)(g.l.ADD_NODES_TO_PARENT_OR_STAGE),oh=(0,h.G)(g.l.REMOVE_CONDITIONAL_STYLE),hu((ih=class{constructor(){(0,i.Z)(this,"projectUIState",rh,this),(0,i.Z)(this,"nodeSelectionFlow",sh,this),(0,i.Z)(this,"projectDoc",ah,this),(0,i.Z)(this,"dbSync",ch,this),(0,i.Z)(this,"componentManagementFlow",lh,this),(0,i.Z)(this,"notificationsManagementFlow",dh,this),(0,i.Z)(this,"nodeStyleManagmentFlow",ph,this),(0,i.Z)(this,"nodeAttributeManagmentFlow",uh,this),(0,i.Z)(this,"propDefinitionManagementFlow",hh,this),(0,i.Z)(this,"stateDefinitionManagementFlow",mh,this),(0,i.Z)(this,"elementRefProvider",yh,this),(0,i.Z)(this,"stageScrollFlow",gh,this),(0,i.Z)(this,"freestyleNodeFlow",fh,this),(0,i.Z)(this,"rtcFlow",bh,this),(0,i.Z)(this,"imageOptimisationFlow",Ih,this),(0,i.Z)(this,"modalManagementFlow",vh,this),(0,i.Z)(this,"sentryService",wh,this),(0,r.Z)(this,"internationalizationFlow",Pt.q.Instance),(0,r.Z)(this,"openDeleteConfirmationModal",((e,t)=>{const o=b.d.createCustomModal({Component:pu.f,data:{title:"Delete Element from Main Component",description:"You are trying to delete an element inside of a Component!",question:"This will remove it from the Component Instance and also from the Main Component and all its instances!\n\nAre you sure you want to delete the selected element?",confirmationButtonText:"Delete Element from Main Component",warningIcon:"warning",onSubmit:()=>{this.dbSync.mutate(this.projectDoc,(t=>{t.deleteNodesById({nodeIds:e})})),this.nodeSelectionFlow.resetNodeSelection(),this.nodeSelectionFlow.setNodeSelection({nodeId:t})}}});this.modalManagementFlow.showModal(o,{maxWidth:"430px"},!1)})),(0,r.Z)(this,"registerInvalidDynamicNode",((e,t)=>{(0,a.mutate)(this.projectUIState,(o=>o.invalidDynamicProperties[e]=t))})),(0,r.Z)(this,"unregisterInvalidDynamicNode",(e=>{(0,a.mutate)(this.projectUIState,(t=>delete t.invalidDynamicProperties[e]))})),(0,r.Z)(this,"updateSemanticTypeForHierarchyPropRoots",((e,t,o)=>{var n;const i=e.nodes.getById(null!==t&&void 0!==t?t:"");if(!i||"fragment"!==i.primitiveType)return;if(!("meta"in i))return;const r=null===(n=i.meta)||void 0===n?void 0:n.isPropRoot;if(!r)return;const s=e.components.byId[r.compId];if(!s||!Object.keys(s.instantiatedByNodes).length)return;const a=s.propDefinitions[r.prop];if(!a)return;Object.keys(a.locations).reduce(((e,t)=>(a.locations[t].content&&e.push(t),e)),[]).forEach((t=>{const n=e.nodes.getById(t);n&&(n.semanticType=o)})),this.nodeAttributeManagmentFlow.resetPristineAttributesAfterPropChange(e,t)})),(0,r.Z)(this,"getRootNodeIdsBoundToHierarchyPropForNodeId",(e=>{var t,o,n,i;const r=this.projectDoc.nodes.getById(e);if(!r||!r.primitiveType||!("contentChildren"in r))return[];const s=this.projectDoc.nodes.getById(r.parentId||"");if(!s||!("meta"in s))return[];const a=null===(t=s.meta)||void 0===t||null===(o=t.isPropRoot)||void 0===o?void 0:o.prop,c=null===(n=s.meta)||void 0===n||null===(i=n.isPropRoot)||void 0===i?void 0:i.compId;if(!a||!c)return[];const l=this.projectDoc.components.byId[c],d=null===l||void 0===l?void 0:l.propDefinitions[a];return"richtext"!==(null===d||void 0===d?void 0:d.type)?[]:Object.keys(d.locations).filter((e=>{var t,o,n;return(null===(t=d.locations)||void 0===t||null===(o=t[e])||void 0===o||null===(n=o.content)||void 0===n?void 0:n.base)===jd.hD.CONTENT}))}))}replaceTextsContentWithAIAlternatives(e){const{doc:t,alternatives:o,sourceCompOrPageId:n}=e;if(!t||!o.length)return null;for(const i of o){const e=i.nodeData;if(!e)continue;const o=e.sourceCompId===n,r=t.getProjectPageOrComponent(e.sourceCompId);r&&Object.keys(i.textsToRewrite).forEach((n=>{var s;const a=i.textsToRewrite[n],c=t.nodes.getById(n);if(!c||!("contentChildren"in c))return;const l=Object.values(null!==(s=c.contentChildren)&&void 0!==s?s:{})[0];if(!l)return;if("static"===l.type){var d;const e=new Yr.F({content:a});return c.contentChildren={[e.id]:e},void this.nodeAttributeManagmentFlow.removePristineStatusFromAttribute({nodeId:null!==(d=c.parentId)&&void 0!==d?d:"",doc:t})}if("dynamic"!==l.type||"prop"!==l.content.referenceType&&"locale"!==l.content.referenceType)return;if("locale"===l.content.referenceType){var p;const e=c.getContentLangReferenceKey();if(!e)return;const{currentLanguage:o}=this.projectUIState.internationalization;if(null===o||void 0===o||!o.short)return;const{translations:n}=t.internationalization,i=n[o.short][e];if("hierarchy"!==i.type)return;const r=t.nodes.getById(i.content);if(!r||!("contentChildren"in r))return;Object.keys(null!==(p=r.childrenIds)&&void 0!==p?p:{}).length&&(t.deleteNodesById({nodeIds:Object.keys(r.childrenIds)}),r.childrenIds={});const s=new Yr.F({content:a});r.contentChildren={[s.id]:s}}const u=r.propDefinitions[l.content.id];if(!u)return;if(o)return void(u.defaultValue=a);if(!e.instanceId)return;const h=t.nodes.getById(e.instanceId);h&&h.type}))}}convertStringContentPropToRichText(e){const{doc:t,nodeIdToUpdate:o,compInstanceId:n,nodesToAdd:i,contentChild:r,originalNodeId:s}=e;if(!t)return!1;const a=t.nodes.getById(o);if(!a||"element-node"!==a.type)return!1;if("dynamic"!==r.type||"prop"!==r.content.referenceType)return!1;const c=t.components.byId[t.getComponentIdForNode(a.id)||""];if(!c)return!1;const l=c.propDefinitions[r.content.id];if(!l||"richtext"===l.type)return!1;const d=(0,du.rZ)(a),p=new lu.HX({id:(0,ni.Ox)(),semanticType:Zn.sO.FRAGMENT,primitiveType:Zn.sO.FRAGMENT,meta:{isPropRoot:{compId:c.id,prop:d.id}}}),u=new lu.HX({id:(0,ni.Ox)(),primitiveType:"button"===a.primitiveType?Zn.sO.TEXT:a.primitiveType,parentId:p.id});if(n){const e=new Yr.F({content:l.defaultValue});u.contentChildren={[e.id]:e}}else i.forEach(((e,o)=>{e.parentId=u.id,e.pos=(Number.MAX_SAFE_INTEGER*(o+1)).toString(),t.addNode(e)}));t.addNode(p),t.addNode(u);let h=a.id;if(a.primitiveType===Zn.sO.BUTTON){const e=new nr.P({content:{referenceType:"prop",id:d.id}}),o=new lu.HX({id:(0,ni.Ox)(),semanticType:Zn.RY.SPAN,primitiveType:Zn.sO.TEXT,parentId:a.id,contentChildren:{[e.id]:e}});t.addNode(o),a.childrenIds={[o.id]:!0},h=o.id}else{const e=new nr.P({content:{referenceType:"prop",id:d.id}});a.contentChildren={[e.id]:e},a.childrenIds={}}const m=c.createPropDefinition(jh(jh({},d),{},{defaultValue:l.defaultValue,inputType:jd.SO.RICH_TEXT,defaultHierarchyRootId:p.id,type:"richtext",locations:{[h]:(0,Sd.B1)({base:jd.hD.CONTENT})}})),y=t.nodes.getById(p.id);return y&&(y.rootOfPropHierarchy=m.id),Object.keys(c.instantiatedByNodes).forEach((e=>{const o=t.nodes.getById(e);if(!o||"component-instance-node"!==o.type)return;const r=t.cloneRichTextHierarchy({doc:t,rootNodeId:p.id,meta:{isAttributeRoot:{nodeId:h,attr:m.name}}});if(!r)return;let s=!0;const a=o.attrs[l.name],c=t.nodes.getById(r),d=t.nodes.getById(Object.keys((null===c||void 0===c?void 0:c.childrenIds)||{})[0]||"");if(a&&"static"===a.type){const o=a.clone();d&&n!==e&&(t.deleteNodesById({nodeIds:Object.keys(d.childrenIds)}),d.contentChildren={[o.id]:o}),s=!1}n===e&&d&&(t.deleteNodesById({nodeIds:Object.keys(d.childrenIds)}),i.forEach(((e,o)=>{e.parentId=d.id,e.pos=(Number.MAX_SAFE_INTEGER*(o+1)).toString(),t.addNode(e)}))),o.attrs[m.name]={id:(0,ni.Ox)(),type:"hierarchy",content:`${r}`,pristine:s}})),1===Object.keys(l.locations).length?delete c.propDefinitions[l.id]:delete l.locations[s],!0}setRenamedNode(e){if(this.projectUIState.userPreferences.showElementTag)return;const t=this.projectDoc.nodes.getById(e||""),o=this.projectDoc.getComponentIdForNode((null===t||void 0===t?void 0:t.id)||"")!==this.projectUIState.selection.componentId,n=this.projectDoc.nodes.getById((null===t||void 0===t?void 0:t.parentId)||"");t&&!t.getNodeAllowedOps(n,o).rename||(0,a.mutate)(this.projectUIState,(t=>{t.layout.sidebarPanel!==p.tI.FILES&&(t.layout.sidebarPanel=p.tI.FILES),t.nodesList.renamedNodeId=e}))}beginLocalWork(e){if(this.projectUIState.localWork.nodesUnderLocalWork)return;const t={};for(const o of e){if(!this.projectDoc.nodes.getById(o))return;t[o]=this.projectDoc.getLocalWorkClone({nodeId:o})}Object.keys(t).length&&(0,a.mutate)(this.projectUIState,(e=>{e.localWork={nodesUnderLocalWork:t,changedAttrs:[],changedStyles:[],initialPropValues:{},changedContent:null}}))}revertLocalWork(){const e=this.projectUIState.localWork.nodesUnderLocalWork;if(!e)return;const t=[...new Set(this.projectUIState.localWork.changedAttrs)],o=[...new Set(this.projectUIState.localWork.changedStyles)],n=this.projectUIState.localWork.initialPropValues||{};(0,a.mutate)(this.projectDoc,(i=>{for(const r in e){const s=i.nodes.getById(r);if(!s)return;if(null!==o&&void 0!==o&&o.length){this.nodeStyleManagmentFlow.copyStylesFromNodeBasedOnCurrentBreakpoint({doc:i,nodeId:r,changedKeys:o,node:e[r]});const t=e[r],n="fakeSize"in t;"fakeSize"in s&&n&&(s.fakeSize=t.fakeSize)}null!==t&&void 0!==t&&t.length&&this.nodeAttributeManagmentFlow.copyAttrsFromNode({doc:i,nodeId:r,changedKeys:t,node:e[r]}),Object.keys(n).forEach((e=>{this.propDefinitionManagementFlow.updatePropDefinition({doc:i,propId:e,propData:{defaultValue:n[e]}})}))}})),(0,a.mutate)(this.projectUIState,(e=>{e.localWork={nodesUnderLocalWork:null,changedAttrs:null,changedStyles:null,initialPropValues:null,changedContent:null}}))}commitLocalWork(){const e=this.projectUIState.localWork.nodesUnderLocalWork;if(!e)return;const t=[...new Set(this.projectUIState.localWork.changedAttrs)],o=[...new Set(this.projectUIState.localWork.changedStyles)],n=this.projectUIState.localWork.changedContent,i={};(0,a.mutate)(this.projectDoc,(n=>{for(const r in e){if(!n.nodes.getById(r))return;i[r]=n.getLocalWorkClone({nodeId:r}),null!==o&&void 0!==o&&o.length&&this.nodeStyleManagmentFlow.copyStylesFromNodeBasedOnCurrentBreakpoint({doc:n,nodeId:r,changedKeys:o,node:e[r]}),null!==t&&void 0!==t&&t.length&&this.nodeAttributeManagmentFlow.copyAttrsFromNode({doc:n,nodeId:r,changedKeys:t,node:e[r]})}})),(0,a.mutate)(this.projectUIState,(e=>{e.localWork={nodesUnderLocalWork:null,changedAttrs:null,changedStyles:null,initialPropValues:null,changedContent:null}})),this.dbSync.mutate(this.projectDoc,(e=>{for(const r in i){null!==o&&void 0!==o&&o.length&&this.nodeStyleManagmentFlow.copyStylesFromNodeBasedOnCurrentBreakpoint({doc:e,nodeId:r,changedKeys:o,node:i[r]}),null!==t&&void 0!==t&&t.length&&this.nodeAttributeManagmentFlow.copyAttrsFromNode({doc:e,nodeId:r,changedKeys:t,node:i[r]});const s=e.nodes.getById(r);if(!s)return;const a=i[r];if("contentChildren"in a&&"contentChildren"in s){if(a.contentChildren&&s.contentChildren&&null!==n){const t=Object.keys(s.contentChildren)[0],o=s.contentChildren[t];if("static"===o.type){const e=new Yr.F({content:n});s.contentChildren={[e.id]:e}}if("dynamic"===o.type){const t=this.projectUIState.selection.componentId,i=t&&e.components.byId[t];if(!i)return;null===i||void 0===i||i.updatePropDefinition(o.content.id,{defaultValue:n})}}}}}))}deleteNodesById(e){const{doc:t,nodeIds:o}=e;if(!t)return;const n=this.projectDoc.nodes.getAllowedUserOpsForNodes(o,!!this.projectUIState.selection.compInstanceId),i=o.some((e=>t.isNodeOrAnyChildProtected(e)));if(n.delete&&!i){if(1===o.length){const e=this.nodeSelectionFlow.getSelectedNodeInstanceIds(),t=this.projectDoc.nodes.getById(o[0]);if(this.projectUIState.selection.compInstanceId&&"component-instance-node"!==(null===t||void 0===t?void 0:t.type))return void this.openDeleteConfirmationModal(o,this.projectUIState.selection.compInstanceId);if(e.length)this.selectRightInstanceAfterNodeInstanceDeletion(e[0]);else{const e=this.projectDoc.nodes.getById((null===t||void 0===t?void 0:t.parentId)||"");if(!t||!t.getNodeAllowedOps(e).delete)return;this.selectRightNodeAfterNodeIdDeletion(t)}}o.length>1&&this.nodeSelectionFlow.resetNodeSelection(),t.deleteNodesById({nodeIds:o})}}selectRightNodeAfterNodeIdDeletion(e){var t,o;const n=(null===(t=this.projectDoc.nodes.getNextSibling(e))||void 0===t?void 0:t.id)||(null===(o=this.projectDoc.nodes.getPrevSibling(e))||void 0===o?void 0:o.id)||e.getActualParentId(),i=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(n||"").compInstanceId||this.projectUIState.selection.compInstanceId;this.nodeSelectionFlow.setNodeSelection({nodeId:n,compInstanceId:i})}selectRightInstanceAfterNodeInstanceDeletion(e){var t,o;const n=(null===(t=this.elementRefProvider.getNextSiblingForNodeInstanceId(e))||void 0===t?void 0:t.nodeInstanceId)||(null===(o=this.elementRefProvider.getPrevSiblingForNodeInstanceId(e))||void 0===o?void 0:o.nodeInstanceId)||this.elementRefProvider.getClosestParentNodeInstanceId(e);if(!n)return;const i=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(n);if(!i)return;const r=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(i||"").compInstanceId||this.projectUIState.selection.compInstanceId;r&&i!==r?this.nodeSelectionFlow.resetNodeSelection():this.nodeSelectionFlow.setNodeSelection({nodeInstanceId:n,compInstanceId:r})}duplicateNodesById(e){const{nodeIds:t,doc:o}=e;if(!o)return;const n=o.getComponentIdForNode(t[0]);if(!n)return;const i=this.projectDoc.nodes.getAllowedUserOpsForNodes(t,!!this.projectUIState.selection.compInstanceId);if(!t.some((e=>o.isNodeOrAnyChildProtected(e)))&&i.duplicate)for(const a of t){var r,s;if(!!(null===(r=o.nodes.getById(a))||void 0===r||!r.getActualParentId()))continue;const e=o.duplicateNodeInstanceHierarchy({doc:o,rootNodeId:a,sourceCompId:n,targetCompId:n,duplicatePropEvenIfItExists:this.projectUIState.userPreferences.duplicatePropsWhenDuplicatingNode});if((null===(s=this.projectUIState.drag.draggedEntity)||void 0===s?void 0:s.type)===cu.Z.ABSOLUTE_SUB_HIERARCHY)continue;const t=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(e[a],["top","left","bottom","right","position"]),i=t.position;"absolute"!==i&&"fixed"!==i||(this.freestyleNodeFlow.nudgeNode(e[a],"top",t.top),this.freestyleNodeFlow.nudgeNode(e[a],"bottom",t.bottom),this.freestyleNodeFlow.nudgeNode(e[a],"left",t.left),this.freestyleNodeFlow.nudgeNode(e[a],"right",t.right))}}setFallbackValueForNode(e){const{nodeId:t,value:o,location:n,property:i,doc:r}=e;if(!r)return;const s=r.nodes.getById(t);if(s)switch(n){case jd.mH.CONTENT:if("contentChildren"in s&&s.contentChildren){const e=Object.keys(s.contentChildren)[0],t=s.contentChildren[e];"dynamic"===t.type&&(t.content.fallbackValue=o)}break;case jd.mH.ATTR:{if(!("attrs"in s)||!i)return;const e=s.attrs,t=e&&i in e?e[i]:void 0;if(!t||"dynamic"!==t.type)return;t.content.fallbackValue=o;break}case jd.mH.HTML_CONTENT:{if(!("html"in s))return;const e=s.html;if(!e||"dynamic"!==e.type)return;e.content.fallbackValue=o;break}case jd.mH.ABILITY:{if(!("abilities"in s)||!i)return;const e=Object.values(s.abilities).find((e=>e.type===i));if(!e||!(i in e.content))return;const t=e.content[i];"string"!==typeof t&&(t.content.fallbackValue=o);break}}}convertNodesToComponent(e){const{compId:t,doc:o}=e;if(!o)return;const{automaticallyCreateOverrides:n}=this.projectUIState.userPreferences;if(this.componentManagementFlow.checkComponentsLimitReached())return;const i=o.nodes.getOrderedTopLevelNodes(e.nodeIds);if(!o.nodes.areNodesSiblings(i))return;const r=i.length>1?this.groupNodes({nodeIds:i,withWrapperSelection:!1,doc:o}):i[0];if(!r)return;const s=o.nodes.getById(r);if(!s)throw new Error(`Node that need to be converted to component is missing - ${r}`);if(!s.getActualParentId())throw new Error("Parent id is missing from the node, that is being converted");if(s.compIdOfRootNode||o.nodes.nodeIsCompInstance(s))throw new Error("Trying to convert a existing component or page to component");const c=o.nodes.getSlotAndCompInstanceIdForNodeById(r).compInstanceId,d=Object.values(o.components.byId||{}).map((e=>null===e||void 0===e?void 0:e.title)),p=Object.values(o.pages.byId||{}).map((e=>null===e||void 0===e?void 0:e.title)),u=Object.values(o.cmsPages.byId||{}).map((e=>null===e||void 0===e?void 0:e.title)),h=(0,l.Zu)([...d,...p,...u],s.name?(0,ni.kC)(s.name):"Component"),m=o.nodes.getById(s.getActualParentId());if(!m)throw new Error(`Parent is missing for the node to change - ${s.getActualParentId()}`);const y=o.getComponentIdForNode(s.id)||t;let g=new Un.n({title:h});(0,a.mutate)(this.projectUIState,(e=>{e.componentList.stateValues[g.id]={},e.componentList.propValues[g.id]={}}));const f=new el.F({primitiveType:Zn.sO.COMPONENT,parentId:s.parentId,slotId:s.slotId,compInstanceId:s.compInstanceId,pos:s.pos});if(f.compIdOfCompInstance=g.id,s.primitiveType!==Zn.sO.CONTAINER&&s.primitiveType!==Zn.sO.LIST||(g.rootNodeId=s.id,m.primitiveType===Zn.sO.SLOT?o.removeNodeFromSlot({node:s,slotOwnerId:c,slotId:m.id}):"childrenIds"in m&&delete m.childrenIds[s.id],"styles"in s&&!s.styles.position&&(s.styles.position=new Yr.F({content:"relative"})),s.compIdOfRootNode=g.id,s.parentId=null,delete s.slotId,delete s.compInstanceId),"styles"in s){var b;const e="absolute"===(null===(b=s.styles.position)||void 0===b?void 0:b.content);let i={};if(e){const e=["top","left","bottom","right","position","margin","marginTop","marginBottom","marginRight","marginLeft"];i=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(r,e),this.nodeStyleManagmentFlow.removeMultipleStylesByKey({nodeIds:[r||""],doc:o,keys:e}),this.nodeStyleManagmentFlow.setStyleByKey({nodeIds:[r],key:"position",value:"relative",doc:o})}o.nodes.getDescendents(s.id).forEach((e=>{o.nodes.nodeIsCompInstance(e)&&(g.usedComponents[e.compIdOfCompInstance]?g.usedComponents[e.compIdOfCompInstance]+=1:g.usedComponents[e.compIdOfCompInstance]=1)})),g.pos=o.components.getPositionAfterLast(),g=o.addComponent({component:g});const{rootNodeId:a,id:c}=g;if(!a||!c)return;if(a!==s.id){if(!o.nodes.getById(a))throw new Error(`Newly created parent's root node is missing - ${a}`);this.moveNodesToTarget({targetId:a,nodes:[s],doc:o}),o.addUsedComponentRelation({toAddComponentId:y,linkedComponentId:c})}const l=o.getProjectPageOrComponent(t);if(!l)return;const d=o.nodes.getAvailableContextIdsForNode(a);o.nodes.bfs(r,(e=>{this.imageOptimisationFlow.getAssetsLinkedToNodes({nodeIds:[e.id]}).forEach((e=>{this.imageOptimisationFlow.computeAssetSizeForComponent({assetId:e,compId:c})}));const i=o.nodes.getUsedContextIdsForNode(r);if(d.every((e=>!i.includes(e)))){o.nodes.getDescendents(r).forEach((e=>{o.replaceCtxReferenceWithStaticNode({node:e,targetAvailableCtxIds:d,doc:o})}))}l instanceof Un.n&&n?o.moveNodePropDefinitionToTarget({doc:o,sourceCompId:t,targetCompId:c,nodeId:e.id}):n&&o.addDefaultPropsDefinitionForNode({node:e,doc:o,component:g,createStringPropForTexts:this.projectUIState.userPreferences.createSimpleTextProps})})),o.addNode(f),f.slotId&&f.compInstanceId&&o.addNodeToSlot({node:f,slotOwnerId:f.compInstanceId,slotId:f.slotId}),o.addAttributesFromPropsUseCase({doc:o,node:f});o.nodes.getDescendents(s.id).forEach((e=>{var t;const o=null===(t=(0,tl.b3)(e,"id"))||void 0===t?void 0:t.toString();o&&r&&(delete l.sectionIds[r],g.sectionIds[r]=o)})),g.instantiatedByNodes[f.id]=!0,setTimeout((()=>{this.nodeSelectionFlow.setNodeSelection({nodeId:f.id})}),ol.x1.SIXTY),e&&Object.keys(i).map((e=>{i[e]&&this.nodeStyleManagmentFlow.setStyleByKey({nodeIds:[f.id],key:e,value:i[e],doc:o})}))}}moveNodesToTarget(e){const{doc:t,removeMargins:o,nodes:n}=e;if(!t)return;if(t.moveNodesToTarget(e),!o)return;const i=n.map((e=>e.parentId)),r=n.filter(((e,o)=>{var n;return(null===(n=t.nodes.getById(e.id))||void 0===n?void 0:n.parentId)!==i[o]})).map((e=>e.id));r.length&&this.nodeStyleManagmentFlow.removeMultipleStylesByKeyBasedOnCurrentBreakpoint({nodeIds:r,doc:t,keys:["margin","marginLeft","marginRight","marginTop","marginBottom"]})}copyNodeHierarchyToTarget(e){const{doc:t}=e;if(t)return t.copyNodesHierarchyToTarget(e)}addNodesToParentOrStage(e){const{doc:t,nodes:o,parentId:n}=e;if(t){if(t.addNodesToParentOrStage(jh(jh({},e),{},{nodes:o})),t.nodes.nodeIsCompInstance(o[0])){const e=o[0].compIdOfCompInstance,n=t.components.byId[e];if(!n)return void this.sentryService.captureException(`addNodesToParentOrStage skipped. Component by ${e} not found`);const{stateDefinitions:i,propDefinitions:r}=n;(0,a.mutate)(this.projectUIState,(t=>{Object.values(i).forEach((n=>{var i;null!==(i=t.componentList.stateValues[e])&&void 0!==i&&i[n.id]&&(void 0===t.componentList.stateValues[e][n.id].value&&(t.componentList.stateValues[e][n.id].value=n.defaultValue),t.componentList.stateValues[e][n.id].componentInstanceValues[o[0].id]=n.defaultValue)})),Object.values(r).forEach((n=>{var i;null!==(i=t.componentList.propValues[e])&&void 0!==i&&i[n.id]&&(void 0===t.componentList.propValues[e][n.id].value&&(t.componentList.propValues[e][n.id].value=n.defaultValue),t.componentList.propValues[e][n.id].componentInstanceValues[o[0].id]=n.defaultValue)}))}))}this.nodeStyleManagmentFlow.computeGridChildPositionIfParentIsGrid({doc:t,parentId:n,childId:o[0].id})}}copyNodeStylesToTargets(e){const{source:t,doc:o,targets:n}=e;if(!o)return;const i=t,r=o.nodes.getById(i);if(!r)throw new Error(`Source node is missing - ${i}`);const s=Object.values(o.assets.byId).filter((e=>e.usedInNodes[i]));for(const a of n){const e=o.nodes.getById(a);if(!r||!e)throw new Error(`Target node is missing - ${a}`);const t=Xd.S.execute({targetNodeId:a,nodeId:i,doc:o});t&&"styles"in e&&(e.styles=t);const n=Jd.l.execute({targetNodeId:a,nodeId:i,doc:o});n&&"referencedStyles"in e&&(e.referencedStyles=n),s.forEach((e=>{e.usedInNodes[a]=!0}))}}copyNodeClassesStylesToTargets(e){this.dbSync.mutate(this.projectDoc,(t=>{const o=e.source,n=e.targets,i=t.nodes.getById(o);if(!i)throw new Error(`Source node is missing - ${o}`);for(const e of n){const n=t.nodes.getById(e);if(!i||!n)throw new Error(`Target node is missing - ${e}`);const r=Zp.execute({targetNodeId:e,nodeId:o,doc:t});r&&"referencedStyles"in n&&Object.values(r).forEach((e=>{n.referencedStyles[e.id]=e}))}}))}copyNodesToTarget(e){const{doc:t,nodes:o}=e;if(!t)return;let n=!1;return o.forEach((e=>{t.nodes.bfs(e.id,(e=>{e.primitiveType===Zn.sO.SLOT&&(n=!0)}))})),n&&this.notificationsManagementFlow.createNotification(d.k$.INFO,"Slot cannot be copied."),t.copyNodesToTarget(jh(jh({},e),{},{duplicatePropEvenIfItExists:this.projectUIState.userPreferences.duplicatePropsWhenDuplicatingNode}))}groupNodes(e){const{doc:t,withWrapperSelection:o=!0}=e;if(!t)return null;const n=t.nodes.getOrderedTopLevelNodes(e.nodeIds),i=this.projectDoc.nodes.getAllowedUserOpsForNodes(n,!!this.projectUIState.selection.compInstanceId);if(!t.nodes.areNodesSiblings(n)||this.nodeIsChildOfButton(n[0])||!i.group)return null;if(this.freestyleNodeFlow.nodesAreFreestyle(n))return this.freestyleNodeFlow.groupFreestyleNodes({nodeIds:n});const r=this.nodeSelectionFlow.getSelectedNodeInstanceIds()[0];let s;r&&(s=this.elementRefProvider.getClosestParentNodeInstanceId(r));const a=t.groupNodes({nodeIds:n});return a?o?(setTimeout((()=>{let e;var t;s&&(e=null===(t=this.elementRefProvider.getNodeInstanceForNodeIdInParentInstanceId(a,s))||void 0===t?void 0:t.nodeInstanceId);this.nodeSelectionFlow.setNodeSelection({nodeId:a,nodeInstanceId:e})}),ol.x1.SIXTY),a):a:null}ungroupNodeChildren(e){const{nodeId:t}=e,o=this.projectDoc.nodes.getById(t);!this.projectDoc.nodes.getAllowedUserOpsForNodes([t],!!this.projectUIState.selection.compInstanceId).ungroup||!o||(null===o||void 0===o?void 0:o.primitiveType)!==Zn.sO.CONTAINER||null!==o&&void 0!==o&&o.compIdOfRootNode||(!("childrenIds"in o)||Object.keys((null===o||void 0===o?void 0:o.childrenIds)||{}).length?this.dbSync.mutate(this.projectDoc,(n=>{var i;const r=this.elementRefProvider.getDomNodeElementRefById(t);if(!r)throw new Error(`Could not ungroup children for node ${t}. Node not found in DOM.`);const s=null===(i=this.getFirstPositionedAncestorOfDOMNode(r).ancestorDOMElement)||void 0===i?void 0:i.getBoundingClientRect();s&&"childrenIds"in o&&this.freestyleNodeFlow.setFreestyleNodesPositionBeforeMoving({nodeIds:Object.keys(o.childrenIds||{}),targetRect:s,doc:n}),n.ungroupNodeChildren(e)})):this.deleteNodesById({nodeIds:[t]}))}addCodeEmbedNodeToSelNode(e){const t=b.d.createCustomModal({Component:au,data:{title:"Code Embed (HTML+CSS+JS)",allowSaveWithErrors:!0},onSubmit:t=>{if(t){if(e.nodes){const o=e,n=o.nodes[0];"html"in n&&(n.html=new Yr.F({content:t})),this.dbSync.mutate(this.projectDoc,(e=>{this.addNodesToParentOrStage(jh(jh({},o),{},{doc:e}))}))}else{const o=e,n=o.primitives[0];"html"in n&&(n.html=new Yr.F({content:t})),this.addPrimitivesToSelNodeSelectAndScroll({primitives:o.primitives})}this.modalManagementFlow.hideModal()}else this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(t,{padding:"0px"},!1)}addPrimitivesToSelNodeSelectAndScroll(e){const{doc:t,primitives:o,keepOriginalParent:n}=e;if(!t)return;const i=this.nodeSelectionFlow.getSelectedNodesIds();if(i.length>1)return;const r=this.projectUIState.selection.compInstanceId||void 0,s=(0,Rp.a)(o);let a;if(0===i.length){const e=this.projectDoc.getProjectPageOrComponent(this.projectUIState.selection.componentId||"");a=this.projectDoc.nodes.getById((null===e||void 0===e?void 0:e.rootNodeId)||"")}else a=this.projectDoc.nodes.getById(i[0]);if(!a||!s)return;const c=a.primitiveType!==Zn.sO.BUTTON&&t.isNodeAcceptingChildByElementType(a,s);let l=a.id,d=null;var p;c||(l=null!==(p=a.slotId||a.parentId)&&void 0!==p?p:null,d=this.projectDoc.nodes.getNextSibling(a));if(l){const e=t.nodes.getById(l);if(!e||!t.isNodeAcceptingChildByElementType(e,s))return;this.addNodesToParentOrStage({doc:t,parentId:l,nextSibling:d,nodes:o,compInstanceId:r,keepOriginalParent:n})}1===o.length&&setTimeout((()=>{let e=this.nodeSelectionFlow.getSelectedNodeInstanceIds();1===e.length?e[0]=this.nodeSelectionFlow.selectNewPrimitiveInstanceId({primitiveNodeId:o[0].id,parentId:l,parentAcceptsChildren:c}):(this.nodeSelectionFlow.setNodeSelection({nodeId:o[0].id,compInstanceId:r}),e=[]),this.stageScrollFlow.bringNodeIntoView({nodeId:o[0].id,nodeInstanceId:e[0]})}),ol.x1.SIXTY)}updateSemanticType(e){const{nodeId:t,type:o}=e;this.dbSync.mutate(this.projectDoc,(e=>{var n;const i=e.nodes.getById(t);if(!i)throw new Error(`Node that need to change semantic type is missing - ${t}`);i.semanticType=o,this.updateSemanticTypeForHierarchyPropRoots(e,null!==(n=i.parentId)&&void 0!==n?n:"",o)}))}getFirstPositionedAncestorOfDOMNode(e){let t=e.parentElement,o=!1;for(;!o&&t;)if(this.nodeStyleManagmentFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:t.dataset.nodeId||"",key:"position",values:["absolute","fixed","relative"]})&&"component"!==t.dataset.type)o=!0;else{const e=t.parentElement;if(null===e||void 0===e||!e.dataset.nodeId){t=null,o=!0;continue}t=e}if(!t)return{ancestorDOMElement:null,ancestor:null};const n=this.projectDoc.nodes.getById(t.dataset.nodeId||"");if(!n)throw new Error(`Found a positioned DOM node with a nodeId that does not exist in the project document! Id: ${t.dataset.nodeId}`);return{ancestorDOMElement:t,ancestor:n}}getNodeChildren(e,t){const o=this.projectDoc.nodes.getById(e);if(!o)return[];if(this.projectDoc.nodes.nodeIsCompInstance(o)){const e=this.projectDoc.components.byId[o.compIdOfCompInstance];return Object.keys((null===e||void 0===e?void 0:e.slots)||{})}return this.projectDoc.nodes.getChildren(o,t)}swapWithNextNode(e){const{nodeId:t,doc:o}=e;if(!o)return;const n=o.nodes.getById(t);if(!n||this.rtcFlow.isNodeLocked(n.id))return;const i=o.nodes.getNextSibling(n);i&&!this.rtcFlow.isNodeLocked(i.id)&&([n.pos,i.pos]=[i.pos,n.pos])}swapWithPrevNode(e){const{nodeId:t,doc:o}=e;if(!o)return;const n=o.nodes.getById(t);if(!n||this.rtcFlow.isNodeLocked(n.id))return;const i=o.nodes.getPrevSibling(n);i&&!this.rtcFlow.isNodeLocked(i.id)&&([n.pos,i.pos]=[i.pos,n.pos])}updateNodePosition(e){const{nodeId:t,doc:o,newPos:n}=e;if(!o)return;const i=o.nodes.getById(t);i&&!this.rtcFlow.isNodeLocked(i.id)&&(i.pos=n)}addNewOptionItem(e){const{doc:t}=e,o=(0,Up.Z)(e,uu);if(!t)return;t.nodes.getById(o.parentNodeId)&&t.addNewOptionItem(o)}createOrUpdateRenderingCondition(e){var t,o;const{nodeId:n,conditionalNode:i,doc:r}=e,s=this.projectUIState.selection.componentId;if(!r||!s)return;const a=r.nodes.getById(n),c=r.getProjectPageOrComponent(s);if(!a||!c)return;const l=a.renderingConditions;if(l){var d,p;const e=l.reference.content.referenceType,t=l.reference.id;if(t!==i.reference.content.id)switch(e){case"prop":this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:a.id,propId:t,location:{base:jd.hD.CONDITIONAL,sufix:"prop"},doc:r});break;case"state":this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:a.id,stateId:t,location:{base:jd.uw.CONDITIONAL,sufix:"state"},doc:r})}switch(typeof(null===(d=l.condition)||void 0===d||null===(p=d.conditions[0])||void 0===p?void 0:p.operand)){case"object":{var u,h,m,y,g;const e=null===(u=l.condition)||void 0===u||null===(h=u.conditions[0])||void 0===h?void 0:h.operand,t=e.content.referenceType,o=e.id;if(o!==(null===(m=i.condition)||void 0===m||null===(y=m.conditions[0])||void 0===y||null===(g=y.operand)||void 0===g?void 0:g.id))switch(t){case"prop":this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:a.id,propId:o,location:{base:jd.hD.CONDITIONAL_ELEMENT_OPERAND+`-${o}`,sufix:"prop",identifier:o},doc:r});break;case"state":this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:a.id,stateId:o,location:{base:jd.uw.CONDITIONAL_ELEMENT_OPERAND+`-${o}`,sufix:"state",identifier:o},doc:r})}}}}"renderingConditions"in a&&(a.renderingConditions=jh(jh({},a.renderingConditions),i));switch(i.reference.content.referenceType){case"prop":this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:a.id,propId:i.reference.content.id,location:{base:jd.hD.CONDITIONAL,sufix:"prop"},doc:r});break;case"state":this.stateDefinitionManagementFlow.addStateLocationForNode({nodeId:a.id,stateId:i.reference.content.id,location:{base:jd.uw.CONDITIONAL,sufix:"state"},doc:r})}switch(typeof(null===(t=i.condition)||void 0===t||null===(o=t.conditions[0])||void 0===o?void 0:o.operand)){case"object":{var f,b;const e=null===(f=i.condition)||void 0===f||null===(b=f.conditions[0])||void 0===b?void 0:b.operand,t=e.content.referenceType,o=e.content.id;switch(t){case"prop":this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:a.id,propId:o,location:{base:jd.hD.CONDITIONAL_ELEMENT_OPERAND+`-${o}`,sufix:"prop",identifier:o},doc:r});break;case"state":this.stateDefinitionManagementFlow.addStateLocationForNode({nodeId:a.id,stateId:o,location:{base:jd.uw.CONDITIONAL_ELEMENT_OPERAND+`-${o}`,sufix:"state",identifier:o},doc:r})}}}}removeRenderingCondition(e){var t,o;const{nodeId:n,doc:i}=e;if(!i)return;const r=i.nodes.getById(n);if(!r)return;const s=r.renderingConditions;if(!s)return;const a=null===s||void 0===s?void 0:s.reference;if(a){const e=a.content.referenceType,t=a.content.id;switch(e){case"prop":this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:r.id,propId:t,location:{base:jd.hD.CONDITIONAL,sufix:"prop"},doc:i});break;case"state":this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:r.id,stateId:t,location:{base:jd.uw.CONDITIONAL,sufix:"state"},doc:i})}}const c=null===s||void 0===s||null===(t=s.condition)||void 0===t||null===(o=t.conditions[0])||void 0===o?void 0:o.operand;if(c&&"object"===typeof c){const e=c.content.referenceType,t=c.id;switch(e){case"prop":this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:r.id,propId:t,location:{base:jd.hD.CONDITIONAL_ELEMENT_OPERAND+`-${t}`,sufix:"prop",identifier:t},doc:i});break;case"state":this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:r.id,stateId:t,location:{base:jd.uw.CONDITIONAL_ELEMENT_OPERAND+`-${t}`,sufix:"state",identifier:t},doc:i})}}"renderingConditions"in r&&(r.renderingConditions=null)}createConditionalPropDefinitionForNodeId(e){const{doc:t,nodeId:o,name:n,defaultValue:i,inputType:r,type:s}=e;if(!t)return null;const a=t.nodes.getById(o);if(!a)return null;const c=this.projectUIState.selection.componentId;if(!c)return null;const l=t.components.byId[c];if(!l)return null;const d=(0,du.rZ)(a),p=l.createPropDefinition(jh(jh({},d),{},{name:n,inputType:r,type:s,defaultValue:i,locations:{}}));return this.propDefinitionManagementFlow.updatePropDefinitionInternalValue(p.id,i),p}nodeIsChildOfButton(e){const t=this.projectDoc.nodes.getById(e);if(!t||!t.parentId)return!1;const o=this.projectDoc.nodes.getById(t.parentId);return(null===o||void 0===o?void 0:o.primitiveType)===Zn.sO.BUTTON}findParentThatAcceptsNodes(e){const{nodes:t,startNode:o,doc:n}=e;if(!n)return;let i=o,r=t.every((e=>i&&e.primitiveType&&"isNodeAcceptingChildByElementType"in i?i.isNodeAcceptingChildByElementType(e.primitiveType):null));for(;!r&&i;)i=n.nodes.getById(i.parentId||""),r=t.every((e=>i&&e.primitiveType&&"isNodeAcceptingChildByElementType"in i?i.isNodeAcceptingChildByElementType(e.primitiveType):null));return i}updateHtmlForNodeById(e){const{doc:t,nodeId:o,staticValue:n,dynamicNode:i}=e;if(!t)return;const r=t.nodes.getById(o);r&&t.updateHtmlForNode({node:r,staticValue:n,dynamicNode:i})}deleteHtmlForNodeById(e){const{doc:t,nodeId:o}=e;if(!t)return;const n=t.nodes.getById(o);n&&"html"in n&&delete n.html}addWidgetToSelectedNode(e){const t=new lu.HX({semanticType:Zn.sO.DEV_COMPONENT,primitiveType:Zn.sO.DEV_COMPONENT,devComponentPath:e,name:(0,l.rk)(e),fakeSize:!1,abilities:{}});this.addPrimitivesToSelNodeSelectAndScroll({primitives:[t]})}nodeHasSomeError(e){const{nodeId:t,doc:o=this.projectDoc,uiState:n=this.projectUIState}=e,i=o.nodes.getById(t);return!!i&&("cms-collection-item-node"===i.type||"cms-collection-list-node"===i.type?!(!i.resourceDefinition||"uninitialised"===(null===(r=i.resourceDefinition)||void 0===r?void 0:r.type))&&!o.cms.usedContentTypes[i.resourceDefinition.contentType]:Object.values(n.invalidDynamicProperties).includes(t));var r}createOrUpdateRenderingConditionForProjectStyle(e){var t,o,n,i;const{nodeId:r,styleId:s,conditionalNode:a,doc:c}=e;if(!c)return;const l=c.nodes.getById(r);if(!l)return;if(!l.referencedStyles[s])throw new Error(`Node ${r} does not have a referenced style with id ${s}`);const d="simple"===(null===(t=c.classes.byId[s])||void 0===t?void 0:t.classType)?c.classes.byId[s].getName():"";if(!d)throw new Error(`Referenced style ${s} is not a simple class or was not found`);const p=this.projectDoc.nodes.getComponentIdOf(r);if(!p)throw new Error(`Node ${r} does not belong to any component id`);if(!c.getProjectPageOrComponent(p))throw new Error(`Component ${p} not found`);const u=null===(o=l.conditionalReferencedProjectStyles)||void 0===o?void 0:o[s];if(u){var h,m;const e=u.reference.content.referenceType,t=u.reference.id;switch(e){case"prop":this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:l.id,propId:t,location:{base:jd.hD.CONDITIONAL_STYLE+`-${d}`,sufix:"prop",identifier:s},doc:c});break;case"state":this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:l.id,stateId:t,location:{base:jd.uw.CONDITIONAL_STYLE+`-${d}`,sufix:"state",identifier:s},doc:c})}switch(typeof(null===(h=u.condition)||void 0===h||null===(m=h.conditions[0])||void 0===m?void 0:m.operand)){case"object":{var y,g;const e=null===(y=u.condition)||void 0===y||null===(g=y.conditions[0])||void 0===g?void 0:g.operand,t=e.content.referenceType,o=e.id;switch(t){case"prop":this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:l.id,propId:o,location:{base:jd.hD.CONDITIONAL_STYLE_OPERAND+`-${o}`,sufix:"prop",identifier:o},doc:c});break;case"state":this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:l.id,stateId:o,location:{base:jd.uw.CONDITIONAL_STYLE_OPERAND+`-${o}`,sufix:"state",identifier:o},doc:c})}}}}"conditionalReferencedProjectStyles"in l&&(l.conditionalReferencedProjectStyles=jh(jh({},l.conditionalReferencedProjectStyles),{},{[s]:a}));switch(a.reference.content.referenceType){case"prop":this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:l.id,propId:a.reference.id,location:{base:jd.hD.CONDITIONAL_STYLE+`-${d}`,sufix:"prop",identifier:s},doc:c});break;case"state":this.stateDefinitionManagementFlow.addStateLocationForNode({nodeId:l.id,stateId:a.reference.id,location:{base:jd.uw.CONDITIONAL_STYLE+`-${d}`,sufix:"state",identifier:s},doc:c})}switch(typeof(null===(n=a.condition)||void 0===n||null===(i=n.conditions[0])||void 0===i?void 0:i.operand)){case"object":{var f,b;const e=null===(f=a.condition)||void 0===f||null===(b=f.conditions[0])||void 0===b?void 0:b.operand,t=e.content.referenceType,o=e.id;switch(t){case"prop":this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:l.id,propId:o,location:{base:jd.hD.CONDITIONAL_STYLE_OPERAND+`-${o}`,sufix:"prop",identifier:o},doc:c});break;case"state":this.stateDefinitionManagementFlow.addStateLocationForNode({nodeId:l.id,stateId:o,location:{base:jd.uw.CONDITIONAL_STYLE_OPERAND+`-${o}`,sufix:"state",identifier:o},doc:c})}}}}removeRenderingConditionForProjectStyle(e){var t,o;const{doc:n,nodeId:i,styleId:r}=e;if(!n)return;const s=n.nodes.getById(i);if(!s)return;if(!s.referencedStyles[r])throw new Error(`Node ${i} does not have a referenced style with id ${r}`);const a="simple"===(null===(t=n.classes.byId[r])||void 0===t?void 0:t.classType)?n.classes.byId[r].getName():"";if(!a)throw new Error(`Referenced style ${r} is not a simple class or was not found`);const c=null===s||void 0===s||null===(o=s.conditionalReferencedProjectStyles)||void 0===o?void 0:o[r];if(c){var l,d;const e=c.reference.content.referenceType,t=c.reference.id;switch(e){case"prop":this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:s.id,propId:t,location:{base:jd.hD.CONDITIONAL_STYLE+`-${a}`,sufix:"prop",identifier:r},doc:n});break;case"state":this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:s.id,stateId:t,location:{base:jd.hD.CONDITIONAL_STYLE+`-${a}`,sufix:"state",identifier:r},doc:n})}switch(typeof(null===(l=c.condition)||void 0===l||null===(d=l.conditions[0])||void 0===d?void 0:d.operand)){case"object":{var p,u;const e=null===(p=c.condition)||void 0===p||null===(u=p.conditions[0])||void 0===u?void 0:u.operand,t=e.content.referenceType,o=e.id;switch(t){case"prop":this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:s.id,propId:o,location:{base:jd.hD.CONDITIONAL_STYLE_OPERAND+`-${o}`,sufix:"prop",identifier:o},doc:n});break;case"state":this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:s.id,stateId:o,location:{base:jd.hD.CONDITIONAL_STYLE_OPERAND+`-${o}`,sufix:"state",identifier:o},doc:n})}}}}var h;"conditionalReferencedProjectStyles"in s&&(null===(h=s.conditionalReferencedProjectStyles)||void 0===h||delete h[r])}},rh=(0,s.Z)(ih.prototype,"projectUIState",[mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sh=(0,s.Z)(ih.prototype,"nodeSelectionFlow",[yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ah=(0,s.Z)(ih.prototype,"projectDoc",[gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=(0,s.Z)(ih.prototype,"dbSync",[fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=(0,s.Z)(ih.prototype,"componentManagementFlow",[bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dh=(0,s.Z)(ih.prototype,"notificationsManagementFlow",[Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ph=(0,s.Z)(ih.prototype,"nodeStyleManagmentFlow",[vu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=(0,s.Z)(ih.prototype,"nodeAttributeManagmentFlow",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hh=(0,s.Z)(ih.prototype,"propDefinitionManagementFlow",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mh=(0,s.Z)(ih.prototype,"stateDefinitionManagementFlow",[ju],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yh=(0,s.Z)(ih.prototype,"elementRefProvider",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gh=(0,s.Z)(ih.prototype,"stageScrollFlow",[Du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fh=(0,s.Z)(ih.prototype,"freestyleNodeFlow",[Tu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bh=(0,s.Z)(ih.prototype,"rtcFlow",[Ou],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ih=(0,s.Z)(ih.prototype,"imageOptimisationFlow",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vh=(0,s.Z)(ih.prototype,"modalManagementFlow",[Cu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wh=(0,s.Z)(ih.prototype,"sentryService",[Eu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(ih.prototype,"replaceTextsContentWithAIAlternatives",[m.P],Object.getOwnPropertyDescriptor(ih.prototype,"replaceTextsContentWithAIAlternatives"),ih.prototype),(0,s.Z)(ih.prototype,"convertStringContentPropToRichText",[m.P],Object.getOwnPropertyDescriptor(ih.prototype,"convertStringContentPropToRichText"),ih.prototype),(0,s.Z)(ih.prototype,"setRenamedNode",[xu],Object.getOwnPropertyDescriptor(ih.prototype,"setRenamedNode"),ih.prototype),(0,s.Z)(ih.prototype,"deleteNodesById",[_u,m.P,Mu],Object.getOwnPropertyDescriptor(ih.prototype,"deleteNodesById"),ih.prototype),(0,s.Z)(ih.prototype,"duplicateNodesById",[Pu,m.P],Object.getOwnPropertyDescriptor(ih.prototype,"duplicateNodesById"),ih.prototype),(0,s.Z)(ih.prototype,"setFallbackValueForNode",[m.P],Object.getOwnPropertyDescriptor(ih.prototype,"setFallbackValueForNode"),ih.prototype),(0,s.Z)(ih.prototype,"convertNodesToComponent",[m.P],Object.getOwnPropertyDescriptor(ih.prototype,"convertNodesToComponent"),ih.prototype),(0,s.Z)(ih.prototype,"moveNodesToTarget",[Au,m.P,ku],Object.getOwnPropertyDescriptor(ih.prototype,"moveNodesToTarget"),ih.prototype),(0,s.Z)(ih.prototype,"copyNodeHierarchyToTarget",[Uu,m.P,Ru],Object.getOwnPropertyDescriptor(ih.prototype,"copyNodeHierarchyToTarget"),ih.prototype),(0,s.Z)(ih.prototype,"addNodesToParentOrStage",[Zu,m.P,Lu],Object.getOwnPropertyDescriptor(ih.prototype,"addNodesToParentOrStage"),ih.prototype),(0,s.Z)(ih.prototype,"copyNodeStylesToTargets",[$u,m.P,Bu],Object.getOwnPropertyDescriptor(ih.prototype,"copyNodeStylesToTargets"),ih.prototype),(0,s.Z)(ih.prototype,"copyNodeClassesStylesToTargets",[Gu],Object.getOwnPropertyDescriptor(ih.prototype,"copyNodeClassesStylesToTargets"),ih.prototype),(0,s.Z)(ih.prototype,"copyNodesToTarget",[Hu,m.P,zu],Object.getOwnPropertyDescriptor(ih.prototype,"copyNodesToTarget"),ih.prototype),(0,s.Z)(ih.prototype,"groupNodes",[Yu,m.P],Object.getOwnPropertyDescriptor(ih.prototype,"groupNodes"),ih.prototype),(0,s.Z)(ih.prototype,"ungroupNodeChildren",[Vu],Object.getOwnPropertyDescriptor(ih.prototype,"ungroupNodeChildren"),ih.prototype),(0,s.Z)(ih.prototype,"addPrimitivesToSelNodeSelectAndScroll",[Wu,m.P],Object.getOwnPropertyDescriptor(ih.prototype,"addPrimitivesToSelNodeSelectAndScroll"),ih.prototype),(0,s.Z)(ih.prototype,"updateSemanticType",[Ku],Object.getOwnPropertyDescriptor(ih.prototype,"updateSemanticType"),ih.prototype),(0,s.Z)(ih.prototype,"swapWithNextNode",[qu,m.P],Object.getOwnPropertyDescriptor(ih.prototype,"swapWithNextNode"),ih.prototype),(0,s.Z)(ih.prototype,"swapWithPrevNode",[Ju,m.P],Object.getOwnPropertyDescriptor(ih.prototype,"swapWithPrevNode"),ih.prototype),(0,s.Z)(ih.prototype,"updateNodePosition",[m.P],Object.getOwnPropertyDescriptor(ih.prototype,"updateNodePosition"),ih.prototype),(0,s.Z)(ih.prototype,"addNewOptionItem",[Xu,m.P],Object.getOwnPropertyDescriptor(ih.prototype,"addNewOptionItem"),ih.prototype),(0,s.Z)(ih.prototype,"createOrUpdateRenderingCondition",[m.P],Object.getOwnPropertyDescriptor(ih.prototype,"createOrUpdateRenderingCondition"),ih.prototype),(0,s.Z)(ih.prototype,"removeRenderingCondition",[m.P],Object.getOwnPropertyDescriptor(ih.prototype,"removeRenderingCondition"),ih.prototype),(0,s.Z)(ih.prototype,"createConditionalPropDefinitionForNodeId",[m.P],Object.getOwnPropertyDescriptor(ih.prototype,"createConditionalPropDefinitionForNodeId"),ih.prototype),(0,s.Z)(ih.prototype,"findParentThatAcceptsNodes",[m.P],Object.getOwnPropertyDescriptor(ih.prototype,"findParentThatAcceptsNodes"),ih.prototype),(0,s.Z)(ih.prototype,"updateHtmlForNodeById",[Qu,m.P],Object.getOwnPropertyDescriptor(ih.prototype,"updateHtmlForNodeById"),ih.prototype),(0,s.Z)(ih.prototype,"deleteHtmlForNodeById",[eh,m.P],Object.getOwnPropertyDescriptor(ih.prototype,"deleteHtmlForNodeById"),ih.prototype),(0,s.Z)(ih.prototype,"createOrUpdateRenderingConditionForProjectStyle",[th,m.P],Object.getOwnPropertyDescriptor(ih.prototype,"createOrUpdateRenderingConditionForProjectStyle"),ih.prototype),(0,s.Z)(ih.prototype,"removeRenderingConditionForProjectStyle",[oh,m.P],Object.getOwnPropertyDescriptor(ih.prototype,"removeRenderingConditionForProjectStyle"),ih.prototype),nh=ih));var Sh,Dh,Th,Oh,Fh,Ch,Eh,xh=o(651174);Sh=(0,c.provide)("slotNodeManagementFlow"),Dh=(0,c.inject)("sentryService"),Th=(0,h.G)(g.l.SET_SLOT_PREVIEW_SIZE),Oh=(0,h.G)(g.l.TOGGLE_SLOT_PREVIEW_HIDDEN),Sh((Ch=class{constructor(){(0,i.Z)(this,"sentryService",Eh,this)}getSlotPreviewSize(e){var t,o;const{slotId:n,instanceId:i,doc:r}=e;if(!r)return{width:xh.Q.WIDTH,height:xh.Q.HEIGHT};const s=i?r.nodes.getById(i):void 0,a=r.nodes.getById(n);if(a&&!("compIdOfSlot"in a))throw new Error(`Unsupported node was passed to slotNodeManagementFlow, type ${a.type} id ${a.id}`);const c=null===a||void 0===a?void 0:a.compIdOfSlot,l=(null===(t=r.components.byId[c||""])||void 0===t||null===(o=t.slots)||void 0===o?void 0:o[n])||{width:xh.Q.WIDTH,height:xh.Q.HEIGHT};return s&&s.previewSize[n]||l}setSlotPreviewSize(e){const{slotId:t,compId:o,instanceId:n,width:i,height:r,doc:s}=e;if(!s)return;if(!n){if(!o)return;const e=s.components.byId[o];return e?void(e.slots[t]={width:i,height:r}):void this.sentryService.captureException(`Set slot peview size skipped. Component by ${o} not found.`)}const a=s.nodes.getById(n);if(!a||!s.nodes.nodeIsCompInstance(a))throw new Error(`Attempted to set preview size on slot with no instance node! id: ${t}`);a.setPreviewSize(i,r,t)}toggleSlotPreviewHidden(e){const{slotId:t,instanceId:o,doc:n}=e;if(!n)return;const i=n.nodes.getById(o);if(!i||!n.nodes.nodeIsCompInstance(i))throw new Error(`Attempted to set preview size on slot with no instance node! id: ${t}`);i.slotsWithHiddenPreview[t]=!i.slotsWithHiddenPreview[t]}},Eh=(0,s.Z)(Ch.prototype,"sentryService",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Ch.prototype,"getSlotPreviewSize",[m.P],Object.getOwnPropertyDescriptor(Ch.prototype,"getSlotPreviewSize"),Ch.prototype),(0,s.Z)(Ch.prototype,"setSlotPreviewSize",[Th,m.P],Object.getOwnPropertyDescriptor(Ch.prototype,"setSlotPreviewSize"),Ch.prototype),(0,s.Z)(Ch.prototype,"toggleSlotPreviewHidden",[Oh,m.P],Object.getOwnPropertyDescriptor(Ch.prototype,"toggleSlotPreviewHidden"),Ch.prototype),Fh=Ch));var _h,Mh,Ph,Ah,kh,Uh,Rh,Zh,Lh,$h,Bh,Gh,Hh,zh,Yh,Vh,Wh,Kh,qh,Jh,Xh,Qh,em,tm,om,nm=o(369202);const im=[Zn.sO.TEXT];_h=(0,c.provide)("nodeSelectionFlow"),Mh=(0,c.inject)("projectUIState"),Ph=(0,c.inject)("rtcFlow"),Ah=(0,c.inject)("projectDoc"),kh=(0,c.inject)("nodeRichTextFlow"),Uh=(0,c.inject)("nodeEditingFlow"),Rh=(0,c.inject)("nodeManagementFlow"),Zh=(0,c.inject)("layoutManagementFlow"),Lh=(0,c.inject)("elementRefProvider"),$h=(0,c.inject)("interactiveElementsFlow"),Bh=(0,c.inject)("nodeReferencesFlow"),Gh=(0,c.inject)("sentryService"),_h((zh=class{constructor(){(0,i.Z)(this,"projectUIState",Yh,this),(0,i.Z)(this,"rtcFlow",Vh,this),(0,i.Z)(this,"projectDoc",Wh,this),(0,i.Z)(this,"nodeRichTextFlow",Kh,this),(0,i.Z)(this,"nodeEditingFlow",qh,this),(0,i.Z)(this,"nodeManagementFlow",Jh,this),(0,i.Z)(this,"layoutManagementFlow",Xh,this),(0,i.Z)(this,"elementRefProvider",Qh,this),(0,i.Z)(this,"interactiveElementsFlow",em,this),(0,i.Z)(this,"nodeReferencesFlow",tm,this),(0,i.Z)(this,"sentryService",om,this)}setHoveredNodeId(e){const{nodeId:t,nodeInstanceId:o}=e;let n;const i=this.projectUIState.selection.nodeInstanceIds;if(o)n=o;else if(t){const e=this.elementRefProvider.getFirstDomElementNodeInstanceIdByNodeId(t);e&&!i[e]&&(n=null!==e&&void 0!==e?e:void 0)}(0,a.mutate)(this.projectUIState,(e=>{e.hover.hoveredNodeInstanceId=n}))}setComponentLinkedNodeIds(e){const{nodeIds:t,hoveringCompLink:o,compInstanceId:n}=e,i={};if(n){const e=this.elementRefProvider.getDomNodeElementRefById(n||"");if(!e)return;null===t||void 0===t||t.forEach((t=>{var o;if(!t)return;const n=null===(o=this.elementRefProvider.getNodeInstanceForNodeIdInParentInstanceId(t,e.dataset.nodeInstanceId||""))||void 0===o?void 0:o.nodeInstanceId;n&&(i[n]=!0)}))}else null===t||void 0===t||t.forEach((e=>{if(e){var t,o;if(!this.projectDoc.nodes.getById(e))return;const s=this.elementRefProvider.getDomNodeElementRefById(e);if(s&&(null!==(t=s.dataset)&&void 0!==t&&t.boundToPropId||"contents"===(null===(o=s.style)||void 0===o?void 0:o.display))){var n,r;const e=null===(n=s.children[0])||void 0===n||null===(r=n.children)||void 0===r?void 0:r[0];return void(e&&(i[e.dataset.nodeInstanceId]=!0))}const a=this.elementRefProvider.getFirstDomElementNodeInstanceIdByNodeId(e);a&&(i[a]=!0)}}));(0,a.mutate)(this.projectUIState,(e=>{e.hover.componentLinkedNodeInstanceIds=i,e.hover.hoveringCompLink=o}))}getArrayOfHoveredNodeIds(){const e=this.projectUIState.hover.hoveredNodeInstanceId;if(!e)return[];const t=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(e);return t?[t]:[]}getComponentLinkedNodeInstanceIds(){return Object.keys(this.projectUIState.hover.componentLinkedNodeInstanceIds)}getDependentInstanceId(e,t,o){const n=this.getDependentNode(e,o);if(n===e)return t;return this.elementRefProvider.getFirstInstanceIdOfNodeInParentInstance(n,t)||t}resetNodeSelection(){(0,a.mutate)(this.projectUIState,(e=>{var t,o;Object.keys(null!==(t=null===(o=e.selection)||void 0===o?void 0:o.nodes)&&void 0!==t?t:{}).forEach((t=>{e.selection.persistSelectionOnNodeId!==t&&delete e.selection.nodes[t],e.selection.compInstanceId=null,this.resetNodeInPreview(),e.selection.nodeInstanceIds={}}))}))}getSelectedNodeInstanceIds(e){var t,o;const n=e||this.projectUIState;return Object.keys(null!==(t=null===(o=n.selection)||void 0===o?void 0:o.nodeInstanceIds)&&void 0!==t?t:{})}getSelectedDependentNodeInstanceIds(e){var t,o;const n=e||this.projectUIState;return Object.values(null!==(t=null===(o=n.selection)||void 0===o?void 0:o.nodeInstanceIds)&&void 0!==t?t:{})}getSelectedNodesIds(e){var t,o;const n=e||this.projectUIState;return Object.keys(null!==(t=null===(o=n.selection)||void 0===o?void 0:o.nodes)&&void 0!==t?t:{})}getSelectedDependentNodeIds(e){var t,o;const n=e||this.projectUIState;return Object.values(null!==(t=null===(o=n.selection)||void 0===o?void 0:o.nodes)&&void 0!==t?t:{})}getSelectedNodeOrComponentId(){var e;var t,o;if(1===this.getSelectedNodesIds().length)return Object.keys(null!==(t=null===(o=this.projectUIState.selection)||void 0===o?void 0:o.nodes)&&void 0!==t?t:{})[0];const n=this.projectUIState.selection.componentId;if(!n)return null;const i=this.projectDoc.pages.byId[n]||this.projectDoc.components.byId[n];return null!==(e=null===i||void 0===i?void 0:i.rootNodeId)&&void 0!==e?e:null}getSelectedNodeType(){var e;const t=this.getSelectedNodeOrComponentId();if(!t)return null;const o=this.projectDoc.nodes.getById(t);return o?null!==(e=null===o||void 0===o?void 0:o.semanticType)&&void 0!==e?e:null===o||void 0===o?void 0:o.primitiveType:null}getSelectNodeComponentInstanceId(){return this.projectUIState.selection.compInstanceId}selectAllSiblingsForNodeOrNodeInstance(){var e;const t=this.getSelectedNodesIds();if(1!==t.length)return;if(1===this.getSelectedNodeInstanceIds().length){const e=this.elementRefProvider.getAllSiblingsForNodeInstanceId(this.getSelectedNodeInstanceIds()[0])||[];return void this.setMultipleNodeInstancesSelection(e)}const o=null===(e=this.projectDoc.nodes.getById(t[0]))||void 0===e?void 0:e.parentId,n=o&&this.projectDoc.nodes.getById(o);if(!n)return;const i="childrenIds"in n?Object.keys(n.childrenIds):[];this.setMultipleNodesSelection(i)}selectNextSiblingForNodeOrNodeInstance(){const e=this.getSelectedNodesIds();if(1!==e.length)return;const t=this.getSelectedNodeInstanceIds();if(1===t.length)return void this.selectNextSiblingByNodeInstanceId(t[0]);const o=this.projectDoc.nodes.getNextSibling(this.projectDoc.nodes.getById(e[0]));o&&this.setNodeSelection({nodeId:o.id,isMultiSelectMode:!1,keepCurrentCompInstance:!0})}selectPreviousSiblingForNodeOrNodeInstance(){const e=this.getSelectedNodesIds();if(1!==e.length)return;const t=this.getSelectedNodeInstanceIds();if(1===t.length)return void this.selectPrevSiblingByNodeInstanceId(t[0]);const o=this.projectDoc.nodes.getPrevSibling(this.projectDoc.nodes.getById(e[0]));o&&this.setNodeSelection({nodeId:o.id,isMultiSelectMode:!1,keepCurrentCompInstance:!0})}selectNextSiblingByNodeInstanceId(e){const t=this.elementRefProvider.getNextSiblingForNodeInstanceId(e);t&&this.setNodeSelection({isMultiSelectMode:!1,nodeInstanceId:t.nodeInstanceId,keepCurrentCompInstance:!0})}selectPrevSiblingByNodeInstanceId(e){const t=this.elementRefProvider.getPrevSiblingForNodeInstanceId(e);t&&this.setNodeSelection({isMultiSelectMode:!1,nodeInstanceId:t.nodeInstanceId,keepCurrentCompInstance:!0})}selectParentNodeOrNodeInstance(){const e=this.getSelectedNodesIds();if(1!==e.length)return;const t=this.getSelectedNodeInstanceIds();if(1===t.length)return this.selectParentNodeInstance(t[0]);this.selectNodeParent(e[0])}selectNodeParent(e,t){if(!e)return;const o=this.projectDoc.nodes.getById(e);if(!o)return;const n=o.getActualParentId(t);if(!n)return void this.resetNodeSelection();const i=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(n||"").compInstanceId||this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e).compInstanceId;this.setNodeSelection({nodeId:n,isMultiSelectMode:!1,compInstanceId:i})}selectParentNodeInstance(e){const t=this.elementRefProvider.getClosestInteractiveParentNodeInstanceId(e);if(!t)return void this.resetNodeSelection();const o=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(t),n=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(e);if(!o||!n)return;const i=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(o||"").compInstanceId||this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(n).compInstanceId;this.setNodeSelection({isMultiSelectMode:!1,nodeInstanceId:t,compInstanceId:i})}selectNewPrimitiveInstanceId(e){var t;const{primitiveNodeId:o,parentId:n,parentAcceptsChildren:i}=e,r=this.getSelectedNodeInstanceIds();if((null===r||void 0===r?void 0:r.length)>1)return;let s;if(s=i?r[0]:this.elementRefProvider.getClosestParentNodeInstanceId(r[0]),!s)return;const a=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(s);if(a!==n)return void this.sentryService.captureException(new Error(`The calculated target instance does not seem to be the right one with the initial parentId ${a} ${n}`));const c=null===(t=this.elementRefProvider.getNodeInstanceForNodeIdInParentInstanceId(o,s))||void 0===t?void 0:t.nodeInstanceId;return c?(this.setNodeSelection({nodeInstanceId:c,compInstanceId:this.projectUIState.selection.compInstanceId}),c):void 0}selectChildOrEditNode(){var e,t;const o=this.getSelectedNodesIds(),n=this.getSelectedNodeInstanceIds();let i=this.projectUIState.selection.compInstanceId;if(1!==o.length)return;const r=this.projectDoc.nodes.getById(o[0]);if(!r)return;const s=this.projectDoc.nodes.getById(r.parentId||"");if(r.getNodeAllowedOps(s).edit)return void this.nodeEditingFlow.beginEditingNodeInstance(r.id,null===n||void 0===n?void 0:n[0]);const a=this.nodeManagementFlow.getNodeChildren(r.id,null!==(e=i)&&void 0!==e?e:void 0)||{},c=this.projectDoc.nodes.nodeIsCompInstance(r);if(!c&&(0===a.length||0===(null===(t=Zn.y7[r.primitiveType])||void 0===t?void 0:t.length)))return;let l;if(c){const e=this.projectDoc.components.byId[r.compIdOfCompInstance];i=r.id;const t=this.projectDoc.nodes.orderChildrenIds(Object.keys((null===e||void 0===e?void 0:e.slots)||{}))[0];if(!t)return;l=this.projectDoc.nodes.getById(t)}else{var d;l=this.projectDoc.nodes.getFirstChild(r,null!==(d=i)&&void 0!==d?d:void 0)}if(l){let e;var p;if(n.length)e=null===(p=this.elementRefProvider.getNodeInstanceForNodeIdInParentInstanceId(l.id,n[0]))||void 0===p?void 0:p.nodeInstanceId;this.setNodeSelection({nodeId:l.id,nodeInstanceId:e,isMultiSelectMode:!1,compInstanceId:i})}const u="childrenIds"in r?Object.keys(r.childrenIds):[];r.primitiveType!==Zn.sO.BUTTON||1!==u.length||this.nodeEditingFlow.beginEditingNodeInstance(u[0],n[0])}editSelectedNodeOrNodeInstance(){const e=this.getSelectedNodeInstanceIds(),t=this.getSelectedNodesIds(),o=this.projectDoc.nodes.getAllowedUserOpsForNodes(t);if(1!==t.length||!o.edit)return;const n=this.projectDoc.nodes.getById(t[0]);n.primitiveType&&n.primitiveType!==Zn.sO.DEV_COMPONENT&&im.includes(n.primitiveType)&&this.nodeEditingFlow.beginEditingNodeInstance(t[0],e[0])}getDependentNode(e,t){var o;const n=this.projectDoc.nodes.getById(e);if(!n||!n.primitiveType)return e;if(!("contentChildren"in n))return n.id;const i=null===(o=Object.values(n.contentChildren||{}))||void 0===o?void 0:o[0];if(!i||"dynamic"!==i.type||"prop"!==i.content.referenceType)return n.id;const r=this.projectDoc.components.byId[this.projectDoc.nodes.getComponentIdOf(e||"")||""],s=null===r||void 0===r?void 0:r.propDefinitions[i.content.id];if("richtext"!==(null===s||void 0===s?void 0:s.type))return e;const a=this.projectDoc.nodes.getById(s.defaultHierarchyRootId||""),c=Object.keys((null===a||void 0===a?void 0:a.childrenIds)||{})[0]||e,l=t||this.projectUIState.selection.compInstanceId;if(l){var d;const t=this.projectDoc.nodes.getById(l);if(!t||"component-instance-node"!==t.type)return c;const o=t.attrs[s.name];if(!o||"hierarchy"!==o.type)return c;const n=this.projectDoc.nodes.getById((null===o||void 0===o||null===(d=o.content)||void 0===d?void 0:d.toString())||"");return Object.keys((null===n||void 0===n?void 0:n.childrenIds)||{})[0]||e}return c}setMultipleNodeInstancesSelection(e,t){e.length&&(0,a.mutate)(this.projectUIState,(o=>{o.stage.setInteractionState(null),o.selection.nodes={},o.selection.nodeInstanceIds={},e.forEach((e=>{const n=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(e);if(n){if(!this.rtcFlow.isNodeLocked(n)){if(o.selection.nodeInstanceIds[e])return delete o.selection.nodeInstanceIds[e],void delete o.selection.nodes[n];{const i=this.getDependentNode(n,t);return o.selection.nodeInstanceIds[e]=this.getDependentInstanceId(n,e,t),o.selection.nodes[n]=i,void this.expandTreeviewToNodeAndFocusSidebar(n)}}}else delete o.selection.nodeInstanceIds[e]})),o.selection.compInstanceId=t||null}))}setMultipleNodesSelection(e,t){e.length&&(0,a.mutate)(this.projectUIState,(o=>{o.stage.setInteractionState(null),Object.keys(o.selection.nodes).forEach((e=>delete o.selection.nodes[e])),o.selection.nodeInstanceIds={},e.forEach((e=>{if(!this.rtcFlow.isNodeLocked(e)){if(o.selection.nodes[e])return delete o.selection.nodes[e],o;{o.selection.nodes[e]=this.getDependentNode(e,t);const n=this.elementRefProvider.getFirstDomElementNodeInstanceIdByNodeId(e);return n&&(o.selection.nodeInstanceIds[n]=this.getDependentInstanceId(e,n,t)),this.expandTreeviewToNodeAndFocusSidebar(e),o}}})),o.selection.compInstanceId=t||null}))}setNodeSelection({nodeId:e,nodeInstanceId:t,isMultiSelectMode:o=!1,expandTreeView:n=!0,compInstanceId:i=null,skipEnterEditMode:r=!1,keepCurrentCompInstance:s=!1,persistNodeSelection:c=!1}){const{compInstanceId:l}=this.projectUIState.selection;this.nodeReferencesFlow.stopReferenceHighlighting(),(0,a.mutate)(this.projectUIState,(({userInteractions:t,selection:o})=>{const n=this.projectDoc.nodes.getById(null!==e&&void 0!==e?e:"");t.sectionUnderReplace&&"preview-root-node"!==(null===n||void 0===n?void 0:n.type)&&(t.sectionUnderReplace=null),t.isNodeInPreviewMode=!1,o.persistSelectionOnNodeId=c&&null!==e&&void 0!==e?e:null})),e||t||this.resetNodeSelection();let d=e;var p;if(t){if(d=null!==(p=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(t))&&void 0!==p?p:e,!d)return}else d&&(t=this.elementRefProvider.getFirstDomElementNodeInstanceIdByNodeId(d));this.nodeRichTextFlow.toggleAddLink(!1),this.nodeRichTextFlow.storeSelection(null),(0,a.mutate)(this.projectUIState,(e=>{var a;if(e.stage.setInteractionState(null),!o){if(!d)return;if(this.setAvailableInspectorTabsForNode(d),this.rtcFlow.isNodeLocked(d))return;const o=!r&&this.shouldEnterEditModeOnSelection();this.handleInteractiveElementsSelection({nodeId:d,nodeInstanceId:t,uiState:e}),e.selection.nodeInstanceIds={},e.selection.nodes={};const a=this.getDependentNode(d,i);if(e.selection.nodes[d]=a,t){if(i){const e=this.elementRefProvider.getDomNodeElementRefByCompInstance(i);if(e){const t=e.dataset.nodeId,o=e.dataset.nodeInstanceId;t&&o&&this.expandTreeviewToNodeAndFocusSidebar(t)}}e.selection.nodeInstanceIds[t]=this.getDependentInstanceId(d,t,i)}return s||(e.selection.compInstanceId=i),n&&this.expandTreeviewToNodeAndFocusSidebar(d),void(o&&this.editSelectedNodeOrNodeInstance())}if(!d)return;if(i&&i!==l)return;if(t&&e.selection.nodeInstanceIds[t])return delete e.selection.nodeInstanceIds[t],void delete e.selection.nodes[d];if(e.selection.nodes[d]&&!t)return void delete e.selection.nodes[d];if(i&&(null===(a=this.projectDoc.nodes.getById(d))||void 0===a?void 0:a.primitiveType)===Zn.sO.SLOT)e.selection.nodes={[d]:this.getDependentNode(d,i)},t&&(e.selection.nodeInstanceIds={[t]:this.getDependentInstanceId(d,t,i)});else if(t){const o=this.getDependentInstanceId(d,t,i);e.selection.nodes[d]?e.selection.nodeInstanceIds={[t]:o}:(e.selection.nodeInstanceIds[t]=o,e.selection.nodes[d]=this.getDependentNode(d,i))}else e.selection.nodes[d]=this.getDependentNode(d,i);n&&this.expandTreeviewToNodeAndFocusSidebar(d)}))}handleInteractiveElementsSelection(e){var t;const{nodeId:o,nodeInstanceId:n,uiState:i}=e,r=null===(t=this.projectDoc.nodes.getAncestors({nodeId:o,includePassedNode:!0}).map((e=>this.projectDoc.nodes.getById(e))).filter((e=>Zn.tn.includes(null===e||void 0===e?void 0:e.primitiveType))).at(-1))||void 0===t?void 0:t.id;let s;if(n&&(s=this.elementRefProvider.getInteractiveRootNodeForNodeInstanceId(n)),r){var a;if(r!==i.selection.interactiveElementRoot.nodeId){const e=this.projectDoc.nodes.getById(r);switch(null===e||void 0===e?void 0:e.primitiveType){case Zn.IV.DROPDOWN:case Zn.IV.NAVBAR:this.projectDoc.nodes.getDescendents(i.selection.interactiveElementRoot.nodeId||"").filter((e=>e.primitiveType===Zn.IV.DROPDOWN_LIST||e.primitiveType===Zn.IV.MOBILE_MENU)).forEach((e=>{this.interactiveElementsFlow.checkIfNodeHasUtilityClassAndRemove(e,nm.w.SHOW,!0),this.interactiveElementsFlow.checkIfNodeHasUtilityClassAndRemove(e,nm.w.TRANSLATE_TO_DEFAULT,!0),delete i.selection.nodesWithUtilityClasses[e.id]}))}}i.selection.interactiveElementRoot.nodeId=r,i.selection.interactiveElementRoot.nodeInstanceId=null!==(a=s)&&void 0!==a?a:null}else i.selection.interactiveElementRoot.nodeId&&(this.projectDoc.nodes.getDescendents(i.selection.interactiveElementRoot.nodeId).filter((e=>e.primitiveType===Zn.IV.DROPDOWN_LIST||e.primitiveType===Zn.IV.MOBILE_MENU)).forEach((e=>{this.interactiveElementsFlow.checkIfNodeHasUtilityClassAndRemove(e,nm.w.SHOW,!0),this.interactiveElementsFlow.checkIfNodeHasUtilityClassAndRemove(e,nm.w.TRANSLATE_TO_DEFAULT,!0),delete i.selection.nodesWithUtilityClasses[e.id]})),this.resetNodeInPreview())}setSelectedNodeInPreview(){(0,a.mutate)(this.projectUIState,(e=>{e.selection.interactiveElementRoot.nodeId=this.getSelectedNodesIds()[0],e.selection.interactiveElementRoot.nodeInstanceId=this.getSelectedNodeInstanceIds()[0]}))}resetNodeInPreview(){(0,a.mutate)(this.projectUIState,(e=>{e.selection.interactiveElementRoot.nodeId=null,e.selection.interactiveElementRoot.nodeInstanceId=null}))}removeNodeSelection(e){(0,a.mutate)(this.projectUIState,(t=>{delete t.selection.nodes[e],this.resetNodeInPreview(),this.getSelectedNodeInstanceIds().forEach((o=>{this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(o)===e&&delete t.selection.nodeInstanceIds[o]}))}))}expandTreeviewToNodeAndFocusSidebar(e){const t=this.projectDoc.nodes.getById(e);if(!t)return;const o=this.projectUIState.layout.sidebarPanel;o&&![p.tI.ASSETS_MANAGER,p.tI.FILES].includes(o)&&this.layoutManagementFlow.changeActiveSidebar(p.tI.FILES);let n=this.projectUIState.selection.compInstanceId||this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e).compInstanceId,i=this.projectDoc.nodes.getById(t.getActualParentId(n));for(;i;){n===i.id&&(n=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(n).compInstanceId);const t=n===e?void 0:n;this.setExpandedTreeNodeValue(i.id,!0,t),i.primitiveType!==Zn.sO.SLOT?i=this.projectDoc.nodes.getById(i.getActualParentId()):i=this.projectDoc.nodes.getById(n||"")}}setNodeRangeSelection({nodeId:e,nodeInstanceId:t,compInstanceId:o}){(0,a.mutate)(this.projectUIState,(n=>{var i,r;n.selection.compInstanceId=o||null,n.stage.setInteractionState(null);const s=this.getSelectedNodesIds(),a=this.getSelectedNodeInstanceIds();if(!s.length)return n.selection.nodes[e]=this.getDependentNode(e,o),t&&(n.selection.nodeInstanceIds[t]=this.getDependentInstanceId(e,t,o)),n;let c=s[0];if(c===e)return n;const l=null===(i=this.projectDoc.nodes.getById(c))||void 0===i?void 0:i.getActualParentId(),d=null===(r=this.projectDoc.nodes.getById(e))||void 0===r?void 0:r.getActualParentId();if(!l||l!==d)return s.forEach((e=>delete n.selection.nodes[e])),a.forEach((e=>delete n.selection.nodeInstanceIds[e])),n.selection.nodes[e]=this.getDependentNode(e,o),t&&(n.selection.nodeInstanceIds[t]=this.getDependentInstanceId(e,t,o)),this.expandTreeviewToNodeAndFocusSidebar(e),n;const p=this.projectDoc.nodes.orderChildrenIds(this.nodeManagementFlow.getNodeChildren(l,o));if(0===p.length)return;let u=p.indexOf(c),h=p.indexOf(e);u>h&&(s.length>1&&(c=s[s.length-1]),u=p.indexOf(c),[u,h]=[h,u]);const m=p.slice(u,h+1);if(n.selection.nodes={},n.selection.nodeInstanceIds={},m.forEach((e=>n.selection.nodes[e]=this.getDependentNode(e,o))),t){const i=this.elementRefProvider.getClosestParentNodeInstanceId(t);if(i){m.map((e=>{var t;return null===(t=this.elementRefProvider.getNodeInstanceForNodeIdInParentInstanceId(e,i))||void 0===t?void 0:t.nodeInstanceId})).forEach((t=>{t&&(n.selection.nodeInstanceIds[t]=this.getDependentInstanceId(e,t,o))}))}}else m.forEach((e=>{const t=this.elementRefProvider.getFirstDomElementNodeInstanceIdByNodeId(e);t&&(n.selection.nodeInstanceIds[t]=this.getDependentInstanceId(e,t,o))}))}))}forceExpandTreeNode(e,t){const o=t||"root";this.setExpandedTreeNodeValue(e,!0,o)}forceCollapseTreeNode(e,t){const o=t||"root";this.setExpandedTreeNodeValue(e,!1,o,!0)}toggleExpandedTreeNode(e,t){var o;const n=t||"root";this.setExpandedTreeNodeValue(e,!(null!==(o=this.projectUIState.selection.expandedTreeNodes[n])&&void 0!==o&&o[e]),n)}setExpandedTreeNodeValue(e,t,o,n){const i=o||"root";(0,a.mutate)(this.projectUIState,(o=>(o.selection.expandedTreeNodes[i]||(o.selection.expandedTreeNodes[i]={}),!t&&o.selection.expandedTreeNodes[i][e]?(delete o.selection.expandedTreeNodes[i][e],o):(n||(o.selection.expandedTreeNodes[i][e]=!0),o))))}deleteSelectedNodesByNodeIds(e){(0,a.mutate)(this.projectUIState,(t=>{this.getSelectedNodeInstanceIds().forEach((o=>{const n=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(o);n&&e.indexOf(n)>-1&&delete t.selection.nodeInstanceIds[o]})),e.forEach((e=>{delete t.selection.nodes[e]}))}))}cleanSelectedExpandedAndEditedNodes(){(0,a.mutate)(this.projectUIState,(e=>{const t=[];this.getSelectedNodesIds().forEach((e=>{this.projectDoc.nodes.getById(e)||t.push(e)})),this.deleteSelectedNodesByNodeIds(t),Object.keys(e.selection.expandedTreeNodes).forEach((t=>{this.projectDoc.nodes.getById(t)?Object.keys(e.selection.expandedTreeNodes[t]||{}).forEach((t=>{this.projectDoc.nodes.getById(t)||delete e.selection.expandedTreeNodes[t]})):delete e.selection.expandedTreeNodes[t]}))}))}isNodeSelected(e,t){return!!(t||this.projectUIState).selection.nodes[e]}shouldEnterEditModeOnSelection(){const{nodeInstanceIds:e,nodes:t}=this.projectUIState.selection;let o=!1;const{editingNodeInstanceId:n}=this.projectUIState.staticNodeInterationsData;if(1!==Object.keys(e).length||!Object.keys(n).length)return!1;const i=this.projectDoc.nodes.getById(Object.keys(t)[0]);return Object.keys(n)[0]===Object.keys(e)[0]&&(o=!0),!((null===i||void 0===i?void 0:i.primitiveType)!==Zn.sO.TEXT||!o)}setAvailableInspectorTabsForNode(e){const t=this.projectDoc.nodes.getById(e),o=this.projectUIState.selection.componentId;if(!t||!o)return;const n=this.projectDoc.nodes.getInspectorTabsForNodes([e]),i=this.projectUIState.layout.visibleInspector,r=this.projectDoc.components.byId[null!==o&&void 0!==o?o:""];n[i]&&(i!==p.dG.EVENTS||r)||(0,a.mutate)(this.projectUIState,(e=>{e.layout.visibleInspector=p.dG.VISUAL}))}addGridChild(e){const{parentNodeId:t,rowStart:o,colStart:n,doc:i}=e;if(!i)return;const r=this.projectDoc.nodes.getById(t);if(!r)return;const s=new lu.HX({primitiveType:Zn.sO.CONTAINER,styles:{gridRowStart:new Yr.F({content:o.toString()}),gridRowEnd:new Yr.F({content:(o+1).toString()}),gridColumnStart:new Yr.F({content:n.toString()}),gridColumnEnd:new Yr.F({content:(n+1).toString()}),border:new Yr.F({content:"2px dashed rgba(120, 120, 120, 0.4)"})}});i.addNodesToParentOrStage({parentId:r.id,nodes:[s]})}removeGridChild(e){const{nodeId:t,doc:o}=e;o&&o.deleteNodesById({nodeIds:[t]})}},Yh=(0,s.Z)(zh.prototype,"projectUIState",[Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vh=(0,s.Z)(zh.prototype,"rtcFlow",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wh=(0,s.Z)(zh.prototype,"projectDoc",[Ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kh=(0,s.Z)(zh.prototype,"nodeRichTextFlow",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qh=(0,s.Z)(zh.prototype,"nodeEditingFlow",[Uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jh=(0,s.Z)(zh.prototype,"nodeManagementFlow",[Rh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xh=(0,s.Z)(zh.prototype,"layoutManagementFlow",[Zh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qh=(0,s.Z)(zh.prototype,"elementRefProvider",[Lh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),em=(0,s.Z)(zh.prototype,"interactiveElementsFlow",[$h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm=(0,s.Z)(zh.prototype,"nodeReferencesFlow",[Bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=(0,s.Z)(zh.prototype,"sentryService",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(zh.prototype,"addGridChild",[m.P],Object.getOwnPropertyDescriptor(zh.prototype,"addGridChild"),zh.prototype),(0,s.Z)(zh.prototype,"removeGridChild",[m.P],Object.getOwnPropertyDescriptor(zh.prototype,"removeGridChild"),zh.prototype),Hh=zh));var rm,sm,am,cm,lm,dm,pm,um,hm,mm,ym,gm,fm,bm,Im,vm,wm,Nm,jm,Sm,Dm,Tm,Om,Fm,Cm,Em,xm,_m=o(414326);!function(e){e.Name="name",e.Tag="semanticType",e.Type="primitiveType",e.Id="id",e.AttrId="attrId",e.Class="class"}(xm||(xm={}));rm=(0,c.provide)("nodeEditingFlow"),sm=(0,c.inject)("projectDoc"),am=(0,c.inject)("projectUIState"),cm=(0,c.inject)("componentManagementFlow"),lm=(0,c.inject)("sharedbProjectSyncService"),dm=(0,c.inject)("propDefinitionManagementFlow"),pm=(0,c.inject)("stateDefinitionManagementFlow"),um=(0,c.inject)("nodeStyleManagmentFlow"),hm=(0,c.inject)("nodeManagementFlow"),mm=(0,c.inject)("modalManagementFlow"),ym=(0,c.inject)("rtcFlow"),gm=(0,c.inject)("elementRefProvider"),fm=(0,h.G)(g.l.BEGIN_EDIT_TEXT),rm((Im=class{constructor(){(0,i.Z)(this,"projectDoc",vm,this),(0,i.Z)(this,"projectUIState",wm,this),(0,i.Z)(this,"componentManagementFlow",Nm,this),(0,i.Z)(this,"dbSync",jm,this),(0,i.Z)(this,"propDefinitionManagementFlow",Sm,this),(0,i.Z)(this,"stateDefinitionManagementFlow",Dm,this),(0,i.Z)(this,"nodeStyleManagementFlow",Tm,this),(0,i.Z)(this,"nodeManagementFlow",Om,this),(0,i.Z)(this,"modalManagementFlow",Fm,this),(0,i.Z)(this,"rtcFlow",Cm,this),(0,i.Z)(this,"elementRefProvider",Em,this),(0,r.Z)(this,"getCommonTypeForNodes",(e=>{let t,o;for(const n of e){const e=this.projectDoc.nodes.getById(n);e&&(void 0===t&&e.primitiveType&&(t=e.primitiveType),e.primitiveType!==t&&(t=Zn.sO.MIXED),void 0===o&&e.semanticType&&(o=e.semanticType),e.semanticType!==o&&(o=null))}return{primitiveType:t,semanticType:o}})),(0,r.Z)(this,"getCommonSemanticTypeForNodes",(e=>{let t=null;for(const o of e){const e=this.projectDoc.nodes.getById(o);if(!e)continue;const n=e.semanticType;if(!t&&n&&(t=n),n!==t)return null}return t})),(0,r.Z)(this,"getElementIconPath",(e=>{let t,o;const n=this.getCommonDisplayTypeForNodes(e);if(e.length>1)({primitiveType:t,semanticType:o}=this.getCommonTypeForNodes(e));else{const n=this.projectDoc.nodes.getById(e[0]);if(!n)return yl.YN[Zn.sO.SLOT];if(this.nodeIsRich({nodeId:(null===n||void 0===n?void 0:n.id)||""}))return _m.TV["rich-text"];t=n.primitiveType,o="semanticType"in n?n.semanticType:o}const i=n||(o&&yl.cf.includes(o)?o:t||"");return yl.YN[i]||yl.hK[i]})),(0,r.Z)(this,"getCommonDisplayTypeForNodes",(e=>{let t;for(const n of e){const e=this.projectDoc.nodes.getById(n);if(!e)continue;if(e.primitiveType!==Zn.sO.CONTAINER)return;const i=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(n,["display","flexDirection"]);let r="grid"===i.display?"grid":void 0;var o;if("flex"===i.display)null!==i&&void 0!==i&&i.flexDirection&&!["row","row-reverse"].includes(i.flexDirection.toString())||(r=yl.Bw.ROW),["column","column-reverse"].includes(null===(o=i.flexDirection)||void 0===o?void 0:o.toString())&&(r=yl.Bw.COLUMN);if(void 0===t&&r&&(t=r),r!==t)return}return t}))}nodeIsRich(e){const{nodeId:t,doc:o}=e,n=o||this.projectDoc,i=n.nodes.getById(t);if(!i)return!1;if(!(0,ni.yE)(i))return!1;if(!("contentChildren"in i)||!i.contentChildren)return!1;if(Object.keys((null===i||void 0===i?void 0:i.childrenIds)||{}).length)return!0;if(!Object.values(i.contentChildren).some((e=>"dynamic"===e.type&&"locale"===e.content.referenceType)))return!1;const r=i.getContentLangReferenceKey();if(!r)return!1;const{currentLanguage:s}=this.projectUIState.internationalization,a=n.internationalization.getTranslationRootHierarchyNodeId(s.short,r);return!!a&&this.nodeIsRich({nodeId:a,doc:o})}getNodeDisplayName(e){const{primitiveType:t,semanticType:o}=this.getCommonTypeForNodes(e);if(!t)return"";let n="",i=!1;if(1===e.length){const t=this.projectDoc.nodes.getById(e[0]);if(!t)return"";const o=this.projectDoc.nodes.getById(t.getActualParentId());if(n=t.name||"",t.compIdOfRootNode){n=this.projectDoc.getNameOfComponentOrPageById(t.compIdOfRootNode)||n}if("cms-mixed-type-node"===(null===o||void 0===o?void 0:o.type)){const e=Object.values(o.mappings).find((e=>e.componentInstanceId===t.id));n=(null===e||void 0===e?void 0:e.name)||n}i="abilities"in t&&!!t.abilities.link}if(this.projectUIState.userPreferences.showElementTag)return o||Zn.pS[t];if(n)return n;if(t===Zn.sO.COMPONENT){let t="";for(const o of e){const e=this.projectDoc.nodes.getById(o);if(e&&(this.projectDoc.nodes.nodeIsCompInstance(e)||e.compIdOfRootNode)){const o=this.projectDoc.getNameOfComponentOrPageById(e.compIdOfCompInstance||e.compIdOfRootNode||"");if(!o)throw new Error("Did not find selected component.");t||(t=o),t!==o&&(t=Zn.AP[Zn.sO.COMPONENT])}}return t}switch(t){case Zn.sO.TEXT:return i?"Link":null!==o&&void 0!==o&&o.includes("h")?"Heading":o===Zn.RY.LABEL?"Label":Zn.AP[Zn.sO.TEXT];default:return Zn.AP[t]}}linkNodeContentToProp(e){var t,o,n;const{nodeId:i,propId:r,refPath:s,doc:a}=e;if(!a)return;const c=a.nodes.getById(i);if(!c)return;if((!(0,ni.yE)(c)||this.nodeIsRich({nodeId:i}))&&"date-time-node"!==c.type&&"cms-html-node"!==c.type)return;const l=this.projectUIState.selection.componentId,d=null===(t=this.projectDoc.components.byId[l])||void 0===t?void 0:t.propDefinitions[r];if("cms-html-node"===c.type&&d)return c.html=new nr.P({content:{referenceType:"prop",id:d.id}}),void this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:i,location:{base:jd.hD.HTML_CONTENT},propId:d.id,doc:a});if(!d||!("contentChildren"in c))return;const p=Object.values(c.contentChildren||{});if(1===p.length)if("dynamic"===p[0].type){const{referenceType:e,id:t}=p[0].content;switch(e){case"prop":const e=null===(o=this.projectDoc.components.byId[l])||void 0===o?void 0:o.propDefinitions[t],r=e.defaultValue;if("boolean"===typeof r)throw new Error("Got boolean as default value. Expected string or number");"richtext"!==e.type&&this.replaceDynamicContentWithDefaultValue({nodeId:c.id,defaultValue:r,doc:a}),this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:i,location:{base:jd.hD.CONTENT},propId:e.id,doc:a});break;case"state":const s=null===(n=this.projectDoc.components.byId[l])||void 0===n?void 0:n.stateDefinitions[t],d=s.defaultValue;if("boolean"===typeof d)throw new Error("Got boolean as default value. Expected string or number");this.replaceDynamicContentWithDefaultValue({nodeId:c.id,defaultValue:d,doc:a}),this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:i,location:{base:jd.uw.CONTENT},stateId:s.id,doc:a})}if(c.contentChildren){var u;const e=new nr.P({content:{referenceType:"prop",id:d.id,refPath:s}});Object.keys(null!==(u=c.contentChildren)&&void 0!==u?u:{}).forEach((e=>{delete c.contentChildren[e]})),c.contentChildren[e.id]=e}this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:i,location:{base:jd.hD.CONTENT},propId:d.id,doc:a})}else{var h;null===(h=c.contentChildren)||void 0===h||delete h[p[0].id];const e=new nr.P({content:{referenceType:"prop",id:d.id,refPath:s},id:p[0].id});c.contentChildren[e.id]=e,this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:i,location:{base:jd.hD.CONTENT},propId:d.id,doc:a})}}unlinkNodeContentFromProp(e){const{nodeId:t,doc:o}=e;if(!o)return;const n=o.nodes.getById(t);if(!n||!("contentChildren"in n))return;const i=Object.values(n.contentChildren||{});if(1===i.length&&"dynamic"===i[0].type){var r;const e=this.projectUIState.selection.componentId,s=null===(r=o.components.byId[e])||void 0===r?void 0:r.propDefinitions[i[0].content.id];if(!s)return;o.replaceDynamicPropWithStaticNode({node:n,propId:s.id,propDefinition:s,newValue:s.defaultValue}),this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:t,location:{base:jd.hD.CONTENT},propId:s.id,doc:o})}}linkNodeContentToGlobalState(e){const{doc:t,nodeId:o,globalStatePath:n}=e;if(!t)return;let i=t.nodes.getById(o);if(!i||!("contentChildren"in i))return;if(!(0,ni.yE)(i)||this.nodeIsRich({nodeId:o}))return;const r=Object.values(i.contentChildren||{});if(1!==r.length)return;if("dynamic"===r[0].type&&(this.removeDynamicReferenceFromNodeContent({doc:t,nodeId:o}),i=t.nodes.getById(o)),!i||!("contentChildren"in i))return;const s=Object.keys(i.contentChildren||{});i.contentChildren[s[0]]=new nr.P({content:{referenceType:"global",refPath:n,id:(0,ni.Ox)()},id:s[0]})}linkNodeContentToState(e){var t;const{nodeId:o,stateId:n,doc:i}=e;if(!i)return;let r=i.nodes.getById(o);if(!r)return;if(!(0,ni.yE)(r)||this.nodeIsRich({nodeId:o}))return;const s=this.projectUIState.selection.componentId,a=null===(t=this.projectDoc.getProjectPageOrComponent(s))||void 0===t?void 0:t.stateDefinitions[n];if(!a||!("contentChildren"in r))return;const c=Object.values(r.contentChildren||{});if(1!==c.length)return;if("dynamic"===c[0].type&&(this.removeDynamicReferenceFromNodeContent({doc:i,nodeId:o}),r=i.nodes.getById(o)),!r||!("contentChildren"in r))return;const l=Object.keys(r.contentChildren||{});r.contentChildren[l[0]]=new nr.P({content:{referenceType:"state",id:a.id},id:l[0]}),this.stateDefinitionManagementFlow.addStateLocationForNode({nodeId:o,location:{base:jd.uw.CONTENT},stateId:a.id,doc:i})}removeDynamicReferenceFromNodeContent(e){var t,o;const{doc:n,nodeId:i}=e;if(!n)return;const r=n.nodes.getById(i);if(!r||!("contentChildren"in r))return;const s=Object.values(r.contentChildren||{});if(1!==s.length)return;const a=this.projectUIState.selection.componentId;if("dynamic"===s[0].type){const{referenceType:e,id:r}=s[0].content;switch(e){case"prop":const e=null===(t=this.projectDoc.getProjectPageOrComponent(a))||void 0===t?void 0:t.propDefinitions[r];this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:i,location:{base:jd.hD.CONTENT},propId:e.id,doc:n});break;case"state":const s=null===(o=this.projectDoc.getProjectPageOrComponent(a))||void 0===o?void 0:o.stateDefinitions[r];this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:i,location:{base:jd.uw.CONTENT},stateId:s.id,doc:n});break;case"locale":n.deleteNodesInternationalizationReferences({nodeIds:[i]})}}}unlinkNodeContentFromState(e){const{nodeId:t,defaultStateValue:o,doc:n}=e;if(!n)return;const i=n.nodes.getById(t);if(!i||!("contentChildren"in i))return;const r=Object.values(i.contentChildren||{});if(1===r.length&&"dynamic"===r[0].type){var s;const e=this.projectUIState.selection.componentId,a=null===(s=n.components.byId[e])||void 0===s?void 0:s.stateDefinitions[r[0].content.id];if(!a)return;n.replaceDynamicStateWithStaticNode({node:i,stateId:a.id,stateDefinition:a,staticValue:o||a.defaultValue}),this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:t,location:{base:jd.uw.CONTENT},stateId:a.id,doc:n})}}linkNodeContentToCtx(e){const{nodeId:t,ctxId:o,refPath:n,doc:i}=e;if(!i)return;let r=i.nodes.getById(t);if(!r||!("contentChildren"in r))return;const s=Object.values(r.contentChildren||{});if(1!==s.length)return;if("dynamic"===s[0].type&&(this.removeDynamicReferenceFromNodeContent({doc:i,nodeId:t}),r=i.nodes.getById(t)),!r||!("contentChildren"in r))return;const a=Object.keys(r.contentChildren||{});r.contentChildren[a[0]]=new nr.P({content:{referenceType:"ctx",ctxId:o,refPath:n,id:"refPath"},id:a[0]})}replaceDynamicContentWithHierarchy(e){const{nodeId:t,hierarchyRootId:o,doc:n}=e;if(!n||!o)return;const i=n.nodes.getById(t);if(!i||!("contentChildren"in i))return;const r=n.nodes.getById(o);if(!r)return;const s="childrenIds"in r?Object.keys(r.childrenIds)[0]:void 0;if(!s)return;const a=n.nodes.getById(s);if(a){if(Object.keys(i.contentChildren).forEach((e=>{delete i.contentChildren[e]})),"contentChildren"in a){const e=Object.keys(a.contentChildren||{});if(1===e.length){var c;const t=null===(c=a.contentChildren)||void 0===c?void 0:c[e[0]];if(t){if("dynamic"===t.type&&"locale"===t.content.referenceType){var l;const e=null===(l=t.content.refPath)||void 0===l?void 0:l[0];if(!e)throw new Error("No refPath found for lang reference");const o=n.duplicateTranslationNodesByRef({translationRef:e});if(o){const e=(0,ni.Ox)(),n=new nr.P({content:{referenceType:"locale",refPath:[o],id:e,fallbackValue:t.content.fallbackValue}});i.contentChildren={[e]:n}}return}const e=t.clone();return void(i.contentChildren={[e.id]:e})}}}"childrenIds"in a&&Object.keys(a.childrenIds).forEach((e=>{const o=n.nodes.getById(e);if(!o)return;const r=n.cloneNodeWithLangReferences({nodeId:e});r&&(r.parentId=t,r.pos=o.pos,n.addNode(r),i.childrenIds[r.id]=!0)}))}}replaceDynamicContentWithDefaultValue(e){const{nodeId:t,doc:o}=e;let{defaultValue:n}=e;if(!o)return;const i=o.nodes.getById(t);if(!i||!("contentChildren"in i))return;const r=i.contentChildren;if(!r)return;const s=Object.values(r);1===s.length&&"dynamic"===s[0].type&&Object.keys(r).forEach((e=>{var t;const o=r[e];if(null!==(t=o.content.refPath)&&void 0!==t&&t.length)for(const r of o.content.refPath){var i;n=null===(i=n)||void 0===i?void 0:i[r]}n||(n="Text"),r[e]=new Yr.F({content:n||"",id:e})}))}replaceDynamicCmsRichTextContentWithDefaultValue(e){const{nodeId:t,doc:o}=e;if(!o)return;const n=o.nodes.getById(t);n&&"html"in n&&n.html&&"dynamic"===n.html.type&&delete n.html}createNodeContentPropDefinition(e){const{nodeId:t,doc:o,createStringPropForTexts:n}=e;if(!o)return null;const i=o.nodes.getById(t);if(!i)return null;const r=this.projectUIState.selection.componentId,s=o.components.byId[r];return s?o.addDefaultContentPropDefinition({node:i,component:s,createStringPropForTexts:n,doc:o}):null}rename(e){this.dbSync.mutate(this.projectDoc,(t=>{const o=t.nodes.getById(e.id);if((null===o||void 0===o?void 0:o.name)===e.value)return t;if(!Hr.RQ.test(e.value))return t;if(o){if(this.projectDoc.nodes.nodeIsCompInstance(o)){const n=t.components.byId[o.compIdOfCompInstance];return e.value===(null===n||void 0===n?void 0:n.title)?(delete o.name,t):(o.name=e.value,t)}o.name=e.value}return t}))}beginEditingNodeInstance(e,t){if(e=this.projectUIState.selection.nodes[e]||e,t=this.projectUIState.selection.nodeInstanceIds[t||""]||t,this.rtcFlow.isNodeLocked(e))return;const o=this.projectDoc.nodes.getById(e);if(o)if(this.projectDoc.nodes.nodeIsCompInstance(o))this.componentManagementFlow.select(o.compIdOfCompInstance);else if("html"in o){var n;const e=b.d.createCustomModal({data:{code:null===(n=o.html)||void 0===n?void 0:n.content.toString(),title:"Code Embed (HTML+CSS+JS)",allowSaveWithErrors:!0},Component:au,onSubmit:e=>{e?this.nodeManagementFlow.updateHtmlForNodeById({nodeId:o.id,staticValue:e}):this.nodeManagementFlow.deleteHtmlForNodeById({nodeId:o.id}),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(e,{padding:"0px"},!1)}else if("contentChildren"in o&&(0,ni.yE)(o)){var i;const n=Object.values(o.contentChildren||{});if(1===n.length&&"dynamic"===n[0].type&&"global"===n[0].content.referenceType)return;const{editingNodeInstanceId:s}=this.projectUIState.staticNodeInterationsData;let c=t;var r;if(!c)c=null!==(r=this.elementRefProvider.getFirstDomElementNodeInstanceIdByNodeId(e))&&void 0!==r?r:void 0;if(!c||s&&s[c])return;const l=this.elementRefProvider.getDomElementCompInstanceIdByNodeInstanceId(c),d=null===n||void 0===n?void 0:n[0];return 1===n.length&&"dynamic"===d.type&&("prop"!==d.content.referenceType&&"locale"!==d.content.referenceType||null!==(i=d.content.refPath)&&void 0!==i&&i.length&&"locale"!==d.content.referenceType)?((0,a.mutate)(this.projectUIState,(({layout:e,dynamicNodeInteractionsData:t,selection:o})=>{const n="prop"===d.content.referenceType?p.wU.PROPS:p.wU.STATE;e.selectedComponentSetupTab!==n&&(e.selectedComponentSetupTab=n),t.isManagingProps=!0,t.selectedPropId=d.content.id,t.autofocusDefaultValue=!0,l&&(o.compInstanceId=l)})),void setTimeout((()=>{(0,a.mutate)(this.projectUIState,(({dynamicNodeInteractionsData:e})=>{e.autofocusDefaultValue=!1}))}),100)):void(0,a.mutate)(this.projectUIState,(e=>{const t=Object.keys(s)[0]||-1;delete e.staticNodeInterationsData.editingNodeInstanceId[t],e.staticNodeInterationsData.editingNodeInstanceId[c]=!0,e.staticNodeInterationsData.editingCompInstanceId=l,e.layout.visibleInspector=p.dG.VISUAL,e.selection.compInstanceId=l}))}}nodeMeetsSearchCondition(e){const{nodeId:t,searchTerm:o}=e,n=this.projectDoc.nodes.getById(t);if(!n)return null;const i=o.trim().toLowerCase(),r={[xm.Name]:()=>{var e;if("component-instance-node"===n.type){var o;const e=this.projectDoc.components.byId[n.compIdOfCompInstance];return null!==(o=null===e||void 0===e?void 0:e.title.toLowerCase().includes(i))&&void 0!==o&&o}const r=this.getNodeDisplayName([t]);return null!==(e=null===r||void 0===r?void 0:r.toLocaleLowerCase().includes(i))&&void 0!==e&&e},[xm.Tag]:()=>{var e;if("component-instance-node"===n.type){var t;const e=this.projectDoc.components.byId[n.compIdOfCompInstance];return null!==(t=null===e||void 0===e?void 0:e.title.toLowerCase().includes(i))&&void 0!==t&&t}const o=n.semanticType||Zn.pS[n.primitiveType];return null!==(e=null===o||void 0===o?void 0:o.toLocaleLowerCase().includes(i))&&void 0!==e&&e},[xm.Id]:()=>{var e,t;return null!==(e=null===(t=n[xm.Id])||void 0===t?void 0:t.toLowerCase().includes(i))&&void 0!==e&&e},[xm.Type]:()=>{var e,t;return null!==(e=null===(t=n[xm.Type])||void 0===t?void 0:t.toLowerCase().includes(i))&&void 0!==e&&e},[xm.AttrId]:()=>{if("attrs"in n){var e;const t=null===(e=n.attrs)||void 0===e?void 0:e.id;return t&&"static"===t.type&&t.content.toString().toLocaleLowerCase().includes(i)}},[xm.Class]:()=>"referencedStyles"in n&&Object.values(n.referencedStyles).some((e=>{var t;return"project-referenced"===e.content.mapType&&(null===(t=this.projectDoc.classes.byId[e.content.referenceId])||void 0===t?void 0:t.getName(this.projectDoc.classes.byId).toLocaleLowerCase().includes(i))}))};return Object.values(r).some((e=>e()))}},vm=(0,s.Z)(Im.prototype,"projectDoc",[sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wm=(0,s.Z)(Im.prototype,"projectUIState",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nm=(0,s.Z)(Im.prototype,"componentManagementFlow",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jm=(0,s.Z)(Im.prototype,"dbSync",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sm=(0,s.Z)(Im.prototype,"propDefinitionManagementFlow",[dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dm=(0,s.Z)(Im.prototype,"stateDefinitionManagementFlow",[pm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tm=(0,s.Z)(Im.prototype,"nodeStyleManagementFlow",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om=(0,s.Z)(Im.prototype,"nodeManagementFlow",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fm=(0,s.Z)(Im.prototype,"modalManagementFlow",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cm=(0,s.Z)(Im.prototype,"rtcFlow",[ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Em=(0,s.Z)(Im.prototype,"elementRefProvider",[gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Im.prototype,"linkNodeContentToProp",[m.P],Object.getOwnPropertyDescriptor(Im.prototype,"linkNodeContentToProp"),Im.prototype),(0,s.Z)(Im.prototype,"unlinkNodeContentFromProp",[m.P],Object.getOwnPropertyDescriptor(Im.prototype,"unlinkNodeContentFromProp"),Im.prototype),(0,s.Z)(Im.prototype,"linkNodeContentToGlobalState",[m.P],Object.getOwnPropertyDescriptor(Im.prototype,"linkNodeContentToGlobalState"),Im.prototype),(0,s.Z)(Im.prototype,"linkNodeContentToState",[m.P],Object.getOwnPropertyDescriptor(Im.prototype,"linkNodeContentToState"),Im.prototype),(0,s.Z)(Im.prototype,"linkNodeContentToCtx",[m.P],Object.getOwnPropertyDescriptor(Im.prototype,"linkNodeContentToCtx"),Im.prototype),(0,s.Z)(Im.prototype,"replaceDynamicContentWithHierarchy",[m.P],Object.getOwnPropertyDescriptor(Im.prototype,"replaceDynamicContentWithHierarchy"),Im.prototype),(0,s.Z)(Im.prototype,"replaceDynamicContentWithDefaultValue",[m.P],Object.getOwnPropertyDescriptor(Im.prototype,"replaceDynamicContentWithDefaultValue"),Im.prototype),(0,s.Z)(Im.prototype,"replaceDynamicCmsRichTextContentWithDefaultValue",[m.P],Object.getOwnPropertyDescriptor(Im.prototype,"replaceDynamicCmsRichTextContentWithDefaultValue"),Im.prototype),(0,s.Z)(Im.prototype,"createNodeContentPropDefinition",[m.P],Object.getOwnPropertyDescriptor(Im.prototype,"createNodeContentPropDefinition"),Im.prototype),(0,s.Z)(Im.prototype,"beginEditingNodeInstance",[fm],Object.getOwnPropertyDescriptor(Im.prototype,"beginEditingNodeInstance"),Im.prototype),bm=Im));var Mm,Pm,Am,km,Um,Rm,Zm,Lm,$m,Bm,Gm,Hm,zm,Ym,Vm,Wm,Km,qm,Jm,Xm,Qm,ey=o(120998);function ty(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function oy(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ty(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ty(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Mm=(0,c.provide)("nodeAttributeManagmentFlow"),Pm=(0,c.inject)("projectUIState"),Am=(0,c.inject)("projectDoc"),km=(0,c.inject)("propDefinitionManagementFlow"),Um=(0,c.inject)("stateDefinitionManagementFlow"),Rm=(0,c.inject)("nodeManagementFlow"),Zm=(0,c.inject)("nodeRichTextFlow"),Lm=(0,c.inject)("selfHealingFlow"),$m=(0,h.G)(g.l.UPDATE_NODE_ATTRIBUTE),Bm=(0,ep.u)(ep.j.UPDATE_ATTR_KEY),Gm=(0,h.G)(g.l.REMOVE_NODE_ATTRIBUTE),Hm=(0,ep.u)(ep.j.UPDATE_ATTR_KEY),Mm((Ym=class{constructor(){(0,i.Z)(this,"projectUIState",Vm,this),(0,i.Z)(this,"projectDoc",Wm,this),(0,i.Z)(this,"propDefinitionManagementFlow",Km,this),(0,i.Z)(this,"stateDefinitionManagementFlow",qm,this),(0,i.Z)(this,"nodeManagementFlow",Jm,this),(0,i.Z)(this,"nodeRichTextFlow",Xm,this),(0,i.Z)(this,"selfHealingFlow",Qm,this),(0,r.Z)(this,"setFocusedImgAttr",((e,t)=>{var o;(null===(o=this.projectUIState.userInteractions.focusedImgAttr)||void 0===o?void 0:o.attrName)===e&&JSON.stringify(t||{})!==JSON.stringify(this.projectUIState.userInteractions.focusedImgAttr.meta||{})||(0,a.mutate)(this.projectUIState,(o=>{o.userInteractions.focusedImgAttr={attrName:e,meta:t}}))})),this.updateAttrByKey=this.updateAttrByKey.bind(this)}removePristineStatusFromAttribute(e){var t,o,n,i;const{nodeId:r,doc:s,canTryWithParent:a=!0}=e;if(!s)return;const c=s.nodes.getById(r);if(!c)return;if("fragment"!==(null===c||void 0===c?void 0:c.primitiveType)||!("meta"in c)||null===c||void 0===c||null===(t=c.meta)||void 0===t||!t.isAttributeRoot)return void(c.parentId&&a&&this.removePristineStatusFromAttribute({nodeId:c.parentId,canTryWithParent:!1,doc:s}));const l=null===c||void 0===c||null===(o=c.meta)||void 0===o?void 0:o.isAttributeRoot.attr,d=s.nodes.getById((null===c||void 0===c||null===(n=c.meta)||void 0===n||null===(i=n.isAttributeRoot)||void 0===i?void 0:i.nodeId)||"");if("component-instance-node"!==(null===d||void 0===d?void 0:d.type))return;const p=d.attrs[l];p&&"hierarchy"===p.type&&(p.pristine=!1)}replaceAttributeOfNodesWithNewValues(e){const{doc:t,attributes:o,nodes:n,sourceCompOrPageId:i,values:r}=e;if(t&&Object.keys(r).length)for(let c=0;c<n.length;c++){const e=n[c],l=e.sourceCompId===i,d=t.nodes.getById(e.id),p=t.getProjectPageOrComponent(e.sourceCompId);if(d&&"attrs"in d&&p)for(const n of o){var s,a;if(null===(s=r[n])||void 0===s||!s.length)continue;const o=null!==(a=r[n][c])&&void 0!==a?a:r[n][0],i=d.attrs[n];if(!i)continue;if("static"===i.type){i.content=o;continue}if("dynamic"!==i.type||"prop"!==i.content.referenceType)continue;const u=p.propDefinitions[i.content.id];if(!u)continue;if(l){u.defaultValue=o;continue}if(!e.instanceId)continue;const h=t.nodes.getById(e.instanceId);if(!h||!("attrs"in h))continue;const m=u.name,y=h.attrs[m];y?"static"===y.type&&(y.content=o):h.attrs[m]=new Yr.F({content:o,id:(0,ni.Ox)()})}}}resetPristineAttributesAfterPropChange(e,t){var o,n,i,r;if(Object.keys(null!==(o=null===(n=this.projectUIState)||void 0===n||null===(i=n.localWork)||void 0===i?void 0:i.nodesUnderLocalWork)&&void 0!==o?o:{}).length)return;const s=e.nodes.getById(null!==t&&void 0!==t?t:"");if(!s||"fragment"!==s.primitiveType)return;if(!("meta"in s))return;const a=null===(r=s.meta)||void 0===r?void 0:r.isPropRoot;if(!a)return;const c=e.components.byId[a.compId];if(!c||!Object.keys(c.instantiatedByNodes).length)return;const l=c.propDefinitions[a.prop];l&&Object.keys(c.instantiatedByNodes).forEach((t=>{const o=e.nodes.getById(t);if(!o||"component-instance-node"!==o.type)return;if(!("attrs"in o))return;const n=o.attrs[l.name];n&&"pristine"in n&&n.pristine&&this.resetHierarchyAttributeBackToPropDefault({doc:e,nodeId:t,attrName:l.name})}))}resetAllComponentHierarchyAttributes(e){const{doc:t,compId:o}=e;if(!t)return;const n=t.components.byId[o];if(!n)return;const i=Object.keys(n.instantiatedByNodes);i.length&&i.forEach((e=>{const o=t.nodes.getById(e);o&&"component-instance-node"===o.type&&"attrs"in o&&Object.keys(o.attrs).forEach((n=>{const i=o.attrs[n];i&&"hierarchy"===i.type&&this.resetHierarchyAttributeBackToPropDefault({doc:t,nodeId:e,attrName:n})}))}))}resetHierarchyAttributeBackToPropDefault(e){const{doc:t,nodeId:o,attrName:n}=e;if(!t)return;const i=t.nodes.getById(o);if(!i||"component-instance-node"!==i.type)return;const r=i.attrs[n];if(!r||"hierarchy"!==r.type)return;const s=t.components.byId[i.compIdOfCompInstance];if(!s)return;const a=Object.values(s.propDefinitions).find((e=>e.name===n));if(!a||a.inputType!==jd.SO.RICH_TEXT||!a.defaultHierarchyRootId)return;const c=t.cloneRichTextHierarchy({doc:t,rootNodeId:a.defaultHierarchyRootId,meta:{isAttributeRoot:{nodeId:i.id,attr:a.name}}});c&&(t.deleteNodesById({nodeIds:[r.content],deleteRoot:!0,skipRestoreParentsFakeSize:!0,withSubtree:!0}),i.attrs[a.name]={id:(0,ni.Ox)(),type:"hierarchy",content:`${c}`,pristine:!0})}createPropDefinitionForAttr(e){const{nodeId:t,key:o,inputType:n,defaultValue:i,doc:r}=e;if(!r)return null;const s=r.nodes.getById(t);if(!s)throw new Error(`Node that need to update attr is missing - ${t}`);const a=r.nodes.getComponentIdOf(t),c=r.components.byId[a];if(!c)throw new Error(`Comp that need to update attr is missing - ${a}`);switch(s.primitiveType){case Zn.sO.CMS_COLLECTION_ITEM:return r.addDefaultCMSItemPropDefinition({node:s,component:c,defaultValue:i,attrName:o});case Zn.sO.CMS_COLLECTION_LIST:return r.addDefaultCMSListPropDefinition({node:s,component:c,defaultValue:i,attrName:o});case Zn.sO.CMS_MIXED_TYPE_NODE:return r.addDefaultCMSMixedContentPropDefinition({node:s,component:c,defaultValue:i,attrName:o});case Zn.sO.CMS_ARRAY_MAPPER:return r.addDefaultCMSArrayMapperPropDefinition({node:s,component:c,defaultValue:i});default:return r.addDefaultAttrPropDefinition({node:s,component:c,defaultValue:i,inputType:n,attrName:o,doc:r})}}updateAttrByKey(e){var t;const{nodeId:o,key:n,value:i,propId:r,stateId:s,ctxId:c,saveAsExpression:l,globalStatePath:d,refPath:p,doc:u}=e;if(!u)return;const h=this.projectUIState.localWork.nodesUnderLocalWork,m=u.nodes.getById(o);if(!m)throw new Error(`Node that need to update link is missing - ${o}`);const y=(0,tl.Uq)(m,n),g=y?oy({},y):null,f=g&&"id"in g?g.id:(0,ni.Ox)(),b="component"===m.primitiveType,I="hierarchy"===(null===y||void 0===y?void 0:y.type),v=r||s||c&&p||(null===d||void 0===d?void 0:d.length);if(b&&I&&v){let e=null;if(r&&(e=new nr.P({content:{referenceType:"prop",id:r},id:f})),s&&(e=new nr.P({content:{referenceType:"state",id:s},id:f})),c&&p&&(e=new nr.P({content:{referenceType:"ctx",id:f,ctxId:c,refPath:p},id:f})),null!==d&&void 0!==d&&d.length&&(e=new nr.P({content:{referenceType:"global",id:f,refPath:d},id:f})),!e)throw new Error("No dynamic value was provided");this.nodeRichTextFlow.updateHierarchyNodeContentChildrenWithDynamicValue({doc:u,hierarchyRootId:y.content,dynamicValue:e})}else{if(v&&"attrs"in m&&m.attrs){if(g&&"dynamic"===g.type){const{referenceType:e}=g.content;this.removeLocationBasedOnReferenceType(o,n,e,g.content.id,u)}null!==d&&void 0!==d&&d.length&&(m.attrs[n]=new nr.P({content:{referenceType:"global",id:f,refPath:d},id:f})),r&&(m.attrs[n]=new nr.P({content:{referenceType:"prop",id:r,refPath:p},id:f}),this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:o,propId:r,location:{base:jd.hD.ATTR,sufix:n},doc:u})),s&&(m.attrs[n]=new nr.P({content:{referenceType:"state",id:s},id:f}),this.stateDefinitionManagementFlow.addStateLocationForNode({nodeId:o,stateId:s,location:{base:jd.uw.ATTR,sufix:n},doc:u})),c&&p&&(m.attrs[n]=new nr.P({content:{referenceType:"ctx",id:"refPath",ctxId:c,refPath:p},id:f}))}else if(g&&"dynamic"===g.type){const e=u.getComponentIdForNode(o);if(!e)throw new Error(`Component id not found for node: ${o}`);const t=u.getProjectPageOrComponent(e),{referenceType:r}=g.content;switch(r){case"prop":const o=g.content.id;if(h&&t&&o){const e=t.propDefinitions[o].defaultValue;(0,a.mutate)(this.projectUIState,(t=>{const n=t.localWork.initialPropValues;o&&n&&!n[o]&&(n[o]=e)}))}this.propDefinitionManagementFlow.updatePropDefinition({compId:e,propId:o,propData:{defaultValue:i},doc:u});break;case"state":const r=g.content.id;if(h&&t&&r){const e=null===t||void 0===t?void 0:t.stateDefinitions[r].defaultValue;(0,a.mutate)(this.projectUIState,(t=>{const o=t.localWork.initialPropValues;r&&o&&!o[r]&&(o[r]=e)}))}this.stateDefinitionManagementFlow.updateStateDefinition({stateId:r,stateData:{defaultValue:i},doc:u});case"ctx":"attrs"in m&&m.attrs&&(m.attrs[n]=new Yr.F({content:i,id:f}));break;case"expr":"attrs"in m&&m.attrs&&(m.attrs[n]=l?new nr.P({content:{referenceType:"expr",id:i.toString()}}):new Yr.F({content:i,id:f}))}}else if("attrs"in m&&m.attrs){if("hierarchy"===(null===g||void 0===g?void 0:g.type)){var w;const e=u.nodes.getById(g.content),t=Object.keys(null!==(w=null===e||void 0===e?void 0:e.childrenIds)&&void 0!==w?w:[])[0];t&&this.nodeRichTextFlow.replaceParentWithStaticText({doc:u,nodeId:t,text:i})}else if(!g||(null===g||void 0===g?void 0:g.content)!==i){const e="component-instance-node"===m.type;if(e&&"false"===i){var N;const e=u.getProjectPageOrComponent(m.compIdOfCompInstance);if(!e)throw new Error(`Component not found for node: ${m.id}`);const t=Object.values(e.propDefinitions).find((e=>e.name===n));if(!t)throw new Error(`Prop not found for component: ${e.id}`);if(Object.values(null!==(N=null===t||void 0===t?void 0:t.locations)&&void 0!==N?N:{}).find((e=>Object.values(e).find((e=>{if("open"===e.sufix)return!0})))))return void this.removeAttrByKey({doc:u,nodeId:o,key:n})}if(l)m.attrs[n]=new nr.P({content:{referenceType:"expr",id:i.toString()}});else{let o=i;if(e){var j;const e=Object.values((null===(j=u.getProjectPageOrComponent(m.compIdOfCompInstance))||void 0===j?void 0:j.propDefinitions)||{}).find((e=>e.name===n));switch(null===e||void 0===e?void 0:e.type){case"number":o=Number(i);break;case"boolean":o="true"===(null===i||void 0===i||null===(t=i.toString())||void 0===t?void 0:t.toLowerCase())}(0,a.mutate)(this.projectUIState,(t=>{m.compIdOfCompInstance&&null!==e&&void 0!==e&&e.id&&(t.componentList.propValues[m.compIdOfCompInstance]||(t.componentList.propValues[m.compIdOfCompInstance]={}),t.componentList.propValues[m.compIdOfCompInstance][e.id]||(t.componentList.propValues[m.compIdOfCompInstance][e.id]={id:e.id,type:e.type,name:e.name,value:e.defaultValue,meta:{highlightInTreeView:!1},componentInstanceValues:{}}),t.componentList.propValues[m.compIdOfCompInstance][e.id].componentInstanceValues||(t.componentList.propValues[m.compIdOfCompInstance][e.id].componentInstanceValues={}),t.componentList.propValues[m.compIdOfCompInstance][e.id].componentInstanceValues[m.id]=o)}))}m.attrs[n]=new Yr.F({content:o,id:f})}}}var S;if(this.resetPristineAttributesAfterPropChange(u,m.parentId),!h&&"attrs"in m&&m.attrs)u.syncAssetInNodeRelationByNewContent({node:m,oldContent:g,newContent:null!==(S=m.attrs[n])&&void 0!==S?S:null});h&&(0,a.mutate)(this.projectUIState,(e=>{var t;null===(t=e.localWork.changedAttrs)||void 0===t||t.push(n)}))}}removeAttrByKey(e){const{nodeId:t,key:o,doc:n}=e;let{defaultPropValue:i}=e;if(!n)return;const r=this.projectUIState.localWork.nodesUnderLocalWork,s=n.nodes.getById(t);if(!s)throw new Error(`Node that need to update link is missing - ${t}`);if("attrs"in s&&s.attrs){var c;const d=(0,tl.Uq)(s,o),p=d?oy({},d):void 0;if("dynamic"===(null===p||void 0===p?void 0:p.type)&&p.content.refPath)for(const e of p.content.refPath){var l;i=(null===(l=i)||void 0===l?void 0:l[e])||i}if("src"===o&&p&&"dynamic"!==p.type&&(null===s||void 0===s?void 0:s.primitiveType)===Zn.sO.IMAGE)return void this.updateAttrByKey(oy(oy({},e),{},{doc:n,value:or.M3.IMAGE_SRC}));if(p&&"hierarchy"===p.type)return void this.resetHierarchyAttributeBackToPropDefault({doc:n,nodeId:t,attrName:o});const u=null===(c=s.attrs[o])||void 0===c?void 0:c.id;if(delete s.attrs[o],this.nodeManagementFlow.unregisterInvalidDynamicNode(u),p&&"dynamic"===p.type){i&&"open"!==o&&this.updateAttrByKey(oy(oy({},e),{},{doc:n,value:i}));const{referenceType:r}=p.content;this.removeLocationBasedOnReferenceType(t,o,r,p.content.id,n)}else r||n.syncAssetInNodeRelationByNewContent({node:s,oldContent:null!==p&&void 0!==p?p:null,newContent:null});r&&(0,a.mutate)(this.projectUIState,(e=>{var t;null===(t=e.localWork.changedAttrs)||void 0===t||t.push(o)})),this.resetPristineAttributesAfterPropChange(n,s.parentId)}}copyAttrsFromNode(e){const{doc:t,nodeId:o,changedKeys:n,node:i}=e;t&&n.forEach((e=>{const n=(0,tl.Uq)(i,e);n?"dynamic"!==n.type&&this.updateAttrByKey({doc:t,nodeId:o,key:e,value:n.content}):this.removeAttrByKey({doc:t,nodeId:o,key:e})}))}removeLocationBasedOnReferenceType(e,t,o,n,i){switch(o){case"global":break;case"prop":this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:e,propId:n,location:{base:jd.hD.ATTR,sufix:t},doc:i});break;case"state":this.stateDefinitionManagementFlow.removeStateLocationForNode({nodeId:e,stateId:n,location:{base:jd.uw.ATTR,sufix:t},doc:i});break;case"ctx":break;default:throw new Error(`Unsupported reference type ${o}`)}}getConditionalValuesToRenderBoundNodes(e){return e&&"locations"in e?Object.keys(e.locations).reduce(((t,o)=>{var n;const i=this.projectDoc.nodes.getById(o);if(!i)return this.selfHealingFlow.removePropDefinitionLocationForNodeThatDoesntExist({propDef:e,nodeId:o}),t;if("component"===i.primitiveType){const n=i.compIdOfCompInstance,r=this.projectDoc.components.byId[n];if(!r)return t;const s=Object.values(r.propDefinitions).find((t=>Object.values(e.locations[o]).find((e=>e.sufix===t.name))));if(s){const e=this.getConditionalValuesToRenderBoundNodes(s).map((e=>{const t={nodeId:e.nodeId},o=this.projectDoc.nodes.getById(e.nodeId);return Object.keys(o.conditionalReferencedProjectStyles||{}).forEach((n=>{var i;const r=null===(i=o.conditionalReferencedProjectStyles)||void 0===i?void 0:i[n];if(r){var s,a;(null===(s=r.condition)||void 0===s||null===(a=s.conditions[0].operand)||void 0===a?void 0:a.toString())===e.value&&(t.styleId=n)}})),t}));return t.concat(e)}}const r=Object.entries((null===(n=e.locations)||void 0===n?void 0:n[o])||{}).reduce(((e,t)=>{const o=t[1];return o.base===jd.hD.CONDITIONAL?e.conditionalElements.push(o):o.base.includes(jd.hD.CONDITIONAL_STYLE)&&!o.base.includes("operand")?e.conditionalStyles.push(o):o.base.includes("operand")&&e.operands.push(o),e}),{conditionalElements:[],conditionalStyles:[],operands:[]}),{conditionalElements:s,conditionalStyles:a}=r;return s.length&&s.forEach((e=>(t.push({nodeId:o}),t))),a.length&&a.forEach((n=>{const i=n.base.split(`${jd.hD.CONDITIONAL_STYLE}-`)[1];let r=n.identifier;if(!r&&i){const t=this.projectDoc.classes.getSimpleClasses().find((e=>e.getName()===i));if(!t)throw new Error(`Class not found for css class id for ${i}`);r=t.id,this.selfHealingFlow.updateCssClassIdIdentifierForPropLocation({nodeId:o,propId:e.id,cssClassId:r,location:n})}return t.push({nodeId:o,styleId:r}),t})),t}),[]).filter((e=>{var t,o;const n=this.projectDoc.nodes.getById(e.nodeId),i=null===(t=n.renderingConditions)||void 0===t||null===(o=t.condition)||void 0===o?void 0:o.conditions[0].operand;if(i&&"object"===typeof i)return!1;if(e.styleId){var r;const t=null===(r=n.conditionalReferencedProjectStyles)||void 0===r?void 0:r[e.styleId];if(t){var s;const e=null===(s=t.condition)||void 0===s?void 0:s.conditions[0].operand;if(e&&"object"===typeof e)return!1}}return!0})).map((e=>{var t,o,n;const i=this.projectDoc.nodes.getById(e.nodeId);let r=((null===(t=i.renderingConditions)||void 0===t||null===(o=t.condition)||void 0===o||null===(n=o.conditions[0].operand)||void 0===n?void 0:n.toString())||"").toString();var s,a,c,l,d,p;e.styleId&&(r=(null===(s=i.conditionalReferencedProjectStyles)||void 0===s||null===(a=s[e.styleId])||void 0===a||null===(c=a.condition)||void 0===c||null===(l=c.conditions)||void 0===l||null===(d=l[0])||void 0===d||null===(p=d.operand)||void 0===p?void 0:p.toString())||"");return{value:r,nodeId:i.id}})):[]}},Vm=(0,s.Z)(Ym.prototype,"projectUIState",[Pm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wm=(0,s.Z)(Ym.prototype,"projectDoc",[Am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Km=(0,s.Z)(Ym.prototype,"propDefinitionManagementFlow",[km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qm=(0,s.Z)(Ym.prototype,"stateDefinitionManagementFlow",[Um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jm=(0,s.Z)(Ym.prototype,"nodeManagementFlow",[Rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xm=(0,s.Z)(Ym.prototype,"nodeRichTextFlow",[Zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qm=(0,s.Z)(Ym.prototype,"selfHealingFlow",[Lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Ym.prototype,"replaceAttributeOfNodesWithNewValues",[m.P],Object.getOwnPropertyDescriptor(Ym.prototype,"replaceAttributeOfNodesWithNewValues"),Ym.prototype),(0,s.Z)(Ym.prototype,"resetAllComponentHierarchyAttributes",[m.P],Object.getOwnPropertyDescriptor(Ym.prototype,"resetAllComponentHierarchyAttributes"),Ym.prototype),(0,s.Z)(Ym.prototype,"resetHierarchyAttributeBackToPropDefault",[m.P],Object.getOwnPropertyDescriptor(Ym.prototype,"resetHierarchyAttributeBackToPropDefault"),Ym.prototype),(0,s.Z)(Ym.prototype,"createPropDefinitionForAttr",[m.P],Object.getOwnPropertyDescriptor(Ym.prototype,"createPropDefinitionForAttr"),Ym.prototype),(0,s.Z)(Ym.prototype,"updateAttrByKey",[$m,m.P,Bm],Object.getOwnPropertyDescriptor(Ym.prototype,"updateAttrByKey"),Ym.prototype),(0,s.Z)(Ym.prototype,"removeAttrByKey",[Gm,m.P,Hm],Object.getOwnPropertyDescriptor(Ym.prototype,"removeAttrByKey"),Ym.prototype),(0,s.Z)(Ym.prototype,"copyAttrsFromNode",[m.P],Object.getOwnPropertyDescriptor(Ym.prototype,"copyAttrsFromNode"),Ym.prototype),zm=Ym));var ny,iy,ry,sy,ay,cy,ly,dy,py,uy,hy,my,yy,gy,fy,by=o(965699);function Iy(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function vy(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Iy(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Iy(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}ny=(0,c.provide)("nodeAbilityManagmentFlow"),iy=(0,c.inject)("projectDoc"),ry=(0,c.inject)("projectUIState"),sy=(0,c.inject)("sharedbProjectSyncService"),ay=(0,c.inject)("propDefinitionManagementFlow"),cy=(0,h.G)(g.l.UPDATE_NODE_LINK),ly=(0,h.G)(g.l.UPDATE_NODE_LINK_GLOBAL_STATE),dy=(0,h.G)(g.l.UPDATE_NODE_LINK_CONTEXT),py=(0,h.G)(g.l.REMOVE_NODE_LINK),ny((hy=class{constructor(){(0,i.Z)(this,"projectDoc",my,this),(0,i.Z)(this,"projectUIState",yy,this),(0,i.Z)(this,"dbSync",gy,this),(0,i.Z)(this,"propDefinitionManagementFlow",fy,this)}createPropDefinitionForLink(e){const{nodeId:t,type:o,location:n,meta:i,doc:r}=e;if(!r)return null;const s=r.nodes.getById(t);if(!s)throw new Error(`Node that need to update ability is missing - ${t}`);const a=r.nodes.getComponentIdOf(t),c=r.components.byId[a];if(!c)throw new Error(`Comp that need to update ability is missing - ${a}`);const l="abilities"in s?s.abilities.link&&JSON.parse(JSON.stringify(s.abilities.link)):null;if(l&&(l.type!==o?this.removeNodeLink({nodeId:t,linkLocations:[l.type]}):this.removeNodeLinkProp({link:l,nodeId:t,comp:c,linkLocations:[n]})),"abilities"in s&&"preview-root-node"!==s.type){const e=r.addDefaultLinkPropDefinition({node:s,comp:c,type:o,location:n,meta:i});return"styles"in s&&!s.styles.textDecoration&&(s.styles.textDecoration=new Yr.F({content:"none"})),e}return null}removeLinksFromChildrenWithLinkAbilitiesFromNode(e){const{doc:t,nodeId:o}=e;if(!t)return;if(!t.nodes.getById(o))throw new Error(`Could not remove links. Node not found: ${o}`);t.nodes.bfs(o,(e=>{"abilities"in e&&e.abilities.link&&e.id!==o&&this.removeNodeLink({nodeId:e.id})}))}updateNodeLink(e){const{nodeId:t,compInstanceId:o,type:n,content:i,doc:r}=e;if(!r)return;const s=r.nodes.getById(t);if(!s)throw new Error(`Node that need to update link is missing - ${t}`);if(!("abilities"in s))return;const a=r.nodes.getComponentIdOf(t),c=r.components.byId[a];if(this.removeLinksFromChildrenWithLinkAbilitiesFromNode({doc:r,nodeId:t}),!c)return void this.updateNodeLinkWithoutProps({node:s,type:n,content:i});const l=Object.keys(i)[0];if(!l)throw new Error("No link location found");const d=!!r.nodes.getSlotAndCompInstanceIdForNodeById(t).slotId;if(o&&o!==s.id&&!d)return void this.updateComponentInstanceAttributes({selectedNode:s,compInstanceId:o,linkType:n,linkContent:i,doc:r});const p=s.abilities.link&&JSON.parse(JSON.stringify(s.abilities.link));p&&(p.type!==n?this.removeNodeLink({nodeId:t,linkLocations:[p.type]}):this.removeNodeLinkProp({link:p,nodeId:t,comp:c,linkLocations:[l]})),this.updateNodeLinkWithoutProps({node:s,type:n,content:i})}updateComponentInstanceAttributes(e){const{compInstanceId:t,doc:o,selectedNode:n,linkType:i,linkContent:r}=e,s=o.nodes.getById(t);if(!s||"component-instance-node"!==s.type)throw new Error(`Component instance node not found: ${t}`);if(!("abilities"in n))return;const a=n.abilities.link;if(a.type!==$r.RZ.URL)throw new Error("Only URL link type is supported for component instance");const c=a.content;if(!(c.url instanceof nr.P))throw new Error("URL content is not dynamic");const l=o.getProjectPageOrComponent(o.getComponentIdForNode(n.id)||"");if(!l)throw new Error("Component owning node not found");const d=c.url.content.id,p=l.propDefinitions[d];if(!p)throw new Error(`Prop not found: ${d}`);let u="";switch(i){case"url":u=r.url;break;case"navlink":const e=r.routeName,t=o.getProjectPageOrComponent(e);if(!t)throw new Error(`Page not found: ${e}`);u=t.id;break;case"section":u=`#${r.section}`}s.attrs[p.name]=new Yr.F({content:u})}removeComponentInstanceAttributes(e){const{compInstanceId:t,doc:o,selectedNode:n}=e,i=o.nodes.getById(t);if(!i||"component-instance-node"!==i.type)throw new Error(`Component instance node not found: ${t}`);if(!("abilities"in n))return;const r=n.abilities.link;if(r.type!==$r.RZ.URL)throw new Error("Only URL link type is supported for component instance");const s=r.content;if(!(s.url instanceof nr.P))throw new Error("URL content is not dynamic");const a=o.getProjectPageOrComponent(o.getComponentIdForNode(n.id)||"");if(!a)throw new Error("Component owning node not found");const c=s.url.content.id,l=a.propDefinitions[c];if(!l)throw new Error(`Prop not found: ${c}`);delete i.attrs[l.name]}updateNodeLinkWithGlobalStateValue(e){const{nodeId:t,type:o,globalStatePath:n,doc:i}=e;if(!i)return;const r=i.nodes.getById(t);if(!r)throw new Error(`Node that need to update link is missing - ${t}`);const s=i.nodes.getComponentIdOf(t),a=i.getProjectPageOrComponent(s);if(!a)throw new Error(`Comp that need to update ability is missing - ${s}`);if(!("abilities"in r))return;const c="abilities"in r&&r.abilities.link&&JSON.parse(JSON.stringify(r.abilities.link)),l=new nr.P({content:{referenceType:"global",id:"globalRefPath",refPath:n}});c&&c.type===o?r.abilities.link.content[o]=l:r.abilities.link=new by.G({type:o,content:{newTab:!0,[o]:l}}),c&&"component"===a.type&&(c.type!==o?this.removeNodeLink({nodeId:t,linkLocations:[c.type]}):this.removeNodeLinkProp({link:c,nodeId:t,comp:a}))}updateNodeLinkWithCtxValue(e){const{nodeId:t,type:o,ctxId:n,refPath:i,doc:r}=e;if(!r)return;const s=r.nodes.getById(t);if(!s)throw new Error(`Node that need to update link is missing - ${t}`);if(!("abilities"in s))return;const a=r.nodes.getComponentIdOf(t),c=r.getProjectPageOrComponent(a);if(!c)throw new Error(`Comp that need to update ability is missing - ${a}`);const l="abilities"in s&&s.abilities.link&&JSON.parse(JSON.stringify(s.abilities.link)),d=new nr.P({content:{referenceType:"ctx",id:"refPath",ctxId:n,refPath:i}});l&&l.type===o?s.abilities.link.content[o]=d:s.abilities.link=new by.G({type:o,content:{newTab:!0,[o]:d}}),l&&"component"===c.type&&(l.type!==o?this.removeNodeLink({nodeId:t,linkLocations:[l.type]}):this.removeNodeLinkProp({link:l,nodeId:t,comp:c}))}updateNodeLinkWithoutProps(e){const{node:t,type:o,content:n}=e;if("abilities"in t){if(!Object.keys(n).length)throw new Error("No link location found");Object.keys(n).forEach((e=>{var i;(null===(i=t.abilities.link)||void 0===i?void 0:i.type)===o?t.abilities.link.content[e]=n[e]:(t.abilities.link=new by.G({type:o,content:n}),t.styles.textDecoration||(t.styles.textDecoration=new Yr.F({content:"none"})))}))}}updateNodeLinkProp(e){const{nodeId:t,type:o,location:n,propId:i,refPath:r,doc:s}=e;if(!s)return;const a=s.nodes.getById(t);if(!a)throw new Error(`Node that need to update link is missing - ${t}`);const c=s.nodes.getComponentIdOf(t),l=s.components.byId[c];if(!l)throw new Error(`Comp that need to update ability is missing - ${c}`);if(o===$r.RZ.SECTION||o===$r.RZ.NAVLINK)throw new Error("Link type doesn't support dynamic content");const d="abilities"in a&&a.abilities.link&&JSON.parse(JSON.stringify(a.abilities.link)),p=new nr.P({content:{referenceType:"prop",refPath:r,id:i}});d&&d.type===o?a.abilities.link.content[n]=p:a.abilities.link=new by.G({type:o,content:{[n]:p}}),l.addLocationToPropDefinition(i,t,{base:jd.hD.ABILITY,sufix:n}),d&&(d.type!==o?this.removeNodeLink({nodeId:t,linkLocations:[d.type]}):this.removeNodeLinkProp({link:d,nodeId:t,comp:l,linkLocations:[n]}))}removeNodeLink(e){const{nodeId:t,compInstanceId:o,linkLocations:n,removeOnlyProp:i,defaultPropValue:r,doc:s}=e;if(!s)return;const a=s.nodes.getById(t);if(!a)throw new Error(`Node that need to update link is missing - ${t}`);if(!("abilities"in a))return;const c=a.abilities.link;if(!c)return;const l=s.nodes.getComponentIdOf(t),d=s.components.byId[l],p=n&&"mail"!==n[0]?n:c.type===$r.RZ.MAIL?["subject","mail"]:[c.type];let u=!1;if(o&&o!==a.id)return void this.removeComponentInstanceAttributes({selectedNode:a,compInstanceId:o,doc:s});if(d){const e=JSON.parse(JSON.stringify(c));i&&p.forEach((e=>{var t;null!==(t=c.content)&&void 0!==t&&t[e]&&"string"!==typeof c.content[e]&&(a.abilities.link.content[e]=r||"",r&&(u=!0))})),this.removeNodeLinkProp({link:e,nodeId:t,comp:d,linkLocations:p})}if(i&&u)return;if(!("abilities"in a))return;const h=a.abilities.link.content;a.abilities.link.type!==$r.RZ.MAIL||Object.keys(h).every((e=>!h[e]||p.includes(e)))?delete a.abilities.link:p.forEach((e=>{a.abilities.link.content[e]=""})),a.styles.textDecoration&&delete a.styles.textDecoration}removeNodeLinkProp(e){const{link:t,nodeId:o,comp:n,linkLocations:i}=e;if(!t)return;(i||(t.type===$r.RZ.MAIL?["subject","mail"]:[t.type])).forEach((e=>{var i;if(!jd._u.includes(e))return;if(null===(i=t.content)||void 0===i||!i[e]||"string"===typeof t.content[e])return;const r=t.content[e].content.id;n.removeLocationFromPropDefinition(r,o,{base:jd.hD.ABILITY,sufix:e})}))}nodeHasAncestorWithLink(e){let t=this.projectDoc.nodes.getById(e);for(;null!==(o=t)&&void 0!==o&&o.parentId;){var o;if(t=this.projectDoc.nodes.getById(t.parentId),t&&"abilities"in t&&t.abilities.link)return!0}return!1}setLinkToComponentInstance(e){var t;const{selectedCompInstanceId:o,selectedNodeId:n,targetCompInstanceId:i,targetCompId:r,doc:s}=e;if(!s)return;const a=s.nodes.getById(n);if(!a)throw new Error(`Node not found: ${n}`);const c=s.nodes.getById(i);if(!c||"component-instance-node"!==c.type)throw new Error(`Component instance node not found: ${i}`);const l=s.components.byId[r];if(!l)throw new Error(`Component node not found: ${r}`);if(!l.rootNodeId)throw new Error("Component does not have a root node id");const d=s.nodes.getById(l.rootNodeId);if(!d)throw new Error("Root node of component not found");const p=null===(t=d.attrs)||void 0===t?void 0:t.id;if(!p||!(p instanceof nr.P)){const e=(0,du.rZ)(d),t=l.createPropDefinition(vy(vy({},e),{},{name:`${l.title}_id`,defaultValue:"",locations:{[d.id]:(0,Sd.B1)({base:jd.hD.ATTR,sufix:"id"})}})),i=new nr.P({content:{referenceType:"prop",id:t.id}});return d.attrs.id=i,c.attrs[t.name]=new Yr.F({content:l.title}),void(o&&o!==n?this.updateComponentInstanceAttributes({selectedNode:a,compInstanceId:o,linkType:$r.RZ.SECTION,linkContent:{section:l.title},doc:s}):this.updateNodeLink({nodeId:n,type:$r.RZ.SECTION,content:{section:l.title},doc:s}))}if(p instanceof nr.P){let e=c.attrs[p.content.id];return e||(e=new Yr.F({content:l.title})),void(o?this.updateComponentInstanceAttributes({selectedNode:a,compInstanceId:o,linkType:$r.RZ.SECTION,linkContent:{section:e.content},doc:s}):this.updateNodeLink({nodeId:n,type:$r.RZ.SECTION,content:{section:e.content},doc:s}))}}},my=(0,s.Z)(hy.prototype,"projectDoc",[iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yy=(0,s.Z)(hy.prototype,"projectUIState",[ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gy=(0,s.Z)(hy.prototype,"dbSync",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fy=(0,s.Z)(hy.prototype,"propDefinitionManagementFlow",[ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(hy.prototype,"createPropDefinitionForLink",[m.P],Object.getOwnPropertyDescriptor(hy.prototype,"createPropDefinitionForLink"),hy.prototype),(0,s.Z)(hy.prototype,"removeLinksFromChildrenWithLinkAbilitiesFromNode",[m.P],Object.getOwnPropertyDescriptor(hy.prototype,"removeLinksFromChildrenWithLinkAbilitiesFromNode"),hy.prototype),(0,s.Z)(hy.prototype,"updateNodeLink",[cy,m.P],Object.getOwnPropertyDescriptor(hy.prototype,"updateNodeLink"),hy.prototype),(0,s.Z)(hy.prototype,"updateNodeLinkWithGlobalStateValue",[ly,m.P],Object.getOwnPropertyDescriptor(hy.prototype,"updateNodeLinkWithGlobalStateValue"),hy.prototype),(0,s.Z)(hy.prototype,"updateNodeLinkWithCtxValue",[dy,m.P],Object.getOwnPropertyDescriptor(hy.prototype,"updateNodeLinkWithCtxValue"),hy.prototype),(0,s.Z)(hy.prototype,"updateNodeLinkProp",[m.P],Object.getOwnPropertyDescriptor(hy.prototype,"updateNodeLinkProp"),hy.prototype),(0,s.Z)(hy.prototype,"removeNodeLink",[py,m.P],Object.getOwnPropertyDescriptor(hy.prototype,"removeNodeLink"),hy.prototype),(0,s.Z)(hy.prototype,"removeNodeLinkProp",[m.P],Object.getOwnPropertyDescriptor(hy.prototype,"removeNodeLinkProp"),hy.prototype),(0,s.Z)(hy.prototype,"setLinkToComponentInstance",[m.P],Object.getOwnPropertyDescriptor(hy.prototype,"setLinkToComponentInstance"),hy.prototype),uy=hy));var wy,Ny,jy,Sy,Dy,Ty,Oy,Fy,Cy,Ey,xy,_y,My,Py,Ay,ky=o(633958),Uy=o.n(ky);function Ry(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Zy(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ry(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ry(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}wy=(0,c.provide)("nodeEventManagmentFlow"),Ny=(0,c.inject)("projectDoc"),jy=(0,c.inject)("projectUIState"),Sy=(0,c.inject)("sharedbProjectSyncService"),Dy=(0,c.inject)("propDefinitionManagementFlow"),Ty=(0,c.inject)("positioningService"),Oy=(0,c.inject)("sentryService"),wy((Cy=class{constructor(){(0,i.Z)(this,"projectDoc",Ey,this),(0,i.Z)(this,"projectUIState",xy,this),(0,i.Z)(this,"dbSync",_y,this),(0,i.Z)(this,"propDefinitionManagementFlow",My,this),(0,i.Z)(this,"positioningService",Py,this),(0,i.Z)(this,"sentryService",Ay,this)}getNodeEvents(e){const{nodeId:t}=e,o=this.projectDoc.nodes.getById(t);if(!o||!("events"in o)||!o.events)return[];const{events:n}=o;return Object.keys(n).reduce(((e,t)=>{const o=t;if(!n[o])return e;const i=this.positioningService.orderEntities({entitiyCollection:n[o]}).map((e=>{const t=n[o][e];return{eventId:e,propDefinitionId:"propCall"===t.type?t.id:void 0,eventType:t.type,supportedEvent:o,calls:"propCall"===t.type?t.calls:void 0,modifies:"stateChange"===t.type?t.modifies:void 0,newState:"stateChange"===t.type?t.newState:void 0,pos:t.pos,includeEventObject:t.includeEventObject}}));return e=[...e,...i]}),[])}getAllEventPropsForComponent(e){if(!e)return{};const t=this.projectDoc.components.byId[e];return t?Object.values(t.propDefinitions).reduce(((e,t)=>("func"!==t.type||(e[t.id]=t),e)),{}):{}}createPropCallEvent(e){const{nodeId:t,supportedEvent:o,propDefName:n,defaultValue:i,includeEventObject:r,doc:s}=e;if(!s)return;const a=s.nodes.getById(t);if(!a)throw new Error(`Node that need to update attr is missing - ${t}`);if(!("events"in a))return;const c=s.nodes.getComponentIdOf(t),l=s.components.byId[c];if(!l)throw new Error(`Comp that need to update attr is missing - ${c}`);const d=this.positioningService.getHighestAvailablePosition({entitiyCollection:a.events[o]});s.addPropCallEvent({node:a,component:l,defaultValue:i,supportedEvent:o,propDefName:n,pos:d,includeEventObject:r})}createStateChangeEvent(e){const{nodeId:t,supportedEvent:o,modifies:n,newState:i,includeEventObject:r,doc:s}=e;if(!s)return;const a=s.nodes.getById(t);if(!a)throw new Error(`Node to bind event to is missing - ${t}`);if(!("events"in a))return;const c=s.nodes.getComponentIdOf(t),l=s.getProjectPageOrComponent(c);if(!l)throw new Error(`Referenced component is missing - ${c}`);const d=this.positioningService.getHighestAvailablePosition({entitiyCollection:a.events[o]});s.addStateChangeEvent({node:a,component:l,supportedEvent:o,modifies:n,newState:i,pos:d,includeEventObject:r})}removeEventFromNode(e){const{nodeId:t,eventId:o,doc:n}=e;if(!n)return;const i=n.nodes.getById(t),r=n.nodes.getComponentIdOf(t);if(!i||!r)return;const s=n.getProjectPageOrComponent(r);s&&"events"in i&&i.events&&Object.keys(i.events).forEach((e=>{var n;const r=null===(n=i.events)||void 0===n?void 0:n[e][o];if(r&&"propCall"===r.type&&s instanceof Un.n){const o=r.id;s.removeLocationFromPropDefinition(o,t,{base:jd.hD.EVENT,sufix:e})}if(r&&"stateChange"===r.type){const o=r.newState;if(o&&"object"===typeof o&&"type"in o&&"dynamic"===o.type){const n=o;switch(n.content.referenceType){case"prop":if("component"!==s.type)break;const o=n.content.id;o&&s.removeLocationFromPropDefinition(o,t,{base:jd.hD.STATE_CHANGE_EVENT+o,sufix:e,identifier:o});break;case"state":const i=n.content.id;i&&s.removeLocationFromStateDefinition(i,t,{base:jd.uw.STATE_CHANGE_EVENT+i,sufix:e,identifier:i})}}}delete i.events[e][o],Object.keys(i.events[e]).length||delete i.events[e]}))}removeAllEventsByType(e){const{nodeIds:t,supportedEvent:o,propName:n,doc:i}=e;i&&t.forEach((e=>{const t=i.nodes.getComponentIdOf(e),r=i.nodes.getById(e);if(!r||!t)return;const s=i.getProjectPageOrComponent(t);s&&"events"in r&&(o&&n?r.events[o]&&(Object.keys(r.events[o]).forEach((t=>{if(!("propCall"===r.events[o][t].type))return;if(r.events[o][t].calls!==n)return;const i=r.events[o][t].id;delete r.events[o][t];s.propDefinitions[i]&&s instanceof Un.n&&s.removeLocationFromPropDefinition(i,e,{base:jd.hD.EVENT,sufix:o})})),Object.keys(r.events[o]).length||delete r.events[o]):r.events={})}))}updateEventPropDefinitionName(e){const{nodeId:t,eventId:o,supportedEvent:n,oldPropDefName:i,newPropDefName:r,doc:s}=e;if(!s||i===r)return;const a=s.nodes.getById(t),c=s.nodes.getComponentIdOf(t);if(!a||!c||!("events"in a))return;const l=s.components.byId[c];if(!l)return void this.sentryService.captureException(`Component by ${c} not found when updating event prop definition`);const d=Object.values(null===l||void 0===l?void 0:l.propDefinitions).find((e=>e.name===i));if(!d)return;const p=Object.values(null===l||void 0===l?void 0:l.propDefinitions).find((e=>e.name===r)),u={base:jd.hD.EVENT,sufix:n};p?l.addLocationToPropDefinition(p.id,t,u):this.createPropCallEvent({nodeId:t,supportedEvent:n,propDefName:r}),d.locations[t]&&l.removeLocationFromPropDefinition(d.id,t,u),Object.keys(a.events).forEach((e=>{var t;if("propCall"===a.events[e][o].type&&null!==(t=a.events)&&void 0!==t&&t[e][o]){a.events[e][o].calls=r,p&&(a.events[e][o].id=null===p||void 0===p?void 0:p.id)}}))}updateEvent(e){const{doc:t,nodeId:o,changes:n}=e;if(!t)return;const{eventId:i,supportedEvent:r,calls:s,modifies:a,newState:c,includeEventObject:l}=n,d=t.nodes.getById(o);if(!i||!d||!("events"in d))return;const p=this.getNodeEvents({nodeId:o}).find((e=>e.eventId===i));if(!p)return;p.supportedEvent!==r&&this.updateEventType({eventId:i,nodeId:o,oldEventType:p.supportedEvent,newEventType:r});const u=t.nodes.getComponentIdOf(o);if(!u)return void this.sentryService.captureException(`updateEvent skipped. Component id for node ${o} not found`);const h=t.getProjectPageOrComponent(u);if(h){if("stateChange"===p.eventType&&a&&"undefined"!==typeof c){const e=p.newState;if(!Uy()(e,c)){if(e&&"object"===typeof e&&"type"in e&&"dynamic"===e.type){const t=e;switch(t.content.referenceType){case"prop":const e=t.content.id;e&&h.removeLocationFromPropDefinition(e,o,{base:jd.hD.STATE_CHANGE_EVENT+e,sufix:p.supportedEvent,identifier:e});break;case"state":const n=t.content.id;n&&h.removeLocationFromStateDefinition(n,o,{base:jd.uw.STATE_CHANGE_EVENT+n,sufix:p.supportedEvent,identifier:n})}}if(c&&"object"===typeof c&&"type"in c&&"dynamic"===c.type){const e=c;switch(e.content.referenceType){case"prop":{const t=h.propDefinitions,n=Object.values(t).find((t=>t.id===e.content.id));if(!n)throw new Error(`Prop "${e.content.id}" not found in component`);h.addLocationToPropDefinition(n.id,o,{base:jd.hD.STATE_CHANGE_EVENT+n.id,sufix:r,identifier:n.id});break}case"state":{const t=h.stateDefinitions,n=Object.values(t).find((t=>t.id===e.content.id));if(!n)throw new Error(`State "${e.content.id}" not found in component`);h.addLocationToStateDefinition(n.id,o,{base:jd.uw.STATE_CHANGE_EVENT+n.id,sufix:r,identifier:n.id});break}}}}d.events[r][i]=Zy(Zy({},d.events[r][i]),{},{modifies:a,newState:c,includeEventObject:l})}"propCall"===p.eventType&&s&&(d.events[r][i]=Zy(Zy({},d.events[r][i]),{},{calls:s,includeEventObject:l}))}}updateEventType(e){const{oldEventType:t,newEventType:o,eventId:n,nodeId:i,doc:r}=e;if(!r)return;const s=r.nodes.getById(i);if(!s||!("events"in s))return;const a=s.events[t][n];s.events=Zy(Zy({},s.events),{},{[o]:Zy(Zy({},s.events[o]),{},{[n]:Zy({},a)})});const c=s.events[t][n].id;delete s.events[t][n],Object.keys(s.events[t]).length||delete s.events[t];const l=this.projectUIState.selection.componentId;if(!l)return;const d=this.projectDoc.components.byId[l];if(!d)return void this.sentryService.captureException(`updateEventType skipped. Component by ${l} not found`);const p=d.propDefinitions[c];p&&(p.locations[s.id]={[`event${o}`]:{base:jd.hD.EVENT,sufix:o}})}},Ey=(0,s.Z)(Cy.prototype,"projectDoc",[Ny],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xy=(0,s.Z)(Cy.prototype,"projectUIState",[jy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_y=(0,s.Z)(Cy.prototype,"dbSync",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),My=(0,s.Z)(Cy.prototype,"propDefinitionManagementFlow",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Py=(0,s.Z)(Cy.prototype,"positioningService",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ay=(0,s.Z)(Cy.prototype,"sentryService",[Oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Cy.prototype,"createPropCallEvent",[m.P],Object.getOwnPropertyDescriptor(Cy.prototype,"createPropCallEvent"),Cy.prototype),(0,s.Z)(Cy.prototype,"createStateChangeEvent",[m.P],Object.getOwnPropertyDescriptor(Cy.prototype,"createStateChangeEvent"),Cy.prototype),(0,s.Z)(Cy.prototype,"removeEventFromNode",[m.P],Object.getOwnPropertyDescriptor(Cy.prototype,"removeEventFromNode"),Cy.prototype),(0,s.Z)(Cy.prototype,"removeAllEventsByType",[m.P],Object.getOwnPropertyDescriptor(Cy.prototype,"removeAllEventsByType"),Cy.prototype),(0,s.Z)(Cy.prototype,"updateEventPropDefinitionName",[m.P],Object.getOwnPropertyDescriptor(Cy.prototype,"updateEventPropDefinitionName"),Cy.prototype),(0,s.Z)(Cy.prototype,"updateEvent",[m.P],Object.getOwnPropertyDescriptor(Cy.prototype,"updateEvent"),Cy.prototype),(0,s.Z)(Cy.prototype,"updateEventType",[m.P],Object.getOwnPropertyDescriptor(Cy.prototype,"updateEventType"),Cy.prototype),Fy=Cy));const Ly=e=>{const t=document.getElementById("stage-frame");return t&&t.contentDocument?t.contentDocument.querySelector(`[data-node-instance-id="${e}"]`):null};var $y,By,Gy,Hy,zy,Yy,Vy,Wy,Ky,qy,Jy,Xy,Qy,eg,tg,og,ng,ig,rg,sg,ag,cg,lg,dg=o(407263),pg=o(194742);function ug(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function hg(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ug(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ug(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}$y=(0,c.provide)("nodeRichTextFlow"),By=(0,c.inject)("projectDoc"),Gy=(0,c.inject)("projectUIState"),Hy=(0,c.inject)("nodeManagementFlow"),zy=(0,c.inject)("nodeStyleManagmentFlow"),Yy=(0,c.inject)("nodeAbilityManagmentFlow"),Vy=(0,c.inject)("mediaQueryBreakpointManagementFlow"),Wy=(0,c.inject)("sentryService"),Ky=(0,c.inject)("nodeAttributeManagmentFlow"),qy=(0,c.inject)("propDefinitionManagementFlow"),Jy=(0,h.G)(g.l.RICH_TEXT_CHANGE),Xy=(0,ep.u)(ep.j.ADD_NODES),$y((eg=class{constructor(){(0,i.Z)(this,"projectDoc",tg,this),(0,i.Z)(this,"projectUIState",og,this),(0,i.Z)(this,"nodeManagementFlow",ng,this),(0,i.Z)(this,"nodeStyleManagmentFlow",ig,this),(0,i.Z)(this,"nodeAbilityManagmentFlow",rg,this),(0,i.Z)(this,"mediaQueryBreakpointManagementFlow",sg,this),(0,i.Z)(this,"sentryService",ag,this),(0,i.Z)(this,"nodeAttributeManagmentFlow",cg,this),(0,i.Z)(this,"propDefinitionManagementFlow",lg,this),(0,r.Z)(this,"translationUtils",kt.V.Instance),(0,r.Z)(this,"translationManager",At.K.Instance)}storeSelection(e){(0,a.mutate)(this.projectUIState,(t=>{t.staticNodeInterationsData.activeSelection=e,t.staticNodeInterationsData.isSettingLink=!1}))}storeSelectionStyles(e){(0,a.mutate)(this.projectUIState,(t=>{t.staticNodeInterationsData.selectionStyles=e}))}toggleAddLink(e){const t=this.projectUIState.staticNodeInterationsData.isSettingLink;void 0!==e&&t===e||(0,a.mutate)(this.projectUIState,(o=>{o.staticNodeInterationsData.isSettingLink=null!==e&&void 0!==e?e:!t}))}replaceParentWithStaticText(e){const{nodeId:t,text:o,doc:n}=e;if(!n)return;const i=n.nodes.getById(t);if(!i)return;if(!("childrenIds"in i))return;const r=new Yr.F({content:o}),s=new lu.HX({semanticType:Zn.RY.SPAN,primitiveType:Zn.sO.TEXT,contentChildren:{[r.id]:r}});this.replaceParentWithNewHierarchy({doc:n,parentId:i.id||"",rootNode:i,nodes:[s],mappingToInitialNodes:{},stylesRemovedFromRoot:[]})}updateHierarchyNodeContentChildrenWithDynamicValue(e){const{doc:t,hierarchyRootId:o,dynamicValue:n}=e;if(!t)return;const i=t.nodes.getById(o);if((null===i||void 0===i?void 0:i.primitiveType)!==Zn.sO.FRAGMENT)return;const r=Object.keys(i.childrenIds||{})[0];if(!r)return;const s=t.nodes.getById(r);s&&(s.contentChildren={[n.id]:n},Object.keys(s.childrenIds||{}).length&&t.deleteNodesById({nodeIds:Object.keys(s.childrenIds)}),this.updateHierarchyAttributePristineStatus(t,i.id))}getTextComponentForNodeInstanceId(e){var t;if(!this.projectUIState.staticNodeInterationsData.selectionStyles)return null;const o=Ly(e);return o?o.children.length>0&&o.children[0].tagName.toLowerCase()===Vr.rC.toLowerCase()?o.children[0]:null!==(t=o.parentElement)&&void 0!==t&&t.parentElement?o.parentElement.parentElement:null:null}getTextComponentForNode(e){var t;if(!this.projectUIState.staticNodeInterationsData.selectionStyles)return null;const o=(e=>{const t=document.getElementById("stage-frame");return t&&t.contentDocument?t.contentDocument.querySelector(`[data-node-id="${e}"]`):null})(e);return o&&null!==(t=o.parentElement)&&void 0!==t&&t.parentElement?o.parentElement.parentElement:null}getTextComponentForChildNode(e,t){const o=e.nodes.getById(t);if(!o)return null;if(o.primitiveType!==Zn.sO.BUTTON&&o.primitiveType!==Zn.sO.TEXT&&!o.parentId)return null;if(!o.parentId)return this.getTextComponentForNode(o.id);const n=e.nodes.getById(o.parentId);return n?n.primitiveType!==Zn.sO.BUTTON&&n.primitiveType!==Zn.sO.TEXT?this.getTextComponentForNode(o.id):this.getTextComponentForChildNode(e,o.parentId):null}stopEditingNodes(){const{editingNodeInstanceId:e}=this.projectUIState.staticNodeInterationsData;(0,a.mutate)(this.projectUIState,(t=>{const o=Object.keys(e)[0]||-1;delete t.staticNodeInterationsData.editingNodeInstanceId[o];t.staticNodeInterationsData.activeSelection&&(t.staticNodeInterationsData.activeSelection=null)}))}replaceNodeHierarchyWithText(e){const{doc:t,nodeId:o,text:n}=e;if(!t||!o)return;const i=t.nodes.getById(o);if(!i)return;"childrenIds"in i&&Object.keys(i.childrenIds||{}).length&&t.deleteNodesById({nodeIds:Object.keys(i.childrenIds||{}),withSubtree:!0});const r=new Yr.F({content:n});if(!("contentChildren"in i))return;const s=t.getProjectPageOrComponent(t.getComponentIdForNode(i.id)||"");Object.values(i.contentChildren||{}).forEach((e=>{if("dynamic"===e.type){if("prop"===e.content.referenceType&&"component"===(null===s||void 0===s?void 0:s.type)){const i=s.propDefinitions[e.content.id];if(!i)return;const r=this.projectUIState.selection.compInstanceId;if(r){const e=t.nodes.getById(r);return e&&"component-instance-node"===e.type?void(e.attrs[i.name]=new Yr.F({content:n})):void this.sentryService.captureException(new Error(`Comp instance node not found on with comp instance id ${r} when selecting nodeId ${o} from component instance`))}i.defaultValue=n}if("state"===e.content.referenceType&&"component"===(null===s||void 0===s?void 0:s.type)){const t=s.stateDefinitions[e.content.id];if(!t)return;t.defaultValue=n}}else e.content=n})),Object.keys(i.contentChildren||{}).length||(i.contentChildren={[r.id]:r})}removeRichStylesFromNode(e){var t;const{doc:o,nodeId:n}=e;if(!o||!n)return;const i=o.nodes.getById(n);if(!i||!("contentChildren"in i))return;if(Object.values(null!==(t=i.contentChildren)&&void 0!==t?t:{}).some((e=>"dynamic"===e.type&&"locale"===e.content.referenceType))){const{availableLanguages:e}=o.internationalization,t=i.getContentLangReferenceKey();if(!t)return;return void Object.keys(e).forEach((e=>{const n=o.internationalization.getTranslationRootHierarchyNodeId(e,t);n&&this.removeRichStylesFromNode({doc:o,nodeId:n})}))}const r=this.extractContentFromNodeHierarchy(n);Object.keys(i.childrenIds).forEach((e=>{o.deleteNodesById({nodeIds:[e],withSubtree:!0})}));const s=new Yr.F({content:r});i.contentChildren?i.contentChildren[s.id]=s:i.contentChildren={[s.id]:s}}updateStaticContent(e){var t;const{doc:o,nodeId:n,newContent:i,nextSiblingId:r,needsNewNode:s=!1,lastChange:c="",childrenRemoveRequired:l=!1}=e;if(!o)return;const d=this.projectUIState.localWork.nodesUnderLocalWork,p=o.nodes.getById(n);if(!p||!("contentChildren"in p)||!p.contentChildren)throw new Error(`Tried to replace static content but did not find node: ${n}`);const u=Object.keys(p.contentChildren)[0];if(l&&Object.keys((null===p||void 0===p?void 0:p.childrenIds)||{}).length){const e=new Yr.F({content:c});return Object.keys(p.contentChildren).forEach((e=>{var t;null===(t=p.contentChildren)||void 0===t||delete t[e]})),o.deleteNodesById({nodeIds:Object.keys((null===p||void 0===p?void 0:p.childrenIds)||{})}),void(p.contentChildren[e.id]=e)}if((null===(t=p.contentChildren[u])||void 0===t?void 0:t.content)!==i)if(s||Object.keys((null===p||void 0===p?void 0:p.childrenIds)||{}).length){const e=new Yr.F({content:c}),t=new lu.HX({semanticType:Zn.RY.SPAN,primitiveType:Zn.sO.TEXT,contentChildren:{[e.id]:e}}),i=r?o.nodes.getById(r):void 0;o.addNodesToParentOrStage({nextSibling:i,nodes:[t],parentId:n})}else if(u){if("static"===p.contentChildren[u].type&&!d){const e=new Yr.F({content:i});return p.contentChildren={},void(p.contentChildren[e.id]=e)}if("dynamic"!==p.contentChildren[u].type||d)d&&(0,a.mutate)(this.projectUIState,(e=>{e.localWork.changedContent=i}));else{const e=o.nodes.getRootAndSlotIdOf(p.id).rootId,t=o.nodes.getById(e);if(!t.compIdOfRootNode)return;const n=o.components.byId[t.compIdOfRootNode],r=p.contentChildren[u].content.id;null===n||void 0===n||n.updatePropDefinition(r,{defaultValue:i})}}else{const e=new Yr.F({content:c});p.contentChildren[e.id]=e}}replaceParentWithNewHierarchy(e){var t,o,n,i;const{doc:r,nodes:s,parentId:a,rootNode:c,mappingToInitialNodes:l,stylesRemovedFromRoot:d}=e;if(!r)return;const p=r.nodes.getById(a);if(!p||!("contentChildren"in p))return;if(!s.length){if(!this.projectUIState.staticNodeInterationsData.editingCompInstanceId){var u,h;const e=r.nodes.getById(null!==(u=p.parentId)&&void 0!==u?u:""),t=[a];if("fragment"===(null===e||void 0===e?void 0:e.primitiveType)&&null!==(h=e.meta)&&void 0!==h&&h.isPropRoot){var m;const{compId:o,prop:n}=e.meta.isPropRoot,i=null===(m=r.components.byId[o])||void 0===m?void 0:m.propDefinitions[n];Object.keys((null===i||void 0===i?void 0:i.locations)||{}).forEach((e=>{var o;const n=null===i||void 0===i?void 0:i.locations[e];"content"===(null===n||void 0===n||null===(o=n.content)||void 0===o?void 0:o.base)&&t.push(e),null===i||void 0===i||delete i.locations[e]})),i&&this.propDefinitionManagementFlow.removePropDefinition({doc:r,propId:i.id})}const o=t.filter((e=>!!r.nodes.getById(e)));return void(o.length&&this.nodeManagementFlow.deleteNodesById({doc:r,nodeIds:o}))}if(c.contentChildren){var y;const e=null===(y=Object.values(c.contentChildren))||void 0===y?void 0:y[0];if(!e||"dynamic"!==e.type||"prop"!==e.content.referenceType)return;const t=this.projectUIState.staticNodeInterationsData.editingCompInstanceId,o=r.nodes.getById(t);if(!o||"component-instance-node"!==o.type)return;const n=r.components.byId[o.compIdOfCompInstance],i=null===n||void 0===n?void 0:n.propDefinitions[e.content.id];if(!i)return;delete o.attrs[i.name]}return}s.length&&this.updateHierarchyAttributePristineStatus(r,p.parentId);const g=this.projectUIState.staticNodeInterationsData.editingCompInstanceId;c.abilities.link&&c.abilities.link.type!==$r.RZ.CMS_NAVIGATION_BUTTON&&!g&&this.nodeAbilityManagmentFlow.updateNodeLink({doc:r,nodeId:a,content:c.abilities.link.content,type:c.abilities.link.type}),Object.keys(p.referencedStyles).forEach((e=>{delete p.referencedStyles[e]})),p.referencedStyles={},Object.keys(c.referencedStyles).forEach((e=>{p.referencedStyles[e]=(0,rp.LA)(c.referencedStyles[e])}));const f=Object.values(null!==(t=c.contentChildren)&&void 0!==t?t:{}),b=f[0],I="dynamic"===(null===b||void 0===b?void 0:b.type)&&"prop"===(null===b||void 0===b||null===(o=b.content)||void 0===o?void 0:o.referenceType),v=this.translationUtils.getTranslationNodeFromElementNode({doc:r,node:c}),w=v&&"childrenIds"in v?Object.keys(null!==(n=v.childrenIds)&&void 0!==n?n:{}):Object.keys(p.childrenIds);if(1===s.length){var N,j;if(this.applyStylesToNode({doc:r,styles:c.styles,nodeId:p.id}),!("contentChildren"in s[0]))return;const t=Object.keys(s[0].contentChildren||{})[0];if(!t)return;const o=null===(N=s[0].contentChildren)||void 0===N?void 0:N[t];if(!o)return;const n=!!Object.keys(null!==(j=p.childrenIds)&&void 0!==j?j:{}).length;if(r.deleteNodesById({nodeIds:w}),Object.keys(c.contentChildren).length){if(I){const e=b.content.id,t=r.components.byId[r.getComponentIdForNode(p.id)||""],n=null===t||void 0===t?void 0:t.propDefinitions[e],i=this.projectUIState.staticNodeInterationsData.editingCompInstanceId;if(!i)return void(n&&(n.defaultValue=o.content,p.contentChildren={},p.contentChildren[b.id]=b));p.contentChildren={},p.contentChildren[b.id]=b;const s=r.nodes.getById(i);if(!s||"component-instance-node"!==s.type)return;if(!(null===n||void 0===n?void 0:n.name))return;return void(s.attrs[n.name]=o)}v&&"contentChildren"in v?(v.contentChildren={},v.contentChildren[t]=o):(p.contentChildren={},p.contentChildren[t]=o)}else n&&(p.childrenIds={},p.contentChildren={},p.contentChildren[t]=o);return this.nodeAttributeManagmentFlow.resetPristineAttributesAfterPropChange(r,p.parentId),void this.translationManager.translateNodeInEveryLanguage({nodeId:p.id,meta:e.meta})}const S=this.transferStylesFromRootToChildren(r,d,p.id),D=s.reduce(((e,t)=>"styles"in t?(e[t.id]=JSON.parse(JSON.stringify(t.styles)),t.styles={},e):e),{});if(p.primitiveType===Zn.sO.BUTTON){if(1===f.length&&I)return void this.nodeManagementFlow.convertStringContentPropToRichText({doc:r,nodeIdToUpdate:p.id,compInstanceId:this.projectUIState.staticNodeInterationsData.editingCompInstanceId,nodesToAdd:s,contentChild:b,originalNodeId:c.id});this.applyStylesToNode({doc:r,styles:c.styles,nodeId:p.id});const t=new lu.HX({primitiveType:Zn.sO.TEXT,semanticType:Zn.RY.SPAN,abilities:{},styles:{},attrs:{}});return this.nodeManagementFlow.addNodesToParentOrStage(hg(hg({},e),{},{doc:r,nodes:[t],translateStaticContent:!1})),this.nodeManagementFlow.addNodesToParentOrStage(hg(hg({},e),{},{doc:r,parentId:t.id,translateStaticContent:!1})),void Object.keys(D).forEach((e=>{const t=D[e];this.applyStylesToNode({doc:r,styles:t,nodeId:e})}))}{if(1===f.length&&I)return void this.nodeManagementFlow.convertStringContentPropToRichText({doc:r,nodeIdToUpdate:p.id,compInstanceId:this.projectUIState.staticNodeInterationsData.editingCompInstanceId,nodesToAdd:s,contentChild:b,originalNodeId:c.id});const t=Object.keys(c.styles).reduce(((e,t)=>{const o=c.styles[t],n=p.styles[t];return"static"===o.type&&"static"===(null===n||void 0===n?void 0:n.type)&&o.content===n.content||(e[t]=o),e}),{});Object.keys(t).length&&this.applyStylesToNode({doc:r,styles:t,nodeId:p.id}),v&&"contentChildren"in v&&(v.contentChildren={}),this.nodeManagementFlow.addNodesToParentOrStage(hg(hg({doc:r},e),{},{parentId:v?v.id:a,translateStaticContent:!1}))}const T=r.nodes.getById(v?v.id:a);if(T&&"childrenIds"in T&&"contentChildren"in T&&Object.keys(T.childrenIds).length&&Object.keys(null!==(i=T.contentChildren)&&void 0!==i?i:{}).length){var O,F;const e=Object.values(null!==(O=T.contentChildren)&&void 0!==O?O:{})[0];null===(F=T.contentChildren)||void 0===F||delete F[e.id]}this.restoreOldNodeStylesToNewNode(r,l,Object.keys(c.styles)),r.deleteNodesById({nodeIds:w}),Object.keys(D).forEach((e=>{const t=D[e];this.applyStylesToNode({doc:r,styles:t,nodeId:e})}));const C=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery(),E=JSON.parse(JSON.stringify(p.childrenIds));d.forEach((e=>{if(!Object.keys(E).length&&Object.keys(p.childrenIds).length&&(null===C||void 0===C||!C.isDefault)){const t=S[e];if(!t||!p.childrenIds)return;Object.keys(p.childrenIds).forEach((o=>{const n=r.nodes.getById(o);n&&"styles"in n&&!n.styles[e]&&(n.styles[e]=t)}))}})),this.keepUsedTextStylesInSync(r,s),this.nodeAttributeManagmentFlow.resetPristineAttributesAfterPropChange(r,p.parentId),this.translationManager.translateNodeInEveryLanguage({nodeId:p.id,meta:e.meta})}updateRootNodesFormat(e){const{doc:t,nodeIds:o,removeFormatIfExists:n=!0}=e;let{options:i}=e;if(!t)return;i=(0,dg.vw)(t,i);for(const s of o)this.removeConflictingFormatFromNodesDescendents({doc:t,nodeId:s,format:i});const r=Object.keys(i.styles||{}).reduce(((e,t)=>{var o;if(null===(o=i)||void 0===o||!o.styles)return e;const n=i.styles[t];return e[t]={value:n.value},n.tokenId&&(e[t].tokenId=n.tokenId),n.mergeable&&(e[t].mergeable=n.mergeable),e}),{});for(const s of o){if(!(0,ni.yE)(this.projectDoc.nodes.getById(s)))continue;const e=this.nodeStyleManagmentFlow.getComputedStyleByKeyForCurrentBreakpoint(s,Object.keys(r)),{stylesToAdd:i,stylesToRemove:a}=Object.keys(r).reduce(((t,o)=>{const i=e.styles[o]||e.classesStyles[o];let s=r[o].value;const a=r[o].mergeable,c=r[o].tokenId;if(i&&-1!==(null===i||void 0===i?void 0:i.indexOf(s))&&n){if(a){const e=i.replace(s,"");return t.stylesToAdd[o]={value:e},t}return t.stylesToRemove[o]=r[o],t}return a&&i&&i!==s&&-1===i.indexOf(s)&&(s=`${s} ${i}`),t.stylesToAdd[o]={value:s,tokenId:c},t}),{stylesToAdd:{},stylesToRemove:{}});Object.keys(a).forEach((e=>{this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({doc:t,key:e,nodeIds:o})})),Object.keys(i).length&&this.nodeStyleManagmentFlow.setMultipleStylesByKeyForCurrentBreakpoint({doc:t,nodeIds:[s],styleMap:i})}}removeRootNodesConflictingFormats(e){const{doc:t,nodeIds:o,options:n}=e;t&&n&&(Object.keys(n.styles||{}).forEach((e=>{this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({doc:t,key:e,nodeIds:o})})),o.forEach((e=>{const o=t.nodes.getById(e);if(!o)return;if(!this.getTextComponentForNode(o.id))return;const i=t.nodes.getById(e);(0,pg.Ei)({doc:t,node:i,format:n}),this.removeConflictingFormatFromNodesDescendents({doc:t,nodeId:e,format:n})})))}removeConflictingFormatFromNodesDescendents(e){const{doc:t,format:o,nodeId:n}=e;this.getNodeDescendentsIds(t,n).forEach((e=>{const n=t.nodes.getById(e);(0,pg.Ei)({doc:t,node:n,format:o})}))}getNodeDescendentsIds(e,t){return e.nodes.getDescendents(t).map((e=>e.id)).filter((e=>e!==t))}transferStylesFromRootToChildren(e,t,o){const n=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery(),i=e.nodes.getById(o);if(!i)return{};const r=this.translationUtils.getTranslationNodeFromElementNode({node:i}),s=null!==r&&void 0!==r?r:i,a="childrenIds"in s?Object.keys(s.childrenIds):[],c={};return t.forEach((t=>{if(this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({doc:e,key:t,nodeIds:[i.id]}),!("styles"in i))return;const o=i.styles[t];if(!o)return;const r=JSON.parse(JSON.stringify(o));r&&(c[t]=r,this.nodeStyleManagmentFlow.removeStyleByKey({doc:e,key:t,nodeIds:[i.id]}),null!==n&&void 0!==n&&n.isDefault||a.forEach((o=>{const n=e.nodes.getById(o);n&&"styles"in n&&!n.styles[t]&&(n.styles[t]=r)})))})),c}keepUsedTextStylesInSync(e,t){t.forEach((t=>{"styles"in t&&Object.keys(t.referencedStyles).forEach((o=>{const n=t.referencedStyles[o];if("style-map"!==n.type||"design-language-referenced"!==n.content.mapType)return;const i=n.content.referenceId,r=e.designLanguage.textStyleSetsById[i];r&&(r.usedInNodes[t.id]=!0)}))}))}extractContentFromNodeHierarchy(e){let t="";return this.projectDoc.nodes.bfs(e,(e=>{if(!("contentChildren"in e))return;const o=Object.keys(e.contentChildren||{});if(e.contentChildren&&o.length){const n=e.contentChildren[o[0]];"string"===typeof n&&(t+=this.trimContent(n)),"static"===n.type&&(t+=this.trimContent(n.content))}})),t}applyStylesToNode(e){const{doc:t,styles:o,nodeId:n}=e,{mediaQueryOnRichText:i}=this.projectUIState.userPreferences;if(!this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery())return;(null===t||void 0===t?void 0:t.nodes.getById(n))&&Object.keys(o).forEach((e=>{const{value:r,tokenId:s}=this.computeStyleValueAndToken(o[e]),a="backgroundColor"===e?"backgroundImage":"backgroundImage"===e?"backgroundColor":null;if(i)return a&&this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({doc:t,nodeIds:[n],key:a}),void this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({doc:t,value:r,tokenId:s,nodeIds:[n],key:e});a&&this.nodeStyleManagmentFlow.removeStyleByKey({doc:t,nodeIds:[n],key:a}),this.nodeStyleManagmentFlow.removeStyleByKey({doc:t,key:e,nodeIds:[n]}),this.nodeStyleManagmentFlow.setStyleByKey({doc:t,value:r,tokenId:s,nodeIds:[n],key:e})}))}updateHierarchyAttributePristineStatus(e,t){var o;const n=e.nodes.getById(null!==t&&void 0!==t?t:"");if(!n||"fragment"!==n.primitiveType)return;if(!("meta"in n))return;const i=null===(o=n.meta)||void 0===o?void 0:o.isAttributeRoot;if(!i)return;const r=e.nodes.getById(i.nodeId||"");if(!r||"component-instance-node"!==r.type)return;const s=r.attrs[i.attr];s&&"pristine"in s&&(s.pristine=!1)}restoreOldNodeStylesToNewNode(e,t,o){const{mediaQueryOnRichText:n}=this.projectUIState.userPreferences;if(!n)return;const i=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery();i&&!i.isDefault&&Object.keys(t).forEach((n=>{const i=t[n],r=e.nodes.getById(i);r&&"styles"in r&&Object.keys(r.styles).forEach((t=>{if(-1!==o.indexOf(t))return;const{value:i,tokenId:s}=this.computeStyleValueAndToken(r.styles[t]);this.nodeStyleManagmentFlow.setStyleByKey({doc:e,value:i,tokenId:s,nodeIds:[n],key:t})}))}))}computeStyleValueAndToken(e){const t=e.content;let o,n="";return"string"===typeof t||"number"===typeof t?(n=t,o=void 0):"object"===typeof t&&"referenceType"in t?(n=t.defaultValue,o=t.id):o=void 0,{value:n,tokenId:o}}trimContent(e){return e.replaceAll(Vr.Bw," ").replaceAll(Vr.$m,"").replace(Vr.ss,"")}},tg=(0,s.Z)(eg.prototype,"projectDoc",[By],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),og=(0,s.Z)(eg.prototype,"projectUIState",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ng=(0,s.Z)(eg.prototype,"nodeManagementFlow",[Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ig=(0,s.Z)(eg.prototype,"nodeStyleManagmentFlow",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rg=(0,s.Z)(eg.prototype,"nodeAbilityManagmentFlow",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sg=(0,s.Z)(eg.prototype,"mediaQueryBreakpointManagementFlow",[Vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ag=(0,s.Z)(eg.prototype,"sentryService",[Wy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cg=(0,s.Z)(eg.prototype,"nodeAttributeManagmentFlow",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lg=(0,s.Z)(eg.prototype,"propDefinitionManagementFlow",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(eg.prototype,"replaceParentWithStaticText",[m.P],Object.getOwnPropertyDescriptor(eg.prototype,"replaceParentWithStaticText"),eg.prototype),(0,s.Z)(eg.prototype,"updateHierarchyNodeContentChildrenWithDynamicValue",[m.P],Object.getOwnPropertyDescriptor(eg.prototype,"updateHierarchyNodeContentChildrenWithDynamicValue"),eg.prototype),(0,s.Z)(eg.prototype,"replaceNodeHierarchyWithText",[m.P],Object.getOwnPropertyDescriptor(eg.prototype,"replaceNodeHierarchyWithText"),eg.prototype),(0,s.Z)(eg.prototype,"removeRichStylesFromNode",[m.P],Object.getOwnPropertyDescriptor(eg.prototype,"removeRichStylesFromNode"),eg.prototype),(0,s.Z)(eg.prototype,"updateStaticContent",[m.P],Object.getOwnPropertyDescriptor(eg.prototype,"updateStaticContent"),eg.prototype),(0,s.Z)(eg.prototype,"replaceParentWithNewHierarchy",[m.P,Jy,Xy],Object.getOwnPropertyDescriptor(eg.prototype,"replaceParentWithNewHierarchy"),eg.prototype),(0,s.Z)(eg.prototype,"updateRootNodesFormat",[m.P],Object.getOwnPropertyDescriptor(eg.prototype,"updateRootNodesFormat"),eg.prototype),(0,s.Z)(eg.prototype,"removeRootNodesConflictingFormats",[m.P],Object.getOwnPropertyDescriptor(eg.prototype,"removeRootNodesConflictingFormats"),eg.prototype),Qy=eg));var mg,yg,gg,fg,bg,Ig,vg,wg,Ng,jg,Sg,Dg,Tg,Og,Fg,Cg,Eg,xg,_g,Mg=o(342701);mg=(0,c.provide)("freestyleNodeFlow"),yg=(0,c.inject)("projectDoc"),gg=(0,c.inject)("nodeStyleManagmentFlow"),fg=(0,c.inject)("nodeManagementFlow"),bg=(0,c.inject)("elementRefProvider"),Ig=(0,c.inject)("projectUIState"),vg=(0,c.inject)("nodeSelectionFlow"),wg=(0,c.inject)("temporaryStyleFlow"),Ng=(0,c.inject)("notificationsManagementFlow"),mg((Sg=class{constructor(){(0,i.Z)(this,"projectDoc",Dg,this),(0,i.Z)(this,"nodeStyleManagmentFlow",Tg,this),(0,i.Z)(this,"nodeManagementFlow",Og,this),(0,i.Z)(this,"elementRefProvider",Fg,this),(0,i.Z)(this,"projectUIState",Cg,this),(0,i.Z)(this,"nodeSelectionFlow",Eg,this),(0,i.Z)(this,"temporaryStyleFlow",xg,this),(0,i.Z)(this,"notificationsManagementFlow",_g,this),(0,r.Z)(this,"startingTopForNode",{}),(0,r.Z)(this,"startingLeftForNode",{}),(0,r.Z)(this,"moved",!1),(0,r.Z)(this,"startingStageControlValues",{x:0,y:0})}setFreestylePositionOnNodes(e){const{nodeIds:t,doc:o}=e;this.temporaryStyleFlow.movePropertiesToTempStyle({nodeIds:t,properties:["margin","marginTop","marginBottom","marginRight","marginLeft"],doc:o}),this.setNodesParentsPositionRelative({nodeIds:t,doc:o}),this.setNodesPositionBasedOnBoundingRect({nodeIds:t,doc:o})}setFixedOrStickyPositionOnNodes(e){const{nodeIds:t,doc:o}=e;if(!o)return;this.temporaryStyleFlow.movePropertiesToTempStyle({nodeIds:t,properties:["margin","marginTop","marginBottom","marginRight","marginLeft"],doc:o})}setNodesParentsPositionRelative(e){const{nodeIds:t,doc:o}=e;if(!o)return;const n=t.map((e=>{var t;return null===(t=o.nodes.getById(e))||void 0===t?void 0:t.parentId})).filter((e=>{var t;if(!e)return!1;if(null!==(t=o.nodes.getById(e))&&void 0!==t&&t.compIdOfRootNode)return!1;return!this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(e,["position"]).position}));n.length&&(this.nodeStyleManagmentFlow.setMultipleStylesByKeyForCurrentBreakpoint({nodeIds:n,styleMap:{position:{value:"relative"}},doc:o}),this.notificationsManagementFlow.createLimitedUseNotification(d.CS.FREESTYLE))}nudgeNode(e,t,o){if(!o&&0!==o)return;let n=null;if("number"===typeof o)n=`${o+5}px`;else{const e=parseInt(o.replace(/[^0-9]/g,"")),t=o.replace(/[0-9]/g,"");e&&!isNaN(e)&&t&&(n=`${e+("px"===t?30:5)}${t}`)}n&&this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({key:t,value:n,nodeIds:[e]})}nodesAreFreestyle(e){return!e.some((e=>!this.nodeStyleManagmentFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e,key:"position",values:["absolute","fixed"]})))}groupFreestyleNodes(e){var t;const{nodeIds:o,doc:n}=e;if(!n)return null;let i=1/0,r=-1/0,s=1/0,a=-1/0;const c={},l=o.map((e=>{const t=this.elementRefProvider.getDomNodeElementRefById(e);if(!t)throw new Error(`Attempted to compute freestyle node position based on bounding rect, but no DOM node found for it! Id: ${e}`);const o=t.getBoundingClientRect();return o.top<i&&(i=o.top),o.bottom>r&&(r=o.bottom),o.left<s&&(s=o.left),o.right>a&&(a=o.right),c[e]=o,t})),d=a-s,p=r-i;this.setFreestyleNodesPositionBeforeMoving({nodeIds:o,nodeRectangles:c,targetRect:{top:i,bottom:r,left:s,right:a,width:d,height:p},doc:n});const u=null===(t=this.nodeManagementFlow.getFirstPositionedAncestorOfDOMNode(l[0]).ancestorDOMElement)||void 0===t?void 0:t.getBoundingClientRect();if(u){const{top:e,left:t}=u;i-=e,r-=e,s-=t,a-=t}const h={top:i,left:s,width:d,height:p},m=n.groupNodes({nodeIds:o,freestyleParams:h});return this.nodeSelectionFlow.setNodeSelection({nodeId:m}),m}setFreestyleNodesPositionBeforeMoving(e){const{doc:t,nodeRectangles:o}=e;let n=e.nodeIds;if(!t)return;n=n.filter((e=>this.nodeStyleManagmentFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e,key:"position",values:["absolute","fixed"]})));const{top:i=0,left:r=0,right:s=0,bottom:a=0,height:c=1,width:l=1}=e.targetRect,d=o||n.reduce(((e,t)=>{var o;return e[t]=null===(o=this.elementRefProvider.getDomNodeElementRefById(t))||void 0===o?void 0:o.getBoundingClientRect(),e}),{});n.forEach((e=>{const t=d[e],o=t.top-i,n=a-t.bottom,p=t.left-r,u=s-t.right,h={};o<=c/2?(h.top={value:`${o}px`},h.bottom={value:""}):(h.bottom={value:`${n}px`},h.top={value:""}),p<=l/2?(h.left={value:`${p}px`},h.right={value:""}):(h.right={value:`${u}px`},h.left={value:""}),this.nodeStyleManagmentFlow.setMultipleStylesByKeyForCurrentBreakpoint({nodeIds:[e],styleMap:h})}))}setNodesPositionBasedOnBoundingRect(e){const{nodeIds:t,doc:o}=e;o&&t.forEach((e=>{const t=this.elementRefProvider.getDomNodeElementRefById(e);if(!t)return;let{ancestorDOMElement:n}=this.nodeManagementFlow.getFirstPositionedAncestorOfDOMNode(t);n||(n=this.elementRefProvider.getIframeRoot());let i="",r="",s="",a="";const{top:c,left:l,height:d,width:p}=t.getBoundingClientRect(),u=(0,ni.AO)(t),h=(0,ni.d$)(t),m=c*u,y=l*u,g=p*u,f=d*u,{height:b,width:I,top:v,left:w}=n.getBoundingClientRect(),N=(0,ni.AO)(n),j=(0,ni.d$)(n),S=v*N,D=w*N,T=I*N,O=b*N;let F=0,C=0;h.x!==j.x&&(F=p*(1-1/h.x)/2),h.y!==j.y&&(C=d*(1-1/h.y)/2),m+f/2<=S+O/2?i=`${Math.round(((m-S)/u+C)/j.y)}px`:r=`${Math.round(((O+S-m-f)/u+C)/j.y)}px`,y+g/2<=D+T/2?s=`${Math.round(((y-D)/u+F)/j.x)}px`:a=`${Math.round(((T+D-y-g)/u+F)/j.x)}px`,this.nodeStyleManagmentFlow.setMultipleStylesByKeyForCurrentBreakpoint({styleMap:{top:{value:i},left:{value:s},right:{value:a},bottom:{value:r}},nodeIds:[e],doc:o})}))}startFreestyleDragFromEntity(e){var t;if(!e||e.type!==cu.Z.SUB_HIERARCHY)return e;const o=e.content.subHierarchy,n=e.content.subHierarchyNodeInstanceIds;if(n&&this.projectUIState.staticNodeInterationsData.editingNodeInstanceId[n[0]])return this.nodeManagementFlow.revertLocalWork(),e;const i=null===(t=this.elementRefProvider.getIframeRef())||void 0===t?void 0:t.current,r=this.elementRefProvider.getIframeRoot();if(!r||!r)return e;if(null!==o&&void 0!==o&&o.some((e=>!this.nodeStyleManagmentFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:"position",values:["absolute","fixed"]}))))return e;const s={},c={},l={};return n?n.forEach((e=>{const t=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(e),n=o.find((e=>e.id===t));if(!n)throw new Error("Something went wrong when starting to drag freestyle node hierarchy. Could not find data layer node for DOM node.");const i=this.computeDomNodesFromHierarchy({hierarchyNode:n,hierarchy:o,iframeRoot:r,hierarchyNodeInstanceId:e});i&&(s[n.id]=i.domNode,l[n.id]=i.domNodeClone,c[n.id]={actualParent:i.actualDomParent,firstPositionedAncestor:i.firstPositionedAncestor})})):o.forEach((e=>{const t=this.computeDomNodesFromHierarchy({hierarchyNode:e,hierarchy:o,iframeRoot:r});t&&(s[e.id]=t.domNode,l[e.id]=t.domNodeClone,c[e.id]={actualParent:t.actualDomParent,firstPositionedAncestor:t.firstPositionedAncestor})})),i&&(this.startingStageControlValues={x:i.getBoundingClientRect().x,y:i.getBoundingClientRect().y}),Object.keys(s).length&&(e.type=cu.Z.ABSOLUTE_SUB_HIERARCHY,(0,a.mutate)(this.projectUIState,(e=>{e.drag.dragInAbsolutePosition.absDraggedElements=s,e.drag.dragInAbsolutePosition.absDraggedElementsParents=c,e.drag.dragInAbsolutePosition.clonePlaceholders=l}))),e}computeDomNodesFromHierarchy(e){var t;const{hierarchy:o,hierarchyNode:n,iframeRoot:i,hierarchyNodeInstanceId:r}=e,s=this.projectDoc.nodes.nodeIsCompInstance(n);let a=n;var c;s&&(a=this.projectDoc.nodes.getById((null===(c=this.projectDoc.components.byId[n.compIdOfCompInstance])||void 0===c?void 0:c.rootNodeId)||"")||a);const l=this.nodeStyleManagmentFlow.getResolvedStylesBasedOnCurrentBreakpoint({nodeId:a.id});if(o.some((e=>"fixed"!==l.position&&"childrenIds"in e&&-1!==Object.keys(e.childrenIds||{}).indexOf(a.id))))return;const d=this.elementRefProvider.getDomTargetNode({nodeId:a.id,nodeInstanceId:r}),p=s?null===d||void 0===d||null===(t=d.parentElement)||void 0===t?void 0:t.parentElement:null===d||void 0===d?void 0:d.parentElement,u=null===d||void 0===d?void 0:d.getBoundingClientRect();if(!d||!u||!p)return;const h="fixed"!==l.position&&this.nodeManagementFlow.getFirstPositionedAncestorOfDOMNode(d).ancestorDOMElement||i,m=h.getBoundingClientRect(),y=(0,ni.AO)(h),g={top:m.top*y,left:m.left*y,width:m.width*y,height:m.height*y},f=g.top||0,b=g.left||0,I=(0,ni.d$)(d),v=(0,ni.d$)(h);let w=0,N=0;I.x!==v.x&&(w=u.width*(1-1/I.x)/2),I.y!==v.y&&(N=u.height*(1-1/I.y)/2);const j=(0,ni.AO)(d),S=j===y?1:j;this.startingTopForNode[n.id]=Math.round((u.top*j-f)/S/v.y+N),this.startingLeftForNode[n.id]=Math.round((u.left*j-b)/S/v.x+w);const D=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(a.id,["top","left","bottom","right"]),T=D.top,O=D.left,F=D.bottom,C=D.right;return d.style.top=T,d.style.left=O,d.style.bottom=F,d.style.right=C,{domNode:d,domNodeClone:d.cloneNode(!0),actualDomParent:p,firstPositionedAncestor:h}}moveDraggedFreestyleNodes(){var e,t,o,n,i,r;const s=this.projectUIState.drag.draggedEntity;if((null===s||void 0===s?void 0:s.type)!==cu.Z.ABSOLUTE_SUB_HIERARCHY||!this.projectUIState.drag.initialMousePosition||!this.projectUIState.drag.currentMousePosition)return;this.moved=!0;const{scale:a}=this.projectUIState.stage.webComp.controlValues,{x:c,y:l}=this.projectUIState.drag.currentMousePosition,{x:d,y:p}=this.projectUIState.drag.initialMousePosition,{pressedKeys:u}=this.projectUIState.userInteractions,h=Math.abs(c-d),m=Math.abs(l-p),{absDraggedElements:y,absDraggedElementsParents:g}=this.projectUIState.drag.dragInAbsolutePosition;if(!y||!g)return;const f=this.startingStageControlValues.x-((null===(e=this.elementRefProvider.getIframeRef())||void 0===e||null===(t=e.current)||void 0===t||null===(o=t.getBoundingClientRect())||void 0===o?void 0:o.x)||0),b=this.startingStageControlValues.y-((null===(n=this.elementRefProvider.getIframeRef())||void 0===n||null===(i=n.current)||void 0===i||null===(r=i.getBoundingClientRect())||void 0===r?void 0:r.y)||0);Object.values(y).forEach((e=>{const t=(0,Mg.MT)({element:e});if(!t)throw new Error("Dragged node element does not have metadata!");const{slotId:o,nodeId:n,compInstanceId:i}=t;if(!n)throw new Error("Tried to drag a node whose element does not have an id!");const r=(0,ni.AO)(e),s=o?n:i||n,y=g[s].firstPositionedAncestor,I=y.getBoundingClientRect(),v=(0,ni.AO)(y),w=(0,ni.d$)(y),N=Math.round(this.startingTopForNode[s]/v+(l-p+b)/a/r/w.y),j=Math.round(this.startingLeftForNode[s]/v+(c-d+f)/a/r/w.x),S=I.width*v/r/w.x,D=I.height*v/r/w.y,T=e.getBoundingClientRect();let O="auto",F="auto",C="auto",E="auto";const{top:x,left:_}=e.style,M=Math.abs(S-T.width),P=Math.abs(D-T.height),A=(0,ni.d$)(e);let k=0,U=0;A.x!==w.x&&(k=T.width*(1-1/A.x)/2),A.y!==w.y&&(U=T.height*(1-1/A.y)/2),"auto"!==x?N<=85*P/100+U?O=`${N}px`:F=`${Math.round(D-N-T.height/A.y)}px`:N>=15*P/100+U?F=`${Math.round(D-N-T.height/A.y)}px`:O=`${N}px`,"auto"!==_?j<=85*M/100+k?C=`${j}px`:E=`${Math.round(S-j-T.width/A.x)}px`:j>=15*M/100+k?E=`${Math.round(S-j-T.width/A.x)}px`:C=`${j}px`,u.shift?h>m?(e.style.removeProperty("top"),e.style.left=`${C}`,e.style.right=`${E}`,e.style.removeProperty("bottom")):(e.style.top=`${O}`,e.style.removeProperty("left"),e.style.removeProperty("right"),e.style.bottom=`${F}`):(e.style.top=`${O}`,e.style.left=`${C}`,e.style.right=`${E}`,e.style.bottom=`${F}`)}))}endFreestyleDrag(e){const{doc:t}=e;if(!t)return;const o=this.projectUIState.drag.draggedEntity;if((null===o||void 0===o?void 0:o.type)!==cu.Z.ABSOLUTE_SUB_HIERARCHY)return;const{absDraggedElements:n}=this.projectUIState.drag.dragInAbsolutePosition;this.projectUIState.userInteractions.pressedKeys.alt&&this.nodeManagementFlow.duplicateNodesById({nodeIds:Object.keys(n)}),Object.values(n).forEach((e=>{if(!this.moved||!e)return;const o=(0,Mg.MT)({element:e});if(!o)throw new Error("Dragged node element does not have metadata!");const{slotId:n,nodeId:i,compInstanceId:r}=o;if(!i)throw new Error("Tried to drag a node whose element does not have an id!");const s=n?i:r||i,{top:a,left:c,right:l,bottom:d}=e.style,p={};a&&(p.top={value:"auto"!==a?a:""}),c&&(p.left={value:"auto"!==c?c:""}),l&&(p.right={value:"auto"!==l?l:""}),d&&(p.bottom={value:"auto"!==d?d:""}),this.nodeStyleManagmentFlow.setMultipleStylesByKeyForCurrentBreakpoint({nodeIds:[s],styleMap:p,doc:t})}))}cleanUpAfterFreestyleDrag(){this.startingLeftForNode={},this.startingTopForNode={};const{absDraggedElements:e,clonePlaceholders:t}=this.projectUIState.drag.dragInAbsolutePosition;Object.values(e).forEach((e=>{e.removeAttribute("style")})),Object.values(t).forEach((e=>e.remove())),(0,a.mutate)(this.projectUIState,(e=>{e.drag.dragInAbsolutePosition.absDraggedElements={},e.drag.dragInAbsolutePosition.absDraggedElementsParents={},e.drag.dragInAbsolutePosition.clonePlaceholders={}})),this.moved=!1,this.startingStageControlValues={x:0,y:0}}},Dg=(0,s.Z)(Sg.prototype,"projectDoc",[yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tg=(0,s.Z)(Sg.prototype,"nodeStyleManagmentFlow",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Og=(0,s.Z)(Sg.prototype,"nodeManagementFlow",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fg=(0,s.Z)(Sg.prototype,"elementRefProvider",[bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cg=(0,s.Z)(Sg.prototype,"projectUIState",[Ig],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eg=(0,s.Z)(Sg.prototype,"nodeSelectionFlow",[vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xg=(0,s.Z)(Sg.prototype,"temporaryStyleFlow",[wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g=(0,s.Z)(Sg.prototype,"notificationsManagementFlow",[Ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Sg.prototype,"setFreestylePositionOnNodes",[m.P],Object.getOwnPropertyDescriptor(Sg.prototype,"setFreestylePositionOnNodes"),Sg.prototype),(0,s.Z)(Sg.prototype,"setFixedOrStickyPositionOnNodes",[m.P],Object.getOwnPropertyDescriptor(Sg.prototype,"setFixedOrStickyPositionOnNodes"),Sg.prototype),(0,s.Z)(Sg.prototype,"setNodesParentsPositionRelative",[m.P],Object.getOwnPropertyDescriptor(Sg.prototype,"setNodesParentsPositionRelative"),Sg.prototype),(0,s.Z)(Sg.prototype,"groupFreestyleNodes",[m.P],Object.getOwnPropertyDescriptor(Sg.prototype,"groupFreestyleNodes"),Sg.prototype),(0,s.Z)(Sg.prototype,"setFreestyleNodesPositionBeforeMoving",[m.P],Object.getOwnPropertyDescriptor(Sg.prototype,"setFreestyleNodesPositionBeforeMoving"),Sg.prototype),(0,s.Z)(Sg.prototype,"setNodesPositionBasedOnBoundingRect",[m.P],Object.getOwnPropertyDescriptor(Sg.prototype,"setNodesPositionBasedOnBoundingRect"),Sg.prototype),(0,s.Z)(Sg.prototype,"endFreestyleDrag",[m.P],Object.getOwnPropertyDescriptor(Sg.prototype,"endFreestyleDrag"),Sg.prototype),jg=Sg));var Pg,Ag,kg,Ug,Rg,Zg,Lg;Pg=(0,c.provide)("nodeTailwindManagementFlow"),Ag=(0,c.inject)("projectDoc"),kg=(0,c.inject)("projectUIState"),Pg((Rg=class{constructor(){(0,i.Z)(this,"projectDoc",Zg,this),(0,i.Z)(this,"projectUIState",Lg,this)}addClassesToNode(e){const{doc:t,nodeIds:o,classNames:n}=e;t&&o.forEach((e=>{t.tailwindCSS.addTailwindClassToNode(e,n)}))}deleteClassesFromNode(e){const{doc:t,nodeIds:o,classId:n}=e;t&&o.forEach((e=>{t.tailwindCSS.deleteClassesForNode(e,n)}))}selectTailwindClassesOnNode(e){const{nodeId:t,classNames:o}=e;(0,a.mutate)(this.projectUIState,(({tailwind:e})=>{var n;if((null===(n=e.selected)||void 0===n?void 0:n.nodeId)!==t)e.selected={nodeId:t,classNames:o};else{if(o||(e.selected.classNames=null),"string"===typeof e.selected.classNames){var i;if((null===(i=e.selected)||void 0===i?void 0:i.classNames)===o)return void(e.selected.classNames=null);e.selected.classNames=o}"object"===typeof e.selected.classNames&&(e.selected.classNames=o)}}))}resetTailwindState(){(0,a.mutate)(this.projectUIState,(e=>{delete e.tailwind.selected}))}cloneTailwindCSSFromNode(e){const{doc:t,nodeId:o,targetNodeId:n}=e;t&&t.tailwindCSS.cloneTailwindCSSFromNode(o,n)}},Zg=(0,s.Z)(Rg.prototype,"projectDoc",[Ag],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lg=(0,s.Z)(Rg.prototype,"projectUIState",[kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Rg.prototype,"addClassesToNode",[m.P],Object.getOwnPropertyDescriptor(Rg.prototype,"addClassesToNode"),Rg.prototype),(0,s.Z)(Rg.prototype,"deleteClassesFromNode",[m.P],Object.getOwnPropertyDescriptor(Rg.prototype,"deleteClassesFromNode"),Rg.prototype),(0,s.Z)(Rg.prototype,"cloneTailwindCSSFromNode",[m.P],Object.getOwnPropertyDescriptor(Rg.prototype,"cloneTailwindCSSFromNode"),Rg.prototype),Ug=Rg));var $g,Bg,Gg,Hg,zg,Yg,Vg;$g=(0,c.provide)("dateTimeNodeManagementFlow"),Bg=(0,c.inject)("projectDoc"),Gg=(0,c.inject)("sharedbProjectSyncService"),$g((zg=class{constructor(){(0,i.Z)(this,"projectDoc",Yg,this),(0,i.Z)(this,"dbSync",Vg,this)}changeNodeFormat(e,t){this.dbSync.mutate(this.projectDoc,(o=>{const n=o.nodes.getById(e);n&&"date-time-node"===n.type&&(n.format=t)}))}setDateTimeValue(e,t){this.dbSync.mutate(this.projectDoc,(o=>{const n=o.nodes.getById(e);n&&"date-time-node"===n.type&&n.setContentValue(t)}))}toggleCustomFormatForNode(e){this.dbSync.mutate(this.projectDoc,(t=>{const o=t.nodes.getById(e);o&&"date-time-node"===o.type&&o.toggleCustomFormat()}))}},Yg=(0,s.Z)(zg.prototype,"projectDoc",[Bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vg=(0,s.Z)(zg.prototype,"dbSync",[Gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hg=zg));var Wg,Kg,qg,Jg,Xg,Qg,ef,tf,of,nf,rf,sf,af,cf,lf,df=o(591774);Wg=(0,c.provide)("interactiveElementsFlow"),Kg=(0,c.inject)("projectDoc"),qg=(0,c.inject)("projectUIState"),Jg=(0,c.inject)("nodeStyleManagmentFlow"),Xg=(0,c.inject)("mediaQueryBreakpointManagementFlow"),Qg=(0,c.inject)("mainInspectorFlow"),ef=(0,c.inject)("projectClassManagementFlow"),Wg((of=class{constructor(){(0,i.Z)(this,"projectDoc",nf,this),(0,i.Z)(this,"projectUIState",rf,this),(0,i.Z)(this,"nodeStyleManagementFlow",sf,this),(0,i.Z)(this,"mediaQueryBreakpointManagementFlow",af,this),(0,i.Z)(this,"mainInspectorFlow",cf,this),(0,i.Z)(this,"projectClassManagementFlow",lf,this),(0,r.Z)(this,"checkIfNodeHasUtilityClassAndRemove",((e,t,o=!1)=>{var n,i;if(!e)return!1;const r=document.getElementById("stage-frame");if(!r)return!1;const s=null===(n=r.contentDocument)||void 0===n?void 0:n.body.querySelectorAll(`[data-node-id="${e.id}"]`);if(!s)return!1;const a=!(null===(i=s[0])||void 0===i||!i.classList.contains(t));return a&&o&&s.forEach((e=>e.classList.remove(t))),a})),(0,r.Z)(this,"getAnimationSettingValue",(e=>{if(!e)return df.b.NONE;switch(this.nodeStyleManagementFlow.getAllStyleValuesForKey({key:"transform",nodeId:e.id})[0]){case"translateX(100%)":return df.b.SLIDE_FROM_RIGHT;case"translateX(-100%)":return df.b.SLIDE_FROM_LEFT;case"translateY(-100%)":return df.b.SLIDE_FROM_TOP;default:return df.b.NONE}})),(0,r.Z)(this,"getNavbarCollapseBreakpoint",(e=>{const t=this.mediaQueryBreakpointManagementFlow.getActiveMediaQueriesInOrder()[1];if(!t)return this.mediaQueryBreakpointManagementFlow.getDefaultMediaQuery();if(!this.projectDoc.nodes.getById(e))return t;const o=(0,tl.U2)(this.projectDoc,e,Zn.IV.NAVBAR);if(!o)return t;const n=(0,tl.xf)(this.projectDoc,o,Zn.IV.NAVBAR_NAV);if(!n)return t;let i=this.mediaQueryBreakpointManagementFlow.getDefaultMediaQuery();return this.mediaQueryBreakpointManagementFlow.getActiveMediaQueriesInOrder().forEach((e=>{const t=this.nodeStyleManagementFlow.getComputedStyleByKeyForBreakpoint(n.id,["display"],e,!1);"none"===t.styles.display&&t.breakpointForStyles===e.maxWidth&&(i=e)})),i})),(0,r.Z)(this,"handleNavbarAnimationChange",((e,t)=>{if(!t)return;const o=this.projectDoc.classes.getAll().find((e=>e.getName(this.projectDoc.classes.byId)===Qd.aG));if(o)switch(e){case df.b.NONE:this.mainInspectorFlow.handleMultipleActions((e=>{this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"display",value:"none"}),this.nodeStyleManagementFlow.removeStyleByKey({doc:e,nodeIds:[t.id],key:"transform"}),this.nodeStyleManagementFlow.removeStyleByKey({doc:e,nodeIds:[t.id],key:"transition"}),o.content.transform&&this.projectClassManagementFlow.deleteStyle({doc:e,classId:o.id,key:"transform",identifier:"desktop"})}));break;case df.b.SLIDE_FROM_RIGHT:this.mainInspectorFlow.handleMultipleActions((e=>{this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"display",value:"flex"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transform",value:"translateX(100%)"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transition",value:"0.5s"}),this.projectClassManagementFlow.addOrUpdate({doc:e,classId:o.id,key:"transform",value:"translateX(0%) !important",identifier:"desktop"})}));break;case df.b.SLIDE_FROM_LEFT:this.mainInspectorFlow.handleMultipleActions((e=>{this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"display",value:"flex"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transform",value:"translateX(-100%)"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transition",value:"0.5s"}),this.projectClassManagementFlow.addOrUpdate({doc:e,classId:o.id,key:"transform",value:"translateX(0%) !important",identifier:"desktop"})}));break;case df.b.SLIDE_FROM_TOP:this.mainInspectorFlow.handleMultipleActions((e=>{this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"display",value:"flex"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transform",value:"translateY(-100%)"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transition",value:"0.5s"}),this.projectClassManagementFlow.addOrUpdate({doc:e,classId:o.id,key:"transform",value:"translateY(0%) !important",identifier:"desktop"})}))}})),(0,r.Z)(this,"handleNavbarBreakpointChanged",((e,t)=>{if(!t)return null;if(!this.projectDoc.nodes.getById(t))return null;const o=(0,tl.U2)(this.projectDoc,t,Zn.IV.NAVBAR);if(!o)return null;const n=(0,tl.xf)(this.projectDoc,o,Zn.IV.NAVBAR_NAV),i=(0,tl.xf)(this.projectDoc,o,Zn.IV.BURGER_MENU);if(!n||!i)return null;const r=this.mediaQueryBreakpointManagementFlow.getActiveMediaQueriesInOrder(),s=this.mediaQueryBreakpointManagementFlow.getDefaultMediaQuery();this.mainInspectorFlow.handleMultipleActions((t=>{r.forEach((e=>{this.nodeStyleManagementFlow.removeConditionalInlineStyleByKey({doc:t,nodeIds:[n.id,i.id],key:"display",condition:{conditionType:"screen-size",maxWidth:e.maxWidth}})})),this.nodeStyleManagementFlow.setStyleByKey({doc:t,nodeIds:[n.id],key:"display",value:"flex"}),this.nodeStyleManagementFlow.setStyleByKey({doc:t,nodeIds:[i.id],key:"display",value:"none"}),this.nodeStyleManagementFlow.setConditionalInlineStyleByKey({doc:t,nodeIds:[n.id],key:"display",value:"none",condition:{conditionType:"screen-size",maxWidth:e.maxWidth}}),this.nodeStyleManagementFlow.setConditionalInlineStyleByKey({doc:t,nodeIds:[i.id],key:"display",value:"flex",condition:{conditionType:"screen-size",maxWidth:e.maxWidth}}),e.maxWidth===s.maxWidth&&(this.nodeStyleManagementFlow.setStyleByKey({doc:t,nodeIds:[n.id],key:"display",value:"none"}),this.nodeStyleManagementFlow.setStyleByKey({doc:t,nodeIds:[i.id],key:"display",value:"flex"}))}))}))}toggleUtilityClassOnNode(e){var t;const{doc:o}=e;if(!o)return;const{node:n,status:i,utilityClass:r}=e,s=document.getElementById("stage-frame");if(!s)return;const c=null===(t=s.contentDocument)||void 0===t?void 0:t.body.querySelectorAll(`[data-node-id="${n.id}"]`);c&&(i?(c.forEach((e=>e.classList.add(r))),(0,a.mutate)(this.projectUIState,(({selection:e})=>{e.nodesWithUtilityClasses[n.id]=r}))):(c.forEach((e=>e.classList.remove(r))),(0,a.mutate)(this.projectUIState,(({selection:e})=>{delete e.nodesWithUtilityClasses[n.id]}))))}},nf=(0,s.Z)(of.prototype,"projectDoc",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rf=(0,s.Z)(of.prototype,"projectUIState",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sf=(0,s.Z)(of.prototype,"nodeStyleManagementFlow",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),af=(0,s.Z)(of.prototype,"mediaQueryBreakpointManagementFlow",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cf=(0,s.Z)(of.prototype,"mainInspectorFlow",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lf=(0,s.Z)(of.prototype,"projectClassManagementFlow",[ef],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(of.prototype,"toggleUtilityClassOnNode",[m.P],Object.getOwnPropertyDescriptor(of.prototype,"toggleUtilityClassOnNode"),of.prototype),tf=of));o(628422);var pf,uf,hf,mf,yf,gf,ff,bf,If,vf,wf,Nf,jf,Sf,Df,Tf=o(978338);pf=(0,c.provide)("unsplashFlow"),uf=(0,c.inject)("thirdPartyAssetsService"),hf=(0,c.inject)("projectDoc"),mf=(0,c.inject)("assetsUploadFlow"),yf=(0,c.inject)("fileDownloadService"),gf=(0,c.inject)("assetsService"),ff=(0,c.inject)("notificationsManagementFlow"),pf((If=class{constructor(){(0,i.Z)(this,"thirdPartyAssetsService",vf,this),(0,i.Z)(this,"projectDoc",wf,this),(0,i.Z)(this,"assetsUploadFlow",Nf,this),(0,i.Z)(this,"fileDownloadService",jf,this),(0,i.Z)(this,"assetsService",Sf,this),(0,i.Z)(this,"notificationsManagementFlow",Df,this),(0,r.Z)(this,"getCuratedPhotos",(async e=>this.thirdPartyAssetsService.getCuratedUnsplash(e))),(0,r.Z)(this,"searchPhotos",(async(e,t)=>{try{return await this.thirdPartyAssetsService.searchUnsplash(e,t)}catch(o){return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not search for Unsplash images. Please try again later."),{}}})),(0,r.Z)(this,"getAPIDownloadUrl",(async e=>this.thirdPartyAssetsService.getUnsplashAPIDownloadUrl(e))),(0,r.Z)(this,"savePhotoToAssets",(async e=>{const t=await this.getBlobUnsplashImageFromUrl(e);if(!t)return;const o=t.type.split("/")[1],n=new File([t],`unsplash-image.${o}`,{type:t.type});try{const e=await this.assetsUploadFlow.upload({files:[n],parentFolderId:ut.D.PUBLIC_ASSETS});e&&e.length&&this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,$r.ou.jz.SUCCESS)}catch(i){this.notificationsManagementFlow.createNotification(d.k$.ERROR,$r.ou.jz.ERROR)}})),(0,r.Z)(this,"downloadPhoto",(async e=>{const t=await this.getBlobUnsplashImageFromUrl(e);if(!t)return;const o=t.type.split("/")[1];this.fileDownloadService.promptDownload(t,`unsplash-image.${o}`)})),(0,r.Z)(this,"getRandomPhotos",(async(e,t)=>{try{return await this.thirdPartyAssetsService.getRandomUnsplash(e,t)}catch(o){return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"There was a problem when getting the unsplash images"),[]}})),(0,r.Z)(this,"getRandomPhotoUrls",(async(e,t)=>{if(!e.length)return[];(0,Tf.Sy)(e);const o=[];for(;o.length<t;)for(let t=0;t<e.length;t++){const n=e[t],i=await this.thirdPartyAssetsService.getRandomUnsplash(n,1);i[0]?o.push(i[0].urls.regular):o.push(or.M3.IMAGE_SRC)}return o})),(0,r.Z)(this,"getBlobUnsplashImageFromUrl",(async e=>{let t,o={url:""};try{o=await this.getAPIDownloadUrl(e)}catch(n){return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"There was a problem when getting the image"),null}try{t=await this.assetsService.fetchImageFromUrlAsBlob(o.url)}catch(n){return this.notificationsManagementFlow.createNotification(d.k$.ERROR,$r.ou.jz.ERROR),null}return t}))}computeNewUnsplashUrl(e,t){const o=$r.ou.I1,n=$r.ou.yL,i=this.projectDoc.estimateNodeDimensionInPxByStyle("width",e),r=this.projectDoc.estimateNodeDimensionInPxByStyle("height",e);let s=i>$r.ou.nq?$r.ou.nq:Math.ceil(i/o)*o;const a=r>$r.ou.nq?$r.ou.nq:Math.ceil(r/o)*o;s=s>n?s:n;const c=a>s?`&h=${a}`:`&w=${s}`,l=(0,Tf.EH)("w",t)[0],d=(0,Tf.EH)("h",t)[0];if(l===c||d===c)return;let p=t;return l&&d&&(p=(0,Tf.gG)("w",p,""),p=(0,Tf.gG)("h",p,c)),l&&!d&&(p=(0,Tf.gG)("w",p,c)),!l&&d&&(p=(0,Tf.gG)("h",p,c)),l||d||(p=(0,Tf.gG)("w",p,c)),p}},vf=(0,s.Z)(If.prototype,"thirdPartyAssetsService",[uf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wf=(0,s.Z)(If.prototype,"projectDoc",[hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nf=(0,s.Z)(If.prototype,"assetsUploadFlow",[mf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jf=(0,s.Z)(If.prototype,"fileDownloadService",[yf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sf=(0,s.Z)(If.prototype,"assetsService",[gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Df=(0,s.Z)(If.prototype,"notificationsManagementFlow",[ff],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bf=If));var Of,Ff,Cf,Ef,xf;Of=(0,c.provide)("pexelFlow"),Ff=(0,c.inject)("thirdPartyAssetsService"),Of((Ef=class{constructor(){(0,i.Z)(this,"thirdPartyAssetsService",xf,this),(0,r.Z)(this,"getRandomVideoUrls",(async(e,t)=>{if(!e.length)return[];(0,Tf.Sy)(e);const o=[],n={};let i=!1,r=0;for(;o.length<t&&r<100&&!i;){i=e.every((e=>0===n[e]));for(let t=0;t<e.length;t++){const i=e[t];if(0!==n[i]){try{var s;const e=await this.thirdPartyAssetsService.searchPexelVideo(i,(0,Tf.XF)(1,100),1);var a,c;if(void 0===n[i])n[i]=(null===(a=e.videos)||void 0===a?void 0:a.length)||0;else n[i]+=(null===(c=e.videos)||void 0===c?void 0:c.length)||0;if(null!==(s=e.videos)&&void 0!==s&&s.length){const t=e.videos[0].video_files.find((e=>"hd"===e.quality)),n=e.videos[0].video_pictures.find((e=>0===e.nr));t&&n&&o.push({url:t.link,poster:n.picture})}}catch(l){console.error("Error getting pexel video",l)}r+=1}}}return o}))}},xf=(0,s.Z)(Ef.prototype,"thirdPartyAssetsService",[Ff],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cf=Ef));var _f,Mf,Pf,Af,kf;_f=(0,c.provide)("assetsNavigationFlow"),Mf=(0,c.inject)("projectUIState"),_f((Af=class{constructor(){(0,i.Z)(this,"projectUIState",kf,this)}toggleIconType(e){(0,a.mutate)(this.projectUIState,(t=>{var o;const n=t.assetsList.toggledIconLibraries[e];t.assetsList.toggledIconLibraries[e]=null!==(o=!n)&&void 0!==o&&o}))}setToggledIconTypes(e){(0,a.mutate)(this.projectUIState,(t=>{t.assetsList.toggledIconLibraries=e}))}},kf=(0,s.Z)(Af.prototype,"projectUIState",[Mf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pf=Af));var Uf,Rf,Zf,Lf,$f;Uf=(0,c.provide)("assetsSearchFlow"),Rf=(0,c.inject)("projectUIState"),Uf((Lf=class{constructor(){(0,i.Z)(this,"projectUIState",$f,this)}storeIconSearch(e){(0,a.mutate)(this.projectUIState,(t=>{t.assetsList.currentIconSearch=e}))}storeUnsplashSearch(e){(0,a.mutate)(this.projectUIState,(t=>{t.assetsList.currentUnsplashSearch=e}))}storeUploadsSearch(e){(0,a.mutate)(this.projectUIState,(t=>{t.assetsList.currentUploadsSearch=e}))}},$f=(0,s.Z)(Lf.prototype,"projectUIState",[Rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zf=Lf));var Bf,Gf,Hf,zf,Yf,Vf,Wf,Kf,qf,Jf,Xf,Qf,eb,tb,ob,nb=o(61750);Bf=(0,c.provide)("assetsSelectionFlow"),Gf=(0,c.inject)("projectDoc"),Hf=(0,c.inject)("projectUIState"),zf=(0,c.inject)("nodeStyleManagmentFlow"),Yf=(0,c.inject)("nodeSelectionFlow"),Vf=(0,c.inject)("assetFoldersFlow"),Wf=(0,c.inject)("folderManagementFlow"),Bf((qf=class{constructor(){(0,i.Z)(this,"projectDoc",Jf,this),(0,i.Z)(this,"projectUIState",Xf,this),(0,i.Z)(this,"nodeStyleManagmentFlow",Qf,this),(0,i.Z)(this,"nodeSelectionFlow",eb,this),(0,i.Z)(this,"assetFoldersFlow",tb,this),(0,i.Z)(this,"folderManagementFlow",ob,this)}getAssetActionType(){var e;const t=this.nodeSelectionFlow.getSelectedNodesIds()[0],o=this.projectUIState.userInteractions.pressedKeys.alt,n=this.projectDoc.nodes.getById(t);if(!n)return nb.gP.ADD_CHILD;const{focusedImgAttr:i,UploadedAssetType:r}=this.projectUIState.userInteractions,s=n.primitiveType;let a=!1;if(this.projectDoc.nodes.nodeIsCompInstance(n)){var c;const e=n.compIdOfCompInstance;if(!e)throw new Error("Component not found");const t=(null===(c=this.projectDoc.components.byId[e])||void 0===c?void 0:c.propDefinitions)||{};a=Object.values(t).some((e=>e.inputType===jd.SO.IMAGE))}if("cms-mixed-type-node"!==n.type||a||Object.keys(n.mappings).forEach((e=>{const t=n.mappings[e];if(t.componentId){var o;const e=(null===(o=this.projectDoc.components.byId[t.componentId])||void 0===o?void 0:o.propDefinitions)||{};a=Object.values(e).some((e=>e.inputType===jd.SO.IMAGE))}})),s===Zn.sO.LIST||s===Zn.sO.LISTITEM)return o?nb.gP.ADD_SIBLING:nb.gP.REPLACE_SOURCE;if(a||null!==i&&void 0!==i&&null!==(e=i.attrName)&&void 0!==e&&e.includes(n.id))return o?nb.gP.ADD_SIBLING:nb.gP.REPLACE_SOURCE;const l=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(t,["backgroundImage"]).backgroundImage;switch(r){case"video":return s===Zn.sO.VIDEO?o?nb.gP.ADD_SIBLING:nb.gP.REPLACE_SOURCE:this.projectDoc.isNodeAcceptingChildByElementType(n,Zn.sO.VIDEO)?o?nb.gP.ADD_SIBLING:nb.gP.ADD_CHILD:nb.gP.ADD_SIBLING;case"image":default:{if(s===Zn.sO.IMAGE)return o?nb.gP.ADD_SIBLING:nb.gP.REPLACE_SOURCE;if(s===Zn.sO.VIDEO)return o?nb.gP.ADD_SIBLING:nb.gP.REPLACE_POSTER;let e=nb.gP.ADD_SIBLING;if(this.projectDoc.isNodeAcceptingChildByElementType(n,Zn.sO.IMAGE)){if(l)return o?nb.gP.ADD_CHILD:nb.gP.REPLACE_SOURCE;e=nb.gP.ADD_CHILD}return n.primitiveType===Zn.sO.COMPONENT?o?nb.gP.REPLACE_SOURCE:nb.gP.ADD_SIBLING:o&&e!==nb.gP.ADD_SIBLING?nb.gP.REPLACE_SOURCE:e}}}selectAsset(e,t){const{selected:o}=this.projectUIState.assetsList;(0,a.mutate)(this.projectUIState,(n=>{o.entities[e]?(delete n.assetsList.selected.entities[e],n.assetsList.selected.location=null):(n.assetsList.selected.entities[e]=!0,n.assetsList.selected.location=t)}))}deselectAllAssets(){(0,a.mutate)(this.projectUIState,(e=>{e.assetsList.selected.entities={},e.assetsList.selected.location=null}))}selectRangeInFolder(e,t,o){var n,i;const r=Object.keys(this.projectUIState.assetsList.selected.entities),s=Object.keys(this.projectUIState.folders.selected.entities);if(r.length+s.length===0)return void(t?this.selectAsset(e,o):this.folderManagementFlow.selectFolder(e,o));const a=t?this.projectDoc.assets.byId[e]:this.projectDoc.folders.byId[e],c=t?null===a||void 0===a?void 0:a.parentFolderId:null===a||void 0===a?void 0:a.parentId,l=r.length?r[0]:s[0],d=r.length?null===(n=this.projectDoc.assets.byId[r[0]])||void 0===n?void 0:n.parentFolderId:null===(i=this.projectDoc.folders.byId[s[0]])||void 0===i?void 0:i.parentId;if(!d||c!==d)return this.deselectAllAssets(),this.folderManagementFlow.deselectAllFolders(),void(t?this.selectAsset(e,o):this.folderManagementFlow.selectFolder(e,o));const p=this.folderManagementFlow.getChildFoldersOfFolder(c).map((e=>e.id)),u=this.assetFoldersFlow.getOrderedAssetsOfFolder(c).map((e=>e.id)),h=p.concat(u);let m=h.indexOf(l),y=h.indexOf(e);m>y&&([m,y]=[y,m]);h.slice(m,y+1).filter((e=>!r.includes(e)&&!s.includes(e))).forEach((e=>{u.includes(e)?this.selectAsset(e,o):this.folderManagementFlow.selectFolder(e,o)}))}setPreviewOnHover(e){(0,a.mutate)(this.projectUIState,(t=>{t.userPreferences.previewAssetsOnHover=e}))}setFocusedUploadedAssetType(e){(0,a.mutate)(this.projectUIState,(t=>{t.userInteractions.UploadedAssetType=e}))}},Jf=(0,s.Z)(qf.prototype,"projectDoc",[Gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=(0,s.Z)(qf.prototype,"projectUIState",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qf=(0,s.Z)(qf.prototype,"nodeStyleManagmentFlow",[zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eb=(0,s.Z)(qf.prototype,"nodeSelectionFlow",[Yf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tb=(0,s.Z)(qf.prototype,"assetFoldersFlow",[Vf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ob=(0,s.Z)(qf.prototype,"folderManagementFlow",[Wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf=qf));var ib,rb,sb,ab,cb,lb,db,pb,ub,hb,mb,yb,gb,fb,bb,Ib,vb,wb,Nb,jb,Sb;o(693696),o(358614);ib=(0,c.provide)("imageOptimisationFlow"),rb=(0,c.inject)("projectDoc"),sb=(0,c.inject)("projectUIState"),ab=(0,c.inject)("nodeStyleManagmentFlow"),cb=(0,c.inject)("assetsService"),lb=(0,c.inject)("nodeAttributeManagmentFlow"),db=(0,c.inject)("propDefinitionManagementFlow"),pb=(0,c.inject)("unsplashFlow"),ub=(0,c.inject)("collaboratorManagementFlow"),hb=(0,c.inject)("sentryService"),ib((yb=class{constructor(){(0,i.Z)(this,"projectDoc",gb,this),(0,i.Z)(this,"projectUIState",fb,this),(0,i.Z)(this,"nodeStyleManagementFlow",bb,this),(0,i.Z)(this,"assetsService",Ib,this),(0,i.Z)(this,"nodeAttributeManagementFlow",vb,this),(0,i.Z)(this,"propDefinitionManagementFlow",wb,this),(0,i.Z)(this,"unsplashFlow",Nb,this),(0,i.Z)(this,"collaboratorManagementFlow",jb,this),(0,i.Z)(this,"sentryService",Sb,this)}optimiseNodeImages(e){var t,o;const{nodeId:n,doc:i,unsplashOnly:r}=e;!i||null!==(t=this.projectUIState.localWork)&&void 0!==t&&null!==(o=t.nodesUnderLocalWork)&&void 0!==o&&o[n]||(this.updateUnsplashSizeQuery({nodeId:n,doc:i}),r||this.updateLinkedAssetsSizes({doc:i,nodeId:n}))}updateBgImgProperty(e,t){var o;const n=null===(o=e.backgroundImage)||void 0===o?void 0:o.content;if("string"!==typeof n)return;const i=(0,gl.BQ)(n).map((e=>{if(e.includes("gradient"))return e;let o=`${e}`.split(/'|"/)[1];return o&&o.includes("images.unsplash")?(o=this.unsplashFlow.computeNewUnsplashUrl(t,o)||"",o?`url('${o}')`:e):e})).join();n!==i&&(e.backgroundImage=new Yr.F({content:i}))}updateUnsplashSizeQuery(e){const{nodeId:t,doc:o}=e,n=null===o||void 0===o?void 0:o.nodes.getById(t);if(!n||!o)return;const i=(0,tl.Uq)(n,"src");if(i&&"static"===i.type&&String(i.content).indexOf("images.unsplash")>-1){const e=this.unsplashFlow.computeNewUnsplashUrl(n.id,String(i.content));e&&this.nodeAttributeManagementFlow.updateAttrByKey({nodeId:t,key:"src",value:e,doc:o})}if(i&&"dynamic"===i.type){var r;const e=o.getComponentIdForNode(n.id);if(!e)return;const t=null===(r=o.components.byId[e])||void 0===r?void 0:r.propDefinitions;if(!t)return;const s=i.content.id,a=t[s];if(!a)return;if("string"!==typeof a.defaultValue)throw new Error("Unexpected prop type: "+typeof a.defaultValue);if(a.defaultValue.indexOf("images.unsplash")>-1){const t=this.unsplashFlow.computeNewUnsplashUrl(n.id,a.defaultValue);t&&this.propDefinitionManagementFlow.updatePropDefinition({compId:e,propId:s,propData:{defaultValue:t},doc:o})}}"styles"in n&&(this.updateBgImgProperty(n.styles,t),Object.values(n.referencedStyles).forEach((e=>{"inlined"===e.content.mapType&&this.updateBgImgProperty(e.content.styles,t)})))}computeAssetSizeForComponent(e){const{doc:t,assetId:o,compId:n}=e;if(!t)return;const i=t.assets.byId[o],r=n||this.projectUIState.selection.componentId;if(!i||!r||i.skipOptimisations)return;if(!Object.keys(i.usedInNodes).length)return void delete i.sizePerComponent;let s;var a;(Object.keys(i.usedInNodes).forEach((e=>{const o=t.getComponentIdForNode(e);!o||r&&o!==r||(s=this.computeAssetSizeForNode({nodeId:e,asset:i,currentValue:s}))})),s)?(i.sizePerComponent||(i.sizePerComponent={}),i.sizePerComponent[r]=s):null===(a=i.sizePerComponent)||void 0===a||delete a[r]}computeAssetSizeForNode(e){var t,o;const{nodeId:n,asset:i,currentValue:r}=e,{originalHeight:s=1,originalWidth:a=1}=i,c=this.projectDoc.nodes.getById(n);let l=0,d=0;if(c&&this.projectDoc.nodes.nodeIsCompInstance(c)){const e=this.projectDoc.components.byId[c.compIdOfCompInstance];Object.keys(c.attrs||{}).forEach((t=>{if(c.attrs[t].content!==i.id)return;const o=Object.values(e.propDefinitions).find((e=>e.name===t));Object.keys((null===o||void 0===o?void 0:o.locations)||{}).forEach((e=>{const t=this.projectDoc.estimateNodeDimensionInPxByStyle("width",e),o=this.projectDoc.estimateNodeDimensionInPxByStyle("height",e);l=l<t?t:l,d=d<o?o:d}))}))}else l=this.projectDoc.estimateNodeDimensionInPxByStyle("width",n),d=this.projectDoc.estimateNodeDimensionInPxByStyle("height",n);const p=$r.ou.I1;l=Math.ceil(l/p)*p,d=Math.ceil(d/p)*p;const u=l/a,h=d/s;if(l<=$r.ou.yL&&d<=$r.ou.yL&&(u>h?(l=$r.ou.yL,d=0):(l=0,d=$r.ou.yL)),!r)return u>h?`w=${l}`:`h=${d}`;const m=u>h?`w=${l}`:`h=${d}`;return parseInt((null===(t=m.match(/\d/g))||void 0===t?void 0:t.join(""))||"",10)/(-1!==m.indexOf("w")?u:h)>parseInt((null===(o=r.match(/\d/g))||void 0===o?void 0:o.join(""))||"",10)/(-1!==r.indexOf("w")?u:h)?m:r}computeSizePerComponentForAllAssetsIfNeeded(e){const{doc:t}=e;if(!t)return;if(this.collaboratorManagementFlow.getCurrentUserProjectRole()===za.Z.READ)return;const o=Object.values(t.assets.byId);if(o.some((e=>e.sizePerComponent)))return;const n=this.computeAssetSizePerComponent(o);Object.keys(n).forEach((e=>{t.assets.byId[e]&&(t.assets.byId[e].sizePerComponent=n[e])}))}computeAssetSizePerComponent(e){const t={};for(const o of e){const{originalHeight:e=1,originalWidth:n=1}=o;if(Object.keys(o.usedInNodes).length)t[o.id]||(t[o.id]={}),Object.keys(o.usedInNodes).forEach((e=>{const n=this.projectDoc.getComponentIdForNode(e);n?t[o.id][n]=this.computeAssetSizeForNode({nodeId:e,asset:o,currentValue:t[o.id][n]}):this.sentryService.captureException(new Error(`Could not find source component for node ${e} when calculating asset size`))}));else{const i=e>=n?`w=${$r.ou.Cg}`:`h=${$r.ou.Cg}`;t[o.id]={nonComponent:i}}}return t}nodeHasSomeImage(e){const{nodeId:t,doc:o}=e;if(!o)return;const n=o.nodes.getById(t);if(n&&o.nodes.nodeIsCompInstance(n)){const e=o.components.byId[n.compIdOfCompInstance];return e?Object.values(e.propDefinitions).some((e=>e.inputType===jd.SO.IMAGE)):(this.sentryService.captureException(new Error(`Tried to compute images for a component that doesn't exist: ${n.compIdOfCompInstance}`)),!1)}if((null===n||void 0===n?void 0:n.primitiveType)===Zn.sO.VIDEO)return(0,tl.kd)(n,"poster");if(n&&(0,tl.kd)(n,"src"))return!0;return!!this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(t,["backgroundImage"]).backgroundImage}updateLinkedAssetsSizes(e){const{doc:t,nodeId:o}=e;t&&this.nodeHasSomeImage({doc:t,nodeId:o})&&Object.values(t.assets.byId).forEach((e=>{if(!e.usedInNodes[o])return;const n=t.getComponentIdForNode(o);this.computeAssetSizeForComponent({doc:t,assetId:e.id,compId:n})}))}getAssetsLinkedToNodes(e){const{nodeIds:t,doc:o,withDescendants:n}=e;let i=[];return n?t.forEach((e=>{null===o||void 0===o||o.nodes.bfs(e,(e=>{i.includes(e.id)||i.push(e.id)}))})):i=t,Object.values((null===o||void 0===o?void 0:o.assets.byId)||{}).filter((e=>i.some((t=>Object.keys(e.usedInNodes).includes(t))))).map((e=>e.id))}removeAssetSizeForPageOrComp(e){const{id:t,doc:o}=e;if(!o)return;const n=o.getProjectPageOrComponent(t);if(!n||!n.rootNodeId)return;this.getAssetsLinkedToNodes({nodeIds:[n.rootNodeId],withDescendants:!0}).forEach((e=>{const{sizePerComponent:n}=o.assets.byId[e];n&&delete n[t]}))}},gb=(0,s.Z)(yb.prototype,"projectDoc",[rb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fb=(0,s.Z)(yb.prototype,"projectUIState",[sb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bb=(0,s.Z)(yb.prototype,"nodeStyleManagementFlow",[ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ib=(0,s.Z)(yb.prototype,"assetsService",[cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vb=(0,s.Z)(yb.prototype,"nodeAttributeManagementFlow",[lb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wb=(0,s.Z)(yb.prototype,"propDefinitionManagementFlow",[db],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nb=(0,s.Z)(yb.prototype,"unsplashFlow",[pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jb=(0,s.Z)(yb.prototype,"collaboratorManagementFlow",[ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sb=(0,s.Z)(yb.prototype,"sentryService",[hb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(yb.prototype,"optimiseNodeImages",[m.P],Object.getOwnPropertyDescriptor(yb.prototype,"optimiseNodeImages"),yb.prototype),(0,s.Z)(yb.prototype,"updateUnsplashSizeQuery",[m.P],Object.getOwnPropertyDescriptor(yb.prototype,"updateUnsplashSizeQuery"),yb.prototype),(0,s.Z)(yb.prototype,"computeAssetSizeForComponent",[m.P],Object.getOwnPropertyDescriptor(yb.prototype,"computeAssetSizeForComponent"),yb.prototype),(0,s.Z)(yb.prototype,"computeSizePerComponentForAllAssetsIfNeeded",[m.P],Object.getOwnPropertyDescriptor(yb.prototype,"computeSizePerComponentForAllAssetsIfNeeded"),yb.prototype),(0,s.Z)(yb.prototype,"nodeHasSomeImage",[m.P],Object.getOwnPropertyDescriptor(yb.prototype,"nodeHasSomeImage"),yb.prototype),(0,s.Z)(yb.prototype,"updateLinkedAssetsSizes",[m.P],Object.getOwnPropertyDescriptor(yb.prototype,"updateLinkedAssetsSizes"),yb.prototype),(0,s.Z)(yb.prototype,"getAssetsLinkedToNodes",[m.P],Object.getOwnPropertyDescriptor(yb.prototype,"getAssetsLinkedToNodes"),yb.prototype),(0,s.Z)(yb.prototype,"removeAssetSizeForPageOrComp",[m.P],Object.getOwnPropertyDescriptor(yb.prototype,"removeAssetSizeForPageOrComp"),yb.prototype),mb=yb));var Db,Tb,Ob,Fb,Cb,Eb,xb,_b,Mb,Pb,Ab,kb,Ub;function Rb(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Zb(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Rb(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Rb(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Db=(0,c.provide)("imageTransformationFlow"),Tb=(0,c.inject)("projectDoc"),Ob=(0,c.inject)("projectUIState"),Fb=(0,c.inject)("nodeStyleManagmentFlow"),Cb=(0,c.inject)("nodeAttributeManagmentFlow"),Eb=(0,c.inject)("propDefinitionManagementFlow"),Db((_b=class{constructor(){(0,i.Z)(this,"projectDoc",Mb,this),(0,i.Z)(this,"projectUIState",Pb,this),(0,i.Z)(this,"nodeStyleManagmentFlow",Ab,this),(0,i.Z)(this,"nodeAttributeManagementFlow",kb,this),(0,i.Z)(this,"propDefinitionManagementFlow",Ub,this)}extractImageFromContainer(e){var t,o,n;const{doc:i,nodeId:r}=e;if(!i)return;const s=i.nodes.getById(r);if(!s)throw new Error("Cannot extract image from unexisting node");if(!("styles"in s))throw new Error("Cannot extract image from node that has no styles abilities");if("childrenIds"in s&&Object.keys((null===s||void 0===s?void 0:s.childrenIds)||{}).length>0)throw new Error("Cannot extract image from container with children");const{styles:a,inheritedStyles:c}=this.nodeStyleManagmentFlow.getComputedStyleByKeyForCurrentBreakpoint(s.id,["backgroundImage"]);let l=a.backgroundImage||c.backgroundImage;if(!l||"string"!==typeof l)throw new Error("Could not extract image: node does not have one.");const d=Zn.sO.IMAGE,p={},u=Zb({},s.styles),h=null===(t=s.styles.backgroundSize)||void 0===t?void 0:t.content,m=null===(o=s.styles.backgroundPosition)||void 0===o?void 0:o.content;let y=null===(n=s.attrs.id)||void 0===n?void 0:n.content;"string"!==typeof y&&(y="");if(l=(0,gl.BQ)(l).find((e=>!e.includes("gradient")))||"",!l)return!1;if("string"===typeof l&&!this.projectDoc.assets.byId[l]){const e=l.split(/"|'/)[1];if(!e)return!1;l=e}Object.keys(u).forEach((e=>{for(const t of qd.Or)if(e.includes(t)&&!e.includes("background"))return;delete u[e]})),u.objectFit=new Yr.F({content:"contain"!==h?"cover":h}),u.objectPosition=new Yr.F({content:"string"!==typeof m?"center":m}),p.src=new Yr.F({content:l}),y&&(p.id=new Yr.F({content:y})),s.primitiveType=d,s.semanticType=null,s.attrs=p,s.styles=u}turnImageIntoContainer(e){var t,o,n;const{doc:i,nodeId:r}=e;if(!i)return!1;const s=i.nodes.getById(r);if(!s)throw new Error("Cannot transform unexisting node to container.");const a=s.attrs.src;if(!a)throw new Error("Cannot transform image to container: image has no source.");let c;if("string"===typeof a.content)c=a.content;else{var l;const e=null===(l=this.propDefinitionManagementFlow.getPropDefForDynamicNode(s,a))||void 0===l?void 0:l.defaultValue;if("string"!==typeof e)throw new Error("Cannot transform image to container, default value for bound dynamic node is not a string. Received type: "+typeof e);c=e||""}const d=null===(t=s.styles.objectFit)||void 0===t?void 0:t.content,p=null===(o=s.styles.objectPosition)||void 0===o?void 0:o.content;let u=null===(n=s.attrs.id)||void 0===n?void 0:n.content;"string"!==typeof u&&(u="");const h=Zn.sO.CONTAINER,m=Zn.iX.DIV;let y=Zb({},s.styles);const g=Zb({},s.attrs),f={};if(Object.keys(y).forEach((e=>{for(const t of qd.Or)if(e.includes(t)&&!e.includes("object"))return;delete y[e]})),this.projectDoc.assets.byId[c]||(c=`url('${c}')`),y=Zb(Zb({},y),{},{backgroundImage:new Yr.F({content:c}),backgroundPosition:new Yr.F({content:"string"!==typeof p?"center":p}),backgroundSize:new Yr.F({content:"contain"!==d?"cover":d}),display:new Yr.F({content:"flex"})}),u&&(f.id=new Yr.F({content:u})),!y.width){const t=e.width?Math.round(e.width):100;y.width=new Yr.F({content:`${t}px`})}if(!y.height){const t=e.height?Math.round(e.height):100;y.height=new Yr.F({content:`${t}px`})}s.semanticType=m,s.attrs=f,s.styles=y,s.primitiveType=h,Object.keys(g).forEach((e=>{"dynamic"===g[e].type&&-1!==jd.lm.indexOf(e)&&this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:s.id,propId:g[e].content.id,location:{base:jd.hD.ATTR,sufix:e},doc:i})}))}},Mb=(0,s.Z)(_b.prototype,"projectDoc",[Tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pb=(0,s.Z)(_b.prototype,"projectUIState",[Ob],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ab=(0,s.Z)(_b.prototype,"nodeStyleManagmentFlow",[Fb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kb=(0,s.Z)(_b.prototype,"nodeAttributeManagementFlow",[Cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ub=(0,s.Z)(_b.prototype,"propDefinitionManagementFlow",[Eb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(_b.prototype,"extractImageFromContainer",[m.P],Object.getOwnPropertyDescriptor(_b.prototype,"extractImageFromContainer"),_b.prototype),(0,s.Z)(_b.prototype,"turnImageIntoContainer",[m.P],Object.getOwnPropertyDescriptor(_b.prototype,"turnImageIntoContainer"),_b.prototype),xb=_b));var Lb,$b,Bb,Gb,Hb;o(382405),o(754611);Lb=(0,c.provide)("dragFilesOverWindowFlow"),$b=(0,c.inject)("projectUIState"),Lb((Gb=class{constructor(){(0,i.Z)(this,"projectUIState",Hb,this)}setDraggingFiles(e){(0,a.mutate)(this.projectUIState,(t=>{t.drag.draggingFiles=e}))}setDraggingFilesOverAssetFolder(e,t){(0,a.mutate)(this.projectUIState,(o=>{o.drag.draggingFilesOverAssetFolder={folderId:e||"",location:t||null}}))}},Hb=(0,s.Z)(Gb.prototype,"projectUIState",[$b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bb=Gb));o(444370),o(425428);var zb,Yb,Vb,Wb,Kb,qb,Jb,Xb,Qb,eI,tI;zb=(0,c.provide)("tutorialFlow"),Yb=(0,c.inject)("projectUIState"),Vb=(0,c.inject)("projectDoc"),Wb=(0,c.inject)("globalAppState"),Kb=(0,c.inject)("userAccountRepository"),zb((Jb=class{constructor(){(0,i.Z)(this,"projectUIState",Xb,this),(0,i.Z)(this,"projectDoc",Qb,this),(0,i.Z)(this,"globalAppState",eI,this),(0,i.Z)(this,"userAccountRepository",tI,this),(0,r.Z)(this,"tutorialSteps",[]),(0,r.Z)(this,"currentPosition",-1),(0,r.Z)(this,"overallTutorialState",null),(0,r.Z)(this,"queuedTutorials",[]),(0,r.Z)(this,"shouldStartTutorial",(e=>{var t;const{userData:o}=this.globalAppState.user;if(!o)return!1;if(null!==o&&void 0!==o&&o.isAnonymous)return!1;if(this.projectUIState.readonly||this.projectUIState.cloneable)return!1;if(this.projectUIState.tutorials.tutorialInProgress)return!1;const n=null===o||void 0===o?void 0:o.meta;this.overallTutorialState=(null===n||void 0===n?void 0:n[`${e}Tutorial`])||{completed:!1};const{completed:i,skipped:r}=this.overallTutorialState,s=null===n||void 0===n||null===(t=n.login)||void 0===t?void 0:t.lastTimeEnteredStage,a=(new Date).toISOString();return!i&&!r||((e,t)=>{const o=new Date(e),n=new Date(t),i=o.getFullYear(),r=[31,i%4===0&&i%100!==0||i%400===0?29:28,31,30,31,30,31,31,30,31,30,31];let s=n.getFullYear()-i,a=n.getMonth()-o.getMonth();a<0&&(s--,a+=12);let c=n.getDate()-o.getDate();return c<0&&(a>0?a--:(s--,a=11),c+=r[o.getMonth()]),12*s+a+c/30})(a,s)>=3})),(0,r.Z)(this,"startTutorial",(e=>{this.projectUIState.tutorials.tutorialInProgress?this.queuedTutorials.push(e):this.loadTutorial(e)})),(0,r.Z)(this,"checkAndBeginTutorial",(e=>{this.shouldStartTutorial(e)&&this.startTutorial(e)})),(0,r.Z)(this,"loadTutorial",(async e=>{const{steps:t}=await o(701652)(`./${e}`);this.tutorialSteps=t,this.currentPosition=-1,(0,a.mutate)(this.projectUIState,(({tutorials:t})=>{t.currentStep=this.tutorialSteps[0],t.tutorialInProgress=e})),this.nextStep()})),(0,r.Z)(this,"nextStep",(()=>{if(!this.projectUIState.tutorials.tutorialInProgress)throw new Error("Cannot get next step if no tutorial is active");const e=this.currentPosition+1;e===this.tutorialSteps.length&&this.endTutorial();const t=this.tutorialSteps[this.currentPosition];(null===t||void 0===t?void 0:t.afterShow)&&t.afterShow(this.projectUIState,this.projectDoc),this.currentPosition=e;const o=this.tutorialSteps[e];(null===o||void 0===o?void 0:o.beforeShow)&&o.beforeShow(this.projectUIState,this.projectDoc),(0,a.mutate)(this.projectUIState,(({tutorials:t})=>{t.tutorialInProgress&&(t.currentStep=this.tutorialSteps[e])}))})),(0,r.Z)(this,"previousStep",(()=>{if(!this.projectUIState.tutorials.tutorialInProgress)throw new Error("Cannot get previous step if no tutorial active");const e=this.currentPosition-1;if(e<0)return(0,a.mutate)(this.projectUIState,(({tutorials:e})=>{e.tutorialInProgress&&(e.currentStep=this.tutorialSteps[0])})),this.tutorialSteps[0];const t=this.tutorialSteps[this.currentPosition];(null===t||void 0===t?void 0:t.afterShow)&&t.afterShow(this.projectUIState,this.projectDoc);const o=this.tutorialSteps[e];(null===o||void 0===o?void 0:o.beforeShow)&&o.beforeShow(this.projectUIState,this.projectDoc),this.currentPosition=e,(0,a.mutate)(this.projectUIState,(({tutorials:t})=>{t.tutorialInProgress&&(t.currentStep=this.tutorialSteps[e])}))})),(0,r.Z)(this,"addTutorialToQueue",(e=>{this.queuedTutorials.push(e)})),(0,r.Z)(this,"clearTutorialQueue",(()=>{this.queuedTutorials=[]})),(0,r.Z)(this,"runQueuedTutorials",(()=>{this.queuedTutorials.length>0&&this.startTutorial(this.queuedTutorials.shift())}))}isLast(){return this.currentPosition===this.tutorialSteps.length-1}isFirst(){return 0===this.currentPosition}async endTutorial(){var e;this.overallTutorialState={completed:!0},(0,a.mutate)(this.globalAppState,(({user:e})=>{if(!e.userData||null===this.overallTutorialState)return;const t=this.projectUIState.tutorials.tutorialInProgress;e.userData.meta[`${t}Tutorial`]=this.overallTutorialState})),await this.userAccountRepository.update({meta:null===(e=this.globalAppState.user.userData)||void 0===e?void 0:e.meta}),this.currentPosition=-1,(0,a.mutate)(this.projectUIState,(({tutorials:e})=>{e.tutorialInProgress=null,e.currentStep=null})),this.runQueuedTutorials()}async skipTutorial(){var e;this.currentPosition=-1,this.overallTutorialState={completed:!1,skipped:!0,position:this.currentPosition},(0,a.mutate)(this.globalAppState,(({user:e})=>{if(!e.userData||null===this.overallTutorialState)return;const t=this.projectUIState.tutorials.tutorialInProgress;e.userData.meta[`${t}Tutorial`]=this.overallTutorialState})),await this.userAccountRepository.update({meta:null===(e=this.globalAppState.user.userData)||void 0===e?void 0:e.meta}),(0,a.mutate)(this.projectUIState,(({tutorials:e})=>{e.tutorialInProgress=null})),this.runQueuedTutorials()}},Xb=(0,s.Z)(Jb.prototype,"projectUIState",[Yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qb=(0,s.Z)(Jb.prototype,"projectDoc",[Vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eI=(0,s.Z)(Jb.prototype,"globalAppState",[Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tI=(0,s.Z)(Jb.prototype,"userAccountRepository",[Kb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qb=Jb));var oI=o(570034),nI=o(980116),iI=o(244586),rI=o(724081),sI=o(481175),aI=o.n(sI),cI=o(639887);function lI(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function dI(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?lI(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):lI(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const pI={classes:["Keep original class","Create new class","Replace original class","Skip duplicate properties","Overwrite duplicate properties"],tokens:["Keep original token","Create new token","Replace original token"],textStyles:["Keep original text style","Create new text style","Replace original text style","Skip duplicate properties","Overwrite duplicate properties"]},uI=e=>{const{onSubmit:t,onDismiss:o,conflicts:n}=e,[i,r]=w.useState(n.classes.reduce(((e,t)=>(e[t]=0,e)),{})),[s,a]=w.useState(n.tokens.reduce(((e,t)=>(e[t]=0,e)),{})),[c,l]=w.useState(n.textStyles.reduce(((e,t)=>(e[t]=0,e)),{}));return(0,F.jsxs)("div",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]])+" wrapper",children:[(0,F.jsx)("p",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]])+" modal-title",children:"We have detected some design language conflicts"}),(0,F.jsxs)("div",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]])+" entities-wrapper",children:[Object.keys(i).length?(0,F.jsx)("p",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]]),children:"Classes"}):null,Object.entries(i).map((([e,t])=>(0,F.jsxs)("div",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]])+" entity",children:[(0,F.jsx)("span",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]]),children:e}),(0,F.jsx)(V.P,{dropdownAnchor:"right",options:pI.classes,value:pI.classes[t],onChange:t=>((e,t)=>{const o=dI({},i);o[t]=pI.classes.indexOf(e),r(o)})(t,e)})]},e))),Object.keys(s).length?(0,F.jsx)("p",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]]),children:"Tokens"}):null,Object.entries(s).map((([e,t])=>(0,F.jsxs)("div",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]])+" entity",children:[(0,F.jsx)("span",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]]),children:e}),(0,F.jsx)(V.P,{dropdownAnchor:"right",options:pI.tokens,value:pI.tokens[t],onChange:t=>((e,t)=>{const o=dI({},s);o[t]=pI.tokens.indexOf(e),a(o)})(t,e)})]},e))),Object.keys(c).length?(0,F.jsx)("p",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]]),children:"Text styles"}):null,Object.entries(c).map((([e,t])=>(0,F.jsxs)("div",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]])+" entity",children:[(0,F.jsx)("span",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]]),children:e}),(0,F.jsx)(V.P,{dropdownAnchor:"right",options:pI.textStyles,value:pI.textStyles[t],onChange:t=>((e,t)=>{const o=dI({},c);o[t]=pI.textStyles.indexOf(e),l(o)})(t,e)})]},e)))]}),(0,F.jsxs)("div",{className:v().dynamic([["1187247630",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700]]])+" modal-btns",children:[(0,F.jsx)(j.z,{onClick:o,style:"solid",colorScheme:"neutral",children:"Cancel"}),(0,F.jsx)(j.z,{onClick:()=>{t({classes:i,tokens:s,textStyles:c}),o()},style:"solid",colorScheme:"danger",refAttrs:{autoFocus:!0},children:"Submit"})]}),(0,F.jsx)(v(),{id:"1187247630",dynamic:[N.N_.ONE_AND_HALF,N.N_.UNIT,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.DM.GRAY_700],children:[`.modal-title.__jsx-style-dynamic-selector{margin-bottom:${N.N_.ONE_AND_HALF};}`,".modal-btns.__jsx-style-dynamic-selector{-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}",`.entities-wrapper.__jsx-style-dynamic-selector{padding:${N.N_.UNIT} 0;}`,`.entities-wrapper.__jsx-style-dynamic-selector>p.__jsx-style-dynamic-selector{margin-bottom:${N.N_.UNIT};}`,`.entity.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:${N.N_.HALF_UNIT};-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}`,".entity.__jsx-style-dynamic-selector:last-child,.entity.__jsx-style-dynamic-selector:only-child{margin-bottom:0;}",`.entity.__jsx-style-dynamic-selector>span.__jsx-style-dynamic-selector{margin-left:${N.N_.HALF_UNIT};color:${N.DM.GRAY_700};}`]}),(0,F.jsx)("style",{children:tp.W2})]})},hI=["--dl-color","--dl-size","--dl-space","--dl-radius"],mI=e=>{const t=new Set;return JSON.stringify(e,((e,o)=>(t.add(e),o))),JSON.stringify(e,Array.from(t).sort())};var yI,gI,fI,bI,II,vI,wI,NI,jI,SI,DI,TI,OI,FI,CI,EI,xI,_I,MI,PI,AI,kI,UI,RI,ZI,LI,$I,BI,GI,HI,zI,YI,VI,WI,KI,qI,JI,XI,QI=o(656733);function ev(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function tv(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ev(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ev(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}yI=(0,c.provide)("clipboardFlow"),gI=(0,c.inject)("projectDoc"),fI=(0,c.inject)("projectUIState"),bI=(0,c.inject)("nodeManagementFlow"),II=(0,c.inject)("componentManagementFlow"),vI=(0,c.inject)("uidlToComponentMapper"),wI=(0,c.inject)("sharedbProjectSyncService"),NI=(0,c.inject)("uidlToProjectMapper"),jI=(0,c.inject)("fontsInProjectFlow"),SI=(0,c.inject)("notificationsManagementFlow"),DI=(0,c.inject)("htmlToDomainFlow"),TI=(0,c.inject)("navbarFlow"),OI=(0,c.inject)("rtcFlow"),FI=(0,c.inject)("projectManagementFlow"),CI=(0,c.inject)("modalManagementFlow"),EI=(0,c.inject)("sentryService"),xI=(0,c.inject)("nodeSelectionFlow"),_I=(0,c.inject)("guardsService"),MI=(0,h.G)(g.l.PASTE_UIDL),yI((AI=class{constructor(){(0,i.Z)(this,"projectDoc",kI,this),(0,i.Z)(this,"projectUIState",UI,this),(0,i.Z)(this,"nodeManagementFlow",RI,this),(0,i.Z)(this,"componentManagementFlow",ZI,this),(0,i.Z)(this,"uidlToComponentMapper",LI,this),(0,i.Z)(this,"dbSync",$I,this),(0,i.Z)(this,"uidlToProjectMapper",BI,this),(0,i.Z)(this,"fontsInProjectFlow",GI,this),(0,i.Z)(this,"notificationsManagementFlow",HI,this),(0,i.Z)(this,"htmlToDomainFlow",zI,this),(0,i.Z)(this,"navbarFlow",YI,this),(0,i.Z)(this,"rtcFlow",VI,this),(0,i.Z)(this,"projectManagementFlow",WI,this),(0,i.Z)(this,"modalManagementFlow",KI,this),(0,i.Z)(this,"sentryService",qI,this),(0,i.Z)(this,"nodeSelectionFlow",JI,this),(0,i.Z)(this,"guardsService",XI,this),(0,r.Z)(this,"translationManager",At.K.Instance),(0,r.Z)(this,"uidlToDomainAssetsManager",fl.Instance),(0,r.Z)(this,"prepareInternationalizationForCopy",(e=>{const{availableLanguages:t}=this.projectDoc.internationalization,{mainLanguage:o,translations:n={}}=null!==e&&void 0!==e?e:{};if(!e||!o)return null;let i=null;const r=Object.keys(t).sort((e=>n[e]?-1:1));r.length||r.push(o);const s=r.find((e=>n[e])),a=r.filter((e=>!n[e]));if(null!==a&&void 0!==a&&a.length){const e=a.map((e=>t[e]));this.notificationsManagementFlow.createNotification(d.k$.WARNING,`Some of the translations are not handled in the pasted nodes. Please check the content manually for: ${e.toString()}.`)}return i=r.reduce(((e,t)=>{var i,r,a;e.intlData[t]={};const c=null!==(i=null!==(r=null!==(a=n[t])&&void 0!==a?a:n[null!==s&&void 0!==s?s:""])&&void 0!==r?r:n[o])&&void 0!==i?i:{};return Object.keys(c).forEach((o=>{var n;const i=c[o],r=this.uidlToComponentMapper.mapUIDLsToComponents({uidls:[{uidl:{name:"translation",node:i}}],domainTranslations:null}),s=null===r||void 0===r?void 0:r.nodes.find((e=>!e.parentId));s&&(e.nodesToAdd.push(...null!==(n=null===r||void 0===r?void 0:r.nodes)&&void 0!==n?n:[]),Object.assign(e.intlData[t],{[o]:{type:"hierarchy",content:s.id}}))})),e}),{intlData:{},nodesToAdd:[]}),i}))}pasteCopiedNodes(e,t){var o;if(!t)return;let n=this.projectDoc.nodes.getById(e),i=e,r=null;var s;n&&(t.some((e=>e.primitiveType&&!this.projectDoc.isNodeAcceptingChild({node:n,child:e})))||1===t.length&&t[0].id===e)&&(i=(null===(s=n)||void 0===s?void 0:s.getActualParentId())||e,r=this.projectDoc.nodes.getNextSibling(n),n=this.projectDoc.nodes.getById(i));let a=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(i).compInstanceId;(null===(o=n)||void 0===o?void 0:o.primitiveType)===Zn.sO.SLOT&&(a=this.projectUIState.selection.compInstanceId||void 0),this.nodeManagementFlow.copyNodesToTarget({nodes:t,targetId:i,copyBefore:r,compInstanceId:a})}pasteOnMultipleNodes(e,t){t&&!e.some((e=>-1===t.findIndex((t=>t.id===e))))&&this.nodeManagementFlow.duplicateNodesById({nodeIds:e})}pasteCopiedStyleToTargets(e){const t=this.projectUIState.userInteractions.clipboard.copiedNodes;!t||t.length>1||this.nodeManagementFlow.copyNodeStylesToTargets({source:t[0].id,targets:e})}pasteCopiedClassesStyleToTargets(e){const t=this.projectUIState.userInteractions.clipboard.copiedNodes;!t||t.length>1||this.nodeManagementFlow.copyNodeClassesStylesToTargets({source:t[0].id,targets:e})}async pasteCopiedUIDL(e){var t;const{nodeId:o,elementUIDLs:n,componentUIDLs:i,designTokens:r,textStyles:s,classes:c,designLanguageMergeOptions:l,isConditionalRenderingEnabled:p,globals:u,rawUIDL:h,assetNames:m,aiMapping:y,isForPreview:g}=e,f=null!==(t=e.doc)&&void 0!==t?t:this.projectDoc,b=f.settings.experimentalFeatures&&p||f.settings.experimentalFeatures&&f.settings.experimentalFeatures.conditionalRendering&&p;if(b){const e={experimentalFeatures:tv(tv({},f.settings.experimentalFeatures||{}),{},{conditionalRendering:p})},t=tv(tv({},f.settings),e);g||(this.projectManagementFlow.updateSettings(t),this.notificationsManagementFlow.createNotification(d.k$.INFO,"The following advanced features have been activated:  "+(b?"Conditional Rendering":"")))}let I,v,w=null;if(this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>this.dbSync.mutate(this.projectDoc,(t=>{var n,i,a;I=this.uidlToProjectMapper.solveDesignLanguageConflicts(null!==(n=e.doc)&&void 0!==n?n:t,c,r,s,u,l),v=this.componentManagementFlow.computeTargetToAcceptElement(o,void 0,null!==(i=e.doc)&&void 0!==i?i:t).target,w=t.nodes.getComponentIdOf(null!==(a=v)&&void 0!==a?a:"")})))),!w||!v)return;const N={},j=Object.keys(i).reduce(((e,t)=>(Object.values(f.components.byId).some((e=>(null===e||void 0===e?void 0:e.title)===i[t].name))&&(N[i[t].name]=f.getUniqueCompOrPageName(i[t].name),i[t].name=f.getUniqueCompOrPageName(i[t].name)),e[t]=i[t],e)),{});Object.keys(j).map((e=>{this.replaceDependencyNamesAndDesignLanguage(j[e],N,I)})),n.map((e=>{this.replaceDependencyNamesAndDesignLanguage(e,N,I)}));const S=Object.keys(j).map((e=>({uidl:i[e],validateUIDL:!1}))),D=this.prepareInternationalizationForCopy(u.internationalization),T=this.uidlToComponentMapper.mapUIDLsToComponents({uidls:S,assetNames:m||{},domainTranslations:D}),O=null===T||void 0===T?void 0:T.components,F=n.map((e=>({uidl:e}))),C=this.uidlToComponentMapper.mapUIDLsToComponents({uidls:F,assetNames:m||{},uncommitedComponents:JSON.parse(JSON.stringify(O)),domainTranslations:D});if(!C)return;const E=(0,Xc.i3)(C,T),{tokensInNodes:x,assetFiles:_,textStylesInNodes:M,fontsInNodes:P,fontsToImport:A,classesInNodes:k}=E,U=(null===T||void 0===T?void 0:T.nodes)||[],R=await this.uidlToDomainAssetsManager.uploadAssets(_)||[];(0,a.mutate)(this.projectUIState,(({userInteractions:e})=>{e.clipboard.copiedUIDL=null})),y&&this.addAIGeneratedDataToNodes(C.nodes,y);const Z=[...T?null===T||void 0===T?void 0:T.nodes:[],...C.nodes],L=O.filter((e=>Z.some((t=>{var o,n;return"component-instance-node"===t.type&&t.semanticType===e.title||"meta"in t&&(null===(o=t.meta)||void 0===o||null===(n=o.isPropRoot)||void 0===n?void 0:n.compId)===e.id||t.compIdOfRootNode===e.id&&"component-instance-node"!==t.type})))),$=this.projectDoc.internationalization.enabled;let B=[];g?(0,a.mutate)(this.projectDoc,(t=>{var o;B=this.addNodesToDoc({doc:null!==(o=e.doc)&&void 0!==o?o:t,projectComponents:L,uploadedAssets:R,assetFiles:_,componentsData:T,fontsToImport:A,fontsInNodes:P,tokensInNodes:x,textStylesInNodes:M,classesInNodes:k,componentNodes:U,globals:u,generatedElements:C,rawUIDL:h,targetId:v,internationalizationNodes:$?null===D||void 0===D?void 0:D.nodesToAdd:[]})})):this.dbSync.mutate(this.projectDoc,(t=>{var o,i,r;(B=this.addNodesToDoc({doc:null!==(o=e.doc)&&void 0!==o?o:t,uploadedAssets:R,assetFiles:_,projectComponents:L,componentsData:T,fontsToImport:A,fontsInNodes:P,tokensInNodes:x,textStylesInNodes:M,classesInNodes:k,componentNodes:U,globals:u,generatedElements:C,rawUIDL:h,targetId:v,internationalizationNodes:$?null===D||void 0===D?void 0:D.nodesToAdd:[]}),null!==D&&void 0!==D&&D.intlData&&$&&Object.keys(D.intlData).forEach((e=>{const o=D.intlData[e];Object.keys(o).forEach((n=>{t.internationalization.translations[e][n]=o[n]}))})),0===n.length)&&this.componentManagementFlow.addComponentToSelectedElementPageOrComp({compId:null===(i=O[O.length-1])||void 0===i?void 0:i.id,doc:null!==(r=e.doc)&&void 0!==r?r:t})}));[...new Set(B)].forEach((e=>{this.translationManager.translateNodeInEveryLanguage({nodeId:e})})),(0,a.mutate)(this.projectUIState,(e=>{O.forEach((t=>{if(!t)return void this.sentryService.captureException(new Error("Component was skipped when pasting UIDL"));const{stateDefinitions:o,propDefinitions:n,id:i,instantiatedByNodes:r}=t,s=Object.keys(o).reduce(((t,n)=>{var s,a,c,l;return t[n]={id:n,type:o[n].type,value:o[n].defaultValue,name:o[n].name,meta:{highlightInTreeView:!(null===(s=e.componentList.stateValues)||void 0===s||null===(a=s[i])||void 0===a||null===(c=a[n])||void 0===c||null===(l=c.meta)||void 0===l||!l.highlightInTreeView)},componentInstanceValues:Object.keys(r).reduce(((e,t)=>(e[t]=o[n].defaultValue,e)),{})},t}),{}),a=Object.keys(n).reduce(((t,o)=>{var s,a,c,l;const d=n[o].type;return["string","number","boolean"].includes(d)?(t[o]={id:o,type:n[o].type,value:n[o].defaultValue,name:n[o].name,meta:{highlightInTreeView:!(null===(s=e.componentList.propValues)||void 0===s||null===(a=s[i])||void 0===a||null===(c=a[o])||void 0===c||null===(l=c.meta)||void 0===l||!l.highlightInTreeView)},componentInstanceValues:Object.keys(r).reduce(((e,t)=>(e[t]=n[o].defaultValue,e)),{})},t):t}),{});e.componentList.stateValues[i]=tv(tv({},e.componentList.stateValues[i]),s),e.componentList.propValues[i]=tv(tv({},e.componentList.propValues[i]),a)}))}));const G=this.nodeSelectionFlow.getSelectedNodesIds();var H,z;if(0===n.length&&0===G.length)return this.rtcFlow.notifySelectedComp(null===(H=O[O.length-1])||void 0===H?void 0:H.id),void this.navbarFlow.selectOrCreateTabByEntityId(null===(z=O[O.length-1])||void 0===z?void 0:z.id)}async pasteFromExternalCopyEvent(e){const t=[e],o=await navigator.clipboard.read();this.clearCopiedNodes();const n=o[0];if(!n)return;const i=n.types[1]||n.types[0];if(i){if(i.startsWith("image/")){y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"image/png"});const e=await n.getType(i),o=new FileReader;let r="";return o.onload=e=>{var o;r=null===(o=e.target)||void 0===o?void 0:o.result,this.pasteCopiedUIDL({nodeId:t[0],elementUIDLs:[(0,cI.h)("",r)],componentUIDLs:{},designTokens:{},textStyles:{},globals:{settings:{title:"pastedImage",language:"none"},meta:[],assets:[]}})},void o.readAsDataURL(e)}if("text/plain"===i){const e=await n.getType(i),o=await e.text();try{return void this.pasteRawUIDL(t,o)}catch{try{if(aI()(o))return this.pasteSVG(t,o),void y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"svg"});if((0,Kp.FP)(o))return y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"HTML"}),void this.htmlToDomainFlow.openEditor(o);this.handlePaste(t,o)}catch(r){this.notificationsManagementFlow.createNotification(d.k$.ERROR,"An error has occured when pasting your content."),this.sentryService.captureException(r,{type:Xo.U.CRITICAL})}}}}}pasteRawUIDL(e,t){const o=new nI.Z,n=JSON.parse(t,((e,t)=>{if(null!==t)return t})),i=o.validateComponentSchema(n),{componentUIDL:r,valid:s}=i,a=iI.parseComponentJSON(r),c=(new oI.Z).resolveUIDL(a,{extractedResources:{}});if(s&&c)try{this.notificationsManagementFlow.createNotification(d.k$.INFO,"Pasting the content of your clipboard...");let t=0;if(null!==a&&void 0!==a&&a.stateDefinitions)throw new Error("UIDL with statedefinitions is not yet supported");rI.traverseNodes(a.node,(e=>{const{type:o}=e;if("conditional"===o)throw new Error("Conditional nodes are not supported");"comp-style"!==e.type&&rI.traverseElements(e,(e=>{var o;const{elementType:n,style:i,attrs:r,referencedStyles:s}=e;if(Object.values(i||{}).forEach((e=>{if("dynamic"===e.type)throw new Error("dynamic style is not yet supported")})),Object.values(s||{}).forEach((e=>{"inlined"===e.content.mapType&&Object.values(e.content.styles||{}).forEach((e=>{if("dynamic"===e.type)throw new Error("dynamic style is not yet supported")}))})),"conditional"===n)throw new Error("conditional node in UIDL is not yet supported");if("repeat"===n)throw new Error("reapeat node in UIDL is not yet supported");if("slot"===n){if(t>1)throw new Error("we dont support more than 1 slot node per UIDL component");t+=1}if("component"===n)throw new Error("components in stand alone UIDL is not yet supported");if("import"===(null===r||void 0===r||null===(o=r.referenceType)||void 0===o?void 0:o.type))throw new Error("reference type import is not yet supported for attrs");var a;if("text"===n&&1!==(null===(a=e.children)||void 0===a?void 0:a.length))throw new Error("we only support UIDL text nodes having one exact child")}))})),this.pasteCopiedUIDL({nodeId:e[0],elementUIDLs:[],componentUIDLs:{resolvedUIDL:c},designTokens:{},textStyles:{},globals:{settings:{title:"uidlpaste",language:"none"},meta:[],assets:[]},rawUIDL:!0})}catch(l){this.notificationsManagementFlow.createNotification(d.k$.INFO,"Couldn't import the content of your clipboard... "+l)}}pasteSVG(e,t){var o,n,i,r,s,a;const c=null===t||void 0===t||null===(o=t.split("height"))||void 0===o||null===(n=o[1])||void 0===n||null===(i=n.split('"'))||void 0===i?void 0:i[1],l=null===t||void 0===t||null===(r=t.split("width"))||void 0===r||null===(s=r[1])||void 0===s||null===(a=s.split('"'))||void 0===a?void 0:a[1],d=window.btoa(t);this.pasteCopiedUIDL({nodeId:e[0],elementUIDLs:[(0,cI.h)("data:image/svg+xml;base64,",d,parseInt(l),parseInt(c))],componentUIDLs:{},designTokens:{},textStyles:{},globals:{settings:{title:"pastedImage",language:"none"},meta:[],assets:[]}})}handlePaste(e,t){let o;try{o=JSON.parse(t)}catch(n){return}if(o.nodeIds&&0!==o.nodeIds.length){let t=!1;const n=o.nodeIds.map((e=>{const o=this.projectDoc.nodes.getById(e);return o||(t=!0),o}));if(!t)return e.length>1?void this.pasteOnMultipleNodes(e,n):void this.pasteCopiedNodes(e[0],n)}if(o.nodeIds&&0!==o.nodeIds.length?y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"cross-project-nodes"}):Object.keys(o.components).length?y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"component"}):y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"figma"}),Array.isArray(o.componentUIDLs)){this.projectUIState.userInteractions.clipboard.copiedUIDL=o.componentUIDLs,o.hasImages&&this.notificationsManagementFlow.createNotification(d.k$.INFO,"Import in progress...");const t=this.checkForDesignLanguageConflicts(o.usedClasses,o.usedDesignTokens,o.usedTextStyles);if(t&&(t.classes.length||t.textStyles.length||t.tokens.length)){const n=b.d.createCustomModal({Component:uI,onSubmit:t=>{this.pasteCopiedUIDL({nodeId:e[0],elementUIDLs:o.componentUIDLs,componentUIDLs:o.components,designTokens:o.usedDesignTokens,textStyles:o.usedTextStyles,classes:o.usedClasses,designLanguageMergeOptions:t,isConditionalRenderingEnabled:o.isConditionalRenderingEnabled,isTailwindEnabled:o.isTailwindEnabled,globals:o.globals,assetNames:o.assetNames})},data:{conflicts:t}});this.modalManagementFlow.showModal(n)}else this.pasteCopiedUIDL({nodeId:e[0],elementUIDLs:o.componentUIDLs,componentUIDLs:o.components,designTokens:o.usedDesignTokens,textStyles:o.usedTextStyles,classes:o.usedClasses,isConditionalRenderingEnabled:o.isConditionalRenderingEnabled,isTailwindEnabled:o.isTailwindEnabled,globals:o.globals,assetNames:o.assetNames})}}clearCopiedNodes(){(0,a.mutate)(this.projectUIState,(({userInteractions:e})=>{e.clipboard.copiedNodes=null}))}replaceDependencyNamesAndDesignLanguage(e,t,o){rI.traverseNodes(e.node,(e=>{"comp-style"!==e.type&&rI.traverseElements(e,(e=>{e.semanticType&&t[e.semanticType]&&(e.semanticType=t[e.semanticType]),e.referencedStyles&&(null!==o&&void 0!==o&&o.classes||null!==o&&void 0!==o&&o.textStyles)&&Object.values(e.referencedStyles).forEach((e=>{if("project-referenced"===e.content.mapType){const t=e.content.referenceId;o.classes[t]&&(e.content.referenceId=o.classes[t]),o.textStyles[t]&&(e.content.referenceId=o.textStyles[t])}})),e.style&&Object.values(e.style).forEach((t=>{if(e.style&&"dynamic"===t.type&&"token"===t.content.referenceType&&!hI.filter((e=>e.includes(t.content.id))).length){const e=t.content.id;null!==o&&void 0!==o&&o.tokens[e]&&(t.content.id=o.tokens[e])}}))}))}))}checkForDesignLanguageConflicts(e,t,o){if(!e)return;const n={classes:[],tokens:[],textStyles:[]},i=this.projectDoc.classes.toUIDL(),r=this.projectDoc.designLanguage.getTokensAsCustomProperties(),s=this.projectDoc.designLanguage.textStyleSetsById;return Object.keys(e).forEach((t=>{if(i[t]){const o=i[t],r=e[t];mI(o)!==mI(r)&&n.classes.push(t)}})),Object.values(r).forEach((e=>{t[e.name]&&t[e.name].content!==e.value&&n.tokens.push(e.name)})),Object.values(s).forEach((e=>{const t=(0,dr.hN)(e.name);o[t]&&mI(e.toUIDL().content)!==mI(o[t].content)&&n.textStyles.push(t)})),n}addNodesToDoc(e){const{doc:t,projectComponents:o,componentsData:n,assetFiles:i,uploadedAssets:r,fontsToImport:s,fontsInNodes:a,textStylesInNodes:c,tokensInNodes:l,classesInNodes:d,componentNodes:p,internationalizationNodes:u=[],globals:h,rawUIDL:m,generatedElements:y,targetId:g}=e;var f,b;h.customCode&&(t.settings.code={headTag:null===(f=h.customCode)||void 0===f?void 0:f.head,bodyTag:null===(b=h.customCode)||void 0===b?void 0:b.body});const I=[];let v,w,N,j=o.some((e=>Object.keys(e.stateDefinitions).length));o.forEach((e=>{const o=t.addComponent({component:e,folderId:"components"});Object.values((null===n||void 0===n?void 0:n.propDefinitions[e.id])||{}).forEach((e=>{"rootClassName"===e.name&&(e.hidden=!0),null===o||void 0===o||o.createPropDefinition(tv({},e))}))})),Object.keys(s).forEach((e=>{const o=this.fontsInProjectFlow.importGoogleFont({doc:t,fontName:s[e].replaceAll('"',"")}),n=Object.keys(this.projectDoc.fonts.byId).find((e=>this.projectDoc.fonts.byId[e].name===o));n&&(a[n]?a[n].push(e):a[n]=[e])})),u.forEach((e=>{e.compIdOfRootNode=null,t.addNode(e)})),p.forEach((e=>{var o,n;if(e.primitiveType===Zn.sO.COMPONENT&&(e.semanticType=null),e.compIdOfRootNode){t.components.byId[e.compIdOfRootNode]||(e.compIdOfRootNode=null)}let i=null;const r=p.find((t=>t.id===e.parentId)),s="element-node"===(null===r||void 0===r?void 0:r.type)&&"fragment"===r.primitiveType&&((null===(o=r.meta)||void 0===o?void 0:o.isPropRoot)||(null===(n=r.meta)||void 0===n?void 0:n.isAttributeRoot));if("element-node"===e.type&&s){var a,c;const t=Object.keys(null!==(a=e.contentChildren)&&void 0!==a?a:{})[0],o=null===(c=e.contentChildren)||void 0===c?void 0:c[t];"static"===(null===o||void 0===o?void 0:o.type)&&(i=o.content)}i&&e.parentId&&t.internationalization.enabled?(t.addNodesToParentOrStage({nodes:[e],parentId:e.parentId,nextSibling:void 0,keepOriginalParent:!0,allowDefaultPropsCreation:!1}),I.push(e.id)):t.addNode(e),"renderingConditions"in e&&e.renderingConditions&&(j||(j=!0))})),m&&(null===n||void 0===n||n.components.forEach((e=>{this.componentManagementFlow.addComponentToSelectedElementPageOrComp({compId:e.id,doc:t})}))),y.components.forEach((e=>{const t=e.rootNodeId,o=y.nodes.find((e=>e.id===t));o&&(o.parentId=g)})),y.nodes.forEach((e=>{var o,n;e.id===v&&(e.parentId=null,e.slotId=w,e.compInstanceId=N),e.compIdOfRootNode=null,"fakeSize"in e&&(e.fakeSize=!1);const i=t.nodes.nodeIsCompInstance(e);if(i){const o=Object.keys(t.components.byId).find((o=>{const n=t.components.byId[o];return(null===n||void 0===n?void 0:n.title)===e.semanticType||(null===n||void 0===n?void 0:n.id)===e.compIdOfCompInstance}));if(!o)throw new Error("Trying to add an instance of a nonexisting component!");e.compIdOfCompInstance=o;const n=t.components.byId[o];if(n&&(n.instantiatedByNodes[e.id]=!0,e.semanticType=null,n.slots&&Object.keys(n.slots).length>0&&Object.keys(e.childrenIds).length>0)){const t={};t[Object.keys(e.childrenIds)[0]]=!0,e.slottedNodes[Object.keys(n.slots)[0]]=t,v=Object.keys(e.childrenIds)[0],w=Object.keys(n.slots)[0],N=e.id,e.childrenIds={}}}let r=null;const s=y.nodes.find((t=>t.id===e.parentId)),a="element-node"===(null===s||void 0===s?void 0:s.type)&&"fragment"===s.primitiveType&&((null===(o=s.meta)||void 0===o?void 0:o.isPropRoot)||(null===(n=s.meta)||void 0===n?void 0:n.isAttributeRoot));if("element-node"===e.type&&a){var c,l;const t=Object.keys(null!==(c=e.contentChildren)&&void 0!==c?c:{})[0],o=null===(l=e.contentChildren)||void 0===l?void 0:l[t];"static"===(null===o||void 0===o?void 0:o.type)&&(r=o.content)}if(r&&e.parentId&&t.internationalization.enabled)t.addNodesToParentOrStage({nodes:[e],parentId:e.parentId,nextSibling:void 0,keepOriginalParent:!0,allowDefaultPropsCreation:!1}),I.push(e.id);else if(y.components.find((t=>t.rootNodeId===e.id))&&!i){t.addNodesToParentOrStage({nodes:[e],parentId:g,nextSibling:void 0});const o=null!==u&&void 0!==u&&u.length?null:this.getNodeThatNeedsToBeTranslated(t,e,g);o&&I.push(o)}else if("date-time-node"!==e.type&&"cms-collection-list-node"!==e.type&&"cms-collection-item-node"!==e.type||e.parentId){t.addNode(e);const o=null!==u&&void 0!==u&&u.length?null:this.getNodeThatNeedsToBeTranslated(t,e,g);o&&I.push(o)}else t.addNodesToParentOrStage({nodes:[e],parentId:g,nextSibling:void 0})}));const S=t.getComponentIdForNode(g);let D={};D[S]=Object.values(y.sectionIds).flat(1),D=tv(tv({},D),null===n||void 0===n?void 0:n.sectionIds),(0,Xc.cT)({doc:t,sectionIds:D,sentryService:this.sentryService});let T={};return T[S]=Object.values(y.usedComponents).flat(1),T=tv(tv({},T),null===n||void 0===n?void 0:n.usedComponents),(0,Xc.ng)({doc:t,usedComponents:T,sentryService:this.sentryService}),Object.keys(l).forEach((e=>{l[e].forEach((o=>{const n=t.designLanguage.tokensById[e].usedInNodes[o];t.designLanguage.tokensById[e].usedInNodes[o]=n?n+1:1}))})),Object.keys(c).forEach((e=>{c[e].forEach((o=>{t.designLanguage.textStyleSetsById[e].usedInNodes[o]=!0}))})),Object.keys(d).forEach((e=>{d[e].forEach((o=>{const n=t.classes.byId[e];"simple"===n.classType&&(n.usedInNodes[o]=!0)}))})),Object.keys(a).forEach((e=>{a[e].forEach((o=>{const n=t.fonts.byId[e].usedInNodes[o];t.fonts.byId[e].usedInNodes[o]=n?n+1:1}))})),this.uidlToDomainAssetsManager.linkAssetsToNodesOrProps({doc:t,initialAssets:i,uploadedAssets:r}),j&&this.activateConditionalRendering(t),I}activateConditionalRendering(e){var t;null!==(t=e.settings.experimentalFeatures)&&void 0!==t&&t[_r.QR.CONDITIONAL_RENDERING]||(e.settings.experimentalFeatures={[_r.QR.CONDITIONAL_RENDERING]:!0},this.notificationsManagementFlow.createNotification(d.k$.INFO,"Conditional rendering is now enabled in your project."))}addAIGeneratedDataToNodes(e,t){e.forEach((e=>{if(e.primitiveType===Zn.sO.TEXT||e.primitiveType===Zn.sO.BUTTON){var o,n,i;if(null!==(o=e.name)&&void 0!==o&&o.includes("Logo")){const o=t.Logo;return void(o&&(Object.values(e.contentChildren)[0].content=o))}if(null!==(n=e.name)&&void 0!==n&&n.includes("Nav")){const o=t.navigation[e.name];return void(o&&(Object.values(e.contentChildren)[0].content=o.name))}if(null!==(i=e.name)&&void 0!==i&&i.includes("PlanFeatures")){var r,s,a;if(null!==(r=e.name)&&void 0!==r&&r.includes("Free")){const o=t.FreePlanFeatures.shift();return void(o&&(Object.values(e.contentChildren)[0].content=o))}if(null!==(s=e.name)&&void 0!==s&&s.includes("Basic")){const o=t.BasicPlanFeatures.shift();return void(o&&(Object.values(e.contentChildren)[0].content=o))}if(null!==(a=e.name)&&void 0!==a&&a.includes("Pro")){const o=t.ProPlanFeatures.shift();return void(o&&(Object.values(e.contentChildren)[0].content=o))}}const c=t[e.name];if(c)return void(Object.values(e.contentChildren)[0].content=c)}if(e.primitiveType===Zn.sO.COMPONENT){var c,l,d;if(null!==(c=e.name)&&void 0!==c&&c.includes("FeatureCard")){const o=t.Features.shift();if(!o)return;e.attrs[pi.createStateOrPropStoringValue("Heading")].content=o.Heading,e.attrs[pi.createStateOrPropStoringValue("SubHeading")].content=o.SubHeading}if(null!==(l=e.name)&&void 0!==l&&l.includes("Question")){const o=t.Questions.shift();if(!o)return;e.attrs[pi.createStateOrPropStoringValue("Question")].content=o.Question,e.attrs[pi.createStateOrPropStoringValue("Answer")].content=o.Answer}if(null!==(d=e.name)&&void 0!==d&&d.includes("GalleryImage")){const o=t.Images.pop();if(!o)return;e.attrs[pi.createStateOrPropStoringValue("image_src")].content=o}}var p;if(e.primitiveType===Zn.sO.IMAGE&&(null!==(p=e.name)&&void 0!==p&&p.includes("DetailsImage"))){const o=t[e.name].pop();if(!o)return;return void(e.attrs.src.content=o)}}))}getNodeThatNeedsToBeTranslated(e,t,o){var n;if(!("contentChildren"in t))return null;const i=null===(n=Object.values(t.contentChildren||{}))||void 0===n?void 0:n[0];if("dynamic"===(null===i||void 0===i?void 0:i.type)&&"prop"===i.content.referenceType){var r,s,a,c,l;let n=t.compIdOfRootNode;if(!n){const t=e.nodes.getById(o);null!==t&&void 0!==t&&t.compIdOfRootNode&&(n=t.compIdOfRootNode)}n=null!==(r=n)&&void 0!==r?r:this.projectUIState.selection.componentId;const d=e.components.byId[null!==(s=n)&&void 0!==s?s:""];if(!d)return null;const p=d.propDefinitions[i.content.id];if(!p)return null;if("richtext"!==p.type)return null;const u=e.nodes.getById(null!==(a=p.defaultHierarchyRootId)&&void 0!==a?a:"");if(!u||!("childrenIds"in u))return null;const h=null===(c=Object.keys(null!==(l=u.childrenIds)&&void 0!==l?l:{}))||void 0===c?void 0:c[0],m=e.nodes.getById(null!==h&&void 0!==h?h:"");return(null===m||void 0===m?void 0:m.id)||null}return t.id}},kI=(0,s.Z)(AI.prototype,"projectDoc",[gI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UI=(0,s.Z)(AI.prototype,"projectUIState",[fI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RI=(0,s.Z)(AI.prototype,"nodeManagementFlow",[bI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZI=(0,s.Z)(AI.prototype,"componentManagementFlow",[II],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LI=(0,s.Z)(AI.prototype,"uidlToComponentMapper",[vI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$I=(0,s.Z)(AI.prototype,"dbSync",[wI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=(0,s.Z)(AI.prototype,"uidlToProjectMapper",[NI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GI=(0,s.Z)(AI.prototype,"fontsInProjectFlow",[jI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HI=(0,s.Z)(AI.prototype,"notificationsManagementFlow",[SI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zI=(0,s.Z)(AI.prototype,"htmlToDomainFlow",[DI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YI=(0,s.Z)(AI.prototype,"navbarFlow",[TI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VI=(0,s.Z)(AI.prototype,"rtcFlow",[OI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WI=(0,s.Z)(AI.prototype,"projectManagementFlow",[FI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KI=(0,s.Z)(AI.prototype,"modalManagementFlow",[CI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qI=(0,s.Z)(AI.prototype,"sentryService",[EI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JI=(0,s.Z)(AI.prototype,"nodeSelectionFlow",[xI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XI=(0,s.Z)(AI.prototype,"guardsService",[_I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(AI.prototype,"pasteCopiedUIDL",[MI],Object.getOwnPropertyDescriptor(AI.prototype,"pasteCopiedUIDL"),AI.prototype),PI=AI));var ov,nv,iv,rv,sv,av,cv,lv,dv,pv,uv,hv,mv,yv,gv,fv,bv,Iv,vv,wv,Nv,jv=o(897755),Sv=o(285835),Dv=o(223924);function Tv(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Ov(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Tv(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Tv(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}ov=(0,c.provide)("mainInspectorFlow"),nv=(0,c.inject)("projectUIState"),iv=(0,c.inject)("projectDoc"),rv=(0,c.inject)("sharedbProjectSyncService"),sv=(0,c.inject)("nodeStyleManagmentFlow"),av=(0,c.inject)("nodeRichTextFlow"),cv=(0,c.inject)("assetsEditFlow"),lv=(0,c.inject)("mediaQueryBreakpointManagementFlow"),dv=(0,c.inject)("positioningService"),pv=(0,c.inject)("nodeSelectionFlow"),ov((hv=class{constructor(){(0,i.Z)(this,"projectUIState",mv,this),(0,i.Z)(this,"projectDoc",yv,this),(0,i.Z)(this,"dbSync",gv,this),(0,i.Z)(this,"nodeStyleManagmentFlow",fv,this),(0,i.Z)(this,"nodeRichTextFlow",bv,this),(0,i.Z)(this,"assetsEditFlow",Iv,this),(0,i.Z)(this,"mediaQueryBreakpointManagementFlow",vv,this),(0,i.Z)(this,"positioningService",wv,this),(0,i.Z)(this,"nodeSelectionFlow",Nv,this),(0,r.Z)(this,"handleMultipleActions",(e=>{this.dbSync.mutate(this.projectDoc,(t=>{e(t)}))})),(0,r.Z)(this,"handleChangeInteractionState",((e,t)=>{(0,a.mutate)(this.projectUIState,(o=>{o.stage.setInteractionState(e,t)}))})),(0,r.Z)(this,"shouldRenderSectionForNodes",((e,t)=>this.getInspectorSectionsForNodes(t||[]).includes(e))),(0,r.Z)(this,"getInspectorSectionsForNodes",(e=>{const{staticNodeInterationsData:t}=this.projectUIState,o=this.projectUIState.selection.compInstanceId,n={};let i=!1;return e.forEach((e=>{const r=this.projectDoc.nodes.getById(e),s=this.projectDoc.nodes.getById((null===r||void 0===r?void 0:r.parentId)||"");i=(null===s||void 0===s?void 0:s.primitiveType)===Zn.sO.FRAGMENT;const a=!!this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e).slotId;if(o&&e!==o&&!a)return n[Zn.sO.COMPONENT]=[Dv.bQ.COMPONENT_PROPS],(t.selectionStyles||t.activeSelection)&&(n[Zn.sO.COMPONENT]=Dv.mX),(0,ni.V3)(Object.values(n));const c=null===r||void 0===r?void 0:r.primitiveType;if(c&&!n[c]&&(n[c]=r.getInspectorSectionsForNode().filter((e=>t.selectionStyles||t.activeSelection?Dv.mX.includes(e):!i||e!==Dv.bQ.POSITION)),"element-node"===(null===r||void 0===r?void 0:r.type)&&"icon"===c)){var l;const e=Object.keys(r.childrenIds)[0],t=this.projectDoc.nodes.getById(e);if("element-node"===(null===t||void 0===t?void 0:t.type)&&null!==(l=t.meta)&&void 0!==l&&l.isIconFromHierarchy){n[c].push(Dv.bQ.TEXT_COLOR);const e=n[c].indexOf(Dv.bQ.BACKGROUND);-1!==e&&n[c].splice(e,1)}}})),(0,ni.V3)(Object.values(n))})),(0,r.Z)(this,"getSelectorsListForProperties",((e,t)=>{const o=t||this.nodeSelectionFlow.getSelectedNodesIds()[0],n=this.projectDoc.nodes.getById(o);if(!n)return[];const i=[`nodes/byId/${o}/styles`,`nodes/byId/${o}/styles/*`,`nodes/byId/${o}/styles/*/disabled`,`nodes/byId/${o}/referencedStyles`,`nodes/byId/${o}/referencedStyles/*`,`nodes/byId/${o}/referencedStyles/*/content/*/disabled`,`classes/byId/*/usedInNodes/${o}`,"classes/byId/*/content","classes/byId/*/content/*","classes/byId/*/content/*/disabled","classes/byId/*/conditions","classes/byId/*/conditions/*","classes/byId/*/conditions/*/content/*","classes/byId/*/conditions/*/content/*/disabled","classes/byId/*/linkedTextStyles","classes/byId/*/linkedTextStyles/*"],r=(0,tl.kd)(n,lr.Q),s=this.projectDoc.nodes.nodeIsCompInstance(n);return s&&i.push(`components/byId/${n.compIdOfCompInstance}/styleSetDefinitions/${null!==r&&void 0!==r?r:lr.Q}/referencedStyles/*`),e.reduce(((e,t)=>(e.push(`nodes/byId/${o}/styles/${t}`,`nodes/byId/${o}/referencedStyles/*/content/styles/${t}`),s&&e.push(`components/byId/${n.compIdOfCompInstance}/styleSetDefinitions/${null!==r&&void 0!==r?r:lr.Q}/styles/${t}`,`components/byId/${n.compIdOfCompInstance}/styleSetDefinitions/${null!==r&&void 0!==r?r:lr.Q}/referencedStyles/*/content/styles/${t}`),e)),i)})),(0,r.Z)(this,"haveStylePropertiesChangedInPatches",((e,t)=>{for(const o of e){const{op:e,pathArray:n,value:i,old:r}=o;if("replace"===e&&4===n.length&&("styles"===n[3]||"referencedStyles"===n[3]))return!0;if("replace"===e&&(5===n.length&&t.includes(n[4])||8===n.length&&t.includes(n[7])))return!0;if(("add"===e||"remove"===e)&&5===n.length&&t.includes(n[4]))return!0;if(("add"===e||"remove"===e)&&8===n.length&&t.includes(n[7]))return!0;if("add"===e&&5===n.length&&"referencedStyles"===n[3]){if("inlined"===i.content.mapType&&t.includes(Object.keys(i.content.styles)[0]))return!0;if("design-language-referenced"===i.content.mapType||"project-referenced"===i.content.mapType)return!0}if("remove"===e&&5===n.length&&"referencedStyles"===n[3]){if(!i)return!0;if("inlined"===i.content.mapType&&t.includes(Object.keys(r.content.styles)[0]))return!0}if("components"===n[0]&&"styleSetDefinitions"===n[3])return!0;if("classes"===n[0]&&["usedInNodes","content","conditions","linkedTextStyles"].includes(n[3]))return!0;if(n.includes("disabled"))return!0}return!1})),(0,r.Z)(this,"getStatesOptionsForSelectedNodes",(e=>{const t=this.nodeSelectionFlow.getSelectedNodesIds();return Object.keys(ar.F).filter((o=>!e.includes(o)&&(o===ar.F.checked?t.every((e=>{const t=this.projectDoc.nodes.getById(e);return(null===t||void 0===t?void 0:t.primitiveType)&&t.primitiveType!==Zn.sO.DEV_COMPONENT&&[Zn.sO.CHECKBOX,Zn.sO.RADIOBUTTON].includes(t.primitiveType)})):o!==ar.F.disabled||t.every((e=>{var t;const o=this.projectDoc.nodes.getById(e);return(null===o||void 0===o?void 0:o.primitiveType)&&(null===(t=or.$F[o.primitiveType])||void 0===t?void 0:t.find((e=>"disabled"===e.name)))})))))})),(0,r.Z)(this,"getSelectedNodesParentStyle",(e=>{const t=this.nodeSelectionFlow.getSelectedNodesIds();if(!t)return{};let o={};return t.forEach(((t,n)=>{const i=this.projectDoc.nodes.getById(t);if(!i||!i.parentId)return;const{styles:r,inheritedStyles:s,classesStyles:a,inheritedClassesStyles:c}=this.nodeStyleManagmentFlow.getComputedStyleByKeyForCurrentBreakpoint(i.parentId,e,!0),l=Ov(Ov(Ov(Ov({},c),s),a),r);if(0===n)o=l;else for(const e in l)r[e]!==o[e]&&(o[e]=Zn.sO.MIXED)})),o})),(0,r.Z)(this,"setFocusedBgImgIndex",(e=>{this.projectUIState.userInteractions.focusedBgImgIndex!==e&&(0,a.mutate)(this.projectUIState,(t=>{t.userInteractions.focusedBgImgIndex=e}))})),(0,r.Z)(this,"getOptionsNodesForSelectNode",(e=>{const t=this.projectDoc.nodes.getById(e);if(!t||t.primitiveType!==Zn.sO.SELECT)return[];const o=this.projectDoc.nodes.getById(e),n=o&&"childrenIds"in o?o.childrenIds:null;if(!n)return[];const i=Object.keys(n).reduce(((e,t)=>{var o,n,i;const r=this.projectDoc.nodes.getById(t),s=r.contentChildren&&(null===(o=Object.values(r.contentChildren))||void 0===o?void 0:o[0]),a="static"===(null===s||void 0===s?void 0:s.type)?s.content.toString():"";return e[t]={id:r.id,value:"static"===(null===(n=r.attrs)||void 0===n||null===(i=n.value)||void 0===i?void 0:i.type)?r.attrs.value.content.toString():"",content:a,pos:r.pos},e}),{});return this.positioningService.orderEntities({entitiyCollection:i}).reduce(((e,t)=>(e.push(i[t]),e)),[])})),(0,r.Z)(this,"getSelectorsForSelectElement",(e=>{const t=this.projectDoc.nodes.getById(e);if(!t)return[];const o=[`nodes/byId/${e}/childrenIds/*`];return"childrenIds"in t&&Object.keys(t.childrenIds).forEach((e=>{o.push(`nodes/byId/${e}/attrs`,`nodes/byId/${e}/attrs/value`,`nodes/byId/${e}/attrs/pos`,`nodes/byId/${e}/contentChildren/**`,`nodes/byId/${e}/contentChildren`)})),o})),this.handleChangeProperty=this.handleChangeProperty.bind(this),this.handleRemoveProperty=this.handleRemoveProperty.bind(this)}handleChangeProperty(e){const{key:t,value:o,tokenId:n,doc:i,nodeIds:r,overrideInheritedValue:s,removeExistingValueForText:a}=e,c=r||(Object.keys(this.projectUIState.staticNodeInterationsData.editingNodeInstanceId||{}).length?this.nodeSelectionFlow.getSelectedDependentNodeIds():this.nodeSelectionFlow.getSelectedNodesIds()),l=1===c.length?this.nodeRichTextFlow.getTextComponentForNode(c[0]):null;if(null!==l&&void 0!==l&&l.handleFormatChange){const e={value:o};return n&&Object.assign(e,{tokenId:n}),void l.handleFormatChange({styles:{[t]:e}})}let{textElements:d,nonTextElements:p}=this.groupNodeIdsByPrimitiveType(c);if("fontFamily"===t&&(p=p.concat(d),d=[]),!o&&p.length){const o=this.checkDeleteOrOverrideValue({key:t,overrideInheritedValue:s,nodeIds:p});return null!==o&&void 0!==o&&o.action&&"delete"!==o.action?void("override"===(null===o||void 0===o?void 0:o.action)&&this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint(Ov(Ov({},e),{},{value:s,nodeIds:p}))):void this.handleRemoveProperty({doc:i,key:t,nodeIds:p})}if(o&&p.length){var u;const e=(null===(u=this.assetsEditFlow.getAssetBySrc(o.toString()))||void 0===u?void 0:u.id)||o;this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({nodeIds:p,key:t,value:e,tokenId:n,doc:i})}d.length&&this.handleChangePropertyForTextElements(Ov(Ov({},e),{},{nodeIds:d,removeExistingValueForText:a}))}handleChangePropertyForTextElements(e){const{key:t,value:o,tokenId:n,doc:i,nodeIds:r,removeExistingValueForText:s}=e,a={value:o,mergeable:"textDecoration"===t};n&&(a.tokenId=n),o?this.nodeRichTextFlow.updateRootNodesFormat({doc:i,nodeIds:r,options:{styles:{[t]:a}},removeFormatIfExists:s}):this.nodeRichTextFlow.removeRootNodesConflictingFormats({doc:i,nodeIds:r,options:{styles:{[t]:a}}})}checkDeleteOrOverrideValue(e){const{key:t,overrideInheritedValue:o,nodeIds:n}=e,i=this.nodeSelectionFlow.getSelectedNodesIds();if(!o)return{};const r=t.includes("margin")?"margin":t.includes("padding")?"padding":null,s=[t];r&&s.push(r);const a=this.getSectionStyleWithBreakpointForNodeIds(null!==n&&void 0!==n&&n.length?n:i,s);return Object.values(null===a||void 0===a?void 0:a.inheritedStyles).find((e=>e))?a.styles[t]===o?{action:"delete"}:{action:"override"}:{}}handleRemoveProperty(e){const{key:t,doc:o,nodeIds:n,basedOnBreakpoint:i=!0}=e,r=n||(Object.keys(this.projectUIState.staticNodeInterationsData.editingNodeInstanceId||{}).length?this.nodeSelectionFlow.getSelectedDependentNodeIds():this.nodeSelectionFlow.getSelectedNodesIds()),s=1===r.length?this.nodeRichTextFlow.getTextComponentForNode(r[0]):null;s?s.removeFormatProperty(t):i?this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({nodeIds:r,key:t,doc:o}):this.nodeStyleManagmentFlow.removeStyleByKey({nodeIds:r,key:t,doc:o})}resetValuesToPreviousBreakpoint(e){this.handleMultipleActions((t=>{Dv.vj[e].forEach((e=>{this.handleRemoveProperty({doc:t,key:e})}))}))}handleRemoveInteractionStateForSelectedNodes(e){const t=this.nodeSelectionFlow.getSelectedNodesIds();(0,a.mutate)(this.projectUIState,(t=>{t.stage.interactionState.state===e&&t.stage.setInteractionState(null)})),this.nodeStyleManagmentFlow.removeInteractionStateStyles({nodeIds:t,interactionState:e})}createStateInteractionForSelectedNodes(e){const t=this.nodeSelectionFlow.getSelectedNodesIds();this.nodeStyleManagmentFlow.createInteractionState({nodeIds:t,interactionState:e})}getAllInteractionStatesForSelectedNodes(){const e=this.nodeSelectionFlow.getSelectedNodesIds();return this.nodeStyleManagmentFlow.getAllInteractionStates(e)}getTokenOptionsForKey(e){const t=Object.values((0,jv.F)(Object.values(this.projectDoc.designLanguage.tokensById).map((e=>Ov(Ov({},e),{},{categoryName:this.projectDoc.designLanguage.categoriesById[e.categoryId].name}))))).flat();return(0,Sv.Jw)(e,t)}getHeadingHighlightColor(e,t){const o=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery();return t?N.DM.PURPLE_500:e&&e<=(null===o||void 0===o?void 0:o.maxWidth)?N.DM.ACCENT_500:void 0}getSectionStyleWithBreakpointForSelectedNodes(e){const t=this.nodeSelectionFlow.getSelectedNodesIds(),o=this.projectUIState.staticNodeInterationsData.selectionStyles;return o||this.getSectionStyleWithBreakpointForNodeIds(t,e)}getSectionStyleWithBreakpointForNodeIds(e,t){let o,n,i={},r={},s={},a={},c=!1;return e.forEach(((e,l)=>{const d=this.nodeStyleManagmentFlow.getComputedStyleByKeyForCurrentBreakpoint(e,t,!0),{styles:p,classesStyles:u,inheritedClassesStyles:h,breakpointForStyles:m,interactionStateStyles:y,anyKeyHasValueOnBiggerMQ:g}=d;let{inheritedStyles:f}=d;const b=this.nodeStyleManagmentFlow.getDefaultStylesForNodeByType(e),I=this.nodeStyleManagmentFlow.getInheritedStylesBasedOnCurrentBreakpoint(e);if(!c&&g&&(c=g),f=Ov(Ov({},I),f),0===l)i=p,r=f,s=b,a=Ov(Ov({},h),u);else{for(const e of[...Object.keys(i),...Object.keys(p)])p[e]!==i[e]&&(i[e]=Zn.sO.MIXED);for(const e of[...Object.keys(r),...Object.keys(f)])f[e]!==r[e]&&(r[e]=Zn.sO.MIXED);for(const e of[...Object.keys(a),...Object.keys(u),...Object.keys(h)])(u[e]||h[e])!==a[e]&&(a[e]=Zn.sO.MIXED);for(const e of[...Object.keys(s),...Object.keys(b)])b[e]!==s[e]&&(s[e]=Zn.sO.MIXED)}o=m,n=y})),{styles:i,inheritedStyles:r,defaultStyles:s,breakpointForStyles:o,sectionHasInheritedValues:c,interactionStateStyles:n,classesStyles:a}}groupNodeIdsByPrimitiveType(e){return e.map((e=>this.projectDoc.nodes.getById(e))).reduce(((e,t)=>((null===t||void 0===t?void 0:t.primitiveType)&&(0,ni.yE)(t)?e.textElements.push(null===t||void 0===t?void 0:t.id):e.nonTextElements.push(null===t||void 0===t?void 0:t.id),e)),{textElements:[],nonTextElements:[]})}},mv=(0,s.Z)(hv.prototype,"projectUIState",[nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yv=(0,s.Z)(hv.prototype,"projectDoc",[iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gv=(0,s.Z)(hv.prototype,"dbSync",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fv=(0,s.Z)(hv.prototype,"nodeStyleManagmentFlow",[sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bv=(0,s.Z)(hv.prototype,"nodeRichTextFlow",[av],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv=(0,s.Z)(hv.prototype,"assetsEditFlow",[cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vv=(0,s.Z)(hv.prototype,"mediaQueryBreakpointManagementFlow",[lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wv=(0,s.Z)(hv.prototype,"positioningService",[dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv=(0,s.Z)(hv.prototype,"nodeSelectionFlow",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(hv.prototype,"handleChangeProperty",[m.P],Object.getOwnPropertyDescriptor(hv.prototype,"handleChangeProperty"),hv.prototype),(0,s.Z)(hv.prototype,"handleChangePropertyForTextElements",[m.P],Object.getOwnPropertyDescriptor(hv.prototype,"handleChangePropertyForTextElements"),hv.prototype),(0,s.Z)(hv.prototype,"handleRemoveProperty",[m.P],Object.getOwnPropertyDescriptor(hv.prototype,"handleRemoveProperty"),hv.prototype),uv=hv));var Fv,Cv,Ev,xv,_v,Mv,Pv,Av,kv,Uv,Rv,Zv,Lv,$v,Bv;Fv=(0,c.provide)("temporaryStyleFlow"),Cv=(0,c.inject)("projectDoc"),Ev=(0,c.inject)("nodeStyleManagmentFlow"),xv=(0,c.inject)("nodeSelectionFlow"),_v=(0,c.inject)("projectUIState"),Mv=(0,c.inject)("sharedbProjectSyncService"),Pv=(0,c.inject)("mediaQueryBreakpointManagementFlow"),Fv((kv=class{constructor(){(0,i.Z)(this,"projectDoc",Uv,this),(0,i.Z)(this,"nodeStyleManagmentFlow",Rv,this),(0,i.Z)(this,"nodeSelectionFlow",Zv,this),(0,i.Z)(this,"projectUIState",Lv,this),(0,i.Z)(this,"dbSync",$v,this),(0,i.Z)(this,"mediaQueryBreakpointManagementFlow",Bv,this),(0,r.Z)(this,"getValuesFromTempStyle",(e=>{let t,o;return this.nodeSelectionFlow.getSelectedNodesIds().forEach(((n,i)=>{const{style:r,inheritedStyle:s}=this.getComputedTempStyleByKeyForCurrentBreakpoint(n,e);0===i?(t=r,o=s):(t!==r&&(t=Zn.sO.MIXED),o!==s&&(o=Zn.sO.MIXED))})),{style:t,inheritedStyle:o}})),(0,r.Z)(this,"getComputedTempStyleByKeyForCurrentBreakpoint",((e,t)=>{let o,n;const i=this.projectDoc.nodes.getById(e);if(!i||!("tempStyles"in i))return{style:o,inheritedStyle:n};const r=this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:i.tempStyles}),s=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery();if(s.isDefault)o=r[t];else{let e,a;i.getInlineMatchedStyleSetIds(s.maxWidth,!0).forEach((c=>{const l=i.tempInlineStyles[c];if(!e){const o=this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:l.content.styles})[t];o&&(e=o,a=l.content.conditions[0].maxWidth)}a===s.maxWidth?o=e||r[t]:n=e||r[t]})),!n&&r[t]&&(n=r[t])}return{style:o,inheritedStyle:n}})),(0,r.Z)(this,"getValueOrTokenIdFromStyle",(e=>{if(!e)return{value:""};if("static"===e.type){if("string"!==typeof e.content&&"number"!==typeof e.content)throw new Error("The value was not a string or number. This case is not supported yet and might require a re-write of the rendering system.");return{value:e.content}}if("token"===e.content.referenceType)return{value:"",tokenId:e.content.id};throw new Error("Dynamic props not supported in temp styles")})),this.retrievePropertiesFromTempStyle=this.retrievePropertiesFromTempStyle.bind(this),this.movePropertiesToTempStyle=this.movePropertiesToTempStyle.bind(this)}retrievePropertiesFromTempStyle(e){const{properties:t,doc:o,nodeIds:n}=e;if(!o)return;const i=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery();(n||this.nodeSelectionFlow.getSelectedNodesIds()).forEach((e=>{const n=o.nodes.getById(e);if(!n)return;if(!("tempStyles"in n))return;if(i.isDefault){for(const i of t){const{value:t,tokenId:r}=this.getValueOrTokenIdFromStyle(n.tempStyles[i]);t||r?this.nodeStyleManagmentFlow.setStyleByKey({doc:o,nodeIds:[e],key:i,value:t,tokenId:r}):this.nodeStyleManagmentFlow.removeStyleByKey({doc:o,nodeIds:[e],key:i}),delete n.tempStyles[i]}return}let r=this.getNodeStyleMap({nodeId:e,doc:o,matchedBreakpoint:i.maxWidth}),s=!1;r&&"inlined"===r.content.mapType||(r={type:"style-map",id:(0,ni.Ox)(),content:{mapType:"inlined",conditions:[{conditionType:"screen-size",maxWidth:i.maxWidth}],styles:{}}},s=!0);const a=Object.values(n.tempInlineStyles).find((e=>e.content.conditions.find((e=>"screen-size"===e.conditionType&&e.maxWidth===i.maxWidth))));if(a){for(const n of t){const{value:t,tokenId:r}=this.getValueOrTokenIdFromStyle(null===a||void 0===a?void 0:a.content.styles[n]);t||r?this.nodeStyleManagmentFlow.setConditionalInlineStyleByKey({doc:o,nodeIds:[e],key:n,value:t,tokenId:r,condition:{conditionType:"screen-size",maxWidth:i.maxWidth}}):this.nodeStyleManagmentFlow.removeConditionalInlineStyleByKey({doc:o,nodeIds:[e],key:n,condition:{conditionType:"screen-size",maxWidth:i.maxWidth}}),a&&delete a.content.styles[n]}s&&Object.keys(r.content.styles).length&&n.primitiveType!==Zn.sO.COMPONENT&&(n.referencedStyles[r.id]=r)}else for(const o of t)delete r.content.styles[o]}))}movePropertiesToTempStyle(e){const{properties:t,doc:o,nodeIds:n}=e;if(!o)return;const i=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery();(n||this.nodeSelectionFlow.getSelectedNodesIds()).forEach((e=>{const n=o.nodes.getById(e);if(!n)return;if(!("tempStyles"in n))return;if(i.isDefault){for(const i of t){var r;const t=null===(r=this.getNodeStyles({nodeId:e,doc:o})[i])||void 0===r?void 0:r.clone();t&&(n.tempStyles[i]=t,this.nodeStyleManagmentFlow.removeStyleByKey({doc:o,nodeIds:[e],key:i}))}return}const s=this.getNodeStyleMap({nodeId:e,matchedBreakpoint:i.maxWidth,doc:o});if(!s||"inlined"!==s.content.mapType)return;let a=Object.values(n.tempInlineStyles).find((e=>e.content.conditions.find((e=>"screen-size"===e.conditionType&&e.maxWidth===i.maxWidth)))),c=!1;a||(a={type:"style-map",id:(0,ni.Ox)(),content:{mapType:"inlined",conditions:[{conditionType:"screen-size",maxWidth:i.maxWidth}],styles:{}}},c=!0);for(const d of t){var l;const t=null===(l=s.content.styles[d])||void 0===l?void 0:l.clone();t?(a.content.styles[d]=t,this.nodeStyleManagmentFlow.removeConditionalInlineStyleByKey({doc:o,nodeIds:[e],key:d,condition:{conditionType:"screen-size",maxWidth:i.maxWidth}})):delete a.content.styles[d]}c&&Object.keys(a.content.styles).length&&(n.tempInlineStyles[a.id]=a)}))}getNodeStyleMap(e){const{nodeId:t,doc:o,matchedBreakpoint:n}=e;if(!o)return;const i=o.nodes.getById(t);if(!i)return;let r;if(o.nodes.nodeIsCompInstance(i)){var s,a;const e=null===(s=i.attrs[lr.Q])||void 0===s?void 0:s.content,t=o.components.byId[i.compIdOfCompInstance];r=Object.values((null===(a=t.styleSetDefinitions[e])||void 0===a?void 0:a.referencedStyles)||{}).find((e=>"inlined"===e.content.mapType&&e.content.conditions.find((e=>"screen-size"===e.conditionType&&e.maxWidth===n))))}else{if(!("tempStyles"in i))return;r=Object.values(i.referencedStyles).find((e=>"inlined"===e.content.mapType&&e.content.conditions.find((e=>"screen-size"===e.conditionType&&e.maxWidth===n))))}return r}getNodeStyles(e){const{doc:t,nodeId:o}=e;let n={};if(!t)return n;const i=t.nodes.getById(o);if(!i||!("styles"in i))return n;if(n=i.styles,t.nodes.nodeIsCompInstance(i)){var r,s;const e=null===(r=i.attrs[lr.Q])||void 0===r?void 0:r.content;n=(null===(s=(null===t||void 0===t?void 0:t.components.byId[i.compIdOfCompInstance]).styleSetDefinitions[e])||void 0===s?void 0:s.styles)||n}return n}},Uv=(0,s.Z)(kv.prototype,"projectDoc",[Cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rv=(0,s.Z)(kv.prototype,"nodeStyleManagmentFlow",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zv=(0,s.Z)(kv.prototype,"nodeSelectionFlow",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lv=(0,s.Z)(kv.prototype,"projectUIState",[_v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$v=(0,s.Z)(kv.prototype,"dbSync",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv=(0,s.Z)(kv.prototype,"mediaQueryBreakpointManagementFlow",[Pv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(kv.prototype,"retrievePropertiesFromTempStyle",[m.P],Object.getOwnPropertyDescriptor(kv.prototype,"retrievePropertiesFromTempStyle"),kv.prototype),(0,s.Z)(kv.prototype,"movePropertiesToTempStyle",[m.P],Object.getOwnPropertyDescriptor(kv.prototype,"movePropertiesToTempStyle"),kv.prototype),Av=kv));var Gv,Hv,zv,Yv,Vv,Wv,Kv,qv,Jv,Xv,Qv,ew,tw,ow,nw,iw=o(333408);function rw(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function sw(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?rw(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):rw(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Gv=(0,c.provide)("navbarFlow"),Hv=(0,c.inject)("projectDoc"),zv=(0,c.inject)("projectUIState"),Yv=(0,c.inject)("positioningService"),Vv=(0,c.inject)("routerService"),Wv=(0,c.inject)("projectFilesFlow"),Kv=(0,c.inject)("githubFlow"),Gv((Jv=class{constructor(){(0,i.Z)(this,"projectDoc",Xv,this),(0,i.Z)(this,"projectUIState",Qv,this),(0,i.Z)(this,"positioningService",ew,this),(0,i.Z)(this,"routerService",tw,this),(0,i.Z)(this,"projectFilesFlow",ow,this),(0,i.Z)(this,"githubFlow",nw,this),(0,r.Z)(this,"getCurrentTabs",(()=>this.projectUIState.layout.mainPanel===p.iW.DEV?this.projectUIState.navbar.devModeTabs||{}:this.projectUIState.navbar.tabs)),(0,r.Z)(this,"getCurrentNewTabId",(()=>this.projectUIState.layout.mainPanel===p.iW.DEV?this.projectUIState.navbar.newDevTabId:this.projectUIState.navbar.newTabId)),(0,r.Z)(this,"createStarterFileTab",(e=>{if(e===Ks.O2)return null;const t=this.positioningService.getHighestAvailablePosition({entitiyCollection:this.projectUIState.navbar.devModeTabs}),o={id:(0,ni.Ox)(),entityId:e,type:"file",pos:t};return(0,a.mutate)(this.projectUIState,(e=>{e.navbar.devModeTabs||(e.navbar.devModeTabs={}),e.navbar.devModeTabs[o.id]=o})),this.projectFilesFlow.setSelectedFile({path:e,fromTab:!0}),o.id})),(0,r.Z)(this,"renameFilesTab",((e,t)=>{const o=this.getTabByEntityId(e);o&&e!==t&&(0,a.mutate)(this.projectUIState,(e=>{e.navbar.devModeTabs[o.id].entityId=t}))}))}getTabByEntityId(e){return Object.values(this.getCurrentTabs()||{}).find((t=>t.entityId===e))||null}deleteTab(e,t){var o;if((null===(o=this.getSelectedTab())||void 0===o?void 0:o.id)===e){var n,i;let o=(null===(n=this.getNextTab(e))||void 0===n?void 0:n.id)||(null===(i=this.getPreviousTab(e))||void 0===i?void 0:i.id)||"";this.projectUIState.layout.mainPanel===p.iW.DEV?o?this.selectTab({tabId:o,routerReplace:t}):this.projectFilesFlow.setSelectedFile({path:Ks.O2,fromTab:!0}):(o||(o=this.createNewTab({entityId:this.projectDoc.pages.getHomePageId()||""})),this.selectTab({tabId:o,routerReplace:t}))}(0,a.mutate)(this.projectUIState,(t=>{t.layout.mainPanel!==p.iW.DEV?delete t.navbar.tabs[e]:delete t.navbar.devModeTabs[e]}))}deleteOtherTabs(e){(0,a.mutate)(this.projectUIState,(t=>{t.layout.mainPanel!==p.iW.DEV?Object.keys(sw({},t.navbar.tabs)).forEach((o=>{o!==e&&delete t.navbar.tabs[o]})):Object.keys(sw({},t.navbar.devModeTabs)).forEach((o=>{o!==e&&delete t.navbar.devModeTabs[o]}))})),this.selectTab({tabId:e})}deleteTabsToTheRight(e){const t=this.getTabIdsInOrder(),o=t.findIndex((t=>t===e)),n=this.getSelectedTab();let i=!1;(0,a.mutate)(this.projectUIState,(e=>{for(let r=o+1;r<t.length;r++)i||t[r]!==n.id||(i=!0),e.layout.mainPanel===p.iW.DEV?delete e.navbar.devModeTabs[t[r]]:delete e.navbar.tabs[t[r]]})),i&&this.selectTab({tabId:e})}deleteAllDevModeTabs(){(0,a.mutate)(this.projectUIState,(e=>{Object.keys(sw({},e.navbar.devModeTabs)).forEach((t=>{delete e.navbar.devModeTabs[t]}))})),this.projectFilesFlow.setSelectedFile({path:Ks.O2,fromTab:!0})}getTabIdsInOrder(){return this.positioningService.orderEntities({entitiyCollection:this.getCurrentTabs()})}getNextTab(e){const t=this.getCurrentTabs()[e];return this.positioningService.getNextEntity({entitiyCollection:this.getCurrentTabs(),entity:t})}getPreviousTab(e){const t=this.getCurrentTabs()[e];return this.positioningService.getPrevEntity({entitiyCollection:this.getCurrentTabs(),entity:t})}createNewTab(e){const{entityId:t,forceSave:o}=e,n=this.computeNavType(t);if(!n)return null;const i=o?void 0:this.getCurrentTabs()[this.getCurrentNewTabId()||""],r=e.pos||(null===i||void 0===i?void 0:i.pos)||this.positioningService.getHighestAvailablePosition({entitiyCollection:this.getCurrentTabs()}),s={id:(null===i||void 0===i?void 0:i.id)||(0,ni.Ox)(),entityId:t,type:n,pos:r};return(0,a.mutate)(this.projectUIState,(e=>{if(e.layout.mainPanel===p.iW.DEV)return e.navbar.devModeTabs[s.id]=s,void(o||(e.navbar.newDevTabId=s.id));e.navbar.tabs[s.id]=s,o||(e.navbar.newTabId=s.id)})),s.id}saveNewTab(){(0,a.mutate)(this.projectUIState,(e=>{e.layout.mainPanel!==p.iW.DEV?e.navbar.newTabId&&delete e.navbar.newTabId:e.navbar.newDevTabId&&delete e.navbar.newDevTabId}))}moveTab(e,t){(0,a.mutate)(this.projectUIState,(o=>{o.layout.mainPanel!==p.iW.DEV?o.navbar.tabs[e].pos=t:o.navbar.devModeTabs[e].pos=t}))}selectTab(e){const{tabId:t,routerReplace:o,nodeId:n}=e,i=this.getCurrentTabs()[t];i&&this.projectUIState.selection.componentId!==i.entityId&&this.projectUIState.devMode.selectedFile!==i.entityId&&(this.projectUIState.layout.mainPanel!==p.iW.DEV?(this.setSelectedComponent(i.entityId,n),o?this.routerService.replace((0,Ya.aZ)(this.projectUIState.slug,i.entityId)):this.routerService.push((0,Ya.aZ)("[slug]","[compId]"),(0,Ya.aZ)(this.projectUIState.slug,i.entityId))):this.projectFilesFlow.setSelectedFile({path:i.entityId,fromTab:!0,type:i.type}))}setSelectedComponent(e,t){(0,a.mutate)(this.projectUIState,(o=>{o.previousSelectedPageOrCompId=o.selection.componentId,o.selection.componentId=e,o.invalidDynamicProperties={},t&&(o.selection.nodes[t]=t,o.selection.persistSelectionOnNodeId=t)}))}getSelectedTab(){let e=this.projectUIState.selection.componentId||"";if(this.projectUIState.layout.mainPanel===p.iW.DEV){var t,o;const n=this.projectUIState.devMode.selectedDiffingFile,i=this.projectUIState.devMode.selectedStagedFile,r=this.projectUIState.devMode.selectedCommitFile;e=n?`${n.path}-${n.status}`:i?`${i.path}${Ks.Wj}`:r?`${r.path}-${r.sha}${Ks.Vf}`:(null===(t=this.projectUIState)||void 0===t||null===(o=t.devMode)||void 0===o?void 0:o.selectedFile)||Ks.e3}return this.getTabByEntityId(e)||Object.values(this.getCurrentTabs())[0]}getLastTab(){const e=this.getTabIdsInOrder();return this.projectUIState.navbar.tabs[e[e.length-1]]||null}selectOrCreateTabByEntityId(e,t,o){if(e===Ks.O2)return;const n=this.getTabByEntityId(e),i=this.getCurrentNewTabId();if(n&&n.id===i)return(0,a.mutate)(this.projectUIState,(t=>{(t.layout.mainPanel===p.iW.DEV?t.navbar.devModeTabs[n.id]:t.navbar.tabs[n.id]).entityId=e})),void this.selectTab({tabId:n.id,routerReplace:t,nodeId:o});if(!Object.keys(this.getCurrentTabs()||{}).length){const n=this.createNewTab({entityId:e,forceSave:!0});if(n)return void this.selectTab({tabId:n,routerReplace:t,nodeId:o});setTimeout((()=>{this.selectTab({tabId:this.createNewTab({entityId:e,forceSave:!0})||"",routerReplace:t,nodeId:o})}),500)}if(n&&this.getCurrentNewTabId()!==(null===n||void 0===n?void 0:n.id))return void this.selectTab({tabId:n.id,routerReplace:t,nodeId:o});const r=this.createNewTab({entityId:e});r?this.selectTab({tabId:r,routerReplace:t,nodeId:o}):setTimeout((()=>{this.selectTab({tabId:this.createNewTab({entityId:e})||"",routerReplace:t,nodeId:o})}),500)}syncDevTabsAfterFileStage(e){var t;const{doc:o,file:n}=e;if(!o)return;if((null===(t=this.projectUIState.devMode.selectedDiffingFile)||void 0===t?void 0:t.path)===n){const e=this.getSelectedTab(),t=this.projectUIState.navbar.newDevTabId===e.id;return this.projectFilesFlow.setSelectedStagedFile({doc:o,fileId:n}),void(t||(0,a.mutate)(this.projectUIState,(t=>{delete t.navbar.devModeTabs[e.id]})))}const i=this.projectUIState.navbar.devModeTabs;Object.keys(i).forEach((e=>{i[e].entityId===`${n}-${iw.E.MODIFIED}`&&this.deleteTab(e)}))}syncDevTabsAfterUnstageFile(e,t){var o;if((null===(o=this.projectUIState.devMode.selectedStagedFile)||void 0===o?void 0:o.path)===e){const o=this.getSelectedTab(),n=this.projectUIState.navbar.newDevTabId===o.id;return this.projectFilesFlow.setSelectedDiffingFile(e,t),void(n||(0,a.mutate)(this.projectUIState,(e=>{delete e.navbar.devModeTabs[o.id]})))}const n=this.projectUIState.navbar.devModeTabs;Object.keys(n).forEach((t=>{n[t].entityId===`${e}${Ks.Wj}`&&this.deleteTab(t)}))}computeNavType(e){const t=this.projectUIState.devMode.selectedBranch,o=this.projectDoc.pages.byId[e],n=this.projectDoc.cmsPages.byId[e];if(o||n)return"page";if(this.projectDoc.components.byId[e])return"component";if(this.projectUIState.layout.mainPanel!==p.iW.DEV)return null;if(e.endsWith(Ks.Wj))return"staged-file";const i=e.endsWith(`-${iw.E.MODIFIED}`),r=e.endsWith(`-${iw.E.NEW}`),s=e.endsWith(`-${iw.E.REMOVED}`);if(i||r||s)return"git-file";if(e.endsWith(Ks.Vf))return"commited-file";return this.projectDoc.projectFiles.local[t].byId[e]?"file":null}},Xv=(0,s.Z)(Jv.prototype,"projectDoc",[Hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qv=(0,s.Z)(Jv.prototype,"projectUIState",[zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ew=(0,s.Z)(Jv.prototype,"positioningService",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tw=(0,s.Z)(Jv.prototype,"routerService",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ow=(0,s.Z)(Jv.prototype,"projectFilesFlow",[Wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nw=(0,s.Z)(Jv.prototype,"githubFlow",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Jv.prototype,"syncDevTabsAfterFileStage",[m.P],Object.getOwnPropertyDescriptor(Jv.prototype,"syncDevTabsAfterFileStage"),Jv.prototype),qv=Jv));var aw,cw,lw,dw,pw,uw,hw,mw,yw;const gw=["loop","autoplay","autoplayDelay","disableAutoplayOnInteraction","pauseAutoplayOnMouseEnter","reverseDirection","pagination","navigation"];aw=(0,c.provide)("sliderFlow"),cw=(0,c.inject)("projectDoc"),lw=(0,c.inject)("nodeStyleManagmentFlow"),dw=(0,c.inject)("projectUIState"),aw((uw=class{constructor(){(0,i.Z)(this,"projectDoc",hw,this),(0,i.Z)(this,"nodeStyleManagmentFlow",mw,this),(0,i.Z)(this,"projectUIState",yw,this)}getSlider(e){const t=this.projectDoc.nodes.getById(e);if(t&&"element-node"===t.type&&t.primitiveType===Zn.IV.SLIDER)return t}getSliderPaginationWrapper(e){const t=this.getSlider(e),o=Object.keys((null===t||void 0===t?void 0:t.childrenIds)||{}).find((e=>{const t=this.projectDoc.nodes.getById(e);return"element-node"===(null===t||void 0===t?void 0:t.type)&&(null===t||void 0===t?void 0:t.primitiveType)===Zn.IV.SLIDER_PAGINATION}));return o?this.projectDoc.nodes.getById(o):void 0}getSliderProperties(e){const t=this.getSlider(e);if(!t)return;return gw.reduce(((e,o)=>{const n=`data-${(0,dr.gS)(o)}`,i=t.attrs[n];return void 0===i||"dynamic"===i.type||(e[o]=String(i.content)),e}),{})}updateSliderProperty(e){const{doc:t,sliderId:o,property:n,value:i}=e;if(!t)return;const r=t.nodes.getById(o);if(!r||"element-node"!==r.type||r.primitiveType!==Zn.IV.SLIDER)return;const s=`data-${(0,dr.gS)(n)}`,a=r.attrs[s];if(a?a.content=i:r.attrs[s]=new Yr.F({content:i}),"pagination"===n){const e=Object.keys((null===r||void 0===r?void 0:r.childrenIds)||{}).map((e=>this.projectDoc.nodes.getById(e))).find((e=>(null===e||void 0===e?void 0:e.primitiveType)===Zn.IV.SLIDER_PAGINATION));if(!e)return;this.nodeStyleManagmentFlow.setStyleByKey({doc:t,nodeIds:[e.id],key:"display",value:"true"===i?"block":"none"})}if("navigation"===n){Object.keys((null===r||void 0===r?void 0:r.childrenIds)||{}).map((e=>this.projectDoc.nodes.getById(e))).filter((e=>(null===e||void 0===e?void 0:e.primitiveType)===Zn.IV.SLIDER_NEXT||(null===e||void 0===e?void 0:e.primitiveType)===Zn.IV.SLIDER_PREV)).forEach((e=>{this.nodeStyleManagmentFlow.setStyleByKey({doc:t,nodeIds:[e.id],key:"display",value:"true"===i?"block":"none"})}))}}getSlidesWrapper(e){const t=this.getSlider(e);if(!t)return;const o=Object.keys(t.childrenIds).find((e=>{const t=this.projectDoc.nodes.getById(e);return"element-node"===(null===t||void 0===t?void 0:t.type)&&t.primitiveType===Zn.IV.SLIDER_WRAPPER}));return o?this.projectDoc.nodes.getById(o):void 0}addNewSlide(e){const{doc:t,sliderId:o,slideImage:n}=e;if(!t)return;const i=this.getSlider(o);if(!i)return;const r=this.getSlidesWrapper(i.id);if(!r||"element-node"!==r.type)return;const s=this.projectDoc.nodes.getLastChild(r),c=new lu.HX({primitiveType:Zn.IV.SLIDER_SLIDE,parentId:r.id,semanticType:Zn.iX.DIV,name:"slider-slide",attrs:{"data-thq":new Yr.F({content:"slider-slide"})},pos:(parseFloat((null===s||void 0===s?void 0:s.pos)||"0")+Number.MAX_SAFE_INTEGER).toString()});c.styles={backgroundImage:new Yr.F({content:`url("${n}")`}),backgroundSize:new Yr.F({content:"100%"}),display:new Yr.F({content:"flex "})},c.referencedStyles={"some-random-value":{id:(0,ni.Ox)(),type:"style-map",content:{mapType:"component-referenced",content:{type:"static",content:"swiper-slide"}}}},t.nodes.add(c),(0,a.mutate)(this.projectUIState,(e=>{Object.keys(e.selection.nodes).forEach((t=>delete e.selection.nodes[t])),e.selection.nodes[c.id]=c.id}));const l=Object.keys(i.childrenIds).find((e=>{const t=this.projectDoc.nodes.getById(e);return"element-node"===(null===t||void 0===t?void 0:t.type)&&(null===t||void 0===t?void 0:t.primitiveType)===Zn.IV.SLIDER_PAGINATION}));if(!l)return;const d=this.projectDoc.nodes.getById(l),p=this.projectDoc.nodes.getLastChild(d),u=new lu.HX({parentId:l,semanticType:Zn.iX.DIV,primitiveType:Zn.IV.SLIDER_PAGINATION_BULLET,attrs:{"data-thq":new Yr.F({content:"slider-pagination-bullet"})},name:"slider-pagination-bullet",pos:(parseFloat((null===p||void 0===p?void 0:p.pos)||"0")+Number.MAX_SAFE_INTEGER).toString(),referencedStyles:{"some-random-name":{id:(0,ni.Ox)(),type:"style-map",content:{mapType:"component-referenced",content:{type:"static",content:"swiper-pagination-bullet"}}}}});t.nodes.add(u)}},hw=(0,s.Z)(uw.prototype,"projectDoc",[cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mw=(0,s.Z)(uw.prototype,"nodeStyleManagmentFlow",[lw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yw=(0,s.Z)(uw.prototype,"projectUIState",[dw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(uw.prototype,"updateSliderProperty",[m.P],Object.getOwnPropertyDescriptor(uw.prototype,"updateSliderProperty"),uw.prototype),(0,s.Z)(uw.prototype,"addNewSlide",[m.P],Object.getOwnPropertyDescriptor(uw.prototype,"addNewSlide"),uw.prototype),pw=uw));o(271848),o(347429),o(868570);var fw=o(463540);const bw=e=>{const{onDismiss:t,tokens:o,categoryName:n}=e;return(0,F.jsxs)("div",{className:"delete-token-modal",children:[(0,F.jsx)(S.J,{type:"error",size:32}),(0,F.jsxs)("p",{className:"warning-message",children:["You are trying to delete the ",n," category that has the following tokens with specific roles in it."]}),(0,F.jsx)("div",{className:"token-card-container",children:o.map((e=>(0,F.jsxs)("div",{className:"token-card",children:[(0,F.jsx)("div",{className:"color-token",style:{backgroundColor:`${e.value}`},children:e.role&&(0,F.jsx)(S.J,{type:e.role.replace("-color",""),color:(0,dr.lF)(e.value.toString()),size:32})}),(0,F.jsx)("span",{children:e.role})]},e.id)))}),(0,F.jsxs)("p",{className:"warning-message",children:["In order to delete the ",n," category please assign the previously mentioned roles to other tokens."]}),(0,F.jsx)("div",{className:"modal-buttons",children:(0,F.jsx)(j.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Dismiss"})}),(0,F.jsx)("style",{children:tp.mZ})]})},Iw=e=>{const{onDismiss:t,token:o,categoryName:n,onSubmit:i}=e,r=Object.keys(o.usedInNodes).length;return(0,F.jsxs)("div",{className:"delete-token-modal",children:[(0,F.jsxs)("div",{className:"modal-title",children:["Delete ",n,"-",o.name]}),(0,F.jsx)(S.J,{type:"error",size:32}),(0,F.jsx)("p",{className:"warning-message",children:"You are about to remove a token that is bound to nodes in the project. Doing this will unbind the token from all the nodes but they will retain the value found in the token as a static one."}),(0,F.jsxs)("p",{className:"warning-message",children:[r," ",1===r?"node is":"nodes are"," bound to the token."]}),(0,F.jsxs)("p",{className:"warning-message",children:["Are you sure you want to delete ",o.name," from the ",n," category?"]}),(0,F.jsxs)("div",{className:"modal-buttons",children:[(0,F.jsx)(j.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Cancel"}),(0,F.jsx)(j.z,{style:"solid",colorScheme:"danger",onClick:i,children:"Delete"})]}),(0,F.jsx)("style",{children:tp.mZ})]})};var vw=o(764944);const ww=e=>{const{onDismiss:t,textStyle:o,onSubmit:n}=e,i=Object.keys(o.usedInNodes).length;return(0,F.jsxs)("div",{className:"delete-token-modal",children:[(0,F.jsxs)("div",{className:"modal-title",children:["Delete ",o.name]}),(0,F.jsx)(S.J,{type:"error",size:32}),(0,F.jsx)("p",{className:"warning-message",children:"You are about to remove a text style that is bound to nodes in the project. Doing this will unbind the text style from all the nodes but they will retain the value found in the text style as a static one."}),(0,F.jsxs)("p",{className:"warning-message",children:[i," ",1===i?"node is":"nodes are"," bound to the text style."]}),(0,F.jsxs)("p",{className:"warning-message",children:["Are you sure you want to delete ",o.name,"?"]}),(0,F.jsxs)("div",{className:"modal-buttons",children:[(0,F.jsx)(j.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Cancel"}),(0,F.jsx)(j.z,{style:"solid",colorScheme:"danger",onClick:n,children:"Delete"})]}),(0,F.jsx)("style",{children:tp.mZ})]})};var Nw,jw,Sw,Dw,Tw,Ow,Fw,Cw,Ew,xw,_w,Mw,Pw,Aw,kw,Uw,Rw,Zw,Lw,$w,Bw,Gw,Hw,zw,Yw,Vw,Ww,Kw,qw,Jw,Xw,Qw,eN,tN,oN,nN,iN,rN=o(132830);function sN(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}Nw=(0,c.provide)("designLanguageManagementFlow"),jw=(0,c.inject)("sharedbProjectSyncService"),Sw=(0,c.inject)("projectDoc"),Dw=(0,c.inject)("projectUIState"),Tw=(0,c.inject)("nodeStyleManagmentFlow"),Ow=(0,c.inject)("modalManagementFlow"),Fw=(0,c.inject)("fontsInProjectFlow"),Cw=(0,c.inject)("nodeRichTextFlow"),Ew=(0,c.inject)("projectClassManagementFlow"),xw=(0,c.inject)("nodeSelectionFlow"),_w=(0,h.G)(g.l.CREATE_TOKEN_CATEGORY),Mw=(0,h.G)(g.l.DUPLICATE_TOKEN_CATEGORY),Pw=(0,h.G)(g.l.DELETE_TOKEN_CATEGORY),Aw=(0,h.G)(g.l.DELETE_TOKEN_CATEGORY),kw=(0,h.G)(g.l.CREATE_TOKEN),Uw=(0,h.G)(g.l.DUPLICATE_TOKEN),Rw=(0,h.G)(g.l.DELETE_TOKEN),Zw=(0,h.G)(g.l.DELETE_TOKEN),Lw=(0,h.G)(g.l.CREATE_TEXT_STYLE),$w=(0,h.G)(g.l.DUPLICATE_TEXT_STYLE),Bw=(0,h.G)(g.l.EDIT_TEXT_STYLE),Gw=(0,h.G)(g.l.DELETE_TEXT_STYLE),Hw=(0,h.G)(g.l.DELETE_TEXT_STYLE),zw=(0,h.G)(g.l.OPEN_TOKEN_SIDE_PANEL),Yw=(0,h.G)(g.l.MOVE_CATEGORY_IN_DIRECTION),Vw=(0,h.G)(g.l.CREATE_TOKEN_CATEGORY),Nw((Kw=class{constructor(){(0,i.Z)(this,"dbSync",qw,this),(0,i.Z)(this,"projectDoc",Jw,this),(0,i.Z)(this,"projectUIState",Xw,this),(0,i.Z)(this,"nodeStyleManagmentFlow",Qw,this),(0,i.Z)(this,"modalManagementFlow",eN,this),(0,i.Z)(this,"fontsInProjectFlow",tN,this),(0,i.Z)(this,"nodeRichTextFlow",oN,this),(0,i.Z)(this,"projectClassManagementFlow",nN,this),(0,i.Z)(this,"nodeSelectionFlow",iN,this),(0,r.Z)(this,"getSelectedNodesTextStyles",(()=>{const e=this.nodeSelectionFlow.getSelectedNodesIds(),t=this.projectDoc.nodes.getById(e[0]);if(!t)return null;const o=1===e.length?this.nodeRichTextFlow.getTextComponentForNode(e[0]):null;if(null!==o&&void 0!==o&&o.getSelectionTextStyles)return o.getSelectionTextStyles();const n=(0,vw.hm)(t);return-1===e.findIndex((e=>{const t=this.projectDoc.nodes.getById(e);return t?(0,vw.hm)(t)!==n:null}))&&n?this.projectDoc.designLanguage.textStyleSetsById[n]:null})),(0,r.Z)(this,"closeSidePanel",(()=>{(0,a.mutate)(this.projectUIState,(e=>{e.designLanguage.sidebarPanel=null}))})),(0,r.Z)(this,"calculateNewPosition",((e,t,o)=>{let n=0;return n="before"===e?0===o?(t[o].position-Number.MAX_SAFE_INTEGER)/2:(t[o].position+t[o-1].position)/2:o===t.length-1?t[o].position+Number.MAX_SAFE_INTEGER:(t[o].position+t[o+1].position)/2,n}))}createCategory(e,t){this.dbSync.mutate(this.projectDoc,(o=>{o.designLanguage.createCategory(e,t)}))}duplicateCategory(e){this.dbSync.mutate(this.projectDoc,(t=>{t.designLanguage.duplicateCategory(e)}))}startEditingCategoryName(e){e&&this.projectDoc.designLanguage.categoriesById[e]&&(0,a.mutate)(this.projectUIState,(t=>{t.designLanguage.currentlyEditedCategoryName=this.projectDoc.designLanguage.categoriesById[e].name}))}editCategoryName(e,t){this.dbSync.mutate(this.projectDoc,(o=>{o.designLanguage.editCategoryName(e,t)})),(0,a.mutate)(this.projectUIState,(e=>{e.designLanguage.currentlyEditedCategoryName=""}))}deleteCategory(e){if(!this.projectDoc.designLanguage.getTokensByCategoryId(e).length)return void this.dbSync.mutate(this.projectDoc,(t=>{t.designLanguage.deleteCategory(e)}));const t=this.projectDoc.designLanguage.getTokensByCategoryId(e).filter((e=>e.role));if(t.length){const o=b.d.createCustomModal({data:{tokens:t,categoryName:this.projectDoc.designLanguage.categoriesById[e].name},Component:bw});return void this.modalManagementFlow.showModal(o)}const o=b.d.createDeleteModal({deletedEntity:"Color Category",onSubmit:()=>this.deleteCategoryAndUnbindNodesFromIt({categoryId:e})});this.modalManagementFlow.showModal(o)}deleteCategoryAndUnbindNodesFromIt(e){const{doc:t,categoryId:o}=e;if(!t)return;t.designLanguage.getTokensByCategoryId(o).forEach((e=>{const o=Object.keys(e.usedInNodes);o.length&&this.nodeStyleManagmentFlow.unbindTokenFromNodes({tokenId:e.id,nodeIds:o}),this.projectClassManagementFlow.unbindTokenFromClasses({doc:t,tokenId:e.id})})),t.designLanguage.deleteCategory(o)}createToken(e,t,o,n){this.dbSync.mutate(this.projectDoc,(i=>{i.designLanguage.createToken({name:e,value:t,categoryId:o,type:n})}))}duplicateToken(e){this.dbSync.mutate(this.projectDoc,(t=>{t.designLanguage.duplicateToken(e)}))}deleteTokenAndUnbind(e){const{doc:t,tokenId:o,nodeIds:n}=e;t&&(n&&this.nodeStyleManagmentFlow.unbindTokenFromNodes({tokenId:o,nodeIds:n}),this.projectClassManagementFlow.unbindTokenFromClasses({doc:t,tokenId:o}),t.designLanguage.deleteToken(o))}deleteTokenAndCheckBoundNodes(e){const t=this.projectDoc.designLanguage.tokensById[e],o=Object.keys(t.usedInNodes);if(o.length){const n=b.d.createCustomModal({data:{token:t,categoryName:this.projectDoc.designLanguage.categoriesById[t.categoryId].name},Component:Iw,onSubmit:()=>{this.deleteTokenAndUnbind({tokenId:e,nodeIds:o}),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(n)}else this.deleteTokenAndUnbind({tokenId:e})}editTokenValue(e){const{id:t,newValue:o,doc:n}=e;if(!n)return;const i=n.designLanguage.tokensById[t].value,r=Object.keys(n.designLanguage.tokensById[t].usedInNodes).map((e=>n.nodes.getById(e)));(0,rN.D5)(i)&&(0,rN.H3)(o)&&(r.forEach((e=>{if(n.nodes.nodeIsCompInstance(e)||!("styles"in e))return;const o=e.styles,i=e.referencedStyles;Object.keys(o).forEach((o=>{"backgroundColor"===o&&(this.nodeStyleManagmentFlow.setStyleByKey({doc:n,nodeIds:[e.id],key:"background",tokenId:t,value:""}),this.nodeStyleManagmentFlow.removeStyleByKey({doc:n,nodeIds:[e.id],key:"backgroundColor"}))})),Object.values(i).forEach((o=>{if("style-map"===o.type&&"inlined"===o.content.mapType){const i=o.content,r=i.styles;if(!Object.keys(r).some((e=>"backgroundColor"===e)))return;const s=i.conditions[0];if(!s)return;this.nodeStyleManagmentFlow.setConditionalInlineStyleByKey({doc:n,nodeIds:[e.id],key:"background",tokenId:t,value:"",condition:s}),this.nodeStyleManagmentFlow.removeConditionalInlineStyleByKey({doc:n,nodeIds:[e.id],key:"backgroundColor",condition:s})}}))})),this.editTokenType({id:t,newType:fw.i.GRADIENT,doc:n}),this.projectClassManagementFlow.editContentKeysInClassWhereTokenIsUsed({doc:n,tokenId:t,keysToEdit:{backgroundColor:"background"}})),(0,rN.H3)(i)&&(0,rN.D5)(o)&&(this.editTokenType({id:t,newType:fw.i.COLOR,doc:n}),this.projectClassManagementFlow.editContentKeysInClassWhereTokenIsUsed({doc:n,tokenId:t,keysToEdit:{background:"backgroundColor"}})),n.designLanguage.editTokenValue(t,o)}editTokenName(e,t){this.dbSync.mutate(this.projectDoc,(o=>{o.designLanguage.editTokenName(e,t)}))}editTokenType(e){const{id:t,newType:o,doc:n}=e;n&&n.designLanguage.editTokenType(t,o)}switchBackgroundWithForegroundColors(){this.dbSync.mutate(this.projectDoc,(e=>{e.designLanguage.switchTokenRoles("background-color","foreground-color")}))}changeTokenRole(e,t){this.dbSync.mutate(this.projectDoc,(o=>{o.designLanguage.changeTokenRole(e,t)}))}createTextStyle(e){const{name:t,content:o,doc:n,nodeIds:i}=e;if(!n)return;const r={content:Object.keys(o||{}).reduce(((e,t)=>(e[t]=new Yr.F({content:o[t]}),e)),{}),name:t,usedInNodes:{}},s=n.designLanguage.createTextStyle(r);s&&(o.fontFamily&&this.fontsInProjectFlow.addFont({doc:n,fontName:o.fontFamily,tokens:[s.id]}),i&&this.bindTextStyleToNodes({textStyleId:s.id,nodeIds:i}))}bindTextStyleToNodes(e){const{doc:t,textStyleId:o,nodeIds:n}=e;if(!t||!o)return;const i=t.designLanguage.textStyleSetsById[o];if(!i)return;this.nodeStyleManagmentFlow.bindTextStyleOnSelectedNodes({textStyleId:o,nodeIds:n});const r=Object.keys(i.content);this.nodeStyleManagmentFlow.removeMultipleStylesByKey({nodeIds:n,keys:r})}bindTextStyleToProjectClass(e){const{doc:t,textStyleId:o,classId:n}=e;if(!t||!o)return;t.designLanguage.textStyleSetsById[o]&&this.projectClassManagementFlow.addTextStyleReferenceToClass({doc:t,textStyleId:o,classId:n})}removeTextStyleFromProjectClass(e){const{doc:t,textStyleId:o,classId:n}=e;if(!t||!o)return;t.designLanguage.textStyleSetsById[o]&&this.projectClassManagementFlow.removeTextStyleReferenceFromClass({doc:t,textStyleId:o,classId:n})}duplicateTextStyle(e){this.dbSync.mutate(this.projectDoc,(t=>{t.designLanguage.duplicateTextStyle(e)}))}unBindTextStyleFromNodes(e){const{textStyleId:t,nodeIds:o,doc:n}=e;if(!n)return;n.designLanguage.textStyleSetsById[t]&&this.nodeStyleManagmentFlow.unbindTextStyleFromNode({textStyleId:t,nodeIds:o})}editTextStyle(e){const{id:t,name:o,content:n,doc:i}=e;if(!i)return;const s=i.designLanguage.getFlatTextStyleContent(t),a=!Uy()(e.content,s);let c;if(!a&&s||(c=Object.keys(n||{}).reduce(((e,t)=>(n[t]&&(e[t]=new Yr.F({content:n[t]})),e)),{})),s&&c&&s.fontFamily!==c.fontFamily.content){const e=i.fonts.getFontByName(s.fontFamily);e&&delete i.fonts.byId[e.id].usedInTokens[t],this.fontsInProjectFlow.addFont({doc:i,fontName:c.fontFamily.content,tokens:[t]})}i.designLanguage.editTextStyle(function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?sN(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):sN(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({id:t,name:o},c&&a&&{content:c}))}deleteTextStyle(e){const t=this.projectDoc.designLanguage.textStyleSetsById[e];if(Object.keys(t.usedInNodes).length){const o=b.d.createCustomModal({data:{textStyle:t,textStyleName:this.projectDoc.designLanguage.textStyleSetsById[e].name},Component:ww,onSubmit:()=>{this.deleteTextStyleAndUnbind({textStyleId:e}),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(o)}else this.deleteTextStyleAndUnbind({textStyleId:e})}deleteTextStyleAndUnbind(e){const{doc:t,textStyleId:o}=e;if(!t)return;const n=t.designLanguage.textStyleSetsById[o],{content:i}=n;if(i.fontFamily){const e=t.fonts.getFontByName(i.fontFamily.content);var r;if(e)null===(r=t.fonts.byId[e.id])||void 0===r||delete r.usedInTokens[o]}const s=Object.keys(n.usedInNodes);s&&this.unBindTextStyleFromNodes({textStyleId:o,nodeIds:s}),this.projectClassManagementFlow.removeTextStyleReferenceFromAllClass({doc:t,textStyleId:o}),t.designLanguage.deleteTextStyle(o)}setTextStyleAsBodyDefault(e){this.dbSync.mutate(this.projectDoc,(t=>{t.designLanguage.setDefaultTextStyle(e)}))}openSidePanel(e,t){(0,a.mutate)(this.projectUIState,(o=>{o.designLanguage.sidebarPanel={categoryId:e,tokenId:t}}))}changeTokenPosition(e){const{draggedTokenId:t,closestToDropTokenId:o,direction:n,doc:i}=e;if(!i)return;const r=i.designLanguage.tokensById[o];if(!r)return;const s=i.designLanguage.tokensById[t].categoryId,a=[...Object.values(i.designLanguage.tokensById)].filter((e=>e.categoryId===s)).sort(((e,t)=>e.position<t.position?-1:1)),c=a.indexOf(r),l=this.calculateNewPosition(n,a,c);i.designLanguage.changeTokenOrTextStylePosition(t,l)}changeTextStylePosition(e){const{draggedTokenId:t,closestToDropTokenId:o,direction:n,doc:i}=e;if(!i)return;const r=i.designLanguage.textStyleSetsById[o];if(!r)return;const s=i.designLanguage.textStyleSetsById[t].categoryId,a=[...Object.values(i.designLanguage.textStyleSetsById)].filter((e=>e.categoryId===s)).sort(((e,t)=>e.position<t.position?-1:1)),c=a.indexOf(r),l=this.calculateNewPosition(n,a,c);i.designLanguage.changeTokenOrTextStylePosition(t,l)}moveCategoryInDirection(e){const{direction:t,id:o,section:n,doc:i}=e;if(!i)return;const r=[...i.designLanguage.getCategoriesBySection(n).sort(((e,t)=>e.position<t.position?-1:1))],s=r.indexOf(i.designLanguage.categoriesById[o]);let a=0;switch(t){case"up":if(-1===s||0===s)return;a=this.calculateNewPosition("before",r,s-1);break;case"down":if(-1===s||s===r.length-1)return;a=this.calculateNewPosition("after",r,s+1)}i.designLanguage.changeCategoryPosition(o,a)}getOrCreateCategory(e){const{name:t,doc:o}=e;if(!o)throw new Error("Document is not provided");const n=o.designLanguage.getOrCreateCategory(t);if(!n)throw new Error("Failed to get or create category");return n}getBodyTextStyle(){const e=Object.values(this.projectDoc.designLanguage.textStyleSetsById).find((e=>"default"===e.role));if(!e)throw new Error("Body text style not found");return e}},qw=(0,s.Z)(Kw.prototype,"dbSync",[jw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jw=(0,s.Z)(Kw.prototype,"projectDoc",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xw=(0,s.Z)(Kw.prototype,"projectUIState",[Dw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qw=(0,s.Z)(Kw.prototype,"nodeStyleManagmentFlow",[Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eN=(0,s.Z)(Kw.prototype,"modalManagementFlow",[Ow],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tN=(0,s.Z)(Kw.prototype,"fontsInProjectFlow",[Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oN=(0,s.Z)(Kw.prototype,"nodeRichTextFlow",[Cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nN=(0,s.Z)(Kw.prototype,"projectClassManagementFlow",[Ew],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iN=(0,s.Z)(Kw.prototype,"nodeSelectionFlow",[xw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Kw.prototype,"createCategory",[_w],Object.getOwnPropertyDescriptor(Kw.prototype,"createCategory"),Kw.prototype),(0,s.Z)(Kw.prototype,"duplicateCategory",[Mw],Object.getOwnPropertyDescriptor(Kw.prototype,"duplicateCategory"),Kw.prototype),(0,s.Z)(Kw.prototype,"deleteCategory",[Pw],Object.getOwnPropertyDescriptor(Kw.prototype,"deleteCategory"),Kw.prototype),(0,s.Z)(Kw.prototype,"deleteCategoryAndUnbindNodesFromIt",[Aw,m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"deleteCategoryAndUnbindNodesFromIt"),Kw.prototype),(0,s.Z)(Kw.prototype,"createToken",[kw],Object.getOwnPropertyDescriptor(Kw.prototype,"createToken"),Kw.prototype),(0,s.Z)(Kw.prototype,"duplicateToken",[Uw],Object.getOwnPropertyDescriptor(Kw.prototype,"duplicateToken"),Kw.prototype),(0,s.Z)(Kw.prototype,"deleteTokenAndUnbind",[Rw,m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"deleteTokenAndUnbind"),Kw.prototype),(0,s.Z)(Kw.prototype,"deleteTokenAndCheckBoundNodes",[Zw],Object.getOwnPropertyDescriptor(Kw.prototype,"deleteTokenAndCheckBoundNodes"),Kw.prototype),(0,s.Z)(Kw.prototype,"editTokenValue",[m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"editTokenValue"),Kw.prototype),(0,s.Z)(Kw.prototype,"editTokenType",[m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"editTokenType"),Kw.prototype),(0,s.Z)(Kw.prototype,"createTextStyle",[Lw,m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"createTextStyle"),Kw.prototype),(0,s.Z)(Kw.prototype,"bindTextStyleToNodes",[m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"bindTextStyleToNodes"),Kw.prototype),(0,s.Z)(Kw.prototype,"bindTextStyleToProjectClass",[m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"bindTextStyleToProjectClass"),Kw.prototype),(0,s.Z)(Kw.prototype,"removeTextStyleFromProjectClass",[m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"removeTextStyleFromProjectClass"),Kw.prototype),(0,s.Z)(Kw.prototype,"duplicateTextStyle",[$w],Object.getOwnPropertyDescriptor(Kw.prototype,"duplicateTextStyle"),Kw.prototype),(0,s.Z)(Kw.prototype,"unBindTextStyleFromNodes",[m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"unBindTextStyleFromNodes"),Kw.prototype),(0,s.Z)(Kw.prototype,"editTextStyle",[Bw,m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"editTextStyle"),Kw.prototype),(0,s.Z)(Kw.prototype,"deleteTextStyle",[Gw],Object.getOwnPropertyDescriptor(Kw.prototype,"deleteTextStyle"),Kw.prototype),(0,s.Z)(Kw.prototype,"deleteTextStyleAndUnbind",[Hw,m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"deleteTextStyleAndUnbind"),Kw.prototype),(0,s.Z)(Kw.prototype,"openSidePanel",[zw],Object.getOwnPropertyDescriptor(Kw.prototype,"openSidePanel"),Kw.prototype),(0,s.Z)(Kw.prototype,"changeTokenPosition",[m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"changeTokenPosition"),Kw.prototype),(0,s.Z)(Kw.prototype,"changeTextStylePosition",[m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"changeTextStylePosition"),Kw.prototype),(0,s.Z)(Kw.prototype,"moveCategoryInDirection",[Yw,m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"moveCategoryInDirection"),Kw.prototype),(0,s.Z)(Kw.prototype,"getOrCreateCategory",[Vw,m.P],Object.getOwnPropertyDescriptor(Kw.prototype,"getOrCreateCategory"),Kw.prototype),Ww=Kw));var aN,cN,lN,dN,pN;aN=(0,c.provide)("keyboardInteractionFlow"),cN=(0,c.inject)("projectUIState"),aN((dN=class{constructor(){(0,i.Z)(this,"projectUIState",pN,this)}executeKeyDown(e){(0,a.mutate)(this.projectUIState,(({userInteractions:t})=>{t.pressedKeys[e]=!0}))}executeKeyUp(e){(0,a.mutate)(this.projectUIState,(({userInteractions:t})=>{delete t.pressedKeys[e]}))}},pN=(0,s.Z)(dN.prototype,"projectUIState",[cN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lN=dN));o(739671);var uN,hN,mN,yN,gN,fN,bN,IN,vN,wN,NN,jN,SN,DN,TN,ON,FN,CN,EN,xN,_N,MN,PN,AN=o(389561),kN=o(901275);uN=(0,c.provide)("commandPaletteFlow"),hN=(0,c.inject)("assetsEditFlow"),mN=(0,c.inject)("assetsManagementFlow"),yN=(0,c.inject)("projectUIState"),gN=(0,c.inject)("componentManagementFlow"),fN=(0,c.inject)("layoutManagementFlow"),bN=(0,c.inject)("pageManagementFlow"),IN=(0,c.inject)("projectDownloadFlow"),vN=(0,c.inject)("notificationsManagementFlow"),wN=(0,c.inject)("projectPublishFlow"),NN=(0,c.inject)("customCodeCommandsFlow"),uN((SN=class{constructor(){(0,i.Z)(this,"assetsEditFlow",DN,this),(0,i.Z)(this,"assetsManagementFlow",TN,this),(0,i.Z)(this,"projectUIState",ON,this),(0,i.Z)(this,"componentManagementFlow",FN,this),(0,i.Z)(this,"layoutManagementFlow",CN,this),(0,i.Z)(this,"pageManagementFlow",EN,this),(0,i.Z)(this,"projectDownloadFlow",xN,this),(0,i.Z)(this,"notificationsManagementFlow",_N,this),(0,i.Z)(this,"projectPublishFlow",MN,this),(0,i.Z)(this,"customCodeCommandsFlow",PN,this),(0,r.Z)(this,"handleCommand",(e=>{if(!e)return;this.triggerActionCommand(e)||(this.close(),this.componentManagementFlow.select(e))}))}open(e=!1){(0,a.mutate)(this.projectUIState,(t=>{t.commandPalette.opened=!0,t.commandPalette.actionCommandActive=e}))}close(){(0,a.mutate)(this.projectUIState,(e=>{e.commandPalette.actionCommandActive=!1,e.commandPalette.opened=!1}))}triggerActionCommand(e){switch(e){case AN.F.ADD_PAGE:return this.projectUIState.sidebarSettings.expanded.pages||this.layoutManagementFlow.toggleFolders(kN.S.PAGES),this.pageManagementFlow.createEmptyPage({parentFolderId:ut.D.PAGES}),!0;case AN.F.ADD_COMPONENT:return this.projectUIState.sidebarSettings.expanded.components||this.layoutManagementFlow.toggleFolders(kN.S.COMPONENTS),this.componentManagementFlow.createEmptyComponent({parentFolderId:ut.D.COMPONENTS}),!0;case AN.F.PREVIEW_COMPONENT:{const e=this.projectUIState.selection.componentId,t=this.projectUIState.slug;return window.open((0,Ya.zg)(t,e||""),"_blank"),!0}case AN.F.PROJECT_SETTINGS:{const e=this.projectUIState.slug;return Ba.default.push((0,Ya.No)(e,"general")),!0}case AN.F.CONTINUE_ON_SANDBOX:{const e=this.projectUIState.userPreferences.projectType;return this.projectDownloadFlow.exportToCodesandbox(e),!0}case AN.F.CONTINUE_ON_GITHUB:{const e=this.projectUIState.tokens.githubToken,t=this.projectUIState.userPreferences.projectType;return e?(this.projectDownloadFlow.exportToGithub(t),!0):(this.notificationsManagementFlow.handleError("Github token is not set in project settings."),!0)}case AN.F.DOWNLOAD_REACT:return this.projectDownloadFlow.downloadZip(xn.o.REACT),!0;case AN.F.DOWNLOAD_ANGULAR:return this.projectDownloadFlow.downloadZip(xn.o.ANGULAR),!0;case AN.F.DOWNLOAD_VUE:return this.projectDownloadFlow.downloadZip(xn.o.VUE),!0;case AN.F.DOWNLOAD_NEXT:return this.projectDownloadFlow.downloadZip(xn.o.NEXT),!0;case AN.F.DOWNLOAD_NUXT:return this.projectDownloadFlow.downloadZip(xn.o.NUXT),!0;case AN.F.PUBLISH_PROJECT:return this.projectPublishFlow.publishToTeleport(!1),this.notificationsManagementFlow.createNotification(d.k$.INFO,"Publish started. We will notify you when it's done."),!0;case AN.F.ENABLE_OPTIMISATIONS_FOR_IMAGES:return this.assetsManagementFlow.enableOptimisationsForAllImages({}),!0;case AN.F.DISABLE_OPTIMISATIONS_FOR_IMAGES:return this.assetsManagementFlow.disableOptimisationsForAllImages({}),!0;case AN.F.DELETE_ALL_UNUSED_ASSETS:return this.assetsEditFlow.deleteAllUnusedAssets(),!0;case AN.$.PRETTIER:return this.customCodeCommandsFlow.prettify(),!0;default:return!1}}},DN=(0,s.Z)(SN.prototype,"assetsEditFlow",[hN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TN=(0,s.Z)(SN.prototype,"assetsManagementFlow",[mN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ON=(0,s.Z)(SN.prototype,"projectUIState",[yN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FN=(0,s.Z)(SN.prototype,"componentManagementFlow",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CN=(0,s.Z)(SN.prototype,"layoutManagementFlow",[fN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EN=(0,s.Z)(SN.prototype,"pageManagementFlow",[bN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xN=(0,s.Z)(SN.prototype,"projectDownloadFlow",[IN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_N=(0,s.Z)(SN.prototype,"notificationsManagementFlow",[vN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MN=(0,s.Z)(SN.prototype,"projectPublishFlow",[wN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PN=(0,s.Z)(SN.prototype,"customCodeCommandsFlow",[NN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jN=SN));var UN,RN,ZN,LN,$N,BN,GN,HN,zN,YN,VN,WN,KN;UN=(0,c.provide)("customCodeCommandsFlow"),RN=(0,c.inject)("projectUIState"),ZN=(0,c.inject)("workersProvider"),LN=(0,c.inject)("projectDoc"),$N=(0,c.inject)("notificationsManagementFlow"),BN=(0,c.inject)("yDocumentManagementFlow"),UN((HN=class{constructor(){(0,i.Z)(this,"projectUIState",zN,this),(0,i.Z)(this,"workersProvider",YN,this),(0,i.Z)(this,"projectDoc",VN,this),(0,i.Z)(this,"notificationsManagementFlow",WN,this),(0,i.Z)(this,"yDocumentManagementFlow",KN,this)}async prettify(){const{selectedFile:e}=this.projectUIState.devMode;if(!e)return;const t=this.yDocumentManagementFlow.getText(e);t&&this.workersProvider.prettify(t.toString(),e,(async t=>{await this.yDocumentManagementFlow.replaceText(e,t)}),(()=>{this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Failed to run prettier, please check the syntax.")}))}},zN=(0,s.Z)(HN.prototype,"projectUIState",[RN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YN=(0,s.Z)(HN.prototype,"workersProvider",[ZN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VN=(0,s.Z)(HN.prototype,"projectDoc",[LN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WN=(0,s.Z)(HN.prototype,"notificationsManagementFlow",[$N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KN=(0,s.Z)(HN.prototype,"yDocumentManagementFlow",[BN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GN=HN));var qN,JN,XN,QN,ej,tj,oj,nj,ij,rj,sj,aj=o(497134),cj=o(118872);qN=(0,c.provide)("themeSelectionFlow"),JN=(0,c.inject)("projectDoc"),XN=(0,c.inject)("fontsInProjectFlow"),QN=(0,c.inject)("projectClassManagementFlow"),ej=(0,c.inject)("designLanguageManagementFlow"),qN((oj=class{constructor(){(0,i.Z)(this,"projectDoc",nj,this),(0,i.Z)(this,"fontsInProjectFlow",ij,this),(0,i.Z)(this,"projectClassManagementFlow",rj,this),(0,i.Z)(this,"designLanguageManagementFlow",sj,this)}getSelectedTheme(){return this.projectDoc.selectedTheme}setThemeVariant(e){const{doc:t,variant:o}=e;t&&t.selectedTheme&&(t.selectedTheme.variant=o,this.changeVariant(o,t),y.Z.mixpanelEvent(y.Z.AnalyticsEvents.SIDEBAR_THEME_SELECTOR_THEME_VARIANT_CHANGE,{theme:t.selectedTheme.name,mode:o}))}changeVariant(e,t){if(!t.selectedTheme)return;const o=(0,aj.Ih)(t.selectedTheme.name,e),{defaultTokens:n}=o,i=Object.values(t.designLanguage.categoriesById).find((e=>e.name===cj.zF));i&&n.forEach((o=>{var n;const r=Object.values(t.designLanguage.tokensById).find((e=>e.name===o.name&&e.categoryId===i.id));if(r){if(null!==(n=t.selectedTheme)&&void 0!==n&&n.overrideColors){var s,a,c,l;const n=t.selectedTheme.name,i=null===(s=t.selectedTheme)||void 0===s||null===(a=s.customColors)||void 0===a||null===(c=a[n])||void 0===c||null===(l=c[e])||void 0===l?void 0:l[o.name];if(i)return void t.designLanguage.editTokenValue(r.id,i)}t.designLanguage.editTokenValue(r.id,o.value)}}))}setTheme(e){const{doc:t,theme:o}=e;t&&t.selectedTheme&&(t.selectedTheme.name=o,this.changeTheme(o,t),y.Z.mixpanelEvent(y.Z.AnalyticsEvents.SIDEBAR_THEME_SELECTOR_THEME_CHANGE,{theme:o,mode:t.selectedTheme.variant}))}changeTheme(e,t){if(!t.selectedTheme)return;const o=(0,aj.Ih)(e,t.selectedTheme.variant),{defaultTokens:n}=o;n.forEach((o=>{var n;const i=Object.values(t.designLanguage.categoriesById).find((e=>e.name===cj.zF));if(!i)return;const r=Object.values(t.designLanguage.tokensById).find((e=>e.name===o.name&&e.categoryId===i.id));if(r){if(null!==(n=t.selectedTheme)&&void 0!==n&&n.overrideColors){var s,a,c,l;const n=t.selectedTheme.variant,i=null===(s=t.selectedTheme)||void 0===s||null===(a=s.customColors)||void 0===a||null===(c=a[e])||void 0===c||null===(l=c[n])||void 0===l?void 0:l[o.name];if(i)return void t.designLanguage.editTokenValue(r.id,i)}t.designLanguage.editTokenValue(r.id,o.value)}}));const{googleFonts:i}=(0,aj.Os)(e,t.selectedTheme.variant),r=t.classes.getAll().filter((e=>e instanceof np.J&&e.getName().includes("thq-heading")));let s="";const a=[];r.forEach((e=>{var t,o;s=(null===(t=e.content)||void 0===t||null===(o=t.fontFamily)||void 0===o?void 0:o.content)||"auto",a.push(e.id),this.projectClassManagementFlow.addOrUpdate({oldKey:"fontFamily",classId:e.id,key:"fontFamily",value:i.headings,identifier:"desktop"})})),this.fontsInProjectFlow.addFont({fontName:i.headings,classIds:a});const c=t.fonts.getFontByName(s);c&&(t.fonts.updateFontUsageById(c.id,{classIds:a},"remove"),this.fontsInProjectFlow.removeUnUsedFonts({doc:t}));const l=t.classes.getAll().filter((e=>e instanceof np.J&&e.getName().includes("thq-body")));let d="";const p=[];l.forEach((e=>{var t,o;d=(null===(t=e.content)||void 0===t||null===(o=t.fontFamily)||void 0===o?void 0:o.content)||"auto",p.push(e.id),this.projectClassManagementFlow.addOrUpdate({oldKey:"fontFamily",classId:e.id,key:"fontFamily",value:i.body,identifier:"desktop"})})),this.fontsInProjectFlow.addFont({fontName:i.body,classIds:p});const u=t.fonts.getFontByName(d);u&&(t.fonts.updateFontUsageById(u.id,{classIds:p},"remove"),this.fontsInProjectFlow.removeUnUsedFonts({doc:t}))}setCustomColorValueForThemeToken(e){const{doc:t}=e;if(!t||!t.selectedTheme)return;const{themeName:o,variant:n,tokenName:i,tokenId:r,value:s}=e;t.selectedTheme.customColors||(t.selectedTheme.customColors={}),t.selectedTheme.customColors[o]||(t.selectedTheme.customColors[o]={}),t.selectedTheme.customColors[o][n]||(t.selectedTheme.customColors[o][n]={});t.selectedTheme.customColors[o][n][i]=s,this.designLanguageManagementFlow.editTokenValue({id:r,newValue:s,doc:t})}toggleCustomTheme(e){const{doc:t,value:o}=e;t&&t.selectedTheme&&(t.selectedTheme.overrideColors=o,this.setTheme({theme:t.selectedTheme.name,doc:t}))}},nj=(0,s.Z)(oj.prototype,"projectDoc",[JN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ij=(0,s.Z)(oj.prototype,"fontsInProjectFlow",[XN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rj=(0,s.Z)(oj.prototype,"projectClassManagementFlow",[QN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sj=(0,s.Z)(oj.prototype,"designLanguageManagementFlow",[ej],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(oj.prototype,"setThemeVariant",[m.P],Object.getOwnPropertyDescriptor(oj.prototype,"setThemeVariant"),oj.prototype),(0,s.Z)(oj.prototype,"setTheme",[m.P],Object.getOwnPropertyDescriptor(oj.prototype,"setTheme"),oj.prototype),(0,s.Z)(oj.prototype,"setCustomColorValueForThemeToken",[m.P],Object.getOwnPropertyDescriptor(oj.prototype,"setCustomColorValueForThemeToken"),oj.prototype),(0,s.Z)(oj.prototype,"toggleCustomTheme",[m.P],Object.getOwnPropertyDescriptor(oj.prototype,"toggleCustomTheme"),oj.prototype),tj=oj));var lj,dj,pj,uj,hj,mj,yj,gj,fj,bj,Ij,vj,wj,Nj,jj,Sj,Dj,Tj,Oj,Fj,Cj;function Ej(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function xj(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ej(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ej(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}lj=(0,c.provide)("migrationsFlow"),dj=(0,c.inject)("projectClassManagementFlow"),pj=(0,c.inject)("projectDoc"),uj=(0,c.inject)("guardsService"),hj=(0,c.inject)("sharedbProjectSyncService"),mj=(0,c.inject)("folderManagementFlow"),yj=(0,c.inject)("backupRepository"),gj=(0,c.inject)("sentryService"),fj=(0,c.inject)("projectUIState"),bj=(0,c.inject)("dashboardDA"),lj((vj=class{constructor(){(0,i.Z)(this,"projectClassManagementFlow",wj,this),(0,i.Z)(this,"projectDoc",Nj,this),(0,i.Z)(this,"guardsService",jj,this),(0,i.Z)(this,"dbSync",Sj,this),(0,i.Z)(this,"folderManagementFlow",Dj,this),(0,i.Z)(this,"backupRepository",Tj,this),(0,i.Z)(this,"sentryService",Oj,this),(0,i.Z)(this,"projectUIState",Fj,this),(0,i.Z)(this,"dashboardDA",Cj,this),(0,r.Z)(this,"migrateRichTextProps",(()=>{var e;null!==(e=this.projectDoc.migrationsThatHaveRun)&&void 0!==e&&e.richTextProps||this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{Object.values(e.components.byId).forEach((t=>{Object.values((null===t||void 0===t?void 0:t.propDefinitions)||{}).forEach((t=>{if(!t.defaultHierarchyRootId)return;const o=e.nodes.getById(t.defaultHierarchyRootId);if(!o||!("childrenIds"in o))return;const n=e.nodes.getById(Object.keys(o.childrenIds||{})[0]);if(!n||"element-node"!==n.type)return;Object.keys(t.locations).forEach((t=>{const o=e.nodes.getById(t);o&&(e.copyStylesFromSourceNode({targetId:t,sourceId:n.id}),n.semanticType&&o.semanticType!==n.semanticType&&(o.semanticType=n.semanticType))})),n.semanticType=null,n.styles={},n.referencedStyles={},Object.values(e.classes.byId).forEach((e=>{"simple"===e.classType&&delete e.usedInNodes[n.id]})),Object.values(e.designLanguage.tokensById).forEach((e=>{delete e.usedInNodes[n.id]})),Object.values(e.assets.byId).forEach((e=>{delete e.usedInNodes[n.id]})),Object.values(e.fonts.byId).forEach((e=>{delete e.usedInNodes[n.id]}))})),Object.keys((null===t||void 0===t?void 0:t.instantiatedByNodes)||{}).forEach((t=>{const o=e.nodes.getById(t);"component-instance-node"===(null===o||void 0===o?void 0:o.type)&&Object.values(o.attrs).forEach((t=>{if("hierarchy"!==t.type)return;const o=e.nodes.getById(t.content);if(!o||!("childrenIds"in o))return;const n=e.nodes.getById(Object.keys(o.childrenIds||{})[0]);n&&"element-node"===n.type&&(n.semanticType=null,n.styles={},n.referencedStyles={},Object.values(e.classes.byId).forEach((e=>{"simple"===e.classType&&delete e.usedInNodes[n.id]})),Object.values(e.designLanguage.tokensById).forEach((e=>{delete e.usedInNodes[n.id]})),Object.values(e.assets.byId).forEach((e=>{delete e.usedInNodes[n.id]})),Object.values(e.fonts.byId).forEach((e=>{delete e.usedInNodes[n.id]})))}))}))})),e.migrationsThatHaveRun=xj(xj({},e.migrationsThatHaveRun),{},{richTextProps:!0})}))}))})),(0,r.Z)(this,"migratePrimaryCategoryToThqDefault",(()=>{var e;null!==(e=this.projectDoc.migrationsThatHaveRun)&&void 0!==e&&e.primaryCategoryToThqDefault||this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{const t=Object.values(e.classes.categoriesById);if(1!==t.length||t.find((e=>e.isDefault)))return void(e.migrationsThatHaveRun=xj(xj({},e.migrationsThatHaveRun),{},{primaryCategoryToThqDefault:!0}));const o=t[0];o?(o.name=Qd.m8[0].name,o.isDefault=!0,Object.values(e.classes.byId).forEach((t=>{"simple"===t.classType&&(t.isDefault?this.projectClassManagementFlow.moveClassToCategory({classId:t.id,categoryId:o.id,doc:e}):this.projectClassManagementFlow.moveClassToCategory({classId:t.id,categoryId:"Uncategorized",doc:e}))})),e.migrationsThatHaveRun=xj(xj({},e.migrationsThatHaveRun),{},{primaryCategoryToThqDefault:!0})):e.migrationsThatHaveRun=xj(xj({},e.migrationsThatHaveRun),{},{primaryCategoryToThqDefault:!0})}))}))})),(0,r.Z)(this,"runMigrationForProjectAssets",(()=>{var e;if(null!==(e=this.projectDoc.migrationsThatHaveRun)&&void 0!==e&&e.assets)return;let t=this.projectDoc.folders.byId[ut.D.ASSETS],o=this.projectDoc.folders.byId[ut.D.PRIVATE_ASSETS],n=this.projectDoc.folders.byId[ut.D.PUBLIC_ASSETS];t||this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{t=e.folders.create({folderName:ut.D.ASSETS,folderId:ut.D.ASSETS,parentFolderId:null})}))})),o||this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{o=e.folders.create({folderName:ut.D.PRIVATE_ASSETS,folderId:ut.D.PRIVATE_ASSETS,parentFolderId:ut.D.ASSETS})}))})),n||this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{n=e.folders.create({folderName:ut.D.PUBLIC_ASSETS,folderId:ut.D.PUBLIC_ASSETS,parentFolderId:ut.D.ASSETS})}))}));const{name:i}=t;i!==ut.D.ASSETS&&this.folderManagementFlow.rename(t.id,ut.D.ASSETS);const r=this.projectDoc.assets.byId;Object.keys(r).forEach((e=>{const t=r[e],{parentFolderId:o}=t;o!==ut.D.ASSETS||t.id in this.projectDoc.folders.byId[ut.D.ASSETS].children||this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.folders.byId[ut.D.ASSETS].children=xj(xj({},e.folders.byId[ut.D.ASSETS].children),{[t.id]:"asset"})}))}));const n=Object.values(r).filter((e=>e.parentFolderId===ut.D.ASSETS));this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{n.forEach((t=>{e.assets.byId[t.id].parentFolderId=ut.D.PUBLIC_ASSETS,e.folders.byId[ut.D.PUBLIC_ASSETS].children=xj(xj({},e.folders.byId[ut.D.PUBLIC_ASSETS].children),{[t.id]:"asset"}),delete e.folders.byId[ut.D.ASSETS].children[t.id]}))}))}));const i=Object.values(this.projectDoc.folders.byId).filter((e=>e.parentId===ut.D.ASSETS&&e.id!==ut.D.PRIVATE_ASSETS&&e.id!==ut.D.PUBLIC_ASSETS));this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{i.forEach((t=>{e.folders.byId[t.id].parentId=ut.D.PUBLIC_ASSETS,e.folders.byId[ut.D.PUBLIC_ASSETS].children=xj(xj({},e.folders.byId[ut.D.PUBLIC_ASSETS].children),{[t.id]:"folder"}),delete e.folders.byId[ut.D.ASSETS].children[t.id]}))}))}))})),this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.migrationsThatHaveRun=xj(xj({},e.migrationsThatHaveRun),{},{assets:!0})}))}))})),(0,r.Z)(this,"_migrations",{assets:this.runMigrationForProjectAssets,primaryCategoryToThqDefault:this.migratePrimaryCategoryToThqDefault,richTextProps:this.migrateRichTextProps})}async createAutomatedBackup(e){var t,o,n,i;const r=null!==e&&void 0!==e?e:0,s=(null===(t=this.projectUIState)||void 0===t||null===(o=t.workspace)||void 0===o?void 0:o.id)||(null===(n=this.dashboardDA)||void 0===n||null===(i=n.getCurrentWorkspace())||void 0===i?void 0:i.id);if(!s)throw new Error("Could not create backup for project because no workspace is found!");try{await this.backupRepository.createAutomatedBackup(this.projectDoc.id,s)}catch(a){throw r<5&&await this.createAutomatedBackup(r+1),a}}async runAllMigrations(){const e=Object.keys(this._migrations).filter((e=>!Object.keys(this.projectDoc.migrationsThatHaveRun||{}).includes(e)));if(e.length){try{await this.createAutomatedBackup()}catch(t){return void this.sentryService.captureException(t,{type:Xo.U.CRITICAL})}e.forEach((e=>{try{this._migrations[e]()}catch(t){this.sentryService.captureException(new Error(`${(0,ni.kC)(e)} migration failed for project with id ${this.projectDoc.id}! Message: ${null===t||void 0===t?void 0:t.message}`))}}))}}},wj=(0,s.Z)(vj.prototype,"projectClassManagementFlow",[dj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nj=(0,s.Z)(vj.prototype,"projectDoc",[pj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jj=(0,s.Z)(vj.prototype,"guardsService",[uj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sj=(0,s.Z)(vj.prototype,"dbSync",[hj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dj=(0,s.Z)(vj.prototype,"folderManagementFlow",[mj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tj=(0,s.Z)(vj.prototype,"backupRepository",[yj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oj=(0,s.Z)(vj.prototype,"sentryService",[gj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fj=(0,s.Z)(vj.prototype,"projectUIState",[fj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cj=(0,s.Z)(vj.prototype,"dashboardDA",[bj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ij=vj));o(968848);var _j,Mj,Pj,Aj,kj,Uj,Rj,Zj,Lj,$j,Bj,Gj,Hj,zj,Yj,Vj,Wj,Kj,qj,Jj,Xj,Qj,eS,tS,oS,nS,iS,rS=o(446909),sS=o(276635);function aS(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function cS(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?aS(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):aS(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}_j=(0,c.provide)("propDefinitionManagementFlow"),Mj=(0,c.inject)("projectDoc"),Pj=(0,c.inject)("projectUIState"),Aj=(0,c.inject)("nodeAttributeManagmentFlow"),kj=(0,c.inject)("nodeAbilityManagmentFlow"),Uj=(0,c.inject)("nodeEditingFlow"),Rj=(0,c.inject)("nodeEventManagmentFlow"),Zj=(0,c.inject)("stateDefinitionManagementFlow"),Lj=(0,c.inject)("nodeSelectionFlow"),$j=(0,c.inject)("nodeManagementFlow"),Bj=(0,c.inject)("selfHealingFlow"),Gj=(0,c.inject)("notificationsManagementFlow"),Hj=(0,c.inject)("sentryService"),_j((Yj=class{constructor(){(0,i.Z)(this,"projectDoc",Vj,this),(0,i.Z)(this,"projectUIState",Wj,this),(0,i.Z)(this,"nodeAttributeManagmentFlow",Kj,this),(0,i.Z)(this,"nodeAbilityManagmentFlow",qj,this),(0,i.Z)(this,"nodeEditingFlow",Jj,this),(0,i.Z)(this,"nodeEventManagmentFlow",Xj,this),(0,i.Z)(this,"stateDefinitionManagementFlow",Qj,this),(0,i.Z)(this,"nodeSelectionFlow",eS,this),(0,i.Z)(this,"nodeManagementFlow",tS,this),(0,i.Z)(this,"selfHealingFlow",oS,this),(0,i.Z)(this,"notificationsManagementFlow",nS,this),(0,i.Z)(this,"sentryService",iS,this),(0,r.Z)(this,"CMSMainFlow",q.c.Instance),(0,r.Z)(this,"getResolvedNodeData",((e,t)=>{const o=this.generateDynamicResolver(e.id,t);return cS(cS({},e),{},{attrs:(0,rS.RY)(e,o),abilities:(0,rS.VM)(e,o),contentChildren:(0,rS.ZR)(e,o)})})),(0,r.Z)(this,"generateDynamicResolver",((e,t)=>o=>this.resolveDynamicValue(o,"root"!==e?e:void 0,"root"!==t?t:void 0))),(0,r.Z)(this,"getPropsCurrentValues",(e=>{if(!e)return null;const t=this.projectDoc.components.byId[e];if(!t)return null;const{propDefinitions:o}=t;return Object.keys(o).reduce(((t,n)=>{var i;const r=null===(i=this.projectUIState.componentList.propValues[e])||void 0===i?void 0:i[n];return r||o[n]?(t[n]={id:n,type:o[n].type,value:(null===r||void 0===r?void 0:r.value)||o[n].defaultValue,name:o[n].name,meta:{highlightInTreeView:!(null===r||void 0===r||!r.meta.highlightInTreeView)},componentInstanceValues:cS({},null===r||void 0===r?void 0:r.componentInstanceValues)},t):t}),{})})),(0,r.Z)(this,"updatePropDefinitionInternalValue",((e,t,o)=>{var n;const i=this.projectUIState.selection.componentId;if(!i)return;const r=null===(n=this.projectDoc.components.byId[i])||void 0===n?void 0:n.propDefinitions[e];r&&(0,a.mutate)(this.projectUIState,(n=>{var s;if(null===(s=n.componentList.propValues[i])||void 0===s||!s[e])return void(n.componentList.propValues[i][e]={id:r.id,type:r.type,value:null!==t&&void 0!==t?t:r.defaultValue,name:r.name,meta:{highlightInTreeView:!1},componentInstanceValues:{}});if(null!==o&&void 0!==o&&o.length)try{const r=JSON.parse(JSON.stringify(n.componentList.propValues[i][e].value));(0,sS.set)(r,o,t),n.componentList.propValues[i][e].value=r}catch(c){this.sentryService.captureException(new Error(`Could not update prop internal value: ${null===c||void 0===c?void 0:c.message}`))}else n.componentList.propValues[i][e].value=t;const a=this.projectDoc.components.byId[i];a&&Object.keys(a.instantiatedByNodes).forEach((t=>{var o;(null===(o=n.componentList.propValues[i][e].componentInstanceValues)||void 0===o?void 0:o[t])||(n.componentList.propValues[i][e].componentInstanceValues[t]=r.defaultValue)}))}))})),(0,r.Z)(this,"resolveDynamicValue",((e,t,o)=>{if(!e||!e.content)return null;const{id:n,referenceType:i}=e.content;if("prop"!==i&&"state"!==i)throw new Error(`Unsupported dynamic prop type: ${i}`);let r=this.getNodeComponentPropDefinitions(t);if("state"===i&&(r=this.stateDefinitionManagementFlow.getNodeComponentStateDefinitions(t)),!r)throw new Error("Prop definitions not found in the parent component");const s=r[n];if(!s)return this.selfHealingFlow.replaceWithDefaultValuesOnNodeWithInexistentProp({nodeId:t,referenceKey:n});let a=s.defaultValue;if(o){const e=this.projectDoc.nodes.getById(o);if(!e)throw new Error(`Attempted to render a dynamic prop and the root node was not found: ${o}`);const t=(0,tl.Uq)(e,s.name);if(t){if("static"!==t.type)throw new Error(`The value that was set on key ${s.name} was not a static value. This means we have a dynamic value being set as the attrs of another dynamic value. This case is not supported yet and might require a re-write of the rendering system.`);if("string"!==typeof t.content&&"number"!==typeof t.content)throw new Error("The value of attrValue.content was not a string or number. This case is not supported yet and might require a re-write of the rendering system.");a=t.content}}return new Yr.F({content:a})}))}getPropDefForDynamicNode(e,t){var o;const n=this.projectDoc.getComponentIdForNode(e.id);if(!n)return;const i=null===(o=this.projectDoc.components.byId[n])||void 0===o?void 0:o.propDefinitions;if(!i)return;return i[t.content.id]}updatePropDefinition(e){const{doc:t,propId:o,propData:n}=e;if(!t)return;const i=e.compId||this.projectUIState.selection.componentId;if(!i)throw new Error("Component id not found");const r=t.components.byId[i];if(!r)throw new Error("Component not found while trying to update prop definition");const{name:s}=n,a=r.propDefinitions[o];if(s){const e=r.getUniquePropDefinitionName(s);if(Object.keys(r.instantiatedByNodes).forEach((o=>{const n=t.nodes.getById(o);if(!n)return;const i=(0,tl.Uq)(n,a.name);if(!i||!("attrs"in n)||!n.attrs)return;const r=n.attrs;"comp-style"===i.type?r[e]=new Dd.j(i.content):r[e]="clone"in i?i.clone():cS({},i),delete n.attrs[a.name]})),"func"===a.type){Object.keys(a.locations).map((e=>Object.values(a.locations[e]).map((t=>({nodeId:e,supportedEvent:t.sufix}))))).flat().forEach((({nodeId:e,supportedEvent:n})=>{const i=t.nodes.getById(e);i&&"events"in i&&Object.values(i.events[n]).forEach((e=>{const t="propCall"===e.type;e.id===o&&t&&(e.calls=s)}))}))}}if(n.defaultValue&&"string"===typeof a.defaultValue&&"string"===typeof n.defaultValue){const e=t.assets.byId[a.defaultValue],o=t.assets.byId[n.defaultValue];if((null===e||void 0===e?void 0:e.id)!==(null===o||void 0===o?void 0:o.id)){Object.keys(a.locations).forEach((t=>{null===e||void 0===e||e.removeNodeRelation(t)}));const t=n.locations||a.locations;Object.keys(t).forEach((e=>{null===o||void 0===o||o.createNodeRelation(e)}))}}n.defaultValue&&jd.iz.includes(a.type)&&this.updatePropDefinitionInternalValue(a.id,n.defaultValue),r.updatePropDefinition(o,n)}addPropLocationForNode(e){const{doc:t,nodeId:o,propId:n,location:i}=e;if(!t)return;const r=this.projectUIState.selection.componentId;if(!r)throw new Error("No selected component");const s=t.components.byId[r];if(!s)throw new Error("Component not found while trying to update prop definition");s.addLocationToPropDefinition(n,o,i)}removePropLocationForNode(e){var t;const{doc:o,nodeId:n,propId:i,location:r}=e;if(!o)return;const s=null===(t=Object.values(o.components.byId).find((e=>e&&Object.keys(e.propDefinitions).includes(i))))||void 0===t?void 0:t.id;if(!s)throw new Error("No selected component");const a=o.components.byId[s];if(!a)throw new Error("Component not found while trying to update prop definition");const c=a.propDefinitions[i];null!==c&&void 0!==c&&c.locations[n]&&a.removeLocationFromPropDefinition(i,n,r)}convertAllStringPropDefinitionsToRichText(e){const{doc:t}=e;if(!t)return;const o=Object.values(t.components.byId);for(const n of o)n&&Object.values(n.propDefinitions).forEach((e=>{this.convertStringPropToRichText({prop:e,component:n,doc:t})}))}removePropDefinition(e){const{locations:t,affectedNodes:o,propId:n,doc:i}=e;if(!i)return;const r=this.projectUIState.selection.componentId;if(!r)throw new Error("No selected component");const s=i.components.byId[r];if(!s)throw new Error("Component not found while trying to update prop definition");const c=s.propDefinitions[n],l=c.defaultValue,d=c.name;null!==t&&void 0!==t&&t.length&&this.handleUnlinkProp({locations:t,affectedNodes:o,defaultPropValue:l,propName:d,defaultHierarchyRootId:c.defaultHierarchyRootId,propId:n,doc:i}),c.defaultHierarchyRootId&&(i.deleteNodesById({nodeIds:[c.defaultHierarchyRootId],withSubtree:!0}),Object.keys(s.instantiatedByNodes).forEach((e=>{const t=i.nodes.getById(e);if(!t||"component-instance-node"!==t.type)return;const o=(0,tl.Uq)(t,c.name);o&&(i.deleteNodesById({nodeIds:[o.content],withSubtree:!0}),delete t.attrs[c.name])}))),Object.keys(s.instantiatedByNodes).forEach((e=>{const t=i.nodes.getById(e);if(!t||"component-instance-node"!==t.type)return;(0,tl.Uq)(t,c.name)&&delete t.attrs[c.name]})),s.removePropDefinitionFromComp([n]),(0,a.mutate)(this.projectUIState,(e=>{var t;null!==(t=e.componentList.propValues[s.id])&&void 0!==t&&t[n]&&delete e.componentList.propValues[s.id][n]}))}removePropDefinitions(e){const{doc:t,propIds:o}=e;t&&o.forEach((e=>{this.removePropDefinition({propId:e,doc:t})}))}createPropDefinition(e){const{propData:t,componentId:o,doc:n}=e;if(!n)return;if(void 0===t.defaultValue||!t.type)return void this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not create Prop Definition, required fields are missing. Please try again.");const i=t.inputType||(0,rS.oI)(t.type),r=o||this.projectUIState.selection.componentId,s=n.components.byId[r||""];if(!s)return;const c=(0,ni.Ox)();if("richtext"===t.type){const e=(0,ni.Ox)(),o=new lu.HX({id:e,semanticType:Zn.sO.FRAGMENT,primitiveType:Zn.sO.FRAGMENT,meta:{isPropRoot:{compId:s.id,prop:c}}}),i=new Yr.F({content:t.defaultValue}),r=new lu.HX({contentChildren:{[i.id]:i},primitiveType:Zn.sO.TEXT,parentId:o.id});n.nodes.add(o),n.nodes.add(r),t.defaultHierarchyRootId=o.id}const l=cS(cS({},t),{},{type:t.type,locations:{},name:t.name||"newProp",declarationType:"prop",inputType:i,defaultValue:t.defaultValue,id:c}),p=s.createPropDefinition(l);return(0,a.mutate)(this.projectUIState,(e=>{e.dynamicNodeInteractionsData.selectedPropId=p.id,e.componentList.propValues[s.id][p.id]={id:p.id,type:p.type,value:p.defaultValue,name:p.name,meta:{highlightInTreeView:!1},componentInstanceValues:{}}})),p}handleUnlinkProp(e){const{doc:t,locations:o,defaultPropValue:n,defaultHierarchyRootId:i,propName:r,propId:s}=e;if(!t)return;let{affectedNodes:a}=e;a||(a=this.projectUIState.selection.compInstanceId?[this.projectUIState.selection.compInstanceId]:this.nodeSelectionFlow.getSelectedNodesIds()),o.map(((e,o)=>{var c;switch(e.base){case jd.hD.ATTR:if(a&&this.nodeAttributeManagmentFlow.removeAttrByKey({nodeId:a[o],key:e.sufix||"",defaultPropValue:n,doc:t}),i&&e.sufix){var l,d;const n=t.nodes.getById(null!==(l=null===(d=a)||void 0===d?void 0:d[o])&&void 0!==l?l:"");if(n&&"attrs"in n&&n.attrs){const o=t.cloneRichTextHierarchy({doc:t,rootNodeId:i,meta:{isAttributeRoot:{nodeId:n.id,attr:e.sufix}}});n.attrs[e.sufix]={id:(0,ni.Ox)(),type:"hierarchy",content:`${o}`,pristine:!0}}}break;case jd.hD.ABILITY:a&&"string"===typeof n&&this.nodeAbilityManagmentFlow.removeNodeLink({nodeId:a[o],linkLocations:[e.sufix||""],removeOnlyProp:!0,defaultPropValue:n,doc:t});break;case jd.hD.HTML_CONTENT:var p;if(a&&this.nodeEditingFlow.replaceDynamicCmsRichTextContentWithDefaultValue({nodeId:a[o],doc:t}),s)this.removePropLocationForNode({nodeId:(null===(p=a)||void 0===p?void 0:p[o])||"",propId:s,location:e,doc:t});break;case jd.hD.CONTENT:if(i){var u,h,m;if(null!==(u=a)&&void 0!==u&&u[o])if(this.nodeEditingFlow.replaceDynamicContentWithHierarchy({nodeId:null===(h=a)||void 0===h?void 0:h[o],hierarchyRootId:i,doc:t}),s)this.removePropLocationForNode({nodeId:null===(m=a)||void 0===m?void 0:m[o],propId:s,location:e,doc:t});break}a&&(this.nodeEditingFlow.replaceDynamicContentWithDefaultValue({nodeId:a[o],defaultValue:n,doc:t}),s&&this.removePropLocationForNode({nodeId:a[o],propId:s,location:e,doc:t}));break;case jd.hD.EVENT:a&&e.sufix&&this.nodeEventManagmentFlow.removeAllEventsByType({nodeIds:a,supportedEvent:e.sufix,propName:r,doc:t});break;case jd.hD.CMS_LIST_FILTER:a&&this.CMSMainFlow.unlinkPropOrStateFromFilteringAttributeForNodeIds({nodeIds:a,propOrStateId:s,defaultValue:n,doc:t});case jd.hD.CONDITIONAL:null===(c=a)||void 0===c||c.forEach((e=>{this.nodeManagementFlow.removeRenderingCondition({nodeId:e,doc:t})}));default:var y;if(e.base.includes(jd.hD.CONDITIONAL_STYLE)||e.base.includes("operand"))null===(y=a)||void 0===y||y.forEach((e=>{const o=t.nodes.getById(e);if(o){if("renderingConditions"in o){var n,i,r;const a=null===(n=o.renderingConditions)||void 0===n||null===(i=n.condition)||void 0===i||null===(r=i.conditions[0])||void 0===r?void 0:r.operand;if(a&&"object"===typeof a){a.content.id===s&&this.nodeManagementFlow.removeRenderingCondition({nodeId:e,doc:t})}}"conditionalReferencedProjectStyles"in o&&Object.keys(o.conditionalReferencedProjectStyles).forEach((n=>{var i,r,a;const c=o.conditionalReferencedProjectStyles[n];(null===c||void 0===c||null===(i=c.reference)||void 0===i?void 0:i.id)===s&&this.nodeManagementFlow.removeRenderingConditionForProjectStyle({nodeId:e,styleId:n,doc:t});const l=null===(r=c.condition)||void 0===r||null===(a=r.conditions[0])||void 0===a?void 0:a.operand;if(l&&"object"===typeof l){l.content.id===s&&this.nodeManagementFlow.removeRenderingConditionForProjectStyle({nodeId:e,styleId:n,doc:t})}}))}}));if(e.base.includes(jd.hD.STATE_CHANGE_EVENT)){var g;this.nodeEventManagmentFlow.getNodeEvents({nodeId:(null===(g=a)||void 0===g?void 0:g[o])||""}).forEach((e=>{var n;e.propDefinitionId===s&&this.nodeEventManagmentFlow.removeEventFromNode({nodeId:(null===(n=a)||void 0===n?void 0:n[o])||"",eventId:e.eventId||"",doc:t});if("object"===typeof e.newState){var i,r;const n=e.newState;var c;if("prop"===(null===(i=n.content)||void 0===i?void 0:i.referenceType)&&(null===(r=n.content)||void 0===r?void 0:r.id)===s)this.nodeEventManagmentFlow.removeEventFromNode({nodeId:(null===(c=a)||void 0===c?void 0:c[o])||"",eventId:e.eventId||"",doc:t})}}))}return}}))}getNodeComponentPropDefinitions(e){if(!e){const e=this.projectUIState.selection.componentId;if(!e)return null;const t=this.projectDoc.components.byId[e];return t?t.propDefinitions:null}const t=this.projectDoc.nodes.getComponentIdOf(e);if(!t)return null;const o=this.projectDoc.components.byId[t];return o?o.propDefinitions:null}convertStringPropToRichText(e){const{doc:t,prop:o,component:n}=e;if(!t)return;if("string"!==o.type)return;let i;if(Object.keys(o.locations).forEach((e=>{var t,n;(null===(t=o.locations[e])||void 0===t||null===(n=t.content)||void 0===n?void 0:n.base)===jd.hD.CONTENT&&(i=e)})),!i)return;const r=t.nodes.getById(i);if(!r||"element-node"!==r.type)return;const s={id:(0,ni.Ox)(),name:o.name,type:"string",inputType:jd.SO.RICH_TEXT},a=new lu.HX({id:(0,ni.Ox)(),semanticType:Zn.sO.FRAGMENT,primitiveType:Zn.sO.FRAGMENT,meta:{isPropRoot:{compId:n.id,prop:s.id}}}),c=new Yr.F({content:o.defaultValue}),l=new lu.HX({id:(0,ni.Ox)(),primitiveType:"button"===r.primitiveType?Zn.sO.TEXT:r.primitiveType,parentId:a.id,contentChildren:{[c.id]:c}});t.addNode(a),t.addNode(l);let d=r.id;if(r.primitiveType===Zn.sO.BUTTON){const e=new nr.P({content:{referenceType:"prop",id:s.id}}),o=new lu.HX({id:(0,ni.Ox)(),semanticType:Zn.RY.SPAN,primitiveType:Zn.sO.TEXT,parentId:r.id,contentChildren:{[e.id]:e}});t.addNode(o),r.childrenIds={[o.id]:!0},r.contentChildren={},d=o.id}else{const e=new nr.P({content:{referenceType:"prop",id:s.id}});r.contentChildren={[e.id]:e},r.childrenIds={}}const p=n.createPropDefinition(cS(cS({},s),{},{defaultValue:o.defaultValue,inputType:jd.SO.RICH_TEXT,defaultHierarchyRootId:a.id,type:"richtext",locations:{[d]:(0,Sd.B1)({base:jd.hD.CONTENT})}})),u=t.nodes.getById(a.id);u&&(u.rootOfPropHierarchy=p.id),Object.keys(n.instantiatedByNodes).forEach((e=>{const n=t.nodes.getById(e);if(!n||"component-instance-node"!==n.type)return;const i=t.cloneRichTextHierarchy({doc:t,rootNodeId:a.id,meta:{isAttributeRoot:{nodeId:d,attr:p.name}}});if(!i)return;let r=!0;const s=n.attrs[o.name],c=t.nodes.getById(i),l=t.nodes.getById(Object.keys((null===c||void 0===c?void 0:c.childrenIds)||{})[0]||"");if(s&&"static"===s.type){const e=s.clone();l&&(t.deleteNodesById({nodeIds:Object.keys(l.childrenIds)}),l.contentChildren={[e.id]:e}),r=!1}n.attrs[p.name]={id:(0,ni.Ox)(),type:"hierarchy",content:`${i}`,pristine:r}})),1===Object.keys(o.locations).length&&delete n.propDefinitions[o.id]}},Vj=(0,s.Z)(Yj.prototype,"projectDoc",[Mj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wj=(0,s.Z)(Yj.prototype,"projectUIState",[Pj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kj=(0,s.Z)(Yj.prototype,"nodeAttributeManagmentFlow",[Aj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qj=(0,s.Z)(Yj.prototype,"nodeAbilityManagmentFlow",[kj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jj=(0,s.Z)(Yj.prototype,"nodeEditingFlow",[Uj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xj=(0,s.Z)(Yj.prototype,"nodeEventManagmentFlow",[Rj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qj=(0,s.Z)(Yj.prototype,"stateDefinitionManagementFlow",[Zj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eS=(0,s.Z)(Yj.prototype,"nodeSelectionFlow",[Lj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tS=(0,s.Z)(Yj.prototype,"nodeManagementFlow",[$j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oS=(0,s.Z)(Yj.prototype,"selfHealingFlow",[Bj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nS=(0,s.Z)(Yj.prototype,"notificationsManagementFlow",[Gj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iS=(0,s.Z)(Yj.prototype,"sentryService",[Hj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Yj.prototype,"updatePropDefinition",[m.P],Object.getOwnPropertyDescriptor(Yj.prototype,"updatePropDefinition"),Yj.prototype),(0,s.Z)(Yj.prototype,"addPropLocationForNode",[m.P],Object.getOwnPropertyDescriptor(Yj.prototype,"addPropLocationForNode"),Yj.prototype),(0,s.Z)(Yj.prototype,"removePropLocationForNode",[m.P],Object.getOwnPropertyDescriptor(Yj.prototype,"removePropLocationForNode"),Yj.prototype),(0,s.Z)(Yj.prototype,"convertAllStringPropDefinitionsToRichText",[m.P],Object.getOwnPropertyDescriptor(Yj.prototype,"convertAllStringPropDefinitionsToRichText"),Yj.prototype),(0,s.Z)(Yj.prototype,"removePropDefinition",[m.P],Object.getOwnPropertyDescriptor(Yj.prototype,"removePropDefinition"),Yj.prototype),(0,s.Z)(Yj.prototype,"removePropDefinitions",[m.P],Object.getOwnPropertyDescriptor(Yj.prototype,"removePropDefinitions"),Yj.prototype),(0,s.Z)(Yj.prototype,"createPropDefinition",[m.P],Object.getOwnPropertyDescriptor(Yj.prototype,"createPropDefinition"),Yj.prototype),(0,s.Z)(Yj.prototype,"handleUnlinkProp",[m.P],Object.getOwnPropertyDescriptor(Yj.prototype,"handleUnlinkProp"),Yj.prototype),zj=Yj));const lS=e=>{let t;switch(e){case"boolean":t=jd.SO.BOOLEAN;break;case"number":t=jd.SO.NUMBER;break;case"string":t=jd.SO.TEXT;break;default:t=jd.SO.TEXT}return t};var dS,pS,uS,hS,mS,yS,gS,fS,bS,IS,vS,wS,NS,jS,SS,DS,TS,OS,FS,CS,ES;function xS(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function _S(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?xS(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):xS(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}dS=(0,c.provide)("stateDefinitionManagementFlow"),pS=(0,c.inject)("sharedbProjectSyncService"),uS=(0,c.inject)("projectDoc"),hS=(0,c.inject)("projectUIState"),mS=(0,c.inject)("nodeManagementFlow"),yS=(0,c.inject)("nodeEventManagmentFlow"),gS=(0,c.inject)("nodeAttributeManagmentFlow"),fS=(0,c.inject)("nodeEditingFlow"),bS=(0,c.inject)("notificationsManagementFlow"),IS=(0,c.inject)("sentryService"),dS((wS=class{constructor(){(0,i.Z)(this,"dbSync",NS,this),(0,i.Z)(this,"projectDoc",jS,this),(0,i.Z)(this,"projectUIState",SS,this),(0,i.Z)(this,"nodeManagementFlow",DS,this),(0,i.Z)(this,"nodeEventManagmentFlow",TS,this),(0,i.Z)(this,"nodeAttributeManagmentFlow",OS,this),(0,i.Z)(this,"nodeEditingFlow",FS,this),(0,i.Z)(this,"notificationsManagementFlow",CS,this),(0,i.Z)(this,"sentryService",ES,this),(0,r.Z)(this,"CMSMainFlow",q.c.Instance)}getStateDefForDynamicNode(e,t){var o;const n=this.projectDoc.getComponentIdForNode(e.id);if(!n)return;const i=null===(o=this.projectDoc.components.byId[n])||void 0===o?void 0:o.stateDefinitions;if(!i)return;return i[t.content.id]}getNodesBoundToStateDefinition(e){var t;const o=this.projectUIState.selection.componentId;if(!o)return[];const n=this.projectDoc.components.byId[o];if(!n)return[];const{rootNodeId:i}=n;if(!i)return[];const r=this.projectDoc.nodes.getNodeSubtreeIds(i),s=null===(t=n.stateDefinitions[e])||void 0===t?void 0:t.name;return r.filter((t=>{const o=this.projectDoc.nodes.getById(t);if(!o)return!1;const n="renderingConditions"in o&&o.renderingConditions&&o.renderingConditions.reference.content.id===s,i="contentChildren"in o&&o.contentChildren&&Object.values(o.contentChildren).find((t=>"dynamic"===t.type&&"state"===t.content.referenceType&&t.content.id===e)),r="attrs"in o&&o.attrs&&Object.values(o.attrs).find((t=>"dynamic"===t.type&&"state"===t.content.referenceType&&t.content.id===e));return n||i||r}))}getNodesBoundToStateChangeEvent(e){const t=this.projectUIState.selection.componentId;if(!t)return[];const o=this.projectDoc.getProjectPageOrComponent(t);if(!o||!o.rootNodeId)return[];const n=[];return this.projectDoc.nodes.bfs(o.rootNodeId,(t=>{if(!t||!("events"in t)||!Object.keys(t.events).length)return;const{events:o}=t;Object.keys(o).forEach((i=>{const r=o[i];Object.keys(r).forEach((o=>{r[o].id===e&&n.push({nodeId:t.id,eventId:o});const i=r[o];if("stateChange"===i.type&&"object"===typeof i.newState&&"content"in i.newState){const r=i.newState,s={nodeId:t.id,eventId:o};r.content.id===e&&-1===n.indexOf(s)&&n.push(s)}}))}))}),!0),n}createStateDefinition(e){const{doc:t,name:o,type:n,defaultValue:i}=e,r=this.projectUIState.selection.componentId;if(!t||!r)return;const s=t.getProjectPageOrComponent(r);if(!s)return void this.sentryService.captureException(`CreateStateDefinition skipped. Component by ${r} not found.`);const c=lS(n),l=s.createStateDefinition({name:o,type:n,defaultValue:i,locations:{},inputType:c,declarationType:"state"});(0,a.mutate)(this.projectUIState,(e=>{e.componentList.stateValues[s.id]||(e.componentList.stateValues[s.id]={}),e.componentList.stateValues[s.id][l.id]={id:l.id,type:l.type,value:l.defaultValue,name:o,meta:{highlightInTreeView:!1},componentInstanceValues:{}}}))}deleteStateDefinition(e){const{doc:t,stateId:o}=e,n=this.projectUIState.selection.componentId;if(!t||!n)return;const i=t.getProjectPageOrComponent(n);if(!i)return void this.sentryService.captureException(`DeleteStateDefinition skipped. Component by ${n} not found.`);const r=i.stateDefinitions[o];Object.entries(r.locations).forEach((e=>{const[n,i]=e;Object.values(i).forEach((e=>{this.handleUnlinkState({nodeId:n,location:e,stateId:o,defaultStateValue:r.defaultValue,doc:t})}))}));this.getNodesBoundToStateDefinition(o).forEach((e=>{this.nodeManagementFlow.removeRenderingCondition({nodeId:e,doc:t})}));this.getNodesBoundToStateChangeEvent(o).forEach((e=>this.nodeEventManagmentFlow.removeEventFromNode({nodeId:e.nodeId,eventId:e.eventId,doc:t}))),(0,a.mutate)(this.projectUIState,(e=>{delete e.componentList.stateValues[n][o]})),i.deleteStateDefinition(o)}updateStateDefinition(e){const{doc:t,stateId:o,stateData:n}=e;if(!t)return;const i=e.compId||this.projectUIState.selection.componentId;if(!i)throw new Error("Component id not found");const r=t.getProjectPageOrComponent(i);if(!r)throw new Error("Component not found while trying to update state definition");const{name:s}=n,a=r.stateDefinitions[o];s&&Object.keys(r instanceof Un.n?r.instantiatedByNodes:{}).forEach((e=>{const o=t.nodes.getById(e);if(!o)return;const n=(0,tl.Uq)(o,a.name);if(!n||!("attrs"in o)||!o.attrs)return;o.attrs[s]="clone"in n?n.clone():_S({},n),delete o.attrs[a.name]})),r.updateStateDefinition(o,n)}addStateLocationForNode(e){const{doc:t,nodeId:o,stateId:n,location:i}=e;if(!t)return;const r=this.projectUIState.selection.componentId;if(!r)throw new Error("No selected component");const s=t.getProjectPageOrComponent(r);if(!s)throw new Error("Component not found while trying to update prop definition");s.addLocationToStateDefinition(n,o,i)}removeStateLocationForNode(e){var t;const{doc:o,nodeId:n,stateId:i,location:r}=e;if(!o)return;const s=null===(t=Object.values(o.getAllPagesAndComponents()).find((e=>e&&Object.keys(e.stateDefinitions).includes(i))))||void 0===t?void 0:t.id;if(!s)throw new Error("No selected component");const a=o.getProjectPageOrComponent(s);if(!a)throw new Error("Component not found while trying to update prop definition");const c=a.stateDefinitions[i];null!==c&&void 0!==c&&c.locations[n]&&a.removeLocationFromStateDefinition(i,n,r)}handleUnlinkState(e){const{stateId:t,location:o,nodeId:n,defaultStateValue:i,doc:r}=e;if(r)switch(o.base){case jd.uw.ATTR:this.nodeAttributeManagmentFlow.removeAttrByKey({nodeId:n,key:o.sufix||"",defaultPropValue:i,doc:r});break;case jd.uw.CONTENT:this.nodeEditingFlow.replaceDynamicContentWithDefaultValue({nodeId:n,defaultValue:i.toString(),doc:r}),t&&this.removeStateLocationForNode({nodeId:n,stateId:t,location:o,doc:r});break;case jd.uw.CMS_LIST_FILTER:this.CMSMainFlow.unlinkPropOrStateFromFilteringAttributeForNodeIds({nodeIds:[n],defaultValue:i,propOrStateId:t,doc:r});break;case jd.uw.CONDITIONAL:this.nodeManagementFlow.removeRenderingCondition({nodeId:n,doc:r});break;default:if(o.base.includes(jd.uw.CONDITIONAL_STYLE)||o.base.includes("operand")){const e=this.projectDoc.nodes.getById(n);if(!e)return;if("renderingConditions"in e){var s,a,c;const o=null===(s=e.renderingConditions)||void 0===s||null===(a=s.condition)||void 0===a||null===(c=a.conditions[0])||void 0===c?void 0:c.operand;if(o&&"object"===typeof o){o.content.id===t&&this.nodeManagementFlow.removeRenderingCondition({nodeId:n,doc:r})}}if(!("conditionalReferencedProjectStyles"in e))return;Object.keys(e.conditionalReferencedProjectStyles).forEach((o=>{var i,s,a;const c=e.conditionalReferencedProjectStyles[o];(null===c||void 0===c||null===(i=c.reference)||void 0===i?void 0:i.id)===t&&this.nodeManagementFlow.removeRenderingConditionForProjectStyle({nodeId:n,styleId:o,doc:r});const l=null===(s=c.condition)||void 0===s||null===(a=s.conditions[0])||void 0===a?void 0:a.operand;if(l&&"object"===typeof l){l.content.id===t&&this.nodeManagementFlow.removeRenderingConditionForProjectStyle({nodeId:n,styleId:o,doc:r})}}))}}}getStateCurrentValues(e){if(!e)return null;const t=this.projectDoc.getProjectPageOrComponent(e);if(!t)return null;const{stateDefinitions:o}=t;return Object.keys(o).reduce(((t,n)=>{var i;const r=null===(i=this.projectUIState.componentList.stateValues[e])||void 0===i?void 0:i[n];return t[n]={id:n,type:o[n].type,value:(null===r||void 0===r?void 0:r.value)||o[n].defaultValue,name:o[n].name,meta:{highlightInTreeView:!(null===r||void 0===r||!r.meta.highlightInTreeView)},componentInstanceValues:_S({},null===r||void 0===r?void 0:r.componentInstanceValues)},t}),{})}updateStateDefinitionInternalValue(e,t){const o=this.projectUIState.selection.componentId;o&&(0,a.mutate)(this.projectUIState,(n=>{var i;if(null===(i=n.componentList.stateValues[o])||void 0===i||!i[e]){var r;const t=null===(r=this.projectDoc.getProjectPageOrComponent(o))||void 0===r?void 0:r.stateDefinitions[e];if(!t)return;return n.componentList.stateValues[o]||(n.componentList.stateValues[o]={}),void(n.componentList.stateValues[o][e]||(n.componentList.stateValues[o][e]={id:t.id,type:t.type,value:t.defaultValue,name:t.name,meta:{highlightInTreeView:!1},componentInstanceValues:{}}))}n.componentList.stateValues[o][e].value=t}))}updateStateDefinitionDefaultValue(e){var t;const{stateId:o,value:n,doc:i}=e,r=this.projectUIState.selection.componentId;if(!r||!i)return;const s=i.getProjectPageOrComponent(r);if(!s)return;const a=s.stateDefinitions[o];if(!a)return;const c=null===(t=this.projectUIState.componentList.stateValues[r])||void 0===t?void 0:t[o];(null===c||void 0===c?void 0:c.value)===a.defaultValue&&this.updateStateDefinitionInternalValue(o,n),a.defaultValue=n}toggleHighlightInTreeView(e,t){const o=this.projectUIState.selection.componentId;o&&(0,a.mutate)(this.projectUIState,(n=>{n.componentList.stateValues[o][e].meta.highlightInTreeView=t}))}setComponentInstanceStateValues(e,t,o){const n=this.projectDoc.nodes.getById(e);if(n&&!this.projectDoc.nodes.nodeIsCompInstance(n))return;const i=n.compIdOfCompInstance;(0,a.mutate)(this.projectUIState,(n=>{if(n.componentList.stateValues[i]||(n.componentList.stateValues[i]={}),!n.componentList.stateValues[i][t]){const e=this.getStateCurrentValues(i);n.componentList.stateValues[i][t]=e[t]}n.componentList.stateValues[i][t].componentInstanceValues=_S(_S({},n.componentList.stateValues[i][t].componentInstanceValues),{},{[e]:o})}))}getNodeComponentStateDefinitions(e){const t=e?this.projectDoc.nodes.getComponentIdOf(e):this.projectUIState.selection.componentId;if(!t)return null;const o=this.projectDoc.components.byId[t],n=this.getStateCurrentValues(t);return o?n?(Object.keys(o.stateDefinitions).map((e=>{o.stateDefinitions[e]=_S(_S({},o.stateDefinitions[e]),{},{defaultValue:n[e].componentInstanceValues[t]||n[e].value||o.stateDefinitions[e].defaultValue})})),o.stateDefinitions):o.stateDefinitions:null}},NS=(0,s.Z)(wS.prototype,"dbSync",[pS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jS=(0,s.Z)(wS.prototype,"projectDoc",[uS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SS=(0,s.Z)(wS.prototype,"projectUIState",[hS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DS=(0,s.Z)(wS.prototype,"nodeManagementFlow",[mS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TS=(0,s.Z)(wS.prototype,"nodeEventManagmentFlow",[yS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OS=(0,s.Z)(wS.prototype,"nodeAttributeManagmentFlow",[gS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FS=(0,s.Z)(wS.prototype,"nodeEditingFlow",[fS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CS=(0,s.Z)(wS.prototype,"notificationsManagementFlow",[bS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ES=(0,s.Z)(wS.prototype,"sentryService",[IS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(wS.prototype,"createStateDefinition",[m.P],Object.getOwnPropertyDescriptor(wS.prototype,"createStateDefinition"),wS.prototype),(0,s.Z)(wS.prototype,"deleteStateDefinition",[m.P],Object.getOwnPropertyDescriptor(wS.prototype,"deleteStateDefinition"),wS.prototype),(0,s.Z)(wS.prototype,"updateStateDefinition",[m.P],Object.getOwnPropertyDescriptor(wS.prototype,"updateStateDefinition"),wS.prototype),(0,s.Z)(wS.prototype,"addStateLocationForNode",[m.P],Object.getOwnPropertyDescriptor(wS.prototype,"addStateLocationForNode"),wS.prototype),(0,s.Z)(wS.prototype,"removeStateLocationForNode",[m.P],Object.getOwnPropertyDescriptor(wS.prototype,"removeStateLocationForNode"),wS.prototype),(0,s.Z)(wS.prototype,"handleUnlinkState",[m.P],Object.getOwnPropertyDescriptor(wS.prototype,"handleUnlinkState"),wS.prototype),(0,s.Z)(wS.prototype,"updateStateDefinitionDefaultValue",[m.P],Object.getOwnPropertyDescriptor(wS.prototype,"updateStateDefinitionDefaultValue"),wS.prototype),vS=wS));var MS;(0,c.provide)("webComponentsFlow")(MS=class{async register(){const[{SvgNodeInstanceWrapperWebComponent:e},{TextNodeInstanceWrapperWebComponent:t},{TeleportZoomableContainer:n},{EmbedNodeWrapperWebComponent:i},{LottieNodeWrapperWebComponent:r},{InteractiveNodeWrapperWebComponent:s},{DevComponentWebComponent:a},{IframeNodeWebComponent:c},{CmsHtmlNodeWrapperWebComponent:l},{StandaloneRichTextEditor:d}]=await Promise.all([Promise.all([o.e(72755),o.e(46677)]).then(o.bind(o,146677)),Promise.all([o.e(96615),o.e(77352),o.e(1092)]).then(o.bind(o,1092)),Promise.all([o.e(72755),o.e(59410)]).then(o.bind(o,559410)),o.e(81951).then(o.bind(o,881951)),o.e(46338).then(o.bind(o,946338)),Promise.all([o.e(23163),o.e(21982)]).then(o.bind(o,421982)),o.e(56305).then(o.bind(o,756305)),o.e(77938).then(o.bind(o,477938)),o.e(32770).then(o.bind(o,232770)),Promise.all([o.e(96615),o.e(77352),o.e(69029)]).then(o.bind(o,469029))]);e.registerSelf(),t.registerSelf(),n.registerSelf(),i.registerSelf(),l.registerSelf(),s.registerSelf(),r.registerSelf(),a.registerSelf(),c.registerSelf(),d.registerSelf()}async registerPreviewComponents(){const[{EmbedNodeWrapperWebComponent:e},{LottieNodeWrapperWebComponent:t},{CmsHtmlNodeWrapperWebComponent:n}]=await Promise.all([o.e(81951).then(o.bind(o,881951)),o.e(46338).then(o.bind(o,946338)),o.e(32770).then(o.bind(o,232770))]);e.registerSelf(),t.registerSelf(),n.registerSelf()}});var PS={importmap:{imports:{"prop-types":"https://ga.jspm.io/npm:prop-types@15.7.2/index.js",react:"https://ga.jspm.io/npm:react@17.0.2/index.js","react-dom":"https://ga.jspm.io/npm:react-dom@17.0.2/index.js","react-helmet":"https://ga.jspm.io/npm:react-helmet@6.1.0/lib/Helmet.js","react-router":"https://ga.jspm.io/npm:react-router@5.2.1/esm/react-router.js","react-router-dom":"https://ga.jspm.io/npm:react-router-dom@5.3.0/esm/react-router-dom.js"},scopes:{"https://ga.jspm.io/":{"@babel/runtime/helpers/esm/extends":"https://ga.jspm.io/npm:@babel/runtime@7.16.5/helpers/esm/extends.js","@babel/runtime/helpers/esm/inheritsLoose":"https://ga.jspm.io/npm:@babel/runtime@7.16.5/helpers/esm/inheritsLoose.js","@babel/runtime/helpers/esm/objectWithoutPropertiesLoose":"https://ga.jspm.io/npm:@babel/runtime@7.16.5/helpers/esm/objectWithoutPropertiesLoose.js","@babel/runtime/helpers/inheritsLoose":"https://ga.jspm.io/npm:@babel/runtime@7.16.5/helpers/inheritsLoose.js",history:"https://ga.jspm.io/npm:history@4.10.1/index.js","hoist-non-react-statics":"https://ga.jspm.io/npm:hoist-non-react-statics@3.3.2/dist/hoist-non-react-statics.cjs.js",isarray:"https://ga.jspm.io/npm:isarray@0.0.1/index.js","mini-create-react-context":"https://ga.jspm.io/npm:mini-create-react-context@0.4.1/dist/cjs/index.js","object-assign":"https://ga.jspm.io/npm:object-assign@4.1.1/index.js","path-to-regexp":"https://ga.jspm.io/npm:path-to-regexp@1.8.0/index.js","react-fast-compare":"https://ga.jspm.io/npm:react-fast-compare@3.2.0/index.js","react-is":"https://ga.jspm.io/npm:react-is@16.13.1/index.js","react-side-effect":"https://ga.jspm.io/npm:react-side-effect@2.1.1/lib/index.js","resolve-pathname":"https://ga.jspm.io/npm:resolve-pathname@3.0.0/index.js",scheduler:"https://ga.jspm.io/npm:scheduler@0.20.2/index.js","tiny-invariant":"https://ga.jspm.io/npm:tiny-invariant@1.1.0/dist/tiny-invariant.cjs.js","tiny-warning":"https://ga.jspm.io/npm:tiny-warning@1.0.3/dist/tiny-warning.esm.js","value-equal":"https://ga.jspm.io/npm:value-equal@1.0.1/index.js"}}}},AS=o(147717);const kS=["package","tsconfig",".eslintrc","babel.config","global.d","tailwind.config.js","postcss.config.js","teleport.config.json"],US=["teleporthq","webpack"],RS=(e,t)=>e.includes("/teleporthq/")||US.some((t=>e.includes(t)))||kS.includes(t);var ZS,LS,$S,BS,GS,HS,zS,YS,VS,WS,KS,qS,JS,XS,QS,eD,tD,oD,nD,iD,rD,sD,aD,cD,lD,dD,pD,uD,hD,mD,yD,gD,fD,bD,ID,vD,wD,ND,jD,SD,DD,TD,OD,FD,CD,ED,xD,_D,MD,PD,AD,kD,UD;function RD(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function ZD(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?RD(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):RD(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}ZS=(0,c.provide)("projectFilesFlow"),LS=(0,c.inject)("projectDoc"),$S=(0,c.inject)("projectUIState"),BS=(0,c.inject)("projectDownloadFlow"),GS=(0,c.inject)("assetsService"),HS=(0,c.inject)("packerService"),zS=(0,c.inject)("localHistoryStackFlow"),YS=(0,c.inject)("sharedbProjectSyncService"),VS=(0,c.inject)("modalManagementFlow"),WS=(0,c.inject)("assetsEditFlow"),KS=(0,c.inject)("assetsManagementFlow"),qS=(0,c.inject)("bundlerService"),JS=(0,c.inject)("navbarFlow"),XS=(0,c.inject)("codeEditorFlow"),QS=(0,c.inject)("yDocumentManagementFlow"),eD=(0,c.inject)("guardsService"),tD=(0,c.inject)("tailwindService"),oD=(0,c.inject)("propsDetectionService"),nD=(0,c.inject)("elementRefProvider"),iD=(0,c.inject)("notificationsManagementFlow"),rD=(0,c.inject)("assetFoldersFlow"),sD=(0,h.G)(g.l.DEV_GENERATE_PROJECT),aD=(0,h.G)(g.l.DEV_SAVE_FILE),cD=(0,h.G)(g.l.DEV_UPDATE_FILE),lD=(0,h.G)(g.l.DEV_RENAME_FILE),dD=(0,h.G)(g.l.DEV_CREATE_FILE),pD=(0,h.G)(g.l.DEV_CREATE_FOLDER),uD=(0,h.G)(g.l.DEV_MOVE_FILE),hD=(0,h.G)(g.l.DEV_DELETE_FILE),mD=(0,h.G)(g.l.DEV_DELETE_ASSET),yD=(0,h.G)(g.l.DEV_UPDATE_IMPORT_MAP),ZS((fD=class{constructor(){(0,i.Z)(this,"projectDoc",bD,this),(0,i.Z)(this,"projectUIState",ID,this),(0,i.Z)(this,"projectDownloadFlow",vD,this),(0,i.Z)(this,"assetsService",wD,this),(0,i.Z)(this,"packerService",ND,this),(0,i.Z)(this,"localHistoryStackFlow",jD,this),(0,i.Z)(this,"dbSync",SD,this),(0,i.Z)(this,"modalManagementFlow",DD,this),(0,i.Z)(this,"assetsEditFlow",TD,this),(0,i.Z)(this,"assetsManagementFlow",OD,this),(0,i.Z)(this,"bundlerService",FD,this),(0,i.Z)(this,"navbarFlow",CD,this),(0,i.Z)(this,"codeEditorFlow",ED,this),(0,i.Z)(this,"yDocumentManagementFlow",xD,this),(0,i.Z)(this,"guardsService",_D,this),(0,i.Z)(this,"tailwindService",MD,this),(0,i.Z)(this,"propsDetectionService",PD,this),(0,i.Z)(this,"elementRefProvider",AD,this),(0,i.Z)(this,"notificationsManagementFlow",kD,this),(0,i.Z)(this,"assetFoldersFlow",UD,this),(0,r.Z)(this,"generateDevComponents",(async()=>{var e;const t=this.projectUIState.devMode.selectedBranch,o=this.projectDoc.projectFiles.local[t].byId,n=Object.keys(o).filter((e=>-1!==e.indexOf("src/widgets/")&&(0,AS.YP)((0,kn.extname)(e)))),i={};let r=0;for(const a of n){const e=o[a];if(e)try{var s;const t=null===(s=window.exports)||void 0===s?void 0:s[a];if(!t)continue;r+=1;try{const o=await this.propsDetectionService.detectPropsInContent(e.code,a);i[a]={component:t,props:o}}catch(l){i[a]={component:t,props:{}},console.warn(`Failed to parse props for ${a}`)}}catch(d){console.error(`Could not generate dev component: ${a}`)}}this.addDevStylesToDocument();const c=(null===(e=window.exports)||void 0===e?void 0:e.CustomStyles)||{};return(0,a.mutate)(this.projectUIState,(e=>{e.devMode.devComponents=i,e.devMode.devStyles=c})),{generated:r,existing:n.length}}))}async init(){var e;const{selectedFile:t,selectedBranch:o}=this.projectUIState.devMode;var n;(0===Object.keys(this.projectDoc.projectFiles.local[o].byId||{}).length&&await this.generateDeveloperModeProject({reSync:!1}),!t||null!==(e=this.projectDoc.projectFiles.local[o].byId)&&void 0!==e&&e[t])||(this.navbarFlow.deleteTab((null===(n=this.navbarFlow.getTabByEntityId(t))||void 0===n?void 0:n.id)||""),this.selectNextAvailableFile({fileToStartFrom:t}));0===Object.keys(this.projectUIState.navbar.devModeTabs).length&&this.navbarFlow.createStarterFileTab(this.projectUIState.devMode.selectedFile||Ks.e3)}transferLocalFilesToRemote(e){const{doc:t,branch:o,stagedOnly:n}=e;if(!t)return;if(!n)return void(t.projectFiles.remote[o]=JSON.parse(JSON.stringify(t.projectFiles.local[o])));t.projectFiles.remote[o]||(t.projectFiles.remote[o]={byId:{}});const i=t.projectFiles.staged[o].byId;Object.keys(i).forEach((e=>{"removed"===i[e].status?delete t.projectFiles.remote[o].byId[e]:-1!==e.indexOf(Ks._C)?t.projectFiles.remote[o].byId[e]={code:"",is_asset:!0}:t.projectFiles.remote[o].byId[e]=i[e],delete i[e]}))}copyFilesToDifferentBranch(e){const{doc:t,sourceBranch:o,destBranch:n}=e;if(!t)return;const{byId:i,lastSha:r}=t.projectFiles.local[o];t.projectFiles.local[n]={byId:{},sourceBranch:o,lastSha:r},t.projectFiles.staged[n]={byId:{}},t.projectFiles.remote[n]={byId:{}},Object.keys(i).forEach((e=>{t.projectFiles.local[n].byId[e]=JSON.parse(JSON.stringify(i[e])),t.projectFiles.remote[n].byId[e]=JSON.parse(JSON.stringify(i[e]))}))}setSelectedDiffingFile(e,t,o=!0){(0,a.mutate)(this.projectUIState,(o=>{e?(o.devMode.selectedDiffingFile={path:e,status:t},o.devMode.selectedStagedFile=null,o.devMode.selectedCommitFile=null):o.devMode.selectedDiffingFile=null})),e&&o&&this.navbarFlow.selectOrCreateTabByEntityId(`${e}-${t}`)}setSelectedCommitFile(e,t=!0){(0,a.mutate)(this.projectUIState,(t=>{e?(t.devMode.selectedCommitFilesHistory[e.path]=ZD({},e),t.devMode.selectedCommitFile=ZD({},e),t.devMode.selectedStagedFile=null,t.devMode.selectedDiffingFile=null):t.devMode.selectedCommitFile=null})),e&&t&&this.navbarFlow.selectOrCreateTabByEntityId(`${e.path}-${e.sha}${Ks.Vf}`)}setSelectedStagedFile(e){var t,o;const{doc:n,fileId:i,createTab:r=!0}=e;if(!n)return;if(!i)return void(0,a.mutate)(this.projectUIState,(e=>{e.devMode.selectedStagedFile=null}));const s=this.projectUIState.devMode.selectedBranch,c=null===(t=n.projectFiles.staged)||void 0===t||null===(o=t[s])||void 0===o?void 0:o.byId;if(!c)return;const l=c[i];l&&((0,a.mutate)(this.projectUIState,(e=>{e.devMode.selectedStagedFile={path:i,status:l.status},e.devMode.selectedDiffingFile=null,e.devMode.selectedCommitFile=null})),l&&r&&this.navbarFlow.selectOrCreateTabByEntityId(`${i}${Ks.Wj}`))}async generateDeveloperModeProject(e){const t=(null===e||void 0===e?void 0:e.reSync)||!1;try{const e=this.projectDoc.assets.getAssetsUsedInProject();e.forEach((e=>e.folderPath=this.assetFoldersFlow.getAncestorsPath(e.parentFolderId)));const o=this.projectDoc.assets.mapClassesAndNodesToOptimisedAssets(e,!0),n=await this.projectDownloadFlow.domainProjectToUIDL({assetsMapping:o,skipDevModeWidgets:!1,projectType:xn.o.REACT}),i=await this.packerService.generateCustomCodeProject({overwrite:t,uidl:n}),r=this.projectUIState.devMode.selectedBranch,s=this.projectDoc.projectFiles.local[r].byId[Ks.BQ];i.files||(i.files=[]),s||i.files.push({name:"teleport.config",fileType:x.Tv.JSON,content:JSON.stringify(PS,null,2)});const a=i.files.findIndex((e=>"package"===e.name&&"json"===e.fileType));if(i.files.splice(a,1),!i)return;this.saveProjectGeneratedFiles({overwrite:t,folder:i})}catch(o){this.notificationsManagementFlow.createNotification(d.k$.ERROR,"There was a problem when syncing the project"),console.error(o)}}saveProjectGeneratedFiles(e){var t;const{doc:o,overwrite:n,folder:i}=e;if(!o)return;n&&this.removeTeleportFiles({doc:o});const r=this.projectUIState.devMode.selectedFile,s=this.mapToFlatFiles(i),c=this.projectUIState.devMode.selectedBranch,l=o.projectFiles.local[c].byId;Object.keys(s).forEach((e=>{if(e.includes(Ks.qG)&&n)return;const t=s[e];if(".html"===(0,kn.extname)(e)&&n){const i=(new DOMParser).parseFromString(s[e].content,"text/html"),r=(new DOMParser).parseFromString(l[e].code,"text/html"),a=e=>{const t=i.querySelector(`[data-tag="${e}"]`),o=r.querySelector(`[data-tag="${e}"]`);o&&t&&(o.innerHTML=t.innerHTML)};a("default-style-sheet"),a("reset-style-sheet"),(r.head.querySelectorAll('[data-tag="font"]')||[]).forEach((e=>{r.head.removeChild(e)})),(i.head.querySelectorAll('[data-tag="font"]')||[]).forEach((e=>{r.head.appendChild(e)}));const c=`\n<!DOCTYPE html>\n\n<html lang="en">\n${r.documentElement.innerHTML}\n</html>\n`;this.saveFile(ZD(ZD({doc:o,overwrite:n,fileName:e},t),{},{content:c.trim()}))}else this.saveFile(ZD({doc:o,overwrite:n,fileName:e},t))}));const d=Object.keys((null===(t=this.projectUIState.navbar)||void 0===t?void 0:t.devModeTabs)||{}).filter((e=>{const t=this.projectUIState.navbar.devModeTabs[e];return!s[t.entityId]&&t.entityId.startsWith(`${Ks.y$}/${Ks.Xh}/`)})),p=d.map((e=>this.projectUIState.navbar.devModeTabs[e].entityId)).includes(r||"");r&&!s[r]&&p&&this.selectNextAvailableFile({doc:o,fileToStartFrom:r}),(0,a.mutate)(this.projectUIState,(e=>{d.forEach((t=>{delete e.navbar.devModeTabs[t]}))})),o.projectFiles.lastSync=Date.now()}removeTeleportFiles(e){const{doc:t}=e;if(!t)return;const o=this.projectUIState.devMode.selectedBranch,n=t.projectFiles.local[o].byId;Object.keys(n).filter((e=>e.includes("/teleporthq/")&&!e.includes(Ks.qG))).forEach((e=>{this.deleteFileViewState(e),delete n[e]}))}mapToFlatFiles(e,t=""){const{files:o,subFolders:n}=e,i={};return o.map((o=>{const n=`${o.name}${o.fileType?"."+o.fileType:""}`,r=`${(0,kn.join)(t,`${e.name}/${n}`)}`;i[r]={content:o.content,is_protected:RS(r,o.name)}})),n.forEach((o=>{const n=this.mapToFlatFiles(o,(0,kn.join)(t,e.name));Object.assign(i,n)})),i}toggleFileUnderUpdate(e){(0,a.mutate)(this.projectUIState,(t=>{const o=null!==e&&void 0!==e?e:!t.devMode.fileUnderUpdate;t.devMode.fileUnderUpdate=o}))}toggleLoadingPackages(){(0,a.mutate)(this.projectUIState,(e=>{e.devMode.loadingPackages=!e.devMode.loadingPackages}))}detachPreviewer(){(0,a.mutate)(this.projectUIState,(e=>{e.devMode.showPreviewer=!e.devMode.showPreviewer}))}saveFile(e){const{doc:t,fileName:o,content:n,is_protected:i=!1,overwrite:r}=e;if(!t)return;const s=this.projectUIState.devMode.selectedBranch,a=t.projectFiles.local[s].byId,c=a[o];c?r&&(c.is_protected||`${Ks.y$}/index.html`)&&(c.code=n,c.synced_at=Date.now()):a[o]={code:n,created_at:Date.now(),is_protected:i};const l=this.yDocumentManagementFlow.getText(o);l&&l.toString()!==n&&this.yDocumentManagementFlow.replaceText(o,n)}updateFile(e){const{doc:t,content:o,fileId:n}=e;if(!t)return;const i=n||(this.projectUIState.devMode.conflictModalOpened?this.projectUIState.devMode.selectedConflictFile:this.projectUIState.devMode.selectedFile);if(!i)return;const r=this.projectUIState.devMode.selectedBranch,s=t.projectFiles.local[r].byId[i];if(!s)throw this.setSelectedFile({doc:t,path:Ks.e3}),new Error(`File record is missing ${this.projectUIState.devMode.selectedFile}`);s.code=o,s.synced_at=Date.now()}setSelectedFile(e){var t;const{doc:o,path:n,fromTab:i,type:r}=e;if(!o)return;if("git-file"===r||"staged-file"===r||"commited-file"===r){const e=n.split("-");switch(r){case"git-file":const t=e.pop();this.setSelectedDiffingFile(e.join("-"),t,!1);break;case"staged-file":e.pop(),this.setSelectedStagedFile({doc:o,fileId:e.join("-"),createTab:!1});break;case"commited-file":e.pop(),e.pop();const n=e.join("-"),i=this.projectUIState.devMode.selectedCommitFilesHistory[n];i&&this.setSelectedCommitFile(i,!1)}return(0,a.mutate)(this.projectUIState,(e=>{e.devMode.selectedFile=null})),void(this.projectUIState.devMode.sidebarSettings.panel===p.Xk.FILES&&this.codeEditorFlow.handleDevSidebarChange(p.Xk.SOURCE_CONTROL))}this.setSelectedDiffingFile(null),this.setSelectedStagedFile({doc:o,fileId:null}),this.setSelectedCommitFile(null);const s=this.projectUIState.devMode.selectedFile,c=this.projectUIState.devMode.previouslySelectedFile;s!==c&&(0,a.mutate)(this.projectUIState,(e=>{e.devMode.previouslySelectedFile=s})),i||this.navbarFlow.selectOrCreateTabByEntityId(n),(0,a.mutate)(this.projectUIState,(e=>{e.devMode.selectedFile=n})),(null===(t=this.projectUIState.devMode.sidebarSettings)||void 0===t?void 0:t.panel)===p.Xk.SOURCE_CONTROL&&this.codeEditorFlow.handleDevSidebarChange(p.Xk.FILES)}rename(e){const{doc:t,path:o,newPath:n}=e;if(!t)return;const i=this.projectUIState.devMode.selectedBranch,r=t.projectFiles.local[i].byId;r[o]&&(this.yDocumentManagementFlow.deleteText(o),r[n]=r[o],this.navbarFlow.renameFilesTab(o,n),this.replaceFileViewState(o,n),delete r[o],this.bundlerService.renameFile(o,n,r[n].code),this.renameChildren({doc:t,path:o,newPath:n}))}renameChildren(e){const{doc:t,path:o,newPath:n}=e;if(!t)return;const i=this.projectUIState.devMode.selectedBranch,r=t.projectFiles.local[i].byId,s=Object.keys(r).filter((e=>0===e.indexOf(`${o}/`)));s.length&&s.forEach((e=>{const i=e.replace(o,n);this.navbarFlow.renameFilesTab(e,i),this.replaceFileViewState(e,i),this.yDocumentManagementFlow.deleteText(e),this.projectUIState.devMode.selectedFile===e&&this.setSelectedFile({doc:t,path:i}),r[i]=r[e],delete r[e]}))}createFile(e){const{doc:t,fileId:o,content:n="",remote:i=!1}=e;if(!t)return;const r=this.projectUIState.devMode.selectedBranch,s=this.projectDoc.projectFiles.getUniqueName(o,r),a={code:n,is_protected:!1,created_at:Date.now()};t.projectFiles.local[r].byId[s]=a,i&&(t.projectFiles.remote[r].byId[s]=a),this.bundlerService.updateFile(s,n)}createFolder(e){const{doc:t,folderId:o}=e;if(!t)return;const n=this.projectUIState.devMode.selectedBranch;t.projectFiles.local[n].byId[o]={code:"",is_protected:!1,created_at:Date.now()}}async moveFile(e){const{doc:t,toMovePath:o,destinationFolderPath:n}=e;if(!t||o===n)return;const i=this.projectUIState.devMode.selectedBranch,r=[...t.projectFiles.getFileChildren(o,i),o],s=(0,kn.relative)(o,n),c=o.split("/").pop()||"",l=1===c.split(".").length;if(l&&o.replace(`${n}/`,"")===c)return;const d=(0,kn.join)(o,s,c),p=t.projectFiles.getUniqueName(d,i),u=t.projectFiles.local[i].byId;for(const h of r){this.yDocumentManagementFlow.deleteText(h);const e=h.split("/").pop(),t=l?h===o?h:`${p}/${e||""}`:p,n=u[h];u[t]=n,delete u[h],this.navbarFlow.renameFilesTab(h,t),this.replaceFileViewState(h,t),this.projectUIState.devMode.selectedFile===h&&(0,a.mutate)(this.projectUIState,(e=>{e.devMode.selectedFile=t}))}}deleteFile(e){const{doc:t,fileId:o,permanent:n=!1}=e;if(!t||!o)return;const i=this.projectUIState.devMode.selectedBranch,{selectedFile:r}=this.projectUIState.devMode;(e.fileId===r||-1!==(null===r||void 0===r?void 0:r.indexOf(`${e.fileId}/`)))&&this.selectNextAvailableFile({doc:t,fileToStartFrom:o});const s=t.projectFiles.local[i].byId,a=t.projectFiles.getFileChildren(o,i),c=[o,...a],l=t.projectFiles.getUniqueName(o,i);c.forEach((e=>{var r;this.yDocumentManagementFlow.deleteText(e),this.navbarFlow.deleteTab((null===(r=this.navbarFlow.getTabByEntityId(e))||void 0===r?void 0:r.id)||""),this.deleteFileViewState(e),delete s[e],this.yDocumentManagementFlow.deleteText(e),n&&delete t.projectFiles.remote[i].byId[e];const a=(e===o?l:e.replace(o,l)).split("/");for(let t=1;t<a.length;t++)this.bundlerService.deleteFile(e)}))}selectNextAvailableFile(e){const{doc:t,fileToStartFrom:o}=e;if(!t)return;const n=this.computeCandidateForFileToSelect(t,o);if(!n)throw new Error("No file was found");this.setSelectedFile({doc:t,path:n})}setFileUnderExternalUpdate(e){(0,a.mutate)(this.projectUIState,(t=>{t.devMode.fileUnderExternalUpdate=e}))}deleteAssetUsingFilePath(e){const{doc:t,fileId:o}=e;if(!t)return;const n=(0,kn.parse)(o),i=this.projectDoc.assets.findAssetUsingName(`${n.name}${n.ext}`);if(!i)throw new Error(`Attempted to delete asset with file id "${o}" but it does not exist.`);this.assetsEditFlow.delete([i.id])}saveFileAction(){this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.lastSave=Date.now()}))}))}updateImportMap(e){const{importmap:t,doc:o}=e;if(!o)return;const n=this.projectUIState.devMode.selectedBranch,i=o.projectFiles.local[n].byId[Ks.BQ];if(!i)throw new Error("Teleport config file is missing from the project");const r=JSON.parse(i.code);r.importmap=JSON.parse(t);const s=JSON.stringify(r,null,2);this.yDocumentManagementFlow.replaceText(Ks.BQ,s),this.updateFile({doc:o,fileId:Ks.BQ,content:s}),this.modalManagementFlow.hideModal(),this.bundlerService.hardRefresh(),o.projectFiles.isAddingExternalDependency=null}addDevStylesToDocument(){var e,t,o;const n=null===(e=this.elementRefProvider.getIframeRef())||void 0===e||null===(t=e.current)||void 0===t?void 0:t.contentDocument;if(!n)return;const i="dev-mode-style",r=(null===(o=window.exports)||void 0===o?void 0:o.CustomStyles)||{},s=n.head.getElementsByClassName(i);Array.from(s).forEach((e=>e.remove()));const a=n.createElement("style");a.innerHTML=Object.values(r).join(""),a.classList.add(i),n.head.appendChild(a)}computeCandidateForFileToSelect(e,t){var o;const n=this.projectUIState.devMode.selectedBranch,{previouslySelectedFile:i,selectedFile:r}=this.projectUIState.devMode;return r!==i&&(null===(o=e.projectFiles.local[n])||void 0===o?void 0:o.byId[i||""])?i:e.projectFiles.getNextFileId(t,n)||e.projectFiles.getFirstFileId(n)}getSelectedEditorFileAndType(){return this.projectUIState.devMode.selectedDiffingFile?{fileType:"diffing",file:this.projectUIState.devMode.selectedDiffingFile.path}:this.projectUIState.devMode.selectedStagedFile?{fileType:"staged",file:this.projectUIState.devMode.selectedStagedFile.path}:this.projectUIState.devMode.selectedCommitFile?{fileType:"commit",file:this.projectUIState.devMode.selectedCommitFile.path}:{fileType:"local",file:this.projectUIState.devMode.selectedFile}}updateFileViewState(e){if(!e)return;const{fileType:t,file:o}=this.getSelectedEditorFileAndType();(0,a.mutate)(this.projectUIState,(({userPreferences:n})=>{var i,r;null!==(i=n.devFileViewState)&&void 0!==i&&i[t]||(n.devFileViewState=ZD(ZD({},n.devFileViewState),{},{[t]:{}})),n.devFileViewState[t]=ZD(ZD({},null===(r=n.devFileViewState)||void 0===r?void 0:r[t]),{},{[o]:e})}))}replaceFileViewState(e,t,o="local",n="local"){(0,a.mutate)(this.projectUIState,(({userPreferences:i})=>{var r,s;null!==(r=i.devFileViewState[o])&&void 0!==r&&r[e]&&(i.devFileViewState[n]=ZD(ZD({},null===(s=i.devFileViewState)||void 0===s?void 0:s[n]),{},{[t]:i.devFileViewState[o][e]}),delete i.devFileViewState[o][e])}))}deleteFileViewState(e,t="local"){(0,a.mutate)(this.projectUIState,(({userPreferences:o})=>{var n,i;null===(n=o.devFileViewState)||void 0===n||(null===(i=n[t])||void 0===i||delete i[e])}))}deleteAllFileViewState(){(0,a.mutate)(this.projectUIState,(({userPreferences:e})=>{Object.keys(e.devFileViewState).forEach((t=>{delete e.devFileViewState[t]}))}))}getSelectedFileViewState(){var e,t;const{fileType:o,file:n}=this.getSelectedEditorFileAndType();return null===(e=this.projectUIState.userPreferences.devFileViewState)||void 0===e||null===(t=e[o])||void 0===t?void 0:t[n]}async getPackedDesignProject(e){var t,o,n,i,r;const{projectType:s,skipDownload:a,publisher:c,projectCssFlavour:l,includeAnalytics:d,skipPrivateFiles:p}=e,u=await this.assetsManagementFlow.getOptimisedUsedAssets();u.forEach((e=>e.folderPath=this.assetFoldersFlow.getAncestorsPath(e.parentFolderId)));const h=this.projectDoc.assets.mapClassesAndNodesToOptimisedAssets(u),{publicAssets:m,privateAssets:y,cloudFunctions:g}=u.reduce(((e,t)=>{var o;return null!==(o=t.folderPath)&&void 0!==o&&o.split("/").includes(ut.D.FUNCTIONS)?(e.cloudFunctions.push(t),e):(t.parentFolderId!==ut.D.PRIVATE_ASSETS?e.publicAssets.push(t):p||e.privateAssets.push(t),e)}),{publicAssets:[],privateAssets:[],cloudFunctions:[]}),[f,b,I]=await Promise.all([this.assetsService.downloadAssets(m,{skipDownload:a}),this.assetsService.downloadAssets(y,{}),this.assetsService.downloadAssets(g,{})]),{uidl:v,routesMetaData:w={}}=await Ls({title:this.projectUIState.title,slug:this.projectUIState.slug,doc:this.projectDoc,projectType:s,secretKeys:Object.keys(this.projectUIState.secrets),assetSrcMapping:h,options:{skipDevModeWidgets:!0},applyForegroundTokenToFill:this.projectUIState.userPreferences.applyForegroundColorAsIconFill,exportUnusedClasses:this.projectUIState.userPreferences.exportUnusedClasses}),N=this.projectUIState.projectAnalyticsConfig,j=!!Object.keys(N).length,S=ZD({},((null===(t=window)||void 0===t?void 0:t.analytics)||j)&&d&&{teleportAnalytics:window.analytics||N});return await this.packerService.packAndPublish(ZD(ZD(ZD({uidl:v,options:ZD({assets:f,projectType:s,publisher:c,assetsFolder:[]},(null===(o=this.projectDoc.settings.experimentalFeatures)||void 0===o?void 0:o[_r.QR.EXCLUDE_GLOBALS_FROM_HTML_COMPONENTS])&&{excludeGlobalsFromHTMLComponents:!0}),cacheHandlerMetaData:{routeMappers:w,cacheHandlerSecret:tr.Instance.provideWebhookSecret()?"WEBHOOK_SECRET":void 0},projectCssFlavour:l?null===(n=window)||void 0===n?void 0:n.projectCssFlavour:void 0},S),{},{customFiles:{projectCustomFiles:this.projectDoc.customFiles.byId||{},privateAssets:b,cloudFunctions:I}},(null===(i=this.projectDoc.settings.experimentalFeatures)||void 0===i?void 0:i[_r.QR.ADVANCED_EMBEDS])&&{advancedEmbeds:!0}),!0===(null===(r=this.projectDoc.settings.experimentalFeatures)||void 0===r?void 0:r[_r.QR.STRICT_WHITE_SPACING_FOR_HTML])&&{strictHtmlWhitespaceSensitivity:!0}))}getPackedDevProjectFromCurrentBranch(){var e;const t=this.projectUIState.devMode.selectedBranch;return this.projectDoc.projectFiles.pack(ZD({toDeploy:!0,branch:t,assets:{}},Object.keys((null===(e=this.projectDoc.customFiles)||void 0===e?void 0:e.byId)||{}).length>0&&{customFiles:this.projectDoc.customFiles.byId}))}},bD=(0,s.Z)(fD.prototype,"projectDoc",[LS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ID=(0,s.Z)(fD.prototype,"projectUIState",[$S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vD=(0,s.Z)(fD.prototype,"projectDownloadFlow",[BS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wD=(0,s.Z)(fD.prototype,"assetsService",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ND=(0,s.Z)(fD.prototype,"packerService",[HS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jD=(0,s.Z)(fD.prototype,"localHistoryStackFlow",[zS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SD=(0,s.Z)(fD.prototype,"dbSync",[YS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DD=(0,s.Z)(fD.prototype,"modalManagementFlow",[VS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TD=(0,s.Z)(fD.prototype,"assetsEditFlow",[WS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OD=(0,s.Z)(fD.prototype,"assetsManagementFlow",[KS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FD=(0,s.Z)(fD.prototype,"bundlerService",[qS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CD=(0,s.Z)(fD.prototype,"navbarFlow",[JS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ED=(0,s.Z)(fD.prototype,"codeEditorFlow",[XS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xD=(0,s.Z)(fD.prototype,"yDocumentManagementFlow",[QS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_D=(0,s.Z)(fD.prototype,"guardsService",[eD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MD=(0,s.Z)(fD.prototype,"tailwindService",[tD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PD=(0,s.Z)(fD.prototype,"propsDetectionService",[oD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AD=(0,s.Z)(fD.prototype,"elementRefProvider",[nD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kD=(0,s.Z)(fD.prototype,"notificationsManagementFlow",[iD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UD=(0,s.Z)(fD.prototype,"assetFoldersFlow",[rD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(fD.prototype,"transferLocalFilesToRemote",[so.W],Object.getOwnPropertyDescriptor(fD.prototype,"transferLocalFilesToRemote"),fD.prototype),(0,s.Z)(fD.prototype,"copyFilesToDifferentBranch",[so.W],Object.getOwnPropertyDescriptor(fD.prototype,"copyFilesToDifferentBranch"),fD.prototype),(0,s.Z)(fD.prototype,"setSelectedStagedFile",[so.W],Object.getOwnPropertyDescriptor(fD.prototype,"setSelectedStagedFile"),fD.prototype),(0,s.Z)(fD.prototype,"generateDeveloperModeProject",[sD],Object.getOwnPropertyDescriptor(fD.prototype,"generateDeveloperModeProject"),fD.prototype),(0,s.Z)(fD.prototype,"saveProjectGeneratedFiles",[so.W],Object.getOwnPropertyDescriptor(fD.prototype,"saveProjectGeneratedFiles"),fD.prototype),(0,s.Z)(fD.prototype,"removeTeleportFiles",[so.W],Object.getOwnPropertyDescriptor(fD.prototype,"removeTeleportFiles"),fD.prototype),(0,s.Z)(fD.prototype,"saveFile",[aD,so.W],Object.getOwnPropertyDescriptor(fD.prototype,"saveFile"),fD.prototype),(0,s.Z)(fD.prototype,"updateFile",[cD,so.W],Object.getOwnPropertyDescriptor(fD.prototype,"updateFile"),fD.prototype),(0,s.Z)(fD.prototype,"setSelectedFile",[so.W],Object.getOwnPropertyDescriptor(fD.prototype,"setSelectedFile"),fD.prototype),(0,s.Z)(fD.prototype,"rename",[lD,so.W],Object.getOwnPropertyDescriptor(fD.prototype,"rename"),fD.prototype),(0,s.Z)(fD.prototype,"createFile",[dD,so.W],Object.getOwnPropertyDescriptor(fD.prototype,"createFile"),fD.prototype),(0,s.Z)(fD.prototype,"createFolder",[pD,so.W],Object.getOwnPropertyDescriptor(fD.prototype,"createFolder"),fD.prototype),(0,s.Z)(fD.prototype,"moveFile",[uD,so.W],Object.getOwnPropertyDescriptor(fD.prototype,"moveFile"),fD.prototype),(0,s.Z)(fD.prototype,"deleteFile",[hD,so.W],Object.getOwnPropertyDescriptor(fD.prototype,"deleteFile"),fD.prototype),(0,s.Z)(fD.prototype,"selectNextAvailableFile",[so.W],Object.getOwnPropertyDescriptor(fD.prototype,"selectNextAvailableFile"),fD.prototype),(0,s.Z)(fD.prototype,"deleteAssetUsingFilePath",[mD,so.W],Object.getOwnPropertyDescriptor(fD.prototype,"deleteAssetUsingFilePath"),fD.prototype),(0,s.Z)(fD.prototype,"updateImportMap",[yD,so.W],Object.getOwnPropertyDescriptor(fD.prototype,"updateImportMap"),fD.prototype),gD=fD));var LD=o(636201),$D=o(5220),BD=o(983331),GD=o(615902),HD=o(227711);const zD=e=>{const{addDependency:t,onDismiss:o,addInProgress:n,loadExportsMap:i,exports:r,resetExports:s,isLoadingExportsMap:a}=e,{0:c,1:l}=(0,w.useState)("react-query@3.34.6"),{0:d,1:p}=(0,w.useState)([]);(0,w.useEffect)((()=>()=>o()),[]),(0,w.useEffect)((()=>{s(),p([])}),[c]);return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"jsx-573546598 "+v().dynamic([["3755600568",[N.N_.TWO_UNITS]]])+" deps-modal-wrapper",children:(0,F.jsxs)(GD.K,{gap:"one",children:[(0,F.jsx)("h3",{className:"jsx-573546598 "+v().dynamic([["3755600568",[N.N_.TWO_UNITS]]]),children:"Add External Dependency"}),(0,F.jsx)(LD.S,{value:c,style:"boxed",size:"flexible",onChange:e=>{l(e.target.value)}}),(0,F.jsxs)(GD.K,{gap:"one",children:[(0,F.jsxs)(HD.g,{gap:"one",children:[(0,F.jsx)("h4",{className:"jsx-573546598 "+v().dynamic([["3755600568",[N.N_.TWO_UNITS]]]),children:"Package exports"}),(0,F.jsx)("a",{rel:"noopener noreferrer",href:"https://jspm.org/docs/cdn#exports-field",target:"_blank","data-tool-tip-name":"Package Exports Field",className:"jsx-573546598 "+v().dynamic([["3755600568",[N.N_.TWO_UNITS]]]),children:(0,F.jsx)(S.J,{type:"info",size:8})})]}),(0,F.jsx)("p",{className:"jsx-573546598 "+v().dynamic([["3755600568",[N.N_.TWO_UNITS]]]),children:"By manually selecting a specific module from the package, you can reduce the amount of JS loaded into the browsers."}),(0,F.jsxs)(j.z,{style:"solid",colorScheme:"neutral",size:"small",onClick:()=>{c&&i(c)},children:["Fetch ",a?(0,F.jsx)(S.J,{type:"loading"}):null]}),r&&(null===r||void 0===r?void 0:r.length)>0?(0,F.jsx)("div",{className:"jsx-573546598 "+v().dynamic([["3755600568",[N.N_.TWO_UNITS]]])+" deps-exports-list",children:(0,F.jsx)($D.E,{noPadding:!0,onSelect:e=>{d.includes(e)?p(d.filter((t=>t!==e))):p([...d,e])},children:null===r||void 0===r?void 0:r.map((e=>(0,F.jsx)(BD.p,{selected:d.includes(e),itemId:e,children:(0,F.jsx)("div",{className:"jsx-573546598 "+v().dynamic([["3755600568",[N.N_.TWO_UNITS]]])+" deps-export-list-item",children:(0,F.jsx)("span",{className:"jsx-573546598 "+v().dynamic([["3755600568",[N.N_.TWO_UNITS]]])+" dep-path-name",children:e})})},e)))})}):null]}),(0,F.jsxs)(HD.g,{align:"center",children:[(0,F.jsx)(j.z,{isDisabled:n===iw.B.ADDING||!1,style:"outline",colorScheme:"gray",onClick:o,children:"Cancel"}),(0,F.jsxs)(j.z,{isDisabled:n===iw.B.ADDING||!1,style:"solid",colorScheme:"accent",onClick:()=>{0!==d.length?t(d):t(c)},children:["Add ",n===iw.B.ADDING?(0,F.jsx)(S.J,{type:"loading"}):null]})]})]})}),(0,F.jsx)(v(),{id:"573546598",children:[".modal-content{max-width:500px;}"]}),(0,F.jsx)(v(),{id:"3755600568",dynamic:[N.N_.TWO_UNITS],children:[".deps-modal-wrapper.__jsx-style-dynamic-selector{width:100%;min-height:130px;}",".deps-exports-list.__jsx-style-dynamic-selector{width:100%;max-height:400px;overflow:scroll;}",`.deps-package-exports.__jsx-style-dynamic-selector{margin-top:${N.N_.TWO_UNITS};}`,".deps-export-list-item.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}"]})]})};var YD,VD,WD,KD,qD,JD,XD,QD,eT;function tT(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}let oT=(YD=(0,c.inject)("projectDoc"),VD=(0,c.inject)("projectUIState"),WD=(0,c.inject)("notificationsManagementFlow"),KD=(0,c.inject)("dependencyManagementFlow"),qD=class extends w.Component{constructor(...e){super(...e),(0,i.Z)(this,"projectDoc",JD,this),(0,i.Z)(this,"projectUIState",XD,this),(0,i.Z)(this,"notificationsManagementFlow",QD,this),(0,i.Z)(this,"dependencyManagementFlow",eT,this),(0,r.Z)(this,"unsubs",[]),(0,r.Z)(this,"state",{exports:null,isAddingExternalDependency:this.projectDoc.projectFiles.isAddingExternalDependency,isLoadingExportsMap:!1}),(0,r.Z)(this,"loadExportsMap",(async e=>{this.setState({isLoadingExportsMap:!0}),this.dependencyManagementFlow.loadExportsMap(e)})),(0,r.Z)(this,"hanldeResetExports",(()=>{this.setState({exports:null})})),(0,r.Z)(this,"addDependency",(e=>{"string"!==typeof e?this.dependencyManagementFlow.addDependenciesWithSubPaths(e):this.dependencyManagementFlow.addExternalDependency(e)}))}componentDidMount(){const e=(0,a.select)(this.projectDoc,["projectFiles/isAddingExternalDependency"],(({projectFiles:{isAddingExternalDependency:e}})=>{this.setState({isAddingExternalDependency:e})}),"ExternalDependencyModalWrapper"),t=(0,a.select)(this.projectUIState,["devMode/packageExports"],(e=>{e.devMode.packageExports?this.setState({exports:e.devMode.packageExports,isLoadingExportsMap:!1}):this.setState({exports:null,isLoadingExportsMap:!1})}),"ExternalDependencyModalWrapper1");this.unsubs.push((()=>e.dispose()),(()=>t.dispose()))}componentWillUnmount(){this.dependencyManagementFlow.resetExternalDependencyState({}),this.unsubs.forEach((e=>e()))}render(){const{isAddingExternalDependency:e,exports:t,isLoadingExportsMap:o}=this.state;return(0,F.jsx)(zD,function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?tT(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):tT(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({isLoadingExportsMap:o,addDependency:this.addDependency,addInProgress:e,loadExportsMap:this.loadExportsMap,resetExports:this.hanldeResetExports,exports:t},this.props))}},JD=(0,s.Z)(qD.prototype,"projectDoc",[YD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XD=(0,s.Z)(qD.prototype,"projectUIState",[VD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QD=(0,s.Z)(qD.prototype,"notificationsManagementFlow",[WD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eT=(0,s.Z)(qD.prototype,"dependencyManagementFlow",[KD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qD);var nT,iT,rT,sT,aT,cT,lT,dT,pT,uT,hT;nT=(0,c.provide)("dependencyManagementFlow"),iT=(0,c.inject)("bundlerService"),rT=(0,c.inject)("modalManagementFlow"),sT=(0,c.inject)("projectDoc"),aT=(0,c.inject)("projectUIState"),nT((lT=class{constructor(){(0,i.Z)(this,"bundlerService",dT,this),(0,i.Z)(this,"modalManagementFlow",pT,this),(0,i.Z)(this,"projectDoc",uT,this),(0,i.Z)(this,"projectUIState",hT,this)}resetExternalDependencyState(e){const{doc:t}=e;t&&(t.projectFiles.isAddingExternalDependency=null)}addDependencyModal(){const e=b.d.createCustomModal({Component:oT,onDismiss:()=>{this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(e)}getImportsFromDeps(){return Object.keys(this.computeDepsFromImportMap()).map((e=>`import * as ${(0,ni.dE)(e.replaceAll(/-/g,""))} from '${e}'`)).join("\n")}computeDepsFromImportMap(){try{var e,t,o,n;const i=(null===(e=this.projectDoc.projectFiles.local[this.projectUIState.devMode.selectedBranch])||void 0===e||null===(t=e.byId[Ks.BQ])||void 0===t?void 0:t.code)||"{}",r=(null===(o=JSON.parse(i))||void 0===o||null===(n=o.importmap)||void 0===n?void 0:n.imports)||{};return Object.keys(r).reduce(((e,t)=>{const o=r[t].match(/@[~^]?([\dvx*]+(?:[-.](?:[\dx*]+|alpha|beta))*)/gm),n=null===o||void 0===o?void 0:o[0];if(!n)throw new Error(`Version missing for the dependency ${t}`);return e[t]=n,e}),{})}catch(i){return{}}}addExternalDependency(e){this.bundlerService.addExternalDependency({pkgName:e})}addDependenciesWithSubPaths(e){const t=[...this.parseDepsIntoJSPMRedable(this.computeDepsFromImportMap()),...e];this.bundlerService.addExternalDependency({pkgName:t})}updateDependencies(e){this.bundlerService.addExternalDependency({pkgName:this.parseDepsIntoJSPMRedable(e)})}loadExportsMap(e){this.bundlerService.loadExports(e)}parseDepsIntoJSPMRedable(e){return Object.keys(e).map((t=>{const o=t.split("/");return t.startsWith("@")?3===o.length?`${o.splice(0,2).join("/")}${e[t]}/${o.splice(3,o.length-1).join("/")}`:`${o.splice(0,1).join("/")}${e[t]}/${o.splice(2,o.length-1).join("/")}`:1===o.length?`${o[0]}${e[t]}`:`${o[0]}${e[t]}/${o.splice(1,o.length-1).join("/")}`}))}},dT=(0,s.Z)(lT.prototype,"bundlerService",[iT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pT=(0,s.Z)(lT.prototype,"modalManagementFlow",[rT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uT=(0,s.Z)(lT.prototype,"projectDoc",[sT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hT=(0,s.Z)(lT.prototype,"projectUIState",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(lT.prototype,"resetExternalDependencyState",[so.W],Object.getOwnPropertyDescriptor(lT.prototype,"resetExternalDependencyState"),lT.prototype),cT=lT));var mT,yT,gT,fT,bT,IT=o(169180),vT=o(176532),wT=o(359525),NT=o(946201),jT=o(4576),ST=o(140758),DT=o(635242),TT=o(425603),OT=o(505285),FT=o(771657),CT=o(268053);const ET=[];ET[0]=e=>{const{encoder:t,decoder:o,provider:n,emitSynced:i}=e;NT.uE(t,0);const r=ST.zu(o,t,n.doc,n);i&&r===ST.Px&&!n.synced&&(n.synced=!0)},ET[3]=e=>{const{encoder:t,provider:o}=e;NT.uE(t,1),NT.mP(t,TT.xq(o.awareness,Array.from(o.awareness.getStates().keys())))},ET[1]=e=>{const{decoder:t,provider:o}=e;TT.oy(o.awareness,jT.HN(t),o)},ET[2]=e=>{const{decoder:t,provider:o}=e;DT.nw(t,o.doc,xT)};const xT=(e,t)=>console.warn(`Permission denied to access url.\n${t}`),_T=(e,t,o)=>{const n=jT.l1(t),i=NT.Mf(),r=jT.yg(n);if(4===r){const t=jT.kf(n);return e.emit(t,[]),i}if(5===r)return e.heartbeat(),e.sendCustomMessage(JSON.stringify({type:"pong"})),i;const s=e.messageHandlers[r];return s?s({encoder:i,decoder:n,provider:e,emitSynced:o}):console.error("Unable to compute message"),i},MT=async e=>{if(!e.shouldConnect)return;const t=await e.authService.getAuthUserAsync(),o=t?await t.getIdToken():"",n=new WebSocket(`wss://playground-api-production-v5.services.teleporthq.io/yws/${e.projectDoc.id}?token=${o}`);n&&(n.binaryType="arraybuffer",e.ws=n,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,n.onmessage=t=>{e.wsLastMessageReceived=wT.ZG();const o=_T(e,new Uint8Array(t.data),!0);NT.kE(o)>1&&n.send(NT._f(o))},n.onclose=()=>{if(e.ws=null,e.wsconnecting=!1,e.wsconnected){e.wsconnected=!1,e.synced=!1;const t=Array.from(e.awareness.getStates().keys()).filter((t=>t!==e.doc.clientID));TT.Ag(e.awareness,t,e),e.emit("status",[{status:"disconnected"}])}else e.wsUnsuccessfulReconnects++;setTimeout(MT,CT.VV(1200*CT.mv(e.wsUnsuccessfulReconnects+1),2500),e)},n.onopen=()=>{e.wsLastMessageReceived=wT.ZG(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const t=NT.Mf();if(NT.uE(t,0),ST._J(t,e.doc),n.send(NT._f(t)),null!==e.awareness.getLocalState()){const t=NT.Mf();NT.uE(t,1),NT.mP(t,TT.xq(e.awareness,[e.doc.clientID])),n.send(NT._f(t))}},e.emit("status",[{status:"connecting"}]))};let PT=(mT=(0,c.inject)("authService"),yT=(0,c.inject)("projectDoc"),gT=class extends FT.y{constructor(e,t=new TT.GL(e)){super(),(0,r.Z)(this,"doc",void 0),(0,r.Z)(this,"awareness",void 0),(0,r.Z)(this,"shouldConnect",void 0),(0,r.Z)(this,"wsconnected",void 0),(0,r.Z)(this,"wsconnecting",void 0),(0,r.Z)(this,"bcconnected",void 0),(0,r.Z)(this,"wsLastMessageReceived",void 0),(0,r.Z)(this,"wsUnsuccessfulReconnects",void 0),(0,r.Z)(this,"messageHandlers",void 0),(0,r.Z)(this,"bcChannel",void 0),(0,r.Z)(this,"ws",void 0),(0,r.Z)(this,"mux",void 0),(0,r.Z)(this,"_synced",void 0),(0,r.Z)(this,"resyncInterval",void 0),(0,r.Z)(this,"checkInterval",void 0),(0,r.Z)(this,"heartbeatTimeout",null),(0,i.Z)(this,"authService",fT,this),(0,i.Z)(this,"projectDoc",bT,this),(0,r.Z)(this,"bcSubscriber",(e=>{this.mux((()=>{const t=_T(this,new Uint8Array(e),!1);NT.kE(t)>1&&vT.nY(this.bcChannel,NT._f(t))}))})),(0,r.Z)(this,"updateHandler",((e,t)=>{if(t!==this){const t=NT.Mf();NT.uE(t,0),ST.lr(t,e),this.broadcastMessage(NT._f(t))}})),(0,r.Z)(this,"awarenessUpdateHandler",(e=>{const{added:t,updated:o,removed:n}=e,i=t.concat(o).concat(n),r=NT.Mf();NT.uE(r,1),NT.mP(r,TT.xq(this.awareness,i)),this.broadcastMessage(NT._f(r))})),(0,r.Z)(this,"beforeUnloadHandler",(()=>{TT.Ag(this.awareness,[this.doc.clientID],"window unload")})),(0,r.Z)(this,"broadcastMessage",(e=>{var t;this.wsconnected&&(null===(t=this.ws)||void 0===t||t.send(e));this.bcconnected&&this.mux((()=>{vT.nY(this.bcChannel,e)}))})),this.ws=null,this.bcChannel=`wss://playground-api-production-v5.services.teleporthq.io/ws/${this.projectDoc.id}`,this.doc=e,this.awareness=t,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.wsUnsuccessfulReconnects=0,this.messageHandlers=ET.slice(),this.mux=OT.M(),this._synced=!1,this.wsLastMessageReceived=0,this.shouldConnect=!0,this.resyncInterval=0,this.doc.on("update",this.updateHandler),window.addEventListener("beforeunload",this.beforeUnloadHandler),t.on("update",this.awarenessUpdateHandler),this.checkInterval=setInterval((()=>{const e=3e4<wT.ZG()-this.wsLastMessageReceived;var t;this.wsconnected&&e&&(null===(t=this.ws)||void 0===t||t.close())}),3e3),this.connect()}heartbeat(){this.heartbeatTimeout&&clearTimeout(this.heartbeatTimeout),this.heartbeatTimeout=setTimeout((()=>{var e,t,o;(null===(e=this.ws)||void 0===e?void 0:e.readyState)===(null===(t=this.ws)||void 0===t?void 0:t.OPEN)&&(null===(o=this.ws)||void 0===o||o.close())}),4e3)}sendCustomMessage(e,t=0){try{var o;const t=NT.Mf();NT.uE(t,3),NT.uw(t,e),null===(o=this.ws)||void 0===o||o.send(NT._f(t))}catch(n){if(t>=5)throw n;const o=setTimeout((()=>{clearTimeout(o),this.sendCustomMessage(e,++t)}),200)}}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this.resyncInterval&&"number"!==typeof this.resyncInterval&&clearInterval(this.resyncInterval),clearInterval(this.checkInterval),this.disconnect(),window.removeEventListener("beforeunload",this.beforeUnloadHandler),this.awareness.off("update",this.awarenessUpdateHandler),this.doc.off("update",this.updateHandler),super.destroy()}connectBc(){this.bcconnected||(vT.Ld(this.bcChannel,this.bcSubscriber),this.bcconnected=!0),this.mux((()=>{const e=NT.Mf();NT.uE(e,0),ST._J(e,this.doc),vT.nY(this.bcChannel,NT._f(e));const t=NT.Mf();NT.uE(t,0),ST.K0(t,this.doc),vT.nY(this.bcChannel,NT._f(t));const o=NT.Mf();NT.uE(o,3),vT.nY(this.bcChannel,NT._f(o));const n=NT.Mf();NT.uE(n,1),NT.mP(n,TT.xq(this.awareness,[this.doc.clientID])),vT.nY(this.bcChannel,NT._f(n))}))}disconnectBc(){const e=NT.Mf();NT.uE(e,1),NT.mP(e,TT.xq(this.awareness,[this.doc.clientID],new Map)),this.broadcastMessage(NT._f(e)),this.bcconnected&&(vT.r1(this.bcChannel,this.bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||(MT(this),this.connectBc())}},fT=(0,s.Z)(gT.prototype,"authService",[mT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bT=(0,s.Z)(gT.prototype,"projectDoc",[yT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gT);var AT,kT,UT,RT,ZT,LT,$T,BT,GT;AT=(0,c.provide)("yDocumentManagementFlow"),kT=(0,c.inject)("projectDoc"),UT=(0,c.inject)("projectUIState"),RT=(0,c.inject)("projectFilesFlow"),AT((LT=class{constructor(){(0,i.Z)(this,"projectDoc",$T,this),(0,i.Z)(this,"projectUIState",BT,this),(0,i.Z)(this,"projectFilesFlow",GT,this),(0,r.Z)(this,"ydoc",void 0),(0,r.Z)(this,"documentList",void 0),(0,r.Z)(this,"provider",void 0),(0,r.Z)(this,"createOpsInProgress",{}),(0,r.Z)(this,"replaceOpsInProgress",{}),(0,r.Z)(this,"deleteOpsInProgress",{}),(0,r.Z)(this,"branch",null),(0,r.Z)(this,"init",(async()=>{this.ydoc=new IT.QW({guid:this.projectDoc.id,autoLoad:!0}),this.ydoc.load(),this.provider=new PT(this.ydoc,new TT.GL(this.ydoc)),this.documentList=this.ydoc.getMap(this.projectDoc.id)})),(0,r.Z)(this,"destroy",(()=>{var e,t;null===(e=this.provider)||void 0===e||e.destroy(),null===(t=this.ydoc)||void 0===t||t.destroy()})),(0,r.Z)(this,"getDocument",(()=>this.ydoc)),(0,r.Z)(this,"getAwareness",(()=>this.provider.awareness)),(0,r.Z)(this,"getText",(e=>{var t;const o=this.generateKey(e);return null===(t=this.documentList)||void 0===t?void 0:t.get(o)})),(0,r.Z)(this,"setText",(async(e,t,o=!1)=>{if(this.getText(e)&&"string"===typeof t)return void(await this.replaceText(e,t,o));const n=this.generateKey(e);if(this.createOpsInProgress[n])return;if(o){const e=new IT.xv(t);return void this.documentList.set(n,e)}const i=setTimeout((()=>{this.projectFilesFlow.toggleFileUnderUpdate(!0)}),500);this.createOpsInProgress[n]=!0;const r=await this.createRemoteFile(n,t);delete this.createOpsInProgress[n],clearTimeout(i),this.projectFilesFlow.toggleFileUnderUpdate(!1),r||this.setText(e,t,!0)})),(0,r.Z)(this,"setTextOnBranch",(async(e,t,o)=>{this.branch=o,await this.setText(e,t),this.branch=null})),(0,r.Z)(this,"replaceText",(async(e,t,o=!1)=>{const n=this.getText(e);if(!n)return void(await this.setText(e,t,o));const i=n.toString();if(i===t)return;const r=this.generateKey(e);if(this.replaceOpsInProgress[r])return;if(o)return void n.applyDelta([{delete:i.length},{insert:t}]);const s=setTimeout((()=>{this.projectFilesFlow.toggleFileUnderUpdate(!0)}),500);this.replaceOpsInProgress[r]=!0;const a=await this.replaceRemoteFile(r,t);delete this.replaceOpsInProgress[r],clearTimeout(s),this.projectFilesFlow.toggleFileUnderUpdate(!1),a||this.replaceText(e,t,!0)})),(0,r.Z)(this,"deleteText",(async(e,t=!1)=>{if(!this.getText(e))return;const o=this.generateKey(e);if(this.deleteOpsInProgress[o])return;if(t)return void this.documentList.delete(o);this.deleteOpsInProgress[o]=!0;const n=await this.deleteRemoteFile(o);delete this.deleteOpsInProgress[o],n||this.deleteText(e,!0)})),(0,r.Z)(this,"initProjectFiles",(async(e,t=0)=>{e=e||this.projectUIState.devMode.selectedBranch;const o=this.projectDoc.projectFiles.local[e].byId,n=Object.keys(o).reduce(((t,n)=>(this.getText(n)||(t[`${e}-${n}`]=o[n].code),t)),{});if(!Object.keys(n).length)return;const i=(0,ni.Ox)();this.provider.sendCustomMessage(JSON.stringify({actionId:i,type:"content-init",files:n}));await this.waitForCustomActionResponse(i)||t>=10||await this.initProjectFiles(e,t++)})),(0,r.Z)(this,"addTextAtLine",((e,t,o)=>{const n=this.getText(e);if(!n)return;const i=n.toString().split("\n").slice(0,t-1).join("\n").length;i||"\n"!==o[0]||(o=o.substring(1),o+="\n"),n.insert(i,o)})),(0,r.Z)(this,"removeTextFromLine",((e,t)=>{const o=this.getText(e);if(!o)return;const n=o.toString().split("\n"),i=n.slice(0,t).join("\n").length;if(void 0===n[t])return;const r=n[t].length;o.delete(i,r+1)}))}async createRemoteFile(e,t,o=0){const n=(0,ni.Ox)();this.provider.sendCustomMessage(JSON.stringify({actionId:n,type:"content-create",file:e,content:t}));const i=await this.waitForCustomActionResponse(n);return!(!i&&o>=10)&&(!!i||new Promise((n=>{setTimeout((async()=>{const i=await this.createRemoteFile(e,t,++o);n(i)}),1e3)})))}async replaceRemoteFile(e,t,o=0){const n=(0,ni.Ox)();this.provider.sendCustomMessage(JSON.stringify({actionId:n,type:"content-replace",file:e,content:t}));const i=await this.waitForCustomActionResponse(n);return!(!i&&o>=10)&&(!!i||this.replaceRemoteFile(e,t,++o))}async deleteRemoteFile(e,t=0){const o=(0,ni.Ox)();this.provider.sendCustomMessage(JSON.stringify({actionId:o,type:"content-delete",file:e}));const n=await this.waitForCustomActionResponse(o);return!(!n&&t>=10)&&(!!n||this.deleteRemoteFile(e,++t))}generateKey(e){return`${this.branch||this.projectUIState.devMode.selectedBranch}-${e}`}async waitForCustomActionResponse(e){return new Promise((t=>{const o=setTimeout((()=>{clearTimeout(o),t(!1)}),1e3);this.provider.on(e,(()=>{clearTimeout(o),t(!0)}))}))}async waitForPeersConnection(){return new Promise((e=>{const t=setTimeout((async()=>{var t,o;null===(t=this.provider)||void 0===t||t.disconnect(),null===(o=this.provider)||void 0===o||o.destroy(),this.provider=new PT(this.ydoc,new TT.GL(this.ydoc)),await this.waitForPeersConnection(),e(!0)}),1e4);this.provider.on("synced",(()=>{clearTimeout(t),e(!0)}))}))}},$T=(0,s.Z)(LT.prototype,"projectDoc",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BT=(0,s.Z)(LT.prototype,"projectUIState",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GT=(0,s.Z)(LT.prototype,"projectFilesFlow",[RT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZT=LT));var HT,zT,YT,VT,WT,KT,qT,JT,XT,QT,eO,tO,oO,nO,iO,rO,sO,aO,cO,lO,dO,pO,uO,hO,mO,yO,gO,fO,bO,IO,vO,wO,NO,jO,SO,DO,TO;function OO(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function FO(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?OO(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):OO(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}HT=(0,c.provide)("githubFlow"),zT=(0,c.inject)("projectDoc"),YT=(0,c.inject)("projectUIState"),VT=(0,c.inject)("globalAppState"),WT=(0,c.inject)("githubRepository"),KT=(0,c.inject)("notificationsManagementFlow"),qT=(0,c.inject)("userAccountRepository"),JT=(0,c.inject)("projectFilesFlow"),XT=(0,c.inject)("navbarFlow"),QT=(0,c.inject)("yDocumentManagementFlow"),eO=(0,c.inject)("rtcFlow"),tO=(0,c.inject)("guardsService"),oO=(0,c.inject)("modalManagementFlow"),nO=(0,c.inject)("sharedbProjectSyncService"),iO=(0,c.inject)("conflictManagementFlow"),rO=(0,c.inject)("remoteChangesFlow"),sO=(0,c.inject)("sentryService"),aO=(0,h.G)(g.l.DEV_LOAD_COMMITS),cO=(0,h.G)(g.l.DEV_LOAD_BRANCHES),HT((dO=class{constructor(){(0,i.Z)(this,"projectDoc",pO,this),(0,i.Z)(this,"projectUIState",uO,this),(0,i.Z)(this,"globalAppState",hO,this),(0,i.Z)(this,"githubRepository",mO,this),(0,i.Z)(this,"notificationsManagementFlow",yO,this),(0,i.Z)(this,"userAccountRepository",gO,this),(0,i.Z)(this,"projectFilesFlow",fO,this),(0,i.Z)(this,"navbarFlow",bO,this),(0,i.Z)(this,"yDocumentManagementFlow",IO,this),(0,i.Z)(this,"rtcFlow",vO,this),(0,i.Z)(this,"guardsService",wO,this),(0,i.Z)(this,"modalManagementFlow",NO,this),(0,i.Z)(this,"dbSync",jO,this),(0,i.Z)(this,"conflictManagementFlow",SO,this),(0,i.Z)(this,"remoteChangesFlow",DO,this),(0,i.Z)(this,"sentryService",TO,this),(0,r.Z)(this,"loadCommitDetails",(async e=>{const t=await this.loadCommitFiles(e);if(!t)return;const o=t.files.reduce(((e,t)=>(e[`${Ks.y$}/${t.filename}`]={code:t.content,status:t.status},e)),{}),n=this.projectDoc.projectFiles.pack({filesToPack:o,assets:{}});(0,a.mutate)(this.projectUIState,(i=>{const r=i.devMode.githubCommits[e];r&&(r.details={files:o,stats:t.stats,hierarchy:n})}))})),(0,r.Z)(this,"mergeBranches",(async(e,t)=>{if(!this.projectDoc.stats.github)return;const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(o&&n){(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress="merge"}));try{await this.githubRepository.mergeBranches(this.projectDoc.id,{repository:o,owner:n,base:e,head:t}),this.loadProjectCommits(),this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,`${t} was merged into ${e}`)}catch(i){(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress=null}));try{if("merge conflict"===JSON.parse(i.message).error.toLowerCase())return void(await this.conflictManagementFlow.handleMergeConflict(e,t))}catch(i){}this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not merge branches")}(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress=null}))}})),(0,r.Z)(this,"deleteBranch",(async e=>{var t;if(!this.projectDoc.stats.github)return;const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(!o||!n)return;if(Object.keys(null===(t=this.projectDoc.projectFiles.staged[e])||void 0===t?void 0:t.byId).length)return void this.notificationsManagementFlow.createNotification(d.k$.ERROR,"You have staged changes inside this branch. Commit or discard them before");if(this.computeFilesWithDiffs(e).length)this.notificationsManagementFlow.createNotification(d.k$.ERROR,"You have changes inside this branch. Commit or discard them before");else try{await this.githubRepository.deleteBranch(this.projectDoc.id,{repository:o,owner:n,branch:e}),this.guardsService.executeAsyncFunctionGuarded(QI._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(t=>{delete t.projectFiles.local[e],delete t.projectFiles.remote[e]}))})),this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,`${e} branch was removed`)}catch(i){this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not delete branches")}})),(0,r.Z)(this,"changeBranch",(async(e,t=!0,o=0)=>{const n=this.projectUIState.devMode.githubBranches.byId[e];if(!n){if(0!==o)return;return await this.loadProjectBranches(),void(await this.changeBranch(e,t,++o))}if(this.projectUIState.devMode.selectedBranch===n.name)return;this.projectFilesFlow.deleteAllFileViewState();const i="remote"===n.type;i&&(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress="pull-branch"})),await this.loadProjectCommits(n.name),"remote"===n.type&&await this.loadProjectBranches(),(0,a.mutate)(this.projectUIState,(t=>{t.devMode.githubBranches.underRename=null,t.devMode.selectedBranch=e,t.devMode.githubOperationInProgress=null})),this.computeFilesWithDiffs();const r=this.navbarFlow.getCurrentTabs();Object.values(r).forEach((t=>{var o;null!==(o=this.projectDoc.projectFiles.local[e])&&void 0!==o&&o.byId[t.entityId]||this.navbarFlow.deleteTab(t.id)})),t&&(await this.storeCurrentBranch(e),this.rtcFlow.changeGithubBranch(e)),i&&await this.projectFilesFlow.generateDeveloperModeProject({reSync:!0})})),(0,r.Z)(this,"storeCurrentBranch",(async e=>{(0,a.mutate)(this.globalAppState,(({user:t})=>{t&&t.userData&&(t.userData.meta.githubBranches=FO(FO({},t.userData.meta.githubBranches),{},{[this.projectDoc.id]:e}))}));const{userData:t}=this.globalAppState.user;t&&await this.userAccountRepository.update({meta:t.meta})})),(0,r.Z)(this,"toggleTokenValidity",(e=>{(0,a.mutate)(this.projectUIState,(t=>{const o=null!==e&&void 0!==e?e:!t.devMode.githubTokenValid;t.devMode.githubTokenValid=o}))}))}async init(){(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubInitializing=!0}));const e=await this.checkUserAccessToRepository();(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubInitializing=!1})),e&&(this.loadProjectBranches(),this.loadProjectCommits())}computeFilesWithDiffs(e){var t,o,n,i,r;e=null!==(t=e)&&void 0!==t?t:this.projectUIState.devMode.selectedBranch;const s=(null===(o=this.projectDoc.projectFiles.local)||void 0===o||null===(n=o[e])||void 0===n?void 0:n.byId)||{},a=(null===(i=this.projectDoc.projectFiles.remote)||void 0===i||null===(r=i[e])||void 0===r?void 0:r.byId)||{},c=this.projectDoc.assets.byId,l=Object.keys(c).reduce(((e,t)=>(e[`${Ks.Wn}/playground_assets/${c[t].name}`]={code:"",is_asset:!0},e)),{}),d=new Set([...Object.keys(s),...Object.keys(a),...Object.keys(l)]);return Array.from(d).map((t=>{var o,n;const i=this.computeFileDiffType({file:t,branch:e,isAsset:(null===(o=l[t])||void 0===o?void 0:o.is_asset)||(null===(n=a[t])||void 0===n?void 0:n.is_asset)});return i?{path:t,diffType:i}:null})).filter(Boolean)}stageFiles(e){var t,o,n,i;const{doc:r,files:s}=e;if(!r||!s.length)return;const a=this.projectUIState.devMode.selectedBranch,c=(null===(t=r.projectFiles.local)||void 0===t||null===(o=t[a])||void 0===o?void 0:o.byId)||{},l=(null===(n=r.projectFiles.remote)||void 0===n||null===(i=n[a])||void 0===i?void 0:i.byId)||{};r.projectFiles.staged[a]||(r.projectFiles.staged[a]={byId:{}});for(const d of s){let e;switch(d.diffType){case iw.E.REMOVED:e=l[d.path];break;case iw.E.MODIFIED:case iw.E.NEW:e=c[d.path];break;default:throw new Error(`Could not find file to stag: ${d.path}`)}r.projectFiles.staged[a].byId[d.path]=FO(FO({},e),{},{status:d.diffType}),this.navbarFlow.syncDevTabsAfterFileStage({doc:r,file:d.path})}}unstageFile(e){const{doc:t,fileId:o}=e;if(!t)return;const n=this.projectUIState.devMode.selectedBranch,i=t.projectFiles.staged[n].byId;Object.keys(i).forEach((e=>{if(e===o||e.startsWith(`${o}/`)){delete i[e];const o=this.computeFileDiffType({doc:t,file:e});if(!o)return;this.navbarFlow.syncDevTabsAfterUnstageFile(e,o)}}))}discardChanges(e){const{doc:t,files:o}=e;if(!t||!o.length)return;const n=this.projectUIState.devMode.selectedBranch,i=t.projectFiles.remote[n].byId;for(const s of o){var r;switch(s.diffType){case iw.E.REMOVED:{const e=i[s.path];if(!e)throw new Error(`Tried to discard deleted file and remote does not exist:${s.path} `);return void this.projectFilesFlow.saveFile({doc:t,fileName:s.path,overwrite:!0,content:e.code})}case iw.E.NEW:this.projectFilesFlow.deleteFile({doc:t,fileId:s.path});break;case iw.E.MODIFIED:{const e=i[s.path];if(!e)throw new Error(`Tried to discard updated file and remote does not exist:${s.path} `);this.projectFilesFlow.updateFile({doc:t,fileId:s.path,content:e.code}),this.yDocumentManagementFlow.replaceText(s.path,e.code);break}}if((null===(r=this.projectUIState.devMode.selectedDiffingFile)||void 0===r?void 0:r.path)===s.path){const e=this.navbarFlow.getSelectedTab();s.diffType===iw.E.NEW?this.projectFilesFlow.selectNextAvailableFile({doc:t,fileToStartFrom:s.path}):this.projectFilesFlow.setSelectedFile({doc:t,path:s.path}),e.id!==this.projectUIState.navbar.newTabId&&(0,a.mutate)(this.projectUIState,(t=>{delete t.navbar.devModeTabs[e.id]}))}}}async checkUserAccessToRepository(){var e;const t=this.globalAppState.user.userData;if(!this.projectDoc.stats.github||null===t||void 0===t||!t.githubToken||null===(e=t.githubScope)||void 0===e||!e.includes("repo"))return!1;const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(!o||!n)return!1;try{const e=await this.githubRepository.checkIfUserHasAccessToRepo(this.projectDoc.id,n,o);return(0,a.mutate)(this.projectUIState,(t=>{t.devMode.hasAccessToGithubRepo=e})),e}catch(i){return this.sentryService.captureException(i),!1}}async loadProjectCommits(e){var t;const o=this.globalAppState.user.userData;if(!this.projectDoc.stats.github||null===o||void 0===o||!o.githubToken||null===(t=o.githubScope)||void 0===t||!t.includes("repo"))return;const{repositoryName:n,repositoryOwner:i}=this.projectDoc.stats.github;if(!n||!i)return;e=e||this.projectUIState.devMode.selectedBranch;this.projectDoc.projectFiles.remote[e]||(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubCommits={}}));try{const t=await this.githubRepository.getCommits(this.projectDoc.id,{sha:e,repository:n,owner:i});await this.remoteChangesFlow.applyRemoteChanges(t,e),(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubCommits={},t.forEach((t=>{e.devMode.githubCommits[t.sha]=t}))}))}catch(r){const e="Could not get project commits";if(this.parseGithubError(r,e))return;this.notificationsManagementFlow.createNotification(d.k$.ERROR,e)}}async createNewBranch(){await this.loadProjectBranches();const e=Object.values(this.projectUIState.devMode.githubBranches.byId).map((e=>e.name)),t=(0,l.Zu)(e,"new-branch").trim(),o=(0,ni.Ox)();(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubBranches.byId[o]={name:t,type:"local"},e.devMode.githubBranches.underRename=o,e.devMode.githubBranches.underCreationSource=`${e.devMode.selectedBranch}`,e.devMode.selectedBranch=t})),this.computeFilesWithDiffs()}async confirmBranchName(e){const{branchId:t,newName:o}=e;if(!this.projectDoc.stats.github)return;const n=this.projectUIState.devMode.githubBranches.underCreationSource;if(!n)return;const{repositoryName:i,repositoryOwner:r}=this.projectDoc.stats.github;if(!i||!r)return;const s=Object.values(this.projectUIState.devMode.githubBranches.byId).map((e=>e.name)),c=o.replace(/\s+/g," ").trim().replace(/^-+/,"").replace(/^\.|\/\.|\.\.|~|\^|:|\/$|\.lock$|\.lock\/|\\|\*|\s|^\s*$|\.$|\[|\]$/g,"-").toLowerCase();const d=(0,l.Zu)(s,c).trim();try{await this.githubRepository.createBranch(this.projectDoc.id,{repository:i,owner:r,sourceBranch:n,newBranch:d}),this.projectFilesFlow.copyFilesToDifferentBranch({sourceBranch:n,destBranch:d})}catch(p){throw new Error("Could not create branch")}await this.storeCurrentBranch(d),await this.yDocumentManagementFlow.initProjectFiles(d),this.computeFilesWithDiffs(),(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubBranches.byId[d]=FO(FO({},e.devMode.githubBranches.byId[t]),{},{name:d}),delete e.devMode.githubBranches.byId[t],e.devMode.selectedBranch=d,e.devMode.githubBranches.underRename=null,e.devMode.githubBranches.underCreationSource=null})),this.rtcFlow.changeGithubBranch(d)}async loadProjectBranches(){var e;const t=this.globalAppState.user.userData;if(!this.projectDoc.stats.github||null===t||void 0===t||!t.githubToken||null===(e=t.githubScope)||void 0===e||!e.includes("repo"))return;const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(o&&n)try{const e=(await this.githubRepository.getBranches(this.projectDoc.id,n,o)).map((e=>({name:e.name,type:"remote"}))),t=Object.keys(this.projectDoc.projectFiles.local).map((t=>{const o=e.some((e=>e.name===t));return{name:t,type:o?"both":"local"}})),i=e.filter((e=>!t.some((t=>t.name===e.name)))),r=[...t,...i];(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubBranches.byId={},r.forEach((t=>{e.devMode.githubBranches.byId[t.name]=t}))}))}catch(i){const e="Could not get project branches";if(this.parseGithubError(i,e))return;this.notificationsManagementFlow.createNotification(d.k$.ERROR,e)}}async loadCommitFiles(e){if(!this.projectDoc.stats.github)return null;const{repositoryName:t,repositoryOwner:o}=this.projectDoc.stats.github;if(!t||!o)return null;try{return await this.githubRepository.getCommitDetails(this.projectDoc.id,{ref:e,repository:t,owner:o})}catch(n){return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not get commit details"),null}}cleanupUnexistingRepoData(e){var t,o;e&&(null!==(t=e.stats.github)&&void 0!==t&&t.repositoryUrl||(Object.keys(e.projectFiles.conflicts).length&&(e.projectFiles.conflicts={}),Object.keys(e.projectFiles.remote).length&&(e.projectFiles.remote={}),(Object.keys(e.projectFiles.staged).length>1||Object.keys((null===(o=e.projectFiles.staged[Ks.y$])||void 0===o?void 0:o.byId)||{}).length)&&(e.projectFiles.staged={[Ks.cY]:{byId:{}}}),Object.keys(e.projectFiles.local).forEach((t=>{e.projectFiles.local[t].lastSha=void 0,e.projectFiles.local[t].sourceBranch=void 0}))))}computeFileDiffType(e){var t,o,n,i,r,s,a,c,l,d,p;const{doc:u,file:h,isAsset:m}=e;if(!u)return;let{branch:y}=e;y=y||this.projectUIState.devMode.selectedBranch;const g=(null===(t=u.projectFiles.local)||void 0===t||null===(o=t[y])||void 0===o?void 0:o.byId)||{},f=(null===(n=u.projectFiles.staged)||void 0===n||null===(i=n[y])||void 0===i?void 0:i.byId)||{},b=(null===(r=u.projectFiles.remote)||void 0===r||null===(s=r[y])||void 0===s?void 0:s.byId)||{};if(m){const e=h.split("/").pop()||"",t=u.assets.findAssetUsingName(e);return!b[h]||t||f[h]?!t||b[h]||f[h]?null:iw.E.NEW:iw.E.REMOVED}const I=null===(a=g[h])||void 0===a?void 0:a.code,v=null!==(c=null===(l=f[h])||void 0===l?void 0:l.code)&&void 0!==c?c:null===(d=b[h])||void 0===d?void 0:d.code,w=void 0!==I,N=void 0!==v,j=void 0!==(null===(p=f[h])||void 0===p?void 0:p.code),S=w&&N&&I!==v,D=w&&!N;return S||D||N&&!w?!w&&j?null:S?iw.E.MODIFIED:D?iw.E.NEW:iw.E.REMOVED:null}parseGithubError(e,t){try{var o;const n=JSON.parse(e.message).error.toLowerCase(),i=-1!==n.indexOf("unauthorized")||-1!==n.indexOf("bad credentials"),r=-1!==n.indexOf("not found");if(!i&&!r)return!1;if(r)return this.notificationsManagementFlow.createNotification(d.k$.ERROR,`Make sure the repository exists and you have enough permissions. ${t}`),!0;return(null===(o=this.globalAppState.user.userData)||void 0===o?void 0:o.githubToken)&&this.userAccountRepository.update({githubScope:null,githubToken:null}),this.notificationsManagementFlow.createNotification(d.k$.ERROR,`Your GitHub access token is invalid or expired. ${t}`),this.toggleTokenValidity(!1),!0}catch(n){return!1}}},pO=(0,s.Z)(dO.prototype,"projectDoc",[zT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uO=(0,s.Z)(dO.prototype,"projectUIState",[YT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hO=(0,s.Z)(dO.prototype,"globalAppState",[VT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mO=(0,s.Z)(dO.prototype,"githubRepository",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yO=(0,s.Z)(dO.prototype,"notificationsManagementFlow",[KT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gO=(0,s.Z)(dO.prototype,"userAccountRepository",[qT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fO=(0,s.Z)(dO.prototype,"projectFilesFlow",[JT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bO=(0,s.Z)(dO.prototype,"navbarFlow",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IO=(0,s.Z)(dO.prototype,"yDocumentManagementFlow",[QT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vO=(0,s.Z)(dO.prototype,"rtcFlow",[eO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wO=(0,s.Z)(dO.prototype,"guardsService",[tO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NO=(0,s.Z)(dO.prototype,"modalManagementFlow",[oO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jO=(0,s.Z)(dO.prototype,"dbSync",[nO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SO=(0,s.Z)(dO.prototype,"conflictManagementFlow",[iO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DO=(0,s.Z)(dO.prototype,"remoteChangesFlow",[rO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TO=(0,s.Z)(dO.prototype,"sentryService",[sO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(dO.prototype,"stageFiles",[so.W],Object.getOwnPropertyDescriptor(dO.prototype,"stageFiles"),dO.prototype),(0,s.Z)(dO.prototype,"unstageFile",[so.W],Object.getOwnPropertyDescriptor(dO.prototype,"unstageFile"),dO.prototype),(0,s.Z)(dO.prototype,"discardChanges",[so.W],Object.getOwnPropertyDescriptor(dO.prototype,"discardChanges"),dO.prototype),(0,s.Z)(dO.prototype,"loadProjectCommits",[aO],Object.getOwnPropertyDescriptor(dO.prototype,"loadProjectCommits"),dO.prototype),(0,s.Z)(dO.prototype,"loadProjectBranches",[cO],Object.getOwnPropertyDescriptor(dO.prototype,"loadProjectBranches"),dO.prototype),(0,s.Z)(dO.prototype,"cleanupUnexistingRepoData",[m.P],Object.getOwnPropertyDescriptor(dO.prototype,"cleanupUnexistingRepoData"),dO.prototype),(0,s.Z)(dO.prototype,"computeFileDiffType",[m.P],Object.getOwnPropertyDescriptor(dO.prototype,"computeFileDiffType"),dO.prototype),lO=dO));var CO=o(27911),EO=o(738492);function xO(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function _O(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?xO(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):xO(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const MO=e=>{const{0:t,1:o}=(0,w.useState)(window.innerWidth-500);(0,w.useEffect)((()=>(window.addEventListener("resize",n),()=>window.removeEventListener("resize",n))),[]);const n=()=>{o(window.innerWidth-500)};return(0,F.jsxs)("div",{tabIndex:0,className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]]),children:[(0,F.jsxs)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" merge-title",children:[(0,F.jsxs)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]]),children:[" ",e.title]}),(0,F.jsx)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]]),children:(0,F.jsx)(j.z,{style:"solid",size:"medium",isDisabled:!e.canSave||e.solveInProgress,isLoading:e.solveInProgress,onClick:e.handleSave,children:"Save"})})]}),(0,F.jsx)("div",{tabIndex:0,className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" merge-root",children:(0,F.jsx)(EO.Z,{cursor:"col-resize",columnMinSizes:[286,0,t],render:({getGridProps:t,getGutterProps:o})=>(0,F.jsxs)("div",_O(_O({},t()),{},{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" merge-grid",children:[(0,F.jsx)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" merge-sidebar",children:e.sidebar}),(0,F.jsx)("div",_O(_O({},o("column",1)),{},{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" gutter-column"})),(0,F.jsx)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]]),children:(0,F.jsx)(EO.Z,{cursor:"row-resize",rowMinSizes:{0:250,1:0,2:250},render:({getGridProps:t,getGutterProps:o})=>(0,F.jsxs)("div",_O(_O({},t()),{},{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" merge-row-grid",children:[(0,F.jsx)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" split-container",children:(0,F.jsx)(EO.Z,{cursor:"col-resize",columnMinSizes:[100,0,100],render:({getGridProps:t,getGutterProps:o})=>(0,F.jsxs)("div",_O(_O({},t()),{},{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" editors-merge-grid",children:[(0,F.jsxs)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]]),children:[(0,F.jsx)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" merge-diff-header",children:(0,F.jsx)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]]),children:"Local changes"})}),e.localContentEditor]}),(0,F.jsx)("div",_O(_O({},o("column",1)),{},{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" gutter-column"})),(0,F.jsxs)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]]),children:[(0,F.jsx)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" merge-diff-header",children:(0,F.jsx)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]]),children:"Remote changes"})}),e.remoteContentEditor]})]}))})}),(0,F.jsx)("div",_O(_O({},o("row",1)),{},{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" gutter-row"})),(0,F.jsxs)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" split-container",children:[(0,F.jsxs)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" merge-output-header",children:[(0,F.jsx)("span",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]]),children:"Output"}),(0,F.jsxs)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" merge-output-actions-container",children:[(0,F.jsx)("div",{className:v().dynamic([["2342149677",[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500]]])+" merge-output-action",children:(0,F.jsxs)(j.z,{size:"tiny",onClick:e.handleResolve,isDisabled:e.resolved,children:["Mark resolved"," "]})}),(0,F.jsx)(j.z,{size:"tiny",style:"outline",isDisabled:e.resetInProgress,isLoading:e.resetInProgress,onClick:e.handleReset,children:"Reset"})]})]}),e.outputEditor]})]}))})})]}))})}),(0,F.jsx)(v(),{id:"2342149677",dynamic:[N.DM.GRAY_200,N.DM.GRAY_200,N.kg.ONEHUNDRED,N.kg.ONEHUNDRED,N.DM.ACCENT_500],children:[".merge-root.__jsx-style-dynamic-selector{height:90vh;width:90vw;border-radius:0 0 4px 4px;}",`.merge-sidebar.__jsx-style-dynamic-selector{background-color:${N.DM.GRAY_200};padding:10px;border-radius:0 0 0 4px;}`,".split-container.__jsx-style-dynamic-selector{overflow:hidden;}",`.merge-title.__jsx-style-dynamic-selector{height:50px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;background-color:${N.DM.GRAY_200};margin-bottom:2px;border-radius:4px 4px 0 0;padding:10px;}`,".merge-grid.__jsx-style-dynamic-selector{display:grid;height:100%;grid-template-rows:100%;grid-template-columns:286px 0px 1fr;}",".editors-merge-grid.__jsx-style-dynamic-selector{display:grid;height:100%;grid-template-rows:100%;grid-template-columns:1fr 0px 1fr;}",".merge-row-grid.__jsx-style-dynamic-selector{display:grid;height:100%;grid-template-rows:1fr 5px 1fr;grid-template-columns:100%;}",`.gutter-row.__jsx-style-dynamic-selector{cursor:row-resize;width:100%;height:5px;-webkit-transition:0.4s all;transition:0.4s all;z-index:${N.kg.ONEHUNDRED};}`,`.gutter-column.__jsx-style-dynamic-selector{cursor:col-resize;width:5px;height:100%;-webkit-transition:0.4s all;transition:0.4s all;z-index:${N.kg.ONEHUNDRED};}`,`.gutter-column.__jsx-style-dynamic-selector:active,.gutter-row.__jsx-style-dynamic-selector:active,.gutter-row.__jsx-style-dynamic-selector:hover,.gutter-column.__jsx-style-dynamic-selector:hover{background:${N.DM.ACCENT_500};}`,".merge-diff-header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:4px;height:28px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}",".merge-diff-header.__jsx-style-dynamic-selector>div.__jsx-style-dynamic-selector{margin-left:16px;}",".merge-output-header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:4px 8px;height:28px;}",".merge-output-actions-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}",".merge-output-action.__jsx-style-dynamic-selector{margin-right:8px;}"]})]})},PO=(e,t)=>{let o=!0,n=e.startLine;for(;n<=e.endLine&&o;){t.some((e=>e.line===n))||(o=!1),n+=1}return o},AO=(e,t)=>Object.keys(e).every((o=>t[o]&&PO(e[o],t[o]||[]))),kO=(e,t=[],o,n)=>{const i=o.split("\n"),r=[];if(e.negativeRange)for(let s=e.endLine-2;s>e.startLine;s--){t.find((e=>e.line===s+1&&e.source===n))||r.push({content:i[s],line:s+1,source:n})}else for(let s=e.startLine-1;s<e.endLine;s++){t.find((e=>e.line===s+1&&e.source===n))||r.push({content:i[s],line:s+1,source:n})}return r};class UO{constructor(e){(0,r.Z)(this,"diffDecorations",{}),(0,r.Z)(this,"fullySelectedDiffs",[]),(0,r.Z)(this,"editor",void 0),(0,r.Z)(this,"monaco",void 0),(0,r.Z)(this,"diffs",void 0),(0,r.Z)(this,"usedLines",void 0),(0,r.Z)(this,"usedZones",[]),(0,r.Z)(this,"highlightDiffs",(e=>{this.addUsedLinesDecorations(),Object.keys(this.diffs).forEach((t=>{const o=this.diffs[t];if(o.negativeRange)return;const n=this.diffDecorations[t].highlight;this.diffDecorations[t].highlight=this.editor.deltaDecorations(n,this.generateDiffHighlightDecoration(o,e));const i=this.generateSelectAllDiffDecoration(o.middleLine),r=this.diffDecorations[t].selectAll;this.diffDecorations[t].selectAll=this.editor.deltaDecorations(r,i)}))}));const{diffs:t,usedLines:o,editor:n,monaco:i}=e;n&&(this.editor=n),i&&(this.monaco=i),this.diffs=t||{},this.usedLines=o||{},Object.keys(this.diffs).forEach((e=>{this.diffDecorations[e]={selectAll:[],hoveredLines:[],usedLines:[],highlight:[]}}))}setEditor(e,t){this.editor=e,this.monaco=t}addActionOnUsedLines(e){this.usedLines=e,this.addUsedLinesDecorations()}addConflictingZones(e){this.editor.changeViewZones((t=>{this.usedZones.forEach((e=>{t.removeZone(e)})),Object.values(e).forEach((e=>{const o=document.createElement("div");o.style.backgroundImage="linear-gradient( -45deg, #808080 12.5%, #262626 12.5%, #262626 50%, #808080 50%, #808080 62.5%, #262626 62.5%, #262626 100% )",o.style.backgroundSize="8px 8px";const n={afterLineNumber:e.start,heightInLines:e.height,domNode:o};this.usedZones.push(t.addZone(n))}))}))}handleHoverOverLine(e,t){var o,n;const i=this.diffDecorations[e].hoveredLines||[];(null===(o=this.usedLines)||void 0===o||null===(n=o[e])||void 0===n?void 0:n.some((e=>e.line===t)))?this.diffDecorations[e].hoveredLines=this.editor.deltaDecorations(i,this.generateLineActionDecoration(t,!1)):this.diffDecorations[e].hoveredLines=this.editor.deltaDecorations(i,this.generateLineActionDecoration(t))}handleMouseLeave(){Object.keys(this.diffDecorations).forEach((e=>{const t=this.diffDecorations[e].hoveredLines||[];this.diffDecorations[e].hoveredLines=this.editor.deltaDecorations(t,[])}))}highlightUsedDiff(e){const t=this.diffs[e];if(!t)return;this.fullySelectedDiffs.push(e);const o=this.diffDecorations[e].selectAll||[];this.diffDecorations[e].selectAll=this.editor.deltaDecorations(o,this.generateCheckedDecoration(t.middleLine));const n=this.diffDecorations[e].usedLines||[],i=[];for(let r=t.startLine;r<=t.endLine;r++)i.push(...this.generateLineActionDecoration(r));this.diffDecorations[e].usedLines=this.editor.deltaDecorations(n,i)}removeUsedDiffHighlight(e){const t=this.diffs[e];if(!t)return;const o=this.fullySelectedDiffs.indexOf(e);this.fullySelectedDiffs.splice(o,1);const n=this.diffDecorations[e].selectAll||[];this.diffDecorations[e].selectAll=this.editor.deltaDecorations(n,this.generateSelectAllDiffDecoration(t.middleLine));const i=this.diffDecorations[e].usedLines||[];this.diffDecorations[e].usedLines=this.editor.deltaDecorations(i,[])}addUsedLinesDecorations(){Object.keys(this.usedLines).length?Object.keys(this.usedLines).forEach((e=>{var t,o;const n=this.diffs[e],i=this.usedLines[e];if(!n)return;if(PO(n,i)&&!n.negativeRange&&i.length)return void this.highlightUsedDiff(e);-1!==this.fullySelectedDiffs.indexOf(e)&&this.removeUsedDiffHighlight(e);const r=(null===(t=this.diffDecorations)||void 0===t||null===(o=t[e])||void 0===o?void 0:o.usedLines)||[],s=[];i.forEach((e=>{s.push(...this.generateLineActionDecoration(e.line))})),this.diffDecorations[e]||(this.diffDecorations[e]={usedLines:[],selectAll:[],hoveredLines:[],highlight:[]}),this.diffDecorations[e].usedLines=this.editor.deltaDecorations(r,s)})):this.removeAllDecorations()}removeAllDecorations(){Object.keys(this.diffDecorations).forEach((e=>{const t=this.diffDecorations[e].usedLines;this.diffDecorations[e].usedLines=this.editor.deltaDecorations(t,[])})),Object.keys(this.diffs).forEach((e=>{const t=this.diffs[e];if(t.negativeRange)return;const o=this.diffDecorations[e].selectAll;this.diffDecorations[e].selectAll=this.editor.deltaDecorations(o,[]);const n=this.generateSelectAllDiffDecoration(t.middleLine);this.diffDecorations[e].selectAll=this.editor.deltaDecorations([],n)}))}generateSelectAllDiffDecoration(e){return[{range:new this.monaco.Range(e,0,e,0),options:{isWholeLine:!0,glyphMarginClassName:"diffing-editor-glyph-unchecked"}}]}generateDiffHighlightDecoration(e,t){return[{range:new this.monaco.Range(e.startLine,0,e.endLine,0),options:{isWholeLine:!0,className:t?"diffing-editor-remote":"diffing-editor",glyphMarginClassName:t?"diffing-editor-remote-glyph":"diffing-editor-glyph"}}]}generateCheckedDecoration(e){return[{range:new this.monaco.Range(e,0,e,0),options:{isWholeLine:!0,className:"diffing-editor",glyphMarginClassName:"diffing-editor-glyph-checked"}}]}generateLineActionDecoration(e,t=!0){return[{range:new this.monaco.Range(e,1,e,1),options:{isWholeLine:!0,linesDecorationsClassName:t?"editor-add-line":"editor-remove-line"}}]}}const RO=e=>{const{0:t,1:o}=(0,w.useState)(null),{0:n,1:i}=(0,w.useState)(null),{0:r}=(0,w.useState)((()=>new UO({editor:t,monaco:n,usedLines:e.usedLines,diffs:e.diffs})));(0,w.useEffect)((()=>{t&&n&&r&&(r.setEditor(t,n),r.highlightDiffs(!!e.isRemote),r.addActionOnUsedLines(e.usedLines))}),[t,n,e.usedLines,r]),(0,w.useEffect)((()=>{if(!t||!n||!e.conflictingDiffs||!e.diffs)return;const o=Object.keys(e.conflictingDiffs).map((t=>{const o=e.conflictingDiffs[t],n=e.diffs[t];if(!o||!n)return null;const i=n.endLine>0?n.endLine-n.startLine+1:0,r=o.endLine>0?o.endLine-o.startLine+1:0;if(r>i){return{start:Math.max(n.startLine,n.endLine),height:r-i}}return null})).filter(Boolean);r.addConflictingZones(o)}),[t,n,e.conflictingDiffs,e.diffs]),(0,w.useEffect)((()=>{if(!t)return;const e=t.onMouseDown((e=>{a(e)})),o=t.onMouseMove((e=>{s(e)})),n=t.onMouseLeave((()=>{r.handleMouseLeave()}));return()=>{e.dispose(),o.dispose(),n.dispose()}}),[t,e.usedLines]);const s=e=>{var t;const o=null===(t=e.target.position)||void 0===t?void 0:t.lineNumber;if(!o)return;const n=c(o);n?r.handleHoverOverLine(n,o):r.handleMouseLeave()},a=t=>{var o;if(!t.event.leftButton)return;const n=t.target.element,i=null===(o=t.target.position)||void 0===o?void 0:o.lineNumber;if(!i)return;const{diffs:s}=e,a=c(i);if(!a)return;const u=null===n||void 0===n?void 0:n.classList.contains("diffing-editor-glyph-unchecked"),h=null===n||void 0===n?void 0:n.classList.contains("diffing-editor-glyph-checked");if(!u&&!h)return void l(a,i);const m=Object.keys(s).find((e=>s[e].middleLine===i));return m?h?(p(m),void r.removeUsedDiffHighlight(m)):void d(m):void 0},c=t=>{const{diffs:o}=e;return Object.keys(o).find((e=>{const n=o[e];return n.startLine<=t&&n.endLine>=t}))},l=(t,o)=>{var n;const{isRemote:i,usedLines:r,value:s}=e,a=null===r||void 0===r||null===(n=r[t])||void 0===n?void 0:n.find((e=>e.line===o&&e.source===(i?"remote":"local")));if(a)return void e.handleRemoveLines(t,[a]);const c=s.split("\n")[o-1];e.handleAddLines(t,[{content:c,line:o,source:i?"remote":"local"}])},d=t=>{const{diffs:o,isRemote:n,value:i}=e,r=o[t],s=kO(r,e.usedLines[t],i,n?"remote":"local");e.handleAddLines(t,s)},p=t=>{const{usedLines:o}=e,n=o[t];e.handleRemoveLines(t,n)};return Object.keys(e.diffs).length?(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(CO.ZP,{height:"calc(100% - 24px)",theme:"teleport-theme",value:e.value,language:"typescript",beforeMount:e=>i(e),onMount:e=>o(e),options:{readOnly:!0,minimap:{enabled:!1},glyphMargin:!0,fontFamily:"Source Code Pro, monospace",fontSize:14}})}):(0,F.jsx)("div",{children:"Loading..."})};var ZO=o(42781);class LO{constructor(e){(0,r.Z)(this,"editor",void 0),(0,r.Z)(this,"monaco",void 0),(0,r.Z)(this,"lineDecorations",{}),(0,r.Z)(this,"highlightLines",((e,t)=>{const o=t.map((e=>this.generateLineHighlightDecoration({startLine:e.editorLine,endLine:e.editorLine,middleLine:e.editorLine},"remote"===e.source))).flat();this.lineDecorations[e]=this.editor.deltaDecorations(this.lineDecorations[e]||[],o)}));const{editor:t,monaco:o}=e;this.editor=t,this.monaco=o}generateLineHighlightDecoration(e,t){return[{range:new this.monaco.Range(e.startLine,0,e.endLine,0),options:{isWholeLine:!0,className:t?"output-editor-remote":"output-editor",glyphMarginClassName:t?"output-editor-remote-glyph":"output-editor-glyph"}}]}}const $O=[".diffing-editor,.output-editor{background:rgba(40,115,222,0.2);}",`.diffing-editor{z-index:${N.kg.ONEHUNDRED};cursor:pointer;}`,".diffing-editor-glyph,.output-editor-glyph{background:rgba(40,115,222,0.2);width:100% !important;margin-left:25px !important;border-left:4px solid rgba(40,115,222,0.8);}",`.diffing-editor-glyph,.output-editor-glyph{cursor:pointer;z-index:${N.kg.ONEHUNDRED};}`,".diffing-editor-glyph-middle{width:100% !important;margin-left:25px !important;}",".diffing-editor-glyph-unchecked::before,.diffing-editor-glyph-checked::before{content:'      ';position:absolute;left:-24px;display:block;height:18px;width:18px;background-repeat:no-repeat;background-size:cover;}",".diffing-editor-glyph-unchecked::before{background-image:url('/static/icons/dev-mode/unchecked.svg') !important;}",".diffing-editor-glyph-checked::before{background-image:url('/static/icons/dev-mode/checked.svg') !important;}",".diffing-editor-remote,.output-editor-remote{background:rgba(197,139,35,0.3);}",`.diffing-editor-remote{z-index:${N.kg.ONEHUNDRED};cursor:pointer;}`,`.diffing-editor-remote{background:rgba(197,139,35,0.3);z-index:${N.kg.ONEHUNDRED};cursor:pointer;}`,".diffing-editor-remote-glyph,.output-editor-remote-glyph{background:rgba(197,139,35,0.3);width:100% !important;margin-left:25px !important;border-left:4px solid rgba(197,139,35,0.8);}",`.diffing-editor-remote-glyph{cursor:pointer;z-index:${N.kg.ONEHUNDRED};}`,`.editor-remove-line{-webkit-mask-image:url('/static/icons/dev-mode/minus.svg') !important;mask-image:url('/static/icons/dev-mode/minus.svg') !important;background-repeat:no-repeat;background-size:cover;width:18px !important;height:18px !important;margin-left:4px;-webkit-mask-size:cover;mask-size:cover;background-color:${N.DM.DANGER};}`,`.editor-add-line{-webkit-mask-image:url('/static/icons/dev-mode/plus.svg') !important;mask-image:url('/static/icons/dev-mode/plus.svg') !important;background-repeat:no-repeat;background-size:cover;width:18px !important;height:18px !important;margin-left:4px;-webkit-mask-size:cover;mask-size:cover;background-color:${N.DM.SUCCESS};}`];$O.__hash="49456402";var BO,GO,HO,zO,YO,VO,WO,KO,qO,JO,XO,QO,eF,tF,oF=o(468503),nF=o(124701);function iF(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function rF(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?iF(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):iF(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let sF=(BO=(0,c.inject)("projectDoc"),GO=(0,c.inject)("absolutePositionedLayerFlow"),HO=(0,c.inject)("projectFilesFlow"),zO=(0,c.inject)("projectUIState"),YO=(0,c.inject)("webRTCState"),VO=(0,c.inject)("conflictManagementFlow"),tF=new WeakMap,WO=class extends w.PureComponent{constructor(e){super(e),(0,i.Z)(this,"projectDoc",KO,this),(0,i.Z)(this,"absolutePositionedLayerFlow",qO,this),(0,i.Z)(this,"projectFilesFlow",JO,this),(0,i.Z)(this,"projectUIState",XO,this),(0,i.Z)(this,"webRTCState",QO,this),(0,i.Z)(this,"conflictManagementFlow",eF,this),(0,r.Z)(this,"editor",null),(0,r.Z)(this,"outputMonaco",void 0),(0,r.Z)(this,"rtcHandler",new oF.L(!0)),(0,r.Z)(this,"decorationManager",void 0),(0,r.Z)(this,"monacoHelper",new nF.r),tF.set(this,{writable:!0,value:[]}),(0,r.Z)(this,"generateHierarchy",(()=>{const e=this.projectDoc.projectFiles.conflicts[this.props.branch],t=Object.keys(e.byId).reduce(((t,o)=>(t[o]=rF(rF({},this.projectDoc.projectFiles.local[this.props.branch].byId[o]),{},{status:e.byId[o].resolved?iw.E.RESOLVED:iw.E.CONFLICT}),t)),{});return this.projectDoc.projectFiles.pack({filesToPack:t,assets:{}})})),(0,r.Z)(this,"checkIfConflictCanBeResolved",(()=>{const e=this.projectDoc.projectFiles.conflicts[this.props.branch];return Object.keys(e.byId).every((t=>e.byId[t].resolved))})),(0,r.Z)(this,"generateCollaboratorsSelectedFiles",(e=>{const t=this.projectUIState.devMode.selectedBranch;return e.filter((e=>e.selectedBranch===t)).map((e=>{const{selectedFile:t,name:o,email:n}=e;return{selectedFile:t,collaborator:o||n||""}}))})),(0,r.Z)(this,"handleOutputEditorMount",(async e=>{this.editor=e,await this.rtcHandler.attach(e,this.outputMonaco,(()=>null),this.monacoHelper),this.decorationManager=new LO({editor:this.editor,monaco:this.outputMonaco}),this.setState({editorLoaded:!0}),this.highlightOutputUsedLines()})),(0,r.Z)(this,"handleOutputChange",((e,t)=>{const{editorLoaded:o,actionInProgress:n,underExternalUpdate:i}=this.state;!o||n||i||this.rtcHandler.modelIsBinding||this.conflictManagementFlow.handleContentChange(t)})),(0,r.Z)(this,"handleSelectFile",(e=>{const{selectedFilePath:t}=this.state;e!==t&&this.conflictManagementFlow.setSelectedConflictFile(e)})),(0,r.Z)(this,"handleAddLines",(async(e,t)=>{this.editor&&await this.conflictManagementFlow.addLinesFromConflict(e,t)})),(0,r.Z)(this,"handleRemoveLines",(async(e,t)=>{this.editor&&await this.conflictManagementFlow.removeLinesFromConflict(e,t)})),(0,r.Z)(this,"highlightOutputUsedLines",(()=>{var e;const{localUsedLines:t,remoteUsedLines:o,selectedFilePath:n}=this.state,i=[...Object.values(t),...Object.values(o)].flat();null===(e=this.decorationManager)||void 0===e||e.highlightLines(n,i)})),(0,r.Z)(this,"handleResetCurrentFile",(async()=>{const{selectedFile:e}=this.state;this.setState({resetInProgress:!0}),await this.conflictManagementFlow.resetFile();const t=this.generateHierarchy();this.setState({resetInProgress:!1,hierarchy:t,selectedFile:rF(rF({},e),{},{resolved:!1})}),this.forceUpdate()})),(0,r.Z)(this,"handleResolveCurrentFile",(()=>{this.conflictManagementFlow.markResolved();const e=this.generateHierarchy(),{selectedFile:t}=this.state;this.setState({hierarchy:e,selectedFile:rF(rF({},t),{},{resolved:!0})})})),(0,r.Z)(this,"handleConflictResolve",(async()=>{if("merge"===this.props.type)return this.setState({solveInProgress:!0}),await this.conflictManagementFlow.solveMergeConflict(),void this.setState({solveInProgress:!1});this.conflictManagementFlow.markPullConflictAsSolved()})),(0,r.Z)(this,"handleAddLinesFromAllDiffs",(async(e=!0)=>{const{selectedFile:t,localUsedLines:o,remoteUsedLines:n}=this.state,i=e?t.diffs.baseDiffs:t.diffs.updatedDiffs,r=e?o:n;if(AO(i,r))for(const s of Object.keys(i))await this.handleRemoveLines(s,r[s]);else for(const s of Object.keys(i)){const o=e?t.baseContent:t.newContent,n=i[s],a=kO(n,r[s],o,e?"local":"remote");await this.handleAddLines(s,a)}}));const t=this.projectUIState.devMode.selectedConflictFile;this.state=rF({},this.getConflictDataForFile(t))}getConflictDataForFile(e){const t=this.projectDoc.projectFiles.conflicts[this.props.branch];e||(e=Object.keys(t.byId)[0]);const o=t.byId[e],n=this.generateHierarchy();return{selectedFilePath:e,selectedFile:o,editorLoaded:!1,resetInProgress:!1,solveInProgress:!1,underExternalUpdate:!1,canResolveConflict:this.checkIfConflictCanBeResolved(),localUsedLines:{},remoteUsedLines:{},hierarchy:n,collaboratorsSelectedFiles:this.generateCollaboratorsSelectedFiles(Object.values(this.webRTCState.devData))}}componentDidMount(){const e=this.projectUIState.devMode.selectedBranch,t=(0,a.select)(this.projectUIState,["devMode/selectedConflictFile"],(({devMode:e})=>{const t=e.selectedConflictFile;if(!t)return;const o=this.projectUIState.devMode.selectedBranch,n=this.projectDoc.projectFiles.conflicts[o];if(!n)return;const{localUsedLines:i={},remoteUsedLines:r={}}=n.byId[t]||{};this.setState(rF(rF({},this.getConflictDataForFile(t)),{},{localUsedLines:i,remoteUsedLines:r}))}),"SubForSelectedFile"),o=(0,a.select)(this.webRTCState,["devData/*","devData","devData/**"],(({devData:e})=>{const t=Object.values(e);this.setState({collaboratorsSelectedFiles:this.generateCollaboratorsSelectedFiles(t)})}),"SubForRtcDataChanges"),n=(0,a.select)(this.projectDoc,[`projectFiles/conflicts/${e}/**`],(t=>{const{selectedFilePath:o}=this.state,{localUsedLines:n,remoteUsedLines:i}=t.projectFiles.conflicts[e].byId[o],r=this.generateHierarchy();this.setState({localUsedLines:JSON.parse(JSON.stringify(n)),remoteUsedLines:JSON.parse(JSON.stringify(i)),canResolveConflict:this.checkIfConflictCanBeResolved(),hierarchy:r},(()=>{this.highlightOutputUsedLines(),this.forceUpdate()}))}),"SubForBranchConflict"),i=(0,a.select)(this.projectDoc,[`projectFiles/conflicts/${e}/actionInProgress`],(t=>{const{actionInProgress:o}=t.projectFiles.conflicts[e];this.setState({actionInProgress:!!o})}),"SubForActionInProgress"),r=(0,a.select)(this.projectDoc,[`projectFiles/conflicts/${e}/solveInProgress`],(t=>{const{solveInProgress:o}=t.projectFiles.conflicts[e];this.setState({solveInProgress:!!o})}),"SubForSolveInProgress"),s=(0,a.select)(this.projectUIState,["devMode/fileUnderExternalUpdate"],(e=>{this.setState({underExternalUpdate:e.devMode.fileUnderExternalUpdate===this.state.selectedFilePath})}),"SubForFileUnderExternalUpdate");(0,Rd.Z)(this,tF).push((()=>{n.dispose(),o.dispose(),t.dispose(),i.dispose(),r.dispose(),s.dispose()}))}componentWillUnmount(){(0,Rd.Z)(this,tF).forEach((e=>e())),(0,Zd.Z)(this,tF,[])}render(){const{actionInProgress:e,hierarchy:t,resetInProgress:o,collaboratorsSelectedFiles:n,selectedFilePath:i,selectedFile:r,localUsedLines:s,solveInProgress:a,remoteUsedLines:c,canResolveConflict:l}=this.state;if(!i)return(0,F.jsx)("div",{tabIndex:0});const d=AO(r.diffs.baseDiffs,s),p=AO(r.diffs.updatedDiffs,c);return(0,F.jsxs)("div",{tabIndex:0,className:`jsx-${$O.__hash}`,children:[(0,F.jsx)(MO,{title:"pull"===this.props.type?`Conflicts found while pulling from ${this.props.branch}`:"Merge conflicts found",handleReset:this.handleResetCurrentFile,handleResolve:this.handleResolveCurrentFile,handleSave:this.handleConflictResolve,canSave:l,solveInProgress:a,resetInProgress:o,resolved:r.resolved,allLocalUsed:d,allRemoteUsed:p,handleAddAllLocalLines:this.handleAddLinesFromAllDiffs,handleAddAllRemoteLines:()=>this.handleAddLinesFromAllDiffs(!1),sidebar:(0,F.jsx)(ZO.a,{files:t,sidebarTitle:"Conflicts",path:Ks.y$,pathUnderRename:null,selectedFilePath:i,selectedFolder:"",handleRootContextMenu:()=>null,collaboratorsSelectedFiles:n,meta:{fileDragInProgress:!1,handleFolderExpand:!0,rootSectionName:"staged"},actions:{selectFile:this.handleSelectFile}}),localContentEditor:(0,F.jsx)(RO,{value:r.baseContent,diffs:r.diffs.baseDiffs,conflictingDiffs:r.diffs.updatedDiffs,usedLines:s,handleAddLines:this.handleAddLines,handleRemoveLines:this.handleRemoveLines}),remoteContentEditor:(0,F.jsx)(RO,{isRemote:!0,value:r.newContent,usedLines:c,diffs:r.diffs.updatedDiffs,conflictingDiffs:r.diffs.baseDiffs,handleAddLines:this.handleAddLines,handleRemoveLines:this.handleRemoveLines}),outputEditor:(0,F.jsx)(CO.ZP,{height:"calc(100% - 24px)",theme:"teleport-theme",language:"typescript",beforeMount:e=>{this.outputMonaco=e,this.setState({editorLoaded:!1}),this.monacoHelper.attach(e)},onMount:this.handleOutputEditorMount,onChange:this.handleOutputChange,options:{minimap:{enabled:!1},readOnly:e||a,glyphMargin:!0,fontFamily:"Source Code Pro, monospace",fontSize:14}})}),(0,F.jsx)(v(),{id:$O.__hash,children:$O})]},i)}},KO=(0,s.Z)(WO.prototype,"projectDoc",[BO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qO=(0,s.Z)(WO.prototype,"absolutePositionedLayerFlow",[GO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JO=(0,s.Z)(WO.prototype,"projectFilesFlow",[HO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XO=(0,s.Z)(WO.prototype,"projectUIState",[zO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QO=(0,s.Z)(WO.prototype,"webRTCState",[YO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eF=(0,s.Z)(WO.prototype,"conflictManagementFlow",[VO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WO);const aF=e=>{var t,o;const n=(null===(t=e.baseContent)||void 0===t?void 0:t.split("\n"))||[],i={};let r=0;const s=[],a=[];let c=0;if(Object.keys((null===(o=e.diffs)||void 0===o?void 0:o.baseDiffs)||{}).forEach((t=>{const o=e.diffs.baseDiffs[t];if(a.push(t),o.negativeRange)return;const l=s.length+1;for(let e=c;e<o.startLine-1;e++)s.push(n[e]);i[r]={startLine:l,endLine:s.length},r+=1,o.endLine>c&&(c=o.endLine)})),c<n.length){const e=s.length+1;for(let t=c;t<n.length;t++)s.push(n[t]);i[r]={startLine:e,endLine:s.length},r+=1}return{content:s.join("\n"),blocks:i,diffsOrder:a}},cF=(e,t)=>{const{startLineNumber:o,endLineNumber:n}=t.range;return Object.keys(e).forEach((t=>{const i=[];e[t].forEach(((e,t)=>{e.editorLine&&e.editorLine>=o&&e.editorLine<=n&&i.push(t)})),i.forEach((o=>{e[t].splice(o,1)}))})),e};var lF,dF,pF,uF,hF,mF,yF,gF,fF,bF,IF,vF,wF,NF,jF,SF,DF,TF,OF,FF,CF,EF,xF,_F,MF,PF,AF;function kF(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function UF(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?kF(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):kF(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}lF=(0,c.provide)("conflictManagementFlow"),dF=(0,c.inject)("projectDoc"),pF=(0,c.inject)("projectUIState"),uF=(0,c.inject)("yDocumentManagementFlow"),hF=(0,c.inject)("modalManagementFlow"),mF=(0,c.inject)("githubRepository"),yF=(0,c.inject)("githubFlow"),gF=(0,c.inject)("contentDiffingService"),fF=(0,c.inject)("sharedbProjectSyncService"),bF=(0,c.inject)("notificationsManagementFlow"),IF=(0,c.inject)("projectFilesFlow"),vF=(0,c.inject)("guardsService"),wF=(0,c.inject)("projectDownloadFlow"),lF((jF=class{constructor(){(0,i.Z)(this,"projectDoc",SF,this),(0,i.Z)(this,"projectUIState",DF,this),(0,i.Z)(this,"yDocumentManagementFlow",TF,this),(0,i.Z)(this,"modalManagementFlow",OF,this),(0,i.Z)(this,"githubRepository",FF,this),(0,i.Z)(this,"githubFlow",CF,this),(0,i.Z)(this,"contentDiffingService",EF,this),(0,i.Z)(this,"dbSync",xF,this),(0,i.Z)(this,"notificationsManagementFlow",_F,this),(0,i.Z)(this,"projectFilesFlow",MF,this),(0,i.Z)(this,"guardsService",PF,this),(0,i.Z)(this,"projectDownloadFlow",AF,this)}init(){const e=this.projectUIState.devMode.selectedBranch,t=this.projectDoc.projectFiles.conflicts[e];if(!t)return;if(!this.projectUIState.devMode.selectedConflictFile){const e=Object.keys(t.byId)[0];this.setSelectedConflictFile(e)}this.openConflictModal()}async handlePullConflict(e){const{files:t,branch:o,sha:n}=e,i=await this.generateDiffsForFiles(t),r=this.generateConflictOutput(o,i),s=Object.keys(r).map((e=>{const t=r[e].content;return this.yDocumentManagementFlow.setText(e,t)}));await Promise.all(s),this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(async e=>{e.projectFiles.addConflict(o,{lastCommitSha:n,byId:r,type:"pull"}),Object.keys(r).forEach((t=>{const n=r[t].content;e.projectFiles.local[o].byId[t].code=n}))}))}));const a=Object.keys(r)[0];this.setSelectedConflictFile(a),this.openConflictModal()}markPullConflictAsSolved(e){if(!e)return;const t=this.projectUIState.devMode.selectedBranch,o=e.projectFiles.conflicts[t];"pull"===o.type&&((0,a.mutate)(this.projectUIState,(e=>{e.devMode.selectedConflictFile=null})),e.projectFiles.local[t].lastSha=o.lastCommitSha,delete e.projectFiles.conflicts[t])}async handleMergeConflict(e,t){(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress="compare"}));const o=await this.compareBranches(e,t);o?(await this.syncFilesAfterConflictingMerge({commitsFiles:o.commitsFiles,branch:e,headBranch:t,latestSha:o.sha}),(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress=null}))):(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress=null}))}async solveMergeConflict(){var e;const t=this.projectUIState.devMode.selectedBranch,o=this.projectDoc.projectFiles.conflicts[t];if(!o||"merge"!==o.type)return;const{headBranch:n,byId:i}=o;if(!n)return;this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[t].solveInProgress=!0}))}));const r=Object.keys(i),s=this.githubFlow.computeFilesWithDiffs().filter((e=>r.includes(e.path)));this.githubFlow.stageFiles({files:s});const c=this.projectUIState.userPreferences.projectType,l=null===(e=this.projectDoc.stats.github)||void 0===e?void 0:e.repositoryOwner;let d=0,p=!1;for(;!p&&d<3;)try{await this.projectDownloadFlow.exportToGithub(c,{commitMessage:`Merge ${n} into ${t}`,deployStagedOnly:!0,repositoryOwner:l,extraBranchParents:[n],displayNotification:!1}),p=!0}catch(u){d+=1}this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{delete e.projectFiles.conflicts[t]}))})),this.githubFlow.loadProjectCommits(),(0,a.mutate)(this.projectUIState,(e=>{e.devMode.selectedConflictFile=null}))}setSelectedConflictFile(e){(0,a.mutate)(this.projectUIState,(t=>{t.devMode.selectedConflictFile=e}))}openConflictModal(){if(this.projectUIState.devMode.conflictModalOpened)return;const e=this.projectUIState.devMode.selectedBranch,t=this.projectDoc.projectFiles.conflicts[e];if(!t)return;const o=b.d.createCustomModal({Component:sF,data:{branch:e,type:t.type,onDismiss:()=>{(0,a.mutate)(this.projectUIState,(e=>{e.devMode.conflictModalOpened=!1})),this.modalManagementFlow.hideModal()},onClose:()=>{(0,a.mutate)(this.projectUIState,(e=>{e.devMode.conflictModalOpened=!1}))}}});this.modalManagementFlow.showModal(o,{padding:0},!1),(0,a.mutate)(this.projectUIState,(e=>{e.devMode.conflictModalOpened=!0}))}closeConflictModal(){this.projectUIState.devMode.conflictModalOpened&&(this.modalManagementFlow.hideModal(),(0,a.mutate)(this.projectUIState,(e=>{e.devMode.conflictModalOpened=!1})),this.notificationsManagementFlow.createNotification(d.k$.SUCCESS,"Conflict was solved"))}async removeLinesFromConflict(e,t){if(!t.length)return;const o=this.projectUIState.devMode.selectedBranch,n=this.projectUIState.devMode.selectedConflictFile;if(!n)return;const i=this.projectDoc.projectFiles.conflicts[o].byId[n];if(!i)return;this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[o].actionInProgress=!0}))}));const{localUsedLines:r,remoteUsedLines:s}=i;t.forEach(((o,i)=>{if(!o.editorLine)return;const a="local"===o.source?r:s,c=a[e].findIndex((e=>e.line===o.line));a[e].splice(c,1),this.yDocumentManagementFlow.removeTextFromLine(n,o.editorLine-1),Object.keys(r).forEach((e=>{r[e].forEach((e=>{!t.some((t=>t.editorLine===e.editorLine))&&e.editorLine&&o.editorLine&&e.editorLine>o.editorLine&&(e.editorLine-=1)}))})),Object.keys(s).forEach((e=>{s[e].forEach((e=>{!t.some((t=>t.editorLine===e.editorLine))&&e.editorLine&&o.editorLine&&e.editorLine>o.editorLine&&(e.editorLine-=1)}))}));for(let e=i+1;e<t.length;e++){const n=t[e];n.editorLine&&o.editorLine&&n.editorLine>o.editorLine&&(n.editorLine-=1)}}));const{diffsOrder:a,blocks:c}=i,l=a.indexOf(e);for(let d=l;d<Object.keys(c).length;d++){const e=c[d];d!==l&&(e.startLine-=t.length),e.endLine-=t.length}this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[o].actionInProgress=!1,e.projectFiles.conflicts[o].byId[n].blocks=c,e.projectFiles.conflicts[o].byId[n].localUsedLines=r,e.projectFiles.conflicts[o].byId[n].remoteUsedLines=s}))}))}async addLinesFromConflict(e,t){if(!t.length)return;const o=this.projectUIState.devMode.selectedBranch,n=this.projectUIState.devMode.selectedConflictFile;if(!n)return;const i=this.projectDoc.projectFiles.conflicts[o].byId[n];if(!i)return;const{diffsOrder:r,blocks:s}=i,a=r.indexOf(e),c=s[a];if(!c)return;this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[o].actionInProgress=!0}))}));let l=c.endLine+1;const d=l;t.forEach((e=>{e.editorLine=l,l+=1}));const{localUsedLines:p,remoteUsedLines:u}=i,h=t.filter((e=>"local"===e.source)),m=t.filter((e=>"remote"===e.source)),y=UF(UF({},p),{},{[e]:[...(null===p||void 0===p?void 0:p[e])||[],...h]}),g=UF(UF({},u),{},{[e]:[...(null===u||void 0===u?void 0:u[e])||[],...m]});Object.keys(y).forEach((o=>{o!==e&&y[o].forEach((e=>{e.editorLine&&e.editorLine>=d&&(e.editorLine+=t.length)}))})),Object.keys(g).forEach((o=>{g[o].forEach((n=>{o!==e&&n.editorLine&&n.editorLine>=d&&(n.editorLine+=t.length)}))}));for(let b=a;b<Object.keys(s).length;b++){const e=s[b];b!==a&&(e.startLine+=t.length),e.endLine+=t.length}const f=t.map((e=>e.content)).join("\n");this.yDocumentManagementFlow.addTextAtLine(n,d,`\n${f}`),this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[o].actionInProgress=!1,e.projectFiles.conflicts[o].byId[n].blocks=s,e.projectFiles.conflicts[o].byId[n].localUsedLines=y,e.projectFiles.conflicts[o].byId[n].remoteUsedLines=g}))}))}async resetFile(){const e=this.projectUIState.devMode.selectedBranch,t=this.projectUIState.devMode.selectedConflictFile;if(!t)return;const o=this.projectDoc.projectFiles.conflicts[e].byId[t];if(!o)return;this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(t=>{t.projectFiles.conflicts[e].actionInProgress=!0}))}));const{blocks:n,content:i}=aF(o);await this.yDocumentManagementFlow.setText(t,i),this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(o=>{o.projectFiles.local[e].byId[t].code=i,o.projectFiles.conflicts[e].actionInProgress=!1,o.projectFiles.conflicts[e].byId[t].resolved=!1,o.projectFiles.conflicts[e].byId[t].blocks=n,o.projectFiles.conflicts[e].byId[t].localUsedLines={},o.projectFiles.conflicts[e].byId[t].remoteUsedLines={}}))}))}markResolved(){const e=this.projectUIState.devMode.selectedBranch,t=this.projectUIState.devMode.selectedConflictFile;if(!t)return;this.projectDoc.projectFiles.conflicts[e].byId[t]&&this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(o=>{o.projectFiles.conflicts[e].byId[t].resolved=!0}))}))}handleContentChange(e){const t=this.projectUIState.devMode.selectedBranch,o=this.projectUIState.devMode.selectedConflictFile;if(!o)return;const n=this.projectDoc.projectFiles.conflicts[t].byId[o];if(!n)return;const{blocks:i}=n,r=((e,t)=>{let o=[];const{changes:n,eol:i}=t;return n.forEach((t=>{const{range:n,text:r}=t,{startLineNumber:s,endLineNumber:a}=n;if(""===r&&s===a)return;const c=Object.keys(e).findIndex((t=>{const o=e[t];return o.startLine<=s&&o.endLine>=s}));if(""===r&&s!==a){const t=Object.keys(e).findIndex((t=>{const o=e[t];return o.startLine<=a&&o.endLine>=a}));return void(o=Object.keys(e).map(((o,n)=>{const i=e[o];if(c===t&&n<c)return i;if(n===c)return i.endLine-=c===t?a-s:i.endLine-s,i;if(n>c&&n<t)return i.startLine=e[n-1].endLine,i.endLine=i.startLine,i;if(n===t){const t=a-i.startLine,o=i.endLine-i.startLine-t;return i.startLine=e[n-1].endLine+1,i.endLine=i.startLine+o-1,i.startLine>i.endLine&&(i.startLine=i.endLine),i}var r,l;if(i.endLine===i.startLine)return i.startLine=(null===(r=e[n-1])||void 0===r?void 0:r.endLine)||i.startLine,i.endLine=(null===(l=e[n-1])||void 0===l?void 0:l.endLine)||i.endLine,i;const d=i.endLine-i.startLine;return i.startLine=e[n-1].endLine+1,i.endLine=i.startLine+d,i})))}const l=r.split(i).length-1;if(l){if(-1===c)throw new Error("Output block not found after new line was added.");o=Object.keys(e).map(((t,o)=>{const n=e[t];return o===c&&(n.endLine+=l),o>c&&(n.startLine+=l,n.endLine+=l),n}))}})),o.length||(o=Object.values(e)),o.reduce(((e,t,o)=>(e[o]=t,e)),{})})(i,e),{localUsedLines:s,remoteUsedLines:a}=((e,t,o)=>{const{changes:n,eol:i}=e;return n.forEach((e=>{const{range:n,text:r}=e,{startLineNumber:s,endLineNumber:a}=n;t=cF(t,e),o=cF(o,e);let c=r.split(i).length-1;""===r&&s!==a&&(c-=a-s),c&&(Object.keys(t).forEach((e=>{t[e].forEach((e=>{e.editorLine&&e.editorLine>s&&(e.editorLine+=c)}))})),Object.keys(o).forEach((e=>{o[e].forEach((e=>{e.editorLine&&e.editorLine>s&&(e.editorLine+=c)}))})))})),{localUsedLines:t,remoteUsedLines:o}})(e,n.localUsedLines,n.remoteUsedLines);this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[t].byId[o].blocks=r,e.projectFiles.conflicts[t].byId[o].localUsedLines=s,e.projectFiles.conflicts[t].byId[o].remoteUsedLines=a}))}))}async compareBranches(e,t){if(!this.projectDoc.stats.github)return;const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(o&&n)try{const i=await this.githubRepository.compareBranches(this.projectDoc.id,{repository:o,owner:n,base:e,head:t});return{commitsFiles:i.files.reduce(((e,t)=>{const{content:o,status:n,filename:i}=t;return e[i]={content:o,status:n},e}),{}),sha:i.commits[0].sha}}catch(i){return this.notificationsManagementFlow.createNotification(d.k$.ERROR,`Could not compare branches: ${e} and ${t}`),null}}async syncFilesAfterConflictingMerge(e){const{branch:t,headBranch:o,commitsFiles:n,latestSha:i}=e,r={},s={};let a={};await this.contentDiffingService.loadDiffComputer(),await new Promise((e=>{this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(c=>{for(const e of Object.keys(n)){if(e.startsWith(Ks.Xh)||e.startsWith("public/playground_assets/"))continue;const o=`${Ks.y$}/${e}`,i=n[e].content,a={code:i,is_protected:!1,synced_at:Date.now()},l=c.projectFiles.local[t].byId[o];if("added"===n[e].status&&!l){c.projectFiles.local[t].byId[o]=a,c.projectFiles.staged[t].byId[o]=a,this.yDocumentManagementFlow.setTextOnBranch(o,i,t);continue}if((c.projectFiles.remote[t].byId[o]?`${c.projectFiles.remote[t].byId[o].code}`:null)||(c.projectFiles.remote[t].byId[o]=a),!l){c.projectFiles.local[t].byId[o]=a,c.projectFiles.staged[t].byId[o]=a,this.yDocumentManagementFlow.setTextOnBranch(o,i,t);continue}const d=this.contentDiffingService.computeDiff(l.code,i);(Object.keys(d.baseDiffs).length||Object.keys(d.updatedDiffs).length)&&(r[o]={baseContent:l.code,newContent:i,diffs:d},s[o]=l)}a=this.generateConflictOutput(t,r),c.projectFiles.addConflict(t,{lastCommitSha:i,byId:a,headBranch:o,type:"merge"}),Object.keys(a).forEach((e=>{const o=a[e].content;c.projectFiles.local[t].byId[e].code=o})),e()}))}))}));for(const l of Object.keys(a)){const e=a[l].content;await this.yDocumentManagementFlow.replaceText(l,e)}const c=Object.keys(a)[0];this.setSelectedConflictFile(c),this.openConflictModal()}async generateDiffsForFiles(e){const t={};await this.contentDiffingService.loadDiffComputer();for(const o of Object.keys(e)){const n=e[o],i=this.contentDiffingService.computeDiff(n.current,n.new);t[o]={baseContent:n.current,newContent:n.new,diffs:i}}return t}generateConflictOutput(e,t){return Object.keys(t).reduce(((o,n)=>(o[n]=UF(UF({},aF(t[n])),{},{baseContent:this.projectDoc.projectFiles.local[e].byId[n].code,newContent:t[n].newContent,diffs:t[n].diffs,localUsedLines:{},remoteUsedLines:{},resolved:!1}),o)),{})}},SF=(0,s.Z)(jF.prototype,"projectDoc",[dF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DF=(0,s.Z)(jF.prototype,"projectUIState",[pF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TF=(0,s.Z)(jF.prototype,"yDocumentManagementFlow",[uF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OF=(0,s.Z)(jF.prototype,"modalManagementFlow",[hF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FF=(0,s.Z)(jF.prototype,"githubRepository",[mF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CF=(0,s.Z)(jF.prototype,"githubFlow",[yF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EF=(0,s.Z)(jF.prototype,"contentDiffingService",[gF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xF=(0,s.Z)(jF.prototype,"dbSync",[fF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_F=(0,s.Z)(jF.prototype,"notificationsManagementFlow",[bF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MF=(0,s.Z)(jF.prototype,"projectFilesFlow",[IF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PF=(0,s.Z)(jF.prototype,"guardsService",[vF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AF=(0,s.Z)(jF.prototype,"projectDownloadFlow",[wF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(jF.prototype,"markPullConflictAsSolved",[so.W],Object.getOwnPropertyDescriptor(jF.prototype,"markPullConflictAsSolved"),jF.prototype),NF=jF));var RF,ZF,LF,$F,BF,GF,HF,zF,YF,VF,WF,KF,qF,JF,XF,QF,eC,tC,oC,nC,iC,rC,sC,aC,cC,lC,dC,pC,uC,hC,mC;RF=(0,c.provide)("remoteChangesFlow"),ZF=(0,c.inject)("projectDoc"),LF=(0,c.inject)("projectUIState"),$F=(0,c.inject)("githubFlow"),BF=(0,c.inject)("notificationsManagementFlow"),GF=(0,c.inject)("yDocumentManagementFlow"),HF=(0,c.inject)("modalManagementFlow"),zF=(0,c.inject)("contentDiffingService"),YF=(0,c.inject)("guardsService"),VF=(0,c.inject)("sharedbProjectSyncService"),WF=(0,c.inject)("conflictManagementFlow"),KF=(0,c.inject)("githubRepository"),qF=(0,c.inject)("projectFilesFlow"),JF=(0,c.inject)("assetsUploadFlow"),XF=(0,c.inject)("assetsEditFlow"),RF((eC=class{constructor(){(0,i.Z)(this,"projectDoc",tC,this),(0,i.Z)(this,"projectUIState",oC,this),(0,i.Z)(this,"githubFlow",nC,this),(0,i.Z)(this,"notificationsManagementFlow",iC,this),(0,i.Z)(this,"yDocumentManagementFlow",rC,this),(0,i.Z)(this,"modalManagementFlow",sC,this),(0,i.Z)(this,"contentDiffingService",aC,this),(0,i.Z)(this,"guardsService",cC,this),(0,i.Z)(this,"dbSync",lC,this),(0,i.Z)(this,"conflictManagementFlow",dC,this),(0,i.Z)(this,"githubRepository",pC,this),(0,i.Z)(this,"projectFilesFlow",uC,this),(0,i.Z)(this,"assetsUploadFlow",hC,this),(0,i.Z)(this,"assetsEditFlow",mC,this)}async applyRemoteChanges(e,t){var o;const n=this.projectUIState.devMode.selectedBranch;if(this.projectDoc.projectFiles.conflicts[n])return;const i=null===(o=this.projectDoc.projectFiles.local[t])||void 0===o?void 0:o.lastSha,r=this.filterCommitsThatNeedParsing(e,t);if(!r.length&&i)return;(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress="sync"}));let s={};const c="remote"===this.projectUIState.devMode.githubBranches.byId[t].type;if(i)s=await this.compareWithLatestCommit(i,r[0].sha);else if(c||r.length>10){const e=await this.loadBranchContent(t);if(!e)return;s=Object.keys(e).reduce(((t,o)=>{const n=e[o];return t[o]={content:n,status:"remote-only-file"},t}),{})}else s=await this.loadCommitsFiles(r);const l=await this.applyChangesToLocalFiles({commitsFiles:s,latestSha:r[0].sha,branch:t});Object.keys(l).length?this.conflictManagementFlow.handlePullConflict({branch:t,sha:r[0].sha,files:l}):this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.local[n].lastSha=r[0].sha}))})),(0,a.mutate)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress=null}))}applyChangesToLocalFiles(e){const{doc:t,branch:o,commitsFiles:n}=e,i={};if(!t)return i;t.projectFiles.local[o]||(t.projectFiles.local[o]={byId:{}}),t.projectFiles.remote[o]||(t.projectFiles.remote[o]={byId:{}}),t.projectFiles.staged[o]||(t.projectFiles.staged[o]={byId:{}});for(const r of Object.keys(n)){if(r.startsWith(Ks.Xh))continue;const e=r.match(/\.([^\.]+)$/);if(!e)continue;if(Br.oy.includes(e[1].toLowerCase())){if(!r.startsWith(Ks._C))continue;const{content:e,status:i}=n[r],s=r.split("/").pop()||"",a=`${Ks.Wn}/playground_assets/${s}`,c=t.assets.findAssetUsingName(s);if("added"===i&&void 0===c){const n=new File([e],s,{type:"image/jpeg"});this.assetsUploadFlow.upload({files:[n],parentFolderId:ut.D.PUBLIC_ASSETS}),t.projectFiles.remote[o].byId[a]={code:"",is_asset:!0}}"removed"===i&&c&&0===Object.keys(c.usedInNodes).length&&(Object.keys(t.projectFiles.remote).forEach((e=>{delete t.projectFiles.remote[e].byId[a]})),this.assetsEditFlow.delete([c.id]));continue}const s=`${Ks.y$}/${r}`,{content:a,status:c}=n[r],l=t.projectFiles.local[o].byId[s],d=t.projectFiles.remote[o].byId[s]?`${t.projectFiles.remote[o].byId[s].code}`:null;if("added"===c){if(!l){this.projectFilesFlow.createFile({doc:t,fileId:s,content:a,remote:!0});continue}if(l.code===a)continue;i[s]={new:a,current:l.code};continue}if("removed"===c){if(!l&&!d)continue;if((null===l||void 0===l?void 0:l.code)===d){this.projectFilesFlow.deleteFile({doc:t,fileId:s,permanent:!0});continue}i[s]={new:a,current:l.code};continue}const p={code:a,is_protected:!1,synced_at:Date.now()};"remote-only-file"!==c?(d?d!==a&&(t.projectFiles.remote[o].byId[s].code=a):t.projectFiles.remote[o].byId[s]=p,l?l.code!==d?null===d&&a===l.code||(i[s]={new:a,current:l.code}):(t.projectFiles.local[o].byId[s].code=a,this.yDocumentManagementFlow.setTextOnBranch(s,a,o)):(t.projectFiles.local[o].byId[s]=p,this.yDocumentManagementFlow.setTextOnBranch(s,a,o))):(t.projectFiles.remote[o].byId[s]=p,t.projectFiles.local[o].byId[s]=p,this.yDocumentManagementFlow.setTextOnBranch(s,a,o))}return i}filterCommitsThatNeedParsing(e,t){var o;const n=null===(o=this.projectDoc.projectFiles.local[t])||void 0===o?void 0:o.lastSha;let i=0,r=!1;const s=[];for(;!r&&i<e.length;){const t=e[i];if(t.sha!==n){if(s.push(t),i++,i===e.length&&n)throw new Error("We tried to find the commit from the last sync but failed")}else r=!0}return s}async compareWithLatestCommit(e,t){if(!this.projectDoc.stats.github)throw new Error("No GitHub data saved");const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(!o||!n)throw new Error("Repository name or owner not found");return(await this.githubRepository.compareBranches(this.projectDoc.id,{repository:o,owner:n,base:e,head:t})).files.reduce(((e,t)=>{const{filename:o,content:n,status:i}=t;return e[o]={content:n,status:i},e}),{})}async loadBranchContent(e){if(!this.projectDoc.stats.github)return null;const{repositoryName:t,repositoryOwner:o}=this.projectDoc.stats.github;if(!t||!o)return null;try{return await this.githubRepository.getRepoContent(this.projectDoc.id,{ref:e,repository:t,owner:o})}catch(n){return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not get GitHub project files"),null}}async loadCommitsFiles(e){const t={};for(let o=e.length-1;o>=0;o--){const n=await this.githubFlow.loadCommitFiles(e[o].sha);n&&n.files.forEach((e=>{const{filename:o,content:n,status:i}=e;t[o]={content:n,status:i}}))}return t}},tC=(0,s.Z)(eC.prototype,"projectDoc",[ZF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oC=(0,s.Z)(eC.prototype,"projectUIState",[LF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nC=(0,s.Z)(eC.prototype,"githubFlow",[$F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iC=(0,s.Z)(eC.prototype,"notificationsManagementFlow",[BF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rC=(0,s.Z)(eC.prototype,"yDocumentManagementFlow",[GF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sC=(0,s.Z)(eC.prototype,"modalManagementFlow",[HF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aC=(0,s.Z)(eC.prototype,"contentDiffingService",[zF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cC=(0,s.Z)(eC.prototype,"guardsService",[YF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lC=(0,s.Z)(eC.prototype,"dbSync",[VF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dC=(0,s.Z)(eC.prototype,"conflictManagementFlow",[WF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pC=(0,s.Z)(eC.prototype,"githubRepository",[KF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uC=(0,s.Z)(eC.prototype,"projectFilesFlow",[qF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hC=(0,s.Z)(eC.prototype,"assetsUploadFlow",[JF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mC=(0,s.Z)(eC.prototype,"assetsEditFlow",[XF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(eC.prototype,"applyChangesToLocalFiles",[so.W],Object.getOwnPropertyDescriptor(eC.prototype,"applyChangesToLocalFiles"),eC.prototype),QF=eC));var yC,gC,fC,bC,IC,vC,wC,NC,jC,SC,DC,TC,OC;yC=(0,c.provide)("codeEditorFlow"),gC=(0,c.inject)("projectUIState"),fC=(0,c.inject)("globalAppState"),bC=(0,c.inject)("userAccountRepository"),IC=(0,c.inject)("sentryService"),vC=(0,h.G)(g.l.DEV_SIDEBAR_CHANGE),wC=(0,h.G)(g.l.DEV_SET_PREVIEW_TYPE),yC((jC=class{constructor(){(0,i.Z)(this,"projectUIState",SC,this),(0,i.Z)(this,"globalAppState",DC,this),(0,i.Z)(this,"userAccountRepository",TC,this),(0,i.Z)(this,"sentryService",OC,this)}updateFolderExpandedStatus(e,t=!1){(0,a.mutate)(this.projectUIState,(o=>{o.devMode.expandedFolders[e]=t}))}handleDevSidebarChange(e){return(0,a.mutate)(this.projectUIState,(t=>{const{devMode:o}=t;o.sidebarSettings.panel===e?o.sidebarSettings.panel=null:o.sidebarSettings.panel=e})),!0}handlePreviewerTypeChange(e){(0,a.mutate)(this.projectUIState,(t=>t.userPreferences.devPreviewerType=e)),e===p.jK.OUTSIDE&&this.projectUIState.devMode.showPreviewer&&window.open(`${window.location.origin}${(0,Ya.mZ)(this.projectUIState.slug)}`)}toggleLoadingPackages(){(0,a.mutate)(this.projectUIState,(e=>{e.devMode.loadingPackages=!e.devMode.loadingPackages}))}handleEditorBundleStatusChange(e){(0,a.mutate)(this.projectUIState,(t=>{t.devMode.bundlerStatus=e||null}))}toggleConsole(){(0,a.mutate)(this.projectUIState,(({devMode:e})=>{e.showConsole=!e.showConsole}))}setDevSidebarWidth(e){(0,a.mutate)(this.projectUIState,(({devMode:t})=>{t.sidebarSettings.width=e}))}setSidebarGridTemplateColumns(e){(0,a.mutate)(this.projectUIState,(({devMode:t})=>{t.sidebarSettings.gridTemplateColumns=e}))}async updateUserMetaDevMode(){(0,a.mutate)(this.globalAppState,(({user:e})=>{var t,o;!e.userData||null!==(t=e.userData.meta)&&void 0!==t&&null!==(o=t.devModeEnabled)&&void 0!==o&&o.isEnabled||(e.userData.meta.devModeEnabled={isEnabled:!0})}));try{var e;await this.userAccountRepository.update({meta:null===(e=this.globalAppState.user.userData)||void 0===e?void 0:e.meta})}catch(t){if(t instanceof d.ZN)return;this.sentryService.captureException(new Error("Could not update user meta"))}}},SC=(0,s.Z)(jC.prototype,"projectUIState",[gC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DC=(0,s.Z)(jC.prototype,"globalAppState",[fC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TC=(0,s.Z)(jC.prototype,"userAccountRepository",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OC=(0,s.Z)(jC.prototype,"sentryService",[IC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(jC.prototype,"handleDevSidebarChange",[vC],Object.getOwnPropertyDescriptor(jC.prototype,"handleDevSidebarChange"),jC.prototype),(0,s.Z)(jC.prototype,"handlePreviewerTypeChange",[wC],Object.getOwnPropertyDescriptor(jC.prototype,"handlePreviewerTypeChange"),jC.prototype),NC=jC));var FC,CC;(0,c.provide)("componentRenderStyleFlow")((CC=class{updateComponentRenderStyle(e){var t;const{doc:o,renderStyle:n,compId:i}=e;o&&i&&(null===(t=o.components.byId[i])||void 0===t||t.changeRenderStyle({newRenderStyle:n}))}},(0,s.Z)(CC.prototype,"updateComponentRenderStyle",[m.P],Object.getOwnPropertyDescriptor(CC.prototype,"updateComponentRenderStyle"),CC.prototype),FC=CC));var EC=o(803096),xC=o.n(EC),_C=o(90899),MC=o(802326),PC=o(686912),AC=o(378366);const kC=(0,AC.dz)((0,AC.Ry)({component:(0,AC.Z_)(),content:(0,AC.Z_)(),sourcemap:(0,AC.Z_)(),sourceMapContent:(0,AC.Z_)()}));var UC,RC,ZC,LC,$C,BC,GC,HC,zC,YC,VC,WC,KC,qC,JC,XC,QC,eE,tE,oE,nE,iE,rE,sE,aE;function cE(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function lE(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?cE(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):cE(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}UC=(0,c.provide)("cloudComponentsFlow"),RC=(0,c.inject)("projectUIState"),ZC=(0,c.inject)("projectDoc"),LC=(0,c.inject)("notificationsManagementFlow"),$C=(0,c.inject)("packerService"),BC=(0,c.inject)("transpilerService"),GC=(0,c.inject)("cloudComponentsRepository"),HC=(0,c.inject)("componentManagementFlow"),zC=(0,c.inject)("designLanguageManagementFlow"),YC=(0,c.inject)("modalManagementFlow"),VC=(0,c.inject)("guardsService"),WC=(0,c.inject)("sharedbProjectSyncService"),UC((qC=class{constructor(){(0,i.Z)(this,"projectUIState",JC,this),(0,i.Z)(this,"projectDoc",XC,this),(0,i.Z)(this,"notificationsManagementFlow",QC,this),(0,i.Z)(this,"packerService",eE,this),(0,i.Z)(this,"transpilerService",tE,this),(0,i.Z)(this,"cloudComponentsRepository",oE,this),(0,i.Z)(this,"componentManagementFlow",nE,this),(0,i.Z)(this,"designLanguageManagementFlow",iE,this),(0,i.Z)(this,"modalManagementFlow",rE,this),(0,i.Z)(this,"guardsService",sE,this),(0,i.Z)(this,"dbSync",aE,this)}traverseCompDeps(e){let t={};const o=this.projectDoc.components.byId[e];if(!o)throw new Error("Component is missing from doc");return t[(0,PC.UO)(o.title)]=o.id,Object.keys((null===o||void 0===o?void 0:o.usedComponents)||{}).forEach((e=>{t=lE(lE({},t),this.traverseCompDeps(e))})),t}async generateCloudComponentLink(e,t){var o;const n=this.projectDoc.components.byId[e];if(!n)throw new Error("Component is missing from project-doc");const i=this.traverseCompDeps(e),r=new Map,s=Object.values(this.projectDoc.assets.byId||{}).reduce(((e,t)=>(Object.keys(t.usedInNodes||{}).forEach((o=>{e[o]||(e[o]=[]);const n=(0,kn.parse)(t.name).ext;e[o].push({localPath:`https://jscdn.teleporthq.io/${this.projectUIState.slug}/assets/${t.path}${n}`,id:t.path,optimised:!t.skipOptimisations});const s=this.projectDoc.getComponentIdForNode(o);if(!s||!Object.values(i).includes(s))return e;r.set(t.path,{id:t.path,ext:n})})),e)),{}),{uidl:a}=await Ls({title:this.projectUIState.title,slug:this.projectUIState.slug,doc:this.projectDoc,projectType:t,assetSrcMapping:s,options:{disableResetCSS:!0},secretKeys:[],applyForegroundTokenToFill:this.projectUIState.userPreferences.applyForegroundColorAsIconFill,exportUnusedClasses:this.projectUIState.userPreferences.exportUnusedClasses});a.root.styleSetDefinitions=lE(lE({},null===(o=a.root)||void 0===o?void 0:o.styleSetDefinitions),{},{[PC.P5]:{type:"reusable-project-style-map",content:(0,PC.KD)(this.projectDoc.designLanguage)}});const c=(0,PC.vT)(a.root.designLanguage||{tokens:{}},a.root.styleSetDefinitions),l=(0,PC.Tj)(a.globals.assets),d=Object.values(i||{}).map((e=>{var o,n,r,s,d,p;const u=this.projectDoc.components.byId[e],h=null===(o=a.components)||void 0===o?void 0:o[u.title];if(!h)throw new Error(`Component ${null===u||void 0===u?void 0:u.title} is missing from ProjectUIDL`);return h.node.content.referencedStyles=lE(lE({},h.node.content.referencedStyles),{},{[PC.P5]:{type:"style-map",content:{mapType:"project-referenced",referenceId:PC.P5}}}),null===(n=h.node.content)||void 0===n||null===(r=n.children)||void 0===r||r.unshift((0,PC.ex)(null===(s=l.outputOptions)||void 0===s?void 0:s.fileName)),h.outputOptions={fileName:Object.keys(i).find((t=>i[t]===e))},this.packerService.generateReactComponent(h,t,{extractedResources:{},projectStyleSet:{styleSetDefinitions:(0,MC.z)((null===(d=a.root)||void 0===d?void 0:d.styleSetDefinitions)||{},{extractedResources:{}}),fileName:null===(p=c.outputOptions)||void 0===p?void 0:p.fileName,path:"./",importFile:!0}})})),p=await Promise.all([...d,this.packerService.generateGlobalsComponent(l,t),this.packerService.generateProjectStyleSheet(c)]),u={};for(const m of p){const{files:e}=m,t=await this.transpilerService.transpile(e[0].content,e[0].fileType);u[e[0].name]={name:e[0].name,fileType:e[0].fileType,content:t,version:xC()(t),deps:await this.transpilerService.parseImports(t)}}Object.values(u).forEach((e=>{const t=lE(lE({},((null===e||void 0===e?void 0:e.deps)||[]).reduce(((e,t)=>{var o;const n=null===t||void 0===t||null===(o=t.n)||void 0===o?void 0:o.substring(2);return n&&u[n]?(e[n]=u[n].version,e):e}),{})),{},{[e.name]:u[e.name].version}),o=xC()(t);u[e.name]=lE(lE(lE({},u[e.name]),(0,PC.EV)((0,PC._5)(this.projectUIState.slug,e.name,o))),{},{id:i[e.name]||e.name,componentName:(0,PC.iY)(e.name,o).component,versionWithDeps:o})})),Object.values(u).forEach((e=>{const{versionWithDeps:t,deps:o,content:n}=e;if(!t)throw new Error("Component is missing version with deps");if(!u[e.name])throw new Error(`Component ${e.name} is missing from map`);const i=new _C.ZP(n);null===o||void 0===o||o.forEach((e=>{var t;if(null===e||void 0===e||!e.n)return;const o=u[null===(t=e.n)||void 0===t?void 0:t.substring(2)];o&&i.overwrite(e.s,e.e,o.component)})),u[e.name]=lE(lE({},u[e.name]),{},{content:(0,PC.pp)(i.toString(),e.name,t),sourceMapContent:i.generateMap().toString()})}));try{const e={usedAssets:Object.values(Object.fromEntries(r)),components:kC.runWithException(u)},o=await this.cloudComponentsRepository.generateLink({compName:n.title,data:e});if(!o)throw new Error("Failed in generating CDN link");this.saveCloudComponents({parsedComponents:u,framework:t});const i=(0,dr.Gz)(n.title);return{code:`import ${i} from '${o}' \n \n <${i} ${Object.values((null===n||void 0===n?void 0:n.propDefinitions)||{}).reduce(((e,t)=>e=e+"\n"+` ${t.name}={'${t.defaultValue}'}`),"")} />`,url:o}}catch(h){console.error(h)}return null}async deleteComponent(e){const{compId:t,url:o}=e;await this.cloudComponentsRepository.deleteCompModule({paths:[o]}),this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{delete e.cloudComponents.byId[t][o]}))}))}async deleteAllComponents(e){const{compId:t}=e,o=this.projectDoc.cloudComponents.byId[t];0!==Object.keys(o||{}).length&&(await this.cloudComponentsRepository.deleteCompModule({paths:Object.keys(o)}),this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{delete e.cloudComponents.byId[t]}))})))}saveCloudComponents(e){const{parsedComponents:t,framework:o}=e;this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{Object.values(t).forEach((t=>{const{component:n}=(0,PC.iY)(t.name,t.versionWithDeps);t.name!==PC.i2&&t.name!==PC.YE?e.cloudComponents.saveComponent({id:t.id,path:n,component:{created:(new Date).toISOString(),framework:o}}):e.cloudComponents.saveComponent({id:t.id,path:n,component:{created:(new Date).toISOString()}})}))}))}))}},JC=(0,s.Z)(qC.prototype,"projectUIState",[RC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XC=(0,s.Z)(qC.prototype,"projectDoc",[ZC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QC=(0,s.Z)(qC.prototype,"notificationsManagementFlow",[LC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eE=(0,s.Z)(qC.prototype,"packerService",[$C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tE=(0,s.Z)(qC.prototype,"transpilerService",[BC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oE=(0,s.Z)(qC.prototype,"cloudComponentsRepository",[GC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nE=(0,s.Z)(qC.prototype,"componentManagementFlow",[HC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iE=(0,s.Z)(qC.prototype,"designLanguageManagementFlow",[zC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rE=(0,s.Z)(qC.prototype,"modalManagementFlow",[YC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sE=(0,s.Z)(qC.prototype,"guardsService",[VC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aE=(0,s.Z)(qC.prototype,"dbSync",[WC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KC=qC));var dE=o(869929),pE=o(511720);const uE="var(--dl-";var hE,mE,yE,gE,fE,bE,IE,vE,wE,NE,jE,SE,DE,TE,OE,FE,CE,EE,xE,_E,ME,PE,AE,kE,UE,RE,ZE,LE;function $E(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function BE(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?$E(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):$E(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}hE=(0,c.provide)("htmlToDomainFlow"),mE=(0,c.inject)("cssToDomainFlow"),yE=(0,c.inject)("projectUIState"),gE=(0,c.inject)("projectDoc"),fE=(0,c.inject)("projectClassManagementFlow"),bE=(0,c.inject)("nodeManagementFlow"),IE=(0,c.inject)("notificationsManagementFlow"),vE=(0,c.inject)("modalManagementFlow"),wE=(0,c.inject)("workersProvider"),NE=(0,c.inject)("positioningService"),jE=(0,c.inject)("componentManagementFlow"),SE=(0,c.inject)("nodeSelectionFlow"),DE=(0,c.inject)("globalAppState"),TE=(0,h.G)(g.l.SUBMIT_HTML_CSS),hE((FE=class{constructor(){(0,i.Z)(this,"cssToDomainFlow",CE,this),(0,i.Z)(this,"projectUIState",EE,this),(0,i.Z)(this,"projectDoc",xE,this),(0,i.Z)(this,"projectClassManagementFlow",_E,this),(0,i.Z)(this,"nodeManagementFlow",ME,this),(0,i.Z)(this,"notificationsManagementFlow",PE,this),(0,i.Z)(this,"modalManagementFlow",AE,this),(0,i.Z)(this,"workersProvider",kE,this),(0,i.Z)(this,"positioningService",UE,this),(0,i.Z)(this,"componentManagementFlow",RE,this),(0,i.Z)(this,"nodeSelectionFlow",ZE,this),(0,i.Z)(this,"globalAppState",LE,this)}async openEditor(e){const t=e.includes('data-teleport="aiv2"')?await this.makePostRequestToAIV2WithProjectClasses(e):e;if(null===t)return;const o=b.d.createCustomModal({data:{code:t,title:"HTML Import",checkIfTeleportCompatible:!0},Component:au,onSubmit:async(e,t)=>{const o=await this.workersProvider.generateHtmlTreeFromCode(e);this.submitHtml({htmlTree:o,classesToDuplicate:t}),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(o,{padding:"0px"})}submitHtml(e){const{htmlTree:t,doc:o,classesToDuplicate:n}=e;if(!o)return;const i=this.nodeSelectionFlow.getSelectedNodesIds();if(i.length>1)return;const{classes:r,nodeHierarchy:s,nodeIdToIdAttr:a,compoundClasses:c,classesUsedInHtmlAndAlreadyInTheProject:l}=this.convertHtmlTreeToDomain(t),p=Object.values(s).filter((e=>!e.parentId)),u=o.getRootNodeIdForPageOrComponent(this.projectUIState.selection.componentId||""),h=i.length?i[0]:u,m=this.nodeManagementFlow.findParentThatAcceptsNodes({startNode:o.nodes.getById(h||""),nodes:p});m?(this.addNodeHierarchyBFS({doc:o,hierarchy:s,targetNodeId:m.id,roots:p}),this.addNodeIdsToComp({nodeIdToIdAttr:a,doc:o}),Object.values(r).forEach((e=>{this.mergeClassesOnCollision({cls:e,doc:o,nodeHierarchy:s,classesToMerge:BE({},l),classesToDuplicate:n})||this.projectClassManagementFlow.addSimpleClass({classToAdd:e,doc:o})})),Object.keys(c).forEach((e=>{c[e].forEach((t=>{var n;let i=r[e];if(Object.keys(BE({},l)).includes((null===(n=i)||void 0===n?void 0:n.getName())||"")){const e=Object.values(o.classes.byId).find((e=>"compound"===e.classType&&e.getSubselectors()===t.getSubselectors()));e&&this.projectClassManagementFlow.mergeAndOverwriteClassContent({classId:e.id,newStyles:t.content,conditions:t.conditions,doc:o})}else{if(!i){const t=this.projectClassManagementFlow.getOrCreateClassCategory({categoryName:"External"});if(!t)throw new Error("Could not create or get External CSS class category");const n=new np.J({pos:"",content:{},name:e,categoryId:t});this.projectClassManagementFlow.addSimpleClass({classToAdd:n,doc:o}),i=n,r[e]=n}t.rootClassId=i.id,this.projectClassManagementFlow.addCompoundClass({classToAdd:t,doc:o})}}))}))):this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not import HTML with that selected node.")}addNodeHierarchyBFS(e){const{hierarchy:t,roots:o,doc:n,allowDefaultPropsCreation:i,targetNodeId:r}=e;if(!n||!o.length)return;const s=o.sort(((e,t)=>{const o=parseFloat(e.pos),n=parseFloat(t.pos);return(0,rp.F0)(o)-(0,rp.F0)(n)})),a=[];for(const c of s){const e=[c.id];for(;e.length;){const o=t[e.shift()||""];o&&(e.push(...this.positioningService.orderEntities({entitiyCollection:t,entitiesOfInterest:Object.keys((null===o||void 0===o?void 0:o.childrenIds)||{})})),a.push(o))}}this.nodeManagementFlow.addNodesToParentOrStage({nodes:a,keepOriginalParent:!0,parentId:r,useContentAsNode:!0,allowDefaultPropsCreation:i,doc:n})}mergeClassesOnCollision(e){const{doc:t,cls:o,nodeHierarchy:n,classesToMerge:i,classesToDuplicate:r}=e;if(!t||null===i||void 0===i||!i[o.getName()]||null!==r&&void 0!==r&&r[o.getName()])return!1;const s=Object.values(t.classes.byId).find((e=>e.getName(t.classes.byId)===o.getName()));if(!s||"simple"!==s.classType)return!1;s.content=BE(BE({},s.content),o.content);const a=Object.values(s.conditions);return Object.values(o.conditions).forEach((e=>{const t=a.find((t=>t.type===e.type&&JSON.stringify(t.meta)===JSON.stringify(e.meta)));t?t.content=BE(BE({},e.content),t.content):s.conditions[e.id]=e})),Object.keys(o.usedInNodes).forEach((e=>{const t=n[e];if(!t)return;delete t.referencedStyles[o.id];const i={id:s.id,type:"style-map",content:{mapType:"project-referenced",referenceId:s.id}};t.referencedStyles[i.id]=i,s.usedInNodes[e]=!0})),!0}convertHtmlTreeToDomain(e,t={}){const{nodes:o,roots:n}=e,i={},r={};let s={},a={},c={};const l={},d={};return n.forEach((e=>{const n=[e];for(;n.length;){var p;const e=n.shift(),u=o[e],h=null===(p=u.attributes)||void 0===p?void 0:p.class;if(h){h.split(" ").forEach((e=>{const o=t[e],n=Object.keys(o||{}).reduce(((e,t)=>(e[t]=new Yr.F({content:o[t]}),e)),{}),i=this.projectClassManagementFlow.getOrCreateClassCategory({categoryName:"External"})||"",r=new np.J({pos:"",content:n,name:e,categoryId:i}),s=this.projectDoc.classes.getSimpleClasses().find((t=>t.getName()===e));a=BE(BE({},a),{[e]:s||r}),s&&(d[s.getName()]=!0)}))}if("style"===u.tag&&1===Object.values(u.children).length){const e=Object.values(u.children)[0].content||"";this.cssToDomainFlow.convertCSSVariablesToDesignTokens(e);const t=this.cssToDomainFlow.convertCSSToNodeStyle(e);s=BE(BE({},s),t);const o=this.cssToDomainFlow.convertCSSToClass(e);a=BE(BE({},a),o.classes),c=BE(BE({},c),o.compoundClasses);const n=this.cssToDomainFlow.convertCSSKeyFrameAnimationsToCodeEmbed(e);n&&(i[n.id]=n);continue}if("script"===u.tag&&1===Object.values(u.children).length){const e=Object.values(u.children)[0].content||"",t=new dE.b({name:"External Script",primitiveType:Zn.sO.HTML_NODE,html:new Yr.F({content:`<script>\n              ${(0,Kp.H4)(e)}\n              <\/script>`})});i[t.id]=t;continue}n.push(...Object.keys(u.children));const{node:m,classNames:y,htmlId:g}=this.convertHtmlNodeToDomainNode(u);if(r[e]=y,g&&(l[e]=g),!m.primitiveType){const e=i[m.parentId||""];if(e&&1===Object.keys(e.childrenIds||{}).length&&Zn.BB.includes(e.primitiveType||"")){e.childrenIds={},e.contentChildren=Object.keys(m.contentChildren).reduce(((e,t)=>(e[t]=m.contentChildren[t].clone(),e)),{});continue}m.primitiveType=Zn.sO.TEXT,m.semanticType=Zn.RY.SPAN}if(m.primitiveType===Zn.sO.TEXT&&m.parentId){const e=i[m.parentId];this.convertTextNodeToSpan(m,e)}i[m.id]=m}})),Object.keys(r).forEach((e=>{var t;null===(t=r[e])||void 0===t||t.forEach((t=>{const o=i[e],n=i[o.parentId||""];if(Zn.BB.includes((null===n||void 0===n?void 0:n.primitiveType)||"")&&s[t])return o.styles=BE(BE({},s[t].styles),i[e].styles),void(o.referencedStyles=s[t].referencedStyles);const r=a[t];if(r){r.usedInNodes[e]=!0;const t={id:r.id,type:"style-map",content:{mapType:"project-referenced",referenceId:r.id}};o.referencedStyles[t.id]=t}}))})),{nodeHierarchy:i,classes:a,nodeIdToIdAttr:l,compoundClasses:c,classesUsedInHtmlAndAlreadyInTheProject:d}}convertTextNodeToSpan(e,t){if(t&&t.primitiveType===Zn.sO.TEXT&&e.semanticType!==Zn.RY.SPAN){const t=e.styles;[Zn.RY.BOLD,Zn.RY.STRONG].includes(e.semanticType)&&!t.fontWeight&&(e.styles.fontWeight=new Yr.F({content:"700"})),e.semanticType!==Zn.RY.ITALIC||t.fontStyle||(e.styles.fontStyle=new Yr.F({content:"italic"})),e.semanticType!==Zn.RY.STRIKE||t.textDecoration||(e.styles.textDecoration=new Yr.F({content:"line-through"})),e.semanticType!==Zn.RY.UNDERLINE||t.textDecoration||(e.styles.textDecoration=new Yr.F({content:"underline"})),e.semanticType=Zn.RY.SPAN}return e}convertHtmlNodeToDomainNode(e){const t=this.buildNodeBasedOnElementType(e.tag);if(!t)throw new Error(`Could not convert tag ${e.tag} to teleport`);let o,n=[];const i=Object.keys(e.attributes).reduce(((i,r)=>{if("class"===r)return n=e.attributes[r].split(" "),i;if("style"===r){if(!t)return i;const o=this.cssToDomainFlow.convertCSSToNodeStyle(`.${t.id} { ${e.attributes[r]} }`);return t.styles=o[t.id].styles,i}"id"===r&&(o=e.attributes[r]);const s=new Yr.F({content:e.attributes[r]});return i[r]=s,i}),{});if("a"===e.tag){if(e.attributes.href.startsWith("mailto:")){const o=e.attributes.href.replace("mailto:","");t.abilities={link:new by.G({type:$r.RZ.MAIL,content:{mail:o,subject:e.attributes.subject,body:e.attributes.body}})}}if(e.attributes.href.startsWith("tel:")){const o=e.attributes.href.replace("tel:","");t.abilities={link:new by.G({type:$r.RZ.PHONE,content:{phone:o}})}}e.attributes.href.startsWith("http")&&(t.abilities={link:new by.G({type:$r.RZ.URL,content:{url:e.attributes.href,newTab:"_blank"===e.attributes.target}})}),e.attributes.href.startsWith("#")&&(t.abilities={link:new by.G({type:$r.RZ.SECTION,content:{section:e.attributes.href.replace("#","")}})})}if(t.id=e.id,t.attrs=i,t.parentId=e.parentId||null,t.pos=e.pos,t.childrenIds=Object.keys(e.children).reduce(((e,t)=>(e[t]=!0,e)),{}),"a"===e.tag&&delete t.attrs.href,e.content){const o=new Yr.F({content:this.trimTextForRTE(e.content)});t.contentChildren[o.id]=o}return{node:t,classNames:n,htmlId:o}}buildNodeBasedOnElementType(e){if(!e)return new lu.HX;const t=(0,Kp.xu)(e);return Object.values(Zn.RY).includes(e)?new lu.HX({primitiveType:Zn.sO.TEXT,semanticType:e,uninitialised:!1}):Object.values(Zn.iX).includes(e)?new lu.HX({primitiveType:Zn.sO.CONTAINER,semanticType:e,uninitialised:!1}):Object.values(Zn.qo).includes(e)?new lu.HX({primitiveType:Zn.sO.ICON,semanticType:e,uninitialised:!1}):Object.values(Zn.gt).includes(e)?new lu.HX({primitiveType:Zn.sO.LIST,semanticType:e,uninitialised:!1}):Object.values(Zn.mw).includes(e)?new lu.HX({primitiveType:Zn.sO.LISTITEM,semanticType:e,uninitialised:!1}):Object.values(Zn.sO).includes(t)?new lu.HX({primitiveType:t,uninitialised:!1}):null}trimTextForRTE(e){let t=e;const o=t.trimEnd();o!==t&&(t=`${o} `);const n=t.trimStart();return t.trimStart()!==t&&(t=` ${n}`),t}addNodeIdsToComp(e){const{nodeIdToIdAttr:t,doc:o}=e,n=this.projectUIState.selection.componentId;n&&o&&Object.keys(t).forEach((e=>{this.componentManagementFlow.addIdToComponentSectionIds({doc:o,nodeId:e,compId:n,sectionId:t[e]})}))}async makePostRequestToAIV2WithProjectClasses(e){try{const t=new AbortController,o=t.signal;(0,a.mutate)(this.globalAppState,(e=>{e.fetchInProgress={showLoadingOverlay:!0,abortFetchController:t}}));const n=this.projectClassManagementFlow.getResolvedCSSClassStylesheet(),i=this.getDesignLanguageVariables(),r={cssVariablesWithClasses:`${i}\n\n${n}`,originalSnippet:e},s=await fetch("",{method:pE.x.POST,headers:{"Content-Type":"application/json"},body:JSON.stringify(r),signal:o}),c=await s.json();if(!c)throw new Error("No response from AI");const l=c.code.split("\n");return(0,Kp.n2)(l,"upd").join("\n")}catch(t){return t instanceof Error&&"AbortError"===t.name?this.notificationsManagementFlow.createNotification(d.k$.WARNING,"AI Designer service request was aborted"):this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not connect to AI service"),null}finally{(0,a.mutate)(this.globalAppState,(e=>{e.fetchInProgress=null}))}}getDesignLanguageVariables(){const e=this.projectDoc.designLanguage.getTokensAsCustomProperties();return`:root {${Object.keys(e).map((t=>{const{name:o,value:n}=e[t];return`${o}: ${n};`})).join("\n")}}`}},CE=(0,s.Z)(FE.prototype,"cssToDomainFlow",[mE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EE=(0,s.Z)(FE.prototype,"projectUIState",[yE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xE=(0,s.Z)(FE.prototype,"projectDoc",[gE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_E=(0,s.Z)(FE.prototype,"projectClassManagementFlow",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=(0,s.Z)(FE.prototype,"nodeManagementFlow",[bE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PE=(0,s.Z)(FE.prototype,"notificationsManagementFlow",[IE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AE=(0,s.Z)(FE.prototype,"modalManagementFlow",[vE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kE=(0,s.Z)(FE.prototype,"workersProvider",[wE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UE=(0,s.Z)(FE.prototype,"positioningService",[NE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RE=(0,s.Z)(FE.prototype,"componentManagementFlow",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZE=(0,s.Z)(FE.prototype,"nodeSelectionFlow",[SE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LE=(0,s.Z)(FE.prototype,"globalAppState",[DE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(FE.prototype,"submitHtml",[TE,m.P],Object.getOwnPropertyDescriptor(FE.prototype,"submitHtml"),FE.prototype),(0,s.Z)(FE.prototype,"addNodeHierarchyBFS",[m.P],Object.getOwnPropertyDescriptor(FE.prototype,"addNodeHierarchyBFS"),FE.prototype),(0,s.Z)(FE.prototype,"mergeClassesOnCollision",[m.P],Object.getOwnPropertyDescriptor(FE.prototype,"mergeClassesOnCollision"),FE.prototype),(0,s.Z)(FE.prototype,"addNodeIdsToComp",[m.P],Object.getOwnPropertyDescriptor(FE.prototype,"addNodeIdsToComp"),FE.prototype),OE=FE));var GE,HE,zE,YE,VE,WE,KE,qE,JE;function XE(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function QE(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?XE(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):XE(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}GE=(0,c.provide)("cssToDomainFlow"),HE=(0,c.inject)("projectDoc"),zE=(0,c.inject)("projectClassManagementFlow"),YE=(0,c.inject)("designLanguageManagementFlow"),GE((WE=class{constructor(){(0,i.Z)(this,"projectDoc",KE,this),(0,i.Z)(this,"projectClassManagementFlow",qE,this),(0,i.Z)(this,"designLanguageManagementFlow",JE,this)}convertCSSToNodeStyle(e){var t;const o=(0,rr.parse)(e,{}),n={};return null===(t=o.stylesheet)||void 0===t||t.rules.forEach((e=>{var t,o;if(this.isMediaRule(e)){var i,r,s;if(null===(i=e.media)||void 0===i||!i.includes("max-width"))throw new Error("Only max-width media queries supported.");const t=parseInt((null===(r=e.media.match(/\d+/))||void 0===r?void 0:r[0])||"");if(!t||!Object.values(this.projectDoc.mediaQueryBreakpoints.getNonDefaultActiveMQBreakpointsInOrder()).map((e=>e.maxWidth)).find((e=>e===t)))throw new Error(`Media Query ${t}px is not in the declared media queries. To avoid inconsistentcies, please add it or modify the snippet.`);return void(null===(s=e.rules)||void 0===s||s.forEach((e=>{var o;if(!this.isRule(e))return;this.validateRule(e,!0);const i=null===(o=e.selectors)||void 0===o?void 0:o[0].replace(".",""),r=this.parseRule(e),s={id:(0,ni.Ox)(),type:"style-map",content:{conditions:[{conditionType:"screen-size",maxWidth:t}],styles:r,mapType:"inlined"}};n[i]||(n[i]={styles:{},referencedStyles:{}}),n[i]={styles:n[i].styles,referencedStyles:QE(QE({},n[i].referencedStyles),{},{[s.id]:s})}})))}if(!this.isRule(e)||":root"===(null===(t=e.selectors)||void 0===t?void 0:t[0]))return;this.validateRule(e,!0);const a=null===(o=e.selectors)||void 0===o?void 0:o[0].replace(".","");n[a]||(n[a]={styles:{},referencedStyles:{}}),n[a]={styles:this.parseRule(e),referencedStyles:n[a].referencedStyles}})),n}convertCSSToClass(e){var t;const o=(0,rr.parse)(e,{}),n={},i={},r=this.projectClassManagementFlow.getOrCreateClassCategory({categoryName:"External"})||"",s=(e,t)=>{var o;this.validateRule(e);const s=null===(o=e.selectors)||void 0===o?void 0:o[0].replace(".","");if(":root"===s)return;const a=e.selectors,c=this.parseRule(e),l={id:(0,ni.Ox)(),type:"screen-size",content:c,meta:{maxWidth:null!==t&&void 0!==t?t:0}},d=(0,Kp.HT)(a[0]);if(null!==d&&void 0!==d&&d.remainingPart){const e=new ip.a({subselectors:d.remainingPart,pos:"0",categoryId:r,content:{}});t?e.conditions={[l.id]:l}:e.content=c;const o=d.mainSelector.replace(".","");i[o]?i[o].push(e):i[o]=[e]}else n[s]||(n[s]=n[s]=new np.J({name:s,pos:"0",content:{},categoryId:r})),t?n[s].conditions=QE(QE({},n[s].conditions),{},{[l.id]:l}):n[s].content=c};return null===(t=o.stylesheet)||void 0===t||t.rules.forEach((e=>{if(this.isMediaRule(e)){var t,o,n;if(null===(t=e.media)||void 0===t||!t.includes("max-width"))throw new Error("Only max-width media queries supported.");const i=parseInt((null===(o=e.media.match(/\d+/))||void 0===o?void 0:o[0])||"");if(!i||!Object.values(this.projectDoc.mediaQueryBreakpoints.getNonDefaultActiveMQBreakpointsInOrder()).map((e=>e.maxWidth)).find((e=>e===i)))throw new Error(`Media Query ${i}px is not in the declared media queries. To avoid inconsistentcies, please add it or modify the snippet.`);null===(n=e.rules)||void 0===n||n.forEach((e=>{this.isRule(e)&&s(e,i)}))}else this.isRule(e)&&s(e)})),{classes:n,compoundClasses:i}}convertCSSKeyFrameAnimationsToCodeEmbed(e){var t;const o=null===(t=(0,rr.parse)(e,{}).stylesheet)||void 0===t?void 0:t.rules.filter((e=>"keyframes"===e.type));if(!o||0===o.length)return null;const n=o.map((e=>{var t;return`@keyframes ${e.name} {${null===(t=e.keyframes)||void 0===t?void 0:t.map((e=>{var t;const o=null===(t=e.declarations)||void 0===t?void 0:t.map((e=>{var t;if(!this.isDeclaration(e))return"";let o=e.value;if(null!==(t=o)&&void 0!==t&&t.includes("var(")){const t=this.designLanguageManagementFlow.getOrCreateCategory({name:"Imported"}),n=this.projectDoc.designLanguage.getTokenByNameFromCategory(o.replace("var(--","").replace(")",""),t.id);return o=n?this.projectDoc.designLanguage.getTokenNameResolvedWithCategory(null===n||void 0===n?void 0:n.id):o.replace(/var\(--[a-zA-Z0-9-]+\)/g,(e=>{const o=e.replace("var(--","").replace(")",""),n=this.projectDoc.designLanguage.getTokenByNameFromCategory(o,t.id);return n?`var(${this.projectDoc.designLanguage.getTokenNameResolvedWithCategory(n.id)})`:e})),`${e.property}: ${o};`}return`${e.property}: ${e.value};`})).join("\n");return`${e.values} {${o}}`})).join("\n")}}`}));return new dE.b({primitiveType:Zn.sO.HTML_NODE,name:"Animations",html:new Yr.F({content:`<style>\n        ${n.join("")}\n        </style> `})})}convertCSSVariablesToDesignTokens(e){var t,o;const n=null===(t=(0,rr.parse)(e,{}).stylesheet)||void 0===t?void 0:t.rules.find((e=>{var t;return"rule"===e.type&&":root"===(null===(t=e.selectors)||void 0===t?void 0:t[0])}));if(!n)return;null===(o=n.declarations)||void 0===o||o.forEach((e=>{if(!this.isDeclaration(e))return;const{property:t,value:o}=e;if(!t||!o)return;const n=this.designLanguageManagementFlow.getOrCreateCategory({name:"Imported"});this.designLanguageManagementFlow.createToken(t.replace("--",""),o,n.id,fw.i.OTHERS)}))}parseRule(e){var t;const o={};return null===(t=e.declarations)||void 0===t||t.forEach((e=>{if(!this.isDeclaration(e))return;const{property:t,value:n}=e;if(t&&n){if(n.includes("var(")){if(n.startsWith(uE)&&2===n.split(uE).length){const e=n.replace(uE,"").replace(")",""),[i,r,...s]=e.split("-"),a=s.join("-");if(!["color","layout","typography","others"].includes(i))throw new Error(`Invalid section name: ${i}`);const c=this.projectDoc.designLanguage.getCategoriesBySection(i).find((e=>e.name.toLowerCase()===r.toLowerCase()));if(!c)throw new Error(`Could not find category: ${r} in section: ${i}`);const l=this.projectDoc.designLanguage.getTokenByNameFromCategory(a,c.id);if(!l)throw new Error(`Could not find token: ${a} in category: ${r}`);return o[(0,dr.hN)(t)]=new nr.P({content:{referenceType:"token",id:l.id}}),o}const e=this.designLanguageManagementFlow.getOrCreateCategory({name:"Imported"}),i=n.replace("var(--","").replace(")",""),r=this.projectDoc.designLanguage.getTokenByNameFromCategory(i,e.id);if(r)return o[(0,dr.hN)(t)]=new nr.P({content:{referenceType:"token",id:r.id}}),o;{const i=n.replace(/var\(--[a-zA-Z0-9-]+\)/g,(t=>{const o=t.replace("var(--","").replace(")",""),n=this.projectDoc.designLanguage.getTokenByNameFromCategory(o,e.id);return n?`var(${this.projectDoc.designLanguage.getTokenNameResolvedWithCategory(n.id)})`:t}));return o[(0,dr.hN)(t)]=new Yr.F({content:i}),o}}o[(0,dr.hN)(t)]=new Yr.F({content:n})}})),o}isRule(e){return"rule"===e.type}isMediaRule(e){return"media"===e.type}isDeclaration(e){return"declaration"===e.type}validateRule(e,t){if(!e.selectors)throw new Error("You need at least one selector for a class.");if(!e.selectors[0].startsWith(".")&&":root"!==e.selectors[0])throw new Error(`Only class selectors supported at the moment. "${e.selectors[0]}" is not a class.`)}},KE=(0,s.Z)(WE.prototype,"projectDoc",[HE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qE=(0,s.Z)(WE.prototype,"projectClassManagementFlow",[zE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JE=(0,s.Z)(WE.prototype,"designLanguageManagementFlow",[YE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VE=WE));var ex,tx,ox,nx,ix;ex=(0,c.provide)("userInteractionsFlow"),tx=(0,c.inject)("projectUIState"),ex((nx=class{constructor(){(0,i.Z)(this,"projectUIState",ix,this)}setSectionUnderReplace(e){this.projectUIState.userInteractions.sectionUnderReplace!==e&&(0,a.mutate)(this.projectUIState,(t=>{t.userInteractions.sectionUnderReplace=e,t.layout.sidebarPanel=p.tI.SECTIONS}))}},ix=(0,s.Z)(nx.prototype,"projectUIState",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=nx));var rx,sx,ax,cx,lx;o(18986),o(493335);rx=(0,c.provide)("userPreferencesFlow"),sx=(0,c.inject)("projectUIState"),rx((cx=class{constructor(){(0,i.Z)(this,"projectUIState",lx,this)}setValue(e,t){(0,a.mutate)(this.projectUIState,(({userPreferences:o})=>{o[e]=t}))}},lx=(0,s.Z)(cx.prototype,"projectUIState",[sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ax=cx));var dx,px,ux,hx,mx;dx=(0,c.provide)("sandboxingFlow"),px=(0,c.inject)("projectDoc"),dx((hx=class{constructor(){(0,i.Z)(this,"projectDoc",mx,this)}init(){return this.createSandboxProject()}createSandboxProject(){const e=new n.n({theme:this.projectDoc.selectedTheme});e.mediaQueryBreakpoints.fromJSON(this.projectDoc.mediaQueryBreakpoints.toJSON()),e.classes.fromJSON(this.projectDoc.classes.toJSON()),e.designLanguage.fromJSON(this.projectDoc.designLanguage.toJSON());const t=new f.m({title:"Home",pos:`${Number.MAX_SAFE_INTEGER}`});return t.isHomePage=!0,e.addPage({page:t}),e.fonts.fromJSON(this.projectDoc.fonts.toJSON()),e}},mx=(0,s.Z)(hx.prototype,"projectDoc",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ux=hx));var yx=o(503266);const gx=e=>{const{refs:t,referencesOwner:o,onSubmit:n}=e,{0:i,1:r}=(0,w.useState)(""),{0:s,1:a}=(0,w.useState)("All"),c=Object.values(e.refs).reduce(((e,t)=>(e.includes(t.tag)||e.push(t.tag),e)),[]),l=(0,w.useCallback)((()=>Object.values(t).filter((e=>e.name.toLocaleLowerCase().includes(i.toLocaleLowerCase())&&(e.tag===s||"All"===s))).map((e=>(0,F.jsxs)("div",{tabIndex:0,className:v().dynamic([["2209065032",[N.N_.TWO_UNITS,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.N_.ONE_AND_HALF,N.N_.UNIT,N.um.HEADING,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.UNIT,N.DM.ACCENT_500,N.n_.DISCRETE,N.N_.UNIT,N.DM.GRAY_1000,N.DM.ACCENT_300,N.DM.PURPLE_600,N.DM.GRAY_1000,N.DM.PURPLE_400]]])+" owner-wrapper",children:[(0,F.jsxs)("span",{className:v().dynamic([["2209065032",[N.N_.TWO_UNITS,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.N_.ONE_AND_HALF,N.N_.UNIT,N.um.HEADING,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.UNIT,N.DM.ACCENT_500,N.n_.DISCRETE,N.N_.UNIT,N.DM.GRAY_1000,N.DM.ACCENT_300,N.DM.PURPLE_600,N.DM.GRAY_1000,N.DM.PURPLE_400]]])+" owner-details",children:[e.icon&&(0,F.jsx)(S.J,{type:e.icon,size:16}),e.name]}),(0,F.jsx)("div",{className:v().dynamic([["2209065032",[N.N_.TWO_UNITS,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.N_.ONE_AND_HALF,N.N_.UNIT,N.um.HEADING,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.UNIT,N.DM.ACCENT_500,N.n_.DISCRETE,N.N_.UNIT,N.DM.GRAY_1000,N.DM.ACCENT_300,N.DM.PURPLE_600,N.DM.GRAY_1000,N.DM.PURPLE_400]]])+" bound-nodes",children:e.nodeRefs.map((e=>(0,F.jsxs)("div",{onClick:()=>n(e.id),className:v().dynamic([["2209065032",[N.N_.TWO_UNITS,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.N_.ONE_AND_HALF,N.N_.UNIT,N.um.HEADING,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.UNIT,N.DM.ACCENT_500,N.n_.DISCRETE,N.N_.UNIT,N.DM.GRAY_1000,N.DM.ACCENT_300,N.DM.PURPLE_600,N.DM.GRAY_1000,N.DM.PURPLE_400]]])+" bound-element",children:[(0,F.jsx)("div",{className:v().dynamic([["2209065032",[N.N_.TWO_UNITS,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.N_.ONE_AND_HALF,N.N_.UNIT,N.um.HEADING,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.UNIT,N.DM.ACCENT_500,N.n_.DISCRETE,N.N_.UNIT,N.DM.GRAY_1000,N.DM.ACCENT_300,N.DM.PURPLE_600,N.DM.GRAY_1000,N.DM.PURPLE_400]]])+" primitive-type",children:(0,F.jsx)(S.J,{type:yl.YN[e.primitiveType],size:14})}),e.name||Zn.AP[e.primitiveType]]},e.id)))}),(0,F.jsx)(v(),{id:"2209065032",dynamic:[N.N_.TWO_UNITS,N.N_.HALF_UNIT,N.N_.HALF_UNIT,N.N_.ONE_AND_HALF,N.N_.UNIT,N.um.HEADING,N.N_.UNIT,N.N_.HALF_UNIT,N.N_.UNIT,N.DM.ACCENT_500,N.n_.DISCRETE,N.N_.UNIT,N.DM.GRAY_1000,N.DM.ACCENT_300,N.DM.PURPLE_600,N.DM.GRAY_1000,N.DM.PURPLE_400],children:[`.owner-wrapper.__jsx-style-dynamic-selector{width:100%;margin:${N.N_.TWO_UNITS} ${N.N_.HALF_UNIT};padding:${N.N_.HALF_UNIT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}`,`.owner-details.__jsx-style-dynamic-selector{margin-bottom:${N.N_.ONE_AND_HALF};gap:${N.N_.UNIT};font-size:${N.um.HEADING};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}`,`.bound-nodes.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:${N.N_.UNIT};max-width:400px;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}`,`.bound-element.__jsx-style-dynamic-selector{padding:${N.N_.HALF_UNIT} ${N.N_.UNIT};background-color:${N.DM.ACCENT_500};border-radius:${N.n_.DISCRETE};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;gap:${N.N_.UNIT};color:${N.DM.GRAY_1000};}`,".primitive-type.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:100%;width:100%;pointer-events:none;}",`.bound-element.__jsx-style-dynamic-selector:hover{background-color:${N.DM.ACCENT_300};}`,`.bound-element.event.__jsx-style-dynamic-selector{background-color:${N.DM.PURPLE_600};color:${N.DM.GRAY_1000};}`,`.bound-element.event.__jsx-style-dynamic-selector:hover{background-color:${N.DM.PURPLE_400};}`]})]},e.id)))),[i,s]);return(0,F.jsxs)("div",{className:"wrapper",children:[(0,F.jsx)("p",{style:{margin:N.N_.UNIT},children:`Node References for ${o.type} "${o.name}"`}),(0,F.jsx)(yx.R,{value:i,onChange:e=>r(e.target.value)}),(0,F.jsxs)("div",{style:{marginLeft:N.N_.TWO_UNITS},children:["Filter: ",(0,F.jsx)(V.P,{options:["All",...c],value:s,onChange:a})]}),(0,F.jsx)("div",{style:{maxHeight:"600px",overflowY:"auto",overflowX:"hidden"},children:l()}),(0,F.jsx)("div",{className:"modal-btns",children:(0,F.jsx)(j.z,{onClick:()=>n(),style:"solid",colorScheme:"neutral",children:"Close"})}),(0,F.jsx)("style",{children:tp.W2})]})};var fx,bx,Ix,vx,wx,Nx,jx,Sx,Dx,Tx,Ox,Fx,Cx,Ex,xx,_x,Mx;function Px(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Ax(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Px(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Px(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}fx=(0,c.provide)("nodeReferencesFlow"),bx=(0,c.inject)("projectDoc"),Ix=(0,c.inject)("projectUIState"),vx=(0,c.inject)("navbarFlow"),wx=(0,c.inject)("nodeSelectionFlow"),Nx=(0,c.inject)("modalManagementFlow"),jx=(0,c.inject)("stageScrollFlow"),Sx=(0,c.inject)("projectClassManagementFlow"),fx((Tx=class{constructor(){(0,i.Z)(this,"projectDoc",Ox,this),(0,i.Z)(this,"projectUIState",Fx,this),(0,i.Z)(this,"navbarFlow",Cx,this),(0,i.Z)(this,"nodeSelectionFlow",Ex,this),(0,i.Z)(this,"modalManagementFlow",xx,this),(0,i.Z)(this,"stageScrollFlow",_x,this),(0,i.Z)(this,"projectClassManagementFlow",Mx,this),(0,r.Z)(this,"goToNodeReference",(e=>{const t=this.projectDoc.getComponentIdForNode(e);t&&t!==this.projectUIState.selection.componentId&&this.navbarFlow.selectOrCreateTabByEntityId(t),setTimeout((()=>{this.nodeSelectionFlow.setNodeSelection({nodeId:e}),this.stageScrollFlow.bringNodeIntoView({nodeId:e})}),ol.x1.SIXTY)}))}classHasNodeReferences(e){const t=this.projectDoc.classes.byId[e];return"usedInNodes"in t&&!!Object.values(t.usedInNodes).length}showReferencesForClass(e){const t=this.projectDoc.classes.byId[e];"usedInNodes"in t&&this.showNodeReferences({usedInNodes:t.usedInNodes,owner:{name:t.getName(),type:"class"}})}highlightReferencesForClass(e){const t=this.projectDoc.classes.byId[e];"usedInNodes"in t&&this.highlightNodeReferences(t.usedInNodes)}assetHasNodeReferences(e){const t=this.projectDoc.assets.byId[e];return!!Object.keys(t.usedInNodes).length||!!Object.keys(t.usedInClasses||{}).length}showNodeReferencesForAsset(e){const t=this.projectDoc.assets.byId[e];this.showNodeReferences({usedInNodes:t.usedInNodes,owner:{name:t.name,type:"asset"},usedInClasses:t.usedInClasses})}highlightNodeReferencesForAsset(e){const t=this.projectDoc.assets.byId[e];this.highlightNodeReferences(t.usedInNodes)}componentHasInstances(e){const t=this.projectDoc.components.byId[e];return!!t&&!!Object.keys(t.instantiatedByNodes).length}showComponentInstances(e){const t=this.projectDoc.components.byId[e];t&&this.showNodeReferences({usedInNodes:t.instantiatedByNodes,owner:{name:t.title,type:"component"}})}tokenHasReferences(e){const t=this.projectDoc.designLanguage.tokensById[e];if(!t)return;const o=this.projectClassManagementFlow.findTokenReferencesInClasses(e);return!!Object.keys(t.usedInNodes).length||!!Object.keys(o).length}showTokenReferences(e){const t=this.projectDoc.designLanguage.tokensById[e];if(!t)return;const o=this.projectClassManagementFlow.findTokenReferencesInClasses(e);this.showNodeReferences({usedInNodes:t.usedInNodes,usedInClasses:o,owner:{name:t.name,type:"token"}})}highlightTokenReferences(e){const t=this.projectDoc.designLanguage.tokensById[e];t&&this.highlightNodeReferences(t.usedInNodes)}stopReferenceHighlighting(){this.nodeSelectionFlow.setComponentLinkedNodeIds({nodeIds:[]})}showNodeReferences(e){const{usedInNodes:t,usedInClasses:o,owner:n}=e,i=this.buildRefsForModalFromUsedInNodes(t,o),r=b.d.createCustomModal({Component:gx,data:{refs:i,referencesOwner:n},onSubmit:e=>{this.modalManagementFlow.hideModal(),e&&this.goToNodeReference(e)}});this.modalManagementFlow.showModal(r)}highlightNodeReferences(e){this.nodeSelectionFlow.setComponentLinkedNodeIds({nodeIds:[...Object.keys(e||{})]})}buildRefsForModalFromUsedInNodes(e,t){const o={};return Object.keys(e).forEach((t=>{const n=this.projectDoc.getComponentIdForNode(t),i=this.projectDoc.nodes.getById(t);if(!n||!i)return;const r=Ax(Ax({},i),{},{numberOfRefs:"boolean"===typeof e[t]?1:e[t]}),s=this.projectDoc.getNameOfComponentOrPageById(n)||"",a=!!this.projectDoc.components.byId[n];o[n]?o[n].nodeRefs.push(r):o[n]={id:n,name:s,nodeRefs:[r],tag:a?"Component":"Page",icon:a?"component":"page"}})),Object.keys(t||{}).forEach((t=>{const n=this.projectDoc.classes.byId[t];if("simple"!==n.classType)return void(o[t]={nodeRefs:[],id:t,tag:"Class",name:n.getName(this.projectDoc.classes.byId),icon:"classes"});const i=n.getName();Object.keys(n.usedInNodes||{}).forEach((n=>{const r=this.projectDoc.nodes.getById(n);if(!r)return;const s=Ax(Ax({},r),{},{numberOfRefs:"boolean"===typeof e[n]?1:e[n]});o[t]?o[t].nodeRefs.push(s):o[t]={id:t,name:i,tag:"Class",nodeRefs:[s],icon:"classes"}})),o[t]||(o[t]={id:t,name:i,tag:"Class",nodeRefs:[],icon:"classes"})})),o}},Ox=(0,s.Z)(Tx.prototype,"projectDoc",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fx=(0,s.Z)(Tx.prototype,"projectUIState",[Ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cx=(0,s.Z)(Tx.prototype,"navbarFlow",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=(0,s.Z)(Tx.prototype,"nodeSelectionFlow",[wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xx=(0,s.Z)(Tx.prototype,"modalManagementFlow",[Nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_x=(0,s.Z)(Tx.prototype,"stageScrollFlow",[jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mx=(0,s.Z)(Tx.prototype,"projectClassManagementFlow",[Sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dx=Tx));o(322831);var kx,Ux,Rx,Zx,Lx,$x,Bx,Gx,Hx,zx,Yx,Vx,Wx,Kx,qx,Jx,Xx,Qx,e_,t_,o_,n_,i_,r_,s_,a_,c_,l_,d_,p_=o(882465);function u_(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function h_(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u_(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u_(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const m_="thq-sections-preview-root";kx=(0,c.provide)("predefinedSectionsManagementFlow"),Ux=(0,c.inject)("projectUIState"),Rx=(0,c.inject)("projectDoc"),Zx=(0,c.inject)("nodeSelectionFlow"),Lx=(0,c.inject)("componentManagementFlow"),$x=(0,c.inject)("aiContentGenerationFlow"),Bx=(0,c.inject)("sharedbProjectSyncService"),Gx=(0,c.inject)("guardsService"),Hx=(0,c.inject)("projectClassManagementFlow"),zx=(0,c.inject)("uidlToComponentMapper"),Yx=(0,c.inject)("nodeManagementFlow"),Vx=(0,c.inject)("nodeStyleManagmentFlow"),Wx=(0,c.inject)("stageScrollFlow"),Kx=(0,c.inject)("uidlToProjectMapper"),kx((Jx=class{constructor(){(0,i.Z)(this,"projectUIState",Xx,this),(0,i.Z)(this,"projectDoc",Qx,this),(0,i.Z)(this,"nodeSelectionFlow",e_,this),(0,i.Z)(this,"componentManagementFlow",t_,this),(0,i.Z)(this,"aiContentGenerationFlow",o_,this),(0,i.Z)(this,"dbSync",n_,this),(0,i.Z)(this,"guardsService",i_,this),(0,i.Z)(this,"projectClassManagementFlow",r_,this),(0,i.Z)(this,"uidlToComponentMapper",s_,this),(0,i.Z)(this,"nodeManagementFlow",a_,this),(0,i.Z)(this,"nodeStyleManagmentFlow",c_,this),(0,i.Z)(this,"stageScrollFlow",l_,this),(0,i.Z)(this,"uidlToProjectMapper",d_,this),(0,r.Z)(this,"sectionTemplates",{}),(0,r.Z)(this,"sectionsPreviewMetadata",nl.Instance),(0,r.Z)(this,"replaceSectionWithSection",(async(e,t)=>{const o=this.sectionsPreviewMetadata.previewSelectedNode?[this.sectionsPreviewMetadata.previewSelectedNode]:this.nodeSelectionFlow.getSelectedNodesIds();if(1!==o.length)return;await this.exitPreview(!0);const n=o[0],i=this.projectDoc.nodes.getById(n);if(!i||"component-instance-node"!==i.type)return;const{template:r,propDefaults:s}=this.getSectionTemplateWithCurrentComponentProps(e,i.compIdOfCompInstance);if(!r)return;const a=h_({},s);if(!t)return void(await this.replaceSection(r,h_({},a),n,t));const c={};Object.keys(r.promptExample).forEach((e=>{a[e]||(c[e]=!0)}));const l=await this.aiContentGenerationFlow.generateContentForSection(e.replace(/[0-9]/g,""),c);await this.replaceSection(r,h_(h_({},l),a),n,t)})),(0,r.Z)(this,"addSection",(async e=>{const{sectionName:t,withAI:o=!1,useAIPrompt:n=!1,selectAfterAdd:i=!0}=e,r=this.getSectionTemplateByName(t);if(!r)return;await this.exitPreview(!0);const{parent:s,position:a}=this.computeNewSectionPosition();if(!o){const t=this.getMappedComponentFromSectionTemplate(r,{});if(!t)return;return void this.addSectionToNode({component:t,parent:s,selectAfterAdd:i,position:e.position||a,sectionType:r.type})}const c=r.promptExample,l=Object.keys(c).reduce(((e,t)=>h_(h_({},e),{},{[t]:!0})),{}),d=await this.aiContentGenerationFlow.generateContentForSection(t.replace(/[0-9]/g,""),l,n),p=this.getMappedComponentFromSectionTemplate(r,d);p&&this.addSectionToNode({component:p,parent:s,withAI:o,selectAfterAdd:i,position:e.position||a,sectionType:r.type})})),(0,r.Z)(this,"enterAddSectionPreview",(e=>{const t=this.projectUIState.selection.componentId;if(!t)return;const o=this.projectDoc.getProjectPageOrComponent(t);if(!o||!o.rootNodeId)return;const n=this.nodeSelectionFlow.getSelectedNodesIds();let i=1===n.length&&n[0]===o.rootNodeId;if(n.length||(i=!0,n.push(o.rootNodeId)),1!==n.length)return;const r=this.projectDoc.nodes.getById(n[0]);if(!r)return null;const s=this.getComponentFromSectionTemplate(e);if(!s)return null;const c=i?null:this.projectDoc.nodes.getNextSibling(r);this.addDefaultSectionClassesIfNotPresent(),(0,a.mutate)(this.projectDoc,(t=>{var o;const n=this.addRootNodeOfPreviewSectionToDocument(t,null!==c&&void 0!==c?c:void 0,i?r.id:null!==(o=r.parentId)&&void 0!==o?o:void 0);if(this.sectionsPreviewMetadata.existingSectionsUnderPreview[e]){const o=Object.keys(n.childrenIds);return o.length&&this.nodeStyleManagmentFlow.setStyleByKey({nodeIds:o,key:"display",value:"none",doc:t}),void this.nodeStyleManagmentFlow.removeStyleByKey({nodeIds:[this.sectionsPreviewMetadata.existingSectionsUnderPreview[e]],key:"display",doc:t})}const a=Object.keys(n.childrenIds);a.length&&this.nodeStyleManagmentFlow.setStyleByKey({nodeIds:a,key:"display",value:"none",doc:t});const l=this.addPreviewComponentToDocument(s,t);this.sectionsPreviewMetadata.addedPreviewComponents.push(l);const d=this.componentManagementFlow.addComponentToNode({compId:l,targetId:n.id,selectAfterAdd:!1,translateStaticContent:!1});d&&(this.sectionsPreviewMetadata.existingSectionsUnderPreview[e]=d),setTimeout((()=>{d&&this.stageScrollFlow.bringNodeIntoView({nodeId:d})}))}))})),(0,r.Z)(this,"enterReplaceSectionPreview",(e=>{const t=this.nodeSelectionFlow.getSelectedNodesIds();if(1!==t.length)return;const o=this.projectDoc.nodes.getById(t[0]);if(!o)return null;this.sectionsPreviewMetadata.previewSelectedNode||(this.sectionsPreviewMetadata.previewSelectedNode=t[0]);const n=this.getComponentFromSectionTemplate(e);if(!n)return null;(0,a.mutate)(this.projectDoc,(t=>{this.sectionsPreviewMetadata.previewSelectedNode===o.id&&this.nodeStyleManagmentFlow.setStyleByKey({nodeIds:[o.id],key:"display",value:"none",doc:t});const i=this.addRootNodeOfPreviewSectionToDocument(t,o);if(this.sectionsPreviewMetadata.existingSectionsUnderPreview[e]){const o=Object.keys(i.childrenIds);return o.length&&this.nodeStyleManagmentFlow.setStyleByKey({nodeIds:o,key:"display",value:"none",doc:t}),void this.nodeStyleManagmentFlow.removeStyleByKey({nodeIds:[this.sectionsPreviewMetadata.existingSectionsUnderPreview[e]],key:"display",doc:t})}const r=this.addPreviewComponentToDocument(n,t);this.sectionsPreviewMetadata.addedPreviewComponents.push(r);const s=Object.keys(i.childrenIds);s.length&&this.nodeStyleManagmentFlow.setStyleByKey({nodeIds:s,key:"display",value:"none",doc:t});const a=this.componentManagementFlow.addComponentToNode({compId:r,targetId:i.id,selectAfterAdd:!1});a&&(this.sectionsPreviewMetadata.existingSectionsUnderPreview[e]=a),setTimeout((()=>{this.nodeSelectionFlow.setNodeSelection({nodeId:i.id,expandTreeView:!1}),a&&this.stageScrollFlow.bringNodeIntoView({nodeId:a})}))}))})),(0,r.Z)(this,"exitPreview",(async(e=!1)=>!!this.projectDoc.nodes.getById(m_)&&new Promise((t=>{(0,a.mutate)(this.projectDoc,(o=>{if(!o.nodes.getById(m_))return t(!1);o.deleteNodesById({nodeIds:[m_]}),this.sectionsPreviewMetadata.addedPreviewComponents.forEach((e=>{o.components.byId[e]&&o.removeComponent(e)})),!e&&this.sectionsPreviewMetadata.previewSelectedNode&&this.nodeStyleManagmentFlow.removeStyleByKey({nodeIds:[this.sectionsPreviewMetadata.previewSelectedNode],key:"display",doc:o})}));const o=this.sectionsPreviewMetadata.previewSelectedNode?`${this.sectionsPreviewMetadata.previewSelectedNode}`:null;this.sectionsPreviewMetadata.resetData(),this.sectionTemplates={},e?t(!0):setTimeout((()=>{o&&this.nodeSelectionFlow.setNodeSelection({nodeId:o,expandTreeView:!1}),t(!0)}),10)}))))}addPreviewSection(e){const{sectionName:t,parentNodeId:o,doc:n}=e,i=this.getSectionTemplateByName(t);if(!i)return;const r=o,s=this.getMappedComponentFromSectionTemplate(i,{});s&&this.addPreviewSectionToNode({component:s,parent:r,nextSibling:null,sectionType:i.type,doc:n})}async replaceSection(e,t,o,n=!1){const i=await this.getMappedComponentFromSectionTemplate(e,t);i&&this.dbSync.mutate(this.projectDoc,(t=>{const r=this.componentManagementFlow.addComponentMetaFromData({data:i,doc:t,customSectionType:e.type,contentGeneratedByAI:n});if(!r.length)return;const s=this.componentManagementFlow.replaceSelectedNodeWithComponentInstance({doc:t,compId:r[0],nodeIdToReplace:o});setTimeout((()=>{this.nodeSelectionFlow.setNodeSelection({nodeId:s,expandTreeView:!1}),s&&this.stageScrollFlow.bringNodeIntoView({nodeId:s})}))}))}addPreviewComponentToDocument(e,t){const o=e.components[0].title,n=o.startsWith("thq-")?o:`thq-${e.components[0].title}-preview-only`,i=Object.values(t.components.byId).find((e=>(null===e||void 0===e?void 0:e.title)===n));if(null!==i&&void 0!==i&&i.id)return i.id;e.components[0].title=n;return this.componentManagementFlow.addComponentMetaFromData({data:e,doc:t,forPreviewOnly:!0,translateStaticContent:!1})[0]}addRootNodeOfPreviewSectionToDocument(e,t,o){var n;const i=e.nodes.getById(m_);if(i)return i;const r=new Yr.F({content:"auto"}),s=new Yr.F({content:"100%"}),a=new lu.sd({id:m_,name:"Preview Root",styles:{height:r,width:s}});return this.nodeManagementFlow.addNodesToParentOrStage({parentId:null!==(n=null!==o&&void 0!==o?o:null===t||void 0===t?void 0:t.parentId)&&void 0!==n?n:"",nodes:[a],nextSibling:t,translateStaticContent:!1,doc:e}),e.nodes.getById(m_)}addSectionToNode(e){const{doc:t,component:o,parent:n,position:i,nextSibling:r,sectionType:s,selectAfterAdd:a,withAI:c=!1,translateStaticContent:l=!0}=e;if(!t)return;const d=this.componentManagementFlow.addComponentMetaFromData({doc:t,data:o,customSectionType:s,contentGeneratedByAI:c,translateStaticContent:l});d.length&&(this.componentManagementFlow.addComponentToNode({doc:t,compId:d[0],position:i,targetId:n,nextSibling:r,selectAfterAdd:a,translateStaticContent:l}),Object.keys(o.classesInNodes).forEach((e=>{o.classesInNodes[e].forEach((o=>{const n=t.classes.byId[e];"simple"===n.classType&&(n.usedInNodes[o]=!0)}))})))}addPreviewSectionToNode(e){const{doc:t,component:o,parent:n,nextSibling:i,sectionType:r,withAI:s=!1}=e;if(!t)return;const a=this.componentManagementFlow.addComponentMetaFromData({doc:t,data:o,customSectionType:r,contentGeneratedByAI:s,forPreviewOnly:!0,translateStaticContent:!1});a.length&&this.componentManagementFlow.addComponentToNode({doc:t,compId:a[0],targetId:n,nextSibling:i,translateStaticContent:!1,selectAfterAdd:!1})}getComponentFromSectionTemplate(e){if(this.sectionTemplates[e])return this.sectionTemplates[e];const t=this.sectionsPreviewMetadata.previewSelectedNode?this.projectDoc.nodes.getById(this.sectionsPreviewMetadata.previewSelectedNode):null,{template:o,propDefaults:n}=this.getSectionTemplateWithCurrentComponentProps(e,null===t||void 0===t?void 0:t.compIdOfCompInstance);if(!o)return null;const i=this.getMappedComponentFromSectionTemplate(o,n);return i?(this.sectionTemplates[e]=i,i):null}getMappedComponentFromSectionTemplate(e,t){const o=e.getLayout(t);return this.uidlToComponentMapper.mapUIDLsToComponents({uidls:[{uidl:o,meta:{validateUIDL:!1}}],domainTranslations:null})}getSectionTemplateWithCurrentComponentProps(e,t){const o=this.getSectionTemplateByName(e);if(!t||!o)return{template:o,propDefaults:{}};const n=this.projectDoc.components.byId[t];if(!n||!n.customSectionType)return{template:o,propDefaults:{}};const i=h_(h_({},o.promptExample),o.DEFAULT_CONTENT),r={};return Object.keys(n.propDefinitions).forEach((e=>{const t=n.propDefinitions[e];i[t.name]&&(r[t.name]=t.defaultHierarchyRootId&&i[t.name]&&"string"!==typeof i[t.name]?i[t.name]:t.defaultValue.toString())})),{template:o,propDefaults:r}}addDefaultSectionClassesToDocIfNotPresent(e){var t;const{doc:o}=e;if(!o)return;const n=o.selectedTheme||{name:sp.fY,variant:sp.M2};if(!n)return;const{tokens:i,classes:r}=(0,aj.Os)(n.name,n.variant),s=(null===(t=Object.values(o.classes.categoriesById).find((e=>e.isDefault)))||void 0===t?void 0:t.id)||"";Object.keys(i).forEach((e=>{var t,n;const{type:r=fw.i.COLOR,categoryName:s="theme",name:a}=(0,Xc.kg)(e);let c=Object.values(o.designLanguage.categoriesById).find((e=>e.name.toLowerCase()===s.toLowerCase()));c||(c=o.designLanguage.createCategory(s,"theme"===s?"color":i[e]?"layout":"color",!0));if(Object.values(o.designLanguage.tokensById).find((e=>{var t;return e.name===a&&e.categoryId===(null===(t=c)||void 0===t?void 0:t.id)})))return;const l={name:a,type:r,categoryId:c.id,value:"string"===typeof i[e]?i[e]:null!==(t=null===(n=i[e].content)||void 0===n?void 0:n.toString())&&void 0!==t?t:""};o.designLanguage.createToken(l)}));const a={};Object.keys(r).forEach((e=>{if(Object.values(o.classes.byId).some((t=>(null===t||void 0===t?void 0:t.getName(o.classes.byId))===e)))return;const t=r[e];if(t.subselectors)return void(a[e]=t);const n=this.uidlToProjectMapper.addDynamicNodesToClass(o.designLanguage,t),i=(new np.J).fromJSON({id:(0,ni.Ox)(),name:e,conditions:n.conditions||[],content:n.content,categoryId:s,usedInNodes:{}});this.projectClassManagementFlow.addSimpleClass({classToAdd:i,doc:o})})),Object.keys(a).forEach((e=>{const t=r[e],n=this.uidlToProjectMapper.addDynamicNodesToClass(o.designLanguage,t),i=t.className,a=t.subselectors,c=Object.values(o.classes.byId).find((e=>"simple"===e.classType&&e.getName()===i));if(!c)return;const l=(new ip.a).fromJSON({id:(0,ni.Ox)(),usedInNodes:{},conditions:n.conditions?n.conditions:[],content:n.content,subselectors:a,className:i,rootClassId:c.id,isDefault:!0,categoryId:s});this.projectClassManagementFlow.addCompoundClass({classToAdd:l,doc:o})}))}addDefaultSectionClassesIfNotPresent(){var e;const t=this.projectDoc.selectedTheme||{name:sp.fY,variant:sp.M2};if(!t)return;const{tokens:o,classes:n}=(0,aj.Os)(t.name,t.variant),i=(null===(e=Object.values(this.projectDoc.classes.categoriesById).find((e=>e.isDefault)))||void 0===e?void 0:e.id)||"";this.guardsService.executeFunctionGuarded(QI._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{Object.keys(o).forEach((t=>{var n,i;const{type:r=fw.i.COLOR,categoryName:s="theme",name:a}=(0,Xc.kg)(t);let c=Object.values(e.designLanguage.categoriesById).find((e=>e.name.toLowerCase()===s.toLowerCase()));c||(c=e.designLanguage.createCategory(s,"theme"===s?"color":o[t]?"layout":"color",!0));if(Object.values(e.designLanguage.tokensById).find((e=>{var t;return e.name===a&&e.categoryId===(null===(t=c)||void 0===t?void 0:t.id)})))return;const l={name:a,type:r,categoryId:c.id,value:"string"===typeof o[t]?o[t]:null!==(n=null===(i=o[t].content)||void 0===i?void 0:i.toString())&&void 0!==n?n:""};e.designLanguage.createToken(l)}));const t={};Object.keys(n).forEach((o=>{if(Object.values(e.classes.byId).some((t=>(null===t||void 0===t?void 0:t.getName(e.classes.byId))===o)))return;const r=n[o];if(r.subselectors)return void(t[o]=r);const s=this.uidlToProjectMapper.addDynamicNodesToClass(e.designLanguage,r),a=(new np.J).fromJSON({id:(0,ni.Ox)(),name:o,conditions:s.conditions||[],content:s.content,usedInNodes:{},isDefault:!0,categoryId:i});this.projectClassManagementFlow.addSimpleClass({classToAdd:a,doc:e})})),Object.keys(t).forEach((t=>{const o=n[t],r=this.uidlToProjectMapper.addDynamicNodesToClass(e.designLanguage,o),s=o.className,a=o.subselectors,c=Object.values(e.classes.byId).find((e=>"simple"===e.classType&&e.getName()===s));if(!c)return;const l=(new ip.a).fromJSON({id:(0,ni.Ox)(),usedInNodes:{},conditions:r.conditions?r.conditions:[],content:r.content,subselectors:a,className:s,rootClassId:c.id,categoryId:i});this.projectClassManagementFlow.addCompoundClass({classToAdd:l,doc:e})}))}))}))}computeNewSectionPosition(){var e;const t=this.projectUIState.selection.componentId,o=null!==(e=this.projectDoc.pages.getHomePageId())&&void 0!==e?e:"";if(!t&&!o)throw new Error("Could not find a component to add section to");const n=this.projectDoc.getProjectPageOrComponent(null!==t&&void 0!==t?t:o),i=this.nodeSelectionFlow.getSelectedNodesIds(),r=this.projectDoc.nodes.getById(i[0]||(null===n||void 0===n?void 0:n.rootNodeId)||"");if(!r)throw new Error("Could not find a node to add section to");let s=r.id;if(null!==r&&void 0!==r&&r.parentId){const e=this.projectDoc.nodes.getNextSibling(r);s=r.parentId;return{parent:s,position:(0,rp.Dd)(r.pos,null!==e&&void 0!==e&&e.pos?null===e||void 0===e?void 0:e.pos:(parseFloat(r.pos)+Number.MAX_SAFE_INTEGER).toString())}}const a=this.projectDoc.nodes.getLastChild(r);return{parent:s,position:a?this.projectDoc.nodes.getPositionAfterNode(a):Number.MAX_SAFE_INTEGER.toString()}}getSectionTemplateByName(e){return p_.e.Instance.getAllSections()[e]}},Xx=(0,s.Z)(Jx.prototype,"projectUIState",[Ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qx=(0,s.Z)(Jx.prototype,"projectDoc",[Rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e_=(0,s.Z)(Jx.prototype,"nodeSelectionFlow",[Zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t_=(0,s.Z)(Jx.prototype,"componentManagementFlow",[Lx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o_=(0,s.Z)(Jx.prototype,"aiContentGenerationFlow",[$x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n_=(0,s.Z)(Jx.prototype,"dbSync",[Bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i_=(0,s.Z)(Jx.prototype,"guardsService",[Gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r_=(0,s.Z)(Jx.prototype,"projectClassManagementFlow",[Hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s_=(0,s.Z)(Jx.prototype,"uidlToComponentMapper",[zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a_=(0,s.Z)(Jx.prototype,"nodeManagementFlow",[Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c_=(0,s.Z)(Jx.prototype,"nodeStyleManagmentFlow",[Vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l_=(0,s.Z)(Jx.prototype,"stageScrollFlow",[Wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d_=(0,s.Z)(Jx.prototype,"uidlToProjectMapper",[Kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Jx.prototype,"addPreviewSection",[m.P],Object.getOwnPropertyDescriptor(Jx.prototype,"addPreviewSection"),Jx.prototype),(0,s.Z)(Jx.prototype,"addSectionToNode",[m.P],Object.getOwnPropertyDescriptor(Jx.prototype,"addSectionToNode"),Jx.prototype),(0,s.Z)(Jx.prototype,"addPreviewSectionToNode",[m.P],Object.getOwnPropertyDescriptor(Jx.prototype,"addPreviewSectionToNode"),Jx.prototype),(0,s.Z)(Jx.prototype,"addDefaultSectionClassesToDocIfNotPresent",[m.P],Object.getOwnPropertyDescriptor(Jx.prototype,"addDefaultSectionClassesToDocIfNotPresent"),Jx.prototype),qx=Jx));var y_,g_,f_,b_,I_,v_,w_,N_,j_,S_,D_,T_,O_,F_,C_,E_,x_,__,M_,P_,A_,k_,U_,R_=o(933162),Z_=o(500310);y_=(0,c.provide)("predefinedPagesManagementFlow"),g_=(0,c.inject)("projectDoc"),f_=(0,c.inject)("projectUIState"),b_=(0,c.inject)("layoutManagementFlow"),I_=(0,c.inject)("pageManagementFlow"),v_=(0,c.inject)("predefinedSectionsManagementFlow"),w_=(0,c.inject)("aiContentGenerationFlow"),N_=(0,c.inject)("sandboxingFlow"),j_=(0,c.inject)("aiRepository"),S_=(0,c.inject)("sessionStorageService"),D_=(0,c.inject)("nodeManagementFlow"),y_((O_=class{constructor(){(0,i.Z)(this,"projectDoc",F_,this),(0,i.Z)(this,"projectUIState",C_,this),(0,i.Z)(this,"layoutManagementFlow",E_,this),(0,i.Z)(this,"pageManagementFlow",x_,this),(0,i.Z)(this,"predefinedSectionsManagementFlow",__,this),(0,i.Z)(this,"aiContentGenerationFlow",M_,this),(0,i.Z)(this,"sandboxingFlow",P_,this),(0,i.Z)(this,"aiRepository",A_,this),(0,i.Z)(this,"sessionStorageService",k_,this),(0,i.Z)(this,"nodeManagementFlow",U_,this),(0,r.Z)(this,"populatePage",(async e=>{var t;const{pageType:o,version:n,withAI:i=!1,useAIPrompt:r=!1,parentFolderId:s}=e,c=null!==(t=e.targetPageId)&&void 0!==t?t:this.pageManagementFlow.createEmptyPage({enterNameEditMode:!1,pageName:o,parentFolderId:s});if(!c)return;const l=this.projectDoc.pages.byId[c];if(!l)return;const d=T.Ir[o].versions[n].getLayout();if(d){this.projectUIState.userInteractions.isNodeInPreviewMode&&this.layoutManagementFlow.stopElementPreviewMode(),(0,a.mutate)(this.projectUIState,(e=>{e.pageList.pageUnderCreate.creationStatus=p.Jj.IN_PROGRESS,e.pageList.pageUnderCreate.sectionsGenerationStatus=d.reduce(((e,t)=>(e[t.section]=p.Jj.NOT_STARTED,e)),{})}));try{if(r){const e=this.sessionStorageService.get(Z_.f.AI_DATA);null!==e&&void 0!==e&&e.prompt&&await this.aiRepository.preloadSummaryFromText(this.projectDoc.id,e.prompt)}this.predefinedSectionsManagementFlow.addDefaultSectionClassesIfNotPresent();const e=[...d],t=this.addNodeFromHomepage({targetNodeId:l.rootNodeId,nodeNames:["header","navbar"],position:(Number.MAX_SAFE_INTEGER/2).toString(),nodeTypesToSearchFor:[Zn.sO.COMPONENT,Zn.IV.NAVBAR,Zn.sO.CONTAINER]}),o=this.addNodeFromHomepage({targetNodeId:l.rootNodeId,nodeNames:["footer"],position:(Number.MAX_SAFE_INTEGER*(d.length+1)).toString(),nodeTypesToSearchFor:[Zn.sO.COMPONENT,Zn.sO.CONTAINER]});if(t){const t=e.find((e=>e.section===R_.N.Navbar));t&&(e.splice(e.indexOf(t),1),this.setGenerationStatusForSection(t.section,p.Jj.COPIED_FROM_HOME))}if(o){const t=e.find((e=>e.section===R_.N.Footer));t&&(e.splice(e.indexOf(t),1),this.setGenerationStatusForSection(t.section,p.Jj.COPIED_FROM_HOME))}const n=e.map(((e,t)=>this.addPageSection({section:e,withAI:i,position:(Number.MAX_SAFE_INTEGER*(t+1)).toString(),pageId:c,useAIPrompt:r})));await Promise.all(n),(0,a.mutate)(this.projectUIState,(e=>{e.pageList.pageUnderCreate.creationStatus=p.Jj.COMPLETED}))}catch(u){(0,a.mutate)(this.projectUIState,(e=>{e.pageList.pageUnderCreate.creationStatus=p.Jj.ERROR}))}}})),(0,r.Z)(this,"previewPage",(async e=>{var t;const{pageType:o,version:n}=e,i=T.Ir[o].versions[n].getLayout();if(!i)return;const r=this.sandboxingFlow.init();if(!r)return;const s=(null===r||void 0===r?void 0:r.pages.getHomePageId())||"",a=i.map((e=>`${e.section.toLowerCase()+e.id}`.replaceAll(" ","")));await this.aiContentGenerationFlow.addDefaultNodesForSectionsToPreviewPage({sections:a,pageId:s,doc:r}),this.predefinedSectionsManagementFlow.addDefaultSectionClassesToDocIfNotPresent({doc:r});const c=i.map((e=>this.addPreviewPageSection({section:e,pageId:s,doc:r})));await Promise.all(c);const l=await Ls({title:"Sandbox project",doc:r,projectType:x.cd.REACT,slug:"sandbox-project",secretKeys:[],exportUnusedClasses:!0,applyForegroundTokenToFill:this.projectUIState.userPreferences.applyForegroundColorAsIconFill});return null===l||void 0===l||(null===(t=l.uidl)||void 0===t||delete t.internationalization),l.uidl})),(0,r.Z)(this,"addNodeFromHomepage",(e=>{const{targetNodeId:t,nodeNames:o,position:n,nodeTypesToSearchFor:i}=e,r=this.projectDoc.pages.getHomePageId(),s=this.projectDoc.pages.byId[null!==r&&void 0!==r?r:""];if(!s)return!1;let a=null;return this.projectDoc.nodes.bfs(s.rootNodeId,(e=>{var t;if(!i.includes(e.primitiveType))return;let n=null===(t=e.name)||void 0===t?void 0:t.toLowerCase().replace(/[0-9]/g,"");if(!n&&"component"===e.primitiveType){const t=this.projectDoc.components.byId[e.compIdOfCompInstance];var r;if(t)n=null===(r=t.title)||void 0===r?void 0:r.toLowerCase().replace(/[0-9]/g,"")}return o.some((e=>n===e))&&(a=e),!!a||void 0})),!!a&&(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:[a],targetId:t,newNodePositions:[n]}),!0)})),(0,r.Z)(this,"setGenerationStatusForSection",((e,t)=>{(0,a.mutate)(this.projectUIState,(o=>{o.pageList.pageUnderCreate.sectionsGenerationStatus&&(o.pageList.pageUnderCreate.sectionsGenerationStatus[e]=t)}))}))}async addPreviewPageSection(e){const{section:t,pageId:o,doc:n}=e;if(!n)return;const i=n.pages.byId[o];if(!i)return;await p_.e.Instance.preloadSectionsByType(t.section);let r=n.nodes.getById(i.rootNodeId||"")||null;if(n.nodes.bfs(i.rootNodeId,(e=>{var o;(null===(o=e.name)||void 0===o?void 0:o.toLowerCase())===`${t.section.toLowerCase()}${t.id}`.replaceAll(" ","")&&(r=e)})),!r)return!1;this.predefinedSectionsManagementFlow.addPreviewSection({sectionName:t.section+t.version,parentNodeId:r.id,doc:n})}async addPageSection(e){const{section:t,pageId:o,withAI:n=!1,position:i,useAIPrompt:r}=e;this.setGenerationStatusForSection(t.section,p.Jj.IN_PROGRESS);try{if(!this.projectDoc.pages.byId[o])return;await p_.e.Instance.preloadSectionsByType(t.section),await this.predefinedSectionsManagementFlow.addSection({sectionName:t.section+t.version,withAI:n,position:i,useAIPrompt:r,selectAfterAdd:!1}),this.setGenerationStatusForSection(t.section,p.Jj.COMPLETED)}catch(s){y.Z.mixpanelEvent(y.Z.AnalyticsEvents.AI_GENERATION_MODAL_AI_SECTION_GENERATION_ERROR,{type:t.section,variant:t.version,error:s}),this.setGenerationStatusForSection(t.section,p.Jj.ERROR)}}},F_=(0,s.Z)(O_.prototype,"projectDoc",[g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C_=(0,s.Z)(O_.prototype,"projectUIState",[f_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E_=(0,s.Z)(O_.prototype,"layoutManagementFlow",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x_=(0,s.Z)(O_.prototype,"pageManagementFlow",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),__=(0,s.Z)(O_.prototype,"predefinedSectionsManagementFlow",[v_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=(0,s.Z)(O_.prototype,"aiContentGenerationFlow",[w_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P_=(0,s.Z)(O_.prototype,"sandboxingFlow",[N_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A_=(0,s.Z)(O_.prototype,"aiRepository",[j_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k_=(0,s.Z)(O_.prototype,"sessionStorageService",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_=(0,s.Z)(O_.prototype,"nodeManagementFlow",[D_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(O_.prototype,"addPreviewPageSection",[m.P],Object.getOwnPropertyDescriptor(O_.prototype,"addPreviewPageSection"),O_.prototype),T_=O_));class L_{constructor(e){(0,r.Z)(this,"currentState",void 0),(0,r.Z)(this,"states",void 0),this.states=e.states,this.currentState=e.initial}get state(){return this.currentState}send(e){const{currentState:t,states:o}=this,n=o[t][e];if(!n){const n=Object.keys(o[t]);throw new Error(`State Machien receive unsuported singnal of type ${e} for current state ${t}. This state supports only the following singnals ${n.join(", ")}`)}return this.currentState=n,this}}var $_=o(238405);const B_=(e,t)=>{let o=!1,n=e;const i=()=>{o=!0};if(t(n,i),!o)for(;n.parentElement;)if(n=n.parentElement,t(n,i),o)return},G_=e=>e.type===cu.Z.SUB_HIERARCHY||e.type===cu.Z.ABSOLUTE_SUB_HIERARCHY;var H_,z_,Y_,V_,W_,K_,q_,J_,X_,Q_,eM,tM,oM,nM,iM,rM,sM,aM,cM,lM,dM,pM,uM,hM,mM,yM,gM,fM,bM,IM,vM,wM,NM,jM,SM,DM,TM,OM,FM,CM,EM,xM,_M,MM,PM,AM,kM,UM,RM,ZM,LM,$M,BM,GM,HM,zM,YM,VM,WM,KM,qM,JM,XM,QM,eP,tP,oP,nP,iP,rP,sP,aP,cP,lP,dP,pP,uP,hP,mP,yP,gP,fP=o(183403),bP=o(174832),IP=o(298357),vP=o.n(IP);const wP=ol.x1.SIXTY;H_=(0,c.provide)("pointerInteractionManagementFlow"),z_=(0,c.inject)("projectDoc"),Y_=(0,c.inject)("projectUIState"),V_=(0,c.inject)("webRTCState"),W_=(0,c.inject)("stageMoveFlow"),K_=(0,c.inject)("rtcFlow"),q_=(0,c.inject)("elementRefProvider"),J_=(0,c.inject)("layoutManagementFlow"),X_=(0,c.inject)("dragPrimitiveFlow"),Q_=(0,c.inject)("dragComponentFlow"),eM=(0,c.inject)("dragPageFlow"),tM=(0,c.inject)("dragUploadedAssetFlow"),oM=(0,c.inject)("dragRemoteAssetFlow"),nM=(0,c.inject)("dragIconAssetFlow"),iM=(0,c.inject)("dragExistingNodeFlow"),rM=(0,c.inject)("dragTokenFlow"),sM=(0,c.inject)("dragSectionTemplateFlow"),aM=(0,c.inject)("dragInteractiveElementFlow"),cM=(0,c.inject)("devFileDragFlow"),lM=(0,c.inject)("dragAssetFolderFlow"),dM=(0,c.inject)("dragFolderFlow"),pM=(0,c.inject)("dropIntoFolderFlow"),uM=(0,c.inject)("dropIntoAssetFolderFlow"),hM=(0,c.inject)("dropIntoFlexContainerFlow"),mM=(0,c.inject)("dropIntoUnknownContainerFlow"),yM=(0,c.inject)("dropIntoTreeViewFlow"),gM=(0,c.inject)("dropIntoBlockInlineContainerFlow"),fM=(0,c.inject)("dropIntoInheritContainerFlow"),bM=(0,c.inject)("dropIntoSlotFlow"),IM=(0,c.inject)("dropIntoTokenCategoryFlow"),vM=(0,c.inject)("notificationsManagementFlow"),wM=(0,c.inject)("dropIntoButtonFlow"),NM=(0,c.inject)("dropIntoNavbarFlow"),jM=(0,c.inject)("dropIntoListFlow"),SM=(0,c.inject)("sharedbProjectSyncService"),DM=(0,c.inject)("guardsService"),TM=(0,c.inject)("dropSimulatorFlow"),OM=(0,c.inject)("dropSimulatorWatcher"),FM=(0,h.G)(g.l.DRAG),H_((mP=new WeakMap,yP=new WeakMap,gP=new WeakMap,EM=class{constructor(){(0,i.Z)(this,"projectDoc",xM,this),(0,i.Z)(this,"projectUIState",_M,this),(0,i.Z)(this,"webRTCState",MM,this),(0,i.Z)(this,"stageMoveFlow",PM,this),(0,i.Z)(this,"rtcFlow",AM,this),(0,i.Z)(this,"elementRefProvider",kM,this),(0,i.Z)(this,"layoutManagementFlow",UM,this),(0,i.Z)(this,"dragPrimitiveFlow",RM,this),(0,i.Z)(this,"dragComponentFlow",ZM,this),(0,i.Z)(this,"dragPageFlow",LM,this),(0,i.Z)(this,"dragUploadedAssetFlow",$M,this),(0,i.Z)(this,"dragRemoteAssetFlow",BM,this),(0,i.Z)(this,"dragIconAssetFlow",GM,this),(0,i.Z)(this,"dragExistingNodeFlow",HM,this),(0,i.Z)(this,"dragTokenFlow",zM,this),(0,i.Z)(this,"dragSectionTemplateFlow",YM,this),(0,i.Z)(this,"dragInteractiveElementFlow",VM,this),(0,i.Z)(this,"dragFileFlow",WM,this),(0,i.Z)(this,"dragAssetFolderFlow",KM,this),(0,i.Z)(this,"dragFolderFlow",qM,this),(0,i.Z)(this,"dropIntoFolderFlow",JM,this),(0,i.Z)(this,"dropIntoAssetFolderFlow",XM,this),(0,i.Z)(this,"dropIntoFlexContainerFlow",QM,this),(0,i.Z)(this,"dropIntoUnknownContainerFlow",eP,this),(0,i.Z)(this,"dropIntoTreeViewFlow",tP,this),(0,i.Z)(this,"dropIntoBlockInlineContainerFlow",oP,this),(0,i.Z)(this,"dropIntoInheritContainerFlow",nP,this),(0,i.Z)(this,"dropIntoSlotFlow",iP,this),(0,i.Z)(this,"dropIntoTokenCategoryFlow",rP,this),(0,i.Z)(this,"notificationsManagementFlow",sP,this),(0,i.Z)(this,"dropIntoButtonFlow",aP,this),(0,i.Z)(this,"dropIntoNavbarFlow",cP,this),(0,i.Z)(this,"dropIntoListFlow",lP,this),(0,i.Z)(this,"sharedbProjectSyncService",dP,this),(0,i.Z)(this,"guardsService",pP,this),(0,i.Z)(this,"dropSimulatorFlow",uP,this),(0,i.Z)(this,"dropSimulatorWatcher",hP,this),mP.set(this,{writable:!0,value:[]}),yP.set(this,{writable:!0,value:void 0}),gP.set(this,{writable:!0,value:null}),(0,r.Z)(this,"pointerSM",new L_({initial:"idle",states:{idle:{"pointer down":"prospecting"},prospecting:{"pointer move":"dragging",timeout:"dragging","pointer up":"clicking"},clicking:{next:"idle"},dragging:{"pointer move":"dragging","pointer up":"dropping",esc:"idle"},dropping:{next:"idle"}}})),(0,r.Z)(this,"dragFlows",[this.dragUploadedAssetFlow,this.dragRemoteAssetFlow,this.dragIconAssetFlow,this.dragPageFlow,this.dragExistingNodeFlow,this.dragPrimitiveFlow,this.dragComponentFlow,this.dragTokenFlow,this.dragSectionTemplateFlow,this.dragFileFlow,this.dragAssetFolderFlow,this.dragInteractiveElementFlow,this.dragFolderFlow]),(0,r.Z)(this,"activeDragFlow",null),(0,r.Z)(this,"dropFlows",[this.dropIntoButtonFlow,this.dropIntoFlexContainerFlow,this.dropIntoTreeViewFlow,this.dropIntoBlockInlineContainerFlow,this.dropIntoListFlow,this.dropIntoUnknownContainerFlow,this.dropIntoInheritContainerFlow,this.dropIntoTokenCategoryFlow,this.dropIntoNavbarFlow,this.dropIntoFolderFlow,this.dropIntoAssetFolderFlow,this.dropIntoSlotFlow]),(0,r.Z)(this,"activeDropFlows",[]),(0,r.Z)(this,"acceptingDropFlow",null),(0,r.Z)(this,"startinDragTO",0),(0,r.Z)(this,"dragStartParams",null),(0,r.Z)(this,"initialTarget",null),(0,r.Z)(this,"lockAndAddOpacityStyleOnNodes",(e=>{const t=e.content.subHierarchy,o=e.content.subHierarchyNodeInstanceIds,n=t.map((t=>{if(e.type===cu.Z.SUB_HIERARCHY){const e=this.elementRefProvider.getDomNodeElementRefById(t.id);null===e||void 0===e||e.style.setProperty("opacity","0.5")}return t.id}));null===o||void 0===o||o.forEach((t=>{if(e.type===cu.Z.SUB_HIERARCHY){const e=this.elementRefProvider.getDomTargetNode({nodeInstanceId:t});null===e||void 0===e||e.style.setProperty("opacity","0.5")}})),this.rtcFlow.lockEditedNodes(n)})),(0,r.Z)(this,"handlePointerDownEvent",vP()(((e,t)=>{var o;if("idle"!==this.pointerSM.state)return;if(0!==e.button)return;const{pressedKeys:n}=this.projectUIState.userInteractions;if(n.space)return void e.preventDefault();const i=this.getActualPositionOnPage(e,t);if((0,a.mutate)(this.projectUIState,(e=>{e.drag.initialMousePosition=i})),this.initialTarget=null!==(o=e.target)&&void 0!==o?o:(0,$_.e5)(i),!this.initialTarget)return;const r=this.initialTarget;if((0,Mg.Qq)(r))return;if(this.initialTarget.dataset.notInteractive&&(this.initialTarget=(0,Mg._p)(this.initialTarget)),!this.initialTarget)throw new Error("something is wrong get parent comp");const{dragFlows:s}=this;this.pointerSM.send("pointer down");let c=null,l=null;B_(r,((o,n)=>{for(let r=0;r<s.length;r+=1)if(c=s[r].acceptDOMElement(o,e),c){if(l=s[r],!t&&e.target instanceof HTMLElement){const t=e.target.closest('[tabindex="0"]');t instanceof HTMLElement&&t.focus()}var i;if(t&&t.target instanceof HTMLIFrameElement)null===(i=t.target.contentDocument)||void 0===i||i.body.focus();if((0,Mg.Qq)(o))return c=null,void n();e.preventDefault(),n();break}})),this.activeDragFlow=l,c&&l&&(this.dragStartParams={ev:e,target:r,position:i,matchedDraggedEntity:c,macthedDragFlow:l},this.startinDragTO=setTimeout((()=>{this.pointerSM.send("timeout"),(0,a.mutate)(this.projectUIState,(e=>{e.drag.currentMousePosition=i})),this.startDrag()}),250))}),wP)),(0,r.Z)(this,"handlePointerMoveByMouse",vP()(((e,t,o)=>{var n,i;const r=this.pointerSM.state;if((0,Zd.Z)(this,gP,{ev:e,customEv:t}),-1===["prospecting","dragging"].indexOf(r))return;const s=e.target,c={x:e.clientX,y:e.clientY},l=this.projectUIState.drag.draggedEntity;if(t&&t.target instanceof HTMLIFrameElement){const e=this.projectUIState.stage.webComp.controlValues.scale,o=t.target.getBoundingClientRect();c.x=c.x*e+o.x,c.y=c.y*e+o.y,t.detail.originalEvent.target instanceof HTMLElement&&l&&G_(l)&&this.stageMoveFlow.checkAndMoveStage(c)}if("prospecting"===r){const e=this.projectUIState.drag.initialMousePosition;if(!e)return;if(!(0,bP.NN)(e,c,20))return;clearTimeout(this.startinDragTO),this.startDrag()}if(this.pointerSM.send("pointer move"),(0,a.mutate)(this.projectUIState,(({drag:e})=>{e.currentMousePosition=c})),!this.activeDragFlow||!l)return;if(this.activeDragFlow.pointerMove(e,c),!this.activeDropFlows.length)return;if(!s||!(s instanceof HTMLElement||s instanceof SVGElement))return;const d=null===e||void 0===e?void 0:e.composedPath().map((e=>String(e.id))).join(" "),u=d.includes("asset-uploads"),h=d.includes("studio-sidebar-assets-manager");this.projectUIState.layout.sidebarPanel!==p.tI.ASSETS_MANAGER||this.projectUIState.layout.mainPanel===p.iW.DEV||u||l.type===cu.Z.ASSET_FOLDER||l.type===cu.Z.FILE||l.type===cu.Z.EDITABLE_FILE||((0,Zd.Z)(this,yP,p.tI.ASSETS_MANAGER),this.layoutManagementFlow.changeActiveSidebar(p.tI.FILES));const m=l.content,y=m.isNew&&(null===(n=m.meta)||void 0===n||null===(i=n.assets)||void 0===i?void 0:i.length)>0;this.projectUIState.layout.sidebarPanel===p.tI.FILES&&this.projectUIState.layout.mainPanel!==p.iW.DEV&&h&&y&&((0,Zd.Z)(this,yP,void 0),this.layoutManagementFlow.changeActiveSidebar(p.tI.ASSETS_MANAGER));let g=!1;var f;(B_(s,((n,i)=>{for(let r=0;r<this.activeDropFlows.length;r+=1){const s=this.activeDropFlows[r];if(s.acceptsDOMElement(n,e,c,t)){if((0,Mg.Qq)(n))return void i();this.acceptingDropFlow&&this.acceptingDropFlow!==s&&this.acceptingDropFlow.moveOut(e,c),this.acceptingDropFlow=s,this.acceptingDropFlow.moveOver({draggedEntity:l,ev:e,position:c,customEv:t,forced:o}),g=!0,e.stopPropagation(),e.preventDefault(),i();break}}})),g)||(null===(f=this.acceptingDropFlow)||void 0===f||f.moveOut(e,c),this.acceptingDropFlow=null)}),wP)),(0,r.Z)(this,"logEventsIntoAnalytics",((e,t)=>{if(e){if(e.type===cu.Z.SUB_HIERARCHY&&e.content.isNew){const o=(0,Rd.Z)(this,yP);"drop"===t?y.Z.mixpanelEvent(o===p.tI.ASSETS_MANAGER?y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ASSETS_MANAGER_UPLOADS_TAB_ASSET_DROP:y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_ELEMENTS_TAB_ELEMENT_DROP,{type:e.content.subHierarchy[0].primitiveType}):"drag"===t&&y.Z.mixpanelEvent(o===p.tI.ASSETS_MANAGER?y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ASSETS_MANAGER_UPLOADS_TAB_ASSET_DRAG:y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_ELEMENTS_TAB_ELEMENT_DRAG,{type:e.content.subHierarchy[0].primitiveType})}e.type===cu.Z.INTERACTIVE_ELEMENT&&("drop"===t?y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_ELEMENTS_TAB_ELEMENT_DROP,{type:e.type}):y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_ELEMENTS_TAB_ELEMENT_DRAG,{type:e.type})),e.type===cu.Z.SECTION_TEMPLATE&&("drop"===t?y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_SECTIONS_TAB_SECTION_DROP,{type:e.type}):y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_SECTIONS_TAB_SECTION_DRAG,{type:e.type}))}})),(0,r.Z)(this,"handlePointerUp",((e,t)=>{const o=this.pointerSM.state;if(this.dropSimulatorFlow.rollback(),-1===["prospecting","dragging"].indexOf(o))return;this.pointerSM.send("pointer up").send("next");const n=this.getActualPositionOnPage(e,t),i=this.projectUIState.drag.draggedEntity;var r,s,c;if("prospecting"===o)return clearTimeout(this.startinDragTO),(0,a.mutate)(this.projectUIState,(e=>{e.drag.draggedEntity=null})),this.dragStartParams=null,null===(r=this.activeDragFlow)||void 0===r||null===(s=r.pointerSelect)||void 0===s||s.call(r,{ev:e,position:n,initialTarget:this.initialTarget}),null===(c=this.activeDragFlow)||void 0===c||c.cleanUp(),void(this.initialTarget=null);i&&(e.stopPropagation(),e.preventDefault(),this.logEventsIntoAnalytics(i,"drop"),this.handleSyncPointerUpOps({ev:e,draggedEntity:i,position:n}))})),(0,r.Z)(this,"handleDragStart",(e=>{const t=(0,$_.FG)(e),o=(0,$_.e5)(t);if(!o)return;const{dragFlows:n}=this;B_(o,((t,o)=>{for(let i=0;i<n.length;i+=1){if(n[i].acceptDOMElement(t,e)){e.preventDefault(),e.stopPropagation(),o();break}}}))})),(0,r.Z)(this,"unbind",(e=>{e.removeEventListener("mousedown",this.handlePointerDownEvent),e.removeEventListener("mousemove",this.handlePointerMoveByMouse),e.removeEventListener("mouseup",this.handlePointerUp),(0,Rd.Z)(this,mP).forEach((e=>e())),this.dropSimulatorWatcher.stopListeningForUpdates()})),this.handleVirtualDrop=this.handleVirtualDrop.bind(this),this.handleDragEnd=this.handleDragEnd.bind(this)}startDrag(){const{pressedKeys:e,isNodeInPreviewMode:t}=this.projectUIState.userInteractions;if(t&&(0,a.mutate)(this.projectUIState,(({userInteractions:e})=>{e.isNodeInPreviewMode=!1})),e.ctrl)return;const{dragStartParams:o}=this;if(!o)return;const{ev:n,position:i,matchedDraggedEntity:r,macthedDragFlow:s}=o;if(!r)return;if(G_(r)){const e=this.projectUIState.layout.sidebarPanel,t=e===p.tI.ASSETS_MANAGER&&r.content.isNew;if(e!==p.tI.FILES&&r.content.subHierarchy.length&&!t&&((0,Zd.Z)(this,yP,e),this.layoutManagementFlow.changeActiveSidebar(p.tI.FILES)),r.content.hierarchyType===cu.h.EXISTING){const e=r.content.subHierarchy;if(0===e.length)return void s.pointerDown(n,i);if(this.rtcFlow.isNodeLocked(e[0].id))return;this.lockAndAddOpacityStyleOnNodes(r)}}if(r.type===cu.Z.INTERACTIVE_ELEMENT||r.type===cu.Z.SECTION_TEMPLATE){const e=this.projectUIState.layout.sidebarPanel;e!==p.tI.FILES&&((0,Zd.Z)(this,yP,e),this.layoutManagementFlow.changeActiveSidebar(p.tI.FILES))}this.logEventsIntoAnalytics(r,"drag"),s.pointerDown(n,i),(0,a.mutate)(this.projectUIState,(e=>{e.drag.draggedEntity=r}));const c=[];for(let a=0;a<this.dropFlows.length;a+=1)this.dropFlows[a].handleDraggedEntity(r,i)&&c.push(this.dropFlows[a]),this.activeDropFlows=c}forcefullyRecomputeMove(){(0,Rd.Z)(this,gP)}handleSyncPointerUpOps(e){var t,o;const{ev:n,doc:i,draggedEntity:r,position:s}=e;if(!i)return;null===(t=this.acceptingDropFlow)||void 0===t||t.handleDrop({draggedEntity:r,doc:i});const a=G_(r)?r.content.subHierarchy[0].id:null;null===(o=this.activeDragFlow)||void 0===o||o.pointerUp({ev:n,position:s,draggedEntityId:a,doc:i}),this.handleDragEnd()}handleVirtualDrop(e){const{doc:t}=e;if(!t)return!1;const{draggedEntity:o}=this.projectUIState.drag;return!!o&&this.guardsService.executeFunctionGuarded(QI._.VIRTUAL_WORK,(()=>{var e;return null===(e=this.acceptingDropFlow)||void 0===e?void 0:e.handleDrop({draggedEntity:o,doc:t,isVirtual:!0})}))}handleDragEnd(){var e,t;const{draggedEntity:o}=this.projectUIState.drag;o&&G_(o)&&(null===o||void 0===o?void 0:o.content.hierarchyType)===cu.h.EXISTING&&this.rtcFlow.unlockEditedNodes(),this.dropSimulatorFlow.rollback(),this.dropSimulatorFlow.disposeOfIndicator(),(0,Zd.Z)(this,gP,null),(0,a.mutate)(this.projectUIState,(({drag:e})=>{e.draggedEntity=null})),"undefined"!==typeof(0,Rd.Z)(this,yP)&&(this.layoutManagementFlow.changeActiveSidebar((0,Rd.Z)(this,yP)),(0,Zd.Z)(this,yP,void 0)),null===(e=this.acceptingDropFlow)||void 0===e||e.resetState(),null===(t=this.activeDragFlow)||void 0===t||t.cleanUp(),this.acceptingDropFlow=null,this.activeDragFlow=null,this.activeDropFlows=[],this.dragStartParams=null,this.initialTarget=null,"dragging"===this.pointerSM.state&&this.pointerSM.send("esc")}getActualPositionOnPage(e,t){const o=(0,$_.FG)(e);if(t&&t.target instanceof HTMLIFrameElement){const e=this.projectUIState.stage.webComp.controlValues.scale,n=t.target.getBoundingClientRect(),i=(0,ni.AO)(t.target);o.x=o.x*e*i+n.x,o.y=o.y*e*i+n.y}return o}bind(e){e.addEventListener("mousedown",this.handlePointerDownEvent),e.addEventListener("mousemove",this.handlePointerMoveByMouse),e.addEventListener("mouseup",this.handlePointerUp),(0,Zd.Z)(this,mP,[...(0,fP.un)({target:e,types:["mousedown","touchstart"],callback:(e,t)=>this.handlePointerDownEvent(e,t)}),...(0,fP.un)({target:e,types:["mouseup"],callback:(e,t)=>this.handlePointerUp(e,t)}),...(0,fP.un)({target:e,types:["mousemove"],callback:(e,t)=>this.handlePointerMoveByMouse(e,t)})]),this.dropSimulatorWatcher.listenForUpdates()}},xM=(0,s.Z)(EM.prototype,"projectDoc",[z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_M=(0,s.Z)(EM.prototype,"projectUIState",[Y_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MM=(0,s.Z)(EM.prototype,"webRTCState",[V_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PM=(0,s.Z)(EM.prototype,"stageMoveFlow",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AM=(0,s.Z)(EM.prototype,"rtcFlow",[K_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kM=(0,s.Z)(EM.prototype,"elementRefProvider",[q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UM=(0,s.Z)(EM.prototype,"layoutManagementFlow",[J_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RM=(0,s.Z)(EM.prototype,"dragPrimitiveFlow",[X_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZM=(0,s.Z)(EM.prototype,"dragComponentFlow",[Q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LM=(0,s.Z)(EM.prototype,"dragPageFlow",[eM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$M=(0,s.Z)(EM.prototype,"dragUploadedAssetFlow",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=(0,s.Z)(EM.prototype,"dragRemoteAssetFlow",[oM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GM=(0,s.Z)(EM.prototype,"dragIconAssetFlow",[nM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HM=(0,s.Z)(EM.prototype,"dragExistingNodeFlow",[iM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zM=(0,s.Z)(EM.prototype,"dragTokenFlow",[rM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YM=(0,s.Z)(EM.prototype,"dragSectionTemplateFlow",[sM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VM=(0,s.Z)(EM.prototype,"dragInteractiveElementFlow",[aM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WM=(0,s.Z)(EM.prototype,"dragFileFlow",[cM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KM=(0,s.Z)(EM.prototype,"dragAssetFolderFlow",[lM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qM=(0,s.Z)(EM.prototype,"dragFolderFlow",[dM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JM=(0,s.Z)(EM.prototype,"dropIntoFolderFlow",[pM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XM=(0,s.Z)(EM.prototype,"dropIntoAssetFolderFlow",[uM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QM=(0,s.Z)(EM.prototype,"dropIntoFlexContainerFlow",[hM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eP=(0,s.Z)(EM.prototype,"dropIntoUnknownContainerFlow",[mM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tP=(0,s.Z)(EM.prototype,"dropIntoTreeViewFlow",[yM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oP=(0,s.Z)(EM.prototype,"dropIntoBlockInlineContainerFlow",[gM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nP=(0,s.Z)(EM.prototype,"dropIntoInheritContainerFlow",[fM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iP=(0,s.Z)(EM.prototype,"dropIntoSlotFlow",[bM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rP=(0,s.Z)(EM.prototype,"dropIntoTokenCategoryFlow",[IM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sP=(0,s.Z)(EM.prototype,"notificationsManagementFlow",[vM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aP=(0,s.Z)(EM.prototype,"dropIntoButtonFlow",[wM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cP=(0,s.Z)(EM.prototype,"dropIntoNavbarFlow",[NM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lP=(0,s.Z)(EM.prototype,"dropIntoListFlow",[jM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dP=(0,s.Z)(EM.prototype,"sharedbProjectSyncService",[SM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pP=(0,s.Z)(EM.prototype,"guardsService",[DM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uP=(0,s.Z)(EM.prototype,"dropSimulatorFlow",[TM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hP=(0,s.Z)(EM.prototype,"dropSimulatorWatcher",[OM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(EM.prototype,"startDrag",[FM],Object.getOwnPropertyDescriptor(EM.prototype,"startDrag"),EM.prototype),(0,s.Z)(EM.prototype,"handleSyncPointerUpOps",[m.P],Object.getOwnPropertyDescriptor(EM.prototype,"handleSyncPointerUpOps"),EM.prototype),(0,s.Z)(EM.prototype,"handleVirtualDrop",[m.P],Object.getOwnPropertyDescriptor(EM.prototype,"handleVirtualDrop"),EM.prototype),CM=EM));var NP,jP,SP,DP,TP,OP,FP,CP,EP,xP,_P,MP=o(85413);class PP{constructor(e){(0,r.Z)(this,"stencilKey",void 0),(0,r.Z)(this,"newNode",[]),(0,r.Z)(this,"isNew",!0),(0,r.Z)(this,"hierarchyType",cu.h.PRIMITIVE),this.stencilKey=e,this.newNode=[(0,MP.a)({stencilKey:this.stencilKey})]}get subHierarchy(){return this.newNode}get representation(){return(0,bP.H)(yl.hK[this.stencilKey],(0,ni.kC)(this.stencilKey))}}NP=(0,c.provide)("dragPrimitiveFlow"),jP=(0,c.inject)("projectDoc"),SP=(0,c.inject)("nodeManagementFlow"),DP=(0,c.inject)("nodeSelectionFlow"),TP=(0,c.inject)("modalManagementFlow"),NP((FP=class{constructor(){(0,i.Z)(this,"projectDoc",CP,this),(0,i.Z)(this,"nodeManagementFlow",EP,this),(0,i.Z)(this,"nodeSelectionFlow",xP,this),(0,i.Z)(this,"modalManagementFlow",_P,this),(0,r.Z)(this,"draggedPrimitive",null),(0,r.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?this.draggedPrimitive=(e=>{if(!e)return null;const t=e.dataset.dragPrimitive;if(!t)return null;const o=new PP(t);return{type:cu.Z.SUB_HIERARCHY,content:o,representation:o.representation}})(e):null)),(0,r.Z)(this,"pointerSelect",(()=>{if(!this.draggedPrimitive)return;const e=this.draggedPrimitive.content.subHierarchy;y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_ELEMENTS_TAB_ELEMENT_CLICK,{elementType:e[0].primitiveType}),e[0].primitiveType!==Zn.sO.HTML_NODE?this.nodeManagementFlow.addPrimitivesToSelNodeSelectAndScroll({primitives:this.draggedPrimitive.content.subHierarchy}):this.nodeManagementFlow.addCodeEmbedNodeToSelNode({primitives:e})})),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>null))}pointerUp(e){const{draggedEntityId:t,doc:o}=e;null!==o&&void 0!==o&&o.nodes.getById(t||"")&&this.nodeSelectionFlow.setNodeSelection({nodeId:t,expandTreeView:!1})}},CP=(0,s.Z)(FP.prototype,"projectDoc",[jP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EP=(0,s.Z)(FP.prototype,"nodeManagementFlow",[SP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xP=(0,s.Z)(FP.prototype,"nodeSelectionFlow",[DP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_P=(0,s.Z)(FP.prototype,"modalManagementFlow",[TP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(FP.prototype,"pointerUp",[m.P],Object.getOwnPropertyDescriptor(FP.prototype,"pointerUp"),FP.prototype),OP=FP));var AP,kP,UP,RP,ZP,LP,$P,BP,GP,HP,zP,YP,VP,WP,KP,qP,JP,XP,QP,eA,tA,oA,nA,iA,rA,sA,aA,cA,lA,dA,pA;let uA=(AP=(0,c.inject)("projectDoc"),kP=(0,c.inject)("projectUIState"),UP=(0,c.inject)("assetFoldersFlow"),RP=class{constructor(e){(0,i.Z)(this,"projectDoc",ZP,this),(0,i.Z)(this,"projectUIState",LP,this),(0,i.Z)(this,"assetFoldersFlow",$P,this),(0,r.Z)(this,"assets",[]),(0,r.Z)(this,"assetNodes",[]),(0,r.Z)(this,"repres",{}),(0,r.Z)(this,"assetIdToNodeIdMapping",{}),(0,r.Z)(this,"isNew",!0),(0,r.Z)(this,"hierarchyType",cu.h.PRIMITIVE);const t=this.projectUIState.assetsList.selected.entities;if(-1!==Object.keys(t).indexOf(e)?this.assets=Object.keys(t).reduce(((e,t)=>(e.push(this.projectDoc.assets.byId[t]),e)),[]):this.assets=[this.projectDoc.assets.byId[e]],this.assets.forEach((e=>{this.assetNodes.push((0,MP.a)({stencilKey:(0,ni.MF)(e)===Zn.sO.VIDEO?yl.sO.VIDEO:yl.sO.IMAGE,attrs:{src:e.id}})),this.assetIdToNodeIdMapping[e.id]=this.assetNodes[this.assetNodes.length-1].id})),1!==this.assets.length){const{name:e,icon:t}=this.assetFoldersFlow.getFirstFromSelectedEntities();return void(this.repres=(0,bP.H)(t,e,this.assets.length))}const o=this.assets[0],n=o.type===Mt.K.VIDEO,s=o.type===Mt.K.EDITABLE_FILE||o.type===Mt.K.FILE,a=n?(0,ni.Bh)(o):(0,ni.zo)(o,`&w=${$r.ou.oq}`);this.repres=(0,F.jsx)("img",{alt:"",style:{objectFit:"contain",objectPosition:"left top"},width:100,height:100,src:a}),n&&(this.repres=(0,F.jsx)("video",{style:{width:"160px",height:"90px"},autoPlay:!0,muted:!0,loop:!0,src:a})),s&&(this.repres=(0,bP.H)(_m.md["custom-files/file"],o.name))}get subHierarchy(){return this.assetNodes}get meta(){return{assets:this.assets,assetIdToNodeIdMapping:this.assetIdToNodeIdMapping}}get representation(){return this.repres}},ZP=(0,s.Z)(RP.prototype,"projectDoc",[AP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LP=(0,s.Z)(RP.prototype,"projectUIState",[kP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$P=(0,s.Z)(RP.prototype,"assetFoldersFlow",[UP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RP);BP=(0,c.provide)("dragUploadedAssetFlow"),GP=(0,c.inject)("nodeSelectionFlow"),HP=(0,c.inject)("nodeRichTextFlow"),zP=(0,c.inject)("assetsEditFlow"),YP=(0,c.inject)("projectDoc"),VP=(0,c.inject)("projectUIState"),WP=(0,c.inject)("assetsManagementFlow"),KP=(0,c.inject)("nodeManagementFlow"),qP=(0,c.inject)("assetFoldersFlow"),JP=(0,c.inject)("folderManagementFlow"),XP=(0,c.inject)("assetsSelectionFlow"),QP=(0,ep.u)(ep.j.ADD_ASSET_PRIMITIVE),BP((tA=class{constructor(){(0,r.Z)(this,"draggedAsset",null),(0,i.Z)(this,"nodeSelectionFlow",oA,this),(0,i.Z)(this,"nodeRichTextFlow",nA,this),(0,i.Z)(this,"assetsEditFlow",iA,this),(0,i.Z)(this,"projectDoc",rA,this),(0,i.Z)(this,"projectUIState",sA,this),(0,i.Z)(this,"assetsManagementFlow",aA,this),(0,i.Z)(this,"nodeManagementFlow",cA,this),(0,i.Z)(this,"assetFoldersFlow",lA,this),(0,i.Z)(this,"folderManagementFlow",dA,this),(0,i.Z)(this,"assetsSelectionFlow",pA,this),(0,r.Z)(this,"actionType",null),(0,r.Z)(this,"acceptDOMElement",(e=>{if(!(e instanceof HTMLElement))return null;if(Object.keys(this.projectUIState.folders.selected.entities).length)return null;const t=e.dataset.assetAction;t&&e.closest("[data-drag-new-local-asset]")&&(this.actionType=t);const o=Object.keys(this.projectUIState.assetsList.selected.entities);let n=cu.Z.SUB_HIERARCHY;const i=o.some((e=>this.projectDoc.assets.byId[e].type===Mt.K.FILE)),r=o.some((e=>this.projectDoc.assets.byId[e].type===Mt.K.EDITABLE_FILE));return i&&(n=cu.Z.FILE),r&&(n=cu.Z.EDITABLE_FILE),this.draggedAsset=((e,t=cu.Z.SUB_HIERARCHY)=>{if(!e)return null;const o=e.dataset.dragNewLocalAsset,n=e.dataset.assetId;if(!o||!n)return null;const i=new uA(n);return{type:t,content:i,representation:i.representation}})(e,n),this.draggedAsset?this.draggedAsset:null})),(0,r.Z)(this,"pointerSelect",(e=>{const{initialTarget:t}=e;if(!!t.closest(".asset-options-button"))return;const o=t.closest("[data-asset-id]"),n=o.dataset.assetLocation||null,i=o.dataset.assetId;if(!i)return;const{ctrl:r,shift:s}=this.projectUIState.userInteractions.pressedKeys;if(r||s||(this.folderManagementFlow.deselectAllFolders(),this.assetsSelectionFlow.deselectAllAssets(),this.assetsSelectionFlow.selectAsset(i,n)),!this.draggedAsset||!this.actionType)return;const a=this.draggedAsset.content.meta.assets[0].id;switch(this.nodeManagementFlow.revertLocalWork(),y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ASSETS_MANAGER_UPLOADS_TAB_ASSET_CLICK),this.actionType){case nb.gP.REPLACE_SOURCE:{const{activeSelection:e,selectionStyles:t}=this.projectUIState.staticNodeInterationsData,o=this.nodeSelectionFlow.getSelectedNodeType();!o||o!==Zn.sO.LIST&&o!==Zn.sO.LISTITEM?e||t?this.updateTextBackgroundImage(a):o===yl.sO.IMAGE||o===yl.sO.VIDEO||o===Zn.sO.COMPONENT?this.assetsManagementFlow.setSrcForSelectedNode(a):this.assetsManagementFlow.setBgImageForSelectedNode(a):this.assetsManagementFlow.setListStyleImageForSelectedNode(a);break}case nb.gP.REPLACE_POSTER:this.assetsManagementFlow.setPosterForSelectedNode(a);break;case nb.gP.ADD_SIBLING:this.assetsManagementFlow.addAssetAfterSelectedNode(a);break;case nb.gP.ADD_CHILD:this.assetsManagementFlow.addAssetOrContainerToSelectedNode(a)}this.actionType=null})),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>{this.actionType=null})),this.pointerUp=this.pointerUp.bind(this)}pointerUp(e){const{draggedEntityId:t,doc:o}=e;if(!o||!t||!this.draggedAsset)return[];if(!o.nodes.getById(t))return[];this.nodeSelectionFlow.setNodeSelection({nodeId:t,expandTreeView:!1});const n=this.draggedAsset.content.meta.assets[0].id,i=Object.keys(this.projectUIState.assetsList.selected.entities);return-1===i.indexOf(n)?(this.assetsEditFlow.createAssetInNodeRelation({nodeId:t,assetId:n,doc:o}),[n]):(i.forEach((e=>{var t;this.assetsEditFlow.createAssetInNodeRelation({nodeId:null===(t=this.draggedAsset)||void 0===t?void 0:t.content.meta.assetIdToNodeIdMapping[e],assetId:e,doc:o})})),i)}updateTextBackgroundImage(e){const t=this.nodeSelectionFlow.getSelectedNodesIds()[0],o=this.projectDoc.nodes.getById(t);if(!o)return;const n=this.nodeRichTextFlow.getTextComponentForNode(o.id);if(!n)return;const i=this.projectDoc.assets.byId[e];n.handleFormatChange({styles:{backgroundImage:{value:`url("${i.remoteSrc}")`}}})}},oA=(0,s.Z)(tA.prototype,"nodeSelectionFlow",[GP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nA=(0,s.Z)(tA.prototype,"nodeRichTextFlow",[HP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iA=(0,s.Z)(tA.prototype,"assetsEditFlow",[zP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rA=(0,s.Z)(tA.prototype,"projectDoc",[YP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sA=(0,s.Z)(tA.prototype,"projectUIState",[VP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aA=(0,s.Z)(tA.prototype,"assetsManagementFlow",[WP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cA=(0,s.Z)(tA.prototype,"nodeManagementFlow",[KP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lA=(0,s.Z)(tA.prototype,"assetFoldersFlow",[qP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dA=(0,s.Z)(tA.prototype,"folderManagementFlow",[JP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pA=(0,s.Z)(tA.prototype,"assetsSelectionFlow",[XP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(tA.prototype,"pointerUp",[m.P,QP],Object.getOwnPropertyDescriptor(tA.prototype,"pointerUp"),tA.prototype),eA=tA));var hA,mA,yA,gA,fA,bA,IA;function vA(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function wA(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?vA(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):vA(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}class NA{constructor(e,t,o,n){(0,r.Z)(this,"newNodes",[]),(0,r.Z)(this,"repres",void 0),(0,r.Z)(this,"isNew",!0),(0,r.Z)(this,"hierarchyType",cu.h.PRIMITIVE);const i=void 0;if(!t){const e=(0,MP.a)({stencilKey:yl.sO.ICON,attrs:{viewBox:`0 0 ${o||1024} ${n||1024}`}});this.newNodes.push(e)}const s=null!==e&&void 0!==e&&e.length&&JSON.parse(e)||[];if((null===s||void 0===s?void 0:s.length)>0&&s.forEach((e=>{const t=new lu.HX({primitiveType:Zn.sO.ICON,semanticType:Zn.qo.PATH,pos:"0",attrs:{d:new Yr.F({content:e})},parentId:i});this.newNodes.push(t)})),t){const e=function(e){const t=new DOMParser,o=t.parseFromString(e,"text/html").body.firstElementChild;if(!o)return null;return SA(o)}(t);e&&jA(e,this.newNodes,i)}const a=s.map(((e,t)=>(0,F.jsx)("path",{d:e},t)));this.repres=(0,F.jsxs)("div",{className:v().dynamic([["146878159",[N.DM.GRAY_100,N.N_.UNIT,N.N_.HALF_UNIT]]])+" icon-container",children:[t?(0,F.jsx)("svg",{height:o||"24",width:o||"24",viewBox:`0 0 ${o||"24"} ${o||"24"}`,dangerouslySetInnerHTML:{__html:t},className:v().dynamic([["146878159",[N.DM.GRAY_100,N.N_.UNIT,N.N_.HALF_UNIT]]])}):(0,F.jsx)("svg",{height:"24",width:"24",viewBox:`0 0 ${o||1024} ${n||1024}`,fill:"#fff",stroke:"#fff",className:v().dynamic([["146878159",[N.DM.GRAY_100,N.N_.UNIT,N.N_.HALF_UNIT]]]),children:a}),(0,F.jsx)("span",{className:v().dynamic([["146878159",[N.DM.GRAY_100,N.N_.UNIT,N.N_.HALF_UNIT]]])+" label",children:"Icon"}),(0,F.jsx)(v(),{id:"146878159",dynamic:[N.DM.GRAY_100,N.N_.UNIT,N.N_.HALF_UNIT],children:[`.icon-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;background-color:${N.DM.GRAY_100};-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:${N.N_.UNIT};}`,`.label.__jsx-style-dynamic-selector{margin:${N.N_.HALF_UNIT};}`]})]})}get meta(){return{nodeType:Zn.sO.ICON}}get subHierarchy(){return this.newNodes}get representation(){return this.repres}}hA=(0,c.provide)("dragIconAssetFlow"),mA=(0,c.inject)("nodeManagementFlow"),yA=(0,c.inject)("nodeSelectionFlow"),hA((fA=class{constructor(){(0,i.Z)(this,"nodeManagementFlow",bA,this),(0,i.Z)(this,"nodeSelectionFlow",IA,this),(0,r.Z)(this,"draggedAsset",null),(0,r.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?this.draggedAsset=(e=>{if(!e)return null;const t=e.dataset.dragNewIconCode,o=e.dataset.dragNewIconPaths,n=e.dataset.dragNewIconWidth,i=e.dataset.dragNewIconHeight;if(!o&&!t)return null;const r=new NA(null!==o&&void 0!==o?o:"",t,n,i);return{type:cu.Z.SUB_HIERARCHY,content:r,representation:r.representation}})(e):null)),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerSelect",(()=>{this.draggedAsset&&this.nodeManagementFlow.addPrimitivesToSelNodeSelectAndScroll({primitives:this.draggedAsset.content.subHierarchy,keepOriginalParent:!0})})),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>null))}pointerUp(e){const{draggedEntityId:t,doc:o}=e;null!==o&&void 0!==o&&o.nodes.getById(t||"")&&this.nodeSelectionFlow.setNodeSelection({nodeId:t,expandTreeView:!1})}},bA=(0,s.Z)(fA.prototype,"nodeManagementFlow",[mA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IA=(0,s.Z)(fA.prototype,"nodeSelectionFlow",[yA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(fA.prototype,"pointerUp",[m.P],Object.getOwnPropertyDescriptor(fA.prototype,"pointerUp"),fA.prototype),gA=fA));const jA=(e,t,o)=>{const n=new lu.HX({primitiveType:Zn.sO.ICON,semanticType:e.elementType,pos:"0",attrs:wA({},Object.keys(e.attributes).reduce(((t,o)=>(t[o]=new Yr.F({content:e.attributes[o].content}),t)),{})),meta:{isIconFromHierarchy:!0},parentId:o});t.push(n);const i=t.find((e=>e.id===o));i&&"element-node"===i.type&&(i.childrenIds[n.id]=!0),e.children.length>0&&e.children.forEach((e=>{jA(e,t,n.id)}))};function SA(e){const t={elementType:e.tagName.toLowerCase(),attributes:{},children:[]};for(const o of e.attributes)t.attributes[o.name]={content:o.value};for(const o of e.children)t.children.push(SA(o));return t}var DA,TA,OA,FA,CA,EA,xA,_A,MA,PA,AA,kA,UA,RA,ZA,LA,$A,BA=o(351686);class GA{constructor(e){(0,r.Z)(this,"src",""),(0,r.Z)(this,"remoteAssetNode",[]),(0,r.Z)(this,"isNew",!0),(0,r.Z)(this,"hierarchyType",cu.h.PRIMITIVE),this.src=e,this.remoteAssetNode=[(0,MP.a)({stencilKey:yl.sO.IMAGE,attrs:{src:this.src}})]}get subHierarchy(){return this.remoteAssetNode}get representation(){return(0,F.jsx)("img",{alt:"",style:{objectFit:"contain",backgroundColor:N.DM.GRAY_100},width:100,height:100,src:this.src})}}DA=(0,c.provide)("dragRemoteAssetFlow"),TA=(0,c.inject)("projectDoc"),OA=(0,c.inject)("projectUIState"),FA=(0,c.inject)("assetsManagementFlow"),CA=(0,c.inject)("nodeManagementFlow"),EA=(0,c.inject)("nodeSelectionFlow"),xA=(0,c.inject)("elementRefProvider"),_A=(0,c.inject)("nodeRichTextFlow"),DA((PA=class{constructor(){(0,r.Z)(this,"draggedAsset",null),(0,i.Z)(this,"projectDoc",AA,this),(0,i.Z)(this,"projectUIState",kA,this),(0,i.Z)(this,"assetsManagementFlow",UA,this),(0,i.Z)(this,"nodeManagementFlow",RA,this),(0,i.Z)(this,"nodeSelectionFlow",ZA,this),(0,i.Z)(this,"elementRefProvider",LA,this),(0,i.Z)(this,"nodeRichTextFlow",$A,this),(0,r.Z)(this,"cmsMixedTypeFlow",BA.U.Instance),(0,r.Z)(this,"actionType",null),(0,r.Z)(this,"assetLink",null),(0,r.Z)(this,"downloadUrl",null),(0,r.Z)(this,"previewImgUrl",null),(0,r.Z)(this,"remoteAssetUrl",null),(0,r.Z)(this,"acceptDOMElement",(e=>{if(!(e instanceof HTMLElement))return null;const t=e.dataset.assetAction;return t&&e.closest("[data-remote-asset-url]")&&(this.actionType=t),this.draggedAsset=(e=>{if(!e)return null;const t=e.dataset.remoteAssetUrl;if(!t)return null;const o=new GA(t);return{type:cu.Z.SUB_HIERARCHY,content:o,representation:o.representation}})(e),this.draggedAsset?(this.previewImgUrl=e.dataset.previewImgUrl||null,this.downloadUrl=e.dataset.downloadLink||null,this.assetLink=e.dataset.assetLink||null,this.remoteAssetUrl=e.dataset.remoteAssetUrl||null,this.draggedAsset):null})),(0,r.Z)(this,"pointerSelect",(()=>{if(!this.assetLink||!this.downloadUrl||!this.actionType)return;const e=this.nodeSelectionFlow.getSelectedNodeOrComponentId(),t=this.nodeSelectionFlow.getSelectedNodeType(),o=this.projectUIState.userPreferences.previewAssetsOnHover?this.remoteAssetUrl:this.previewImgUrl;if(this.actionType===nb.gP.REPLACE_SOURCE&&o&&e){if(t===yl.sO.IMAGE){const t=this.elementRefProvider.getDomNodeElementRefById(e);null===t||void 0===t||t.setAttribute("src",o)}if(t===Zn.sO.COMPONENT){const{targetNodeId:t}=this.assetsManagementFlow.getPropNameAndTargetNodeForImageInComp(e),n=this.elementRefProvider.getDomNodeElementRefByCompInstance(t,e);null===n||void 0===n||n.setAttribute("src",o)}}switch(this.nodeManagementFlow.revertLocalWork(),this.actionType){case nb.gP.REPLACE_SOURCE:{const{activeSelection:e,selectionStyles:o}=this.projectUIState.staticNodeInterationsData;if(t===Zn.sO.CMS_MIXED_TYPE_NODE){this.cmsMixedTypeFlow.updateSelectedMixedTypeNodeMappingCompImageAttr({imgSrc:this.assetLink,downloadLink:this.downloadUrl});break}if(t===yl.sO.IMAGE||t===Zn.sO.COMPONENT){if(this.projectUIState.userInteractions.pressedKeys.alt&&t===Zn.sO.COMPONENT){this.assetsManagementFlow.setBgImageForSelectedNode(this.assetLink,this.downloadUrl);break}this.assetsManagementFlow.setSrcForSelectedNode(this.assetLink,this.downloadUrl)}else e||o?this.updateTextBackgroundImage():this.assetsManagementFlow.setBgImageForSelectedNode(this.assetLink,this.downloadUrl);break}case nb.gP.REPLACE_POSTER:this.assetsManagementFlow.setPosterForSelectedNode(this.assetLink,this.downloadUrl);break;case nb.gP.ADD_SIBLING:this.assetsManagementFlow.addAssetAfterSelectedNode(this.assetLink,this.downloadUrl);break;case nb.gP.ADD_CHILD:this.assetsManagementFlow.addAssetOrContainerToSelectedNode(this.assetLink,this.downloadUrl,!1)}this.actionType=null})),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>{this.actionType=null,this.downloadUrl=null,this.previewImgUrl=null,this.remoteAssetUrl=null})),this.pointerUp=this.pointerUp.bind(this)}async pointerUp(e){const{doc:t,draggedEntityId:o}=e;if(!t||!this.downloadUrl||!o)return;t.nodes.getById(o)&&(this.assetsManagementFlow.triggerUnsplashDownload(this.downloadUrl),this.nodeSelectionFlow.setNodeSelection({nodeId:o,expandTreeView:!1}))}updateTextBackgroundImage(){const e=this.nodeSelectionFlow.getSelectedNodesIds()[0],t=this.projectDoc.nodes.getById(e);if(!t)return;const o=this.nodeRichTextFlow.getTextComponentForNode(t.id);o&&o.handleFormatChange({styles:{backgroundImage:{value:`url("${this.assetLink}&w=${$r.ou.yL}")`}}})}},AA=(0,s.Z)(PA.prototype,"projectDoc",[TA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kA=(0,s.Z)(PA.prototype,"projectUIState",[OA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UA=(0,s.Z)(PA.prototype,"assetsManagementFlow",[FA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RA=(0,s.Z)(PA.prototype,"nodeManagementFlow",[CA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZA=(0,s.Z)(PA.prototype,"nodeSelectionFlow",[EA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LA=(0,s.Z)(PA.prototype,"elementRefProvider",[xA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$A=(0,s.Z)(PA.prototype,"nodeRichTextFlow",[_A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(PA.prototype,"pointerUp",[m.P],Object.getOwnPropertyDescriptor(PA.prototype,"pointerUp"),PA.prototype),MA=PA));var HA,zA,YA,VA,WA,KA,qA,JA,XA,QA,ek,tk,ok,nk;let ik=(HA=(0,c.inject)("projectDoc"),zA=class{get meta(){return{dragComponentId:this.componentSourceId}}constructor(e){(0,i.Z)(this,"projectDoc",YA,this),(0,r.Z)(this,"componentSourceId",void 0),(0,r.Z)(this,"newComponentNode",void 0),(0,r.Z)(this,"isNew",!0),(0,r.Z)(this,"hierarchyType",cu.h.COMPONENT),this.componentSourceId=e;if(!this.projectDoc.components.byId[e])throw new Error(`Could not construct component drag entity. Component ${e} is missing.`);const t=new el.F({primitiveType:Zn.sO.COMPONENT});t.compIdOfCompInstance=e,this.newComponentNode=[t]}get subHierarchy(){return this.newComponentNode}get representation(){return(0,bP.H)(_m.u7["tree-stencil/component"],"Component")}},YA=(0,s.Z)(zA.prototype,"projectDoc",[HA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zA);VA=(0,c.provide)("dragComponentFlow"),WA=(0,c.inject)("projectDoc"),KA=(0,c.inject)("componentManagementFlow"),qA=(0,c.inject)("componentStyleManagementFlow"),JA=(0,c.inject)("nodeSelectionFlow"),VA((QA=class{constructor(){(0,i.Z)(this,"projectDoc",ek,this),(0,i.Z)(this,"componentManagementFlow",tk,this),(0,i.Z)(this,"componentStyleManagementFlow",ok,this),(0,i.Z)(this,"nodeSelectionFlow",nk,this),(0,r.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?(e=>{if(!e)return null;const t=e.dataset.dragComponentId;if(!t)return null;const o=new ik(t);return{type:cu.Z.SUB_HIERARCHY,content:o,representation:o.representation}})(e):null)),(0,r.Z)(this,"pointerSelect",(()=>null)),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>null)),this.pointerUp=this.pointerUp.bind(this)}async pointerUp(e){const{doc:t,draggedEntityId:o}=e;if(!t||!o)return;const n=t.nodes.getById(o);if(!n||!t.nodes.nodeIsCompInstance(n))return;const i=t.components.byId[n.compIdOfCompInstance];i&&(this.componentStyleManagementFlow.addClassToCompInstance({compInstanceId:n.id,compId:i.id,className:i.getUniqueStyleSetName(t),doc:t}),this.nodeSelectionFlow.setNodeSelection({nodeId:o,expandTreeView:!1}))}},ek=(0,s.Z)(QA.prototype,"projectDoc",[WA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tk=(0,s.Z)(QA.prototype,"componentManagementFlow",[KA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ok=(0,s.Z)(QA.prototype,"componentStyleManagementFlow",[qA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nk=(0,s.Z)(QA.prototype,"nodeSelectionFlow",[JA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(QA.prototype,"pointerUp",[m.P],Object.getOwnPropertyDescriptor(QA.prototype,"pointerUp"),QA.prototype),XA=QA));var rk,sk,ak,ck;let lk=(rk=(0,c.inject)("projectDoc"),sk=class{get meta(){return{dragPageId:this.pageSourceId}}constructor(e){(0,i.Z)(this,"projectDoc",ak,this),(0,r.Z)(this,"pageSourceId",void 0),this.pageSourceId=e}get representation(){return(0,bP.H)(_m.TV.page,"Page")}},ak=(0,s.Z)(sk.prototype,"projectDoc",[rk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sk);(0,c.provide)("dragPageFlow")(ck=class{constructor(){(0,r.Z)(this,"draggedPage",null),(0,r.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?this.draggedPage=(e=>{if(!e)return null;const t=e.dataset.dragPageId;if(!t)return null;const o=new lk(t);return{type:cu.Z.PAGE,content:o,representation:o.representation}})(e):null)),(0,r.Z)(this,"pointerSelect",(()=>null)),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"pointerUp",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>null))}});var dk,pk,uk,hk,mk,yk,gk,fk,bk,Ik,vk,wk,Nk,jk,Sk,Dk,Tk,Ok,Fk,Ck,Ek,xk,_k,Mk;function Pk(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}let Ak=(dk=(0,c.inject)("projectDoc"),pk=(0,c.inject)("projectUIState"),uk=(0,c.inject)("elementRefProvider"),hk=(0,c.inject)("nodeEditingFlow"),mk=(0,c.inject)("nodeSelectionFlow"),yk=class{constructor(e){var t,o,n,s;(0,i.Z)(this,"projectDoc",gk,this),(0,i.Z)(this,"projectUIState",fk,this),(0,i.Z)(this,"elementRefProvider",bk,this),(0,i.Z)(this,"nodeEditingFlow",Ik,this),(0,i.Z)(this,"nodeSelectionFlow",vk,this),(0,r.Z)(this,"nodeId",void 0),(0,r.Z)(this,"compInstanceId",void 0),(0,r.Z)(this,"existingNodeElements",[]),(0,r.Z)(this,"existingNodeInstances",[]),(0,r.Z)(this,"repres",null),(0,r.Z)(this,"nodePositionProperties",{}),(0,r.Z)(this,"inTreeview",void 0),(0,r.Z)(this,"isNew",!1),(0,r.Z)(this,"hierarchyType",cu.h.EXISTING),(0,r.Z)(this,"getParentOfNodeThatUsesHierarchyTextProp",(e=>{let t=e;for(let n=0;n<5;n++){var o;if(!t)return null;if(null!==(o=t)&&void 0!==o&&o.dataset.boundToPropId)return t;t=t.parentElement}return null}));const{compInstanceId:a,eventTarget:c}=e;let{nodeId:l}=e,d=!1;const p=this.getParentOfNodeThatUsesHierarchyTextProp(c);p&&(l=p.dataset.nodeId,d=!0);let u=this.projectDoc.nodes.getById(l);if(!u)throw new Error(`ExistingNodeHierarchy could not find the subhierarchy from which the drag started; nodeId: ${l}`);this.nodeId=a||l;const{slotId:h}=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(u.id);if(h&&a&&(this.nodeId=l,this.compInstanceId=a),!h&&a&&(u=this.projectDoc.nodes.getById(a)||u),this.inTreeview=!(null===c||void 0===c||!c.closest(".tree-view")),u.primitiveType===Zn.sO.SLOT&&null!==c&&void 0!==c&&c.dataset.compInstanceId)return;const m=this.nodeSelectionFlow.getSelectedNodesIds();let y,g;const f=m.every((e=>this.nodeEditingFlow.nodeIsRich({nodeId:e})));if(-1!==m.indexOf(this.nodeId)){const{primitiveType:e}=this.nodeEditingFlow.getCommonTypeForNodes(m);y=this.nodeEditingFlow.getElementIconPath(m),g=f?"Rich Text":e||"",m.forEach((e=>{const t=this.projectDoc.nodes.getById(e);if(!t)throw new Error(`ExistingNodeHierarchy could not find selected node with id: ${e}`);const o=this.projectDoc.nodes.getById(t.parentId||"");t.getNodeAllowedOps(o).move&&this.existingNodeElements.push(t)}))}else{const e=this.projectDoc.nodes.getById(u.parentId||"");if(!u.getNodeAllowedOps(e).move)return void(this.existingNodeElements=[]);g=f?"Rich Text":u.primitiveType||"",y=this.nodeEditingFlow.getElementIconPath([u.id]),this.existingNodeElements=[u]}const b=this.nodeSelectionFlow.getSelectedNodeInstanceIds();if(b.length){const e=b.filter((e=>{const t=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(e);return this.existingNodeElements.find((e=>e.id===t))}));this.existingNodeInstances=e}this.nodePositionProperties=(0,bP.tx)(this.existingNodeInstances,d?[e.nodeId]:this.existingNodeElements.map((e=>e.id)),this.elementRefProvider.getDomTargetNode)||{};const I=this.projectUIState.stage.webComp.controlValues.scale,v=null===(t=this.elementRefProvider.getIframeRef())||void 0===t||null===(o=t.current)||void 0===o?void 0:o.getBoundingClientRect(),w=null===v||void 0===v?void 0:v.y,N=null===v||void 0===v?void 0:v.x,j=((null===(n=this.projectUIState.drag.initialMousePosition)||void 0===n?void 0:n.y)-w)/I,S=((null===(s=this.projectUIState.drag.initialMousePosition)||void 0===s?void 0:s.x)-N)/I;this.nodePositionProperties.verticalOffset=this.inTreeview?0:j-this.nodePositionProperties.selectionTop,this.nodePositionProperties.horizontalOffset=this.inTreeview?0:S-this.nodePositionProperties.selectionLeft,this.inTreeview?y&&g&&(this.repres=(0,bP.H)(y,(0,ni.kC)(g))):this.repres=(0,bP.AM)(this.nodePositionProperties.width*I,this.nodePositionProperties.height*I)}get meta(){const{pressedKeys:e}=this.projectUIState.userInteractions,t=this.subHierarchy.length>1?"Clone nodes":"Clone node";return function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Pk(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Pk(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({nodeId:this.nodeId,compInstanceId:this.compInstanceId,message:e.alt?t:"",inTreeview:this.inTreeview},this.nodePositionProperties)}get subHierarchy(){return this.existingNodeElements}get subHierarchyNodeInstanceIds(){return this.existingNodeInstances}get representation(){return this.repres}},gk=(0,s.Z)(yk.prototype,"projectDoc",[dk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fk=(0,s.Z)(yk.prototype,"projectUIState",[pk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bk=(0,s.Z)(yk.prototype,"elementRefProvider",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ik=(0,s.Z)(yk.prototype,"nodeEditingFlow",[hk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vk=(0,s.Z)(yk.prototype,"nodeSelectionFlow",[mk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yk);wk=(0,c.provide)("dragExistingNodeFlow"),Nk=(0,c.inject)("projectDoc"),jk=(0,c.inject)("nodeSelectionFlow"),Sk=(0,c.inject)("stageScrollFlow"),Dk=(0,c.inject)("elementRefProvider"),Tk=(0,c.inject)("freestyleNodeFlow"),wk((Fk=class{constructor(){(0,i.Z)(this,"projectDoc",Ck,this),(0,i.Z)(this,"nodeSelectionFlow",Ek,this),(0,i.Z)(this,"stageScrollFlow",xk,this),(0,i.Z)(this,"elementRefProvider",_k,this),(0,i.Z)(this,"freestyleNodeFlow",Mk,this),(0,r.Z)(this,"draggedHierarchy",null),(0,r.Z)(this,"scrollTreeviewToNode",(e=>{const t=document.querySelector(`[data-node-id='${e}']`);if(t){t.scrollIntoView({block:"nearest",inline:"start"});const e=t.closest(".tree-view-wrapper");if(e)return e.scrollBy(-250,0),!0}return!1})),(0,r.Z)(this,"acceptDOMElement",(e=>{var t,o,n;if(!(e instanceof HTMLElement||e instanceof SVGElement)||(null===(t=e.parentElement)||void 0===t?void 0:t.tagName.toLowerCase())===Vr.rC||(null===(o=e.parentElement)||void 0===o?void 0:o.tagName.toLowerCase())===Vr.w5)return null;const i=(e=>{if(!e)return null;const{nodeId:t,compInstanceId:o}=(0,Mg.MT)({element:e})||{};if(!t)return null;const n=new Ak({nodeId:t,compInstanceId:o,eventTarget:e});return{type:cu.Z.SUB_HIERARCHY,content:n,representation:n.representation}})(e);return(null===i||void 0===i||null===(n=i.content.meta)||void 0===n?void 0:n.inTreeview)?this.draggedHierarchy=i:(this.draggedHierarchy=this.freestyleNodeFlow.startFreestyleDragFromEntity(i),this.draggedHierarchy)})),(0,r.Z)(this,"pointerSelect",(e=>{var t,o;const{ev:n,initialTarget:i}=e;if(!this.draggedHierarchy)return;const r=i||n.target;if(!r)return;const s=null===(t=this.draggedHierarchy)||void 0===t||null===(o=t.content.meta)||void 0===o?void 0:o.inTreeview,{nodeId:a,compInstanceId:c,nodeInstanceId:l,notSelectable:d}=(0,Mg.MT)({element:r})||{};if(!a||d)return;const p=this.projectDoc.nodes.getById(a||"");if(!p)return;let u=c;"component-instance-node"!==p.type||Object.keys(p.getDynamicProperties()).length||(u=p.id);const h=!!n&&(n.ctrlKey||n.metaKey),m=!!n&&n.shiftKey;h?this.nodeSelectionFlow.setNodeSelection({nodeId:a,nodeInstanceId:l,isMultiSelectMode:!0,compInstanceId:u}):m?this.nodeSelectionFlow.setNodeRangeSelection({nodeId:a,nodeInstanceId:l,compInstanceId:u}):this.nodeSelectionFlow.setNodeSelection({nodeId:a,isMultiSelectMode:!1,nodeInstanceId:l,compInstanceId:u}),s?this.stageScrollFlow.bringNodeIntoView({nodeId:a}):this.scrollTreeviewToNode(a)||setTimeout((()=>{this.scrollTreeviewToNode(a)}),200)})),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",vP()((()=>{this.freestyleNodeFlow.moveDraggedFreestyleNodes()}),ol.x1.SIXTY))}cleanUp(){var e,t;null===(e=this.draggedHierarchy)||void 0===e||e.content.subHierarchy.forEach((e=>{const t=this.elementRefProvider.getDomNodeElementRefById(e.id);null===t||void 0===t||t.style.removeProperty("opacity")})),null!==(t=this.draggedHierarchy)&&void 0!==t&&t.content.subHierarchyNodeInstanceIds&&this.draggedHierarchy.content.subHierarchyNodeInstanceIds.forEach((e=>{const t=this.elementRefProvider.getDomTargetNode({nodeInstanceId:e});null===t||void 0===t||t.style.removeProperty("opacity")})),this.draggedHierarchy=null,this.freestyleNodeFlow.cleanUpAfterFreestyleDrag()}pointerUp(e){var t;const{draggedEntityId:o,doc:n}=e;if(null===n||void 0===n||!n.nodes.getById(o||""))return;const{compInstanceId:i}=n.nodes.getSlotAndCompInstanceIdForNodeById(o||""),r=null===(t=this.draggedHierarchy)||void 0===t?void 0:t.content.subHierarchyNodeInstanceIds;if(null!==r&&void 0!==r&&r.length)this.nodeSelectionFlow.setMultipleNodeInstancesSelection(r,i);else{var s;const e=(null===(s=this.draggedHierarchy)||void 0===s?void 0:s.content.subHierarchy.map((e=>e.id)))||[];this.nodeSelectionFlow.setMultipleNodesSelection(e,i)}this.freestyleNodeFlow.endFreestyleDrag({doc:n})}},Ck=(0,s.Z)(Fk.prototype,"projectDoc",[Nk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ek=(0,s.Z)(Fk.prototype,"nodeSelectionFlow",[jk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xk=(0,s.Z)(Fk.prototype,"stageScrollFlow",[Sk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_k=(0,s.Z)(Fk.prototype,"elementRefProvider",[Dk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mk=(0,s.Z)(Fk.prototype,"freestyleNodeFlow",[Tk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(Fk.prototype,"pointerUp",[m.P],Object.getOwnPropertyDescriptor(Fk.prototype,"pointerUp"),Fk.prototype),Ok=Fk));var kk,Uk,Rk,Zk,Lk,$k,Bk,Gk,Hk,zk,Yk,Vk;let Wk=(kk=(0,c.inject)("projectDoc"),Uk=(0,c.inject)("projectUIState"),Rk=class{constructor(e){(0,i.Z)(this,"projectDoc",Zk,this),(0,i.Z)(this,"projectUIState",Lk,this),(0,r.Z)(this,"token",void 0),(0,r.Z)(this,"repres",{});const t=this.projectDoc.designLanguage.tokensById[e],o=this.projectDoc.designLanguage.textStyleSetsById[e],n=this.projectUIState.userPreferences.displayColorTokensAs;if(!t&&!o)throw new Error("Token non-existent");this.token=t||o,this.repres=t?"color"===t.type&&"grid"===n?(0,bP.Uz)(t):(0,bP.TU)(t):(0,bP.cq)(o)}get representation(){return this.repres}},Zk=(0,s.Z)(Rk.prototype,"projectDoc",[kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lk=(0,s.Z)(Rk.prototype,"projectUIState",[Uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rk);$k=(0,c.provide)("dragTokenFlow"),Bk=(0,c.inject)("projectDoc"),Gk=(0,c.inject)("sharedbProjectSyncService"),$k((zk=class{constructor(){(0,i.Z)(this,"projectDoc",Yk,this),(0,i.Z)(this,"dbSync",Vk,this),(0,r.Z)(this,"draggedToken",null),(0,r.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?(this.draggedToken=(e=>{if(!e)return null;const t=e.dataset.tokenId;if(!t)return null;const o=new Wk(t);return{type:"token",content:o,representation:o.representation}})(e),this.draggedToken):null)),(0,r.Z)(this,"pointerSelect",(()=>null)),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"pointerUp",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>{document.documentElement.style.cursor="default"}))}},Yk=(0,s.Z)(zk.prototype,"projectDoc",[Bk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vk=(0,s.Z)(zk.prototype,"dbSync",[Gk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hk=zk));var Kk,qk,Jk,Xk,Qk=o(658358);let eU=(Kk=(0,c.inject)("projectDoc"),qk=class{get sectionId(){return this.sectionTemplateId}get customCodeSnippet(){return this.sectionTemplateCode}constructor(e,t){(0,i.Z)(this,"projectDoc",Jk,this),(0,r.Z)(this,"sectionTemplateId",void 0),(0,r.Z)(this,"sectionTemplateCode",void 0),(0,r.Z)(this,"isNew",!0),this.sectionTemplateId=e,this.sectionTemplateCode=t}get representation(){return(0,F.jsx)("img",{style:{maxWidth:"350px"},src:(0,Qk.kn)(this.sectionTemplateId),alt:"Section Template"})}},Jk=(0,s.Z)(qk.prototype,"projectDoc",[Kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qk);(0,c.provide)("dragSectionTemplateFlow")(Xk=class{constructor(){(0,r.Z)(this,"draggedTemplate",null),(0,r.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?this.draggedTemplate=(e=>{if(!e)return null;const t=e.dataset.dragSectionTemplateId,o=e.dataset.dragSectionTemplateCode?JSON.parse(e.dataset.dragSectionTemplateCode):void 0;if(!t)return null;const n=new eU(t,o);return{type:cu.Z.SECTION_TEMPLATE,content:n,representation:n.representation}})(e):null)),(0,r.Z)(this,"pointerSelect",(()=>{var e;y.Z.mixpanelEvent(y.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_SECTIONS_TAB_SECTION_CLICK,{elementType:null===(e=this.draggedTemplate)||void 0===e?void 0:e.type})})),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"pointerUp",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>null))}});var tU,oU,nU,iU,rU,sU,aU,cU;let lU=(tU=(0,c.inject)("projectDoc"),oU=class{constructor(e,t){(0,i.Z)(this,"projectDoc",nU,this),(0,r.Z)(this,"file",void 0),(0,r.Z)(this,"filePath",void 0),(0,r.Z)(this,"draggingForbidden",void 0),(0,r.Z)(this,"repres",{}),this.filePath=e,this.file=this.projectDoc.projectFiles.local[t].byId[e],this.draggingForbidden=(0,bP.AS)(e),this.repres=(0,bP.ML)(e)}get representation(){return this.repres}},nU=(0,s.Z)(oU.prototype,"projectDoc",[tU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oU);iU=(0,c.provide)("devFileDragFlow"),rU=(0,c.inject)("projectUIState"),iU((aU=class{constructor(){(0,r.Z)(this,"draggedToken",null),(0,i.Z)(this,"projectUIState",cU,this),(0,r.Z)(this,"acceptDOMElement",(e=>{if(!(e instanceof HTMLElement))return null;const t=this.projectUIState.devMode.selectedBranch;return this.draggedToken=((e,t)=>{if(!t)return null;if(t.dataset.projectFiles)return null;const o=t.dataset.fileId;if(!o)return null;const n=new lU(o,e);return{type:cu.Z.FILE,content:n,representation:n.representation}})(t,e),this.draggedToken})),(0,r.Z)(this,"pointerSelect",(()=>null)),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"pointerUp",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>{document.documentElement.style.cursor="default"}))}},cU=(0,s.Z)(aU.prototype,"projectUIState",[rU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sU=aU));var dU,pU,uU,hU,mU,yU,gU,fU,bU,IU,vU,wU;let NU=(dU=(0,c.inject)("projectUIState"),pU=(0,c.inject)("assetFoldersFlow"),uU=class{constructor(){(0,i.Z)(this,"projectUIState",hU,this),(0,i.Z)(this,"assetFoldersFlow",mU,this),(0,r.Z)(this,"firstEntity",void 0),(0,r.Z)(this,"selectedAssetIds",void 0),(0,r.Z)(this,"selectedFolderIds",void 0),(0,r.Z)(this,"draggingForbidden",void 0),(0,r.Z)(this,"repres",{}),this.firstEntity=this.assetFoldersFlow.getFirstFromSelectedEntities(),this.selectedAssetIds=Object.keys(this.projectUIState.assetsList.selected.entities),this.selectedFolderIds=Object.keys(this.projectUIState.folders.selected.entities),this.draggingForbidden=(0,bP.wp)(this.selectedFolderIds),this.repres=(0,bP.d1)(this.firstEntity,this.selectedFolderIds,this.selectedAssetIds)}get representation(){return this.repres}},hU=(0,s.Z)(uU.prototype,"projectUIState",[dU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mU=(0,s.Z)(uU.prototype,"assetFoldersFlow",[pU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uU);yU=(0,c.provide)("dragAssetFolderFlow"),gU=(0,c.inject)("notificationsManagementFlow"),fU=(0,c.inject)("assetFoldersFlow"),yU((IU=class{constructor(){(0,r.Z)(this,"draggedAssetFolders",null),(0,i.Z)(this,"notificationsManagementFlow",vU,this),(0,i.Z)(this,"assetFoldersFlow",wU,this),(0,r.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?(this.draggedAssetFolders=(e=>{if(!e)return null;if(!e.dataset.assetFolderId)return null;if(!e.dataset.dragName)return null;const t=new NU;return{type:cu.Z.ASSET_FOLDER,content:t,representation:t.representation}})(e),this.draggedAssetFolders):null)),(0,r.Z)(this,"pointerSelect",(e=>{var t;const{initialTarget:o}=e,n=o.closest("[data-asset-folder-id]"),i=n.dataset.assetFolderId;if(!i)return;const r=n.dataset.assetLocation||null,s=o.closest("[data-asset-id]"),a=null===s||void 0===s||null===(t=s.dataset)||void 0===t?void 0:t.assetId,c=!!o.closest(".folder-options-button"),l=!!o.closest(".asset-options-button");this.assetFoldersFlow.applySelectionRules(r,i,c,a,l)})),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"pointerUp",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>{document.documentElement.style.cursor="default"}))}},vU=(0,s.Z)(IU.prototype,"notificationsManagementFlow",[gU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wU=(0,s.Z)(IU.prototype,"assetFoldersFlow",[fU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bU=IU));var jU,SU,DU,TU,OU,FU,CU,EU,xU;class _U{constructor(e,t){(0,r.Z)(this,"interactiveElementId",void 0),(0,r.Z)(this,"interactiveElementCode",void 0),(0,r.Z)(this,"isNew",!0),this.interactiveElementId=e,this.interactiveElementCode=t}get elementId(){return this.interactiveElementId}get elementCode(){return this.interactiveElementCode}get representation(){return(0,bP.H)(yl.YN[`thq-${this.interactiveElementId}`],(0,ni.kC)(this.interactiveElementId))}}jU=(0,c.provide)("dragInteractiveElementFlow"),SU=(0,c.inject)("projectDoc"),DU=(0,c.inject)("nodeManagementFlow"),TU=(0,c.inject)("nodeSelectionFlow"),jU((FU=class{constructor(){(0,i.Z)(this,"projectDoc",CU,this),(0,i.Z)(this,"nodeManagementFlow",EU,this),(0,i.Z)(this,"nodeSelectionFlow",xU,this),(0,r.Z)(this,"draggedInteractiveElement",null),(0,r.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?this.draggedInteractiveElement=(e=>{if(!e||!Object.keys(e.dataset).length)return null;const t=e.dataset.dragInteractiveElementId,o=e.dataset.dragInteractiveElementCode?JSON.parse(e.dataset.dragInteractiveElementCode):void 0;if(!t)return null;const n=new _U(t,o);return{type:cu.Z.INTERACTIVE_ELEMENT,content:n,representation:n.representation}})(e):null)),(0,r.Z)(this,"pointerSelect",(()=>null)),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"pointerUp",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>null))}},CU=(0,s.Z)(FU.prototype,"projectDoc",[SU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EU=(0,s.Z)(FU.prototype,"nodeManagementFlow",[DU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xU=(0,s.Z)(FU.prototype,"nodeSelectionFlow",[TU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OU=FU));var MU,PU,AU,kU,UU,RU,ZU,LU,$U,BU,GU,HU,zU,YU;let VU=(MU=(0,c.inject)("projectUIState"),PU=(0,c.inject)("projectDoc"),AU=(0,c.inject)("folderManagementFlow"),kU=class{constructor(e){(0,i.Z)(this,"projectUIState",UU,this),(0,i.Z)(this,"projectDoc",RU,this),(0,i.Z)(this,"folderManagementFlow",ZU,this),(0,r.Z)(this,"entity",void 0),(0,r.Z)(this,"draggingForbidden",void 0),(0,r.Z)(this,"repres",{});const t=this.projectDoc.folders.byId[e];if(!t)throw new Error(`Could not construct folder drag entity. Folder ${e} is missing.`);this.entity={id:t.id,name:t.name,icon:_m.TV.folder},this.draggingForbidden=t.id===ut.D.PAGES||t.id===ut.D.COMPONENTS,this.repres=(0,bP.ru)(this.entity)}get representation(){return this.repres}},UU=(0,s.Z)(kU.prototype,"projectUIState",[MU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RU=(0,s.Z)(kU.prototype,"projectDoc",[PU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZU=(0,s.Z)(kU.prototype,"folderManagementFlow",[AU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kU);LU=(0,c.provide)("dragFolderFlow"),$U=(0,c.inject)("notificationsManagementFlow"),BU=(0,c.inject)("folderManagementFlow"),LU((HU=class{constructor(){(0,r.Z)(this,"draggedFolder",null),(0,i.Z)(this,"notificationsManagementFlow",zU,this),(0,i.Z)(this,"folderManagementFlow",YU,this),(0,r.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?(this.draggedFolder=(e=>{if(!e)return null;const t=e.dataset.dragName,o=e.dataset.folderId;if(!t||!o)return null;const n=new VU(o);return{type:cu.Z.FOLDER,content:n,representation:n.representation}})(e),this.draggedFolder):null)),(0,r.Z)(this,"pointerSelect",(e=>{const{initialTarget:t,ev:o}=e;o.stopPropagation();const n=t.closest("[data-folder-id]").dataset.folderId;if(!n)return;this.folderManagementFlow.deselectAllFolders(),this.folderManagementFlow.selectFolder(n,"files-sidebar");if(0===this.folderManagementFlow.getPageOrCompChildrenOfFolderInAlphabethicalOrder(n).length&&0===this.folderManagementFlow.getChildFoldersOfFolder(n).length)return;o.target.closest("[data-extra-actions]")||this.folderManagementFlow.toggleFolderExpandStatus(n)})),(0,r.Z)(this,"pointerDown",(()=>null)),(0,r.Z)(this,"pointerMove",(()=>null)),(0,r.Z)(this,"pointerUp",(()=>null)),(0,r.Z)(this,"cleanUp",(()=>{document.documentElement.style.cursor="default"}))}},zU=(0,s.Z)(HU.prototype,"notificationsManagementFlow",[$U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YU=(0,s.Z)(HU.prototype,"folderManagementFlow",[BU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GU=HU));var WU,KU,qU,JU,XU,QU,eR,tR,oR,nR,iR,rR,sR,aR=o(330058);const cR=[cu.Z.SUB_HIERARCHY,cu.Z.SECTION_TEMPLATE,cu.Z.INTERACTIVE_ELEMENT];WU=(0,c.provide)("dropIntoTreeViewFlow"),KU=(0,c.inject)("projectDoc"),qU=(0,c.inject)("projectUIState"),JU=(0,c.inject)("nodeManagementFlow"),XU=(0,c.inject)("nodeStyleManagmentFlow"),QU=(0,c.inject)("componentManagementFlow"),WU((tR=class{constructor(){(0,i.Z)(this,"projectDoc",oR,this),(0,i.Z)(this,"projectUIState",nR,this),(0,i.Z)(this,"nodeManagementFlow",iR,this),(0,i.Z)(this,"nodeStyleManagementFlow",rR,this),(0,i.Z)(this,"componentManagementFlow",sR,this),(0,r.Z)(this,"moveOver",vP()((e=>{const{draggedEntity:t,ev:o,position:n}=e;return this.handleMouseOverTreeView(t,o,n)}),ol.x1.HUNDRED_FORTY_FOUR)),this.resetState()}resetState(){(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.treeView.acceptedDropTarget=null,e.dropFlowStates.treeView.dropAnchor=null,e.dropFlowStates.treeView.dropAllowed=!0}))}handleDraggedEntity(e){return cR.includes(e.type)}acceptsDOMElement(e){var t,o;if(!(e instanceof HTMLElement))return!1;const n=e.closest("[data-tree-view=true]"),i=this.projectUIState.selection.componentId,r=e.closest("[data-node-id");let s=r;if(!n||!i)return!1;const c=null===(t=this.projectUIState.dropFlowStates.treeView.acceptedDropTarget)||void 0===t?void 0:t.uidlNode;let l;if(null!==r&&void 0!==r&&null!==(o=r.dataset)&&void 0!==o&&o.nodeId)l=this.projectDoc.nodes.getById(r.dataset.nodeId);else{const e=this.projectDoc.getRootNodeIdForPageOrComponent(i);e&&(l=this.projectDoc.nodes.getById(e),s=n.querySelector(`[data-node-id="${e}"]`))}if(!l||!s)return!1;let d=null;return c&&c.id!==l.id&&c.getActualParentId()===l.getActualParentId()&&(d=parseFloat(c.pos)>parseFloat(l.pos)?"before":"after"),(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.treeView.acceptedDropTarget={domNode:s,uidlNode:l},d&&(e.dropFlowStates.treeView.dropAnchor=d)})),!0}handleMouseOverTreeView(e,t,o){var n;const i=this.projectUIState.dropFlowStates.treeView.acceptedDropTarget;if(!i)return;const r=this.projectUIState.selection.componentId;if(!r)return;const s=this.projectDoc.getProjectPageOrComponent(r);if((null===s||void 0===s?void 0:s.rootNodeId)===i.uidlNode.id)return void(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.treeView.dropAnchor="inside-after",e.dropFlowStates.treeView.dropAllowed=!0}));if(e.type!==cu.Z.SUB_HIERARCHY)return;const{domNode:c,uidlNode:l}=i,d=c.dataset.compInstanceId,p=this.projectDoc.nodes.getById(l.getActualParentId(d)),u=c.getBoundingClientRect();let h="after";c.dataset.fakeTreeviewElem||(h=(0,bP.S3)(o,u));(null===(n=this.projectUIState.selection.expandedTreeNodes[d||""])||void 0===n?void 0:n[l.id])&&"after"===h&&!c.dataset.fakeTreeviewElem&&(h="inside-after");let m=!0;for(const f of e.content.subHierarchy){var y;const e=this.nodeHasButtonParent(l);var g;if(e&&f.primitiveType&&!this.projectDoc.isNodeAcceptingChild({node:e,child:f}))return h=-1!==(null===(g=h)||void 0===g?void 0:g.indexOf("after"))?"after":"before",void(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.treeView.dropAnchor=h,e.dropFlowStates.treeView.dropAllowed=!1}));const t=-1!==(null===(y=h)||void 0===y?void 0:y.indexOf("inside"))?l:p;m=m&&!this.projectDoc.nodes.getAncestors({nodeId:(null===t||void 0===t?void 0:t.id)||"",includeSlottedNodes:!0,initialCompInstanceId:d}).includes(f.id);if(f.primitiveType&&(!this.projectDoc.isNodeAcceptingChild({node:t,child:f})||l.primitiveType===Zn.sO.SLOT&&!c.dataset.compInstanceId))return void(0,a.mutate)(this.projectUIState,(e=>{var t;if(p&&f.primitiveType){if(-1!==(null===(t=h)||void 0===t?void 0:t.indexOf("inside"))){var o;const t=this.projectDoc.isNodeAcceptingChildren(l);return h=t?h:-1!==(null===(o=h)||void 0===o?void 0:o.indexOf("after"))?"after":"before",e.dropFlowStates.treeView.dropAllowed=!t&&(m&&this.projectDoc.isNodeAcceptingChild({node:p,child:f})),void(e.dropFlowStates.treeView.dropAnchor=h)}e.dropFlowStates.treeView.dropAnchor=h,e.dropFlowStates.treeView.dropAllowed=m&&this.projectDoc.isNodeAcceptingChild({node:p,child:f})}else e.dropFlowStates.treeView.dropAllowed=!1}))}(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.treeView.dropAnchor=h,e.dropFlowStates.treeView.dropAllowed=m}))}moveOut(){this.resetState()}handleDrop(e){const t=this.projectUIState.selection.componentId,{dropAnchor:o,acceptedDropTarget:n,dropAllowed:i}=this.projectUIState.dropFlowStates.treeView;if(!n||!o||!t||!i)return!1;const{doc:r}=e;if(!r)return!1;const s=e.draggedEntity;if(!this.projectDoc.getProjectPageOrComponent(t))throw new Error(`Attempted to insert new component instance into a component\n          that does not exist or is not active ${t}`);if(s.type===cu.Z.SUB_HIERARCHY){var a;const e=null===(a=this.projectUIState.dropFlowStates.treeView.acceptedDropTarget)||void 0===a?void 0:a.uidlNode,t=this.nodeHasButtonParent(e);for(const o of s.content.subHierarchy)if(t&&o.primitiveType&&!r.isNodeAcceptingChild({node:t,child:o}))return!1;-1===o.indexOf("inside")||(null===e||void 0===e?void 0:e.primitiveType)!==Zn.sO.BUTTON||Object.keys(e.childrenIds).length||this.nodeStyleManagementFlow.setMultipleStylesByKeyForCurrentBreakpoint({nodeIds:[e.id],styleMap:{[$r.X7.DISPLAY]:{value:$r.r3.FLEX},[$r.X7.FLEX_DIRECTION]:{value:aR.aF.ROW}},doc:r})}return-1!==o.indexOf("inside")?this.handleDropInside({draggedEntity:s,doc:r}):this.handleDropAsSibling({position:o,draggedEntity:s,doc:r}),this.resetState(),!0}handleDropAsSibling(e){var t;const{draggedEntity:o,position:n,doc:i}=e,r=this.projectUIState.dropFlowStates.treeView.acceptedDropTarget,s=null===r||void 0===r||null===(t=r.uidlNode)||void 0===t?void 0:t.getActualParentId();if(!r||!s)return;const a=(0,Mg.MT)({element:r.domNode}),c=null===a||void 0===a?void 0:a.compInstanceId;let l=r.uidlNode;if(-1!==n.indexOf("after")&&(l=this.projectDoc.nodes.getNextSibling(r.uidlNode)),o.type===cu.Z.INTERACTIVE_ELEMENT)return void this.handleDropSectionTemplate({nextNode:l,sectionId:o.content.elementId,customCodeSnippet:o.content.elementCode,targetId:s,compInstanceId:c,doc:i});if(o.type===cu.Z.SECTION_TEMPLATE)return void this.handleDropSectionTemplate({nextNode:l,sectionId:o.content.sectionId,customCodeSnippet:o.content.customCodeSnippet,targetId:s,compInstanceId:c,doc:i});const{content:d}=o;d.isNew?this.handleDropNewInstances({draggedContent:d,parentId:s,nextNode:l,compInstanceId:c,doc:i}):this.handleDropExistingInstances({draggedContent:d,targetId:s,nextNode:l,compInstanceId:c,doc:i})}handleDropInside(e){const t=this.projectUIState.dropFlowStates.treeView.acceptedDropTarget;if(!t)return;const{draggedEntity:o,doc:n}=e;let i;if(t.domNode){const e=(0,Mg.MT)({element:t.domNode});i=null===e||void 0===e?void 0:e.compInstanceId}if(o.type===cu.Z.INTERACTIVE_ELEMENT)return void this.handleDropSectionTemplate({sectionId:o.content.elementId,customCodeSnippet:o.content.elementCode,targetId:t.uidlNode.id,compInstanceId:i,doc:n});if(o.type===cu.Z.SECTION_TEMPLATE)return void this.handleDropSectionTemplate({sectionId:o.content.sectionId,customCodeSnippet:o.content.customCodeSnippet,targetId:t.uidlNode.id,compInstanceId:i,doc:n});const r=o.content;r.isNew?this.handleDropNewInstances({draggedContent:r,parentId:t.uidlNode.id,compInstanceId:i,doc:n}):this.handleDropExistingInstances({draggedContent:r,targetId:t.uidlNode.id,compInstanceId:i,doc:n})}handleDropSectionTemplate(e){const{sectionId:t,customCodeSnippet:o,targetId:n,nextNode:i,compInstanceId:r,doc:s}=e;this.componentManagementFlow.importSectionComponent({sectionId:t,customCodeSnippet:o,targetId:n,nextSibling:i,compInstanceId:r,doc:s})}targetIsChildlessButton(e){const t=this.projectDoc.nodes.getById(e);return(null===t||void 0===t?void 0:t.primitiveType)===Zn.sO.BUTTON&&"childrenIds"in t&&!Object.keys(t.childrenIds||{}).length}handleDropExistingInstances(e){const{draggedContent:t,targetId:o,nextNode:n,doc:i,compInstanceId:r}=e;this.nodeManagementFlow.moveNodesToTarget({nodes:t.subHierarchy,targetId:o,nextSibling:n,useContentAsNode:this.targetIsChildlessButton(o),targetCompInstanceId:r,doc:i})}handleDropNewInstances(e){var t;const{draggedContent:o,parentId:n,nextNode:i,doc:r,compInstanceId:s}=e,a={nodes:o.subHierarchy,nextSibling:i,keepOriginalParent:(null===(t=o.meta)||void 0===t?void 0:t.nodeType)===Zn.sO.ICON,compInstanceId:s,parentId:n,doc:r};o.subHierarchy[0].primitiveType!==Zn.sO.HTML_NODE?this.nodeManagementFlow.addNodesToParentOrStage(a):this.nodeManagementFlow.addCodeEmbedNodeToSelNode(a)}nodeHasButtonParent(e){if(!e)return null;if(e.primitiveType===Zn.sO.BUTTON)return null;let t=e,o=null,n=!1;for(;null!==(i=t)&&void 0!==i&&i.parentId&&!o&&!n;){var i;if(t.primitiveType!==Zn.sO.BUTTON)if(t.primitiveType!==Zn.sO.CONTAINER){if(t=this.projectDoc.nodes.getById(t.parentId),!t)return null}else n=!0;else o=t}return o}},oR=(0,s.Z)(tR.prototype,"projectDoc",[KU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nR=(0,s.Z)(tR.prototype,"projectUIState",[qU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iR=(0,s.Z)(tR.prototype,"nodeManagementFlow",[JU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rR=(0,s.Z)(tR.prototype,"nodeStyleManagementFlow",[XU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sR=(0,s.Z)(tR.prototype,"componentManagementFlow",[QU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(tR.prototype,"handleDrop",[m.P],Object.getOwnPropertyDescriptor(tR.prototype,"handleDrop"),tR.prototype),(0,s.Z)(tR.prototype,"handleDropAsSibling",[m.P],Object.getOwnPropertyDescriptor(tR.prototype,"handleDropAsSibling"),tR.prototype),(0,s.Z)(tR.prototype,"handleDropInside",[m.P],Object.getOwnPropertyDescriptor(tR.prototype,"handleDropInside"),tR.prototype),(0,s.Z)(tR.prototype,"handleDropSectionTemplate",[m.P],Object.getOwnPropertyDescriptor(tR.prototype,"handleDropSectionTemplate"),tR.prototype),(0,s.Z)(tR.prototype,"handleDropExistingInstances",[m.P],Object.getOwnPropertyDescriptor(tR.prototype,"handleDropExistingInstances"),tR.prototype),(0,s.Z)(tR.prototype,"handleDropNewInstances",[m.P],Object.getOwnPropertyDescriptor(tR.prototype,"handleDropNewInstances"),tR.prototype),eR=tR));var lR,dR,pR,uR,hR,mR,yR,gR,fR,bR,IR,vR,wR,NR,jR,SR,DR,TR,OR;function FR(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function CR(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?FR(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):FR(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const ER=["flex","block","inline","inline-block","inherit"];let xR=(lR=(0,c.inject)("projectDoc"),dR=(0,c.inject)("projectUIState"),pR=(0,c.inject)("dropElementHelper"),uR=(0,c.inject)("notificationsManagementFlow"),hR=(0,c.inject)("guardsService"),mR=(0,c.inject)("componentManagementFlow"),yR=(0,c.inject)("dropSimulatorFlow"),gR=(0,c.inject)("nodeStyleManagmentFlow"),fR=(0,c.inject)("nodeManagementFlow"),bR=class{constructor(){(0,i.Z)(this,"projectDoc",IR,this),(0,i.Z)(this,"projectUIState",vR,this),(0,i.Z)(this,"dropElementHelper",wR,this),(0,i.Z)(this,"notificationsManagementFlow",NR,this),(0,i.Z)(this,"guardsService",jR,this),(0,i.Z)(this,"componentManagementFlow",SR,this),(0,i.Z)(this,"dropSimulatorFlow",DR,this),(0,i.Z)(this,"nodeStyleManagementFlow",TR,this),(0,i.Z)(this,"nodeManagementFlow",OR,this),(0,r.Z)(this,"lastHoveredNode",null),(0,r.Z)(this,"acceptingDropTarget",null),(0,r.Z)(this,"elementChildrenOfCurrentTarget",[]),(0,r.Z)(this,"lastAltState",!1),(0,r.Z)(this,"lastCtrlState",!1),(0,r.Z)(this,"timeout",null),(0,r.Z)(this,"lastMovedAt",null),(0,r.Z)(this,"handleMouseOverContainerWithChildren",(e=>{var t;const{stateAccessor:o,target:n,position:i,draggedEntity:r}=e;if(!this.acceptingDropTarget)return;const{domNode:s,uidlNode:c}=this.acceptingDropTarget,l=s.getBoundingClientRect(),d=this.elementChildrenOfCurrentTarget.map((e=>e.getBoundingClientRect())),p=this.elementChildrenOfCurrentTarget.map((e=>(0,ni.AO)(e))),u=n.getBoundingClientRect(),h=this.projectUIState.stage.webComp.controlValues.scale;let m;if("flexContainer"===o&&(m=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(c.id,["flexDirection"]).flexDirection||"row"),"slot"===o){const e=this.projectDoc.nodes.getById(c.parentId||"");e&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:$r.X7.DISPLAY,values:["flex","inline-flex"]})&&(m=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(e.id,["flexDirection"]).flexDirection||"row")}const{targetPointIdx:y,edgeData:g}=(0,bP.jV)(i,d,p,u,h,m);if(-1===y)return;if(!g.inside){const e=(0,bP.$p)(i,l,u,h);if(e&&c.primitiveType!==Zn.sO.SLOT)return void this.dropElementHelper.handleMouseCloseToTargetEdge(e,o,this.acceptingDropTarget)}const f=this.projectUIState.dropFlowStates[o],b=f.childAnchoringDrop,I=this.elementChildrenOfCurrentTarget[y],{compInstanceId:v,nodeId:w,nodeInstanceId:N,slotId:j}=I.dataset,S=j?this.projectDoc.nodes.getById(w||""):this.projectDoc.nodes.getById(v||w||"");if(S){if("flexContainer"===o){const e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(this.acceptingDropTarget.uidlNode.id,["flexDirection"]);if("column"!==e.flexDirection&&(g.inside||g.distance.vertical>75)){const{left:e,right:t}=g.distance;g.edge=e<t?"left":"right"}if("column"===e.flexDirection&&(g.inside||g.distance.horizontal>75)){const{top:e,bottom:t}=g.distance;g.edge=e<t?"top":"bottom"}}(null===(t=f.acceptedDropTarget)||void 0===t?void 0:t.uidlNode.id)===this.acceptingDropTarget.uidlNode.id&&(null===b||void 0===b?void 0:b.domNode)===I&&b.edgeData.edge===g.edge&&b.edgeData.inside===g.inside&&b.uidlNode.id===S.id&&null===f.dropPosition&&null===f.dropOutsideTarget||(0,a.mutate)(this.projectUIState,(e=>{var t;e.dropFlowStates[o].acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates[o].newWrapperFlexDirection=this.dropElementHelper.getNewWrapperFlexDirection(o,g,null===(t=this.acceptingDropTarget)||void 0===t?void 0:t.uidlNode,S,r),e.dropFlowStates[o].childAnchoringDrop={domNode:I,uidlNode:S,nodeInstanceId:N,edgeData:g},e.dropFlowStates[o].dropPosition=null,e.dropFlowStates[o].dropOutsideTarget=null}))}})),(0,r.Z)(this,"handleMouseOverChildlessContainer",(e=>{var t;const{stateAccessor:o,position:n,target:i}=e;if(!this.acceptingDropTarget)return;const{domNode:r,uidlNode:s}=this.acceptingDropTarget;if(!r)return;const c=i.getBoundingClientRect(),l=r.getBoundingClientRect(),d=(0,ni.AO)(r),p=this.projectUIState.stage.webComp.controlValues.scale*d,u=(0,bP.$p)(n,l,c,p);if(u&&s.primitiveType!==Zn.sO.SLOT)return void this.dropElementHelper.handleMouseCloseToTargetEdge(u,o,this.acceptingDropTarget);let h=null;if("flexContainer"===o){const e=this.projectUIState.drag.draggedEntity;let t=0,o=0;var m,y;if((null===e||void 0===e?void 0:e.type)===cu.Z.SUB_HIERARCHY&&!e.content.isNew)t=null===(m=e.content.meta)||void 0===m?void 0:m.width,o=null===(y=e.content.meta)||void 0===y?void 0:y.height;h=(0,bP.y9)(n,l,c,p,t,o)}const g=this.projectUIState.dropFlowStates[o];(null===(t=g.acceptedDropTarget)||void 0===t?void 0:t.uidlNode.id)===this.acceptingDropTarget.uidlNode.id&&g.dropPosition===h&&null===g.childAnchoringDrop&&null===g.dropOutsideTarget||(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates[o].acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates[o].dropPosition=h||"top-left",e.dropFlowStates[o].newWrapperFlexDirection=null,e.dropFlowStates[o].childAnchoringDrop=null,e.dropFlowStates[o].dropOutsideTarget=null}))}))}resetUIStateState(e){this.guardsService.getGuard(QI._.VIRTUAL_WORK)||(this.timeout&&clearTimeout(this.timeout),(0,a.mutate)(this.projectUIState,(t=>{t.dropFlowStates[e].acceptedDropTarget=null,t.dropFlowStates[e].childAnchoringDrop=null,t.dropFlowStates[e].newWrapperFlexDirection=null,t.dropFlowStates[e].dropPosition=null,t.dropFlowStates[e].dropOutsideTarget=null,t.dropFlowStates[e].dropIsDisabled=!1})),this.lastHoveredNode=null,this.elementChildrenOfCurrentTarget=[],this.lastAltState=!1,this.lastCtrlState=!1,this.lastMovedAt=null)}handleDraggedEntity(e){return e.type===cu.Z.SUB_HIERARCHY||e.type===cu.Z.SECTION_TEMPLATE||e.type===cu.Z.INTERACTIVE_ELEMENT}checkIfElementIsAccepted(e,t,o,n,i){var r;if(!i||!((null===i||void 0===i?void 0:i.target)instanceof HTMLIFrameElement))return this.acceptingDropTarget=null,!1;if(!(e instanceof HTMLElement))return this.acceptingDropTarget=null,!1;if(e.dataset.notInteractive)return this.acceptingDropTarget=null,!1;const s=e.dataset.slotId?e.dataset.nodeId:e.dataset.compInstanceId||e.dataset.nodeId;if(!s)return this.acceptingDropTarget=null,!1;const a=!!this.projectUIState.userInteractions.pressedKeys.ctrl;if((null===(r=this.acceptingDropTarget)||void 0===r?void 0:r.uidlNode.id)===s&&this.lastCtrlState===a)return this.acceptingDropTarget={domNode:e,uidlNode:this.acceptingDropTarget.uidlNode},!0;this.lastCtrlState=a;const c=this.projectDoc.nodes.getById(s);if(!c)return this.acceptingDropTarget=null,!1;if(!a&&null!==c&&void 0!==c&&c.getActualParentId()&&this.dropElementHelper.elementSmallerOrSibling(e,s))return this.acceptingDropTarget=null,!1;return this.nodeDataAcceptedForContainer(c,e,t,a)?(this.acceptingDropTarget={domNode:e,uidlNode:c},!0):(this.acceptingDropTarget=null,!1)}nodeIsContainerType(e){return e.primitiveType===Zn.sO.CONTAINER||e.primitiveType===Zn.sO.FORM||e.primitiveType===Zn.sO.FRAGMENT||e.primitiveType===Zn.Pu.CMS_PAGINATION_NODE||e.primitiveType===Zn.Pu.CMS_NAVIGATION_BUTTON||Object.values(Zn.IV).includes(e.primitiveType)}nodeDataAcceptedForContainer(e,t,o,n){if(e.primitiveType===Zn.sO.SLOT&&!t.dataset.compInstanceId)return!1;const i=this.projectUIState.drag.draggedEntity;let r=!0;switch((null===i||void 0===i?void 0:i.type)===cu.Z.SUB_HIERARCHY&&(r=i.content.subHierarchy.every((t=>{if(e.primitiveType===Zn.sO.IMAGE){const o=CR(CR({},e),{},{primitiveType:Zn.sO.CONTAINER});return this.projectDoc.isNodeAcceptingChild({node:o,child:t})}return this.projectDoc.isNodeAcceptingChild({node:e,child:t})}))),o){case"flexContainer":const t=this.projectDoc.nodes.getById(e.parentId||"");return r&&(e.primitiveType===Zn.sO.IMAGE&&n&&(null===t||void 0===t?void 0:t.primitiveType)!==Zn.sO.BUTTON||this.nodeIsContainerType(e)&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:$r.X7.DISPLAY,values:["flex","inline-flex"]}));case"blockInlineContainer":return this.nodeIsContainerType(e)&&r&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:$r.X7.DISPLAY,values:["block","inline-block","inline"]});case"unknownContainer":return!((null===e||void 0===e?void 0:e.primitiveType)===Zn.sO.LISTITEM&&!this.projectUIState.userInteractions.pressedKeys.ctrl)&&((this.nodeIsContainerType(e)||(null===e||void 0===e?void 0:e.primitiveType)===Zn.sO.LISTITEM)&&r&&!this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:$r.X7.DISPLAY,values:ER}));case"slot":return((null===e||void 0===e?void 0:e.primitiveType)===Zn.sO.SLOT||e.primitiveType===Zn.sO.CMS_COLLECTION_ITEM||e.primitiveType===Zn.sO.CMS_COLLECTION_LIST)&&r;default:return!1}}handleDropIntoContainer(e){const{draggedEntity:t,dropIntoChildlessContainerCallback:o,dropIntoContainerWithChildrenCallback:n,stateAccessor:i,isVirtual:r,doc:s}=e,{dropPosition:a,acceptedDropTarget:c,dropOutsideTarget:l,childAnchoringDrop:d,dropIsDisabled:p}=this.projectUIState.dropFlowStates[i],u=this.projectUIState.selection.componentId;if(!c||!u||p)return!1;if(t.type!==cu.Z.SUB_HIERARCHY&&t.type!==cu.Z.SECTION_TEMPLATE&&t.type!==cu.Z.INTERACTIVE_ELEMENT)return!1;return!this.dropElementHelper.checkForCircularDependencies(t,u)&&(a&&!l?o({draggedEntity:t,isVirtual:r,doc:s}):!!d&&n({draggedEntity:t,isVirtual:r,doc:s}))}handleMoveOut(e){this.timeout&&clearTimeout(this.timeout),this.resetUIStateState(e)}handleMoveOver(e){const t=this.projectUIState.drag.currentMousePosition,o=this.projectUIState.stage.webComp.controlValues.scale;this.lastMovedAt&&t&&!(0,bP.NN)(this.lastMovedAt,t,10/o)&&!e.forced||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.moveOverHandler(e)),ol.vL))}moveOverHandler(e){var t;this.timeout=null,this.lastMovedAt=this.projectUIState.drag.currentMousePosition;const{draggedEntity:o,stateAccessor:n,customEv:i,position:r}=e;if(!this.acceptingDropTarget||!i||!(i.target instanceof HTMLIFrameElement))return;const{domNode:s,uidlNode:c}=this.acceptingDropTarget,{pressedKeys:l}=this.projectUIState.userInteractions;if(s){if((null===(t=this.lastHoveredNode)||void 0===t?void 0:t.id)!==c.id||this.lastAltState!==l.alt){const e=o.type===cu.Z.SUB_HIERARCHY?o.content.subHierarchy:[];this.elementChildrenOfCurrentTarget=this.dropElementHelper.processElementChildren(s.children,e),this.lastHoveredNode=c,this.lastAltState=l.alt||!1,(0,a.mutate)(this.projectUIState,(e=>e.dropFlowStates[n].dropIsDisabled=!1))}if(!l.alt&&o.type===cu.Z.SUB_HIERARCHY)for(const e of o.content.subHierarchy)if(e.id===c.id||this.projectDoc.nodes.getDescendents(e.id).find((e=>e.id===c.id)))return void(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates[n].dropIsDisabled=!0}));return this.elementChildrenOfCurrentTarget.length?this.handleMouseOverContainerWithChildren({position:r,target:i.target,stateAccessor:n,draggedEntity:o}):this.handleMouseOverChildlessContainer({position:r,target:i.target,stateAccessor:n,draggedEntity:o})}}},IR=(0,s.Z)(bR.prototype,"projectDoc",[lR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vR=(0,s.Z)(bR.prototype,"projectUIState",[dR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wR=(0,s.Z)(bR.prototype,"dropElementHelper",[pR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NR=(0,s.Z)(bR.prototype,"notificationsManagementFlow",[uR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jR=(0,s.Z)(bR.prototype,"guardsService",[hR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SR=(0,s.Z)(bR.prototype,"componentManagementFlow",[mR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DR=(0,s.Z)(bR.prototype,"dropSimulatorFlow",[yR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TR=(0,s.Z)(bR.prototype,"nodeStyleManagementFlow",[gR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OR=(0,s.Z)(bR.prototype,"nodeManagementFlow",[fR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(bR.prototype,"handleDropIntoContainer",[m.P],Object.getOwnPropertyDescriptor(bR.prototype,"handleDropIntoContainer"),bR.prototype),bR);var _R,MR,PR,AR,kR;function UR(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function RR(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?UR(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):UR(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}_R=(0,c.provide)("dropIntoFlexContainerFlow"),MR=(0,c.inject)("imageTransformationFlow"),_R((AR=class extends xR{constructor(){super(),(0,i.Z)(this,"imageTransformationFlow",kR,this),this.resetState(),this.handleDropIntoChildlessNode=this.handleDropIntoChildlessNode.bind(this),this.handleDropBetweenSiblings=this.handleDropBetweenSiblings.bind(this)}resetState(){super.resetUIStateState("flexContainer")}handleDraggedEntity(e){return super.handleDraggedEntity(e)}acceptsDOMElement(e,t,o,n){return super.checkIfElementIsAccepted(e,"flexContainer",t,o,n)}moveOver(e){super.handleMoveOver(RR(RR({},e),{},{stateAccessor:"flexContainer"}))}moveOut(){super.handleMoveOut("flexContainer")}handleDrop(e){return super.handleDropIntoContainer(RR({dropIntoChildlessContainerCallback:this.handleDropIntoChildlessNode,dropIntoContainerWithChildrenCallback:this.handleDropBetweenSiblings,stateAccessor:"flexContainer"},e))}handleDropIntoChildlessNode(e){const{acceptedDropTarget:t}=this.projectUIState.dropFlowStates.flexContainer;if(!t)return!1;const{draggedEntity:o,doc:n,isVirtual:i}=e;if(!n||!o||i)return!1;const r=this.projectUIState.selection.componentId;if(!r)return this.resetState(),!1;if(!n.getProjectPageOrComponent(r))throw new Error("Could not execute flex container drop when active componet is not available");const{uidlNode:s}=t;return s.primitiveType===Zn.sO.IMAGE?this.handleDropIntoEmptyContainer({draggedEntity:o,doc:n,droppingInImage:!0}):this.handleDropIntoEmptyContainer({draggedEntity:o,doc:n}),this.resetState(),!0}handleDropIntoEmptyContainer(e){const{acceptedDropTarget:t,dropPosition:o}=this.projectUIState.dropFlowStates.flexContainer;if(!t)throw new Error("Could not execute flex container drop with no targets");const{draggedEntity:n,doc:i,droppingInImage:r}=e;if(!i)return;const{uidlNode:s,domNode:a}=t,{pressedKeys:c}=this.projectUIState.userInteractions,l=s.id,p=i.nodes.getById(l);if(r&&this.imageTransformationFlow.turnImageIntoContainer({nodeId:l,width:a.getBoundingClientRect().width,height:a.getBoundingClientRect().height,doc:i}),p.styles=this.getUpdatedNodeStyleBasedOnDropPosition(p.styles),n.type===cu.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:n.content.elementId,customCodeSnippet:n.content.elementCode,targetId:l,doc:i}),!0;if(n.type===cu.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:n.content.sectionId,customCodeSnippet:n.content.customCodeSnippet,targetId:l,doc:i}),!0;const u=n.content;if(u.isNew){var h;const e={nodes:u.subHierarchy,parentId:l,dropPosition:o,keepOriginalParent:(null===(h=u.meta)||void 0===h?void 0:h.nodeType)===Zn.sO.ICON,doc:i};if(u.subHierarchy[0].primitiveType===Zn.sO.HTML_NODE)return this.nodeManagementFlow.addCodeEmbedNodeToSelNode(e),!0;this.nodeManagementFlow.addNodesToParentOrStage(e)}else c.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:u.subHierarchy,targetId:l,doc:i}):this.nodeManagementFlow.moveNodesToTarget({nodes:u.subHierarchy,targetId:l,dropPosition:o,removeMargins:!0,doc:i});r&&this.notificationsManagementFlow.createLimitedUseNotification(d.CS.IMAGE_TRANSFORMATION)}getUpdatedNodeStyleBasedOnDropPosition(e){var t,o;const{dropPosition:n}=this.projectUIState.dropFlowStates.flexContainer,i="row"===(null===(t=e[$r.X7.FLEX_DIRECTION])||void 0===t?void 0:t.content)||!(null!==(o=e[$r.X7.FLEX_DIRECTION])&&void 0!==o&&o.content);switch(n){case"top-left":return RR(RR({},e),{},{alignItems:new Yr.F({content:"flex-start"}),justifyContent:new Yr.F({content:"flex-start"})});case"top-right":return RR(RR({},e),{},{alignItems:i?new Yr.F({content:"flex-start"}):new Yr.F({content:"flex-end"}),justifyContent:i?new Yr.F({content:"flex-end"}):new Yr.F({content:"flex-start"})});case"bottom-right":return RR(RR({},e),{},{alignItems:new Yr.F({content:"flex-end"}),justifyContent:new Yr.F({content:"flex-end"})});case"bottom-left":return RR(RR({},e),{},{alignItems:i?new Yr.F({content:"flex-end"}):new Yr.F({content:"flex-start"}),justifyContent:i?new Yr.F({content:"flex-start"}):new Yr.F({content:"flex-end"})});case"center":return RR(RR({},e),{},{alignItems:new Yr.F({content:"center"}),justifyContent:new Yr.F({content:"center"})});case"left-middle":return RR(RR({},e),{},{alignItems:i?new Yr.F({content:"center"}):new Yr.F({content:"flex-start"}),justifyContent:i?new Yr.F({content:"flex-start"}):new Yr.F({content:"center"})});case"right-middle":return RR(RR({},e),{},{alignItems:i?new Yr.F({content:"center"}):new Yr.F({content:"flex-end"}),justifyContent:i?new Yr.F({content:"flex-end"}):new Yr.F({content:"center"})});case"top-middle":return RR(RR({},e),{},{alignItems:i?new Yr.F({content:"flex-start"}):new Yr.F({content:"center"}),justifyContent:i?new Yr.F({content:"center"}):new Yr.F({content:"flex-start"})});case"bottom-middle":return RR(RR({},e),{},{alignItems:i?new Yr.F({content:"flex-end"}):new Yr.F({content:"center"}),justifyContent:i?new Yr.F({content:"center"}):new Yr.F({content:"flex-end"})});default:return RR(RR({},e),{},{alignItems:new Yr.F({content:"flex-start"}),justifyContent:new Yr.F({content:"flex-start"})})}}handleDropBetweenSiblings(e){const{acceptedDropTarget:t,childAnchoringDrop:o,dropOutsideTarget:n,newWrapperFlexDirection:i}=this.projectUIState.dropFlowStates.flexContainer;if(!t||!o)return!1;const{draggedEntity:r,doc:s,isVirtual:a}=e;if(!s)return!1;const{pressedKeys:c}=this.projectUIState.userInteractions;let l=t.uidlNode;n&&(l=n.uidlNode);const{edgeData:d,uidlNode:p}=o;if(i&&"parent"!==i&&a)return!1;const u=-1!==["left","top"].indexOf(d.edge)?p:s.nodes.getNextSibling(p);if(i)return"parent"===i?(this.handleDropWithParentFlexDirectionChange({draggedEntity:r,dropOutsideTarget:n,nextSibling:u,doc:s}),!0):this.handleDropWithWrapperCreation({draggedEntity:r,dropOutsideTarget:n,doc:s});if(r.type===cu.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:r.content.elementId,customCodeSnippet:r.content.elementCode,targetId:l.id,nextSibling:u,doc:s}),!0;if(r.type===cu.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:r.content.sectionId,customCodeSnippet:r.content.customCodeSnippet,targetId:l.id,nextSibling:u,doc:s}),!0;const h=r.content;if(h.isNew){var m;const e={nodes:h.subHierarchy,parentId:l.id,nextSibling:u,keepOriginalParent:(null===(m=h.meta)||void 0===m?void 0:m.nodeType)===Zn.sO.ICON,doc:s};h.subHierarchy[0].primitiveType===Zn.sO.HTML_NODE?this.nodeManagementFlow.addCodeEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else c.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:h.subHierarchy,targetId:l.id,copyBefore:u,doc:s}):this.nodeManagementFlow.moveNodesToTarget({nodes:h.subHierarchy,targetId:l.id,nextSibling:u,removeMargins:!0,doc:s});return this.resetState(),!0}handleDropWithParentFlexDirectionChange(e){const{draggedEntity:t,dropOutsideTarget:o,nextSibling:n,doc:i}=e,{acceptedDropTarget:r,childAnchoringDrop:s}=this.projectUIState.dropFlowStates.flexContainer;if(!r||!s||!i)return;let{uidlNode:a}=r;o&&(a=o.uidlNode);const c=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.id,["flexDirection","alignItems","justifyContent"]),{uidlNode:l,edgeData:d}=s,p=-1!==["left","top"].indexOf(d.edge)?"before":"after",u=["left","right"].includes(s.edgeData.edge);if(c.flexDirection===yl.sO.COLUMN&&u||c.flexDirection!==yl.sO.COLUMN&&!u){const e=c.flexDirection===yl.sO.COLUMN?yl.sO.ROW:yl.sO.COLUMN,t=c.alignItems,o=c.justifyContent||"flex-start",n=["flex-end","flex-start","center"],r={flexDirection:{value:e}};this.nodeStyleManagementFlow.removeMultipleStylesByKeyBasedOnCurrentBreakpoint({nodeIds:[a.id],keys:["justifyContent","alignItems"],doc:i}),"string"===typeof t&&-1!==n.indexOf(t)&&(r.justifyContent={value:t}),"string"===typeof o&&-1!==n.indexOf(o)&&(r.alignItems={value:o}),this.nodeStyleManagementFlow.setMultipleStylesByKeyForCurrentBreakpoint({nodeIds:[a.id],styleMap:r,doc:i})}const{pressedKeys:h}=this.projectUIState.userInteractions;if(t.type===cu.Z.INTERACTIVE_ELEMENT)return void this.componentManagementFlow.importSectionComponent({sectionId:t.content.elementId,customCodeSnippet:t.content.elementCode,doc:i,targetId:a.id,nextSibling:n});if(t.type===cu.Z.SECTION_TEMPLATE)return void this.componentManagementFlow.importSectionComponent({sectionId:t.content.sectionId,customCodeSnippet:t.content.customCodeSnippet,doc:i,targetId:a.id,nextSibling:n});const m=t.content;if(m.isNew){var y;const e={nodes:m.subHierarchy,parentId:a.id,nextSibling:"before"===p?l:null,keepOriginalParent:(null===(y=m.meta)||void 0===y?void 0:y.nodeType)===Zn.sO.ICON,doc:i};if(m.subHierarchy[0].primitiveType===Zn.sO.HTML_NODE)return void this.nodeManagementFlow.addCodeEmbedNodeToSelNode(e);this.nodeManagementFlow.addNodesToParentOrStage(e)}else h.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:m.subHierarchy,targetId:a.id,copyBefore:n,doc:i}):this.nodeManagementFlow.moveNodesToTarget({nodes:m.subHierarchy,targetId:a.id,nextSibling:n,removeMargins:!0,doc:i})}handleDropWithWrapperCreation(e){var t;const{acceptedDropTarget:o,childAnchoringDrop:n}=this.projectUIState.dropFlowStates.flexContainer;if(!o||!n)return!1;const{draggedEntity:i,dropOutsideTarget:r,doc:s}=e;if(!s)return!1;let{uidlNode:a}=o;r&&(a=r.uidlNode);const{uidlNode:c,edgeData:l}=n,{pressedKeys:d}=this.projectUIState.userInteractions,p=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.id,["flexDirection"]).flexDirection===yl.sO.COLUMN?yl.sO.ROW:yl.sO.COLUMN,u={};if(p===yl.sO.ROW){let e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(c.id,["height"]).height;e?(-1!==e.toString().indexOf("%")&&(e="100%"),u.height=e,u.width="auto"):(u.height="auto",u.width="auto");const t=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.id,["alignItems"]).alignItems;u.justifyContent=t}else{let e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(c.id,["width"]).width;e?(-1!==e.toString().indexOf("%")&&(e="100%"),u.width=e,u.height="auto"):(u.width="auto",u.height="auto");const t=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.id,["justifyContent"]).justifyContent;u.alignItems=t}const h=(0,MP.a)({stencilKey:p,parentId:a.id,styles:u});h.fakeSize=!1;const m=s.nodes.getNextSibling(c),y=-1!==["left","top"].indexOf(l.edge)?"before":"after";if(this.nodeManagementFlow.addNodesToParentOrStage({nodes:[h],parentId:a.id,keepOriginalParent:(null===(t=i.content.meta)||void 0===t?void 0:t.nodeType)===Zn.sO.ICON,nextSibling:m,doc:s}),i.type===cu.Z.INTERACTIVE_ELEMENT)return this.nodeManagementFlow.moveNodesToTarget({nodes:[c],targetId:h.id,removeMargins:!0,doc:s}),this.componentManagementFlow.importSectionComponent({sectionId:i.content.elementId,customCodeSnippet:i.content.elementCode,doc:s,targetId:h.id,nextSibling:"before"===y?c:null}),!0;if(i.type===cu.Z.SECTION_TEMPLATE)return this.nodeManagementFlow.moveNodesToTarget({nodes:[c],targetId:h.id,removeMargins:!0,doc:s}),this.componentManagementFlow.importSectionComponent({sectionId:i.content.sectionId,customCodeSnippet:i.content.customCodeSnippet,doc:s,targetId:h.id,nextSibling:"before"===y?c:null}),!0;const g=i.content;if(g.isNew){var f;this.nodeManagementFlow.moveNodesToTarget({nodes:[c],targetId:h.id,removeMargins:!0,doc:s});const e={nodes:g.subHierarchy,parentId:h.id,keepOriginalParent:(null===(f=g.meta)||void 0===f?void 0:f.nodeType)===Zn.sO.ICON,nextSibling:"before"===y?c:null,doc:s};g.subHierarchy[0].primitiveType===Zn.sO.HTML_NODE?this.nodeManagementFlow.addCodeEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else this.nodeManagementFlow.moveNodesToTarget({nodes:[c],targetId:h.id,removeMargins:!0,doc:s}),d.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:g.subHierarchy,targetId:h.id,copyBefore:"before"===y?c:null,doc:s}),g.subHierarchy.some((e=>e.id===c.id))&&this.nodeManagementFlow.moveNodesToTarget({nodes:g.subHierarchy,targetId:h.id,nextSibling:"before"===y?c:null,removeMargins:!0,doc:s})):this.nodeManagementFlow.moveNodesToTarget({nodes:g.subHierarchy,targetId:h.id,nextSibling:"before"===y?c:null,removeMargins:!0,doc:s});return this.resetState(),!0}},kR=(0,s.Z)(AR.prototype,"imageTransformationFlow",[MR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(AR.prototype,"handleDrop",[m.P],Object.getOwnPropertyDescriptor(AR.prototype,"handleDrop"),AR.prototype),(0,s.Z)(AR.prototype,"handleDropIntoChildlessNode",[m.P],Object.getOwnPropertyDescriptor(AR.prototype,"handleDropIntoChildlessNode"),AR.prototype),(0,s.Z)(AR.prototype,"handleDropIntoEmptyContainer",[m.P],Object.getOwnPropertyDescriptor(AR.prototype,"handleDropIntoEmptyContainer"),AR.prototype),(0,s.Z)(AR.prototype,"handleDropBetweenSiblings",[m.P],Object.getOwnPropertyDescriptor(AR.prototype,"handleDropBetweenSiblings"),AR.prototype),(0,s.Z)(AR.prototype,"handleDropWithParentFlexDirectionChange",[m.P],Object.getOwnPropertyDescriptor(AR.prototype,"handleDropWithParentFlexDirectionChange"),AR.prototype),(0,s.Z)(AR.prototype,"handleDropWithWrapperCreation",[m.P],Object.getOwnPropertyDescriptor(AR.prototype,"handleDropWithWrapperCreation"),AR.prototype),PR=AR));var ZR,LR;function $R(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function BR(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?$R(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):$R(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}(0,c.provide)("dropIntoUnknownContainerFlow")((LR=class extends xR{constructor(){super(),this.resetState(),this.handleDropBetweenSiblings=this.handleDropBetweenSiblings.bind(this),this.handleDropIntoEmptyContainer=this.handleDropIntoEmptyContainer.bind(this)}resetState(){super.resetUIStateState("unknownContainer")}handleDraggedEntity(e){return super.handleDraggedEntity(e)}acceptsDOMElement(e,t,o,n){return super.checkIfElementIsAccepted(e,"unknownContainer",t,o,n)}moveOver(e){super.handleMoveOver(BR(BR({},e),{},{stateAccessor:"unknownContainer"}))}moveOut(){super.handleMoveOut("unknownContainer")}handleDrop(e){return super.handleDropIntoContainer(BR({dropIntoChildlessContainerCallback:this.handleDropIntoEmptyContainer,dropIntoContainerWithChildrenCallback:this.handleDropBetweenSiblings,stateAccessor:"unknownContainer"},e))}handleDropIntoEmptyContainer(e){const t=this.projectUIState.dropFlowStates.unknownContainer.acceptedDropTarget;if(!t)throw new Error("Could not execute unknown container drop with no targets");const{draggedEntity:o,doc:n,isVirtual:i}=e;if(i)return!1;const{uidlNode:r}=t,{pressedKeys:s}=this.projectUIState.userInteractions,a=r.id;if(o.type===cu.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:o.content.elementId,customCodeSnippet:o.content.elementCode,targetId:a,doc:n}),!0;if(o.type===cu.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:o.content.sectionId,customCodeSnippet:o.content.customCodeSnippet,targetId:a,doc:n}),!0;const c=o.content;if(c.isNew){var l;const e={nodes:c.subHierarchy,parentId:a,keepOriginalParent:(null===(l=c.meta)||void 0===l?void 0:l.nodeType)===Zn.sO.ICON,doc:n};c.subHierarchy[0].primitiveType===Zn.sO.HTML_NODE?this.nodeManagementFlow.addCodeEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else s.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:c.subHierarchy,targetId:a,doc:n}):this.nodeManagementFlow.moveNodesToTarget({nodes:c.subHierarchy,targetId:a,doc:n});return this.resetState(),!0}handleDropBetweenSiblings(e){const{acceptedDropTarget:t,childAnchoringDrop:o,dropOutsideTarget:n}=this.projectUIState.dropFlowStates.unknownContainer;if(!t||!o)return!1;const{draggedEntity:i,doc:r}=e;if(!r)return!1;const{pressedKeys:s}=this.projectUIState.userInteractions;let a=t.uidlNode;n&&(a=n.uidlNode);const{uidlNode:c,edgeData:l}=o,d=a.id,p="top"===l.edge||"left"===l.edge?c:this.projectDoc.nodes.getNextSibling(c);if(i.type===cu.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({doc:r,sectionId:i.content.elementId,customCodeSnippet:i.content.elementCode,nextSibling:p}),!0;if(i.type===cu.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({doc:r,sectionId:i.content.sectionId,customCodeSnippet:i.content.customCodeSnippet,nextSibling:p}),!0;const u=i.content;if(u.isNew){var h;const e={nodes:u.subHierarchy,keepOriginalParent:(null===(h=u.meta)||void 0===h?void 0:h.nodeType)===Zn.sO.ICON,parentId:d,nextSibling:p,doc:r};u.subHierarchy[0].primitiveType===Zn.sO.HTML_NODE?this.nodeManagementFlow.addCodeEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else s.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:u.subHierarchy,targetId:d,copyBefore:p,doc:r}):this.nodeManagementFlow.moveNodesToTarget({nodes:u.subHierarchy,targetId:d,nextSibling:p,doc:r});return this.resetState(),!0}},(0,s.Z)(LR.prototype,"handleDrop",[m.P],Object.getOwnPropertyDescriptor(LR.prototype,"handleDrop"),LR.prototype),(0,s.Z)(LR.prototype,"handleDropIntoEmptyContainer",[m.P],Object.getOwnPropertyDescriptor(LR.prototype,"handleDropIntoEmptyContainer"),LR.prototype),(0,s.Z)(LR.prototype,"handleDropBetweenSiblings",[m.P],Object.getOwnPropertyDescriptor(LR.prototype,"handleDropBetweenSiblings"),LR.prototype),ZR=LR));var GR,HR;function zR(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function YR(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?zR(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):zR(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}(0,c.provide)("dropIntoBlockInlineContainerFlow")((HR=class extends xR{constructor(){super(),this.resetState(),this.handleDropIntoEmptyContainer=this.handleDropIntoEmptyContainer.bind(this),this.handleDropBetweenSiblings=this.handleDropBetweenSiblings.bind(this)}resetState(){super.resetUIStateState("blockInlineContainer")}handleDraggedEntity(e){return super.handleDraggedEntity(e)}acceptsDOMElement(e,t,o,n){return super.checkIfElementIsAccepted(e,"blockInlineContainer",t,o,n)}moveOver(e){super.handleMoveOver(YR(YR({},e),{},{stateAccessor:"blockInlineContainer"}))}moveOut(){super.handleMoveOut("blockInlineContainer")}handleDrop(e){return super.handleDropIntoContainer(YR({dropIntoChildlessContainerCallback:this.handleDropIntoEmptyContainer,dropIntoContainerWithChildrenCallback:this.handleDropBetweenSiblings,stateAccessor:"blockInlineContainer"},e))}handleDropIntoEmptyContainer(e){const{draggedEntity:t,doc:o,isVirtual:n}=e;if(!o||n)return!1;const i=this.projectUIState.dropFlowStates.blockInlineContainer.acceptedDropTarget;if(!i)throw new Error("Could not execute container drop with no targets");const{uidlNode:r}=i,{pressedKeys:s}=this.projectUIState.userInteractions,a=r.id;if(t.type===cu.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({targetId:a,sectionId:t.content.elementId,customCodeSnippet:t.content.elementCode,doc:o}),!0;if(t.type===cu.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({targetId:a,sectionId:t.content.sectionId,customCodeSnippet:t.content.customCodeSnippet,doc:o}),!0;const c=t.content;if(c.isNew){var l;const e={nodes:c.subHierarchy,parentId:a,keepOriginalParent:(null===(l=c.meta)||void 0===l?void 0:l.nodeType)===Zn.sO.ICON,doc:o};c.subHierarchy[0].primitiveType===Zn.sO.HTML_NODE?this.nodeManagementFlow.addCodeEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else s.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:c.subHierarchy,targetId:a,doc:o}):this.nodeManagementFlow.moveNodesToTarget({nodes:c.subHierarchy,targetId:a,doc:o});return this.resetState(),!0}handleDropBetweenSiblings(e){const{draggedEntity:t,doc:o,isVirtual:n}=e,{acceptedDropTarget:i,childAnchoringDrop:r,dropOutsideTarget:s,newWrapperFlexDirection:a}=this.projectUIState.dropFlowStates.blockInlineContainer;if(!i||!r)return!1;const{pressedKeys:c}=this.projectUIState.userInteractions;let l=i.uidlNode;s&&(l=s.uidlNode);const{edgeData:d,uidlNode:p}=r;let u=p;if(-1!==["right","bottom"].indexOf(d.edge)&&(u=this.projectDoc.nodes.getNextSibling(p)),t.type===cu.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:t.content.elementId,customCodeSnippet:t.content.elementCode,targetId:l.id,nextSibling:u,doc:o}),!0;if(t.type===cu.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:t.content.sectionId,customCodeSnippet:t.content.customCodeSnippet,targetId:l.id,nextSibling:u,doc:o}),!0;const h=t.content;if(a)return!n&&this.handleDropWithWrapperCreation({draggedEntityContent:h,wrapperFlexDirection:a,dropOutsideTarget:s,doc:o});if(h.isNew){var m;const e={nodes:h.subHierarchy,parentId:l.id,nextSibling:u,keepOriginalParent:(null===(m=h.meta)||void 0===m?void 0:m.nodeType)===Zn.sO.ICON,doc:o};h.subHierarchy[0].primitiveType===Zn.sO.HTML_NODE?this.nodeManagementFlow.addCodeEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else c.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:h.subHierarchy,copyBefore:u,targetId:l.id,doc:o}):this.nodeManagementFlow.moveNodesToTarget({nodes:h.subHierarchy,nextSibling:u,targetId:l.id,doc:o});return this.resetState(),!0}handleDropWithWrapperCreation(e){var t;const{acceptedDropTarget:o,childAnchoringDrop:n}=this.projectUIState.dropFlowStates.blockInlineContainer;if(!o||!n)return!1;const{draggedEntityContent:i,wrapperFlexDirection:r,dropOutsideTarget:s,doc:a}=e;if(!a)return!1;let{uidlNode:c}=o;s&&(c=s.uidlNode);const{uidlNode:l,edgeData:d}=n,{pressedKeys:p}=this.projectUIState.userInteractions,u=(0,MP.a)({stencilKey:r,parentId:c.id}),h=this.projectDoc.nodes.getNextSibling(l),m=-1!==["left","top"].indexOf(d.edge)?"before":"after";if(this.nodeManagementFlow.addNodesToParentOrStage({nodes:[u],parentId:c.id,nextSibling:h,keepOriginalParent:(null===(t=i.meta)||void 0===t?void 0:t.nodeType)===Zn.sO.ICON,doc:a}),i.isNew){var y;this.nodeManagementFlow.moveNodesToTarget({nodes:[l],targetId:u.id,doc:a});const e={nodes:i.subHierarchy,keepOriginalParent:(null===(y=i.meta)||void 0===y?void 0:y.nodeType)===Zn.sO.ICON,parentId:u.id,nextSibling:"before"===m?l:null,doc:a};i.subHierarchy[0].primitiveType===Zn.sO.HTML_NODE?this.nodeManagementFlow.addCodeEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else this.nodeManagementFlow.moveNodesToTarget({nodes:[l],targetId:u.id,doc:a}),p.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:i.subHierarchy,targetId:u.id,copyBefore:"before"===m?l:null,doc:a}),i.subHierarchy.some((e=>e.id===l.id))&&this.nodeManagementFlow.moveNodesToTarget({nodes:i.subHierarchy,targetId:u.id,nextSibling:"before"===m?l:null,doc:a})):this.nodeManagementFlow.moveNodesToTarget({nodes:[...i.subHierarchy],targetId:u.id,nextSibling:"before"===m?l:null,doc:a});return this.resetState(),!0}},(0,s.Z)(HR.prototype,"handleDrop",[m.P],Object.getOwnPropertyDescriptor(HR.prototype,"handleDrop"),HR.prototype),(0,s.Z)(HR.prototype,"handleDropIntoEmptyContainer",[m.P],Object.getOwnPropertyDescriptor(HR.prototype,"handleDropIntoEmptyContainer"),HR.prototype),(0,s.Z)(HR.prototype,"handleDropBetweenSiblings",[m.P],Object.getOwnPropertyDescriptor(HR.prototype,"handleDropBetweenSiblings"),HR.prototype),(0,s.Z)(HR.prototype,"handleDropWithWrapperCreation",[m.P],Object.getOwnPropertyDescriptor(HR.prototype,"handleDropWithWrapperCreation"),HR.prototype),GR=HR));var VR,WR,KR,qR,JR,XR,QR,eZ,tZ;function oZ(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function nZ(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?oZ(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):oZ(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}VR=(0,c.provide)("dropIntoInheritContainerFlow"),WR=(0,c.inject)("dropIntoFlexContainerFlow"),KR=(0,c.inject)("dropIntoBlockInlineContainerFlow"),qR=(0,c.inject)("dropIntoUnknownContainerFlow"),VR((XR=class extends xR{constructor(){super(),(0,i.Z)(this,"dropIntoFlexContainerFlow",QR,this),(0,i.Z)(this,"dropIntoBlockInlineContainerFlow",eZ,this),(0,i.Z)(this,"dropIntoUnknownContainerFlow",tZ,this),(0,r.Z)(this,"stateAccessor","unknownContainer"),this.resetState()}resetState(){super.resetUIStateState(this.stateAccessor),this.stateAccessor="unknownContainer"}handleDraggedEntity(e){return super.handleDraggedEntity(e)}acceptsDOMElement(e,t,o,n){var i;if(!n)return this.acceptingDropTarget=null,!1;if(!(e instanceof HTMLElement))return this.acceptingDropTarget=null,!1;const r=e.dataset.compInstanceId||e.dataset.nodeId;if(!r)return this.acceptingDropTarget=null,!1;if((null===(i=this.acceptingDropTarget)||void 0===i?void 0:i.uidlNode.id)===r)return!0;if(!((null===n||void 0===n?void 0:n.target)instanceof HTMLIFrameElement))return this.acceptingDropTarget=null,!1;const s=!!this.projectUIState.userInteractions.pressedKeys.ctrl,a=this.projectDoc.nodes.getById(r);if(!s&&null!==a&&void 0!==a&&a.parentId&&this.dropElementHelper.elementSmallerOrSibling(e,r))return this.acceptingDropTarget=null,!1;if((null===a||void 0===a?void 0:a.primitiveType)===Zn.sO.CONTAINER&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:a.id,key:$r.X7.DISPLAY,values:["inherit"]})){if(a.parentId){const e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.parentId,["display"]).display;"flex"===e&&(this.stateAccessor="flexContainer"),-1!==["block","inline","inline-block"].indexOf(e)&&(this.stateAccessor="blockInlineContainer")}return this.acceptingDropTarget={domNode:e,uidlNode:a},!0}return this.acceptingDropTarget=null,!1}moveOver(e){this.stateAccessor&&super.handleMoveOver(nZ(nZ({},e),{},{stateAccessor:this.stateAccessor}))}moveOut(){super.handleMoveOut(this.stateAccessor)}handleDrop(e){return"flexContainer"===this.stateAccessor?this.dropIntoFlexContainerFlow.handleDrop(e):"blockInlineContainer"===this.stateAccessor?this.dropIntoBlockInlineContainerFlow.handleDrop(e):this.dropIntoUnknownContainerFlow.handleDrop(e)}},QR=(0,s.Z)(XR.prototype,"dropIntoFlexContainerFlow",[WR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eZ=(0,s.Z)(XR.prototype,"dropIntoBlockInlineContainerFlow",[KR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tZ=(0,s.Z)(XR.prototype,"dropIntoUnknownContainerFlow",[qR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(XR.prototype,"handleDrop",[m.P],Object.getOwnPropertyDescriptor(XR.prototype,"handleDrop"),XR.prototype),JR=XR));var iZ,rZ;function sZ(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function aZ(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?sZ(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):sZ(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}(0,c.provide)("dropIntoSlotFlow")((rZ=class extends xR{constructor(){super(),this.resetState(),this.handleDropIntoChildlessSlot=this.handleDropIntoChildlessSlot.bind(this),this.handleDropBetweenSiblings=this.handleDropBetweenSiblings.bind(this)}resetState(){super.resetUIStateState("slot")}handleDraggedEntity(e){return super.handleDraggedEntity(e)}acceptsDOMElement(e,t,o,n){return super.checkIfElementIsAccepted(e,"slot",t,o,n)}moveOver(e){super.handleMoveOver(aZ(aZ({},e),{},{stateAccessor:"slot"}))}moveOut(){super.handleMoveOut("slot")}handleDrop(e){return super.handleDropIntoContainer(aZ({dropIntoChildlessContainerCallback:this.handleDropIntoChildlessSlot,dropIntoContainerWithChildrenCallback:this.handleDropBetweenSiblings,stateAccessor:"slot"},e))}handleDropIntoChildlessSlot(e){const{acceptedDropTarget:t,dropPosition:o}=this.projectUIState.dropFlowStates.slot;if(!t)throw new Error("Could not execute slot drop with no targets");const{draggedEntity:n,doc:i,isVirtual:r}=e;if(!i||!n||r)return!1;const s=this.projectUIState.selection.componentId;if(!s)return this.resetState(),!1;if(!i.getProjectPageOrComponent(s))throw new Error("Could not execute slot drop when active componet is not available");const{uidlNode:a,domNode:c}=t,{pressedKeys:l}=this.projectUIState.userInteractions,d=a.id,p=c.dataset.compInstanceId;if(!p&&a.primitiveType===Zn.sO.SLOT)throw new Error("Attempted to drop into independent slot whose comp instance is unknown!");if(n.type===cu.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:n.content.elementId,customCodeSnippet:n.content.elementCode,targetId:d,compInstanceId:p,doc:i}),!0;if(n.type===cu.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:n.content.sectionId,customCodeSnippet:n.content.customCodeSnippet,targetId:d,compInstanceId:p,doc:i}),!0;const u=n.content;var h;u.isNew?this.nodeManagementFlow.addNodesToParentOrStage({nodes:u.subHierarchy,parentId:d,dropPosition:o,keepOriginalParent:(null===(h=u.meta)||void 0===h?void 0:h.nodeType)===Zn.sO.ICON,compInstanceId:p,doc:i}):l.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:u.subHierarchy,targetId:d,compInstanceId:p,doc:i}):this.nodeManagementFlow.moveNodesToTarget({nodes:u.subHierarchy,targetId:d,dropPosition:o,removeMargins:!0,targetCompInstanceId:p,doc:i});return this.resetState(),!0}handleDropBetweenSiblings(e){const{acceptedDropTarget:t,childAnchoringDrop:o,dropOutsideTarget:n,newWrapperFlexDirection:i}=this.projectUIState.dropFlowStates.slot;if(!t||!o)return!1;const{draggedEntity:r,doc:s,isVirtual:a}=e;if(!s)return!1;const{pressedKeys:c}=this.projectUIState.userInteractions;let l=t.uidlNode,d=t.domNode.dataset.compInstanceId;if(n&&(l=n.uidlNode,d=n.domNode.dataset.compInstanceId),!d&&l.primitiveType===Zn.sO.SLOT)throw new Error("Attempted to drop into slot whose comp instance is unknown!");const{edgeData:p,uidlNode:u}=o;if(i&&a)return!1;const h=-1!==["left","top"].indexOf(p.edge)?u:s.nodes.getNextSibling(u);if(i)return this.handleDropWithWrapperCreation({draggedEntity:r,dropOutsideTarget:n,doc:s,compInstanceId:d});if(r.type===cu.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:r.content.elementId,customCodeSnippet:r.content.elementCode,targetId:l.id,nextSibling:h,compInstanceId:d,doc:s}),!0;if(r.type===cu.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:r.content.sectionId,customCodeSnippet:r.content.customCodeSnippet,targetId:l.id,nextSibling:h,compInstanceId:d,doc:s}),!0;const m=r.content;var y;m.isNew?this.nodeManagementFlow.addNodesToParentOrStage({nodes:m.subHierarchy,parentId:l.id,nextSibling:h,compInstanceId:d,keepOriginalParent:(null===(y=m.meta)||void 0===y?void 0:y.nodeType)===Zn.sO.ICON,doc:s}):c.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:m.subHierarchy,targetId:l.id,copyBefore:h,doc:s,compInstanceId:d}):this.nodeManagementFlow.moveNodesToTarget({nodes:m.subHierarchy,targetId:l.id,nextSibling:h,targetCompInstanceId:d,removeMargins:!0,doc:s});return this.resetState(),!0}handleDropWithWrapperCreation(e){var t;const{acceptedDropTarget:o,childAnchoringDrop:n}=this.projectUIState.dropFlowStates.slot;if(!o||!n)return!1;const{draggedEntity:i,dropOutsideTarget:r,compInstanceId:s,doc:a}=e;if(!a)return!1;let{uidlNode:c}=o;r&&(c=r.uidlNode);const l=a.nodes.getById(c.parentId||"");if(!l)return!1;const{uidlNode:d,edgeData:p}=n,{pressedKeys:u}=this.projectUIState.userInteractions,h=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(l.id,["flexDirection"]).flexDirection===yl.sO.COLUMN?yl.sO.ROW:yl.sO.COLUMN,m={};if(h===yl.sO.ROW){let e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(d.id,["height"]).height;e?(-1!==e.toString().indexOf("%")&&(e="100%"),m.height=e,m.width="auto"):(m.height="auto",m.width="auto");const t=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(l.id,["alignItems"]).alignItems;m.justifyContent=t}else{let e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(d.id,["width"]).width;e?(-1!==e.toString().indexOf("%")&&(e="100%"),m.width=e,m.height="auto"):(m.width="auto",m.height="auto");const t=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(l.id,["justifyContent"]).justifyContent;m.alignItems=t}const y=(0,MP.a)({stencilKey:h,slotId:c.id,styles:m});y.fakeSize=!1;const g=a.nodes.getNextSibling(d),f=-1!==["left","top"].indexOf(p.edge)?"before":"after";if(this.nodeManagementFlow.addNodesToParentOrStage({nodes:[y],parentId:c.id,keepOriginalParent:(null===(t=i.content.meta)||void 0===t?void 0:t.nodeType)===Zn.sO.ICON,compInstanceId:s,nextSibling:g,doc:a}),i.type===cu.Z.INTERACTIVE_ELEMENT)return this.nodeManagementFlow.moveNodesToTarget({nodes:[d],targetId:y.id,targetCompInstanceId:s,removeMargins:!0,doc:a}),this.componentManagementFlow.importSectionComponent({sectionId:i.content.elementId,customCodeSnippet:i.content.elementCode,doc:a,compInstanceId:s,targetId:y.id,nextSibling:"before"===f?d:null}),!0;if(i.type===cu.Z.SECTION_TEMPLATE)return this.nodeManagementFlow.moveNodesToTarget({nodes:[d],targetId:y.id,targetCompInstanceId:s,removeMargins:!0,doc:a}),this.componentManagementFlow.importSectionComponent({sectionId:i.content.sectionId,customCodeSnippet:i.content.customCodeSnippet,doc:a,compInstanceId:s,targetId:y.id,nextSibling:"before"===f?d:null}),!0;const b=i.content;var I;b.isNew?(this.nodeManagementFlow.moveNodesToTarget({nodes:[d],targetId:y.id,removeMargins:!0,targetCompInstanceId:s,doc:a}),this.nodeManagementFlow.addNodesToParentOrStage({nodes:b.subHierarchy,parentId:y.id,compInstanceId:s,keepOriginalParent:(null===(I=b.meta)||void 0===I?void 0:I.nodeType)===Zn.sO.ICON,nextSibling:"before"===f?d:null,doc:a})):(this.nodeManagementFlow.moveNodesToTarget({nodes:[d],targetId:y.id,removeMargins:!0,targetCompInstanceId:s,doc:a}),u.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:b.subHierarchy,targetId:y.id,copyBefore:"before"===f?d:null,compInstanceId:s,doc:a}),b.subHierarchy.some((e=>e.id===d.id))&&this.nodeManagementFlow.moveNodesToTarget({nodes:b.subHierarchy,targetId:y.id,nextSibling:"before"===f?d:null,removeMargins:!0,targetCompInstanceId:s,doc:a})):this.nodeManagementFlow.moveNodesToTarget({nodes:b.subHierarchy,targetId:y.id,nextSibling:"before"===f?d:null,removeMargins:!0,targetCompInstanceId:s,doc:a}));return this.resetState(),!0}},(0,s.Z)(rZ.prototype,"handleDrop",[m.P],Object.getOwnPropertyDescriptor(rZ.prototype,"handleDrop"),rZ.prototype),(0,s.Z)(rZ.prototype,"handleDropIntoChildlessSlot",[m.P],Object.getOwnPropertyDescriptor(rZ.prototype,"handleDropIntoChildlessSlot"),rZ.prototype),(0,s.Z)(rZ.prototype,"handleDropBetweenSiblings",[m.P],Object.getOwnPropertyDescriptor(rZ.prototype,"handleDropBetweenSiblings"),rZ.prototype),(0,s.Z)(rZ.prototype,"handleDropWithWrapperCreation",[m.P],Object.getOwnPropertyDescriptor(rZ.prototype,"handleDropWithWrapperCreation"),rZ.prototype),iZ=rZ));var cZ,lZ,dZ,pZ,uZ,hZ,mZ,yZ,gZ,fZ,bZ,IZ,vZ;cZ=(0,c.provide)("dropIntoButtonFlow"),lZ=(0,c.inject)("projectDoc"),dZ=(0,c.inject)("nodeManagementFlow"),pZ=(0,c.inject)("projectUIState"),uZ=(0,c.inject)("dropElementHelper"),hZ=(0,c.inject)("nodeStyleManagmentFlow"),cZ((yZ=class{constructor(){(0,i.Z)(this,"projectDoc",gZ,this),(0,i.Z)(this,"nodeManagementFlow",fZ,this),(0,i.Z)(this,"projectUIState",bZ,this),(0,i.Z)(this,"dropElementHelper",IZ,this),(0,i.Z)(this,"nodeStyleManagementFlow",vZ,this),(0,r.Z)(this,"lastHoveredNode",null),(0,r.Z)(this,"elementChildrenOfCurrentTarget",[]),(0,r.Z)(this,"lastAltState",!1),(0,r.Z)(this,"acceptingDropTarget",null),(0,r.Z)(this,"timeout",null),(0,r.Z)(this,"lastMovedAt",null)}resetState(){this.timeout&&clearTimeout(this.timeout),this.acceptingDropTarget=null,this.elementChildrenOfCurrentTarget=[],this.lastAltState=!1,this.lastHoveredNode=null,this.lastMovedAt=null,(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.button.acceptedDropTarget=null,e.dropFlowStates.button.childAnchoringDrop=null,e.dropFlowStates.button.dropPosition=null,e.dropFlowStates.button.dropOutsideTarget=null,e.dropFlowStates.button.dropIsDisabled=!1}))}handleDraggedEntity(e){return e.type===cu.Z.SUB_HIERARCHY}moveOut(){this.resetState()}acceptsDOMElement(e,t,o,n){if(!n)return this.acceptingDropTarget=null,!1;if(!(e instanceof HTMLElement))return this.acceptingDropTarget=null,!1;if(!((null===n||void 0===n?void 0:n.target)instanceof HTMLIFrameElement))return this.acceptingDropTarget=null,!1;let i=!0;for(;i&&e.parentElement;){const t=e.parentElement,o=t.dataset.nodeId,n=this.projectDoc.nodes.getById(o||"");(null===n||void 0===n?void 0:n.primitiveType)===Zn.sO.TEXT?e=t:i=!1}if(!(e instanceof HTMLElement))return this.acceptingDropTarget=null,!1;const r=e.dataset.compInstanceId||e.dataset.nodeId;if(!r)return this.acceptingDropTarget=null,!1;const s=this.projectDoc.nodes.getById(r);if(!this.projectUIState.userInteractions.pressedKeys.ctrl&&null!==s&&void 0!==s&&s.parentId&&this.dropElementHelper.elementSmallerOrSibling(e,r))return this.acceptingDropTarget=null,!1;const a=(null===s||void 0===s?void 0:s.primitiveType)===Zn.sO.BUTTON;if(!s||!a)return this.acceptingDropTarget=null,!1;this.acceptingDropTarget={domNode:e,uidlNode:s};return!!this.checkIfDraggedEntityIsAccepted(this.projectUIState.drag.draggedEntity)||(this.acceptingDropTarget=null,!1)}handleDrop(e){const{dropPosition:t,acceptedDropTarget:o,dropOutsideTarget:n,childAnchoringDrop:i,dropIsDisabled:r}=this.projectUIState.dropFlowStates.button,s=this.projectUIState.selection.componentId;if(!o||!s||r)return!1;const{draggedEntity:a,isVirtual:c,doc:l}=e;return a.type===cu.Z.SUB_HIERARCHY&&(t&&!n?this.dropIntoChildlessButton({draggedEntityContent:a.content,doc:l,isVirtual:c}):!!i&&this.dropIntoButtonWithChildren({draggedEntityContent:a.content,doc:l,isVirtual:c}))}moveOver(e){const t=this.projectUIState.drag.currentMousePosition,o=this.projectUIState.stage.webComp.controlValues.scale;this.lastMovedAt&&t&&!(0,bP.NN)(this.lastMovedAt,t,10/o)&&!e.forced||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.handleMoveOver(e)),ol.vL))}handleMoveOver(e){var t;this.timeout=null,this.lastMovedAt=this.projectUIState.drag.currentMousePosition;const{draggedEntity:o,customEv:n,position:i}=e;if(!o)return;if(!this.acceptingDropTarget||!n||!(n.target instanceof HTMLIFrameElement))return;const{domNode:r,uidlNode:s}=this.acceptingDropTarget,{pressedKeys:c}=this.projectUIState.userInteractions;return r?((null===(t=this.lastHoveredNode)||void 0===t?void 0:t.id)===s.id&&this.lastAltState===c.alt||(this.elementChildrenOfCurrentTarget=s.primitiveType===Zn.sO.BUTTON?this.dropElementHelper.processElementChildren(r.children,o.content.subHierarchy):this.elementChildrenOfCurrentTarget,this.lastHoveredNode=s,this.lastAltState=c.alt||!1,(0,a.mutate)(this.projectUIState,(e=>e.dropFlowStates.button.dropIsDisabled=!1))),this.elementChildrenOfCurrentTarget.length?this.handleMoveOverButtonWithChildren({draggedEntity:o,position:i,target:n.target}):this.handleMoveOverChildlessButton({draggedEntity:o,position:i,target:n.target})):void 0}handleMoveOverChildlessButton(e){const{position:t,target:o,draggedEntity:n}=e;if(!this.acceptingDropTarget||!t||n.type!==cu.Z.SUB_HIERARCHY)return;const{domNode:i,uidlNode:r}=this.acceptingDropTarget;if(!i)return;const s=o.getBoundingClientRect(),c=i.getBoundingClientRect(),l=(0,ni.AO)(i),d=this.projectUIState.stage.webComp.controlValues.scale*l,p=(0,bP.$p)(t,c,s,d),u=i.getBoundingClientRect(),h=o.getBoundingClientRect(),m=(0,ni.AO)(o),y=this.projectDoc.nodes.getById(r.parentId||"");let g=!1,f=!1;if(y&&y.primitiveType===Zn.sO.BUTTON){const e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(null===y||void 0===y?void 0:y.id,["flexDirection","display"]),t=e.display;g=e.flexDirection===yl.sO.COLUMN,f=t===$r.r3.FLEX}const b=(g&&f?t.y<=u.y*d*m+h.y+u.height/2*d*m:t.x<=u.x*d*m+h.x+u.width/2*d*m)?"left-middle":"right-middle";if(p)return this.dropElementHelper.handleMouseCloseToTargetEdge(p,"button",this.acceptingDropTarget),!0;(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.button.acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates.button.dropPosition=b,e.dropFlowStates.button.childAnchoringDrop=null,e.dropFlowStates.button.dropOutsideTarget=null}))}checkIfDraggedEntityIsAccepted(e){if(!this.acceptingDropTarget||!e||e.type!==cu.Z.SUB_HIERARCHY)return!1;const{uidlNode:t}=this.acceptingDropTarget;for(const o of e.content.subHierarchy){if(!o.primitiveType)continue;const e=this.projectDoc.isNodeAcceptingChild({node:t,child:o}),n=this.projectDoc.nodes.getById(t.parentId||"");if(!(t.primitiveType===Zn.sO.BUTTON||this.projectDoc.isNodeAcceptingChild({node:n,child:o})))return!1;if(!e)return!1}return!0}handleMoveOverButtonWithChildren(e){const{position:t,target:o}=e;if(!this.acceptingDropTarget||!t)return;const{domNode:n}=this.acceptingDropTarget;if(!n)return;const i=this.elementChildrenOfCurrentTarget.map((e=>e.getBoundingClientRect())),r=this.elementChildrenOfCurrentTarget.map((e=>(0,ni.AO)(e))),s=o.getBoundingClientRect(),c=this.projectUIState.stage.webComp.controlValues.scale,l=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(this.acceptingDropTarget.uidlNode.id,["flexDirection"]),{targetPointIdx:d,edgeData:p}=(0,bP.jV)(t,i,r,s,c,l.flexDirection);if(-1===d)return;const u=this.elementChildrenOfCurrentTarget[d],h=this.projectDoc.nodes.getById(u.dataset.compInstanceId||u.dataset.nodeId||"");if(!h)throw new Error("Button Drop error. Child node responsible for drop not found.");if("column"!==l.flexDirection){const{left:e,right:t}=p.distance;p.edge=e<t?"left":"right"}if("column"===l.flexDirection){const{top:e,bottom:t}=p.distance;p.edge=e<t?"top":"bottom"}(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.button.acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates.button.childAnchoringDrop={domNode:u,uidlNode:h,edgeData:p},e.dropFlowStates.button.dropPosition=null,e.dropFlowStates.button.dropOutsideTarget=null}))}dropIntoChildlessButton(e){const{draggedEntityContent:t,isVirtual:o,doc:n}=e;if(!n||o)return!1;const{dropPosition:i,acceptedDropTarget:r}=this.projectUIState.dropFlowStates.button;if(!r)return!1;if(!this.projectUIState.selection.componentId)return this.resetState(),!1;const{uidlNode:s}=r,{pressedKeys:a}=this.projectUIState.userInteractions,c=n.nodes.getById(s.id);var l;return(null===c||void 0===c?void 0:c.primitiveType)===Zn.sO.BUTTON&&"styles"in c&&(c.styles[$r.X7.DISPLAY]=new Yr.F({content:$r.r3.FLEX}),c.styles[$r.X7.FLEX_DIRECTION]=new Yr.F({content:aR.aF.ROW})),t.isNew?(this.nodeManagementFlow.addNodesToParentOrStage({dropPosition:"left-middle"===i?"before":"after",nodes:t.subHierarchy,keepOriginalParent:(null===(l=t.meta)||void 0===l?void 0:l.nodeType)===Zn.sO.ICON,parentId:s.id,useContentAsNode:!0,doc:n}),!0):a.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({dropPosition:"left-middle"===i?"before":"after",nodes:t.subHierarchy,targetId:s.id,useContentAsNode:!0,doc:n}),!0):(this.nodeManagementFlow.moveNodesToTarget({dropPosition:"left-middle"===i?"before":"after",nodes:t.subHierarchy,targetId:s.id,useContentAsNode:!0,doc:n}),!0)}dropIntoButtonWithChildren(e){const{doc:t,draggedEntityContent:o}=e;if(!t)return!1;const{childAnchoringDrop:n,acceptedDropTarget:i,dropOutsideTarget:r}=this.projectUIState.dropFlowStates.button;if(!i)return!1;if(!this.projectUIState.selection.componentId)return this.resetState(),!1;const{edgeData:s,uidlNode:a}=n||{},{pressedKeys:c}=this.projectUIState.userInteractions;let l=i.uidlNode;if(l.primitiveType!==Zn.sO.BUTTON){l=this.projectDoc.nodes.getById(l.parentId)||l}r&&(l=r.uidlNode);const d=s&&-1!==["left","top"].indexOf((null===s||void 0===s?void 0:s.edge)||"")?a:a?this.projectDoc.nodes.getNextSibling(a):null,p=l.id;var u;return o.isNew?(this.nodeManagementFlow.addNodesToParentOrStage({nodes:o.subHierarchy,parentId:p,keepOriginalParent:(null===(u=o.meta)||void 0===u?void 0:u.nodeType)===Zn.sO.ICON,nextSibling:d,doc:t}),!0):c.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:o.subHierarchy,targetId:p,copyBefore:d,doc:t}),!0):(this.nodeManagementFlow.moveNodesToTarget({nodes:o.subHierarchy,targetId:p,nextSibling:d,doc:t}),!0)}},gZ=(0,s.Z)(yZ.prototype,"projectDoc",[lZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fZ=(0,s.Z)(yZ.prototype,"nodeManagementFlow",[dZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bZ=(0,s.Z)(yZ.prototype,"projectUIState",[pZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IZ=(0,s.Z)(yZ.prototype,"dropElementHelper",[uZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vZ=(0,s.Z)(yZ.prototype,"nodeStyleManagementFlow",[hZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(yZ.prototype,"handleDrop",[m.P],Object.getOwnPropertyDescriptor(yZ.prototype,"handleDrop"),yZ.prototype),(0,s.Z)(yZ.prototype,"dropIntoChildlessButton",[m.P],Object.getOwnPropertyDescriptor(yZ.prototype,"dropIntoChildlessButton"),yZ.prototype),(0,s.Z)(yZ.prototype,"dropIntoButtonWithChildren",[m.P],Object.getOwnPropertyDescriptor(yZ.prototype,"dropIntoButtonWithChildren"),yZ.prototype),mZ=yZ));var wZ,NZ,jZ,SZ,DZ,TZ,OZ,FZ,CZ;wZ=(0,c.provide)("dropIntoListFlow"),NZ=(0,c.inject)("projectUIState"),jZ=(0,c.inject)("projectDoc"),SZ=(0,c.inject)("nodeManagementFlow"),wZ((TZ=class{constructor(){(0,i.Z)(this,"projectUIState",OZ,this),(0,i.Z)(this,"projectDoc",FZ,this),(0,i.Z)(this,"nodeManagementFlow",CZ,this),(0,r.Z)(this,"acceptingDropTarget",null),(0,r.Z)(this,"timeout",null),(0,r.Z)(this,"lastMovedAt",null),this.resetState()}resetState(){this.timeout&&clearTimeout(this.timeout),this.acceptingDropTarget=null,this.lastMovedAt=null,(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.list.acceptedDropTarget=null,e.dropFlowStates.list.childAnchoringDrop=null,e.dropFlowStates.list.dropPosition=null,e.dropFlowStates.list.dropOutsideTarget=null,e.dropFlowStates.list.dropIsDisabled=!1}))}moveOut(){this.resetState()}moveOver(e){const t=this.projectUIState.drag.currentMousePosition,o=this.projectUIState.stage.webComp.controlValues.scale;this.lastMovedAt&&t&&!(0,bP.NN)(this.lastMovedAt,t,10/o)&&!e.forced||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.handleMoveOver(e)),ol.vL))}handleMoveOver(e){this.timeout=null,this.lastMovedAt=this.projectUIState.drag.currentMousePosition;const{draggedEntity:t,customEv:o,position:n}=e;if(!t)return;if(!this.acceptingDropTarget||!o||!(o.target instanceof HTMLIFrameElement))return;const{domNode:i,uidlNode:r}=this.acceptingDropTarget;return i?"childrenIds"in r&&!Object.keys(r.childrenIds||{}).length?this.handleMoveOverEmptyList():this.handleMoveOverListWithChildren({draggedEntity:t,position:n,target:o.target}):void 0}handleMoveOverEmptyList(){(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.list.acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates.list.dropPosition="top-left",e.dropFlowStates.list.childAnchoringDrop=null,e.dropFlowStates.list.dropOutsideTarget=null}))}handleMoveOverListWithChildren(e){const{position:t,target:o,draggedEntity:n}=e;if(!this.acceptingDropTarget||!t)return;const{domNode:i}=this.acceptingDropTarget;if(!i)return;const r=Array.from(i.children).filter((e=>!n.content.subHierarchy.find((t=>e.dataset.nodeId===t.id)))),s=r.map((e=>null===e||void 0===e?void 0:e.getBoundingClientRect())),c=r.map((e=>(0,ni.AO)(e))),l=o.getBoundingClientRect(),d=this.projectUIState.stage.webComp.controlValues.scale,{targetPointIdx:p,edgeData:u}=(0,bP.jV)(t,s,c,l,d);if(-1===p)return;const h=r[p],m=this.projectDoc.nodes.getById(h.dataset.compInstanceId||h.dataset.nodeId||"");if(!m)return;const{top:y,bottom:g}=u.distance;u.edge=y<g?"top":"bottom",(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.list.acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates.list.childAnchoringDrop={domNode:h,uidlNode:m,edgeData:u},e.dropFlowStates.list.dropPosition=null,e.dropFlowStates.list.dropOutsideTarget=null}))}handleDraggedEntity(e){if(e.type!==cu.Z.SUB_HIERARCHY)return!1;return(0,Rp.a)(e.content.subHierarchy)===Zn.sO.LISTITEM}acceptsDOMElement(e){if(!(e instanceof HTMLElement))return this.acceptingDropTarget=null,!1;const t=this.projectDoc.nodes.getById(e.dataset.nodeId||"");return t&&t.primitiveType===Zn.sO.LIST?(this.acceptingDropTarget={domNode:e,uidlNode:t},!0):(this.acceptingDropTarget=null,!1)}handleDrop(e){const{dropPosition:t,acceptedDropTarget:o,dropOutsideTarget:n,childAnchoringDrop:i,dropIsDisabled:r}=this.projectUIState.dropFlowStates.list,s=this.projectUIState.selection.componentId;if(!o||!s||r)return!1;const{draggedEntity:a,isVirtual:c,doc:l}=e;return a.type===cu.Z.SUB_HIERARCHY&&(t&&!n?this.dropIntoChildlessList({draggedEntityContent:a.content,doc:l,isVirtual:c}):!!i&&this.dropIntoListWithChildren({draggedEntityContent:a.content,doc:l,isVirtual:c}))}dropIntoChildlessList(e){const{draggedEntityContent:t,isVirtual:o,doc:n}=e;if(!n||o)return!1;const{acceptedDropTarget:i}=this.projectUIState.dropFlowStates.list;if(!i)return!1;const{uidlNode:r}=i,{pressedKeys:s}=this.projectUIState.userInteractions;return t.isNew?(this.nodeManagementFlow.addNodesToParentOrStage({nodes:t.subHierarchy,parentId:r.id,doc:n}),!0):s.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:t.subHierarchy,targetId:r.id,doc:n}),!0):(this.nodeManagementFlow.moveNodesToTarget({nodes:t.subHierarchy,targetId:r.id,doc:n}),!0)}dropIntoListWithChildren(e){const{draggedEntityContent:t,doc:o}=e;if(!o)return!1;const{childAnchoringDrop:n,acceptedDropTarget:i}=this.projectUIState.dropFlowStates.list;if(!i)return!1;const{edgeData:r,uidlNode:s}=n||{},{pressedKeys:a}=this.projectUIState.userInteractions,c=r&&-1!==["left","top"].indexOf((null===r||void 0===r?void 0:r.edge)||"")?s:s?this.projectDoc.nodes.getNextSibling(s):null,l=i.uidlNode;return t.isNew?(this.nodeManagementFlow.addNodesToParentOrStage({nodes:t.subHierarchy,parentId:l.id,nextSibling:c,doc:o}),!0):a.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:t.subHierarchy,targetId:l.id,copyBefore:c,doc:o}),!0):(this.nodeManagementFlow.moveNodesToTarget({nodes:t.subHierarchy,targetId:l.id,nextSibling:c,doc:o}),!0)}},OZ=(0,s.Z)(TZ.prototype,"projectUIState",[NZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FZ=(0,s.Z)(TZ.prototype,"projectDoc",[jZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CZ=(0,s.Z)(TZ.prototype,"nodeManagementFlow",[SZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(TZ.prototype,"handleDrop",[m.P],Object.getOwnPropertyDescriptor(TZ.prototype,"handleDrop"),TZ.prototype),(0,s.Z)(TZ.prototype,"dropIntoChildlessList",[m.P],Object.getOwnPropertyDescriptor(TZ.prototype,"dropIntoChildlessList"),TZ.prototype),(0,s.Z)(TZ.prototype,"dropIntoListWithChildren",[m.P],Object.getOwnPropertyDescriptor(TZ.prototype,"dropIntoListWithChildren"),TZ.prototype),DZ=TZ));var EZ,xZ,_Z,MZ,PZ,AZ,kZ,UZ,RZ;EZ=(0,c.provide)("dropIntoTokenCategoryFlow"),xZ=(0,c.inject)("projectDoc"),_Z=(0,c.inject)("projectUIState"),MZ=(0,c.inject)("designLanguageManagementFlow"),EZ((AZ=class{constructor(){(0,i.Z)(this,"projectDoc",kZ,this),(0,i.Z)(this,"projectUIState",UZ,this),(0,i.Z)(this,"designLanguageManagementFlow",RZ,this),(0,r.Z)(this,"moveOver",vP()((e=>{const{draggedEntity:t,ev:o,position:n}=e;return this.handleMouseOverTokenCategory(t,o,n)}),ol.x1.SIXTY)),this.resetState()}resetState(){(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.tokenCategory.acceptedDropTarget=null,e.dropFlowStates.tokenCategory.dropAnchor=null}))}handleDraggedEntity(e){return e.type===cu.Z.TOKEN}acceptsDOMElement(e){var t;if(!(e instanceof HTMLElement))return!1;const o=e,n=e.closest("[data-category-id]"),i=null===n||void 0===n?void 0:n.getAttribute("data-category-id"),r=null===(t=this.projectUIState.drag.draggedEntity)||void 0===t?void 0:t.content;if(r&&r.token.categoryId!==i)return document.documentElement.style.cursor="no-drop",!1;if(!n)return!1;const s=Array.from(n.querySelectorAll("[data-token-id]")).reduce(((e,t)=>(e[t.dataset.tokenId]=t,e)),{});return!!o&&((0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.tokenCategory.acceptedDropTarget={domTokenCategory:o.closest("[data-category-id]"),domTokensFromCategory:s}})),document.documentElement.style.cursor="default",!0)}handleMouseOverTokenCategory(e,t,o){const n=this.projectUIState.dropFlowStates.tokenCategory.acceptedDropTarget;if(!n)return;if(e.type!==cu.Z.TOKEN)return;const{domTokensFromCategory:i}=n,r=e.content.token;let s=Object.values(i)[0],c="before";Object.keys(i).forEach((e=>{const{x:t,y:n}=i[e].getBoundingClientRect();switch(r.type){case"color":if(o.x>t&&o.y>n){s=i[e];const t=this.projectDoc.designLanguage.tokensById[e];c=r.position<t.position?"after":"before"}break;default:if(o.y>n){const{tokensById:t,textStyleSetsById:o}=this.projectDoc.designLanguage;s=i[e];const n=t[e]||o[e];c=r.position<n.position?"after":"before"}}})),s.dataset.tokenId!==e.content.token.id&&(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.tokenCategory.dropAnchor=c,e.dropFlowStates.tokenCategory.closestTokenElement=s}))}moveOut(){this.resetState()}handleDrop(e){const{dropAnchor:t,acceptedDropTarget:o,closestTokenElement:n}=this.projectUIState.dropFlowStates.tokenCategory;if(!t||!o||!n)return!1;const{draggedEntity:i,doc:r}=e;if(i.type!==cu.Z.TOKEN)return!1;const s=i.content.token,a=n.dataset.tokenId;return!!a&&(this.projectDoc.designLanguage.tokensById[a]?(this.designLanguageManagementFlow.changeTokenPosition({draggedTokenId:s.id,closestToDropTokenId:this.projectDoc.designLanguage.tokensById[a].id,direction:t,doc:r}),!0):!!this.projectDoc.designLanguage.textStyleSetsById[a]&&(this.designLanguageManagementFlow.changeTextStylePosition({draggedTokenId:s.id,closestToDropTokenId:this.projectDoc.designLanguage.textStyleSetsById[a].id,direction:t,doc:r}),!0))}},kZ=(0,s.Z)(AZ.prototype,"projectDoc",[xZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UZ=(0,s.Z)(AZ.prototype,"projectUIState",[_Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RZ=(0,s.Z)(AZ.prototype,"designLanguageManagementFlow",[MZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(AZ.prototype,"handleDrop",[m.P],Object.getOwnPropertyDescriptor(AZ.prototype,"handleDrop"),AZ.prototype),PZ=AZ));var ZZ,LZ,$Z,BZ,GZ,HZ,zZ,YZ,VZ;ZZ=(0,c.provide)("dropIntoNavbarFlow"),LZ=(0,c.inject)("projectUIState"),$Z=(0,c.inject)("navbarFlow"),BZ=(0,c.inject)("positioningService"),ZZ((HZ=class{constructor(){(0,i.Z)(this,"projectUIState",zZ,this),(0,i.Z)(this,"navbarFlow",YZ,this),(0,i.Z)(this,"positioningService",VZ,this),(0,r.Z)(this,"moveOver",vP()((e=>{var t;const{position:o}=e,n=null===(t=this.projectUIState.dropFlowStates.navbar.acceptingTab)||void 0===t?void 0:t.getBoundingClientRect();if(!n)return;const i=Math.abs(o.x-n.left)<Math.abs(o.x-n.right)?"before":"after";(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.navbar.dropPosition=i}))}),ol.x1.SIXTY)),this.resetState()}resetState(){(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.navbar.acceptingTab=null,e.dropFlowStates.navbar.dropPosition=null}))}handleDraggedEntity(e){return e.type===cu.Z.SUB_HIERARCHY&&e.content.hierarchyType===cu.h.COMPONENT||e.type===cu.Z.PAGE}acceptsDOMElement(e){if(!(e instanceof HTMLElement))return!1;if(e.dataset.tabId){const t=document.querySelector(`[data-tab-id="${e.dataset.tabId}"]`);return!!t&&((0,a.mutate)(this.projectUIState,(({dropFlowStates:e})=>{e.navbar.acceptingTab=t})),!0)}if("thq-navbar"===e.id){const e=this.navbarFlow.getTabIdsInOrder(),t=document.querySelector(`[data-tab-id="${e[e.length-1]}"]`);return!!t&&((0,a.mutate)(this.projectUIState,(({dropFlowStates:e})=>{e.navbar.acceptingTab=t})),!0)}return!1}moveOut(){this.resetState()}handleDrop(e){var t,o;const{dropPosition:n,acceptingTab:i}=this.projectUIState.dropFlowStates.navbar,{draggedEntity:r}=e;if(r.type===cu.Z.TOKEN||!n||!i)return!1;const s=(null===(t=r.content.meta)||void 0===t?void 0:t.dragComponentId)||(null===(o=r.content.meta)||void 0===o?void 0:o.dragPageId);if(!s)return!1;const a=this.navbarFlow.getCurrentTabs()[i.dataset.tabId],c=this.navbarFlow.getTabByEntityId(s);if(!a||(null===c||void 0===c?void 0:c.id)===a.id)return!1;if("before"===n){var l;const e=(null===(l=this.navbarFlow.getPreviousTab(a.id))||void 0===l?void 0:l.pos)||"0",t=(0,rp.Dd)(a.pos,e);c?this.navbarFlow.moveTab(c.id,t):this.navbarFlow.createNewTab({entityId:s,pos:t,forceSave:!0})}else{var d;const e=(null===(d=this.navbarFlow.getNextTab(a.id))||void 0===d?void 0:d.pos)||`${parseInt(a.pos)+Number.MAX_SAFE_INTEGER}`,t=(0,rp.Dd)(a.pos,e);c?this.navbarFlow.moveTab(c.id,t):this.navbarFlow.createNewTab({entityId:s,pos:t,forceSave:!0})}return!0}},zZ=(0,s.Z)(HZ.prototype,"projectUIState",[LZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YZ=(0,s.Z)(HZ.prototype,"navbarFlow",[$Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VZ=(0,s.Z)(HZ.prototype,"positioningService",[BZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(HZ.prototype,"handleDrop",[m.P],Object.getOwnPropertyDescriptor(HZ.prototype,"handleDrop"),HZ.prototype),GZ=HZ));var WZ,KZ,qZ,JZ,XZ,QZ,eL,tL,oL,nL,iL,rL;WZ=(0,c.provide)("dropIntoFolderFlow"),KZ=(0,c.inject)("projectDoc"),qZ=(0,c.inject)("projectUIState"),JZ=(0,c.inject)("folderManagementFlow"),XZ=(0,c.inject)("notificationsManagementFlow"),WZ((rL=new WeakMap,eL=class{constructor(){(0,i.Z)(this,"projectDoc",tL,this),(0,i.Z)(this,"projectUIState",oL,this),(0,i.Z)(this,"folderManagementFlow",nL,this),(0,i.Z)(this,"notificationsManagementFlow",iL,this),rL.set(this,{writable:!0,value:null}),(0,r.Z)(this,"handleDraggedEntity",(e=>e.type===cu.Z.FOLDER||e.type===cu.Z.SUB_HIERARCHY||e.type===cu.Z.PAGE)),(0,r.Z)(this,"moveOver",(()=>{})),this.resetState()}resetState(){(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.folder.acceptedDropTarget=null})),(0,Rd.Z)(this,rL)&&clearTimeout((0,Rd.Z)(this,rL)),(0,Zd.Z)(this,rL,null)}acceptsDOMElement(e){if(!(e instanceof HTMLElement))return!1;(0,Rd.Z)(this,rL)&&clearTimeout((0,Rd.Z)(this,rL));const t=e.closest("[data-folder-id]");if(!t)return!1;const o=this.projectUIState.drag.draggedEntity;if((null===o||void 0===o?void 0:o.type)!==cu.Z.FOLDER&&(null===o||void 0===o?void 0:o.type)!==cu.Z.PAGE&&(null===o||void 0===o?void 0:o.type)!==cu.Z.SUB_HIERARCHY)return!1;const n=t.dataset.folderId;if(!n)return!1;const i=this.projectDoc.folders.byId[n];if(!i)return!1;switch(o.type){case cu.Z.FOLDER:if(this.folderManagementFlow.getMultipleFoldersDescendants([o.content.entity.id]).includes(n))return!1;break}return Object.keys(i.children).length&&(0,Zd.Z)(this,rL,setTimeout((()=>{this.folderManagementFlow.updateFolderExpandStatus(n,!0)}),ol.Xh)),(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.folder.acceptedDropTarget=t})),!0}moveOut(){this.resetState()}handleDrop(e){const{draggedEntity:t}=e;if(t.type!==cu.Z.FOLDER&&t.type!==cu.Z.SUB_HIERARCHY&&t.type!==cu.Z.PAGE)return!1;const{acceptedDropTarget:o}=this.projectUIState.dropFlowStates.folder;if(!o)return!1;const n=o.dataset.folderId;if(!n)throw new Error("Folder ID not found in drop target");if(!this.projectDoc.folders.byId[n])throw new Error("Folder not found in project document");const i=this.folderManagementFlow.getRootParentFolderOfFolder(n).id;let r="",s="folder";switch(t.type){case cu.Z.FOLDER:{if(t.content.draggingForbidden)return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"This Folder cannot be moved."),!1;if(t.content.entity.id===n)return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Folder cannot be moved into itself."),!1;if(this.folderManagementFlow.getMultipleFoldersDescendants([t.content.entity.id]).includes(n))return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Folder cannot be moved into its descendant folders."),!1;const e=this.folderManagementFlow.getRootParentFolderOfFolder(t.content.entity.id).id;if(e===ut.D.PAGES&&"components"===i)return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Page folders cannot be moved into a Component folder."),!1;if(e===ut.D.COMPONENTS&&"pages"===i)return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Component folders cannot be moved into a Page folder."),!1;s="folder",r=t.content.entity.id;break}case cu.Z.PAGE:var a;if("components"===i)return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Pages cannot be moved into Component folders."),!1;s="page",r=null===(a=t.content.meta)||void 0===a?void 0:a.dragPageId;break;case cu.Z.SUB_HIERARCHY:var c;if("component"===t.content.hierarchyType&&"pages"===i)return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Components cannot be moved into Pages folders."),!1;s="component",r=null===(c=t.content.meta)||void 0===c?void 0:c.dragComponentId}return this.folderManagementFlow.moveChildToFolder({child:{[r]:s},targetFolderId:n}),(0,Rd.Z)(this,rL)&&(clearTimeout((0,Rd.Z)(this,rL)),(0,Zd.Z)(this,rL,null)),!0}},tL=(0,s.Z)(eL.prototype,"projectDoc",[KZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oL=(0,s.Z)(eL.prototype,"projectUIState",[qZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nL=(0,s.Z)(eL.prototype,"folderManagementFlow",[JZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iL=(0,s.Z)(eL.prototype,"notificationsManagementFlow",[XZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QZ=eL));var sL,aL,cL,lL,dL,pL,uL,hL,mL,yL,gL,fL,bL,IL,vL,wL;sL=(0,c.provide)("dropIntoAssetFolderFlow"),aL=(0,c.inject)("projectDoc"),cL=(0,c.inject)("projectUIState"),lL=(0,c.inject)("assetFoldersFlow"),dL=(0,c.inject)("folderManagementFlow"),pL=(0,c.inject)("notificationsManagementFlow"),uL=(0,c.inject)("assetsEditFlow"),sL((wL=new WeakMap,mL=class{constructor(){(0,i.Z)(this,"projectDoc",yL,this),(0,i.Z)(this,"projectUIState",gL,this),(0,i.Z)(this,"assetFoldersFlow",fL,this),(0,i.Z)(this,"folderManagementFlow",bL,this),(0,i.Z)(this,"notificationsManagementFlow",IL,this),(0,i.Z)(this,"assetsEditFlow",vL,this),wL.set(this,{writable:!0,value:null}),(0,r.Z)(this,"handleDraggedEntity",(e=>e.type===cu.Z.ASSET_FOLDER||e.type===cu.Z.SUB_HIERARCHY&&e.content.isNew||(null===e||void 0===e?void 0:e.type)===cu.Z.FILE||(null===e||void 0===e?void 0:e.type)===cu.Z.EDITABLE_FILE)),(0,r.Z)(this,"moveOver",(()=>{})),this.resetState()}resetState(){(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.assetFolder.acceptedDropTarget=null}))}acceptsDOMElement(e){if(!(e instanceof HTMLElement))return!1;(0,Rd.Z)(this,wL)&&clearTimeout((0,Rd.Z)(this,wL));const t=e.closest("[data-asset-folder-id");if(!t)return!1;const o=this.projectUIState.drag.draggedEntity,n=(null===o||void 0===o?void 0:o.type)===cu.Z.ASSET_FOLDER,i=(null===o||void 0===o?void 0:o.type)===cu.Z.SUB_HIERARCHY&&o.content.isNew||(null===o||void 0===o?void 0:o.type)===cu.Z.FILE||(null===o||void 0===o?void 0:o.type)===cu.Z.EDITABLE_FILE,r=(null===o||void 0===o?void 0:o.type)===cu.Z.EDITABLE_FILE;if(!n&&!i)return!1;const{draggingForbidden:s}=o.content;if(s)return!1;const c=t.dataset.assetFolderId,l=this.projectDoc.folders.byId[c||""];if(n){if(this.folderManagementFlow.getMultipleFoldersDescendants(o.content.selectedFolderIds).includes(l.id))return!1}return!(l.id===ut.D.PRIVATE_ASSETS&&!r)&&(c&&Object.keys(l.children).length&&(0,Zd.Z)(this,wL,setTimeout((()=>{this.folderManagementFlow.updateFolderExpandStatus(c,!0)}),ol.Xh)),(0,a.mutate)(this.projectUIState,(e=>{e.dropFlowStates.assetFolder.acceptedDropTarget=t})),!0)}moveOut(){this.resetState()}handleDrop(e){const{draggedEntity:t}=e,o=t.type===cu.Z.ASSET_FOLDER&&!t.content.draggingForbidden,n=t.type===cu.Z.SUB_HIERARCHY&&t.content.isNew||(null===t||void 0===t?void 0:t.type)===cu.Z.FILE||(null===t||void 0===t?void 0:t.type)===cu.Z.EDITABLE_FILE;if(!o&&!n)return!1;const{acceptedDropTarget:i}=this.projectUIState.dropFlowStates.assetFolder;if(!i)return!1;const r=i.dataset.assetFolderId||ut.D.PUBLIC_ASSETS,s=this.projectDoc.folders.byId[r];if(s.name===ut.D.FONTS&&s.parentId===ut.D.PUBLIC_ASSETS)return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Folders and assets cannot be moved into the 'fonts' folder."),!1;if(o){const e=t.content.selectedAssetIds,o=t.content.selectedFolderIds;if(o.find((e=>this.projectDoc.folders.byId[e].name===ut.D.FONTS&&this.projectDoc.folders.byId[e].parentId===ut.D.PUBLIC_ASSETS)))return this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Fonts folder cannot be moved."),!1;return e.find((e=>this.assetsEditFlow.isCustomFontDependency(e)))?(this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Custom fonts files cannot be moved."),!1):!this.assetFoldersFlow.moveIsDisabled(o,r)&&(this.assetFoldersFlow.moveAssetsToFolder({assetIds:e,targetFolderId:r}),this.assetFoldersFlow.moveFoldersToFolder({folderIds:o,targetFolderId:r}),0!==Object.keys(s.children).length&&this.folderManagementFlow.updateFolderExpandStatus(r,!0),!0)}if(n){const e=t.content.assets.map((e=>e.id));return e.find((e=>this.assetsEditFlow.isCustomFontDependency(e)))?(this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Custom fonts files cannot be moved."),!1):(this.assetFoldersFlow.moveAssetsToFolder({assetIds:e,targetFolderId:r}),0!==Object.keys(s.children).length&&this.folderManagementFlow.updateFolderExpandStatus(r,!0),!0)}return!1}},yL=(0,s.Z)(mL.prototype,"projectDoc",[aL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gL=(0,s.Z)(mL.prototype,"projectUIState",[cL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fL=(0,s.Z)(mL.prototype,"assetFoldersFlow",[lL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bL=(0,s.Z)(mL.prototype,"folderManagementFlow",[dL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IL=(0,s.Z)(mL.prototype,"notificationsManagementFlow",[pL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vL=(0,s.Z)(mL.prototype,"assetsEditFlow",[uL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hL=mL));var NL,jL,SL,DL,TL,OL,FL,CL,EL,xL,_L,ML,PL;NL=(0,c.provide)("dropElementHelper"),jL=(0,c.inject)("projectDoc"),SL=(0,c.inject)("projectUIState"),DL=(0,c.inject)("elementRefProvider"),TL=(0,c.inject)("notificationsManagementFlow"),OL=(0,c.inject)("nodeStyleManagmentFlow"),NL((CL=class{constructor(){(0,i.Z)(this,"projectDoc",EL,this),(0,i.Z)(this,"projectUIState",xL,this),(0,i.Z)(this,"elementRefProvider",_L,this),(0,i.Z)(this,"notificationsManagementFlow",ML,this),(0,i.Z)(this,"nodeStyleManagementFlow",PL,this)}elementSmallerOrSibling(e,t){var o,n;const i=this.projectUIState.drag.draggedEntity;if((null===i||void 0===i?void 0:i.type)!==cu.Z.SUB_HIERARCHY||i.content.isNew)return!1;if("contents"===getComputedStyle(e).display)return!1;const r=i.content.subHierarchy.map((e=>e.id));if(this.projectDoc.nodes.areNodesSiblings(r)){const e=this.projectDoc.nodes.getAncestors({nodeId:t,excludeRoot:!0,includePassedNode:!0});for(const o of[t,...e])if(this.projectDoc.nodes.areNodesSiblings([r[0],o]))return!0}const s=this.projectDoc.nodes.getById(t),a=(null===(o=i.content.meta)||void 0===o?void 0:o.width)||0,c=(null===(n=i.content.meta)||void 0===n?void 0:n.height)||0;let l=e.clientWidth,d=e.clientHeight;if((null===s||void 0===s?void 0:s.primitiveType)===Zn.sO.SLOT&&"contents"===getComputedStyle(e).display){const t=Array.from(e.childNodes).map((e=>e.dataset.nodeInstanceId||"")),o=(0,bP.tx)(t,[],this.elementRefProvider.getDomTargetNode);l=o.width,d=o.height}return a>l+2||c>d+2}processElementChildren(e,t){const{pressedKeys:o}=this.projectUIState.userInteractions;return Array.from(e).reduce(((e,n)=>{const{nodeId:i,compInstanceId:r,slotId:s,nodeInstanceId:a}=(0,Mg.MT)({element:n,dragging:!0})||{},c=s?this.projectDoc.nodes.getById(i||""):this.projectDoc.nodes.getById(r||i||"");if(!c)return e;if(!o.alt)for(const o of t)if(o.id===c.id)return e;return this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:c.id,key:"position",values:["absolute","fixed"]})||((null===c||void 0===c?void 0:c.primitiveType)===Zn.sO.COMPONENT?e.push(n.firstElementChild):n.dataset.nodeId?e.push(n):s?e.push(this.elementRefProvider.getDomTargetNode({nodeId:i||"",nodeInstanceId:a})):e.push(this.elementRefProvider.getDomTargetNode({nodeId:r||i||"",nodeInstanceId:a}))),e}),[])}handleMouseCloseToTargetEdge(e,t,o){if(!o)return;const{childAnchoringDrop:n,dropOutsideTarget:i}=this.projectUIState.dropFlowStates[t],{domNode:r}=o;let s=r,c=this.projectDoc.nodes.getById(s.dataset.nodeId),l=s.parentElement;if(e.shouldDropIntoComputedParent){const{edge:t}=e;for(;(null===(d=l)||void 0===d?void 0:d.getBoundingClientRect()[t])===s.getBoundingClientRect()[t]&&null!==(p=l.parentElement)&&void 0!==p&&p.dataset.nodeId;){var d,p;s=l,l=s.parentElement,c=this.projectDoc.nodes.getById(s.dataset.nodeId)}}if(!c||!l)return;const u=this.projectDoc.nodes.getById(l.dataset.nodeId);if(!u||u.primitiveType===Zn.sO.SLOT)return;if((null===n||void 0===n?void 0:n.uidlNode.id)===c.id&&(null===i||void 0===i?void 0:i.uidlNode.id)===u.id)return;const h=this.projectUIState.drag.draggedEntity;(0,a.mutate)(this.projectUIState,(n=>{n.dropFlowStates[t].acceptedDropTarget=o,n.dropFlowStates[t].newWrapperFlexDirection=this.getNewWrapperFlexDirection(t,e,u,c,h),n.dropFlowStates[t].dropOutsideTarget={domNode:l,uidlNode:u},n.dropFlowStates[t].childAnchoringDrop={domNode:s,uidlNode:c,edgeData:e,nodeInstanceId:s.dataset.nodeInstanceId},n.dropFlowStates[t].dropPosition=null}))}getNewWrapperFlexDirection(e,t,o,n,i){if(!i)return null;const{nodeHasStyleAtCurrentBreakpoint:r}=this.nodeStyleManagementFlow,s=-1!==["left","right"].indexOf(t.edge);let a=o,c=e;if("slot"===e){const e=this.projectDoc.nodes.getById(o.parentId||"");e&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:$r.X7.DISPLAY,values:["flex","inline-flex"]})&&(a=e,c="flexContainer"),e&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:$r.X7.DISPLAY,values:["block","inline-block","inline"]})&&(a=e,c="blockInlineContainer")}switch(c){case"flexContainer":let t="childrenIds"in a?Object.keys(a.childrenIds):[];if(i.type!==cu.Z.SUB_HIERARCHY||i.content.isNew||(t=t.filter((e=>!i.content.subHierarchy.some((t=>t.id===e))))),1===t.length&&"slot"!==e)return"parent";const o=r({nodeId:a.id,key:"flexDirection",values:["column"]});return o&&s?yl.sO.ROW:o||s?null:yl.sO.COLUMN;case"blockInlineContainer":const c=["block","flex"],l=i.content,d=null===l||void 0===l?void 0:l.subHierarchy[0].id,p=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(d,[$r.X7.DISPLAY])[$r.X7.DISPLAY],u=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(n.id,[$r.X7.DISPLAY])[$r.X7.DISPLAY];return-1!==c.indexOf(u.toString())&&s?yl.sO.ROW:-1===u.toString().indexOf("inline")||s||-1===(null===p||void 0===p?void 0:p.toString().indexOf("inline"))?-1!==u.toString().indexOf("inline")&&s&&p&&-1!==c.indexOf(p.toString())?yl.sO.ROW:null:yl.sO.COLUMN;default:return null}}checkForCircularDependencies(e,t){var o;return e.type!==cu.Z.SECTION_TEMPLATE&&e.type!==cu.Z.INTERACTIVE_ELEMENT&&(e.content.hierarchyType===cu.h.COMPONENT&&(!!this.projectDoc.components.checkIfComponentsHaveCircularDependency(null===(o=e.content.meta)||void 0===o?void 0:o.dragComponentId,t)&&(this.notificationsManagementFlow.createNotification(d.k$.ERROR,"Could not add component because it would create a circular dependency."),!0)))}},EL=(0,s.Z)(CL.prototype,"projectDoc",[jL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xL=(0,s.Z)(CL.prototype,"projectUIState",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_L=(0,s.Z)(CL.prototype,"elementRefProvider",[DL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ML=(0,s.Z)(CL.prototype,"notificationsManagementFlow",[TL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PL=(0,s.Z)(CL.prototype,"nodeStyleManagementFlow",[OL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FL=CL));var AL,kL,UL,RL,ZL,LL,$L,BL,GL,HL,zL,YL,VL,WL,KL,qL,JL,XL,QL;function e$(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function t$(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e$(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):e$(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}AL=(0,c.provide)("dropSimulatorFlow"),kL=(0,c.inject)("projectDoc"),UL=(0,c.inject)("projectUIState"),RL=(0,c.inject)("pointerInteractionManagementFlow"),ZL=(0,c.inject)("nodeStyleManagmentFlow"),LL=(0,c.inject)("elementRefProvider"),$L=(0,c.inject)("sharedbProjectSyncService"),BL=(0,c.inject)("nodeManagementFlow"),AL((XL=new WeakMap,QL=new WeakMap,HL=class{constructor(){(0,i.Z)(this,"projectDoc",zL,this),(0,i.Z)(this,"projectUIState",YL,this),(0,i.Z)(this,"pointerInteractionManagementFlow",VL,this),(0,i.Z)(this,"nodeStyleManagementFlow",WL,this),(0,i.Z)(this,"elementRefProvider",KL,this),(0,i.Z)(this,"dbSync",qL,this),(0,i.Z)(this,"nodeManagementFlow",JL,this),XL.set(this,{writable:!0,value:null}),QL.set(this,{writable:!0,value:null}),(0,r.Z)(this,"simulatedPatches",[])}rollbackAll(e){if(!this.simulatedPatches.length)return;const t=[];for(;this.simulatedPatches.length;){const e=this.simulatedPatches.pop();e&&t.push(...e.map(a.inversePatch).reverse())}(0,a.mutateFromPatches)(e,t)}rollback(e){this.rollbackAll(e||this.projectDoc)}forceDropStateRecompute(){this.pointerInteractionManagementFlow.forcefullyRecomputeMove()}createFutureContainerIndicator(e,t,o,n,i){var r;const s=document.createElement("div"),a=e.getBoundingClientRect(),c=null===t||void 0===t?void 0:t.getBoundingClientRect(),l="horizontal"===o?3*N.Dd:N.Dd,d="vertical"===o?3*N.Dd:N.Dd,p=this.projectUIState.stage.webComp.controlValues.scale,u=(0,ni.AO)(e),h={padding:`${N.N_.UNIT}`,display:"flex",flexDirection:"horizontal"===o?"row":"column",alignItems:"center",justifyContent:"before"===n?"flex-start":"flex-end",position:"absolute",top:(a.top-d-((null===c||void 0===c?void 0:c.top)||0))*u+"px",left:(a.left-l-((null===c||void 0===c?void 0:c.left)||0))*u+"px",width:(a.width+2*l)*u+"px",height:(a.height+2*d)*u+"px",border:i?(p<1?4:3)+"px solid rgba(0,0,0,0.2)":"",pointerEvents:"none"};return Object.assign(s.style,h),(0,Zd.Z)(this,QL,s),null===(r=e.parentElement)||void 0===r||r.appendChild(s),s}createEdgeIndicator(e){var t;const o=this.projectUIState.stage.webComp.controlValues.scale,n=o<1?"4px":o<3?"3px":"2px",i=null===(t=this.projectUIState.drag.draggedEntity)||void 0===t?void 0:t.content.meta,r="horizontal"===e?(null===i||void 0===i?void 0:i.height)||50:(null===i||void 0===i?void 0:i.width)||50,s=document.createElement("div"),a={width:"vertical"===e?`${r}px`:n,minWidth:n,margin:`${"vertical"===e?N.iY.HALF_UNIT/2+"px":0} ${"horizontal"===e?N.iY.HALF_UNIT/2+"px":0}`,height:"horizontal"===e?`${r}px`:n,minHeight:n,maxHeight:"100%",maxWidth:"100%",backgroundColor:"#0074f0",borderRadius:"4px",pointerEvents:"none"};return Object.assign(s.style,a),(0,Zd.Z)(this,XL,s),s}createContainerDropIndicator(e){this.disposeOfIndicator();const{childAnchoringDrop:t,acceptedDropTarget:o,dropIsDisabled:n,dropOutsideTarget:i,newWrapperFlexDirection:r,containerType:s}=e;if(n||!t)return;let a=(null===i||void 0===i?void 0:i.uidlNode)||(null===o||void 0===o?void 0:o.uidlNode);var c;"slot"===s&&(a=this.projectDoc.nodes.getById((null===(c=a)||void 0===c?void 0:c.parentId)||""));if(!a)return;const{styles:l,inheritedStyles:d,classesStyles:p,inheritedClassesStyles:u}=this.nodeStyleManagementFlow.getComputedStyleByKeyForCurrentBreakpoint(a.id,["flexDirection"]),h=l.flexDirection||p.flexDirection||d.flexDirection||u.flexDirection,{edge:m}=t.edgeData,y=this.elementRefProvider.getDomTargetNode({nodeId:t.uidlNode.id,nodeInstanceId:t.nodeInstanceId}),g=null===y||void 0===y?void 0:y.parentElement;if(!y||!g)return;const f=this.nodeManagementFlow.getFirstPositionedAncestorOfDOMNode(t.domNode),b=("flexContainer"===s||"slot"===s)&&"parent"!==r;if("left"===m||"right"===m){const e=this.createEdgeIndicator("horizontal"),o="left"===m?y:y.nextSibling;if("column"!==h)return o?void g.insertBefore(e,o):void g.appendChild(e);return void this.createFutureContainerIndicator(t.uidlNode.primitiveType===Zn.sO.COMPONENT?t.domNode:y,f.ancestorDOMElement,"horizontal","left"===m?"before":"after",b).appendChild(e)}const I=this.createEdgeIndicator("vertical"),v="top"===m?y:y.nextSibling;if("column"===h||"list"===s)return v?void g.insertBefore(I,v):void g.appendChild(I);this.createFutureContainerIndicator(t.uidlNode.primitiveType===Zn.sO.COMPONENT?t.domNode:y,f.ancestorDOMElement,"vertical","top"===m?"before":"after",b).appendChild(I)}shouldSimulateDrop(e,t){if(!t)return!0;if((null===e||void 0===e?void 0:e.type)!==cu.Z.SUB_HIERARCHY||e.content.isNew)return!1;if(this.projectUIState.userInteractions.pressedKeys.alt)return!1;const{childAnchoringDrop:o}=t;if(!o)return!1;if(t.newWrapperFlexDirection&&"parent"!==t.newWrapperFlexDirection)return!1;const n=e.content.subHierarchy.map((e=>e.id));return!!this.projectDoc.nodes.areNodesSiblings([...n,o.uidlNode.id])}disposeOfIndicator(){var e,t;null===(e=(0,Rd.Z)(this,XL))||void 0===e||e.remove(),null===(t=(0,Rd.Z)(this,QL))||void 0===t||t.remove()}simulateDrop(e){const{containerDropFlowState:t,containerType:o}=e;let n=this.shouldSimulateDrop(this.projectUIState.drag.draggedEntity,t);if(!n)return this.createContainerDropIndicator(t$(t$({},t),{},{containerType:o})),n;this.rollback();const i=(0,a.mutate)(this.projectDoc,(e=>{n=this.pointerInteractionManagementFlow.handleVirtualDrop({doc:e})}));return i&&i.length&&this.simulatedPatches.push(i),!t||null!==i&&void 0!==i&&i.length||n?this.disposeOfIndicator():this.createContainerDropIndicator(t$(t$({},t),{},{containerType:o})),n}},zL=(0,s.Z)(HL.prototype,"projectDoc",[kL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YL=(0,s.Z)(HL.prototype,"projectUIState",[UL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VL=(0,s.Z)(HL.prototype,"pointerInteractionManagementFlow",[RL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WL=(0,s.Z)(HL.prototype,"nodeStyleManagementFlow",[ZL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KL=(0,s.Z)(HL.prototype,"elementRefProvider",[LL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qL=(0,s.Z)(HL.prototype,"dbSync",[$L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JL=(0,s.Z)(HL.prototype,"nodeManagementFlow",[BL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GL=HL));var o$,n$,i$,r$,s$,a$,c$,l$,d$,p$,u$,h$;o$=(0,c.provide)("dropSimulatorWatcher"),n$=(0,c.inject)("projectUIState"),i$=(0,c.inject)("projectDoc"),r$=(0,c.inject)("dropSimulatorFlow"),o$((p$=new WeakMap,u$=new WeakMap,h$=new WeakMap,a$=class{constructor(){(0,i.Z)(this,"projectUIState",c$,this),(0,i.Z)(this,"projectDoc",l$,this),(0,i.Z)(this,"dropSimulatorFlow",d$,this),p$.set(this,{writable:!0,value:[]}),u$.set(this,{writable:!0,value:[]}),h$.set(this,{writable:!0,value:null})}handleDropFlowStateUpdate(e,t){(0,Rd.Z)(this,h$)&&clearTimeout((0,Rd.Z)(this,h$)),(0,Zd.Z)(this,h$,setTimeout((()=>{this.dropSimulatorFlow.simulateDrop({containerDropFlowState:e,containerType:t})}),ol.zc.STAGE))}subscribeForIndicatorChanges(){const e=(0,a.select)(this.projectUIState,["dropFlowStates/tokenCategory/**"],(()=>{(0,Rd.Z)(this,h$)&&clearTimeout((0,Rd.Z)(this,h$)),(0,Zd.Z)(this,h$,setTimeout((()=>{this.dropSimulatorFlow.simulateDrop({})}),ol.zc.OTHER))}),"DropSimulator2");(0,Rd.Z)(this,u$).push((()=>e.dispose()));const t=(0,a.select)(this.projectUIState,["dropFlowStates/flexContainer/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.flexContainer,"flexContainer")}),"DropSimulator3");(0,Rd.Z)(this,u$).push((()=>t.dispose()));const o=(0,a.select)(this.projectUIState,["dropFlowStates/blockInlineContainer/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.blockInlineContainer,"blockInlineContainer")}),"DropSimulator4");(0,Rd.Z)(this,u$).push((()=>o.dispose()));const n=(0,a.select)(this.projectUIState,["dropFlowStates/unknownContainer/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.unknownContainer,"unknownContainer")}),"DropSimulator5");(0,Rd.Z)(this,u$).push((()=>n.dispose()));const i=(0,a.select)(this.projectUIState,["dropFlowStates/slot/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.slot,"slot")}),"DropSimulatorSlot");(0,Rd.Z)(this,u$).push((()=>i.dispose()));const r=(0,a.select)(this.projectUIState,["userInteractions/pressedKeys/ctrl"],(()=>this.dropSimulatorFlow.forceDropStateRecompute()),"DropSimulatorCtrl");(0,Rd.Z)(this,u$).push((()=>r.dispose()));const s=(0,a.select)(this.projectUIState,["dropFlowStates/button/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.button,"button")}),"DropSimulator6");(0,Rd.Z)(this,u$).push((()=>s.dispose()));const c=(0,a.select)(this.projectUIState,["dropFlowStates/list/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.list,"list")}),"DropSimulator7");(0,Rd.Z)(this,u$).push((()=>c.dispose()))}unsubscribeFromIndicatorChanges(){(0,Rd.Z)(this,h$)&&clearTimeout((0,Rd.Z)(this,h$)),(0,Rd.Z)(this,u$).forEach((e=>e())),(0,Zd.Z)(this,u$,[])}listenForUpdates(){const e=(0,a.select)(this.projectUIState,["drag/draggedEntity"],(e=>{e.drag.draggedEntity?this.subscribeForIndicatorChanges():this.unsubscribeFromIndicatorChanges()}),"DropSimulatorSubManager");(0,Rd.Z)(this,p$).push((()=>e.dispose()))}stopListeningForUpdates(){this.unsubscribeFromIndicatorChanges(),(0,Rd.Z)(this,p$).forEach((e=>e())),(0,Zd.Z)(this,p$,[])}},c$=(0,s.Z)(a$.prototype,"projectUIState",[n$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l$=(0,s.Z)(a$.prototype,"projectDoc",[i$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d$=(0,s.Z)(a$.prototype,"dropSimulatorFlow",[r$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s$=a$));var m$,y$,g$,f$,b$,I$,v$,w$,N$,j$,S$,D$,T$,O$,F$,C$,E$,x$,_$,M$,P$,A$,k$,U$,R$,Z$,L$,$$,B$,G$,H$,z$,Y$=o(424879);m$=(0,c.provide)("asyncWatcherService"),y$=(0,c.inject)("projectDoc"),g$=(0,c.inject)("projectUIState"),f$=(0,c.inject)("nodeSelectionFlow"),b$=(0,c.inject)("componentManagementFlow"),I$=(0,c.inject)("pageManagementFlow"),v$=(0,c.inject)("rtcFlow"),w$=(0,c.inject)("webRTCState"),N$=(0,c.inject)("collaboratorManagementFlow"),j$=(0,c.inject)("bundlerService"),S$=(0,c.inject)("conflictManagementFlow"),D$=(0,c.inject)("projectFilesFlow"),T$=(0,c.inject)("navbarFlow"),O$=(0,c.inject)("globalAppState"),F$=(0,c.inject)("commentsFlow"),m$((z$=new WeakMap,E$=class{constructor(){(0,i.Z)(this,"projectDoc",x$,this),(0,i.Z)(this,"projectUIState",_$,this),(0,i.Z)(this,"nodeSelectionFlow",M$,this),(0,i.Z)(this,"componentManagementFlow",P$,this),(0,i.Z)(this,"pageManagementFlow",A$,this),(0,i.Z)(this,"rtcFlow",k$,this),(0,i.Z)(this,"webRTCState",U$,this),(0,i.Z)(this,"collaboratorManagementFlow",R$,this),(0,i.Z)(this,"bundlerService",Z$,this),(0,i.Z)(this,"conflictManagementFlow",L$,this),(0,i.Z)(this,"projectFilesFlow",$$,this),(0,i.Z)(this,"navbarFlow",B$,this),(0,i.Z)(this,"globalAppState",G$,this),(0,i.Z)(this,"commentsFlow",H$,this),(0,r.Z)(this,"internationalizationFlow",Pt.q.Instance),z$.set(this,{writable:!0,value:[]})}listenForUpdates(){const e=(0,a.select)(this.projectDoc,["nodes/byId/*"],((e,t)=>{t.forEach((t=>{const{pathArray:o,op:n,value:i,old:r}=t;if(3===o.length&&"remove"===n&&!i){const t=this.nodeSelectionFlow.getSelectedNodesIds();1===t.length&&o[2]===t[0]&&(this.nodeSelectionFlow.resetNodeSelection(),e.nodes.getById(r.parentId||"")&&this.nodeSelectionFlow.setNodeSelection({nodeId:r.parentId}))}}))}),"AsyncWatcherService1"),t=(0,a.select)(this.projectDoc,["internationalization/*","internationalization/**"],((e,t)=>{if(1===t.length&&"remove"===t[0].op&&3===t[0].pathArray.length&&"translations"===t[0].pathArray[1]){const o=t[0].pathArray[2],n=this.projectUIState.internationalization.currentLanguage;if((null===n||void 0===n?void 0:n.short)===o){const{mainLanguage:t}=e.internationalization;null!==t&&void 0!==t&&t.short&&this.internationalizationFlow.changeCurrentLanguage(t)}}}),"InternationalizationAsyncWatcher"),o=(0,a.select)(this.projectDoc,["components/byId/*"],((e,t)=>{t.forEach((e=>{const{op:t,pathArray:o}=e;"remove"===t&&3===o.length&&"components"===o[0]&&"byId"===o[1]&&this.componentManagementFlow.updateUIAfterCompDeletion(o[2])}))}),"AsyncWatcherService2"),n=(0,a.select)(this.projectDoc,["pages/byId/*"],((e,t)=>{t.forEach((e=>{const{op:t,pathArray:o}=e;"remove"===t&&3===o.length&&"pages"===o[0]&&"byId"===o[1]&&this.pageManagementFlow.updateUIAfterPageDeletion(o[2])}))}),"AsyncWatcherService3"),i=(0,a.select)(this.projectDoc,["cmsPages/byId/*"],((e,t)=>{t.forEach((e=>{const{op:t,pathArray:o}=e;"remove"===t&&3===o.length&&"cmsPages"===o[0]&&"byId"===o[1]&&this.pageManagementFlow.updateUIAfterPageDeletion(o[2])}))}),"AsyncWatcherService4"),r=(0,a.select)(this.projectUIState,["selection/componentId"],(({selection:e})=>{this.rtcFlow.notifySelectedComp(e.componentId)}),"AsyncComponentSelectionWatcher"),s=(0,a.select)(this.projectUIState,["selection/componentId"],(({selection:e})=>{this.rtcFlow.notifySelectedComp(e.componentId)}),"AsyncNodeSelectionWatcher"),c=(0,a.select)(this.projectUIState,Y$.C,(()=>{this.rtcFlow.notifySelectedNodes(this.nodeSelectionFlow.getSelectedNodesIds()),this.webRTCState.followedUserId&&this.nodeSelectionFlow.getSelectedNodesIds().length>0&&this.collaboratorManagementFlow.resetFollowedUserId()}),"AsyncNodeSelectionWatcher"),l=(0,a.select)(this.projectDoc,["projectFiles/lastSync","projectFiles/lastSync/*"],(()=>{this.bundlerService.hardRefresh()}),"AsyncProjectFilesSyncWatcher"),d=(0,a.select)(this.projectDoc,["projectFiles/conflicts/*"],(e=>{if(this.projectUIState.devMode.githubOperationInProgress)return;const t=this.projectUIState.devMode.selectedBranch,{conflictModalOpened:o}=this.projectUIState.devMode;e.projectFiles.conflicts[t]?this.conflictManagementFlow.openConflictModal():o&&this.conflictManagementFlow.closeConflictModal()}),"AsyncConflictsWatcher"),p=(0,a.select)(this.projectDoc,["projectFiles/local/*/byId/*"],(e=>{var t;const o=this.projectUIState.devMode.selectedBranch,n=this.projectUIState.devMode.selectedFile,i=this.projectUIState.devMode.githubBranches.underRename;if(!(!n||i||null!==(t=e.projectFiles.local[o])&&void 0!==t&&t.byId)&&!e.projectFiles.local[o].byId[n]){var r;const e=(null===(r=this.navbarFlow.getTabByEntityId(n))||void 0===r?void 0:r.id)||"";this.navbarFlow.deleteTab(e),this.projectFilesFlow.selectNextAvailableFile({fileToStartFrom:n})}}),"AsyncProjectFilesWatcher"),u=(0,a.select)(this.projectDoc,["comments/byId/**"],((e,t)=>{var o;const{op:n,value:i,pathArray:r}=t[0]||{},s=null===(o=this.globalAppState.user.userData)||void 0===o?void 0:o.id;if("add"===n&&3===r.length&&"comments"===r[0]&&"byId"===r[1]&&i){const e=i;if(e.userInfo.id===s)return;e.readBy[s]||this.commentsFlow.showNotificationForMentionedUser(e)}}),"commentsAsyncWatcher");(0,Rd.Z)(this,z$).push((()=>e.dispose()),(()=>o.dispose()),(()=>n.dispose()),(()=>r.dispose()),(()=>c.dispose()),(()=>l.dispose()),(()=>d.dispose()),(()=>p.dispose()),(()=>i.dispose()),(()=>s.dispose()),(()=>t.dispose()),(()=>u.dispose()))}stopListeningForUpdates(){(0,Rd.Z)(this,z$).forEach((e=>e()))}},x$=(0,s.Z)(E$.prototype,"projectDoc",[y$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_$=(0,s.Z)(E$.prototype,"projectUIState",[g$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M$=(0,s.Z)(E$.prototype,"nodeSelectionFlow",[f$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P$=(0,s.Z)(E$.prototype,"componentManagementFlow",[b$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A$=(0,s.Z)(E$.prototype,"pageManagementFlow",[I$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k$=(0,s.Z)(E$.prototype,"rtcFlow",[v$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U$=(0,s.Z)(E$.prototype,"webRTCState",[w$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R$=(0,s.Z)(E$.prototype,"collaboratorManagementFlow",[N$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z$=(0,s.Z)(E$.prototype,"bundlerService",[j$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L$=(0,s.Z)(E$.prototype,"conflictManagementFlow",[S$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$$=(0,s.Z)(E$.prototype,"projectFilesFlow",[D$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B$=(0,s.Z)(E$.prototype,"navbarFlow",[T$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G$=(0,s.Z)(E$.prototype,"globalAppState",[O$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H$=(0,s.Z)(E$.prototype,"commentsFlow",[F$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C$=E$));o(44428),o(164910),o(871738),o(711752),o(444509);class V$ extends Error{constructor(e){super(e),this.message=e||""}}const W$=(e,t)=>{const o={},{files:n,subFolders:i}=e;try{n.forEach((e=>{let n="";try{n="base64"===e.contentEncoding?decodeURIComponent(window.atob(e.content)):e.content}catch(r){n="base64"===e.contentEncoding?window.atob(e.content):e.content}const i=`${t?`${t}/`:""}${e.name}.${e.fileType}`;o[i]=n})),i.forEach((e=>{Object.assign(o,W$(e,t?`${t}/${e.name}`:e.name))}))}catch(r){console.error(`Could not flat github files structure: ${r}`)}return o};var K$,q$,J$,X$,Q$;function eB(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function tB(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?eB(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):eB(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}K$=(0,c.provide)("githubRepository"),q$=(0,c.inject)("requestMaker"),K$((X$=class{constructor(){(0,i.Z)(this,"requestMaker",Q$,this),(0,r.Z)(this,"basePath","/github")}async checkIfUserHasAccessToRepo(e,t,o){try{return(await this.requestMaker.makeRequest({method:pE.x.GET,path:`${this.basePath}/repo/exists/${e}/${o}${t?"/"+t:""}`})).hasAccess}catch(n){if(-1!==(null===n||void 0===n?void 0:n.message.toLowerCase().indexOf("bad credentials")))throw new V$("GitHub credentials are expired or you do not have enough permissions");throw new Error(`Could not check if user has access to repository: ${n}`)}}async getRepoContent(e,t){const{ref:o,repository:n,owner:i}=t;try{const t=await this.requestMaker.makeRequest({method:pE.x.GET,path:`${this.basePath}/content/${e}/${i}/${n}/${o}`});return W$(t)}catch(r){throw new Error(`Could not get repository content: ${r}`)}}async getCommits(e,t){return(await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/commits/${e}`,payload:JSON.stringify(t)})).map((e=>{var t,o,n,i;return{author:{name:null===(t=e.commit)||void 0===t||null===(o=t.author)||void 0===o?void 0:o.name,image:null===(n=e.author)||void 0===n?void 0:n.avatar_url},message:null===(i=e.commit)||void 0===i?void 0:i.message,sha:e.sha}}))}async getCommitDetails(e,t){try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/commits/details/${e}`,payload:JSON.stringify(t)})}catch(o){throw new Error(`Could not get commit details: ${o}`)}}async createBranch(e,t){try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/branch/${e}`,payload:JSON.stringify(t)})}catch(o){throw new Error(`Could not create new github branch: ${o}`)}}async mergeBranches(e,t){try{return await this.requestMaker.makeRequest({method:pE.x.PUT,path:`${this.basePath}/merge/${e}`,payload:JSON.stringify(t)})}catch(o){throw o}}async compareBranches(e,t){try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/branch/compare/${e}`,payload:JSON.stringify(t)})}catch(o){throw o}}async deleteBranch(e,t){try{return await this.requestMaker.makeRequest({method:pE.x.DELETE,path:`${this.basePath}/branch/${e}`,payload:JSON.stringify(t)})}catch(o){throw new Error(`Could not delete github branch: ${o}`)}}async getBranches(e,t,o){return await this.requestMaker.makeRequest({method:pE.x.GET,path:`${this.basePath}/branches/${e}/${t}/${o}`})}async deploy(e,t,o){const{repository:n,commitBranch:i,extraBranchParents:r=[],commitMessage:s,isPrivate:a,repositoryOwner:c}=o,l=tB(tB({},c?{repositoryOwner:c}:{}),{},{projectFolder:t,repository:n,extraBranchParents:r,isPrivate:a||!1,mainBranch:Ks.cY,commitBranch:i||Ks.cY,commitMessage:s||"Commit from TeleportHQ"}),d=await this.getSignedUrl(e);if(!d)throw new Error($r.Sg.Y_.SIGNED_URL_GENERATION_FAILED);const{signedUrl:p,uuid:u}=d;if(!(await fetch(p,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).ok)throw new Error($r.Sg.Y_.FAILED_TO_UPLOAD_PAYLOAD_TO_BUCKET);return await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/v2/${e}`,payload:JSON.stringify({uuid:u})})}async getSignedUrl(e){try{const{signedUrl:t,uuid:o}=await this.requestMaker.makeRequest({method:pE.x.GET,path:`${this.basePath}/${e}/signed-url`});return t&&o?{signedUrl:t,uuid:o}:(console.error("Received unexpected response from signed URL endpoint:",{signedUrl:t,uuid:o}),null)}catch(t){return console.error("Error fetching signed URL:",t),null}}},Q$=(0,s.Z)(X$.prototype,"requestMaker",[q$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J$=X$));var oB,nB,iB,rB,sB,aB,cB,lB,dB;o(76859);oB=(0,c.provide)("cloudComponentsRepository"),nB=(0,c.inject)("requestMaker"),iB=(0,c.inject)("projectDoc"),rB=(0,c.inject)("sentryService"),oB((aB=class{constructor(){(0,i.Z)(this,"requestMaker",cB,this),(0,i.Z)(this,"projectDoc",lB,this),(0,i.Z)(this,"sentryService",dB,this),(0,r.Z)(this,"basePath","/registry/")}async generateLink(e){const{compName:t,data:o}=e;try{return(await this.requestMaker.makeRequest({method:pE.x.POST,path:this.basePath+this.projectDoc.id+"/module",payload:JSON.stringify(o)}))[(0,PC.UO)(t)].component}catch(n){return n instanceof Error&&this.sentryService.captureException(new Error(`Cloud component generate link: ${n.message}`)),this.sentryService.captureException(new Error(`Cloud component generate link: ${n}`)),null}}async deleteCompModule(e){try{await this.requestMaker.makeRequest({method:pE.x.DELETE,path:this.basePath+this.projectDoc.id+"/module",payload:JSON.stringify(e)})}catch(t){this.sentryService.captureException(new Error(`Delete component module: ${t.message}`))}}},cB=(0,s.Z)(aB.prototype,"requestMaker",[nB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lB=(0,s.Z)(aB.prototype,"projectDoc",[iB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dB=(0,s.Z)(aB.prototype,"sentryService",[rB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sB=aB));var pB,uB,hB,mB,yB;pB=(0,c.provide)("integrationsRepository"),uB=(0,c.inject)("requestMaker"),pB((mB=class{constructor(){(0,i.Z)(this,"requestMaker",yB,this),(0,r.Z)(this,"basePath","/integrations")}async sendSlackReconnectNotification(e){var t;const o={parsedError:JSON.stringify(e,["message","error","arguments","type","name"]),error:JSON.stringify(e),documentHidden:null===(t=document)||void 0===t?void 0:t.hidden};try{await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/slack`,payload:JSON.stringify(o)})}catch(n){console.error("Could not send slack notification",n)}}},yB=(0,s.Z)(mB.prototype,"requestMaker",[uB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hB=mB));var gB,fB,bB,IB,vB,wB=o(608872);function NB(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function jB(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?NB(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):NB(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}gB=(0,c.provide)("externalResourceRepository"),fB=(0,c.inject)("requestMaker"),gB((IB=class{constructor(){(0,i.Z)(this,"requestMaker",vB,this),(0,r.Z)(this,"basePath","/external-resources")}async fetchExternalResource(e,t){try{return this.isUsingSecrets(t)?await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/${e}`,payload:JSON.stringify(t)}):await this.fetchResourceFromClient(t)}catch(o){console.error("Could not fetch external resource",o)}}async fetchExternalResourcePublicUrl(e,t){try{return await this.requestMaker.makeRequest({method:pE.x.POST,payload:JSON.stringify({baseUrl:t}),path:`${this.basePath}/publicUrl/${e}`})}catch(o){console.error("Could not fetch external resource",o)}}isUsingSecrets(e){const{baseUrl:t,headers:o={},body:n,queryParams:i}=e;if("string"!==typeof t&&"secret"===t.content.referenceType)return!0;if(this.secretIsInsideObject(i||{}))return!0;return!!this.secretIsInsideObject(o)||!!n&&this.secretIsInsideObject(n)}async fetchResourceFromClient(e){var t;const{baseUrl:o,path:n,body:i,method:r,queryParams:s={},returningHeaders:a}=e;if("string"!==typeof o)throw new Error("baseUrl must be a string");const c=(0,wB.lz)(o+(null!==n&&void 0!==n?n:"")),l=new URL(c);Object.keys(s).forEach((e=>l.searchParams.append(e,s[e])));const d=Object.keys(null!==(t=e.headers)&&void 0!==t?t:{}).reduce(((t,o)=>{var n,i,r;return t[o]=null!==(n=null===(i=e.headers)||void 0===i||null===(r=i[o])||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",t}),{}),p=await fetch(l,jB({method:null!==r&&void 0!==r?r:pE.x.GET,headers:d},i?{body:JSON.stringify(i)}:{})),u=await p.json();return a?{headers:jB({},p.headers),json:u}:u}secretIsInsideObject(e){return!(!Object.keys(e||{}).length||"object"!==typeof e)&&Object.keys(e||{}).some((t=>{const o=e[t];return!!o&&("string"!==typeof o&&(Array.isArray(o)?o.some((e=>{var t;return"string"!==typeof e&&"secret"===(null===(t=e.content)||void 0===t?void 0:t.referenceType)})):"content"in o&&"secret"===(null===(n=o.content)||void 0===n?void 0:n.referenceType)));var n}))}},vB=(0,s.Z)(IB.prototype,"requestMaker",[fB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bB=IB));var SB,DB,TB,OB,FB,CB,EB;function xB(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function _B(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?xB(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):xB(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const MB=45e3;SB=(0,c.provide)("aiRepository"),DB=(0,c.inject)("requestMaker"),TB=(0,c.inject)("sentryService"),SB((FB=class{constructor(){(0,i.Z)(this,"requestMaker",CB,this),(0,i.Z)(this,"sentryService",EB,this),(0,r.Z)(this,"basePath","/ai"),(0,r.Z)(this,"summariesFromText",new Map)}async generateContentForSection(e,t,o){try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/open-ai/generate-static-content`,payload:JSON.stringify({userPrompt:e,sectionPrompt:t,language:o}),timeout:MB})}catch(n){return this.sentryService.captureException(`[AI]: Could not generate content for section: ${n}`),{}}}async preloadSummaryFromText(e,t){await this.getSummaryFromText(e,t)}async getSummaryFromText(e,t){try{if(this.summariesFromText.has(t)){const e=this.summariesFromText.get(t);if(e&&(new Date).getTime()-e.createdAt.getTime()<3e5)return this.summariesFromText.get(t)}const n=await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/summary-from-text/${e}`,payload:JSON.stringify({text:t}),timeout:MB});if("string"!==typeof n)return this.summariesFromText.set(t,_B(_B({},n),{},{createdAt:new Date})),n;try{const e=JSON.parse(n);return e.summary||(e.summary=""),e.keywords||(e.keywords=[]),this.summariesFromText.set(t,_B(_B({},e),{},{createdAt:new Date})),e}catch(o){return this.sentryService.captureException(`[AI]: Could not parse summary response: ${o}`),{keywords:[],summary:""}}}catch(o){return this.sentryService.captureException(`[AI]: Could not generate summary from text: ${o}`),{keywords:[],summary:""}}}async getProperSectionsForPage(e,t,o,n){try{const i=await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/section-names-for-page/${e}`,payload:JSON.stringify({pageName:t,pageSummary:o,availableSections:n}),timeout:MB}),r=JSON.parse(i);return r.sections||(r.sections=[]),r.sections}catch(i){return this.sentryService.captureException(`[AI]: Could not get proper sections for page: ${i}`),[]}}async generateTextAlternativeForMultipleNodes(e,t,o,n,i,r){try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/text/alternative/multiple/${e}`,payload:JSON.stringify({metadata:t,pageName:n,command:o,newLanguage:r,summary:i}),timeout:MB})}catch(s){throw this.sentryService.captureException(`[AI]: Could not generate text alternatives for multiple nodes: ${s}`),s}}async generateTextAlternative(e,t,o,n,i,r,s){try{const a=await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/text/alternative/${e}`,payload:JSON.stringify({textToReplace:t,destinationElement:o,command:n,pageName:i,summary:r,language:s}),timeout:MB});return a.alternative||(a.alternative=""),a.alternative}catch(a){return this.sentryService.captureException(`[AI]: Could not generate text alternative: ${a}`),null}}},CB=(0,s.Z)(FB.prototype,"requestMaker",[DB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EB=(0,s.Z)(FB.prototype,"sentryService",[TB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OB=FB));const PB=["projectId"];var AB,kB,UB,RB,ZB;function LB(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function $B(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?LB(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):LB(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}AB=(0,c.provide)("vercelRepository"),kB=(0,c.inject)("requestMaker"),AB((RB=class{constructor(){(0,i.Z)(this,"requestMaker",ZB,this)}async checkIfVercelAliasIsAvailable(e){try{return await this.requestMaker.makeRequest({path:`/vercel/alias-availability/${e}`})}catch(t){throw new Error(`Could not find alias availability: ${t}`)}}async deploy(e){const{projectId:t}=e,o=(0,Up.Z)(e,PB);try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`/vercel/${t}/deploy`,payload:JSON.stringify($B($B({},o),{},{individualUpload:!0}))})}catch(n){throw new Error(`Could not deploy project to Vercel: ${n}`)}}async getBuildLogs(e,t){try{return await this.requestMaker.makeRequest({path:`/vercel/${e}/logs?deploymentUrl=${t}`,method:pE.x.GET})}catch(o){throw new Error(`Could not fetch logs from Vercel : ${o}`)}}async addCustomDomain(e,t,o){try{const n={domain:t,redirect:o};return await this.requestMaker.makeRequest({method:pE.x.POST,path:`/vercel/${e}/domain`,payload:JSON.stringify(n)})}catch(n){throw new Error(`Could not add custom domain : ${n}`)}}async removeCustomDomain(e){try{return await this.requestMaker.makeRequest({method:pE.x.DELETE,path:`/vercel/${e}/domain`})}catch(t){throw new Error(`${t}`)}}async verifyCustomDomain(e){try{return await this.requestMaker.makeRequest({method:pE.x.GET,path:`/vercel/${e}/domain/verify`})}catch(t){throw new Error(`${t}`)}}async deployToGitHub(e,t,o){const n={projectFolder:t,repository:o,mainBranch:"main",commitBranch:"main",commitMessage:"Commit from TeleportHQ"};try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`/github/${e}`,payload:JSON.stringify(n)})}catch(i){throw new Error(`Could not publish project to Github: ${i}`)}}async updateVercelAlias(e,t){const o={vercelAlias:t};return await this.requestMaker.makeRequest({method:pE.x.PUT,path:`/vercel/${e}`,payload:JSON.stringify(o)})}async getVercelDeploymentsWithPagination(e,t,o){try{return await this.requestMaker.makeRequest({method:pE.x.GET,path:`/vercel/${e}/deployments?next=${t}&perPage=${o}`})}catch(n){throw new Error(`Could not get all vercel deployments list: ${n}`)}}async addPasswordProtection(e,t){try{const o={protection:t};return await this.requestMaker.makeRequest({method:pE.x.PATCH,path:`/vercel/${e}/addPasswordProtectionDeployments`,payload:JSON.stringify(o)})}catch(o){throw new Error(`Could not update password: ${o}`)}}async deletePasswordProtection(e){try{return await this.requestMaker.makeRequest({method:pE.x.DELETE,path:`/vercel/${e}/removePasswordProtectionDeployments`})}catch(t){throw new Error(`Could not delete password: ${t}`)}}async deleteDeploymentById(e,t){const o={deploymentId:t};try{return await this.requestMaker.makeRequest({method:pE.x.DELETE,path:`/vercel/${e}/deleteDeployment`,payload:JSON.stringify(o)})}catch(n){throw new Error(`Could not delete deployment: ${n}`)}}async redeployDeploymentById(e,t,o,n){const i={isTeleportHosting:o,deploymentId:t,target:n};try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`/vercel/${e}/reDeploy`,payload:JSON.stringify(i)})}catch(r){throw new Error(`Could not redeploy deployment: ${r}`)}}async getRedeployStatus(e,t,o){const n={isTeleportHosting:o,deploymentId:t};try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`/vercel/${e}/reDeployStatus`,payload:JSON.stringify(n)})}catch(i){throw new Error(`Could not get redeploy status: ${i}`)}}async promoteToProduction(e,t,o){const n={isTeleportHosting:o,deploymentId:t};try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`/vercel/${e}/promoteToProduction`,payload:JSON.stringify(n)})}catch(i){throw new Error(`Could not promote deployment to production: ${i}`)}}},ZB=(0,s.Z)(RB.prototype,"requestMaker",[kB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UB=RB));var BB,GB,HB,zB,YB;BB=(0,c.provide)("backupRepository"),GB=(0,c.inject)("requestMaker"),BB((zB=class{constructor(){(0,i.Z)(this,"requestMaker",YB,this),(0,r.Z)(this,"basePath","/backup")}async createAutomatedBackup(e,t){const o={projectId:e,teamId:t};try{return await this.requestMaker.makeRequest({method:pE.x.POST,path:`${this.basePath}/automated`,payload:JSON.stringify(o)})}catch(n){throw new Error(`Could not create automated backup for project: ${n}`)}}},YB=(0,s.Z)(zB.prototype,"requestMaker",[GB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HB=zB));var VB,WB,KB=o(815253);function qB(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function JB(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?qB(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):qB(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}(0,c.provide)("transpilerService")((WB=new WeakMap,VB=class{constructor(){WB.set(this,{writable:!0,value:void 0})}async load(){if(!(0,Rd.Z)(this,WB))try{const e=await o.e(32123).then(o.bind(o,932123)).then((e=>e));return await e.default(),(0,Zd.Z)(this,WB,e.transformSync),(0,Rd.Z)(this,WB)}catch(e){throw console.error(`Failed to load js-compiler: ${e}`),new Error("Failed to load js-compiler")}return(0,Rd.Z)(this,WB)}async parseImports(e){await KB.S;const[t]=(0,KB.Q)(e);return t}async transpile(e,t){try{const o=await this.load();return e?o(e,{jsc:{target:"es2016",parser:t===x.Tv.TS||t===x.Tv.TSX?JB(JB({syntax:"typescript"},t===x.Tv.TSX&&{tsx:!0}),{},{dynamicImport:!1,decorators:!1}):{syntax:"ecmascript",jsx:!0,dynamicImport:!1,numericSeparator:!1,privateMethod:!0,functionBind:!1,exportDefaultFrom:!1,exportNamespaceFrom:!1,decorators:!1,decoratorsBeforeExport:!1,topLevelAwait:!1,importMeta:!1}}}).code:""}catch(o){throw console.error(o),o}}}));var XB;o(815184),o(831140);(0,c.provide)("fileDownloadService")(XB=class{constructor(){(0,r.Z)(this,"fileSaver",null)}async init(){this.fileSaver=(await o.e(46782).then(o.t.bind(o,646782,23))).default}async promptDownload(e,t){this.fileSaver||await this.init(),this.fileSaver.saveAs(e,t)}});o(6033),o(168185);var QB,eG,tG=o(690758);(0,c.provide)("packerService")((eG=new WeakMap,QB=class{constructor(){eG.set(this,{writable:!0,value:null})}loadWorker(){return(0,Rd.Z)(this,eG)||(0,Zd.Z)(this,eG,(0,tG.Ud)(new Worker(new URL(o.p+o.u(41113),o.b),{type:void 0}))),(0,Rd.Z)(this,eG)}async generateComponentCode(e,t){return this.loadWorker().generateComponentCode(e,t)}async generateReactComponent(e,t,o){return this.loadWorker().generateReactComponent(e,t,o)}async generateGlobalsComponent(e,t){return this.loadWorker().generateGlobalsComponent(e,t)}async generateProjectStyleSheet(e){return this.loadWorker().generateProjectStyleSheet(e)}async packAndPublish(e){return this.loadWorker().packAndPublish(JSON.parse(JSON.stringify(e)))}async generateCustomCodeProject(e){return this.loadWorker().generateCustomCodeProject(JSON.parse(JSON.stringify(e)))}}));var oG,nG,iG,rG,sG,aG,cG,lG,dG,pG,uG,hG,mG,yG,gG,fG,bG,IG,vG;o(113940),o(159364),o(305263);function wG(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function NG(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?wG(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):wG(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let jG;!function(e){e.LOADED="loaded",e.BUILDING="building",e.FAILED="failed",e.RUNNING="running",e.SUCCESS="success",e.TRANSFORM_FAILED="transform-failed"}(jG||(jG={}));oG=(0,c.provide)("bundlerService"),nG=(0,c.inject)("projectUIState"),iG=(0,c.inject)("projectDoc"),rG=(0,c.inject)("projectDownloadFlow"),sG=(0,c.inject)("assetsManagementFlow"),aG=(0,c.inject)("projectFilesFlow"),cG=(0,c.inject)("codeEditorFlow"),lG=(0,c.inject)("transpilerService"),dG=(0,c.inject)("sharedbProjectSyncService"),oG((uG=class{constructor(){(0,i.Z)(this,"projectUIState",hG,this),(0,i.Z)(this,"projectDoc",mG,this),(0,i.Z)(this,"projectDownloadFlow",yG,this),(0,i.Z)(this,"assetsManagementFlow",gG,this),(0,i.Z)(this,"projectFilesFlow",fG,this),(0,i.Z)(this,"codeEditorFlow",bG,this),(0,i.Z)(this,"transpiler",IG,this),(0,i.Z)(this,"dbSync",vG,this),(0,r.Z)(this,"frames",new Map),(0,r.Z)(this,"sendAssetMapping",(e=>{this.send({type:"asset-mapping",message:e})})),(0,r.Z)(this,"sendFiles",(async e=>{const t=await this.processFiles(e);this.send({type:"add-files",message:{files:t,entry:Ks.qG}})})),(0,r.Z)(this,"updateFile",(async(e,t)=>{this.send({type:"file-update",message:{fileName:e,content:(await this.processFile(e,t)).content}})})),(0,r.Z)(this,"deleteFile",(e=>{this.send({type:"file-delete",message:{fileName:e}})})),(0,r.Z)(this,"createFile",(e=>{this.send({type:"file-create",message:{fileName:e}})})),(0,r.Z)(this,"renameFile",(async(e,t,o)=>{this.send({type:"file-rename",message:{oldFileName:e,file:{name:t,content:(await this.processFile(t,o)).content}}})})),(0,r.Z)(this,"loadFiles",(async e=>{const t=this.projectUIState.devMode.selectedBranch,o=this.projectDoc.projectFiles.flatFiles({assets:this.projectDoc.assets.getAssetsForCustomCode(),branch:t}),n={type:"add-files",message:{files:await this.processFiles(o),entry:Ks.qG}},i={event:"shutdown"};e?(this.sendToFrame(i,e),this.sendToFrame(n,e)):(this.send(i),this.send(n))})),(0,r.Z)(this,"sendToFrame",((e,t)=>{var o,n,i;null===(o=this.frames.get(t))||void 0===o||null===(n=o.frame)||void 0===n||null===(i=n.contentWindow)||void 0===i||i.postMessage(NG(NG({},e),{},{identifier:t}),"*")})),(0,r.Z)(this,"addExternalDependency",(e=>{this.dbSync.mutate(this.projectDoc,(({projectFiles:e})=>{e.isAddingExternalDependency=iw.B.ADDING})),this.send({type:"add-dependency",message:e})})),(0,r.Z)(this,"unMountFrame",(e=>{this.frames.delete(e)})),(0,r.Z)(this,"unMountAllFrames",(()=>this.frames=new Map)),(0,r.Z)(this,"send",(e=>{for(const[t]of this.frames)this.sendToFrame(e,t)})),(0,r.Z)(this,"processFiles",(async e=>(await Promise.all(Object.keys(e).map((t=>this.processFile(t,e[t]))))).reduce(((e,t)=>(e[t.fileName]=t.content,e)),{}))),(0,r.Z)(this,"processFile",(async(e,t)=>{await this.transpiler.load();try{const o=(0,kn.extname)(e).substring(1);return(0,AS.YP)(o)?{fileName:e,content:await this.transpiler.transpile(t,o)}:{fileName:e,content:t}}catch(o){throw this.send({type:"file-error",message:`${e} \n e`}),o}})),(0,r.Z)(this,"loadExports",(e=>{this.send({type:"load-exports",message:{depName:e}})})),(0,r.Z)(this,"listener",(async e=>{const{data:t}=e,{type:o,message:n,identifier:i}=t;if(null!==t&&void 0!==t&&t.bundler)switch(o){case"bundler-status":{const{status:e}=n;await this.transpiler.load(),this.codeEditorFlow.handleEditorBundleStatusChange(e),e===jG.LOADED&&this.loadFiles(i),e===jG.SUCCESS&&((0,a.mutate)(this.projectUIState,(e=>{e.devMode.navigation={}})),await this.projectFilesFlow.generateDevComponents());break}case"url-change":{const{url:e,backward:t,forward:o}=n;(0,a.mutate)(this.projectUIState,(n=>{const r={url:new URL(e).pathname,forward:o,backward:t};n.devMode.navigation[i]=r}));break}case"missing-files":this.projectUIState.devMode.bundlerStatus&&this.loadFiles(i);break;case"console":break;case"package-failed":this.dbSync.mutate(this.projectDoc,(({projectFiles:e})=>{e.isAddingExternalDependency=iw.B.FAILED})),(0,a.mutate)(this.projectUIState,(e=>{e.devMode.packageExports=null}));break;case"importmap-update":{const{message:e}=t;this.projectDoc.projectFiles.isAddingExternalDependency===iw.B.ADDING&&(this.dbSync.mutate(this.projectDoc,(({projectFiles:e})=>e.isAddingExternalDependency=iw.B.SUCCESS)),this.projectFilesFlow.updateImportMap(e));break}case"package-json":{const{message:e}=t,o=(null===e||void 0===e?void 0:e.packageJSON)||{exports:{}},n=Object.keys(o.exports).map((e=>"."===e?`${o.name}@${o.version}`:`${o.name}@${(0,kn.join)(o.version,e)}`));(0,a.mutate)(this.projectUIState,(e=>e.devMode.packageExports=n));break}default:0}}))}async registerIFrame(e,t){this.frames.set(t,{frame:e,nav:{}}),this.sendToFrame({type:"handshake",message:{skipTranspile:!0,devTools:!0}},t)}hardRefresh(e){if(e)return this.sendToFrame({type:"hard-refresh"},e),void this.frames.delete(e);this.send({type:"hard-refresh"}),this.frames.clear()}},hG=(0,s.Z)(uG.prototype,"projectUIState",[nG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mG=(0,s.Z)(uG.prototype,"projectDoc",[iG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yG=(0,s.Z)(uG.prototype,"projectDownloadFlow",[rG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gG=(0,s.Z)(uG.prototype,"assetsManagementFlow",[sG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fG=(0,s.Z)(uG.prototype,"projectFilesFlow",[aG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bG=(0,s.Z)(uG.prototype,"codeEditorFlow",[cG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IG=(0,s.Z)(uG.prototype,"transpiler",[lG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vG=(0,s.Z)(uG.prototype,"dbSync",[dG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pG=uG));var SG;(0,c.provide)("contentDiffingService")(SG=class{constructor(){(0,r.Z)(this,"diffComputer",void 0)}computeDiff(e="",t=""){if(!this.diffComputer)throw new Error("Diff computer was not loaded");return new(0,this.diffComputer)(e.split("\n"),t.split("\n"),{shouldComputeCharChanges:!0,shouldPostProcessCharChanges:!0,shouldIgnoreTrimWhitespace:!1,shouldMakePrettyDiff:!0,maxComputationTime:5e3}).computeDiff().changes.reduce(((e,t)=>{const{originalStartLineNumber:o,originalEndLineNumber:n,modifiedStartLineNumber:i,modifiedEndLineNumber:r}=t,s=(0,ni.Ox)(),a=Math.floor((n+o)/2),c=Math.floor((r+i)/2);return e.baseDiffs[s]={startLine:o,endLine:n,middleLine:a,negativeRange:n<o},e.updatedDiffs[s]={startLine:i,endLine:r,middleLine:c,negativeRange:r<i},e}),{baseDiffs:{},updatedDiffs:{}})}async loadDiffComputer(){if(this.diffComputer)return this.diffComputer;const{DiffComputer:e}=await o.e(29915).then(o.bind(o,629915));return this.diffComputer=e,this.diffComputer}});var DG,TG=o(451837);const OG="@thq-prop-";(0,c.provide)("propsDetectionService")(DG=class{constructor(){(0,r.Z)(this,"parser",void 0)}async detectPropsInContent(e,t){this.parser||await this.loadParser();const o=[...this.parser.defaultHandlers,(e,t,o)=>this.customTypesHandler(e,t,o)],{props:n}=this.parser.parse(e,void 0,o,{filename:t});return Object.keys(n).reduce(((e,t)=>{var o,i,r,s;const a=n[t],c=null===(o=a.defaultValue)||void 0===o?void 0:o.value,l=a.customPropType||(null===(i=a.type)||void 0===i?void 0:i.name)||(null===(r=a.tsType)||void 0===r?void 0:r.type)||(null===(s=a.flowType)||void 0===s?void 0:s.type)||"string";e[t]={type:l,defaultValue:c?JSON.parse(c):""};const{elements:d,name:u}=a.tsType||{};return l===p.t_.LIST&&"union"===u&&d?(e[t].options=d.map((e=>{let t=e.value;const o=t.startsWith("'")||t.startsWith('"'),n=t.endsWith("'")||t.endsWith('"');return o&&(t=t.substring(1)),n&&(t=t.substring(0,t.length-1)),t})),e):e}),{})}async loadParser(){this.parser=await Promise.all([o.e(14990),o.e(95375)]).then(o.bind(o,195375))}customTypesHandler(e,t,o){var n;const{getFlowTypeFromReactComponent:i}=this.parser.utils,r=i(t,o);if(!r)return;const s=r.value.typeName.name,a=this.findPropsInterfaceInAST(t,s),c=null===a||void 0===a||null===(n=a.body)||void 0===n?void 0:n.body;if(null!==c&&void 0!==c&&c.length)for(let d=0;d<c.length;d++){var l;const t=c[d];if(!TG.namedTypes.TSPropertySignature.check(t))continue;const o=t.key.name;if(!o)continue;const n=null===(l=t.leadingComments)||void 0===l?void 0:l.find((e=>{var t,o;return TG.namedTypes.CommentLine.check(e)&&-1!==(null===(t=e.value)||void 0===t||null===(o=t.trim())||void 0===o?void 0:o.indexOf(OG))})),i=this.getCustomTypeFromValue(null===n||void 0===n?void 0:n.value);if(!i)continue;const r=e._props.get(o);r?(r.customPropType=i,e._props.set(o,r)):e._props.set(o,{customPropType:i})}}findPropsInterfaceInAST(e,t){var o;const n="program";if(e.name!==n&&!e.parent)return null;for(;e.name!==n&&e.parent;)e=e.parent;return e.name===n&&null!==(o=e.value)&&void 0!==o&&o.body?e.value.body.find((e=>TG.namedTypes.TSInterfaceDeclaration.check(e)&&e.id.name===t)):null}getCustomTypeFromValue(e){if(!e)return null;const t=e.trim();if(0!==t.indexOf(OG))return null;switch(t.replace(OG,"").toLowerCase()){case"text":return p.t_.STRING;case"color":return p.t_.COLOR;case"multiline":return p.t_.MULTILINE;case"number":return p.t_.NUMBER;case"bool":return p.t_.BOOLEAN;case"list":return p.t_.LIST;default:return null}}});var FG=o(551344),CG=o.n(FG),EG=o(434772),xG=o.n(EG);["base","components","utilities"].reduce(((e,t)=>e+=`@tailwind ${t};\n`),"");const _G={theme:{extend:{}},plugins:[]};var MG,PG,AG,kG,UG,RG,ZG,LG,$G,BG,GG=JSON.parse('{"accent":{"themeValuesKey":["colors"]},"align":{"values":["baseline","top","bottom","middle","text-top","text-bottom","sub","supper"]},"animate":{"themeValuesKey":["animation"]},"aspect":{"themeValuesKey":["aspectRatio"]},"auto-cols":{"values":["auto","min","max","fr"]},"auto-rows":{"values":["auto","min","max","fr"]},"basis":{"themeValuesKey":["flexBasis"]},"backdrop-blur":{"themeValuesKey":["backdropBlur"]},"backdrop-brightness":{"themeValuesKey":["backdropBrightness"]},"backdrop-contrast":{"themeValuesKey":["backdropContrast"]},"backdrop-grayscale":{"themeValuesKey":["backdropGrayscale"]},"backdrop-hue-rotate":{"themeValuesKey":["backdropHueRotate"]},"backdrop-invert":{"themeValuesKey":["backdropInvert"]},"backdrop-opacity":{"themeValuesKey":["backdropOpacity"]},"backdrop-saturate":{"themeValuesKey":["backdropSaturate"]},"backdrop-sepia":{"themeValuesKey":["backdropSepia"]},"blur":{"values":["none","sm","DEFAULT","md","lg","xl","2xl","3xl"]},"bg":{"cssKey":"backgroundColor","themeValuesKey":["backgroundColor","backgroundPosition","backgroundSize","backgroundImage"],"values":["fixed","local","scroll","repeat","no-repeat","repeat-x","repeat-y","round","space","none"]},"bg-clip":{"values":["padding","border","content","text"]},"bg-origin":{"values":["padding","border","content"]},"block":{},"border":{"values":["solid","dashed","dotted","double","hidden","none","collapse","separate"],"themeValuesKey":["borderColor","borderWidth"]},"border-spacing":{"themeValuesKey":["spacing"]},"border-x":{"values":["DEFAULT","0","2","4","8"],"themeValuesKey":["borderColor"]},"border-y":{"values":["DEFAULT","0","2","4","8"],"themeValuesKey":["borderColor"]},"bottom":{"themeValuesKey":["spacing"]},"box-decoration":{"values":["clone, slice"]},"box":{"values":["border","content"]},"brightness":{"themeValuesKey":["brightness"]},"break":{"values":["normal","words","all"]},"break-after":{"values":["auto","avoid","all","avoid-page"]},"break-before":{"values":["auto","avoid","all","avoid-page"]},"break-inside":{"values":["auto","avoid","avoid-page","avoid-column"]},"caret":{"themeValuesKey":["caretColor"]},"clear":{"values":["left","right","both","none"]},"col-span":{"themeValuesKey":["columns"]},"col":{"themeValuesKey":["gridColumn"]},"col-start":{"themeValuesKey":["gridColumnStart"]},"col-end":{"themeValuesKey":["gridColumnEnd"]},"container":{},"content-none":{},"columns":{"themeValuesKey":["columns"]},"content":{"values":["start","end","center","between","around","evenly"]},"contents":{},"contrast":{"themeValuesKey":["contrast"]},"cursor":{"themeValuesKey":["cursor"]},"decoration":{"themeValuesKey":["textDecorationColor"]},"delay":{"themeValuesKey":["transitionDelay"]},"drop-shadow":{"themeValuesKey":["dropShadow"]},"duration":{"themeValuesKey":["transitionDuration"]},"ease":{"themeValuesKey":["transitionTimingFunction"]},"fill":{"themeValuesKey":["fill"]},"float":{"values":["right","left","none"]},"flex":{"values":["DEFAULT","1","auto","initial","none","row","row-reverse","col","col-reverse"]},"flex-wrap":{"values":["DEFAULT","reverse","nowrap"]},"font":{"themeValuesKey":["fontWeight"],"values":["sans","mono","serif"]},"flow-root":{},"gap":{"themeValuesKey":["gap"]},"gap-x":{"themeValuesKey":["gap"]},"gap-y":{"themeValuesKey":["gap"]},"grayscale":{"values":["DEFAULT","0"]},"grid":{},"grid-cols":{"themeValuesKey":["gridTemplateColumns"]},"grid-rows":{"themeValuesKey":["gridTemplateRows"]},"grid-flow":{"values":["row","col","dense","row-dense","col-dense"]},"grow":{"values":["DEFAULT","0"]},"height":{"themeValuesKey":["height"]},"hue-rotate":{"themeValuesKey":["hueRotate"]},"hidden":{},"inline-flex":{},"inline-table":{},"inline-grid":{},"inline":{},"inline-block":{},"inset":{"themeValuesKey":["spacing"]},"inset-x":{"themeValuesKey":["spacing"]},"inset-y":{"themeValuesKey":["spacing"]},"indent":{"themeValuesKey":["textIndent"]},"invert":{"themeValuesKey":["invert"]},"invisible":{},"isolate":{},"isolation-auto":{},"items":{"values":["start","end","center","baseline","stretch"]},"justify":{"values":["start","end","center","between","around","evenly"]},"justify-items":{"values":["start","end","center","stretch"]},"justify-self":{"values":["auto","start","end","center","stretch"]},"leading":{"themeValuesKey":["lineHeight"]},"list":{"values":["none","disc","decimal","outside","inside"]},"list-item":{},"left":{"themeValuesKey":["spacing"]},"m":{"themeValuesKey":["spacing"]},"mt":{"themeValuesKey":["spacing"]},"mb":{"themeValuesKey":["spacing"]},"mr":{"themeValuesKey":["spacing"]},"ml":{"themeValuesKey":["spacing"]},"mx":{"themeValuesKey":["spacing"]},"my":{"themeValuesKey":["spacing"]},"min-w":{"values":["0","full","min","max","fix"]},"max-w":{"values":["0","none","xs","sm","md","lg","xl","2xl","3xl","4xl","full","min","max","fit"]},"min-h":{"values":["0","full","min","max","fit","screen"]},"max-h":{"themeValuesKey":["spacing"]},"object":{"themeValuesKey":["objectPosition"]},"opacity":{"themeValuesKey":["opacity"]},"order":{"themeValuesKey":["order"]},"origin":{"themeValuesKey":["transformOrigin"]},"outline":{"themeValuesKey":["outlineColor"],"values":["DEFAULT","dashed","dotted","double","hidden","none"]},"outline-offset":{"themeValuesKey":["outlineOffset"]},"overflow":{"values":["auto","hidden","clip","visible","scroll","x-auto","y-auto","x-hidden","y-hidden","x-clip","y-clip","x-visible","y-visible","x-scroll","y-scroll"]},"overscroll":{"values":["auto","contain","none","y-auto","y-contain","y-none","x-auto","x-contain","x-none"]},"p":{"themeValuesKey":["spacing"]},"pt":{"themeValuesKey":["spacing"]},"pb":{"themeValuesKey":["spacing"]},"pr":{"themeValuesKey":["spacing"]},"pl":{"themeValuesKey":["spacing"]},"px":{"themeValuesKey":["spacing"]},"py":{"themeValuesKey":["spacing"]},"place-content":{"values":["center","start","end","between","around","evenly","stretch"]},"place-items":{"values":["center","start","end","stretch"]},"place-self":{"values":["auto","center","start","end","stretch"]},"position":{"values":["static","fixed","absolute","relative","sticky"]},"ring":{"themeValuesKey":["ringWidth"]},"rounded":{"themeValuesKey":["borderRadius"]},"rotate":{"themeValuesKey":["rotate"]},"row":{"themeValuesKey":["gridRow"]},"row-start":{"themeValuesKey":["gridRowStart"]},"row-end":{"themeValuesKey":["gridRowEnd"]},"saturate":{"themeValuesKey":["saturate"]},"scale":{"themeValuesKey":["scale"]},"scroll":{"values":["auto","smooth"]},"scroll-m":{"themeValuesKey":["scrollMargin"]},"scroll-mx":{"themeValuesKey":["scrollMargin"]},"scroll-my":{"themeValuesKey":["scrollMargin"]},"scroll-p":{"themeValuesKey":["scrollPadding"]},"scroll-px":{"themeValuesKey":["scrollPadding"]},"scroll-py":{"themeValuesKey":["scrollPadding"]},"select":{"values":["none","all","text","auto"]},"sepia":{"themeValuesKey":["sepia"]},"skew-x":{"themeValuesKey":["skew"]},"skew-y":{"themeValuesKey":["skew"]},"shadow":{"themeValuesKey":["boxShadowColor"],"values":["DEFAULT","sm","md","lg","xl","2xl","inner","none"]},"space-x":{"themeValuesKey":["spacing"]},"space-y":{"themeValuesKey":["spacing"]},"self":{"values":["auto","start","end","center","stretch","baseline"]},"shrink":{"values":["DEFAULT","0"]},"stroke":{"themeValuesKey":["stroke"]},"table":{},"table-caption":{},"table-cell":{},"table-column":{},"table-column-group":{},"table-footer-group":{},"table-row-group":{},"table-row":{},"text":{"themeValuesKey":["fontSize","textColor"],"values":["left","center","right","justify","start","end","ellipsis","clip"]},"top":{"themeValuesKey":["spacing"]},"translate-x":{"themeValuesKey":["translate"]},"translate-y":{"themeValuesKey":["translate"]},"translate":{"themeValuesKey":["translate"]},"tracking":{"themeValuesKey":["letterSpacing"]},"transition":{"themeValuesKey":["transitionProperty"]},"truncate":{},"underline-offset":{"values":["auto","0","1","2","4","8"]},"uppercase":{},"lowercase":{},"capitalize":{},"normal-case":{},"visible":{},"w":{"themeValuesKey":["width"]},"whitespace":{"values":["normal","nowrap","pre","pre-line","pre-wrap"]},"will-change":{"themeValuesKey":["willChange"]},"z":{"themeValuesKey":["zIndex"]}}'),HG=o(869640),zG=o.n(HG);function YG(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function VG(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?YG(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):YG(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}MG=(0,c.provide)("tailwindService"),PG=(0,c.inject)("projectDoc"),AG=(0,c.inject)("projectUIState"),kG=(0,c.inject)("sentryService"),MG((BG=new WeakMap,RG=class{constructor(){(0,i.Z)(this,"projectDoc",ZG,this),(0,i.Z)(this,"projectUIState",LG,this),(0,i.Z)(this,"sentryService",$G,this),BG.set(this,{writable:!0,value:void 0}),(0,r.Z)(this,"getClassesFromTheme",((e,t,o)=>{Object.keys(e).forEach((n=>{const i=e[n];if(xG()(i))this.getClassesFromTheme(i,t,`${o}-${n}`);else if("DEFAULT"===n)t[`${o}`]="";else{if(Array.isArray(i))return void(t[`${o}-${n}`]="");t[`${o}-${n}`]=i}}))}))}loadWorker(){return(0,Rd.Z)(this,BG)||(0,Zd.Z)(this,BG,(0,tG.Ud)(new Worker(new URL(o.p+o.u(87054),o.b),{type:void 0}))),(0,Rd.Z)(this,BG)}convertStudioTokensToTailwind(e){return this.projectDoc.designLanguage.getCategoriesBySection(e).reduce(((e,t)=>{const o={};return this.projectDoc.designLanguage.getTokensByCategoryId(t.id).forEach((e=>o[e.name]=e.value)),e[t.name]=o,e}),{})}getTailwindConfig(){var e,t;const o=null===(e=this.projectDoc.designLanguage.getTokenWithRole("foreground-color"))||void 0===e?void 0:e.value,n=null===(t=this.projectDoc.designLanguage.getTokenWithRole("background-color"))||void 0===t?void 0:t.value,i=this.convertStudioTokensToTailwind("color"),r=this.convertStudioTokensToTailwind("layout");return CG()(_G,{theme:{extend:{colors:VG(VG(VG({},i),o&&{foreground:o}),n&&{background:n}),spacing:(null===r||void 0===r?void 0:r.Space)||{},borderRadius:(null===r||void 0===r?void 0:r.Radius)||{},scale:(null===r||void 0===r?void 0:r.Size)||{}}}})}getTailwindClassOptions(e){const t=zG()(VG({},e)).theme||{},o=GG,n={};return Object.keys(o).forEach((e=>{var i;o[e].values&&(null===(i=o[e].values)||void 0===i||i.forEach((t=>{"DEFAULT"===t?n[`${e}`]="":n[`${e}-${t}`]=""})));const r=o[e].themeValuesKey;null===r||void 0===r||r.forEach((o=>{const i=t[o];this.getClassesFromTheme(i,n,e)})),o[e].values||r||(n[`${e}`]="")})),n}generateTailwindClassOptions(){const e=this.getTailwindConfig(),t=this.getTailwindClassOptions(e);(0,a.mutate)(this.projectUIState,(({tailwind:e})=>{e.classOptions=t}))}async handleAutocompleteOptions(e,t,o,n){return await this.loadWorker().handleAutocompleteOptions(e,t,o,n)}async getStyleSheet(e){try{(0,a.mutate)(this.projectUIState,(e=>e.tailwind.building=!0));const t=this.getTailwindConfig(),o=await this.loadWorker().getStyleSheet(e,t);return(0,a.mutate)(this.projectUIState,(({tailwind:e})=>{e.building=!1})),o}catch(t){return this.sentryService.captureException(t),null}}},ZG=(0,s.Z)(RG.prototype,"projectDoc",[PG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LG=(0,s.Z)(RG.prototype,"projectUIState",[AG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$G=(0,s.Z)(RG.prototype,"sentryService",[kG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UG=RG));var WG,KG,qG,JG,XG;WG=(0,c.provide)("integrationsService"),KG=(0,c.inject)("integrationsRepository"),WG((JG=class{constructor(){(0,i.Z)(this,"integrationsRepository",XG,this)}async sendSlackReconnectNotification(e){try{this.integrationsRepository.sendSlackReconnectNotification(e)}catch(t){console.error("Could not send slack notification",t)}}},XG=(0,s.Z)(JG.prototype,"integrationsRepository",[KG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qG=JG));var QG,eH,tH,oH,nH,iH,rH,sH,aH,cH,lH,dH,pH;QG=(0,c.provide)("elementRefProvider"),eH=(0,c.inject)("projectDoc"),tH=(0,c.inject)("projectUIState"),QG((sH=new WeakMap,aH=new WeakMap,cH=new WeakMap,lH=new WeakMap,dH=new WeakMap,pH=new WeakMap,nH=class{constructor(){(0,i.Z)(this,"projectDoc",iH,this),(0,i.Z)(this,"projectUIState",rH,this),sH.set(this,{writable:!0,value:null}),aH.set(this,{writable:!0,value:null}),cH.set(this,{writable:!0,value:null}),lH.set(this,{writable:!0,value:{}}),dH.set(this,{writable:!0,value:{}}),pH.set(this,{writable:!0,value:{}}),(0,r.Z)(this,"getDomNodeElementRefByNodeId",(e=>{var t,o;const n=(0,Rd.Z)(this,dH)[e];if(!n)return null;const i=Object.values(n)[0];return(null===(t=this.nodeInstanceDomData)||void 0===t||null===(o=t[i])||void 0===o?void 0:o.domRef)||null})),(0,r.Z)(this,"getDomNodeElementRefByCompInstance",((e,t)=>{var o,n;const i=(0,Rd.Z)(this,dH)[e],r=null===i||void 0===i?void 0:i[t||"root"];return(null===(o=this.nodeInstanceDomData)||void 0===o||null===(n=o[r])||void 0===n?void 0:n.domRef)||null})),(0,r.Z)(this,"getDomElementNodeIdByNodeInstanceId",(e=>{const t=(0,Rd.Z)(this,lH)[e];return t?t.nodeId:null})),(0,r.Z)(this,"getDomElementNodeByNodeInstanceId",(e=>(0,Rd.Z)(this,pH)[e])),(0,r.Z)(this,"getDomElementCompInstanceIdByNodeInstanceId",(e=>{const t=(0,Rd.Z)(this,lH)[e];return t?"root"===t.componentInstanceId?null:t.componentInstanceId:null})),(0,r.Z)(this,"getFirstDomElementNodeInstanceIdByNodeId",(e=>{const t=Object.values((0,Rd.Z)(this,pH)).find((t=>t&&t.nodeId===e));return t?t.nodeInstanceId:null})),(0,r.Z)(this,"getDomNodeElementRefByInstanceId",(e=>{const t=(0,Rd.Z)(this,lH)[e];return t?t.domRef:null})),(0,r.Z)(this,"getDomTargetNode",(e=>{const{nodeId:t,nodeInstanceId:o}=e;let n=t,i=o;if(!n&&!i)return null;var r;if(n&&!i){if(i=null!==(r=this.getFirstDomElementNodeInstanceIdByNodeId(n))&&void 0!==r?r:void 0,!i){const e=(0,Rd.Z)(this,dH)[n];e&&(i=Object.values(e)[0])}}else if(!n&&i){var s;n=null!==(s=this.getDomElementNodeIdByNodeInstanceId(i))&&void 0!==s?s:void 0}if(!n||!i)return null;const a=this.projectDoc.nodes.getById(n);if(!a)return null;let c=this.getDomNodeElementRefByInstanceId(i);if(a.primitiveType!==Zn.sO.HTML_NODE&&a.primitiveType!==Zn.sO.CMS_RICHTEXT&&a.primitiveType!==Zn.sO.LOTTIE&&a.primitiveType!==Zn.sO.IFRAME&&a.primitiveType!==Zn.sO.GOOGLE_MAPS&&a.primitiveType!==Zn.sO.DEV_COMPONENT||(c=Ly(i)),!c)return null;return"component"===c.dataset.type&&c.childNodes[0]&&(c=c.childNodes[0]),a.primitiveType===Zn.sO.IFRAME?c.childNodes[0]:a.primitiveType===Zn.sO.OPTION?c.parentNode:c})),(0,r.Z)(this,"getNextSiblingForNodeInstanceId",(e=>{const t=(0,Rd.Z)(this,pH)[e];if(!t)return void console.error("No data found in nodeInstanceData for nodeInstanceId when getting the next sibling");const o=t.parentInstance;if(!o)return;const n=this.getDomElementNodeIdByNodeInstanceId(e);if(!n)return;const i=this.projectDoc.nodes.getById(n||"");if(!i)throw new Error(`Did not find a data node for dom node! Node id: ${n}`);const r=this.projectDoc.nodes.getNextSibling(i);if(!r)return;const s=this.getNodeInstanceForNodeIdInParentInstanceId(null===r||void 0===r?void 0:r.id,o.nodeInstanceId),a=o.children,c=a.findIndex((e=>e.nodeInstanceId===(null===s||void 0===s?void 0:s.nodeInstanceId)));return-1!==c?null===a||void 0===a?void 0:a[c]:void 0})),(0,r.Z)(this,"getPrevSiblingForNodeInstanceId",(e=>{const t=(0,Rd.Z)(this,pH)[e];if(!t)return void console.error("No data found in nodeInstanceData for nodeInstanceId when getting the next sibling");const o=t.parentInstance;if(!o)return;const n=this.getDomElementNodeIdByNodeInstanceId(e);if(!n)return;const i=this.projectDoc.nodes.getById(n);if(!i)throw new Error(`Did not find a data node for dom node! Node id: ${n}`);const r=this.projectDoc.nodes.getPrevSibling(i);if(!r)return;const s=this.getNodeInstanceForNodeIdInParentInstanceId(r.id,o.nodeInstanceId),a=o.children,c=a.findIndex((e=>(null===s||void 0===s?void 0:s.nodeInstanceId)===e.nodeInstanceId));return-1!==c?null===a||void 0===a?void 0:a[c]:void 0})),(0,r.Z)(this,"getAllSiblingsForNodeInstanceId",(e=>{const t=(0,Rd.Z)(this,pH)[e];if(!t)throw Error("No data found in nodeInstanceData for nodeInstanceId when getting the next sibling");const o=t.parentInstance;if(!o)return;return o.children.map((e=>e.nodeInstanceId))})),(0,r.Z)(this,"addNewNodeInstanceData",((e,t,o,n,i)=>{var r;o&&"root"!==o&&((0,Rd.Z)(this,pH)[o]??={nodeId:"",nodeInstanceId:o,parentInstance:null,children:[],contextId:n,mixedTypeMappingId:i});const s=null!==(r=(0,Rd.Z)(this,pH)[o])&&void 0!==r?r:null,a=(0,Rd.Z)(this,pH)[t];let c;return a?(c=a,a.parentInstance=s,a.nodeId=e,a.contextId=n,a.mixedTypeMappingId=i):c=(0,Rd.Z)(this,pH)[t]={nodeId:e,nodeInstanceId:t,parentInstance:s,children:[],contextId:n,mixedTypeMappingId:i},s?(s.children.push(c),()=>{const e=s.children.indexOf(c);s.children.splice(e,1),delete(0,Rd.Z)(this,pH)[t]}):()=>{delete(0,Rd.Z)(this,pH)[t]}})),(0,r.Z)(this,"removeNodeInstanceData",(e=>{const t=(0,Rd.Z)(this,pH)[e],o=null===t||void 0===t?void 0:t.parentInstance;if(!t)return;if(delete(0,Rd.Z)(this,pH)[e],!o)return;const n=o.children.indexOf(t);o.children.splice(n,1)}))}get nodeInstanceDomData(){return(0,Rd.Z)(this,lH)}get nodeIdToInstanceIds(){return(0,Rd.Z)(this,dH)}get nodeInstanceData(){return(0,Rd.Z)(this,pH)}getIframeRef(){return(0,Rd.Z)(this,sH)}setIframeRef(e){(0,Zd.Z)(this,sH,e)}getIframeRoot(){return(0,Rd.Z)(this,aH)}setIframeRoot(e){(0,Zd.Z)(this,aH,e)}getIframeStyleRoot(){return(0,Rd.Z)(this,cH)}setIframeStyleRoot(e){(0,Zd.Z)(this,cH,e)}getVisibleChildrenForTransparentInstanceIds(e){const t=[];return e.forEach((e=>{var o,n;const i=null===(o=this.nodeInstanceDomData)||void 0===o||null===(n=o[e])||void 0===n?void 0:n.domRef,r=this.nodeInstanceData[e];r&&(i&&"contents"!==getComputedStyle(i).display?t.push(e):t.push(...this.getVisibleChildrenForTransparentInstanceIds(r.children.map((e=>e.nodeInstanceId)))))})),t}getFirstInstanceIdOfNodeInParentInstance(e,t){const o=this.nodeInstanceData[t];if(null!==o&&void 0!==o&&o.children)return this.findNodeInInstanceListBfs(e,null===o||void 0===o?void 0:o.children)}findNodeInInstanceListBfs(e,t){if(!t.length)return;const o=[],n=t.find((t=>{if(t.nodeId===e)return!0;o.push(...t.children)}));return n?n.nodeInstanceId:this.findNodeInInstanceListBfs(e,o)}getDomNodeElementRefById(e){const t=this.projectDoc.nodes.getById(e);if(!t)return null;if(this.projectDoc.nodes.nodeIsCompInstance(t)){var o;const e=null===(o=this.projectDoc.components.byId[t.compIdOfCompInstance])||void 0===o?void 0:o.rootNodeId;return this.getDomNodeElementRefByCompInstance(e||"",t.id)}const n=this.projectUIState.selection.compInstanceId;if(n)return this.getDomNodeElementRefByCompInstance(t.id,n);const{compInstanceId:i}=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(t.id);return this.getDomNodeElementRefByCompInstance(t.id,i)}getNodeInstanceForNodeIdInParentInstanceId(e,t){const o=(0,Rd.Z)(this,pH)[t];if(!o)throw Error("No data found in nodeInstanceData for parentInstanceId when getting the parentInstance");return o.children.find((t=>t.nodeId===e))}getClosestParentNodeInstanceId(e){const t=(0,Rd.Z)(this,pH)[e];if(null!==t&&void 0!==t&&t.parentInstance)return t.parentInstance.nodeInstanceId}getClosestInteractiveParentNodeInstanceId(e){var t;const o=(0,Rd.Z)(this,pH)[e];if(null===o||void 0===o||!o.parentInstance)return;const n=null===o||void 0===o?void 0:o.parentInstance.nodeInstanceId;if(o.parentInstance.contextId)return this.getClosestInteractiveParentNodeInstanceId(n);const i=null===(t=(0,Rd.Z)(this,lH)[n])||void 0===t?void 0:t.domRef;return i?i.dataset.notInteractive?this.getClosestInteractiveParentNodeInstanceId(n):n:void 0}getInteractiveRootNodeForNodeInstanceId(e){let t=(0,Rd.Z)(this,pH)[e];const o=[];for(;null!==(n=t)&&void 0!==n&&n.parentInstance;){var n,i,r,s,a;const e=null===(i=t)||void 0===i||null===(r=i.parentInstance)||void 0===r?void 0:r.nodeId;if(e){const n=this.projectDoc.nodes.getById(e);if(!n)continue;var c,l;if(Zn.tn.includes(null===n||void 0===n?void 0:n.primitiveType))o.push(null===(c=t)||void 0===c||null===(l=c.parentInstance)||void 0===l?void 0:l.nodeInstanceId)}t=null!==(s=null===(a=t)||void 0===a?void 0:a.parentInstance)&&void 0!==s?s:void 0}return o.at(-1)}resetInstanceData(){(0,Zd.Z)(this,lH,{}),(0,Zd.Z)(this,dH,{}),(0,Zd.Z)(this,pH,{})}},iH=(0,s.Z)(nH.prototype,"projectDoc",[eH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rH=(0,s.Z)(nH.prototype,"projectUIState",[tH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oH=nH));var uH,hH,mH,yH,gH,fH,bH,IH;uH=(0,c.provide)("assetSrcProvider"),hH=(0,c.inject)("projectDoc"),mH=(0,c.inject)("projectUIState"),uH((IH=new WeakMap,gH=class{constructor(){IH.set(this,{writable:!0,value:{}}),(0,i.Z)(this,"projectDoc",fH,this),(0,i.Z)(this,"projectUIState",bH,this),this.safelyGetSrcForAssetId=this.safelyGetSrcForAssetId.bind(this)}safelyGetSrcForAssetId(e){var t;const o=this.projectDoc.assets.byId[e];if(!o)return e;const n=this.projectUIState.selection.componentId,i=o.originalHeight||0,r=o.originalWidth||0,s=null===(t=o.sizePerComponent)||void 0===t?void 0:t[n||""],a=o.skipOptimisations||o.type===Mt.K.VIDEO,c=s||(i>=r?`w=${$r.ou.Cg}`:`h=${$r.ou.Cg}`);return(0,Rd.Z)(this,IH)[e]||((0,Rd.Z)(this,IH)[e]=o.remoteSrc),`${(0,Rd.Z)(this,IH)[e]}${a?"":"&"+c}`}},fH=(0,s.Z)(gH.prototype,"projectDoc",[hH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bH=(0,s.Z)(gH.prototype,"projectUIState",[mH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yH=gH));var vH,wH;(0,c.provide)("workersProvider")((wH=new WeakMap,vH=class{constructor(){(0,r.Z)(this,"linter",void 0),(0,r.Z)(this,"prettier",void 0),(0,r.Z)(this,"htmlParser",void 0),(0,r.Z)(this,"typings",void 0),wH.set(this,{writable:!0,value:[]})}async loadLinter(){const e=new Worker(new URL(o.p+o.u(14822),o.b),{type:void 0}),t=new((0,tG.Ud)(e));try{this.linter=await t,(0,Rd.Z)(this,wH).push(e)}catch(n){throw new Error("Failed to load Linter")}}async loadPrettier(){const e=new Worker(new URL(o.p+o.u(74716),o.b),{type:void 0}),t=new((0,tG.Ud)(e));try{this.prettier=await t,(0,Rd.Z)(this,wH).push(e)}catch(n){throw new Error("Failed to load Prettier")}}async loadTypingsWorker(e){const t=new Worker(new URL(o.p+o.u(31727),o.b),{type:void 0}),n=new((0,tG.Ud)(t));try{this.typings=await n,this.typings.init((0,tG.sj)(e)),(0,Rd.Z)(this,wH).push(t)}catch(i){throw new Error("Failed in loading ATA")}}async loadHtmlParser(){const e=new Worker(new URL(o.p+o.u(38434),o.b),{type:void 0}),t=new((0,tG.Ud)(e));try{this.htmlParser=await t,(0,Rd.Z)(this,wH).push(e)}catch(n){throw new Error("Failed to load HTML Parser")}}async generateHtmlTreeFromCode(e){return this.htmlParser||await this.loadHtmlParser(),this.htmlParser.generateHtmlTreeFromText(e)}async lintFile(e,t,o,n){this.linter||await this.loadLinter(),this.linter.verify(e,t,(0,tG.sj)(o),(0,tG.sj)(n))}async prettify(e,t,o,n){this.prettier||await this.loadPrettier(),this.prettier.prettify(e,t,(0,tG.sj)(o),(0,tG.sj)(n))}async loadTypes(e,t){this.typings||await this.loadTypingsWorker(t),this.typings.load(e)}terminateWorkers(){(0,Rd.Z)(this,wH).forEach((e=>e.terminate()))}}));var NH,jH,SH,DH,TH,OH,FH,CH,EH,xH,_H,MH,PH,AH,kH,UH,RH,ZH=o(401664),LH=o(750156),$H=o(244658);function BH(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function GH(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?BH(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):BH(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}NH=(0,c.provide)("uidlToProjectMapper"),jH=(0,c.inject)("sharedbProjectSyncService"),SH=(0,c.inject)("projectDoc"),DH=(0,c.inject)("uidlToComponentMapper"),TH=(0,c.inject)("fontsInProjectFlow"),OH=(0,c.inject)("guardsService"),FH=(0,c.inject)("projectClassManagementFlow"),CH=(0,c.inject)("sentryService"),NH((xH=class{constructor(){(0,i.Z)(this,"dbSync",_H,this),(0,i.Z)(this,"projectDoc",MH,this),(0,i.Z)(this,"uidlToComponentMapper",PH,this),(0,i.Z)(this,"fontsInProjectFlow",AH,this),(0,i.Z)(this,"guardsService",kH,this),(0,i.Z)(this,"projectClassManagementFlow",UH,this),(0,i.Z)(this,"sentryService",RH,this),(0,r.Z)(this,"uidlToDomainAssetsManager",fl.Instance),(0,r.Z)(this,"addClassToProject",(e=>{const{doc:t,name:o,cls:n}=e;this.addDynamicNodesToClass(t.designLanguage,n);const i=(new np.J).fromJSON({id:(0,ni.Ox)(),name:o,conditions:n.conditions,content:n.content});this.projectClassManagementFlow.addSimpleClass({classToAdd:i,doc:t})})),(0,r.Z)(this,"addClassesToProject",(e=>{const{doc:t,styleSetDefinitions:o}=e;Object.keys(o||{}).forEach((e=>{o[e].conditions&&this.addClassToProject({doc:t,name:e,cls:o[e]})})),this.ensureDefaultTextStyleExists(t)})),(0,r.Z)(this,"addSingleTextStyleToProject",(e=>{var t;const{doc:o,styleSetDefinition:n,styleName:i,index:r}=e;let s=Object.values(o.designLanguage.categoriesById).find((e=>"typography"===e.section));s||(s={id:(0,ni.Ox)(),name:"Text Styles",position:0,section:"typography"},o.designLanguage.categoriesById[s.id]=s);const a=n,c=(0,l.Zu)(Object.values(o.designLanguage.textStyleSetsById).map((e=>e.name)),i),d=(new ZH.o).fromJSON(GH(GH({},a),{},{role:(null===a||void 0===a?void 0:a.role)||void 0,categoryId:null===(t=s)||void 0===t?void 0:t.id,identifier:(0,ni.Ky)(i),name:c,position:r*Number.MAX_SAFE_INTEGER,type:fw.i.TEXT_STYLE,id:(0,ni.Ox)()}));o.designLanguage.textStyleSetsById[d.id]=d})),(0,r.Z)(this,"addTextStylesToProject",(e=>{const{doc:t,styleSetDefinitions:o}=e;Object.keys(o||{}).forEach(((e,n)=>{o[e].conditions||this.addSingleTextStyleToProject({doc:t,styleName:e,styleSetDefinition:o[e],index:n})})),this.ensureDefaultTextStyleExists(t)})),(0,r.Z)(this,"addFontsUsedInTokens",(e=>{Object.keys(e.designLanguage.textStyleSetsById).forEach((t=>{const o=e.designLanguage.textStyleSetsById[t];Object.keys(o.content).forEach((n=>{if("fontFamily"!==n)return;const i=o.content[n];if("static"===(null===i||void 0===i?void 0:i.type)){const o=this.fontsInProjectFlow.importGoogleFont({doc:e,fontName:i.content}),n=Object.values(e.fonts.byId).find((e=>e.name===o));n&&(n.usedInTokens[t]=!0)}}))}))})),(0,r.Z)(this,"addSingleDesignTokenToProject",((e,t,o,n,i)=>{const{backgroundToken:r,foregroundToken:s}=HH(n),{type:a=fw.i.COLOR,categoryName:c=(0,ni.Ox)(),name:d}=(0,Xc.kg)(t);let p=Object.keys(e.designLanguage.categoriesById).find((t=>e.designLanguage.categoriesById[t].name.toLowerCase().replace(/ /g,"")===c));if(!p){const t=Math.max(...Object.values(e.designLanguage.categoriesById).map((e=>e.position))),o=a===fw.i.COLOR,n=-1!==[fw.i.SIZE,fw.i.SPACE,fw.i.RADIUS].indexOf(a),i=-1!==[fw.i.TYPEFACE,fw.i.TEXT_SCALE,fw.i.TEXT_STYLE].indexOf(a);let r=o?"color":n?"layout":null;r=r||(i?"typography":"color");const s={id:(0,ni.Ox)(),name:c,position:t+Number.MAX_SAFE_INTEGER,section:r};e.designLanguage.categoriesById[s.id]=s,p=s.id}const u=o,h="static"===(null===u||void 0===u?void 0:u.type)?null===u||void 0===u?void 0:u.content:"",m=r&&r.categoryName===c&&r.name===d,y=s&&s.categoryName===c&&s.name===d;if(m){const t=Object.keys(e.designLanguage.tokensById).find((t=>"background-color"===e.designLanguage.tokensById[t].role));t&&(e.designLanguage.tokensById[t].role=void 0)}if(y){const t=Object.keys(e.designLanguage.tokensById).find((t=>"foreground-color"===e.designLanguage.tokensById[t].role));t&&(e.designLanguage.tokensById[t].role=void 0)}const g=(0,l.Zu)(Object.values(e.designLanguage.getTokensByCategoryId(p)).map((e=>e.name)),d),f=new LH.Q({id:(0,ni.Ox)(),type:a,categoryId:p,name:g,value:h,role:m?"background-color":y?"foreground-color":void 0,usedInNodes:{},position:i*Number.MAX_SAFE_INTEGER});e.designLanguage.tokensById[f.id]=f})),(0,r.Z)(this,"addDesignTokensToProject",((e,t,o)=>{Object.keys(t).length&&Object.keys(t||{}).forEach(((n,i)=>{this.addSingleDesignTokenToProject(e,n,t[n],o,i)}))})),(0,r.Z)(this,"solveDesignLanguageConflicts",((e,t,o,n,i,r)=>{const s=null===r||void 0===r?void 0:r.classes,a=null===r||void 0===r?void 0:r.tokens,c=null===r||void 0===r?void 0:r.textStyles,d={classes:{},tokens:{},textStyles:{}};if(e)return Object.entries(o).forEach((([t,o],n)=>{const{type:r,categoryName:s,name:c}=(0,Xc.kg)(t);if(!a||!a.hasOwnProperty(t))return void(Object.values(e.designLanguage.getTokensAsCustomProperties()).find((e=>e.name===t))||this.addSingleDesignTokenToProject(e,t,o,i,n));if(0===a[t])return;const p=Object.keys(e.designLanguage.categoriesById).find((t=>e.designLanguage.categoriesById[t].name.toLowerCase().replace(/ /g,"")===s));if(1===a[t]){let a=c;p&&(a=(0,l.Zu)(Object.values(e.designLanguage.getTokensByCategoryId(p)).map((e=>e.name)),c)),d.tokens[t]=`--dl-${r}-${s}-${a}`,this.addSingleDesignTokenToProject(e,t,o,i,n)}else{const t=Object.values(e.designLanguage.tokensById).find((e=>e.name.toLowerCase().replace(/ /g,"")===c&&e.categoryId===p));if(t){const n=e.designLanguage.tokensById[t.id];return n.value=o.content,void(e.designLanguage.tokensById[n.id]=n)}}})),t&&Object.entries(t).forEach((([t,o])=>{const n=(0,Qd.fE)(e.designLanguage);if(s&&s.hasOwnProperty(t)){if(0!==s[t])if(1===s[t]){const n=(0,l.Zu)(Object.values(e.classes.byId).map((t=>t.getName(e.classes.byId))),t);d.classes[t]=n,this.addClassToProject({doc:e,name:t,cls:o})}else{const n=Object.values(e.classes.byId).find((o=>o.getName(e.classes.byId)===t));if(!n)return;this.addDynamicNodesToClass(e.designLanguage,o);const i=(new np.J).fromJSON({name:t,conditions:o.conditions,content:o.content});switch(s[t]){case 2:n.content=i.content;break;case 3:n.content=GH(GH({},i.content),n.content);break;case 4:n.content=GH(GH({},n.content),i.content)}const r=Object.values(n.conditions);Object.values(i.conditions).forEach((e=>{const o=r.find((t=>t.type===e.type&&JSON.stringify(t.meta)===JSON.stringify(e.meta)));if(o)switch(s[t]){case 2:o.content=e.content;break;case 3:o.content=GH(GH({},e.content),o.content);break;case 4:o.content=GH(GH({},o.content),e.content)}else n.conditions[e.id]=e}))}}else Object.values(e.classes.byId).find((o=>o.getName(e.classes.byId)===t))||n[t]||this.addClassToProject({doc:e,name:t,cls:o})})),Object.entries(n).forEach((([t,o],n)=>{if(c&&c.hasOwnProperty(t)){if(0!==c[t])if(1===c[t]){const i=(0,l.Zu)(Object.values(e.designLanguage.textStyleSetsById).map((e=>e.name)),t);d.classes[t]=i,this.addSingleTextStyleToProject({doc:e,styleName:t,styleSetDefinition:o,index:n})}else{const n=Object.values(e.designLanguage.textStyleSetsById).find((e=>e.name===t));if(!n)return;const i=o,r=(new ZH.o).fromJSON(GH({},i));switch(Object.values(r.content).forEach((t=>{if("dynamic"!==t.type)return;const{name:o}=(0,Xc.kg)(t.content.id),n=Object.values(e.designLanguage.tokensById).find((e=>e.name.toLowerCase().replace(/ /g,"")===o));n&&(t.content.id=n.id)})),c[t]){case 2:n.content=r.content;break;case 3:case 4:n.content=GH(GH({},r.content),n.content)}}}else Object.values(e.designLanguage.textStyleSetsById).find((e=>(0,dr.hN)(e.name)===t))||this.addSingleTextStyleToProject({doc:e,styleName:t,styleSetDefinition:o,index:n})})),d}))}async mapUIDLToProject(e,t=!1){t||await(0,Xc.Yh)(e),await this.guardsService.executeAsyncFunctionGuarded(QI._.DISABLE_HISTORY,(async()=>{this.addGlobalDataToDocument({projectUIDL:e}),await this.extractProjectFromUIDLAndSave(e)}))}addGlobalDataToDocument(e){var t,o,n;const{doc:i,projectUIDL:r}=e;if(!i)return;const{root:s,globals:a}=r;i.settings.general={title:a.settings.title,language:a.settings.language||"en"},i.settings.code={headTag:null===(t=a.customCode)||void 0===t?void 0:t.head,bodyTag:null===(o=a.customCode)||void 0===o?void 0:o.body};zH(a).forEach((e=>i.fonts.addFont(e)));const c=(null===(n=s.designLanguage)||void 0===n?void 0:n.tokens)||{},l=s.styleSetDefinitions||{},d=Object.keys(l).filter((e=>l[e].conditions)).reduce(((e,t)=>(e[t]=l[t],e)),{}),p=Object.keys(l).filter((e=>!l[e].conditions)).reduce(((e,t)=>(e[t]=l[t],e)),{});this.solveDesignLanguageConflicts(i,d,c,p,a),this.addFontsUsedInTokens(i)}async extractProjectFromUIDLAndSave(e){var t,o;const{components:n={},root:i}=e,r=null===(t=i.stateDefinitions)||void 0===t||null===(o=t.route)||void 0===o?void 0:o.defaultValue,s=(i.node.content.children||[]).map((e=>{const t=e.content;return{uidl:GH(GH({},e.content),{},{name:t.value}),meta:{isPage:!0,validateUIDL:!1}}})),a=Object.keys(n).map((e=>({uidl:n[e],meta:{validateUIDL:!1}}))),c=this.uidlToComponentMapper.mapUIDLsToComponents({uidls:s,domainTranslations:null});if(!c)return;const l=this.uidlToComponentMapper.mapUIDLsToComponents({uidls:a,domainTranslations:null}),d=c.components,p=null===l||void 0===l?void 0:l.components,u=(0,Xc.i3)(c,l),{nodes:h,assetFiles:m,tokensInNodes:y,textStylesInNodes:g,fontsInNodes:f,fontsToImport:b,sectionIds:I,classesInNodes:v,usedComponents:w}=u,N=await this.uidlToDomainAssetsManager.uploadAssets(m);this.dbSync.mutate(this.projectDoc,(e=>{d.forEach((t=>{t.isHomePage=t.title===r||1===d.length,t.isFallbackPage=!1,e.addPage({page:t,folderId:"pages"})})),Object.keys(b).forEach((t=>{const o=this.fontsInProjectFlow.importGoogleFont({doc:e,fontName:b[t]}),n=Object.keys(e.fonts.byId).find((t=>e.fonts.byId[t].name===o));n&&(f[n]?f[n].push(t):f[n]=[t])}));let t,o,n;((null===l||void 0===l?void 0:l.nodes)||[]).forEach((t=>{t.primitiveType===Zn.sO.COMPONENT&&(t.semanticType=null),e.addNode(t)})),p.forEach((t=>{const o=e.addComponent({component:t,folderId:"components"});Object.values((null===l||void 0===l?void 0:l.propDefinitions[t.id])||{}).forEach((e=>{"rootClassName"===e.name&&(e.hidden=!0),null===o||void 0===o||o.createPropDefinition(GH({},e))})),Object.values((null===l||void 0===l?void 0:l.stateDefinitions[t.id])||{}).forEach((e=>{null===o||void 0===o||o.createStateDefinition(GH({},e))}))})),h.forEach((i=>{if(i.id===t&&(i.parentId=null,i.slotId=o,i.compInstanceId=n),"fakeSize"in i&&(i.fakeSize=!1),e.nodes.nodeIsCompInstance(i)){const r=Object.keys(e.components.byId).find((t=>{var o;return(null===(o=e.components.byId[t])||void 0===o?void 0:o.title)===i.semanticType}));if(!r)throw new Error(`Trying to add an instance of a nonexisting component! ${JSON.stringify(i)}`);i.compIdOfCompInstance=r;const s=e.components.byId[r];if(s&&(s.instantiatedByNodes[i.id]=!0,i.semanticType=null,s.slots&&Object.keys(s.slots).length>0&&Object.keys(i.childrenIds).length>0)){const e={};e[Object.keys(i.childrenIds)[0]]=!0,i.slottedNodes[Object.keys(s.slots)[0]]=e,t=Object.keys(i.childrenIds)[0],o=Object.keys(s.slots)[0],n=i.id,i.childrenIds={}}}e.addNode(i)})),N&&this.uidlToDomainAssetsManager.linkAssetsToNodesOrProps({doc:e,initialAssets:m,uploadedAssets:N});const i=[...c.nodesWithNavlinks||[],...(null===l||void 0===l?void 0:l.nodesWithNavlinks)||[]];(0,Xc.Gw)(e,i),(0,Xc.cT)({doc:e,sectionIds:I,sentryService:this.sentryService}),(0,Xc.ng)({doc:e,usedComponents:w,sentryService:this.sentryService}),Object.keys(y).forEach((t=>{y[t].forEach((o=>{const n=e.designLanguage.tokensById[t].usedInNodes[o];e.designLanguage.tokensById[t].usedInNodes[o]=n?n+1:1}))})),Object.keys(g).forEach((t=>{g[t].forEach((o=>{e.designLanguage.textStyleSetsById[t].usedInNodes[o]=!0}))})),Object.keys(f).forEach((t=>{f[t].forEach((o=>{const n=e.fonts.byId[t].usedInNodes[o];e.fonts.byId[t].usedInNodes[o]=n?n+1:1}))})),Object.keys(v).forEach((t=>{v[t].forEach((o=>{const n=e.classes.byId[t];"usedInNodes"in n&&(n.usedInNodes[o]=!0)}))}))}))}ensureDefaultTextStyleExists(e){if(Object.keys(e.designLanguage.textStyleSetsById).some((t=>"default"===e.designLanguage.textStyleSetsById[t].role)))return;const t=cj.$e.find((e=>"default"===e.role));if(!t)throw new Error("No default text style is defined");const o=Object.keys(e.designLanguage.textStyleSetsById).find((o=>{const n=e.designLanguage.textStyleSetsById[o];return Object.keys(n.content).every((e=>{var o,i;const r=e;return("string"===typeof n.content[r]?n.content[r]:null===(o=n.content[r])||void 0===o?void 0:o.content)===("string"===typeof t.content[r]?t.content[r]:null===(i=t.content[r])||void 0===i?void 0:i.content)}))}));o?e.designLanguage.textStyleSetsById[o].role="default":e.designLanguage.textStyleSetsById[t.id]=new ZH.o(t)}addDynamicNodesToClass(e,t){return Object.values(t.content).forEach((t=>{if("dynamic"!==t.type)return;const{name:o,categoryName:n}=(0,Xc.kg)(t.content.id),i=Object.keys(e.categoriesById).find((t=>e.categoriesById[t].name.toLowerCase().replace(/ /g,"")===n));if(i){const n=Object.values(e.getTokensByCategoryId(i)).find((e=>e.name.toLowerCase().replace(/ /g,"")===o));n&&(t.content.id=n.id)}})),t.conditions&&Object.values(t.conditions).forEach((t=>{Object.values(t.content).forEach((t=>{if("dynamic"!==t.type)return;const{name:o,categoryName:n}=(0,Xc.kg)(t.content.id),i=Object.keys(e.categoriesById).find((t=>e.categoriesById[t].name.toLowerCase().replace(/ /g,"")===n));if(i){const n=Object.values(e.getTokensByCategoryId(i)).find((e=>e.name.toLowerCase().replace(/ /g,"")===o));n&&(t.content.id=n.id)}}))})),t}},_H=(0,s.Z)(xH.prototype,"dbSync",[jH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MH=(0,s.Z)(xH.prototype,"projectDoc",[SH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PH=(0,s.Z)(xH.prototype,"uidlToComponentMapper",[DH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AH=(0,s.Z)(xH.prototype,"fontsInProjectFlow",[TH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kH=(0,s.Z)(xH.prototype,"guardsService",[OH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UH=(0,s.Z)(xH.prototype,"projectClassManagementFlow",[FH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RH=(0,s.Z)(xH.prototype,"sentryService",[CH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,s.Z)(xH.prototype,"addGlobalDataToDocument",[m.P],Object.getOwnPropertyDescriptor(xH.prototype,"addGlobalDataToDocument"),xH.prototype),EH=xH));const HH=e=>{const t=e.assets.filter((e=>"style"===e.type));let o=null,n=null;return t.forEach((e=>{var t,i;const r=document.implementation.createHTMLDocument(""),s=document.createElement("style");s.textContent=e.content||"",r.body.appendChild(s);const a=null===(t=s.sheet)||void 0===t||null===(i=t.cssRules)||void 0===i?void 0:i[0];if(!a)return;const c=a.style["background-color"];if(c&&-1!==c.indexOf("--dl")){const e=c.replace("var(","").slice(0,-1);o=(0,Xc.kg)(e)}const l=a.style.color;if(l&&-1!==c.indexOf("--dl")){const e=l.replace("var(","").slice(0,-1);n=(0,Xc.kg)(e)}})),{backgroundToken:o,foregroundToken:n}},zH=e=>e.assets.filter((e=>"font"===e.type)).map((e=>{var t;const o=-1!==(null===(t=e.path)||void 0===t?void 0:t.indexOf("googleapis")),n=o?(0,Xc.eA)(e.path):"";return new $H.F({id:(0,ni.Ox)(),name:e.name||n,path:e.path,usedInNodes:{},usedInTokens:{},usedInClasses:{},type:o?"google":e.path?"custom":"system"})})).filter((e=>e));var YH=o(248738),VH=o(186338),WH=o(814371);function KH(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function qH(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?KH(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):KH(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const JH=(e,t,o)=>qH(qH({},"dynamic"===e.type?{}:e.content),{},{id:e.id,name:e.type===Zn.sO.SLOT?"slot1":e.content.name,parentId:e.parentNodeId||null,compIdOfRootNode:e.compIdOfRootNode||null,compIdOfSlot:null,primitiveType:e.type===Zn.sO.SLOT?e.type:t.elementType,referencedStyles:{},pos:""+((o||0)+1)*Number.MAX_SAFE_INTEGER}),XH=e=>null!==e&&void 0!==e&&e.length?new Yr.F({content:e.replaceAll("\\`","`").replaceAll("\\$","$")}):null,QH=(e=[],t=[],o)=>{if(o)return o.matchingCriteria?{matchingCriteria:o.matchingCriteria,conditions:o.conditions.map((o=>({operation:o.operation,operand:ez(o.operand,e,t)})))}:{conditions:o.conditions.map((o=>({operation:o.operation,operand:ez(o.operand,e,t)})))}},ez=(e,t=[],o=[])=>{var n,i;if("string"===typeof e||"number"===typeof e||"boolean"===typeof e)return e;if(e&&"object"===typeof e&&"expr"===e.type)return new nr.P({content:{referenceType:"expr",id:e.content}});if(e&&"object"===typeof e&&"dynamic"===e.type){const r=e.content.referenceType;switch(r){case"expr":return new nr.P({content:{referenceType:"expr",id:e.content.id}});case"state":const s=(null===(n=t.find((t=>t.name===e.content.id)))||void 0===n?void 0:n.id)||e.content.id;return new nr.P({content:{referenceType:"state",id:s,refPath:e.content.refPath},id:s});case"prop":const a=(null===(i=o.find((t=>t.name===e.content.id)))||void 0===i?void 0:i.id)||e.content.id;return new nr.P({content:{referenceType:e.content.referenceType,id:a,refPath:e.content.refPath},id:a});default:return new nr.P({content:{referenceType:r,id:"string"===typeof e.content?e.content:"id"in e.content?e.content.id:JSON.stringify(e.content)}})}}return e};function tz(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function oz(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?tz(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):tz(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}class nz{toDomainNode(e){const{childIndex:t,propDefinitions:o,stateDefinitions:n,createdNodes:i}=e,r=e.node,s=new WH.k,a=r.content,c=JH(r,a,t),l=this.generateSourceNode(r,o,n,i,r.parentNodeId);return Object.assign(c,{attrs:oz(oz({},l?{array:l}:{}),{},{contextName:new Yr.F({content:r.content.renderPropIdentifier})}),name:"ArrayMapper",stateNodeRoots:{},listCtxId:(0,ni.Ox)()}),s.fromJSON(c),s}generateSourceNode(e,t,o,n,i){const r=e.content.source;if(!r)return null;const s=-1!==r.indexOf("props"),a=-1!==r.indexOf("state");let c=null;if(s&&null!==t&&void 0!==t&&t.length){const o=r.split("[")[1].split("]")[0],n=t.find((e=>e.name===o||`'${e.name}'`===o));n&&(n.locations[e.id]={attrarray:{base:jd.hD.ATTR,sufix:"array"}},c=new nr.P({content:{referenceType:"prop",id:n.id}}))}else if(a&&null!==o&&void 0!==o&&o.length){const t=r.split("[")[1].split("]")[0],n=o.find((e=>e.name===t||`'${e.name}'`===t));n&&(n.locations[e.id]={attrarray:{base:jd.uw.ATTR,sufix:"state"}},c=new nr.P({content:{referenceType:"state",id:n.id}}))}else if("string"===typeof r&&r.startsWith("context")){var l;if(!r.split("?.")[0])return void(c=new Yr.F({content:r}));const e=null===(l=r.split("||")[0])||void 0===l?void 0:l.trim();c=(0,Xc.rO)(e,null!==n&&void 0!==n?n:[],null!==i&&void 0!==i?i:"")}else c=new Yr.F({content:r});return c}}var iz=o(433099);class rz{toDomainNode(e){var t,o,n,i,r;const{node:s,childIndex:a}=e,c=new lu.Z3,l=s.content,d=JH(s,l,a),p=null===(t=l.children)||void 0===t?void 0:t[0];if(!p)throw new Error("Date-time element should have a child");let u="";null!==(o=p.content.attrs)&&void 0!==o&&null!==(n=o.format)&&void 0!==n&&n.content&&(u=p.content.attrs.format.content,Object.assign(d,{format:u}));const h=new Yr.F({content:null!==(i=null===(r=p.content.attrs)||void 0===r?void 0:r.date.content)&&void 0!==i?i:(new Date).toString()}),m=u&&iz.e.some((e=>e.locale===u));return d.primitiveType=Zn.sO.DATE_TIME,Object.assign(d,{contentChildren:{[h.id]:h},semanticType:Zn.RY.SPAN,type:"date-time",hasCustomFormat:!m}),l.children=[],c.fromJSON(d),c}}var sz=o(463012),az=o(254313);class cz{toDomainNode(e){const{node:t,childIndex:o}=e,n=new az.Z,i=t.content.node.content,r=JH(t,i,o);if(n.fromJSON(r),"attrs"in n){var s,a;n.attrs??={},n.attrs.contextName={type:"static",content:null!==(s=null===(a=t.content.meta)||void 0===a?void 0:a.iteratorName)&&void 0!==s?s:(0,ni.Ox)()};const e=t.content.dataSource.content,{content:o}=(0,Xc.xG)({id:"object"===typeof e&&"id"in e?e.id:e.toString()}),i=(0,ni.Ox)();n.attrs.array=new nr.P({id:i,content:{referenceType:"global",id:i,refPath:o}})}return n}}class lz{toDomainNode(e){const{node:t,childIndex:o}=e,n=new el.F,i=t.content,r=JH(t,i,o);return n.fromJSON(r),n}}class dz{toDomainNode(e){var t,o,n;const{node:i,childIndex:r}=e,s=new dE.b,a=i.content,c=JH(i,a,r);s.fromJSON(c);const l=XH(null===(t=a.attrs)||void 0===t||null===(o=t.html)||void 0===o?void 0:o.content);return l&&(s.html=l),null===s||void 0===s||(null===(n=s.attrs)||void 0===n||delete n.html),s}}class pz{toDomainNode(e){var t,o;const{node:n,childIndex:i}=e,r=new lu.HX,s=n.content,a=JH(n,s,i);r.fromJSON(a);const c=XH(null===(t=s.attrs)||void 0===t||null===(o=t.html)||void 0===o?void 0:o.content);return c&&"html"in r&&(r.html=c),r}}var uz=o(744914);class hz{toDomainNode(e){var t;const{childIndex:o}=e,n=e.node,i=new uz.t,r=n.content,s=JH(n,r,o);return Object.assign(s,{resourceDefinition:n.content.resourceDefinition,stateNodeRoots:{},repeatableCtxId:null!==(t=n.content.renderPropIdentifier)&&void 0!==t?t:(0,ni.Ox)()}),i.fromJSON(s),i}}class mz{toDomainNode(e){const{childIndex:t,node:o}=e,n=new lu.kf,i=o.content,r=JH(o,i,t);return Object.assign(r,{stateNodeRoots:{},primitiveType:"cms-collection-list-repeater-node",name:"List"}),n.fromJSON(r),n}}var yz=o(891173);class gz{toDomainNode(e){var t,o;const{childIndex:n,createdNodes:i}=e,r=e.node,s=new yz.n,a=r.content,c=JH(r,a,n),l=this.extractItemIdFromResource(r.content.resource,i,null!==(t=c.parentId)&&void 0!==t?t:void 0);return Object.assign(c,{resourceDefinition:r.content.resourceDefinition,stateNodeRoots:{},ctxId:null!==(o=r.content.renderPropIdentifier)&&void 0!==o?o:(0,ni.Ox)(),attrs:{cmsItemId:l}}),s.fromJSON(c),s}extractItemIdFromResource(e,t,o){var n;if(!e)return null;const{id:i}=null!==(n=e.params)&&void 0!==n?n:{};if(!i)return null;if("string"===typeof i)return new Yr.F({content:i});if("type"in i&&"static"===i.type)return new Yr.F({content:i.content});if("type"in i&&"expr"===i.type){const e=(0,Xc.rO)(i.content,null!==t&&void 0!==t?t:[],null!==o&&void 0!==o?o:"");if(e)return e}return new Yr.F({content:""})}}var fz,bz,Iz,vz=o(49657);class wz{toDomainNode(e){var t,o,n,i,r;const{childIndex:s,createdNodes:a}=e,c=e.node,l=new vz.U,d=c.content,p=JH(c,d,s),u=this.extractItemDataFromExpression(null===(t=c.content.attrs)||void 0===t||null===(o=t.itemData)||void 0===o?void 0:o.content,a,null!==(n=p.parentId)&&void 0!==n?n:void 0);return Object.assign(p,{mappings:c.content.mappings,ctxId:null!==(i=c.content.renderPropIdentifier)&&void 0!==i?i:(0,ni.Ox)(),attrs:{source:u,contextName:null===(r=l.attrs)||void 0===r?void 0:r.contextName}}),l.fromJSON(p),l}extractItemDataFromExpression(e,t,o){if(!e)return null;const n=(0,Xc.rO)(e,null!==t&&void 0!==t?t:[],null!==o&&void 0!==o?o:"");return n||null}}let Nz=(fz=(0,c.inject)("projectDoc"),bz=class{constructor(e){(0,r.Z)(this,"handler",void 0),(0,r.Z)(this,"params",void 0),(0,i.Z)(this,"projectDoc",Iz,this),this.params=e,this.handler=this.getHandler()}toDomain(){const e=this.handler.toDomainNode(this.params);this.attachInteractiveScript(e),this.attachEvents(e),this.attachRenderingConditions(e),this.attachConditionalProjectStyles(e);return{dataNode:e,extraHierarchy:this.attachStaticContent(e)}}getHandler(){const{node:e}=this.params;switch(e.type){case"repeat":return new cz;case"cms-mixed-type":return new wz;case"cms-item":return new gz;case"cms-list":return new hz;case"cms-list-repeater":return e.content.isCMSListRepeater?new mz:new nz;default:switch(e.content.elementType){case Zn.sO.COMPONENT:return new lz;case Zn.sO.HTML_NODE:return new dz;case Zn.sO.DATE_TIME:return new rz;default:return new pz}}}attachInteractiveScript(e){var t;Zn.tn.includes(null!==(t=e.primitiveType)&&void 0!==t?t:"")&&(e.customCodeSnippet={head:"",body:ir.QU})}attachEvents(e){const{propDefinitions:t=[],stateDefinitions:o=[]}=this.params;if(!("events"in e))return;const n=((e,t,o,n)=>{if(e.events)return Object.keys(e.events).reduce(((i,r)=>{if(!e.events)return i;const s=e.events[r];return s?(i[r]||(i[r]={}),s.forEach((e=>{var s;switch(e.type){case"propCall":const p=(0,ni.Ox)(),u=o.find((t=>t.name===e.calls));if(!u)throw new Error(`Prop definition could not be found from propCall: ${e.calls}`);const h={id:u.id,calls:e.calls,type:e.type,pos:""};i[r][p]=h,u.locations[t]=(0,Sd.B1)({base:jd.hD.EVENT,sufix:r});break;case"stateChange":const m=(0,ni.Ox)(),y=null===(s=n.find((t=>t.name===e.modifies)))||void 0===s?void 0:s.id;if(!y)throw new Error(`State definition could not be found from stateChange: ${e.modifies}`);let g;if("object"===typeof e.newState&&"expr"===e.newState.type&&(g=new nr.P({content:{referenceType:"expr",id:e.newState.content}})),"object"===typeof e.newState&&"dynamic"===e.newState.type&&"expr"===e.newState.content.referenceType&&(g=new nr.P({content:{referenceType:"expr",id:e.newState.content.id}})),"object"===typeof e.newState&&"dynamic"===e.newState.type&&"state"===e.newState.content.referenceType){var a,c;const o=(null===(a=n.find((t=>t.name===e.newState.content.id)))||void 0===a?void 0:a.id)||e.newState.content.id;if(!o)throw new Error(`State definition could not be found from stateChange: ${e.newState.content.id}`);g=new nr.P({content:{referenceType:"state",id:o,refPath:e.newState.content.refPath},id:o});const i=n.find((e=>e.id===o));i.locations[t]=qH(qH({},(null===(c=i.locations)||void 0===c?void 0:c[t])||{}),(0,Sd._$)({base:`${jd.uw.STATE_CHANGE_EVENT}${o}${r}`,sufix:r,identifier:o}))}if("object"===typeof e.newState&&"dynamic"===e.newState.type&&"prop"===e.newState.content.referenceType){var l,d;const n=(null===(l=o.find((t=>t.name===e.newState.content.id)))||void 0===l?void 0:l.id)||e.newState.content.id;if(!n)throw new Error(`Prop definition could not be found from stateChange: ${e.newState.content.id}`);g=new nr.P({content:{referenceType:"prop",id:n,refPath:e.newState.content.refPath},id:n});const i=o.find((e=>e.id===n));i.locations[t]=qH(qH({},(null===(d=i.locations)||void 0===d?void 0:d[t])||{}),(0,Sd.B1)({base:`${jd.hD.STATE_CHANGE_EVENT}${n}${r}`,sufix:r,identifier:n}))}if("string"!==typeof e.newState&&"number"!==typeof e.newState&&"boolean"!==typeof e.newState||(g=e.newState),void 0===g)throw new Error(`Invalid newState value in stateChange event: ${e.newState}`);const f={id:y,newState:g,type:e.type,modifies:e.modifies,pos:""};i[r][m]=f}})),i):i}),{})})(this.getUIDLNodeActualContent(),e.id,t,o);n&&(e.events=n)}attachRenderingConditions(e){var t,o,n;const{node:i,propDefinitions:r=[],stateDefinitions:s=[]}=this.params;if("conditional"!==i.type||!("renderingConditions"in e))return;const a=this.getUIDLNodeActualContent(),c="string"===typeof i.content.reference.content?i.content.reference.content:i.content.reference.content.id,l="string"===typeof i.content.reference.content?"state":null!==(t=i.content.reference.content.referenceType)&&void 0!==t?t:"state",d="state"===l?null===(o=s.find((e=>e.name===c)))||void 0===o?void 0:o.id:"prop"===l?null===(n=r.find((e=>e.name===c)))||void 0===n?void 0:n.id:c,p=i.content?new sz.v({reference:new nr.P({content:{referenceType:l,id:null!==d&&void 0!==d?d:c},id:null!==d&&void 0!==d?d:c}),value:i.content.value,condition:QH(s,r,i.content.condition)}):null;var u,h,m,y;(e.renderingConditions=p,e.primitiveType)||(e.primitiveType=null!==(u=null===i||void 0===i||null===(h=i.content)||void 0===h||null===(m=h.node)||void 0===m||null===(y=m.content)||void 0===y?void 0:y.elementType)&&void 0!==u?u:Zn.sO.CONTAINER);e.primitiveType===Zn.sO.TEXT&&!e.semanticType&&a.semanticType&&(e.semanticType=a.semanticType)}attachConditionalProjectStyles(e){const t=this.getUIDLNodeActualContent(),{projectClasses:o,propDefinitions:n,stateDefinitions:i}=this.params;if(!("conditionalReferencedProjectStyles"in e)||!o||!("referencedStyles"in t))return;const r=t.referencedStyles,s=Object.keys(r).reduce(((e,t)=>{var n,i,s;const a=r[t],c=o.filter((e=>"simple"===e.classType)).find((e=>e.getName()===a.content.referenceId||e.getIdentifier()===a.content.referenceId));if(c&&"style-map"===a.type&&"project-referenced"===a.content.mapType&&null!==a&&void 0!==a&&null!==(n=a.content.condition)&&void 0!==n&&null!==(i=n.expression)&&void 0!==i&&null!==(s=i.conditions)&&void 0!==s&&s.length)return e[c.id]=a,e;if("style-map"===a.type&&"project-referenced"===a.content.mapType){var l,d,p;const o=a;null!==(l=o.content.condition)&&void 0!==l&&null!==(d=l.expression)&&void 0!==d&&null!==(p=d.conditions)&&void 0!==p&&p.length&&(e[t]=o)}return e}),{});0!==Object.keys(s).length&&(e.conditionalReferencedProjectStyles={},Object.keys(s).forEach((t=>{var r,a,c,l,d,p;const u=s[t],h=o.filter((e=>"simple"===e.classType)).find((e=>e.getName()===u.content.referenceId||e.getIdentifier()===u.content.referenceId));if(!h||!("id"in h))return void console.warn(`Project style with id ${u.content.referenceId} not found in project classes. Skipping conditional style attachment.`);if(!h)return;const m=null===(r=u.content)||void 0===r||null===(a=r.condition)||void 0===a?void 0:a.reference,y="string"===typeof(null===m||void 0===m?void 0:m.content)?m.content:null===m||void 0===m?void 0:m.content.id,g="string"===typeof(null===m||void 0===m?void 0:m.content)?"state":null!==(c=null===m||void 0===m?void 0:m.content.referenceType)&&void 0!==c?c:"state",f="state"===g?null===i||void 0===i||null===(l=i.find((e=>e.name===y)))||void 0===l?void 0:l.id:"prop"===g?null===n||void 0===n||null===(d=n.find((e=>e.name===y)))||void 0===d?void 0:d.id:y,b=new nr.P({content:{referenceType:g,id:null!==f&&void 0!==f?f:y},id:null!==f&&void 0!==f?f:y}),I=new sz.v({reference:b,condition:QH(i,n,null===(p=u.content.condition)||void 0===p?void 0:p.expression)});e.conditionalReferencedProjectStyles[t]=I})))}attachStaticContent(e){var t;const o=this.getUIDLNodeActualContent();if("string"===typeof o||"number"===typeof o||"boolean"===typeof o){const t=new Yr.F({content:o});return"contentChildren"in e&&(e.contentChildren={[t.id]:t}),e.primitiveType||(e.primitiveType=Zn.sO.TEXT),null}if("children"in o&&(null===(t=o.children)||void 0===t?void 0:t.length)&&"dynamic"===o.children[0].type&&"locale"===o.children[0].content.referenceType&&!this.projectDoc.internationalization.enabled){var n,i,r,s;const{domainTranslations:t}=this.params,l=o.children[0].content.id,d=Object.keys(null!==(n=null===t||void 0===t?void 0:t.intlData)&&void 0!==n?n:{})[0],p=null===t||void 0===t||null===(i=t.intlData[d])||void 0===i?void 0:i[l];if(!p)return null;const u=t.nodesToAdd.find((e=>e.id===p.content));if(!u)return null;if("contentChildren"in u&&1===Object.keys(null!==(r=u.contentChildren)&&void 0!==r?r:{}).length){var a;const t=Object.values(null!==(a=u.contentChildren)&&void 0!==a?a:{})[0];if(!t)return null;"contentChildren"in e&&(e.contentChildren={[t.id]:t})}if("childrenIds"in u&&Object.keys(null!==(s=u.childrenIds)&&void 0!==s?s:{}).length>1&&"childrenIds"in e){var c;e.childrenIds||(e.childrenIds={});const o=[];return Object.keys(null!==(c=u.childrenIds)&&void 0!==c?c:{}).forEach((n=>{const i=t.nodesToAdd.find((e=>e.id===n));i&&(e.childrenIds[n]=!0,i.parentId=e.id,o.push(i))})),o}return null}return null}getUIDLNodeActualContent(){const{node:e}=this.params;return"conditional"===e.type||"repeat"===e.type?e.content.node.content:e.content}},Iz=(0,s.Z)(bz.prototype,"projectDoc",[fz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bz);var jz,Sz,Dz,Tz,Oz;function Fz(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Cz(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Fz(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Fz(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}jz=(0,c.provide)("uidlToComponentMapper"),Sz=(0,c.inject)("projectDoc"),jz((Tz=class{constructor(){(0,i.Z)(this,"projectDoc",Oz,this)}mapUIDLsToComponents(e){const{uidls:t,assetNames:o={},uncommitedComponents:n=[],domainTranslations:i}=e,r=t.map((e=>{const t=this.mapSingleUIDLToComponent({uidl:{uidl:e.uidl,meta:e.meta},assetNames:o,uncommitedComponents:n,domainTranslations:i});return n.push(null===t||void 0===t?void 0:t.component),t})),s=[];for(const a of r){if(!a)continue;const e=a.component;if("propDefinitions"in e)for(const t of a.propDefinitions){if(!(t.type===jd.SO.RICH_TEXT||"element"===t.type))continue;const r=this.parseNodeHierarchy({propDefinitions:[],stateDefinitions:[],node:t.defaultValue,compId:e.id,isPage:!0,assetNames:o,uncommitedComponents:n,domainTranslations:i});if(null===r||void 0===r||!r.nodes.length)continue;s.push(...r.nodes);const a=r.nodes.find((e=>!e.parentId));t.defaultHierarchyRootId=null===a||void 0===a?void 0:a.id,t.type=jd.SO.RICH_TEXT,t.defaultValue="Default value",t.inputType=jd.SO.RICH_TEXT}}return r.reduce(((e,t)=>{if(!t)return e;const o=t.component,n=this.projectDoc.getUniqueCompOrPageName(o.title);return o.title=n,e.components.push(o),e.nodes.push(...t.nodes),e.assetFiles.push(...t.assetFiles||[]),e.propDefinitions[o.id]=t.propDefinitions,e.tailwindClasses=Cz({},t.tailwindClasses),e.usedComponents[o.id]?e.usedComponents[o.id].push(...t.usedComponents):e.usedComponents[o.id]=t.usedComponents,e.sectionIds[o.id]?e.sectionIds[o.id].push(...t.sectionIds):e.sectionIds[o.id]=t.sectionIds,e.nodesWithNavlinks.push(...t.nodesWithNavlinks),Object.keys(t.tokensInNodes).forEach((o=>{e.tokensInNodes[o]?e.tokensInNodes[o].push(...t.tokensInNodes[o]):e.tokensInNodes[o]=t.tokensInNodes[o]})),Object.keys(t.textStylesInNodes).forEach((o=>{e.textStylesInNodes[o]?e.textStylesInNodes[o].push(...t.textStylesInNodes[o]):e.textStylesInNodes[o]=t.textStylesInNodes[o]})),Object.keys(t.classesInNodes).forEach((o=>{e.classesInNodes[o]?e.classesInNodes[o].push(...t.classesInNodes[o]):e.classesInNodes[o]=t.classesInNodes[o]})),Object.keys(t.fontsInNodes).forEach((o=>{e.fontsInNodes[o]?e.fontsInNodes[o].push(...t.fontsInNodes[o]):e.fontsInNodes[o]=t.fontsInNodes[o]})),Object.keys(t.fontsToImport).forEach((o=>{e.fontsToImport[o]=t.fontsToImport[o]})),e}),{assetFiles:[],components:[],nodes:s,assets:[],propDefinitions:{},stateDefinitions:{},tokensInNodes:{},textStylesInNodes:{},classesInNodes:{},fontsInNodes:{},fontsToImport:{},usedComponents:{},sectionIds:{},nodesWithNavlinks:[],tailwindClasses:{}})}mapSingleUIDLToComponent(e){var t;const{assetNames:o={},uncommitedComponents:n=[],domainTranslations:i}=e,{uidl:r,meta:s={}}=e.uidl,{validateUIDL:a=!0,isPage:c=!1,isCMSPage:l=!1}=s,d=r,p=(0,ni.Ox)(),{name:u}=d,h=this.getComponentPropDefinitions(d,p,i),m=this.getComponentStateDefinitions(d),y=this.parseNodeHierarchy({propDefinitions:h.propDefinitions,stateDefinitions:m,node:d.node,compId:p,isPage:c,assetNames:o,uncommitedComponents:n,domainTranslations:i});if(!y)return null;const g={},b=Object.values(this.projectDoc.designLanguage.tokensById),I=Object.values(this.projectDoc.designLanguage.categoriesById);if(d.styleSetDefinitions){const e=d.styleSetDefinitions;Object.keys(e).forEach((t=>{const o={};Object.keys(e[t].content).forEach((n=>{const i=e[t].content[n];if("static"===i.type){const e=i.content;return void(o[n]=new Yr.F({content:e}))}const r=Mz(b,I,i.content.id),s=y.nodes.find((e=>{var o;return e instanceof lu.HX&&(null===(o=e.attrs[lr.Q])||void 0===o?void 0:o.content)===t}));if(r&&s){const e=new nr.P({content:{referenceType:"token",id:r.id}});o[n]=e,y.tokensInNodes[r.id]?y.tokensInNodes[r.id].push(s.id):y.tokensInNodes[r.id]=[s.id]}else{const{type:e,name:t,categoryName:r}=(0,Xc.kg)(i.content.id);if(r){const i=cj.ST.find((e=>e.name.toLowerCase()===r)),s=(null===i||void 0===i?void 0:i.id)||null;if(s){const i=cj.ZC.find((o=>o.name.toLowerCase()===t&&o.categoryId===s&&o.type===e));if(i){const e=new Yr.F({content:i.value});o[n]=e}}}}})),g[t]={styles:o,referencedStyles:{},usedByInstances:{}}}))}const v=l?(new VH.b).fromJSON({id:p,title:new Yr.F({content:u})}):c?(new f.m).fromJSON({id:p,title:u}):new Un.n({id:p,title:u,rootNodeId:d.node.content.key,styleSetDefinitions:g,slots:y.usedSlots,stateDefinitions:Object.values(m).reduce(((e,t)=>(e[t.id]=t,e)),{})}),{nodes:w}=y,N=w.find((e=>(e instanceof lu.HX||e instanceof el.F||e instanceof dE.b)&&e.compIdOfRootNode===v.id));return null!==(t=h.nodes)&&void 0!==t&&t.length&&y.nodes.push(...h.nodes),v.rootNodeId=null===N||void 0===N?void 0:N.id,Cz({component:v},y)}parseNodeHierarchy(e){const{node:t,propDefinitions:o,stateDefinitions:n,compId:i,isPage:r,assetNames:s,uncommitedComponents:a=[],domainTranslations:c}=e,l=Object.values(this.projectDoc.designLanguage.tokensById),d=Object.values(this.projectDoc.designLanguage.textStyleSetsById),p=Object.values(this.projectDoc.classes.byId),u=Object.values(this.projectDoc.designLanguage.categoriesById),h=Object.values(this.projectDoc.fonts.byId),m=[{node:t}],y=[],g=[],f={},b={},I={},v={},w=[],N=[],j={},S={};for(;m.length;){var D;const e=m.shift();if(!e)continue;const{node:t,parentNode:G,childIndex:H}=e;if(!t||"string"===typeof t)continue;t.id=(0,ni.Ox)(),G||(t.compIdOfRootNode=i);const z=m.some((e=>{var t;return(null===(t=e.parentNode)||void 0===t?void 0:t.id)===(null===G||void 0===G?void 0:G.id)})),Y=(null===G||void 0===G?void 0:G.primitiveType)===Zn.sO.TEXT&&"childrenIds"in G&&Object.keys(G.childrenIds).length;if(G&&!z&&!Y&&("string"===typeof t.content||"number"===typeof t.content||"boolean"===typeof t.content)){const e=new Yr.F({content:t.content});if("contentChildren"in G){if("expr"===t.type){const e=(0,Xc.rO)(t.content,g,G.id);if(e){G.contentChildren={[e.id]:e};continue}}G.contentChildren={[e.id]:e}}G.primitiveType||(G.primitiveType=Zn.sO.TEXT);continue}if("dynamic"===t.type&&"prop"===t.content.referenceType&&G){const e=o.find((e=>e.name===t.content.id));if(e){const o=new nr.P({content:Cz(Cz({},t.content),{},{id:e.id})});"contentChildren"in G&&(G.contentChildren??={},G.contentChildren[o.id]=o),e.locations[G.id]=(0,Sd.B1)({base:jd.hD.CONTENT});continue}}if("dynamic"===t.type&&"global"===t.content.referenceType&&G){const{content:e}=(0,Xc.xG)({id:t.content.id,refPath:t.content.refPath}),o=new nr.P({content:{id:e.join("__"),referenceType:"global",refPath:[...e,...t.content.refPath||[]]}});"contentChildren"in G&&(G.contentChildren??={},G.contentChildren[o.id]=o);continue}if("dynamic"===t.type&&"locale"===t.content.referenceType&&G){const e=new nr.P({content:{id:(0,ni.Ox)(),refPath:[t.content.id],referenceType:"locale"}});"contentChildren"in G&&(G.contentChildren??={},G.contentChildren[e.id]=e);continue}if(G&&"childrenIds"in G)if(G.primitiveType===Zn.sO.COMPONENT){let e=Object.keys(G.slottedNodes)[0];if(!e){var T,O;const t=null!==(T=a.find((e=>e.title===G.semanticType)))&&void 0!==T?T:Object.values(this.projectDoc.components.byId).find((e=>(null===e||void 0===e?void 0:e.title)===G.semanticType));if(!t)throw new Error(`Tried to add children inside a component slot that doesn't exist ${G.semanticType}`);e=Object.keys(null!==(O=t.slots)&&void 0!==O?O:{})[0],G.slottedNodes[e]={}}G.slottedNodes[e][t.id]=!0,t.content.slotId=e,t.content.compInstanceId=G.id}else null!==G&&void 0!==G&&G.childrenIds||(G.childrenIds={}),t.parentNodeId=G.id,G.childrenIds[t.id]=!0;if("cms-mixed-type"===t.type){var F;const e=Object.values(this.projectDoc.components.byId).concat(a);this.projectDoc.cms.isEnabled||(t.content.mappings={});const r=Cz(Cz({},null!==(F=t.content.mappings)&&void 0!==F?F:{}),{},{default:t.content.nodes.fallback,error:t.content.nodes.error});Object.keys(r).forEach((a=>{var l,d,p;const u=r[a];if(!u)return;const h=u.content.semanticType,m=e.find((e=>(null===e||void 0===e?void 0:e.title)===h));if(!m)return;const y=Object.keys(null!==(l=u.content.attrs)&&void 0!==l?l:{}).reduce(((e,r)=>{var a;const l=null===(a=u.content.attrs)||void 0===a?void 0:a[r];if("element"===(null===l||void 0===l?void 0:l.type)){const a=this.parseNodeHierarchy({node:l,propDefinitions:o,stateDefinitions:n,compId:i,isPage:!1,assetNames:s,uncommitedComponents:[],domainTranslations:c}),d=a.nodes.find((e=>e.id===l.id));d&&"element-node"===d.type&&(d.compIdOfRootNode=null,d.meta={isAttributeRoot:{nodeId:t.id,attr:r}},e[r]={id:(0,ni.Ox)(),type:"hierarchy",content:d.id,pristine:!0}),g.push(...a.nodes)}if("static"===(null===l||void 0===l?void 0:l.type)&&(e[r]=new Yr.F({content:l.content})),"dynamic"===(null===l||void 0===l?void 0:l.type)){const t=new nr.P({content:{id:l.content.id,referenceType:"prop"}});e[r]=t}if("expr"===(null===l||void 0===l?void 0:l.type)){var d;const o=(0,Xc.rO)(l.content,null!==g&&void 0!==g?g:[],null!==(d=t.parentNodeId)&&void 0!==d?d:"");o&&(e[r]=o)}return e}),{}),f=new el.F({compIdOfCompInstance:m.id,attrs:Cz({},y),parentId:t.id});g.push(f);const{componentTypes:b,usedContentTypes:I}=this.projectDoc.cms,v=Object.values(b).find((e=>e.name===a)),w=Object.values(I).find((e=>e.name===a));t.content.mappings[a]=Cz(Cz({},v||w?{contentType:null!==(d=null!==(p=null===v||void 0===v?void 0:v.uid)&&void 0!==p?p:null===w||void 0===w?void 0:w.uid)&&void 0!==d?d:a}:{}),{},{componentId:m.id,componentInstanceId:f.id,name:"default"===a?"Default":"error"===a?"Error":a,typeId:a,type:v?"cmsComponent":w?"contentType":"error"===a?"error":"default"})}))}const V=new Nz({node:t,childIndex:H,createdNodes:g,propDefinitions:o,stateDefinitions:n,domainTranslations:c,projectClasses:p}),{dataNode:W,extraHierarchy:K}=V.toDomain();K&&g.push(...K);const q="conditional"===t.type||"repeat"===t.type?t.content.node.content:t.content;var C;if("abilities"in W&&null!==(D=W.abilities)&&void 0!==D&&D.link)this.syncNodeLinkAbilityIfGlobalReferenced(W,g,null===(C=W.abilities)||void 0===C?void 0:C.link);if(W.primitiveType===Zn.sO.SLOT&&(j[W.id]={height:xh.Q.HEIGHT,width:xh.Q.HEIGHT}),"element"!==t.type&&"conditional"!==t.type||!q.referencedStyles||Object.keys(q.referencedStyles).forEach((e=>{if(!q.referencedStyles)return;if(!q.referencedStyles[e])return;const t=q.referencedStyles[e];if("referencedStyles"in W&&"style-map"===(null===t||void 0===t?void 0:t.type)){const g=d.find((e=>"project-referenced"===t.content.mapType&&(e.name===t.content.referenceId||e.identifier===t.content.referenceId)));if(g){const e={type:"style-map",id:(0,ni.Ox)(),content:{mapType:"design-language-referenced",referenceId:g.id}};W.referencedStyles[g.id]=e,b[g.id]?b[g.id].push(W.id):b[g.id]=[W.id]}else if("project-referenced"===t.content.mapType){const e=t.content.referenceId,r=p.find((t=>t.getName(this.projectDoc.classes.byId)===e));var i;if(r)if(W.referencedStyles[r.id]={type:"style-map",id:r.id,content:{mapType:"project-referenced",referenceId:r.id}},S[r.id]?S[r.id].push(W.id):S[r.id]=[W.id],"conditionalReferencedProjectStyles"in W&&null!==(i=W.conditionalReferencedProjectStyles)&&void 0!==i&&i[r.id]){var s;const t=W.conditionalReferencedProjectStyles[r.id],{reference:i}=t;if(i&&"dynamic"===i.type){const{referenceType:t,id:s}=i.content;if("prop"===t){const t=o.find((e=>e.name===s||e.id===s));var a;if(t)t.locations[W.id]=Cz(Cz({},(null===(a=t.locations)||void 0===a?void 0:a[W.id])||{}),(0,Sd.B1)({base:`${jd.hD.CONDITIONAL_STYLE}-${e}`,sufix:"prop",identifier:r.id}))}if("state"===t){const t=n.find((e=>e.name===s||e.id===s));var c;if(t)t.locations[W.id]=Cz(Cz({},(null===(c=t.locations)||void 0===c?void 0:c[W.id])||{}),(0,Sd._$)({base:`${jd.uw.CONDITIONAL_STYLE}-${e}`,sufix:"state",identifier:r.id}))}}const{condition:l}=t,d=null===l||void 0===l||null===(s=l.conditions)||void 0===s?void 0:s[0];if(l&&d){const{operand:e}=d;if("object"===typeof e&&"dynamic"===(null===e||void 0===e?void 0:e.type)){const{referenceType:t,id:i}=e.content;if("prop"===t){const e=o.find((e=>e.name===i||e.id===i));var m;if(e)e.locations[W.id]=Cz(Cz({},(null===(m=e.locations)||void 0===m?void 0:m[W.id])||{}),(0,Sd.B1)({base:`${jd.hD.CONDITIONAL_STYLE_OPERAND}-${e.id}`,sufix:"prop",identifier:e.id}))}if("state"===t){const e=n.find((e=>e.name===i||e.id===i));var y;if(e)e.locations[W.id]=Cz(Cz({},(null===(y=e.locations)||void 0===y?void 0:y[W.id])||{}),(0,Sd._$)({base:`${jd.uw.CONDITIONAL_STYLE_OPERAND}-${e.id}`,sufix:"state",identifier:e.id}))}}}}}else if("component-referenced"===t.content.mapType){if(r){if("static"===t.content.content.type){const o=t.content.content.content;W.referencedStyles[e]={id:(0,ni.Ox)(),type:"style-map",content:{mapType:"component-referenced",content:{type:"static",content:o}}}}return}if("static"===t.content.content.type&&"static"===t.content.content.type){const o=t.content.content.content;W.referencedStyles[e]={id:(0,ni.Ox)(),type:"style-map",content:{mapType:"component-referenced",content:{type:"static",content:o}}}}const n=o.find((e=>e.name===lr.Q));n&&(W.referencedStyles[e]={type:"style-map",id:e,content:{mapType:"component-referenced",content:{type:"dynamic",content:{referenceType:"prop",id:n.id}}}},n.locations[W.id]=(0,Sd.B1)({base:jd.hD.STYLE,sufix:"componentRoot"}))}if("inlined"===t.content.mapType){const e=this.extractStyles({uidlStyle:t.content.styles,dataNodeId:W.id,propDefinitions:o,tokenCategories:u,tokensInNodes:f,projectTokens:l,projectFonts:h,fontsInNodes:I,fontsToImport:v}),n=(0,ni.Ox)();W.referencedStyles[n]={content:{mapType:"inlined",styles:e,conditions:t.content.conditions},type:"style-map",id:n}}}})),"conditional"===t.type&&t.content.reference&&"dynamic"===t.content.reference.type){var E;const{referenceType:e,id:i}=t.content.reference.content;if("prop"===e){const e=o.find((e=>e.name===i));var x;if(e)e.locations[W.id]=Cz(Cz({},(null===(x=e.locations)||void 0===x?void 0:x[W.id])||{}),(0,Sd.B1)({base:jd.hD.CONDITIONAL,sufix:"prop",identifier:e.id}))}if("state"===e){const e=n.find((e=>e.name===i));var _;if(e)e.locations[W.id]=Cz(Cz({},(null===(_=e.locations)||void 0===_?void 0:_[W.id])||{}),(0,Sd._$)({base:jd.uw.CONDITIONAL,sufix:"state",identifier:e.id}))}const{condition:r}=t.content,s=null===r||void 0===r||null===(E=r.conditions)||void 0===E?void 0:E[0];if(r&&s){const{operand:e}=s;if("object"===typeof e&&"dynamic"===(null===e||void 0===e?void 0:e.type)){const{referenceType:t,id:i}=e.content;if("prop"===t){const e=o.find((e=>e.name===i));var M;if(e)e.locations[W.id]=Cz(Cz({},(null===(M=e.locations)||void 0===M?void 0:M[W.id])||{}),(0,Sd.B1)({base:`${jd.hD.CONDITIONAL_ELEMENT_OPERAND}-${e.id}`,sufix:"prop",identifier:e.id}))}if("state"===t){const e=n.find((e=>e.name===i));var P;if(e)e.locations[W.id]=Cz(Cz({},(null===(P=e.locations)||void 0===P?void 0:P[W.id])||{}),(0,Sd._$)({base:`${jd.uw.CONDITIONAL_ELEMENT_OPERAND}-${e.id}`,sufix:"state",identifier:e.id}))}}}}if("styles"in W&&("element"===t.type||"conditional"===t.type)&&q.style&&(W.styles=this.extractStyles({uidlStyle:q.style,dataNodeId:W.id,propDefinitions:o,tokenCategories:u,tokensInNodes:f,projectTokens:l,projectFonts:h,fontsInNodes:I,fontsToImport:v})),"cms-list-repeater"===t.type&&m.push({node:t.content.nodes.list,parentNode:W,childIndex:0}),"cms-list"!==t.type&&"cms-item"!==t.type||m.push({node:t.content.nodes.success,parentNode:W,childIndex:0}),"cms-array-mapper"===(null===G||void 0===G?void 0:G.type)){const e=(0,ni.Ox)();g.push(new lu.HX({id:e,primitiveType:Zn.sO.FRAGMENT,name:"Empty",parentId:G.id})),W.parentId=G.id,G.stateNodeRoots.empty=e,G.stateNodeRoots.list=W.id}if("cms-collection-list-node"===(null===G||void 0===G?void 0:G.type)||"cms-collection-item-node"===(null===G||void 0===G?void 0:G.type)){const e=(0,ni.Ox)(),t=(0,ni.Ox)();g.push(new lu.HX({id:t,primitiveType:Zn.sO.FRAGMENT,name:"Error",parentId:G.id})),g.push(new lu.HX({id:e,primitiveType:Zn.sO.FRAGMENT,name:"Loading",parentId:G.id})),W.name="Success",W.parentId=G.id,G.stateNodeRoots.success=W.id,G.stateNodeRoots.loading=e,G.stateNodeRoots.error=t}if("cms-collection-list-repeater-node"===(null===G||void 0===G?void 0:G.type)){const e=(0,ni.Ox)();g.push(new lu.HX({id:e,primitiveType:Zn.sO.FRAGMENT,name:"Empty",parentId:G.id})),W.parentId=G.id,G.childrenIds[W.id]=!0,G.childrenIds[e]=!0,W.name="Items",G.stateNodeRoots.list=W.id,G.stateNodeRoots.empty=e}if("element"===t.type||"conditional"===t.type||"repeat"==t.type){var A,k,U,R,Z;if(null===(A=q.children)||void 0===A||A.forEach(((e,t)=>{"raw"===e.type&&" "===e.content||m.push({node:e,parentNode:W,childIndex:t})})),q.elementType===Zn.sO.COMPONENT){const e=q.semanticType;e&&w.push({componentName:e,nodeId:W.id})}this.syncDynamicNodeAbilities(W,o);let e=(null===(k=q.attrs)||void 0===k||null===(U=k.alt)||void 0===U?void 0:U.content)||(0,ni.Ox)();const t={gif:"data:image/gif;base64",jpeg:"data:image/jpeg;base64",jpg:"data:image/jpg;base64",png:"data:image/png;base64",svg:"data:image/svg;base64",svg_xml:"data:image/svg+xml;base64",bmp:"data:image/bmp;base64"};let r;if("styles"in W&&null!==(R=W.styles)&&void 0!==R&&R.backgroundImage&&"string"===typeof(null===(Z=W.styles)||void 0===Z?void 0:Z.backgroundImage.content)){(0,gl.BQ)(W.styles.backgroundImage.content).forEach(((e,o)=>{let n=(0,ni.Ox)();const i=(0,gl.tH)(e).split("/").pop(),a=s[i];if(s&&a)return n=a,void y.push({nodeId:W.id,type:"backgroundImage",file:xz(e.split("'")[1],n),bgImgOrder:o});r=Object.keys(t).find((e=>-1!==W.styles.backgroundImage.content.indexOf(t[e]))),r&&y.push({nodeId:W.id,type:"backgroundImage",file:_z(e.split("'")[1],n,r),bgImgOrder:o})}))}const a=Object.keys(q.attrs||{});for(const l of a){var L;const a=null===(L=q.attrs)||void 0===L?void 0:L[l];if("expr"===(null===a||void 0===a?void 0:a.type)){var $;const e=(0,Xc.rO)(a.content,g,null!==($=W.parentId)&&void 0!==$?$:"");if(e){W.attrs[l]=e;continue}}if("html"!==l||W.primitiveType!==Zn.sO.HTML_NODE){if("id"===l&&"static"===(null===a||void 0===a?void 0:a.type)&&N.push({nodeId:W.id,sectionId:a.content}),"dynamic"===(null===a||void 0===a?void 0:a.type)&&"prop"===a.content.referenceType){var B;const t=o.find((e=>e.name===a.content.id));if(t&&null!==(B=q.attrs)&&void 0!==B&&B[l]){if("src"===l){const o=t.defaultValue.split("/").pop(),n=s[o];s&&n&&(e=n),n&&y.push({nodeId:W.id,type:"propDefinition",file:xz(t.defaultValue,e),propName:t.name}),t.inputType=jd.SO.IMAGE}const o=new nr.P({content:{referenceType:"prop",id:t.id}});W.attrs[l]=o,t.locations[W.id]=(0,Sd.B1)({base:jd.hD.ATTR,sufix:l})}}if("src"===l&&"string"===typeof(null===a||void 0===a?void 0:a.content)&&null!==a&&void 0!==a&&a.content&&"component-instance-node"!==W.type){const o=a.content.split("/").pop(),n=s[o];s&&n&&(e=n),r=Object.keys(t).find((e=>-1!==a.content.indexOf(t[e]))),r&&y.push({nodeId:W.id,type:"image",file:_z(a.content,e,r)}),n&&y.push({nodeId:W.id,type:"image",file:xz(a.content,e)})}if("poster"===l&&"string"===typeof(null===a||void 0===a?void 0:a.content)&&null!==a&&void 0!==a&&a.content&&"component-instance-node"!==W.type){const t=a.content.split("/").pop(),o=s[t];s&&o&&(e=o),o&&y.push({nodeId:W.id,type:"poster",file:xz(a.content,e)})}if("static"===(null===a||void 0===a?void 0:a.type)&&"string"===typeof a.content&&(0===a.content.indexOf("/")||(0,YH.Z)(a.content)||(0,ni.jF)(a.content))){const e=new Yr.F({content:yl.b.image.src});W.attrs[l]=e}if("string"===typeof(null===a||void 0===a?void 0:a.content)&&"static"===a.type){const t=a.content.split("/").pop(),o=s[t];s&&o&&(e=o),o&&y.push({nodeId:W.id,type:"prop",file:xz(a.content,e),propName:l})}if("element"===(null===a||void 0===a?void 0:a.type)){const e=this.parseNodeHierarchy({node:a,propDefinitions:o,stateDefinitions:n,compId:i,isPage:!1,assetNames:s,uncommitedComponents:[],domainTranslations:c}),t=e.nodes.find((e=>e.id===a.id));t&&"element-node"===t.type&&(t.compIdOfRootNode=null,t.meta={isAttributeRoot:{nodeId:W.id,attr:l}},W.attrs[l]={id:(0,ni.Ox)(),type:"hierarchy",content:t.id,pristine:!0}),g.push(...e.nodes)}if(("string"===typeof a||"number"===typeof a)&&"static"===W.attrs[l].type&&!W.attrs[l].content){const e=new Yr.F({content:a});W.attrs[l]=e}}}}g.push(W)}return{fontsInNodes:I,assetFiles:y,fontsToImport:v,propDefinitions:o,textStylesInNodes:b,tokensInNodes:f,classesInNodes:S,usedComponents:w,usedSlots:j,tailwindClasses:{},sectionIds:N,nodesWithNavlinks:[],nodes:g}}extractStyles(e){const{uidlStyle:t,dataNodeId:o,propDefinitions:n,tokenCategories:i,tokensInNodes:r,projectTokens:s,projectFonts:a,fontsInNodes:c,fontsToImport:l}=e,d={};return Object.keys(t).forEach((e=>{const p=null===t||void 0===t?void 0:t[e];if(("string"===typeof p||"number"===typeof p)&&t){const t=new Yr.F({content:p});d[e]=t}if("static"===(null===p||void 0===p?void 0:p.type)){const t=new Yr.F({content:p.content});d[e]=t}if("static"===(null===p||void 0===p?void 0:p.type)&&"string"===typeof p.content&&(0===p.content.indexOf("/")||(0,YH.Z)(p.content)||(0,ni.jF)(p.content))){const t=new Yr.F({content:ey.H.includes(e)?`url("${yl.b.image.src}")`:yl.b.image.src});d[e]=t}if("static"===(null===p||void 0===p?void 0:p.type)&&"string"===typeof p.content&&ey.H.includes(e)&&0===p.content.indexOf("url(")){const t=null===p||void 0===p?void 0:p.content.split('"');if(t[1]&&((0,YH.Z)(t[1])||(0,ni.jF)(t[1]))){const t=Ez(p.content),o=new Yr.F({content:t});d[e]=o}}if("fontFamily"===e){const e=a.find((e=>e.name===(null===p||void 0===p?void 0:p.content).replaceAll('"',"")));e?c[e.id]?c[e.id].push(o):c[e.id]=[o]:l[o]="string"===typeof p?p:null===p||void 0===p?void 0:p.content}if("dynamic"===(null===p||void 0===p?void 0:p.type)&&"prop"===p.content.referenceType){const t=n.find((e=>e.name===p.content.id));if(t){const n=new nr.P({content:{referenceType:"prop",id:t.id}});d[e]=n,t.locations[o]=(0,Sd.B1)({base:jd.hD.STYLE,sufix:e})}}if("dynamic"===(null===p||void 0===p?void 0:p.type)&&"token"===p.content.referenceType){const t=Mz(s,i,p.content.id);if(t){const n=new nr.P({content:{referenceType:"token",id:t.id}});d[e]=n,r[t.id]?r[t.id].push(o):r[t.id]=[o]}else{const{type:t,name:o,categoryName:n}=(0,Xc.kg)(p.content.id);if(n){const i=cj.ST.find((e=>e.name.toLowerCase()===n)),r=(null===i||void 0===i?void 0:i.id)||null;if(r){const n=cj.ZC.find((e=>e.name.toLowerCase()===o&&e.categoryId===r&&e.type===t));if(n){const t=new Yr.F({content:n.value});d[e]=t}}}}}})),d}syncDynamicNodeAbilities(e,t){let o=!1;return"abilities"in e&&(Object.keys(e.abilities).forEach((n=>{const i=e.abilities[n];switch(i.type){case $r.RZ.URL:{const o=i.content;if("string"!==typeof o.url&&"dynamic"===o.url.type){const n=o.url.content.id,r=t.find((e=>e.name===n));if(r&&"prop"===o.url.content.referenceType){const t=new nr.P({content:{referenceType:"prop",id:r.id}});i.content.url=t,r.inputType=jd.SO.LINK,r.locations[e.id]=(0,Sd.B1)({base:jd.hD.ABILITY,sufix:"url"})}break}"string"!==typeof o.url&&"static"===o.url.type&&(o.url=o.url.content);break}case $r.RZ.NAVLINK:o=!0,delete e.abilities[n];break;case $r.RZ.PHONE:{const e=i.content;if("string"!==typeof e.phone&&"dynamic"===e.phone.type){const o=e.phone.content.id,n=t.find((e=>e.name===o));if(n&&"prop"===e.phone.content.referenceType){const t=new nr.P({content:{referenceType:"prop",id:n.id}});e.phone=t}}break}case $r.RZ.MAIL:{var r,s;const e=i.content;if("string"!==typeof e.mail&&"dynamic"===e.mail.type){const o=e.mail.content.id,n=t.find((e=>e.name===o));if(n&&"prop"===e.mail.content.referenceType){const t=new nr.P({content:{referenceType:"prop",id:n.id}});e.mail=t}}if("string"!==typeof e.subject&&"dynamic"===(null===(r=e.subject)||void 0===r?void 0:r.type)){const o=e.subject.content.id,n=t.find((e=>e.name===o));if(n&&"prop"===e.subject.content.referenceType){const t=new nr.P({content:{referenceType:"prop",id:n.id}});e.subject=t}}if("string"!==typeof e.body&&"dynamic"===(null===(s=e.body)||void 0===s?void 0:s.type)){const o=e.body.content.id,n=t.find((e=>e.name===o));if(n&&"prop"===e.body.content.referenceType){const t=new nr.P({content:{referenceType:"prop",id:n.id}});e.body=t}}break}}})),o)}getComponentPropDefinitions(e,t,o){const{propDefinitions:n}=e;if(!n||!Object.keys(n).length)return{propDefinitions:[],nodes:[]};const i=[];return{propDefinitions:Object.keys(n).map((e=>{const{defaultValue:r}=n[e],{type:s}=n[e],a=(0,ni.Ox)();switch(s){case"element":{const n=this.parseNodeHierarchy({node:r,propDefinitions:[],stateDefinitions:[],compId:t,isPage:!1,assetNames:{},uncommitedComponents:[],domainTranslations:o}),s=n.nodes.find((e=>e.id===r.id));return s&&"element-node"===s.type&&(s.meta={isPropRoot:{compId:t,prop:a}}),i.push(...n.nodes),{id:a,type:"richtext",defaultValue:"Prop Content",name:e,locations:{},defaultHierarchyRootId:null===s||void 0===s?void 0:s.id,hidden:e===lr.Q,inputType:jd.SO.RICH_TEXT}}default:return{id:a,type:s,defaultValue:r,name:e,locations:{},hidden:e===lr.Q,inputType:this.generatePropDefinitionInputType(n[e])}}})),nodes:i}}generatePropDefinitionInputType(e){switch(e.type){case"string":return jd.SO.TEXT;case"number":return jd.SO.NUMBER;case"boolean":return jd.SO.BOOLEAN;case"element":return jd.SO.RICH_TEXT;case"func":return jd.SO.FUNCTION;case"array":return jd.SO.ARRAY;case"object":return jd.SO.OBJECT;default:return jd.SO.TEXT}}syncNodeLinkAbilityIfGlobalReferenced(e,t,o){if(!o||!e.parentId)return;const{type:n,content:i}=o;if("url"!==n)return;const r=i.url;if("expr"!==r.type)return;const s=(0,Xc.rO)(r.content,t,e.parentId);s&&(e.abilities.link={type:$r.RZ.URL,content:{url:s,newTab:o.content.newTab}})}getComponentStateDefinitions(e){const{stateDefinitions:t}=e;return t&&Object.keys(t).length?Object.keys(t).map((e=>{const{defaultValue:o,type:n}=t[e];return{id:(0,ni.Ox)(),name:e,type:n,defaultValue:o,locations:{},inputType:lS(n),declarationType:"state"}})):[]}},Oz=(0,s.Z)(Tz.prototype,"projectDoc",[Sz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dz=Tz));const Ez=e=>{const t=e.split('"');return 3===t.length?`${t[0]}${yl.b.image.src}${t[2]}`:e},xz=async(e,t)=>{try{const o=await fetch(e,{headers:{accept:Br.un}}),n=await o.blob();return new File([n],t||"external",{type:n.type})}catch(o){throw new Error(`Could not fetch asset from remote src: ${o}`)}},_z=async(e,t,o)=>{try{const n=await fetch(e),i=await n.blob(),r=Math.random().toString(36).substring(9),s=Math.random().toString(36).substring(9),a="svg_xml"===o?"svg":o;return new File([i],`${t||r}-${s}.${a}`,{type:`image/${a}`})}catch(n){throw new Error(`Could not fetch base64 asset: ${n}`)}},Mz=(e,t,o)=>{const{type:n,name:i,categoryName:r}=(0,Xc.kg)(o);let s=null;if(r){const e=t.find((e=>e.name.toLowerCase()===r));s=(null===e||void 0===e?void 0:e.id)||null}return e.find((e=>{const t=e.type.toLowerCase()===n.toLowerCase()&&e.name.toLowerCase()===i.toLowerCase();return s?t&&e.categoryId===s:t}))};var Pz=o(928316),Az=o(258298),kz=o(897962),Uz=o(376897);const Rz="thq-tree-element",Zz=e=>{const t=!1===e.searchStatus?"hidden":"";return(0,ni.x8)(Rz,e.isExpandable&&"expandable",e.isHovered&&"hover",e.isSelected&&"selected",t)},Lz=[`.${Rz}.jsx-2731020226{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:28px;-webkit-transition:${N.OK.FADE};transition:${N.OK.FADE};border-radius:${N.n_.DEFAULT};position:relative;width:100%;border:1px solid transparent;padding-right:${N.N_.HALF_UNIT};}`,`.${Rz}.expandable.jsx-2731020226 .expand-icon.jsx-2731020226{position:absolute;top:5px;left:4px;-webkit-transform:rotate(-90deg);-ms-transform:rotate(-90deg);transform:rotate(-90deg);}`,`.${Rz}.jsx-2731020226 .label.jsx-2731020226{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:100%;position:relative;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.${Rz}.hidden.jsx-2731020226{display:none;}`,`.${Rz}.jsx-2731020226 .label.jsx-2731020226>*.jsx-2731020226{margin-right:${N.N_.UNIT};}`,`.${Rz}.expandable.jsx-2731020226 .expand-icon.jsx-2731020226 svg{-webkit-transition:${N.OK.MOVE};transition:${N.OK.MOVE};-webkit-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform-origin:50% 50%;}`,`.${Rz}.expandable.jsx-2731020226 .expand-icon.expanded.jsx-2731020226 svg{-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg);}`,`.${Rz}.hover.jsx-2731020226{color:${N.DM.GRAY_1000};border:1px solid ${N.DM.GRAY_500};}`,`.${Rz}.jsx-2731020226>.main-info.jsx-2731020226>.name.jsx-2731020226,.name.jsx-2731020226{z-index:${N.kg.TEN};pointer-events:none;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;word-break:break-all;-webkit-flex:1 0;-ms-flex:1 0;flex:1 0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.${Rz}.selected.jsx-2731020226{color:${N.DM.GRAY_1000};background-color:${N.DM.ACCENT_300};}`,`.${Rz}.selected.jsx-2731020226 svg{fill:${N.DM.GRAY_1000};z-index:${N.kg.TEN};}`,`.${Rz}.dragged.jsx-2731020226:before{background-color:${N.DM.GRAY_400};outline:1px dashed rgba(166,166,166,0.3);}`,`.${Rz}.dragged.jsx-2731020226{color:${N.DM.GRAY_800};font-weight:400;}`,`.${Rz}.dragged.jsx-2731020226 svg{fill:${N.DM.GRAY_800};}`,`.${Rz}.jsx-2731020226 .entity-type-icon.jsx-2731020226{padding-right:8px;pointer-events:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.${Rz}.jsx-2731020226 .icon-container.jsx-2731020226{margin-left:${N.N_.UNIT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.${Rz}.jsx-2731020226 .selector-section.jsx-2731020226{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:2px 4px;color:${N.DM.GRAY_900};border-radius:2px;margin-left:${N.N_.HALF_UNIT};background-color:${N.DM.GRAY_400};z-index:${N.kg.TEN};position:relative;}`,`.${Rz}.jsx-2731020226 .selector-section.classes.jsx-2731020226{background-color:${N.DM.GRAY_300};}`,`.${Rz}.selected.jsx-2731020226 .selector-section.jsx-2731020226{background-color:${N.DM.GRAY_900};color:${N.DM.GRAY_400};}`,`.${Rz}.jsx-2731020226 .selector-section.jsx-2731020226 span.jsx-2731020226{font-size:${N.um.INFO};white-space:nowrap;text-overflow:ellipsis;max-width:60px;overflow:hidden;margin-left:2px;}`,`.${Rz}.jsx-2731020226 .main-info.jsx-2731020226{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.${Rz}.jsx-2731020226 .extra-info.jsx-2731020226{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:28px;z-index:${N.kg.TEN};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:${N.N_.HALF_UNIT};}`,`.${Rz}.jsx-2731020226 .conditional-more-info.jsx-2731020226{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:2px ${N.N_.UNIT};color:${N.DM.GRAY_1000};height:80%;font-size:${N.um.INFO};background-color:${N.DM.GRAY_100};z-index:${N.kg.ONEHUNDRED};border-radius:${N.n_.DISCRETE};white-space:nowrap;}`,`.${Rz}.jsx-2731020226 .conditional.jsx-2731020226{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;width:100%;position:relative;}`,".no-pointer-events.jsx-2731020226{pointer-events:none;}",`.${Rz}.jsx-2731020226 .conditional-icon.jsx-2731020226{font-weight:700;font-size:8px;line-height:1;position:absolute;right:-6px;top:-4px;}`,`.${Rz}.jsx-2731020226 .conditional-icon.not-true.jsx-2731020226{right:50%;top:-2px;-webkit-transform:translateX(50%);-ms-transform:translateX(50%);transform:translateX(50%);}`,`.${Rz}.jsx-2731020226 .expand-collapse-all-icon-container.jsx-2731020226{width:20px;height:20px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`];Lz.__hash="2731020226";var $z=o(309109);const Bz=({comments:e,onCommentClick:t})=>0===e.length?null:(0,F.jsxs)("div",{className:v().dynamic([["3191241931",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.DM.GRAY_950,N.DM.GRAY_100]]])+" comment-threads-badge-container",children:[e.map((e=>(0,F.jsx)("div",{onClick:()=>null===t||void 0===t?void 0:t(e),className:v().dynamic([["3191241931",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.DM.GRAY_950,N.DM.GRAY_100]]])+" comment-threads-badge",children:(0,F.jsx)("img",{src:e.userInfo.avatar||"/static/img/default-avatar.png",alt:e.userInfo.name,className:v().dynamic([["3191241931",[N.N_.ONE_AND_HALF,N.N_.UNIT,N.DM.GRAY_950,N.DM.GRAY_100]]])})},e.id))),(0,F.jsx)(v(),{id:"3191241931",dynamic:[N.N_.ONE_AND_HALF,N.N_.UNIT,N.DM.GRAY_950,N.DM.GRAY_100],children:[`.comment-threads-badge-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-left:${N.N_.ONE_AND_HALF};margin-right:${N.N_.UNIT};}`,`.comment-threads-badge.__jsx-style-dynamic-selector{width:20px;height:20px;border-radius:50%;overflow:hidden;background-color:${N.DM.GRAY_950};margin-left:-4px;box-shadow:0 0 0 2px ${N.DM.GRAY_100};cursor:pointer;-webkit-transition:-webkit-transform 0.2s ease;-webkit-transition:transform 0.2s ease;transition:transform 0.2s ease;}`,".comment-threads-badge.__jsx-style-dynamic-selector:hover{z-index:1;-webkit-transform:scale(1.1);-ms-transform:scale(1.1);transform:scale(1.1);}",".comment-threads-badge.__jsx-style-dynamic-selector img.__jsx-style-dynamic-selector{width:100%;height:100%;object-fit:cover;}"]})]});var Gz,Hz,zz;let Yz=(Gz=(0,c.inject)("commentsFlow"),Hz=class extends w.Component{constructor(...e){super(...e),(0,i.Z)(this,"commentsFlow",zz,this),(0,r.Z)(this,"handleCommentClick",(e=>{this.commentsFlow.selectComment(e.id)}))}render(){const{comments:e}=this.props;return 0===e.length?null:(0,F.jsx)(Bz,{comments:e,onCommentClick:this.handleCommentClick})}},zz=(0,s.Z)(Hz.prototype,"commentsFlow",[Gz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hz);function Vz(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Wz(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Vz(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Vz(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Kz=e=>{const{isExpanded:t,isRoot:o,isHovered:n,isHidden:i,searchStatus:r,hasLink:s,conditionalNodeDetails:a,idAttribute:c,classNames:l,name:d,iconPath:p,isSelected:u=!1,isEditing:h,isExpandable:m,onNodeEditing:y,toggleShowChildren:g,expandCollapseAllChildren:f,onNodeRename:b,depth:I,compInstanceId:D,dragInProgress:T,nodeId:O,events:C,toggleEventsInspector:E,toggleVisualInspector:x,slotId:_,sidebarWidth:M,colorScheme:P,hasSomeError:A,animationOnNode:k,comments:U,showCommentsBadge:R}=e,Z=(0,w.useRef)(null),{0:L,1:$}=(0,w.useState)(!1),{0:B,1:G}=(0,w.useState)(!1),{0:H,1:z,2:Y,3:V,4:W}=(0,w.useMemo)((()=>{let e=(M||Bd.ak)-20-20-24*I-22-(c?68:0)-(l&&l.length?68:0)-(l&&l.length>1?20:0)-(s?20:0)-(i?20:0)-(C.length?20:0)-(a?20:0)-(m&&(n||u)?30:0);const t=e<30;t&&(e+=(l&&l.length?68:0)+(l&&l.length>1?20:0));const o=e<40;o&&(e+=c?68:0);const r=e<30;r&&(e+=(C.length?20:0)+(a?20:0));const d=e<30;return d&&(e+=m&&(n||u)?30:0),[e,t,o,r,d]}),[M,I,c,l,s,i,C,a,m,n,u]);if(h&&b)return(0,F.jsx)(Az.E,{id:O||"",initialValue:d||"",selectOnFocus:!0,inputSize:"sm-wide",onConfirmChange:b,indent:43+24*I});const K=e=>{e.target&&e.target.closest(".expand-icon")||y&&y()};if(o)return(0,F.jsxs)("div",{ref:Z,"data-node-id":O,"data-slot-id":_,onDoubleClick:K,style:{paddingLeft:"4px"},className:`jsx-${Lz.__hash} `+(Zz({isExpandable:!1,isSelected:u||!1,isHovered:n||!1,searchStatus:r})||""),children:[(0,F.jsx)("div",{className:`jsx-${Lz.__hash} entity-type-icon`,children:(0,F.jsx)(S.J,{type:_m.TV.layers,size:14,color:u?P.nodeIcon.selected:n?P.nodeIcon.hovered:P.nodeIcon.inactive})}),(0,F.jsxs)("div",{className:`jsx-${Lz.__hash} main-info`,children:[(0,F.jsx)("span",{style:{maxWidth:H},className:`jsx-${Lz.__hash} name`,children:d}),R&&(0,F.jsx)(Yz,{comments:U})]}),(0,F.jsx)(v(),{id:Lz.__hash,children:Lz})]});const q=l.slice(1).join("-"),J=T?"no-pointer-events":"";return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{ref:Z,"data-node-id":O,"data-slot-id":_,"data-comp-instance-id":D&&"root"!==D?D:void 0,"data-node-depth":I,"data-node-expandable":m,"data-node-expanded":t,onDoubleClick:K,style:Wz(Wz({paddingLeft:20+24*I+"px"},u?{backgroundColor:P.node.selected}:{backgroundColor:P.node.inactive}),{},{justifyContent:"space-between"}),className:`jsx-${Lz.__hash} `+(Zz({isExpandable:m,isSelected:u||!1,isHovered:n||!1,searchStatus:r})||""),children:[(0,F.jsxs)("div",{className:`jsx-${Lz.__hash} main-info`,children:[m&&!W&&(0,F.jsx)("span",{style:{left:6+24*I+"px"},onClick:g,className:`jsx-${Lz.__hash} ${t?"expand-icon expanded":"expand-icon"} ${J}`,children:(0,F.jsx)(S.J,{type:"expand",size:12})}),(0,F.jsx)("div",{className:`jsx-${Lz.__hash} entity-type-icon`,children:A?(0,F.jsx)($z.r,{type:p,size:14,color:u?P.nodeIcon.selected:n?P.nodeIcon.hovered:P.nodeIcon.inactive}):(0,F.jsx)(S.J,{type:p,size:14,color:u?P.nodeIcon.selected:n?P.nodeIcon.hovered:P.nodeIcon.inactive})}),(0,F.jsx)("span",{style:{maxWidth:H},className:`jsx-${Lz.__hash} name`,children:d}),R&&(0,F.jsx)(Yz,{comments:U}),c&&!Y?(0,F.jsx)("div",{"data-tooltip-name":`#${c}`,className:`jsx-${Lz.__hash} selector-section`,children:(0,F.jsxs)("span",{className:`jsx-${Lz.__hash}`,children:["#",c]})}):null,l&&l.length&&!z?l.slice(0,1).map((e=>(0,F.jsx)("div",{className:`jsx-${Lz.__hash} selector-section classes no-pointer-events`,children:(0,F.jsxs)("span",{className:`jsx-${Lz.__hash}`,children:[".",e]})},e))):null,l&&l.length>1&&!z?(0,F.jsxs)("div",{"data-tooltip-name":q,className:`jsx-${Lz.__hash} selector-section classes ${J}`,children:["+",l.length-1,(0,F.jsx)(Uz._,{name:q,children:(0,F.jsx)(F.Fragment,{children:l.slice(1).map((e=>(0,F.jsxs)("div",{style:{padding:"2px 8px"},className:`jsx-${Lz.__hash}`,children:[".",(0,F.jsx)("span",{className:`jsx-${Lz.__hash}`,children:e})]},e)))})})]},d):null,s&&(0,F.jsx)("div",{className:`jsx-${Lz.__hash} icon-container`,children:(0,F.jsx)(S.J,{type:"link",size:12})}),i&&(0,F.jsx)("div",{className:`jsx-${Lz.__hash} icon-container`,children:(0,F.jsx)(S.J,{type:"eye-closed",size:14})}),k&&(0,F.jsx)("div",{className:`jsx-${Lz.__hash} icon-container`,children:(0,F.jsx)("span",{"data-tooltip-name":(0,kz.Z)(k),"data-tooltip-direction":"vertical",style:{height:12},className:`jsx-${Lz.__hash}`,children:(0,F.jsx)(S.J,{type:"animate-on-reveal",size:12})})})]}),C.length||a||m?(0,F.jsxs)("div",{className:`jsx-${Lz.__hash} extra-info`,children:[C.length&&!V?(0,F.jsx)(j.z,{title:"Element has events bound to it, click to show bound events!",size:"tiny",shape:"square",colorScheme:"dynamic",style:"transparent",onClick:E,children:(0,F.jsx)(S.J,{type:"bolt",size:14})}):null,a&&!V&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(j.z,{title:O,size:"tiny",shape:"square",colorScheme:"dynamic",style:"transparent",onClick:x,children:(0,F.jsxs)("div",{className:`jsx-${Lz.__hash} conditional`,children:[(0,F.jsx)(S.J,{type:a.renderedInStage?"eye-open":"eye-closed",size:16}),(0,F.jsx)("span",{className:`jsx-${Lz.__hash} conditional-icon `+(a.renderedInStage?"":"not-true"),children:"C"})]})}),(0,F.jsx)(Uz._,{name:O,children:(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",padding:"8px",borderRadius:"4px",alignItems:"flex-start"},className:`jsx-${Lz.__hash}`,children:[(0,F.jsxs)("span",{className:`jsx-${Lz.__hash}`,children:["Element is conditionally rendered and right now the condition is",a.renderedInStage?(0,F.jsx)("strong",{className:`jsx-${Lz.__hash}`,children:" MET."}):(0,F.jsx)("strong",{className:`jsx-${Lz.__hash}`,children:" NOT MET."})]}),(0,F.jsxs)("div",{className:`jsx-${Lz.__hash}`,children:[(0,F.jsx)("span",{className:`jsx-${Lz.__hash}`,children:"Rendering condition"}),(0,F.jsxs)("span",{style:{display:"flex",gap:"4px",alignItems:"center",padding:"4px 8px",color:N.DM.GRAY_1000,backgroundColor:N.DM.GRAY_100,borderRadius:N.n_.DISCRETE,width:"fit-content",marginTop:"4px"},className:`jsx-${Lz.__hash}`,children:[(0,F.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},className:`jsx-${Lz.__hash}`,children:[(0,F.jsx)(S.J,{size:12,type:"prop"===a.boundToStatePropOrGlobal.type?"component/props":"component/state"}),a.boundToStatePropOrGlobal.name," ",a.boundToStatePropOrGlobal.operation]})," ",a.boundToStatePropOrGlobal.renderValue.toString()]})]})]})})]}),m&&(0,F.jsx)("div",{style:{display:n||u?"flex":"none"},className:`jsx-${Lz.__hash}`,children:t?(0,F.jsx)("div",{onMouseEnter:()=>G(!0),onMouseLeave:()=>G(!1),onClick:()=>{f(!1)},style:{backgroundColor:B?u?P.expandCollapseIcon.selected:P.expandCollapseIcon.inactive:""},className:`jsx-${Lz.__hash} expand-collapse-all-icon-container`,children:(0,F.jsx)("span",{"data-tooltip-name":"Collapse all","data-tooltip-direction":"vertical",style:{height:12},className:`jsx-${Lz.__hash}`,children:(0,F.jsx)(S.J,{type:"collapse-all",size:12})})}):(0,F.jsx)("div",{onMouseEnter:()=>$(!0),onMouseLeave:()=>$(!1),onClick:()=>{f(!0)},style:{backgroundColor:L?u?P.expandCollapseIcon.selected:P.expandCollapseIcon.inactive:""},className:`jsx-${Lz.__hash} expand-collapse-all-icon-container`,children:(0,F.jsx)("span",{"data-tooltip-name":"Expand all","data-tooltip-direction":"vertical",style:{height:12},className:`jsx-${Lz.__hash}`,children:(0,F.jsx)(S.J,{type:"expand-all",size:12})})})})]}):null]}),(0,F.jsx)(v(),{id:Lz.__hash,children:Lz})]})};var qz,Jz,Xz,Qz,eY,tY,oY,nY,iY,rY,sY,aY,cY,lY,dY,pY,uY,hY,mY,yY,gY,fY,bY;function IY(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function vY(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?IY(Object(o),!0).forEach((function(t){(0,r.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):IY(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let wY=(qz=(0,c.inject)("projectDoc"),Jz=(0,c.inject)("projectUIState"),Xz=(0,c.inject)("nodeEditingFlow"),Qz=(0,c.inject)("nodeSelectionFlow"),eY=(0,c.inject)("nodeManagementFlow"),tY=(0,c.inject)("nodeStyleManagmentFlow"),oY=(0,c.inject)("mainInspectorFlow"),nY=(0,c.inject)("componentManagementFlow"),iY=(0,c.inject)("pageManagementFlow"),rY=(0,c.inject)("layoutManagementFlow"),sY=(0,c.inject)("commentsFlow"),aY=class extends w.PureComponent{constructor(e){var t,o,n;super(e),(0,i.Z)(this,"projectDoc",cY,this),(0,i.Z)(this,"projectUIState",lY,this),(0,i.Z)(this,"nodeEditingFlow",dY,this),(0,i.Z)(this,"nodeSelectionFlow",pY,this),(0,i.Z)(this,"nodeManagementFlow",uY,this),(0,i.Z)(this,"nodeStyleManagmentFlow",hY,this),(0,i.Z)(this,"mainInspectorFlow",mY,this),(0,i.Z)(this,"componentManagementFlow",yY,this),(0,i.Z)(this,"pageManagementFlow",gY,this),(0,i.Z)(this,"layoutManagementFlow",fY,this),(0,i.Z)(this,"commentsFlow",bY,this),(0,r.Z)(this,"unsubs",[]),(0,r.Z)(this,"_isMounted",!1),(0,r.Z)(this,"getClassList",(()=>this.projectUIState.userPreferences.classesInTreeView?this.projectDoc.getUsedProjectClassesForNodesByPos([this.props.nodeId]).map((({name:e})=>e)):[])),(0,r.Z)(this,"subscribeForTreeViewExpandedStatus",(()=>{const e=(0,a.select)(this.projectUIState,[`selection/expandedTreeNodes/${this.props.compInstanceId}/${this.props.nodeId}`],((e,t)=>{t.forEach((e=>{const{op:t,value:o}=e;"add"!==t?"remove"!==t?"replace"!==t||this.setState({expanded:o}):this.setState({expanded:!1}):this.setState({expanded:!0})}))}),"TreeNode");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForNameChanges",(()=>{const e=(0,a.select)(this.projectDoc,[`nodes/byId/${this.props.nodeId}/name`],(()=>{this.setState({displayName:this.nodeEditingFlow.getNodeDisplayName([this.props.nodeId])})}),"TreeNode1");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForNodeChanges",(()=>{const e=(0,a.select)(this.projectDoc,[`nodes/byId/${this.props.nodeId}/childrenIds/**`],((e,t)=>{t.forEach((t=>{const{pathArray:o,op:n}=t,{nodeId:i}=this.props,r=e.nodes.getById(i);if(r&&5===o.length&&"childrenIds"===o[3]&&!r.compIdOfRootNode){const e=r&&"childrenIds"in r?r.childrenIds:{};if("add"===n&&Object.keys(e||{}).length>0)return void this.nodeSelectionFlow.setExpandedTreeNodeValue(i,!0);"remove"===n&&0===Object.keys(e||{}).length&&this.nodeSelectionFlow.setExpandedTreeNodeValue(i,!1)}}));const{nodeId:o}=this.props,n=e.nodes.getById(o);if(n&&(n.primitiveType===Zn.sO.TEXT||n.primitiveType===Zn.IV.NAVBAR)){const e=this.nodeEditingFlow.getElementIconPath([this.props.nodeId]);e&&this.setState({iconPath:e})}}),"TreeNode2");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForUIState",(()=>{const e=(0,a.select)(this.projectUIState,[...Y$.C,...Y$.E,"nodesList/renamedNodeId","invalidDynamicProperties/*"],(e=>{if(!this._isMounted)return;const t=this.nodeSelectionFlow.isNodeSelected(this.props.nodeId,e);this.setState({selected:t,editing:e.nodesList.renamedNodeId===this.props.nodeId,hovered:-1!==this.nodeSelectionFlow.getArrayOfHoveredNodeIds().indexOf(this.props.nodeId),hasSomeError:this.nodeManagementFlow.nodeHasSomeError({nodeId:this.props.nodeId,uiState:e})})}),"TreeNode3");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForLinkAbilityChanges",(()=>{const e=(0,a.select)(this.projectDoc,[`nodes/byId/${this.props.nodeId}/abilities/link`],(e=>{const t=e.nodes.getById(this.props.nodeId);this._isMounted&&this.setState({hasLink:!!(t&&"abilities"in t&&t.abilities.link)})}),"TreeNode4"),t=(0,a.select)(this.projectDoc,[`nodes/byId/${this.props.nodeId}/attrs/id`],(e=>{var t,o;const n=e.nodes.getById(this.props.nodeId),i=n&&null!==(t=null===(o=(0,tl.b3)(n,"id"))||void 0===o?void 0:o.toString())&&void 0!==t?t:null;this._isMounted&&this.setState({idAttr:i})}),"SectionIdWrapper");this.unsubs.push((()=>e.dispose()),(()=>t.dispose()))})),(0,r.Z)(this,"subscribeForDisplayStyleChanges",(()=>{const e=this.mainInspectorFlow.getSelectorsListForProperties(["display","flexDirection"],this.props.nodeId),t=(0,a.select)(this.projectDoc,[...e],((e,t)=>{if(this.mainInspectorFlow.haveStylePropertiesChangedInPatches(t,["display","flexDirection"])){const e=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(this.props.nodeId,["display"]),t=this.nodeEditingFlow.getElementIconPath([this.props.nodeId]);this._isMounted&&this.setState({hidden:"none"===e.display,iconPath:t})}}),"TreeNode5"),o=(0,a.select)(this.projectUIState,["stage/matchedBreakpoint"],(()=>{const e=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(this.props.nodeId,["display"]);this._isMounted&&this.setState({hidden:"none"===e.display})}),"TreeNode6");this.unsubs.push((()=>t.dispose()),(()=>o.dispose()))})),(0,r.Z)(this,"subscribeForCompNameChanges",(()=>{const{id:e,collection:t}=this.state.comp;if(!e||!t)return;const o=(0,a.select)(this.projectDoc,[`${t}/byId/${e}/title`],(o=>{const n=o[t].byId[e];this._isMounted&&this.setState({comp:vY(vY({},this.state.comp),{},{name:null===n||void 0===n?void 0:n.title}),displayName:this.nodeEditingFlow.getNodeDisplayName([this.props.nodeId])})}),"TreeNode7");this.unsubs.push((()=>o.dispose()))})),(0,r.Z)(this,"subscribeForClassPreferencesChanges",(()=>{const e=(0,a.select)(this.projectUIState,["userPreferences/classesInTreeView"],(()=>{this._isMounted&&this.setState({classList:this.getClassList()})}),"TreeNode8"),t=(0,a.select)(this.projectUIState,["userPreferences/showElementTag"],(()=>{this._isMounted&&this.setState({displayName:this.nodeEditingFlow.getNodeDisplayName([this.props.nodeId])})}),"TreeNode9");this.unsubs.push((()=>e.dispose()),(()=>t.dispose()))})),(0,r.Z)(this,"subscribeForClassListChanges",(()=>{const e=(0,a.select)(this.projectDoc,["nodes/byId/*/referencedStyles/*","nodes/byId/*/referencedStyles","classes/byId/*/name"],(()=>{this._isMounted&&this.setState({classList:this.getClassList()})}),"TreeNode10");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForDragInProgressChanges",(()=>{const e=(0,a.select)(this.projectUIState,["drag/draggedEntity","selection/componentId"],(e=>{this._isMounted&&this.setState({dragInProgress:!!e.drag.draggedEntity,hidden:this.getHiddenStatus()})}),"TreeNode11");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForResourceDefinitionChanges",(()=>{const e=(0,a.select)(this.projectDoc,[`nodes/byId/${this.props.nodeId}/resourceDefinition/**`,`nodes/byId/${this.props.nodeId}/resourceDefinition`],(e=>{this._isMounted&&this.setState({hasSomeError:this.nodeManagementFlow.nodeHasSomeError({nodeId:this.props.nodeId,doc:e})})}),"TreeNodeCMSResource");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForConditionalRendering",(()=>{const e=(0,a.select)(this.projectDoc,[`nodes/byId/${this.props.nodeId}/renderingConditions`,`nodes/byId/${this.props.nodeId}/renderingConditions/**`],(e=>{const t=e.nodes.getById(this.props.nodeId);if(!t)return;const o=this.getConditionalNodeDetails(t.id,this.projectUIState);this._isMounted&&this.setState({conditionalNodeDetails:o})}),"TreeNode12");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForEvents",(()=>{const e=(0,a.select)(this.projectDoc,[`nodes/byId/${this.props.nodeId}/events`,`nodes/byId/${this.props.nodeId}/events/**`],(e=>{const t=e.nodes.getById(this.props.nodeId);if(!t)return;const o="events"in t?Object.keys(t.events):[];this._isMounted&&this.setState({events:o})}),"TreeNode13");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForCompStateValue",(()=>{if(!this.projectUIState.selection.componentId)return;const e=(0,a.select)(this.projectUIState,["componentList/stateValues","componentList/stateValues/**","componentList/propValues/","componentList/propValues/**"],(e=>{const t=this.getConditionalNodeDetails(this.props.nodeId,e),o=this.getHiddenStatus();this._isMounted&&this.setState({hidden:o,conditionalNodeDetails:t})}),"TreeNode14");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForCompInstanceIdSelection",(()=>{const e=(0,a.select)(this.projectUIState,["selection/compInstanceId"],(e=>{this._isMounted&&this.setState({selectedCompInstanceId:e.selection.compInstanceId})}),"TreeNodeCompInstanceId");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForSidebarWidthChanges",(()=>{const e=(0,a.select)(this.projectUIState,["sidebarSettings/width"],(e=>{this.setState({sidebarWidth:e.sidebarSettings.width})}),"TreeNode15");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subForNodeAnimationProperties",(()=>{const e=(0,a.select)(this.projectDoc,[`nodes/byId/${this.props.nodeId}/attrs/${ir.E0}/`,`nodes/byId/${this.props.nodeId}/attrs/${ir.E0}/**`,...Object.keys(or.xK).map((e=>`nodes/byId/${this.props.nodeId}/styles/${e}`)),...Object.keys(or.xK).map((e=>`nodes/byId/${this.props.nodeId}/styles/${e}/**`))],(e=>{const t=e.nodes.getById(this.props.nodeId);this.setState({animationOnNode:"element-node"===(null===t||void 0===t?void 0:t.type)?t.getAnimationOnNode():void 0})}),"TreeNode16");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subForMappingChanges",(()=>{const e=(0,a.select)(this.projectDoc,[`nodes/byId/${this.props.nodeId}/mappings/**`],((e,t)=>{t.forEach((t=>{const{op:o,pathArray:n}=t,{nodeId:i}=this.props,r=e.nodes.getById(i);if(!r||!("mappings"in r)||"mappings"!==n[3]||n[2]!==i)return;const s=Object.values(r.mappings).filter((e=>e.componentId));this.forceUpdate(),"add"===o&&s.length>0?this.nodeSelectionFlow.setExpandedTreeNodeValue(i,!0):"remove"===o&&0===s.length&&this.nodeSelectionFlow.setExpandedTreeNodeValue(i,!1)}))}),"TreeNodeMappings");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subForSearchChanges",(()=>{const e=(0,a.select)(this.projectUIState,["treeviewSearch/*"],(({treeviewSearch:e})=>{if(!e.searchTerm)return void this.setState({searchStatus:null});if(!this.projectDoc.nodes.getById(this.props.nodeId))return;const t=this.nodeEditingFlow.nodeMeetsSearchCondition(vY({nodeId:this.props.nodeId},e));this.setState({searchStatus:t})}),"TreeNodeSearch");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForCommentsChanges",(()=>{const e=(0,a.select)(this.projectDoc,["comments/byId","comments/byId/**"],(()=>{this.setState({comments:this.getFilteredCommentsForNode()})}),"TreeNodeComments");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subForShowCommentsBadges",(()=>{const e=(0,a.select)(this.projectUIState,["layout/commentsTab"],(()=>{this.setState({showCommentsBadge:"hidden"!==this.projectUIState.layout.commentsTab})}),"TreeNodeShowComments");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"subscribeForCommentsFiltersChanges",(()=>{const e=(0,a.select)(this.projectUIState,["comments/activeFilters/*"],(()=>{this.setState({comments:this.getFilteredCommentsForNode()})}),"TreeNodeCommentsFilters");this.unsubs.push((()=>e.dispose()))})),(0,r.Z)(this,"handleEditing",(()=>{this.nodeManagementFlow.setRenamedNode(this.props.nodeId)})),(0,r.Z)(this,"toggleShowChildren",(()=>{this.nodeSelectionFlow.toggleExpandedTreeNode(this.props.nodeId,this.props.compInstanceId)})),(0,r.Z)(this,"expandCollapseAllChildren",(e=>{const t=this.projectDoc.nodes.getById(this.props.nodeId);t&&this.loopExpandCollapseChildren(t,e,this.props.compInstanceId)})),(0,r.Z)(this,"loopExpandCollapseChildren",((e,t,o)=>{if(!this.getIsExpandable(e.id,o))return;t?this.nodeSelectionFlow.forceExpandTreeNode(e.id,o):this.nodeSelectionFlow.forceCollapseTreeNode(e.id,o);let n=this.projectDoc.nodes.getChildren(e);if("slot"===e.primitiveType){const t=this.projectDoc.nodes.getById(o);n=Object.keys(t.slottedNodes[e.id])}n.forEach((n=>{const i=this.projectDoc.nodes.getById(n);i&&this.loopExpandCollapseChildren(i,t,"slot"===i.primitiveType?e.id:o)}))})),(0,r.Z)(this,"handleNodeRename",((e,t)=>{this.nodeManagementFlow.setRenamedNode(null);const o=this.projectDoc.nodes.getById(e);null!==o&&void 0!==o&&o.compIdOfRootNode?"components"===this.state.comp.collection?this.componentManagementFlow.renameComponent({id:this.state.comp.id||"",newName:t}):this.pageManagementFlow.renamePage({id:this.state.comp.id||"",newName:t}):this.nodeEditingFlow.rename({id:e,value:t})})),(0,r.Z)(this,"getIsExpandable",((e,t)=>{var o;const n=this.projectDoc.nodes.getById(e);if(!n)return!1;if(!n.getNodeAllowedOps().expandTreeviewNode)return!1;let i=!!(Object.keys("childrenIds"in n&&(null===n||void 0===n?void 0:n.childrenIds)||{}).length>0&&null!==(o=Zn.y7[n.primitiveType])&&void 0!==o&&o.length);var r;this.projectDoc.nodes.nodeIsCompInstance(n)&&(i=!!Object.keys((null===(r=this.projectDoc.components.byId[n.compIdOfCompInstance])||void 0===r?void 0:r.slots)||{}).length);if("stateNodeRoots"in n&&(i=!!Object.keys(n.stateNodeRoots).length),"mappings"in n&&(i=!!Object.values(n.mappings).filter((e=>e.componentId)).length),n.primitiveType===Zn.sO.SLOT){const e=this.projectDoc.nodes.getById(t);i=!!e&&!!Object.keys(e.slottedNodes[n.id]||{}).length}return i})),(0,r.Z)(this,"getIdAttribute",(()=>{var e,t,o;const n=this.projectDoc.nodes.getById(this.props.nodeId);if(!n||!n.primitiveType||!("attrs"in n))return null;const i=n&&null!==(e=null===(t=(0,tl.b3)(n,"id"))||void 0===t?void 0:t.toString())&&void 0!==e?e:null;if(void 0===i)return null;const r=null===(o=n.attrs)||void 0===o?void 0:o.id;if(!r)return null;if("dynamic"===r.type)switch(r.content.referenceType){case"prop":{var s;const e=this.projectDoc.getProjectPageOrComponent(this.projectDoc.getComponentIdForNode(n.id)||""),t=null===e||void 0===e?void 0:e.propDefinitions[(null===(s=r.content)||void 0===s?void 0:s.id)||""];if(t)return`props.${t.name}${i||""}`}case"state":{var a;const e=this.projectDoc.getProjectPageOrComponent(this.projectDoc.getComponentIdForNode(n.id)||""),t=null===e||void 0===e?void 0:e.stateDefinitions[(null===(a=r.content)||void 0===a?void 0:a.id)||""];if(t)return`state.${t.name}${i||""}`}case"ctx":var c,l,d;return`${null===(c=this.projectDoc.nodes.findNodeByContextId(r.content.id,n.id).attrs)||void 0===c||null===(l=c.contextName)||void 0===l?void 0:l.content}${null!==(d=r.content.refPath)&&void 0!==d&&d.length?`${r.content.refPath.join(".")}`:""}`;default:return""}return i})),(0,r.Z)(this,"getFilteredCommentsForNode",(()=>{const{rootComments:e}=this.commentsFlow.getFilteredAndSortedComments(this.projectUIState.comments.activeSortRule,{myThreadsOnly:this.projectUIState.comments.activeFilters.myThreadsOnly,showResolved:this.projectUIState.comments.activeFilters.showResolved,searchTerm:this.projectUIState.comments.activeFilters.searchTerm,showOnlyCurrentPageOrComponent:this.projectUIState.comments.activeFilters.showOnlyCurrentPageOrComponent}),t=this.projectDoc.nodes.getById(this.props.nodeId);if(!t)return[];const o=!!t.compIdOfRootNode;return e.filter((e=>{if(e.boundToEntityId===this.props.nodeId)return!0;if(o){if(!this.projectDoc.nodes.getById(e.boundToEntityId)){var t;const o=e.pageOrComponentId;return(null===(t=this.projectDoc.getProjectPageOrComponent(o))||void 0===t?void 0:t.rootNodeId)===this.props.nodeId}}return!1}))}));const s=this.nodeSelectionFlow.isNodeSelected(this.props.nodeId);let c=!1;null!==(t=this.projectUIState.selection.expandedTreeNodes[this.props.compInstanceId])&&void 0!==t&&t[this.props.nodeId]&&(c=!0);const l=this.projectDoc.nodes.getById(this.props.nodeId);let d=!1,p={};if(l&&"compIdOfRootNode"in l&&"abilities"in l){const{compIdOfRootNode:e,abilities:{link:t}}=l;if(t&&(d=!0),e){const t=this.projectDoc.pages.byId[e||""],o=this.projectDoc.components.byId[e||""],n=this.projectDoc.cmsPages.byId[e||""];t?p={name:t.title,id:t.id,collection:"pages"}:o?p={name:o.title,id:o.id,collection:"components"}:n&&(p={name:n.title,id:n.id,collection:"cmsPages"})}if(this.projectDoc.nodes.nodeIsCompInstance(l)){const e=this.projectDoc.components.byId[l.compIdOfCompInstance];e&&(p={name:e.title,id:e.id,collection:"components"})}}this.state={selected:s,selectedCompInstanceId:this.projectUIState.selection.compInstanceId,editing:!1,expanded:c,hovered:!1,name:null,hasSomeError:this.nodeManagementFlow.nodeHasSomeError({nodeId:this.props.nodeId}),comp:p,hasLink:d,classList:this.getClassList(),idAttr:l?null!==(o=null===(n=(0,tl.b3)(l,"id"))||void 0===n?void 0:n.toString())&&void 0!==o?o:"":null,hidden:this.getHiddenStatus(),displayName:this.nodeEditingFlow.getNodeDisplayName([this.props.nodeId]),dragInProgress:!!this.projectUIState.drag.draggedEntity,iconPath:this.nodeEditingFlow.getElementIconPath([this.props.nodeId]),conditionalNodeDetails:this.getConditionalNodeDetails(this.props.nodeId,this.projectUIState),events:l&&"events"in l?Object.keys(l.events):[],sidebarWidth:this.projectUIState.sidebarSettings.width,animationOnNode:"element-node"===(null===l||void 0===l?void 0:l.type)?l.getAnimationOnNode():void 0,searchStatus:null,comments:this.getFilteredCommentsForNode(),showCommentsBadge:"hidden"!==this.projectUIState.layout.commentsTab}}componentDidMount(){this._isMounted=!0,this.subscribeForChanges()}subscribeForChanges(){this.subscribeForUIState(),this.subscribeForNodeChanges(),this.subscribeForTreeViewExpandedStatus(),this.subscribeForNameChanges(),this.subscribeForLinkAbilityChanges(),this.subscribeForDisplayStyleChanges(),this.subscribeForCompNameChanges(),this.subscribeForClassPreferencesChanges(),this.subscribeForClassListChanges(),this.subscribeForDragInProgressChanges(),this.subscribeForResourceDefinitionChanges(),this.subscribeForConditionalRendering(),this.subscribeForEvents(),this.subscribeForCompStateValue(),this.subscribeForSidebarWidthChanges(),this.subForNodeAnimationProperties(),this.subForMappingChanges(),this.subForSearchChanges(),this.subscribeForCommentsChanges(),this.subForShowCommentsBadges(),this.subscribeForCommentsFiltersChanges(),this.subscribeForCompInstanceIdSelection()}getHiddenStatus(){if(!this.projectDoc.nodes.getById(this.props.nodeId))return!0;return"none"===this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(this.props.nodeId,["display"]).display}getConditionalNodeDetails(e,t){var o,n,i,r;const s=this.projectDoc.nodes.getById(e),a=t.selection.componentId;if(!s||!("renderingConditions"in s)||!s.renderingConditions||!a)return null;const c=this.projectDoc.getProjectPageOrComponent(a);if(!c)return null;const{stateDefinitions:l,propDefinitions:d}=c,p=s.renderingConditions.reference.id,u="global"===s.renderingConditions.reference.content.referenceType,h=u?p:Object.keys(l).find((e=>l[e].name===p||l[e].id===p))||Object.keys(d).find((e=>d[e].id===p));if(!h)return null;const m=this.projectDoc.getComponentIdForNode(s.id),y=s.renderingConditions.reference.content.referenceType,g=null===(o=s.renderingConditions.condition)||void 0===o?void 0:o.conditions[0],f=u?h.split("__").pop():(null===(n=l[h])||void 0===n?void 0:n.name)||(null===(i=d[h])||void 0===i?void 0:i.name)||"";return{renderedInStage:this.nodeStyleManagmentFlow.nodeSatisfiesStateRenderingCondition(s.id,m,"root"),boundToStatePropOrGlobal:{id:h,type:y,operation:(null===g||void 0===g?void 0:g.operation)||"",name:f,renderValue:(null===g||void 0===g||null===(r=g.operand)||void 0===r?void 0:r.toString())||""}}}unsubscribeFromChanges(){this.unsubs.forEach((e=>e())),this.unsubs=[]}componentWillUnmount(){this._isMounted=!1,this.unsubscribeFromChanges()}render(){const e=this.projectDoc.nodes.getById(this.props.nodeId);if(!e||!e.primitiveType||!("attrs"in e))return null;const t=this.getIsExpandable(this.props.nodeId,this.props.compInstanceId),o=this.getIdAttribute(),{selected:n,expanded:i,hovered:r,editing:s,hidden:a,hasLink:c,classList:l,dragInProgress:d,displayName:u,iconPath:h,conditionalNodeDetails:m,events:y,sidebarWidth:g,hasSomeError:f,searchStatus:b,selectedCompInstanceId:I,comments:v}=this.state;return(0,F.jsx)(Kz,{comments:v,showCommentsBadge:this.state.showCommentsBadge,isSelected:n||I===this.props.nodeId,isExpanded:i,isEditing:s,isHovered:r,isHidden:a,hasLink:c,conditionalNodeDetails:m,iconPath:h,classNames:l,nodeId:e.id,name:u,slotId:e.slotId,searchStatus:b,onNodeRename:this.handleNodeRename,onNodeEditing:this.handleEditing,hasSomeError:f,toggleShowChildren:this.toggleShowChildren,expandCollapseAllChildren:this.expandCollapseAllChildren,isRoot:!!e.compIdOfRootNode,depth:this.props.depth,isExpandable:t,idAttribute:o,compInstanceId:this.props.compInstanceId,dragInProgress:d,events:y,toggleEventsInspector:()=>this.layoutManagementFlow.changeInspectorType(p.dG.EVENTS),toggleVisualInspector:()=>this.layoutManagementFlow.changeInspectorType(p.dG.VISUAL),colorScheme:this.props.colorScheme,sidebarWidth:g,animationOnNode:this.state.animationOnNode})}},cY=(0,s.Z)(aY.prototype,"projectDoc",[qz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lY=(0,s.Z)(aY.prototype,"projectUIState",[Jz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dY=(0,s.Z)(aY.prototype,"nodeEditingFlow",[Xz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pY=(0,s.Z)(aY.prototype,"nodeSelectionFlow",[Qz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uY=(0,s.Z)(aY.prototype,"nodeManagementFlow",[eY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hY=(0,s.Z)(aY.prototype,"nodeStyleManagmentFlow",[tY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mY=(0,s.Z)(aY.prototype,"mainInspectorFlow",[oY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yY=(0,s.Z)(aY.prototype,"componentManagementFlow",[nY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gY=(0,s.Z)(aY.prototype,"pageManagementFlow",[iY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fY=(0,s.Z)(aY.prototype,"layoutManagementFlow",[rY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bY=(0,s.Z)(aY.prototype,"commentsFlow",[sY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aY);var NY,jY,SY,DY,TY;NY=(0,c.provide)("domainNodeToTreeNodeMapper"),jY=(0,c.inject)("projectDoc"),NY((DY=class{constructor(){(0,i.Z)(this,"projectDoc",TY,this)}renderDomainNodeIntoTreeNode(e){const{nodeId:t,depth:o,compInstanceId:n,treeNode:i}=e;Pz.render(w.createElement(wY,{nodeId:t,depth:o,compInstanceId:n,colorScheme:this.getColorSchemeForTreeNode(t,n)}),i)}getColorSchemeForTreeNode(e,t){const o=this.projectDoc.nodes.getById(e),n={node:{selected:N.DM.ACCENT_400,inactive:"transparent"},expandCollapseIcon:{selected:"transparent",inactive:N.DM.GRAY_300},nodeIcon:{selected:N.DM.GRAY_1000,hovered:N.DM.GRAY_1000,inactive:N.DM.GRAY_700}};return(this.projectDoc.nodes.getAvailableContextIdsForNode(e,t).length||"cms-collection-list-node"===(null===o||void 0===o?void 0:o.type)||"cms-collection-item-node"===(null===o||void 0===o?void 0:o.type))&&(n.node={selected:N.DM.DYNAMIC_HIGHLIGHT,inactive:"transparent"},n.expandCollapseIcon={selected:"transparent",inactive:N.DM.DYNAMIC_HIGHLIGHT},n.nodeIcon={selected:N.DM.GRAY_1000,hovered:N.DM.DYNAMIC_HIGHLIGHT,inactive:N.DM.DYNAMIC_HIGHLIGHT}),(null===o||void 0===o?void 0:o.primitiveType)===Zn.sO.COMPONENT&&(n.node={selected:N.DM.PURPLE_500,inactive:"transparent"},n.expandCollapseIcon.selected="transparent",n.nodeIcon={selected:N.DM.GRAY_1000,hovered:N.DM.PURPLE_500,inactive:N.DM.PURPLE_500}),"element-node"===(null===o||void 0===o?void 0:o.type)&&o.isInteractive()&&(n.node.selected=N.DM.PINK_DARK,n.nodeIcon={selected:N.DM.GRAY_1000,inactive:N.DM.PINK_DARK,hovered:N.DM.PINK_DARK}),n}},TY=(0,s.Z)(DY.prototype,"projectDoc",[jY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SY=DY))},649182:function(e,t,o){"use strict";o.d(t,{D:function(){return n}});const n=()=>'\nhtml {\n  line-height: 1.15;\n}\nbody {\n  margin: 0;\n}\n\n* {\n  box-sizing: border-box;\n  border-width: 0;\n  border-style: solid;\n  -webkit-font-smoothing: antialiased;\n}\n\np,\nli,\nul,\npre,\ndiv,\nh1,\nh2,\nh3,\nh4,\nh5,\nh6,\nfigure,\nblockquote,\nfigcaption {\n  margin: 0;\n  padding: 0;\n}\n\nbutton {\n  background-color: transparent;\n}\n\nbutton,\ninput,\noptgroup,\nselect,\ntextarea {\n  font-family: inherit;\n  font-size: 100%;\n  line-height: 1.15;\n  margin: 0;\n}\n\nbutton,\nselect {\n  text-transform: none;\n}\n\nbutton,\n[type="button"],\n[type="reset"],\n[type="submit"] {\n  -webkit-appearance: button;\n  color: inherit;\n}\n\nbutton::-moz-focus-inner,\n[type="button"]::-moz-focus-inner,\n[type="reset"]::-moz-focus-inner,\n[type="submit"]::-moz-focus-inner {\n  border-style: none;\n  padding: 0;\n}\n\nbutton:-moz-focus,\n[type="button"]:-moz-focus,\n[type="reset"]:-moz-focus,\n[type="submit"]:-moz-focus {\n  outline: 1px dotted ButtonText;\n}\n\na {\n  color: inherit;\n  text-decoration: inherit;\n}\n\ninput {\n  padding: 2px 4px;\n}\n\nimg {\n  display: block;\n}\n\ndetails {\n  display: block;\n  margin: 0;\n  padding: 0;\n}\n\nsummary::-webkit-details-marker {\n  display: none;\n}\n\n[data-thq="accordion"] [data-thq="accordion-content"] {\n  max-height: 0;\n  overflow: hidden;\n  transition: max-height 0.3s ease-in-out;\n  padding: 0;\n}\n\n[data-thq="accordion"] details[data-thq="accordion-trigger"][open] + [data-thq="accordion-content"] {\n  max-height: 1000vh;\n}\n\ndetails[data-thq="accordion-trigger"][open] summary [data-thq="accordion-icon"] {\n  transform: rotate(180deg);\n}\n'},867763:function(e,t,o){"use strict";o.d(t,{r:function(){return s},Y:function(){return a}});var n=o(868231),i=o(440516),r=o(590196);const s={[n.KEY_TOGGLES.VIEWPANEL_1]:i.tI.ELEMENTS,[n.KEY_TOGGLES.VIEWPANEL_2]:i.tI.FILES,[n.KEY_TOGGLES.VIEWPANEL_3]:i.tI.CLASSES,[n.KEY_TOGGLES.VIEWPANEL_4]:i.tI.ASSETS_MANAGER},a={[n.KEY_ELEMENTS.COLUMN]:r.sO.COLUMN,[n.KEY_ELEMENTS.ROW]:r.sO.ROW,[n.KEY_ELEMENTS.SLOT]:r.sO.SLOT,[n.KEY_ELEMENTS.BUTTON]:r.sO.BUTTON,[n.KEY_ELEMENTS.IMAGE]:r.sO.IMAGE,[n.KEY_ELEMENTS.VIDEO]:r.sO.VIDEO,[n.KEY_ELEMENTS.HEADING]:r.sO.HEADING,[n.KEY_ELEMENTS.TEXT]:r.sO.TEXT,[n.KEY_ELEMENTS.LINK1]:r.sO.LINK,[n.KEY_ELEMENTS.LINK2]:r.sO.LINK,[n.KEY_ELEMENTS.DATE_TIME]:r.sO.DATE_TIME}},20079:function(e,t,o){"use strict";o.d(t,{U:function(){return Y}});var n,i,r,s,a,c,l,d,p,u,h,m,y,g,f,b,I,v,w,N,j,S,D,T=o(503348),O=o(777460),F=o(918437),C=o(868231),E=o(302503),x=o(223931),_=o(867763),M=o(85413),P=o(686646),A=o(233475),k=o(481175),U=o.n(k),R=o(639887),Z=o(738470),L=o(298357),$=o.n(L),B=o(638852),G=o(344627),H=o(548866);function z(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}let Y=(n=(0,E.inject)("nodeManagementFlow"),i=(0,E.inject)("nodeStyleManagmentFlow"),r=(0,E.inject)("nodeSelectionFlow"),s=(0,E.inject)("projectDoc"),a=(0,E.inject)("nodeRichTextFlow"),c=(0,E.inject)("clipboardFlow"),l=(0,E.inject)("projectUIState"),d=(0,E.inject)("pointerInteractionManagementFlow"),p=(0,E.inject)("notificationsManagementFlow"),u=(0,E.inject)("htmlToDomainFlow"),h=(0,E.inject)("elementRefProvider"),m=class{constructor(){(0,T.Z)(this,"nodeManagementFlow",y,this),(0,T.Z)(this,"nodeStyleManagementFlow",g,this),(0,T.Z)(this,"nodeSelectionFlow",f,this),(0,T.Z)(this,"projectDoc",b,this),(0,T.Z)(this,"nodeRichTextFlow",I,this),(0,T.Z)(this,"clipboardFlow",v,this),(0,T.Z)(this,"projectUIState",w,this),(0,T.Z)(this,"pointerInteractionManagementFlow",N,this),(0,T.Z)(this,"notificationsManagementFlow",j,this),(0,T.Z)(this,"htmlToDomainFlow",S,this),(0,T.Z)(this,"elementRefProvider",D,this),(0,O.Z)(this,"clipboardCopyManager",H.Q.Instance),(0,O.Z)(this,"cmsMainFlow",G.c.Instance),(0,O.Z)(this,"unsubs",[]),(0,O.Z)(this,"getSelectedNodesIds",(()=>{const e=this.nodeSelectionFlow.getSelectedNodeInstanceIds();if(!e.length||1===e.length)return this.nodeSelectionFlow.getSelectedNodesIds();const t=[];for(const o of e){const e=this.elementRefProvider.getDomElementNodeIdByNodeInstanceId(o);e&&t.push(e)}return t}))}selectedNodeIsSlotInstance(e){var t;return!(e.length>1)&&((null===(t=this.projectDoc.nodes.getById(e[0]))||void 0===t?void 0:t.primitiveType)===A.sO.SLOT&&this.projectUIState.selection.compInstanceId)}selectedNodesIncludeInteractiveEssentialNodes(e){for(const t of e){const e=this.projectDoc.nodes.getById(t);if(e)return"element-node"===e.type&&e.isEssentialInteractiveNode()}return!1}selectedNodeIncludesInteractiveNode(e){for(const t of e){const e=this.projectDoc.nodes.getById(t);if(e)return"element-node"===e.type&&e.isInteractive()}return!1}selectedNodeIsInCompInstance(e){return e.some((e=>{var t;return!this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e).slotId&&this.projectUIState.selection.compInstanceId&&e!==this.projectUIState.selection.compInstanceId&&(null===(t=this.projectDoc.nodes.getById(e))||void 0===t?void 0:t.primitiveType)!==A.sO.SLOT}))}resetOSClipboard(){navigator.clipboard.writeText("")}attach(e){const t=Object.keys(_.Y).reduce(((e,t)=>(e[t]=()=>{if(this.selectedNodeIsInCompInstance(this.getSelectedNodesIds()))return;const e=(0,M.a)({stencilKey:_.Y[t]});this.nodeManagementFlow.addPrimitivesToSelNodeSelectAndScroll({primitives:[e]})},e)),{}),o={[C.KEY_TREE_AND_STAGE_COMMANDS.SELECT_SIBLINGS]:()=>{this.nodeSelectionFlow.selectAllSiblingsForNodeOrNodeInstance()},[C.KEY_TREE_AND_STAGE_COMMANDS.NEXT_SIBLING]:()=>{this.nodeSelectionFlow.selectNextSiblingForNodeOrNodeInstance()},[C.KEY_TREE_AND_STAGE_COMMANDS.PREV_SIBLING]:()=>{this.nodeSelectionFlow.selectPreviousSiblingForNodeOrNodeInstance()},[C.KEY_TREE_AND_STAGE_COMMANDS.ESCAPE]:()=>{this.projectUIState.drag.draggedEntity&&this.pointerInteractionManagementFlow.handleDragEnd(),this.nodeSelectionFlow.selectParentNodeOrNodeInstance()},[C.KEY_TREE_AND_STAGE_COMMANDS.ENTER]:()=>{this.nodeSelectionFlow.selectChildOrEditNode()},[C.KEY_TREE_AND_STAGE_COMMANDS.EDIT]:()=>{this.nodeSelectionFlow.editSelectedNodeOrNodeInstance()},[C.KEY_TREE_AND_STAGE_COMMANDS.COPY]:()=>{const e=this.getSelectedNodesIds(),t=this.projectDoc.nodes.getAllowedUserOpsForNodes(e,this.selectedNodeIsInCompInstance(e)),o=e.some((e=>this.projectDoc.isNodeOrAnyChildProtected(e)));t.copy&&!o&&(this.resetOSClipboard(),this.clipboardCopyManager.copyElementToClipboard(e))},[C.KEY_TREE_AND_STAGE_COMMANDS.CUT]:()=>{const e=this.getSelectedNodesIds(),t=this.projectDoc.nodes.getAllowedUserOpsForNodes(e,this.selectedNodeIsInCompInstance(e)),o=e.some((e=>this.projectDoc.isNodeOrAnyChildProtected(e)));t.copy&&t.move&&!o&&(this.resetOSClipboard(),this.clipboardCopyManager.copyElementToClipboard(e,!0))}},n=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?z(Object(o),!0).forEach((function(t){(0,O.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):z(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({[C.KEY_TREE_AND_STAGE_COMMANDS.PASTE_STYLE]:()=>{const e=this.getSelectedNodesIds();this.projectDoc.nodes.getAllowedUserOpsForNodes(e,this.selectedNodeIsInCompInstance(e)).style&&(this.selectedNodesIncludeInteractiveEssentialNodes(e)||this.selectedNodesIncludeInteractiveEssentialNodes(e)||this.selectedNodesIncludeInteractiveEssentialNodes(e)||this.clipboardFlow.pasteCopiedStyleToTargets(e))},[C.KEY_TREE_AND_STAGE_COMMANDS.DUPLICATE]:()=>{const e=this.getSelectedNodesIds();this.projectDoc.nodes.getAllowedUserOpsForNodes(e,this.selectedNodeIsInCompInstance(e)).duplicate&&(this.selectedNodeIsSlotInstance(e)||this.selectedNodeIncludesInteractiveNode(e)||this.nodeManagementFlow.duplicateNodesById({nodeIds:e}))},[C.KEY_TREE_AND_STAGE_COMMANDS.GROUP]:()=>{const e=this.getSelectedNodesIds();this.projectDoc.nodes.getAllowedUserOpsForNodes(e,this.selectedNodeIsInCompInstance(e)).group&&(this.selectedNodeIsSlotInstance(e)||this.selectedNodesIncludeInteractiveEssentialNodes(e)||this.nodeManagementFlow.groupNodes({nodeIds:e}))},[C.KEY_TREE_AND_STAGE_COMMANDS.UNGROUP]:()=>{const e=this.getSelectedNodesIds();this.selectedNodeIsInCompInstance(e)||this.nodeManagementFlow.ungroupNodeChildren({nodeId:e[0]})},[C.KEY_TREE_AND_STAGE_COMMANDS.ADD_LINK]:()=>{var e;this.getSelectedNodesIds().length>1||null===(e=document.querySelector("[id='link-toggle-btn']"))||void 0===e||e.click()},[C.KEY_TREE_AND_STAGE_COMMANDS.DELETE]:()=>{const e=this.getSelectedNodesIds(),t=this.projectDoc.nodes.getAllowedUserOpsForNodes(e,this.selectedNodeIsInCompInstance(e));this.selectedNodeIsSlotInstance(e)||(this.selectedNodesIncludeInteractiveEssentialNodes(e)?this.notificationsManagementFlow.createNotification(P.k$.WARNING,"Deleting essential nodes from the interactive elements is not allowed."):t.delete&&this.nodeManagementFlow.deleteNodesById({nodeIds:e}))},[C.KEY_TREE_AND_STAGE_COMMANDS.BACKSPACE]:()=>{const e=this.getSelectedNodesIds(),t=this.projectDoc.nodes.getAllowedUserOpsForNodes(e,this.selectedNodeIsInCompInstance(e));this.selectedNodeIsSlotInstance(e)||(this.selectedNodesIncludeInteractiveEssentialNodes(e)?this.notificationsManagementFlow.createNotification(P.k$.WARNING,"Deleting essential nodes from the interactive elements is not allowed."):t.delete&&this.nodeManagementFlow.deleteNodesById({nodeIds:e}))},[C.KEY_TREE_AND_STAGE_COMMANDS.SWAP_WITH_NEXT_SIBLING_H]:()=>{const e=this.getSelectedNodesIds();if(1!==e.length)return;const t=this.projectDoc.nodes.getAllowedUserOpsForNodes(e,!!this.projectUIState.selection.compInstanceId);"row"===this.nodeStyleManagementFlow.getNodeParentFlexDirection({nodeId:e[0]})&&t.move&&this.nodeManagementFlow.swapWithNextNode({nodeId:e[0]})},[C.KEY_TREE_AND_STAGE_COMMANDS.SWAP_WITH_PREV_SIBLING_H]:()=>{const e=this.getSelectedNodesIds();if(1!==e.length)return;const t=this.projectDoc.nodes.getAllowedUserOpsForNodes(e,!!this.projectUIState.selection.compInstanceId);"row"===this.nodeStyleManagementFlow.getNodeParentFlexDirection({nodeId:e[0]})&&t.move&&this.nodeManagementFlow.swapWithPrevNode({nodeId:e[0]})},[C.KEY_TREE_AND_STAGE_COMMANDS.SWAP_WITH_NEXT_SIBLING_V]:()=>{const e=this.getSelectedNodesIds();if(1!==e.length)return;const t=this.projectDoc.nodes.getAllowedUserOpsForNodes(e,!!this.projectUIState.selection.compInstanceId);"column"===this.nodeStyleManagementFlow.getNodeParentFlexDirection({nodeId:e[0]})&&t.move&&this.nodeManagementFlow.swapWithNextNode({nodeId:e[0]})},[C.KEY_TREE_AND_STAGE_COMMANDS.SWAP_WITH_PREV_SIBLING_V]:()=>{const e=this.getSelectedNodesIds();if(1!==e.length)return;const t=this.projectDoc.nodes.getAllowedUserOpsForNodes(e,!!this.projectUIState.selection.compInstanceId);"column"===this.nodeStyleManagementFlow.getNodeParentFlexDirection({nodeId:e[0]})&&t.move&&this.nodeManagementFlow.swapWithPrevNode({nodeId:e[0]})}},t);this.handleWrapperClick(e);const i=e instanceof HTMLIFrameElement?e.contentDocument:e,r={[C.TEXT_COMMANDS.BOLD]:()=>{this.selectedNodeInstancesAreInEditMode()||this.nodeRichTextFlow.updateRootNodesFormat({options:{styles:{fontWeight:{value:"bold"}}},nodeIds:this.getSelectedNodesIds()})},[C.TEXT_COMMANDS.ITALIC]:()=>{this.selectedNodeInstancesAreInEditMode()||this.nodeRichTextFlow.updateRootNodesFormat({options:{styles:{fontStyle:{value:"italic"}}},nodeIds:this.getSelectedNodesIds()})},[C.TEXT_COMMANDS.UNDERLINE]:()=>{this.selectedNodeInstancesAreInEditMode()||this.nodeRichTextFlow.updateRootNodesFormat({options:{styles:{textDecoration:{value:"underline",mergeable:!0}}},nodeIds:this.getSelectedNodesIds()})}};i&&this.handleWrapperPaste(i),this.unsubs=[(0,x.N)(i,o,{preventDefault:!0,stopPropagation:!0}),(0,x.N)(i,r,{preventDefault:!0,stopPropagation:!0}),(0,x.N)(i,n,{preventDefault:!0,stopPropagation:!0,throttle:!0}),(0,x.N)(i,{},{preventDefault:!1,stopPropagation:!1,throttle:!0})]}detach(){this.unsubs.forEach((e=>e()))}selectedNodeInstancesAreInEditMode(){const{editingNodeInstanceId:e}=this.projectUIState.staticNodeInterationsData,t=this.nodeSelectionFlow.getSelectedNodeInstanceIds();return 1===t.length&&e[t[0]]}handleWrapperClick(e){var t;if(!(e instanceof HTMLIFrameElement)||null===(t=e.contentDocument)||void 0===t||!t.body)return;const o=()=>{var t;return null===(t=e.contentWindow)||void 0===t?void 0:t.focus()};e.contentDocument.body.addEventListener("click",o),this.unsubs.push((()=>{var t;null!==(t=e.contentDocument)&&void 0!==t&&t.body&&e.contentDocument.body.removeEventListener("click",o)}))}handleWrapperPaste(e){const t=$()((e=>{var t;const o=this.getSelectedNodesIds();if(this.selectedNodeIsInCompInstance(o))return;const n=null===(t=e.clipboardData)||void 0===t?void 0:t.getData("Text"),i=(e.clipboardData||e.originalEvent.clipboardData).items;let r=!1;for(const s in i){const e=i[s];if("file"===e.kind){const t=e.getAsFile();if("image/bmp"===t.type||"image/png"===t.type||"image/gif"===t.type||"image/jpeg"===t.type||"image/svg+xml"===t.type){r=!0;break}}}if(!r){try{return void this.clipboardFlow.pasteRawUIDL(o,n)}catch{try{if(U()(n))return void this.clipboardFlow.pasteSVG(o,n);if((0,Z.FP)(n)||(0,Z.nY)(n)||(0,Z.tf)(n))return void this.htmlToDomainFlow.openEditor(n);this.clipboardFlow.handlePaste(o,n)}catch{this.notificationsManagementFlow.createNotification(P.k$.ERROR,"An error has occured when pasting your content.")}}return!0}this.notificationsManagementFlow.createNotification(P.k$.INFO,"Import in progress...");for(const s in i){const e=i[s];if("file"===e.kind){const t=e.getAsFile();if("image/bmp"===t.type||"image/png"===t.type||"image/gif"===t.type||"image/jpeg"===t.type||"image/svg+xml"===t.type){B.Z.mixpanelEvent(B.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"image/png"});const e=new FileReader;let n="";e.onload=e=>{var t;n=null===(t=e.target)||void 0===t?void 0:t.result,this.clipboardFlow.pasteCopiedUIDL({nodeId:o[0],elementUIDLs:[(0,R.h)("",n)],componentUIDLs:{},designTokens:{},textStyles:{},globals:{settings:{title:"pastedImage",language:"none"},meta:[],assets:[]}})},e.readAsDataURL(t)}}}}),500,{trailing:!1}),o=e=>{Object.keys(this.projectUIState.staticNodeInterationsData.editingNodeInstanceId).length||(e.preventDefault(),e.stopPropagation(),t(e))};e.addEventListener("paste",o),this.unsubs.push((()=>{e.removeEventListener("paste",o)}))}},y=(0,F.Z)(m.prototype,"nodeManagementFlow",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=(0,F.Z)(m.prototype,"nodeStyleManagementFlow",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=(0,F.Z)(m.prototype,"nodeSelectionFlow",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=(0,F.Z)(m.prototype,"projectDoc",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=(0,F.Z)(m.prototype,"nodeRichTextFlow",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=(0,F.Z)(m.prototype,"clipboardFlow",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=(0,F.Z)(m.prototype,"projectUIState",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=(0,F.Z)(m.prototype,"pointerInteractionManagementFlow",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j=(0,F.Z)(m.prototype,"notificationsManagementFlow",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=(0,F.Z)(m.prototype,"htmlToDomainFlow",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=(0,F.Z)(m.prototype,"elementRefProvider",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m)},342701:function(e,t,o){"use strict";o.d(t,{lP:function(){return d},MT:function(){return p},_p:function(){return u},_k:function(){return m},Qq:function(){return y}});var n=o(154888),i=o(889995),r=o(724759),s=o(925984),a=o(919923),c=o(890810),l=o(324438);const d=(e,t)=>{const o=e.target;return p({element:o,entityAttr:t.entityAttribute,declarationAttr:t.declarationAttribute})},p=e=>{let{element:t,entityAttr:o="nodeId",declarationAttr:n="compInstanceId"}=e;const{dragging:i,slotAttr:r="slotId"}=e;if(!t)return null;if("drag-handle"===t.id&&null!==t.getAttribute("data-drag-id")&&(n="dragId",o="dragId"),t=h(t,i),t.dataset.notInteractive){const e=u(t);if(!e)throw new Error("Looked for a selectable element but found nothing to interact with!");t=e}let s=t.dataset[n],a=t.dataset[r],c=t.dataset[o];const l=t.dataset.nodeInstanceId;if(s||c||a||(t=N(t),s=t.dataset[n],a=t.dataset[r],c=t.dataset[o]),t.dataset.boundToDynamicProp&&"component"===t.dataset.type&&t.parentElement){const e=u(t.parentElement);s="component"===(null===e||void 0===e?void 0:e.dataset.type)?null===e||void 0===e?void 0:e.dataset[o]:s||t.dataset[o]}return{nodeId:c,nodeInstanceId:l,compInstanceId:s,slotId:a,notSelectable:!!t.dataset.notSelectable}},u=e=>{const t=e.parentElement;return t?t.dataset.notInteractive?u(t):t:null},h=(e,t)=>{const o=g(e);if(o)return o;const n=b(e);if(n)return n;const i=I(e);if(i)return i;const r=v(e);if(r)return r;const s=t?f(e):null;if(s)return s;const a=w(e);return a||e},m=e=>{var t,o,n,i,r,s;if(!e.target||!(e.target instanceof HTMLElement))return!1;const a=e.target.closest(c.rC),l=e.target.closest(c.w5);return!(!a&&!l)&&(a?"true"===(null===(t=a.children[0])||void 0===t||null===(o=t.children[0])||void 0===o||null===(n=o.children[0])||void 0===n?void 0:n.getAttribute("contenteditable")):!!l&&"true"===(null===(i=l.children[0])||void 0===i||null===(r=i.children[0])||void 0===r||null===(s=r.children[0])||void 0===s?void 0:s.getAttribute("contenteditable")))},y=e=>{var t,o,n,i,r,s;if(null===e||void 0===e||!e.closest)return null;const a=null===e||void 0===e?void 0:e.closest(c.rC),l=null===e||void 0===e?void 0:e.closest(c.w5);return a||l?a?"true"===(null===(t=a.children[0])||void 0===t||null===(o=t.children[0])||void 0===o||null===(n=o.children[0])||void 0===n?void 0:n.getAttribute("contenteditable")):!!l&&"true"===(null===(i=l.children[0])||void 0===i||null===(r=i.children[0])||void 0===r||null===(s=r.children[0])||void 0===s?void 0:s.getAttribute("contenteditable")):null},g=e=>{var t,o,n,i;if(null===e||void 0===e||!e.closest)return null;const r=null===e||void 0===e?void 0:e.closest(c.rC),s=null===e||void 0===e?void 0:e.closest(c.w5);return r||s?"scrolling-container"===(null===r||void 0===r||null===(t=r.children[0])||void 0===t?void 0:t.id)?null===(a=r.children[0])||void 0===a?void 0:a.children[0]:"scrolling-container"===(null===s||void 0===s||null===(o=s.children[0])||void 0===o?void 0:o.id)?null===(l=s.children[0])||void 0===l?void 0:l.children[0]:r?null===(n=r.children)||void 0===n?void 0:n[0]:s?null===(i=s.children)||void 0===i?void 0:i[0]:null:null;var a,l},f=e=>{var t;if(null===e||void 0===e||!e.closest)return null;const o=null===e||void 0===e?void 0:e.closest(s._u);return o?null===(t=o.children)||void 0===t?void 0:t[0]:null},b=e=>{var t;if(null===e||void 0===e||!e.closest)return null;const o=(null===e||void 0===e?void 0:e.closest(r.J))||(null===e||void 0===e?void 0:e.closest(n.F));return o?null===(t=o.children)||void 0===t?void 0:t[0]:null},I=e=>{var t;if(null===e||void 0===e||!e.closest)return null;const o=null===e||void 0===e?void 0:e.closest(a.G);return o?null===(t=o.children)||void 0===t?void 0:t[0]:null},v=e=>{var t;if(null===e||void 0===e||!e.closest)return null;const o=null===e||void 0===e?void 0:e.closest(i.X);return o?null===(t=o.children)||void 0===t?void 0:t[0]:null},w=e=>{var t;return null!==e&&void 0!==e&&e.closest&&(null===(t=e.closest(`.${l.D}`))||void 0===t?void 0:t.firstElementChild)||null},N=e=>{let t=e.parentElement,o=e,n=!1;for(;t&&t.parentElement&&!n;){"dev-component"===t.dataset.type?(o=t,n=!0):(o=t,t=t.parentElement)}return n?o:e}},154888:function(e,t,o){"use strict";o.d(t,{F:function(){return n}});const n="cms-html-node"},889995:function(e,t,o){"use strict";o.d(t,{X:function(){return n}});const n="dev-component"},724759:function(e,t,o){"use strict";o.d(t,{J:function(){return n}});const n="html-node"},919923:function(e,t,o){"use strict";o.d(t,{G:function(){return n}});const n="lottie-node"},407263:function(e,t,o){"use strict";o.d(t,{jk:function(){return s},vq:function(){return a},J$:function(){return c},vw:function(){return l},f8:function(){return d},US:function(){return p},Cu:function(){return u},vi:function(){return h}});var n=o(233475),i=o(751433),r=o(834630);const s=e=>{if(!e)return null;return e.getRootNode().host.children[0]||null},a=(e,t)=>{var o;if(!t)return;const n=null===(o=e.parentElement)||void 0===o?void 0:o.ownerDocument;if(!n)return;const i=n.defaultView;if(!i)return;let r=0;const s=n.createRange();s.setStart(e,0),s.collapse(!0);const a=[e];let c=null,l=!1,d=!1;for(;!l&&(c=a.pop());){if(3!==c.nodeType){let e=c.childNodes.length;for(;e--;)a.push(c.childNodes[e]);continue}const e=r+(c.nodeValue||"").length;!d&&t.start>=r&&t.start<e&&(s.setStart(c,t.start-r),d=!0),d&&t.end>=r&&t.end<=e&&(s.setEnd(c,t.end-r),l=!0),r=e}const p=null===i||void 0===i?void 0:i.getSelection();null===p||void 0===p||p.removeAllRanges(),null===p||void 0===p||p.addRange(s)},c=(e,t)=>{if(t.nodeType===Node.TEXT_NODE){var o;const n=document.createRange();return null===n||void 0===n||n.setStart(t,null===(o=t.nodeValue)||void 0===o?void 0:o.length),n.collapse(!0),void(null===e||void 0===e||e.addRange(n))}if(1===t.childNodes.length&&t.childNodes[0].nodeType===Node.TEXT_NODE){var n;const o=document.createRange();return null===o||void 0===o||o.setStart(t.childNodes[0],null===(n=t.childNodes[0].nodeValue)||void 0===n?void 0:n.length),o.collapse(!0),void(null===e||void 0===e||e.addRange(o))}if(e){const o=document.createRange();return o.selectNodeContents(t),o.collapse(!1),void e.addRange(o)}if(t.createTextRange){const e=t.createTextRange();e.moveToElementText(t),e.collapse(!1),e.select()}},l=(e,t={})=>{if(t.styles){const o=t.styles;Object.keys(o).forEach((t=>{const n=o[t];if(n.tokenId){const i=e.designLanguage.tokensById[n.tokenId];if(!i)throw new Error(`Could not find design token: ${n.tokenId}`);o[t].tokenValue=o[t].value,o[t].value=i.value}}))}return t},d=e=>{const t=[n.RY.HEADING1,n.RY.HEADING2,n.RY.HEADING3,n.RY.HEADING4,n.RY.HEADING5,n.RY.HEADING6];return e.semanticType&&e instanceof i.HX&&-1!==t.indexOf(e.semanticType)},p=e=>{var t,o;const{projectDoc:n,projectUIState:i,staticOrDynamicNode:r,hierarchyNodeId:s}=e;if("static"===r.type)return r.content.toString();const a=r.content;if("locale"===a.referenceType){var c,l,d,u;const e=i.internationalization.currentLanguage,t=n.internationalization.getTranslationRootHierarchyNodeId(e.short,null!==(c=null===(l=a.refPath)||void 0===l?void 0:l[0])&&void 0!==c?c:"");if(!t)return"";const o=n.nodes.getById(t);if(!o||"element-node"!==o.type||!("contentChildren"in o))return"";const r=Object.keys(null!==(d=o.contentChildren)&&void 0!==d?d:{})[0];if(!r)return"";const s=null===(u=o.contentChildren)||void 0===u?void 0:u[r];return s?p({staticOrDynamicNode:s,hierarchyNodeId:t,projectDoc:n,projectUIState:i}):""}if("prop"!==a.referenceType)throw new Error("Attempted to edit text linked to dynamic value that is not a prop!");const h=n.getComponentIdForNode(s),m=n.components.byId[h||""],y=null===m||void 0===m?void 0:m.propDefinitions[a.id],g=i.staticNodeInterationsData.editingCompInstanceId;var f;if(!g)return null===y||void 0===y||null===(f=y.defaultValue)||void 0===f?void 0:f.toString();const b=n.nodes.getById(g);if(!b||"component-instance-node"!==b.type||!("attrs"in b))return;const I=null===(t=b.attrs)||void 0===t?void 0:t[(null===y||void 0===y?void 0:y.name)||""];var v;return I?"static"===I.type?null===(o=I.content)||void 0===o?void 0:o.toString():void 0:null===y||void 0===y||null===(v=y.defaultValue)||void 0===v?void 0:v.toString()},u=(e,t)=>{if("string"!==typeof e||-1===e.indexOf("--dl"))return null;const o=e.replace("var(","").slice(0,-1),n=(0,r.kg)(o);if(!n.categoryName)return null;const i=Object.values(t).find((e=>e.name.toLowerCase()===n.categoryName));return i?(n.categoryName=i.name,"color"===n.type?`${n.name} (${n.categoryName})`:n.name):null},h=(e,t,o)=>{const n=e.replace("var(","").slice(0,-1),i=(0,r.kg)(n);if(!i.categoryName)return null;const s=Object.values(t).find((e=>e.name.toLowerCase()===i.categoryName.toLowerCase()));return s?Object.values(o).find((e=>e.categoryId===s.id&&e.name===i.name&&e.type===i.type)):null}},124701:function(e,t,o){"use strict";o.d(t,{r:function(){return a}});var n=o(777460),i=o(735468),r=o(147717),s=new WeakMap;class a{constructor(){(0,n.Z)(this,"monaco",void 0),s.set(this,{writable:!0,value:{}})}attach(e){this.monaco=e}createModel(e,t,o){if(!this.monaco)throw new Error("Editor instance is missig");const n=this.getMonacoUri(e);this.updateTypings(e,t);const i=this.monaco.editor.getModel(n);return i||this.monaco.editor.createModel(t,o||(0,r.kC)(n.path),n)}deleteModel(e){const t=this.monaco.editor.getModel(this.getMonacoUri(e));if(t)t.dispose();else{const t=this.monaco.editor.getModels().find((t=>"inmemory"===t.uri.scheme&&t.uri.path===e));null===t||void 0===t||t.dispose()}}updateTypings(e,t){var o;if(null===(o="string"===typeof e?e:e.path)||void 0===o||!o.endsWith(".d.ts"))return;const n=this.getMonacoUri(e),r=(0,i.Z)(this,s)[n.path];null===r||void 0===r||r.dispose(),(0,i.Z)(this,s)[n.path]=this.monaco.languages.typescript.typescriptDefaults.addExtraLib(t,n.path.substring(1))}getMonacoUri(e){if(!this.monaco)throw new Error("Editor instance is missig");let t;if("string"===typeof e){const o=e.includes("file://")?e:"file://"+e;t=this.monaco.Uri.file(o)}else t=e;return t}}},468503:function(e,t,o){"use strict";o.d(t,{L:function(){return Y}});var n=o(503348),i=o(777460),r=o(889371),s=o(735468),a=o(918437),c=o(302503),l=o(395942),d=o(492080);class p{constructor(e){(0,i.Z)(this,"line",void 0),(0,i.Z)(this,"column",void 0),(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"label",void 0),(0,i.Z)(this,"color",void 0),(0,i.Z)(this,"preference",void 0);const{id:t,label:o,line:n,color:r,column:s,preference:a}=e;this.id=t,this.label=o,this.line=n,this.column=s,this.color=r,a&&(this.preference=a)}getId(){return this.id}getDomNode(){const e=document.createElement("div");return e.innerHTML=this.label,e.classList.add("editor-collaborator-widget"),e.style.background=this.color,e}getPosition(){return{position:{lineNumber:this.line,column:this.column},preference:this.preference}}}var u,h,m,y=o(90895),g=o(641673);let f=(u=(0,c.inject)("projectUIState"),h=class{constructor(e,t){(0,n.Z)(this,"projectUIState",m,this),(0,i.Z)(this,"activeWidgets",{}),(0,i.Z)(this,"editor",void 0),(0,i.Z)(this,"monaco",void 0),(0,i.Z)(this,"remove",(e=>{if(!e)return;const t=this.activeWidgets[e];t&&(this.editor.removeContentWidget(t),delete this.activeWidgets[e])})),this.setEditor(e,t)}setEditor(e,t){this.editor=e,this.monaco=t}render(e){var t,o;this.cleanupWidgets(Object.keys(e));const n=null===(t=this.projectUIState)||void 0===t||null===(o=t.devMode)||void 0===o?void 0:o.selectedFile,i=this.projectUIState.devMode.selectedBranch;Object.keys(e).forEach(((t,o)=>{const r=e[t];if(!r.selection||r.selectedFile!==n||r.selectedBranch!==i)return void this.remove(t);const s=o++%y.q.length,a=(0,g.$W)(y.q[s],.7),{endColumn:c,endLineNumber:l}=r.selection,{name:d,email:p}=r;this.addWidget({color:a,id:t,label:d||p||"unknown",line:l,column:c})}))}cleanup(){Object.keys(this.activeWidgets).forEach((e=>{this.remove(e)}))}addWidget(e){const{id:t}=e;if(this.activeWidgets[t])return void this.repositionWidget(e);e.preference=[this.monaco.editor.ContentWidgetPositionPreference.ABOVE,this.monaco.editor.ContentWidgetPositionPreference.BELOW];const o=new p(e);this.activeWidgets[t]=o,this.editor.addContentWidget(o)}cleanupWidgets(e){Object.keys(this.activeWidgets).reduce(((t,o)=>(-1===e.indexOf(o)&&t.push(o),t)),[]).forEach(this.remove)}repositionWidget(e){const{id:t,line:o,column:n}=e,i=this.activeWidgets[t];i.line=o,i.column=n,this.editor.layoutContentWidget(i)}},m=(0,a.Z)(h.prototype,"projectUIState",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h);var b=o(169180),I=o(855924),v=o(505285);class w{constructor(e,t,o){(0,i.Z)(this,"start",void 0),(0,i.Z)(this,"end",void 0),(0,i.Z)(this,"direction",void 0),this.start=e,this.end=t,this.direction=o}}var N,j,S,D,T,O=o(378888);let F=(N=(0,c.inject)("projectFilesFlow"),j=(0,c.inject)("projectUIState"),S=class{constructor(e){var t;(0,n.Z)(this,"projectFilesFlow",D,this),(0,n.Z)(this,"projectUIState",T,this),(0,i.Z)(this,"doc",null),(0,i.Z)(this,"ytext",void 0),(0,i.Z)(this,"monaco",void 0),(0,i.Z)(this,"monacoHelper",void 0),(0,i.Z)(this,"monacoModel",void 0),(0,i.Z)(this,"editors",void 0),(0,i.Z)(this,"awareness",void 0),(0,i.Z)(this,"savedSelections",void 0),(0,i.Z)(this,"decorations",void 0),(0,i.Z)(this,"changeHandler",void 0),(0,i.Z)(this,"fileId",void 0),(0,i.Z)(this,"mux",void 0),(0,i.Z)(this,"handleContentChange",(e=>{this.projectUIState.devMode.githubBranches.underCreationSource||this.mux((()=>{var t;null===(t=this.doc)||void 0===t||t.transact((()=>{e.changes.sort(((e,t)=>t.rangeOffset-e.rangeOffset)).forEach((e=>{this.ytext.delete(e.rangeOffset,e.rangeLength),this.ytext.insert(e.rangeOffset,e.text)}))}),this)}))})),(0,i.Z)(this,"listenForEditorCursorChange",(e=>{e.onDidChangeCursorSelection((()=>{var t;if(e.getModel()!==this.monacoModel)return;if(this.projectUIState.devMode.githubBranches.underCreationSource)return;const o=e.getSelection();if(null===o)return;let n=this.monacoModel.getOffsetAt(o.getStartPosition()),i=this.monacoModel.getOffsetAt(o.getEndPosition());if(o.getDirection()===this.monaco.SelectionDirection.RTL){const e=n;n=i,i=e}null===(t=this.awareness)||void 0===t||t.setLocalStateField("selection",{anchor:b.w$(this.ytext,n),head:b.w$(this.ytext,i)})}))})),(0,i.Z)(this,"beforeTransaction",(()=>{this.mux((()=>{this.savedSelections=new Map,this.editors.forEach((e=>{if(e.getModel()!==this.monacoModel)return;const t=((e,t,o)=>{const n=e.getSelection();if(!n)return null;const i=n.getStartPosition(),r=n.getEndPosition(),s=b.w$(o,t.getOffsetAt(i)),a=b.w$(o,t.getOffsetAt(r));return new w(s,a,n.getDirection())})(e,this.monacoModel,this.ytext);null!==t&&this.savedSelections.set(e,t)}))}))})),(0,i.Z)(this,"rerenderDecorations",(()=>{this.editors.forEach((e=>{if(!this.doc||!this.awareness||e.getModel()!==this.monacoModel)return void this.decorations.delete(e);const t=this.decorations.get(e)||[],o=[];this.awareness.getStates().forEach(((e,t)=>{var n,i;if(t===(null===(n=this.doc)||void 0===n?void 0:n.clientID)||null===(i=e.selection)||void 0===i||!i.anchor||!e.selection.head)return;const r=b.or(e.selection.anchor,this.doc),s=b.or(e.selection.head,this.doc);if((null===r||void 0===r?void 0:r.type)!==this.ytext||(null===s||void 0===s?void 0:s.type)!==this.ytext)return;let a,c,l=null,d=null;r.index<s.index?(a=this.monacoModel.getPositionAt(r.index),c=this.monacoModel.getPositionAt(s.index),l="yRemoteSelectionHead",d=null):(a=this.monacoModel.getPositionAt(s.index),c=this.monacoModel.getPositionAt(r.index),l=null,d="yRemoteSelectionHead"),o.push({range:new this.monaco.Range(a.lineNumber,a.column,c.lineNumber,c.column),options:{className:"yRemoteSelection",afterContentClassName:l,beforeContentClassName:d}})})),this.decorations.set(e,e.deltaDecorations(t,o))}))})),(0,i.Z)(this,"ytextObserver",(e=>{this.projectFilesFlow.setFileUnderExternalUpdate(this.fileId),this.mux((()=>{let t=0;e.delta.forEach((e=>{if(void 0!==e.retain)t+=e.retain;else if(void 0!==e.insert){const o=this.monacoModel.getPositionAt(t),n=new this.monaco.Selection(o.lineNumber,o.column,o.lineNumber,o.column),i=e.insert;this.monacoModel.applyEdits([{range:n,text:i}]),t+=i.length}else{if(void 0===e.delete)throw I.zR();{const o=this.monacoModel.getPositionAt(t),n=this.monacoModel.getPositionAt(t+e.delete),i=new this.monaco.Selection(o.lineNumber,o.column,n.lineNumber,n.column);this.monacoModel.applyEdits([{range:i,text:""}])}}})),this.savedSelections.forEach(((e,t)=>{const o=((e,t,o,n,i)=>{if(!i)return;const r=b.or(n.start,i),s=b.or(n.end,i);if((null===r||void 0===r?void 0:r.type)!==o||(null===s||void 0===s?void 0:s.type)!==o)return null;const a=e.getModel();if(!a)return;const c=a.getPositionAt(r.index),l=a.getPositionAt(s.index);return t.Selection.createWithDirection(c.lineNumber,c.column,l.lineNumber,l.column,n.direction)})(t,this.monaco,this.ytext,e,this.doc);o&&t.setSelection(o)}))})),this.projectFilesFlow.setFileUnderExternalUpdate(null),this.debounceHandleTypesChange(this.monacoModel.getValue()),this.rerenderDecorations(),e.transaction.local&&this.debounceHandleEditorChange(this.monacoModel.getValue())})),(0,i.Z)(this,"destroy",(()=>{var e;this.changeHandler.dispose(),this.ytext.unobserve(this.ytextObserver),null===(e=this.doc)||void 0===e||e.off("beforeAllTransactions",this.beforeTransaction),null!==this.awareness&&this.awareness.off("change",this.rerenderDecorations)})),(0,i.Z)(this,"handleEditorChange",(e=>{this.projectFilesFlow.updateFile({fileId:this.fileId,content:e})})),(0,i.Z)(this,"debounceHandleEditorChange",(0,O.Ds)((e=>this.handleEditorChange(e)),500,!1)),(0,i.Z)(this,"debounceHandleTypesChange",(0,O.Ds)((e=>this.monacoHelper.updateTypings(this.fileId,e)),500,!1));const{ytext:o,monacoModel:r,fileId:s,monaco:a,awareness:c=null,monacoHelper:l}=e,{editors:d=new Set}=e;this.doc=o.doc,this.ytext=o,this.fileId=s,this.monacoModel=r,this.editors=d,this.awareness=c,this.monaco=a,this.mux=(0,v.M)(),this.monacoHelper=l,this.savedSelections=new Map,this.decorations=new Map,null===(t=this.doc)||void 0===t||t.on("beforeAllTransactions",this.beforeTransaction),o.observe(this.ytextObserver),r.setValue(o.toString()),this.changeHandler=r.onDidChangeContent(this.handleContentChange),r.onWillDispose(this.destroy),c&&d.forEach((e=>{this.listenForEditorCursorChange(e),c.on("change",this.rerenderDecorations)}))}},D=(0,a.Z)(S.prototype,"projectFilesFlow",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=(0,a.Z)(S.prototype,"projectUIState",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S);var C,E,x,_,M,P,A,k,U,R,Z,L,$,B,G,H,z=o(869425);let Y=(C=(0,c.inject)("globalAppState"),E=(0,c.inject)("webRTCState"),x=(0,c.inject)("rtcFlow"),_=(0,c.inject)("projectDoc"),M=(0,c.inject)("projectUIState"),P=(0,c.inject)("projectChangesFlow"),A=(0,c.inject)("yDocumentManagementFlow"),H=new WeakMap,k=class{constructor(e=!1,t){(0,n.Z)(this,"globalAppState",U,this),(0,n.Z)(this,"webRTCState",R,this),(0,n.Z)(this,"rtcFlow",Z,this),(0,n.Z)(this,"projectDoc",L,this),(0,n.Z)(this,"projectUIState",$,this),(0,n.Z)(this,"projectChangesFlow",B,this),(0,n.Z)(this,"yDocumentManagementFlow",G,this),(0,i.Z)(this,"widgetManager",void 0),(0,i.Z)(this,"editor",void 0),(0,i.Z)(this,"monaco",void 0),(0,i.Z)(this,"monacoHelper",void 0),(0,i.Z)(this,"typingsLoader",void 0),(0,i.Z)(this,"modelIsBinding",!1),(0,i.Z)(this,"selectedFile",null),(0,i.Z)(this,"lastEditorSelection",null),(0,i.Z)(this,"currentBinding",null),(0,i.Z)(this,"initialized",!1),(0,i.Z)(this,"usedForConflicts",!1),(0,i.Z)(this,"onModelBind",null),H.set(this,{writable:!0,value:[]}),(0,i.Z)(this,"attach",(async(e,t,o,n)=>{var i,r;if(this.editor=e,this.monaco=t,this.typingsLoader=o,this.monacoHelper=n,this.selectedFile=this.usedForConflicts?this.projectUIState.devMode.selectedConflictFile:(null===(i=this.projectUIState)||void 0===i||null===(r=i.devMode)||void 0===r?void 0:r.selectedFile)||d.e3,!this.selectedFile&&this.usedForConflicts){const e=this.projectUIState.devMode.selectedBranch,t=this.projectDoc.projectFiles.conflicts[e];this.selectedFile=Object.keys(t.byId)[0]}await this.loadFileData(),this.widgetManager?(this.widgetManager.cleanup(),this.widgetManager.setEditor(this.editor,this.monaco)):this.widgetManager=new f(this.editor,this.monaco),this.initialized||(this.listenForDataChanges(),this.listenForEditorChanges(),this.initialized=!0)})),(0,i.Z)(this,"collaboratorsExistOnFile",(e=>Object.values(this.webRTCState.devData).some((t=>t.selectedFile===e)))),(0,i.Z)(this,"detach",(()=>{var e;(0,s.Z)(this,H).forEach((e=>e())),(0,r.Z)(this,H,[]),null===(e=this.widgetManager)||void 0===e||e.cleanup(),this.initialized=!1})),(0,i.Z)(this,"loadFileData",(async(e=0)=>{var t,o,n;if(!this.selectedFile||null===(t=this.projectDoc.settings.experimentalFeatures)||void 0===t||!t[z.QR.DEVELOPER_MODE])return;this.currentBinding&&(this.currentBinding.destroy(),this.currentBinding=null);const i=this.yDocumentManagementFlow.getText(this.selectedFile);if(i)return void this.bindEditor(i);const r=this.selectedFile,s=this.projectUIState.devMode.selectedBranch,a=null===(o=this.projectDoc.projectFiles.local[s])||void 0===o||null===(n=o.byId[r])||void 0===n?void 0:n.code;if(this.typingsLoader(a),await this.yDocumentManagementFlow.setText(r,a),e>=5)throw new Error("Could not load file data");if(e)return new Promise((t=>{setTimeout((async()=>(await this.loadFileData(++e),t())),1e3)}));await this.loadFileData(++e)})),(0,i.Z)(this,"bindEditor",(e=>{if(!this.editor||!this.monaco||!this.selectedFile)return;const t=this.editor.getModel();if(!t)return;this.modelIsBinding=!0,this.onModelBind&&this.onModelBind(!0);const o=this.selectedFile,n=this.monaco.Uri.file(`file://${this.usedForConflicts?"conflict-":""}${o}`);if(t.uri.path!==n.path){var i,r;const e=this.switchModelToNewUri(t,n);this.editor.setModel(e);const o=null===(i=this.projectUIState.userPreferences.devFileViewState)||void 0===i||null===(r=i.local)||void 0===r?void 0:r[this.selectedFile];o&&this.editor.restoreViewState(o)}this.currentBinding=new F({ytext:e,fileId:this.selectedFile,monacoModel:this.editor.getModel(),monacoHelper:this.monacoHelper,editors:new Set([this.editor]),monaco:this.monaco,awareness:this.yDocumentManagementFlow.getAwareness()}),this.modelIsBinding=!1,this.onModelBind&&this.onModelBind(!1)})),(0,i.Z)(this,"switchModelToNewUri",((e,t)=>{const o=this.monaco.editor.getModel(t);if(o)return o;const n=this.monacoHelper.createModel(t,e.getValue(),e.getLanguageId().language);return this.monacoHelper.deleteModel(e.uri.path),n})),(0,i.Z)(this,"listenForEditorChanges",(()=>{const e=this.editor.onDidChangeCursorPosition(this.handleCursorPositionChange);(0,s.Z)(this,H).push((()=>{e.dispose()}))})),(0,i.Z)(this,"listenForDataChanges",(()=>{const e=(0,l.select)(this.webRTCState,["devData/*","devData","devData/**"],(({devData:e})=>{this.widgetManager.render(e)}),"SubForRtcDataChanges");if(this.usedForConflicts){const e=(0,l.select)(this.projectUIState,["devMode/selectedConflictFile"],(async({devMode:e})=>{const{selectedConflictFile:t}=e;t!==this.selectedFile&&(this.selectedFile=t,await this.loadFileData(),this.widgetManager.render(this.webRTCState.devData))}),"SubForSelectedConflictFile");(0,s.Z)(this,H).push((()=>{e.dispose()}))}else{const e=(0,l.select)(this.projectUIState,["devMode/selectedFile","devMode/selectedFile/*"],(async({devMode:e})=>{const{selectedFile:t}=e;t!==this.selectedFile&&(this.selectedFile=t,await this.loadFileData(),this.widgetManager.render(this.webRTCState.devData))}),"SubForSelectedFile");(0,s.Z)(this,H).push((()=>{e.dispose()}))}(0,s.Z)(this,H).push((()=>{e.dispose()}))})),(0,i.Z)(this,"handleCursorPositionChange",(e=>{const t=this.monaco.editor.CursorChangeReason.RecoverFromMarkers,o=this.monaco.editor.CursorChangeReason.NotSet,n=1===e.position.column&&1===e.position.lineNumber;if((e.reason===t||e.reason===o&&n)&&this.lastEditorSelection)return void this.editor.setSelection(this.lastEditorSelection);const i=this.editor.getSelection();if(!i)return;this.lastEditorSelection=i;const{startColumn:r,endColumn:s,startLineNumber:a,endLineNumber:c}=i;this.rtcFlow.notifyDevModeDataChange({selectedBranch:this.projectUIState.devMode.selectedBranch||void 0,selectedFile:this.selectedFile||void 0,selection:{startColumn:r,endColumn:s,startLineNumber:a,endLineNumber:c}})})),this.usedForConflicts=e,t&&(this.onModelBind=t)}},U=(0,a.Z)(k.prototype,"globalAppState",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=(0,a.Z)(k.prototype,"webRTCState",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z=(0,a.Z)(k.prototype,"rtcFlow",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=(0,a.Z)(k.prototype,"projectDoc",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$=(0,a.Z)(k.prototype,"projectUIState",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=(0,a.Z)(k.prototype,"projectChangesFlow",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G=(0,a.Z)(k.prototype,"yDocumentManagementFlow",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k)},147717:function(e,t,o){"use strict";o.d(t,{YP:function(){return a},WK:function(){return s},Oh:function(){return r},kC:function(){return i}});var n=o(21023);const i=e=>{if(!e)return"javascript";const t=e.split("."),o=t[t.length-1];switch(o){case"js":case"jsx":return"javascript";case"ts":case"tsx":case".d.ts":return"typescript";default:return o||"javascript"}},r=e=>{if(!e)return null;const t=new Date(e),o=t.getHours()%12;return t.getDate()+"-"+(t.getMonth()+1)+"-"+t.getFullYear()+" | "+o+":"+t.getMinutes()+(t.getHours()>12?" pm":" am")},s=e=>{const t=(0,n.parse)(e).ext;return a(t)},a=e=>!!["js","ts","jsx","tsx",".js",".ts",".jsx",".tsx"].includes(e)},646138:function(e,t,o){"use strict";o.d(t,{K:function(){return f}});var n=o(777460),i=o(676422),r=o.n(i),s=o(202784),a=o(781872),c=o(173541),l=o(505892);const d={"Smileys & Emotion":["\ud83d\ude00","\ud83d\ude03","\ud83d\ude04","\ud83d\ude01","\ud83d\ude06","\ud83d\ude05","\ud83e\udd23","\ud83d\ude02","\ud83d\ude42","\ud83d\ude43","\ud83d\ude09","\ud83d\ude0a","\ud83d\ude07","\ud83e\udd70","\ud83d\ude0d","\ud83e\udd29","\ud83d\ude18","\ud83d\ude17","\ud83d\ude1a","\ud83d\ude19","\ud83d\ude0b","\ud83d\ude1b","\ud83d\ude1c","\ud83e\udd2a","\ud83d\ude1d","\ud83e\udd11","\ud83e\udd17","\ud83e\udd2d","\ud83e\udd2b","\ud83e\udd14","\ud83e\udd10","\ud83e\udd28","\ud83d\ude10","\ud83d\ude11","\ud83d\ude36","\ud83d\ude0f","\ud83d\ude12","\ud83d\ude44","\ud83d\ude2c","\ud83e\udd25","\ud83d\ude14","\ud83d\ude2a","\ud83e\udd24","\ud83d\ude34","\ud83d\ude37","\ud83e\udd12","\ud83e\udd15","\ud83e\udd22","\ud83e\udd2e","\ud83e\udd27","\ud83e\udd75","\ud83e\udd76","\ud83e\udd74","\ud83d\ude35","\ud83e\udd2f","\ud83e\udd20","\ud83e\udd73","\ud83d\ude0e","\ud83e\udd13","\ud83e\uddd0"],Gestures:["\ud83d\udc4d","\ud83d\udc4e","\ud83d\udc4c","\u270c\ufe0f","\ud83e\udd1e","\ud83e\udd1f","\ud83e\udd18","\ud83e\udd19","\ud83d\udc48","\ud83d\udc49","\ud83d\udc46","\ud83d\udc47","\u261d\ufe0f","\u270b","\ud83e\udd1a","\ud83d\udd90","\ud83d\udd96","\ud83d\udc4b","\ud83e\udd0f","\ud83d\udcaa","\ud83d\ude4f","\u270d\ufe0f","\ud83d\udc85","\ud83e\udd33","\ud83d\udc83","\ud83d\udd7a","\ud83d\udc4f","\ud83d\ude4c","\ud83d\udc50","\ud83e\udd32"],Objects:["\u2764\ufe0f","\ud83e\udde1","\ud83d\udc9b","\ud83d\udc9a","\ud83d\udc99","\ud83d\udc9c","\ud83d\udda4","\ud83e\udd0d","\ud83e\udd0e","\ud83d\udc94","\u2763\ufe0f","\ud83d\udc95","\ud83d\udc9e","\ud83d\udc93","\ud83d\udc97","\ud83d\udc96","\ud83d\udc98","\ud83d\udc9d","\ud83d\udc9f","\u262e\ufe0f","\u271d\ufe0f","\u262a\ufe0f","\ud83d\udd49","\u2638\ufe0f","\u2721\ufe0f","\ud83d\udd2f","\ud83d\udd4e","\u262f\ufe0f","\u2626\ufe0f","\ud83d\uded0","\u2b50","\ud83c\udf1f","\ud83d\udcab","\u2728","\ud83d\udd25","\ud83d\udca5","\ud83d\udca2","\ud83d\udca8","\ud83d\udca4","\ud83d\udca6"]},p={":)":"\ud83d\ude0a",":-)":"\ud83d\ude0a",":(":"\ud83d\ude14",":-(":"\ud83d\ude14",":D":"\ud83d\ude04",":-D":"\ud83d\ude04",";)":"\ud83d\ude09",";-)":"\ud83d\ude09",":P":"\ud83d\ude1b",":-P":"\ud83d\ude1b",":p":"\ud83d\ude1b",":-p":"\ud83d\ude1b",":|":"\ud83d\ude10",":-|":"\ud83d\ude10",":o":"\ud83d\ude2e",":-o":"\ud83d\ude2e",":O":"\ud83d\ude2e",":-O":"\ud83d\ude2e",":/":"\ud83d\ude15",":-/":"\ud83d\ude15","<3":"\u2764\ufe0f","</3":"\ud83d\udc94",":thumbsup:":"\ud83d\udc4d",":thumbsdown:":"\ud83d\udc4e",":ok:":"\ud83d\udc4c",":fire:":"\ud83d\udd25",":star:":"\u2b50",":heart:":"\u2764\ufe0f",":broken_heart:":"\ud83d\udc94",":tada:":"\ud83c\udf89",":clap:":"\ud83d\udc4f",":pray:":"\ud83d\ude4f",":muscle:":"\ud83d\udcaa",":wave:":"\ud83d\udc4b",":eyes:":"\ud83d\udc40",":100:":"\ud83d\udcaf"};var u=o(552322);const h=({onEmojiSelect:e,onClose:t,portalTarget:o})=>(0,u.jsxs)("div",{onClick:e=>e.stopPropagation(),className:r().dynamic([["3230217723",[a.DM.GRAY_300,a.N_.TWO_UNITS,a.DM.GRAY_400,o?"static":"absolute",a.N_.UNIT,a.DM.GRAY_400,a.DM.GRAY_900,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_700,a.N_.HALF_UNIT,a.DM.GRAY_300,a.DM.GRAY_400]]])+" emoji-picker",children:[(0,u.jsxs)("div",{className:r().dynamic([["3230217723",[a.DM.GRAY_300,a.N_.TWO_UNITS,a.DM.GRAY_400,o?"static":"absolute",a.N_.UNIT,a.DM.GRAY_400,a.DM.GRAY_900,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_700,a.N_.HALF_UNIT,a.DM.GRAY_300,a.DM.GRAY_400]]])+" emoji-picker-header",children:[(0,u.jsx)("h3",{className:r().dynamic([["3230217723",[a.DM.GRAY_300,a.N_.TWO_UNITS,a.DM.GRAY_400,o?"static":"absolute",a.N_.UNIT,a.DM.GRAY_400,a.DM.GRAY_900,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_700,a.N_.HALF_UNIT,a.DM.GRAY_300,a.DM.GRAY_400]]]),children:"Add Emoji"}),(0,u.jsx)(c.z,{shape:"square",size:"tiny",style:"transparent",onClick:t,children:(0,u.jsx)(l.J,{type:"actions/cancel",size:12,color:a.DM.GRAY_600})})]}),(0,u.jsx)("div",{className:r().dynamic([["3230217723",[a.DM.GRAY_300,a.N_.TWO_UNITS,a.DM.GRAY_400,o?"static":"absolute",a.N_.UNIT,a.DM.GRAY_400,a.DM.GRAY_900,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_700,a.N_.HALF_UNIT,a.DM.GRAY_300,a.DM.GRAY_400]]])+" emoji-picker-content",children:Object.entries(d).map((([n,i])=>(0,u.jsxs)("div",{className:r().dynamic([["3230217723",[a.DM.GRAY_300,a.N_.TWO_UNITS,a.DM.GRAY_400,o?"static":"absolute",a.N_.UNIT,a.DM.GRAY_400,a.DM.GRAY_900,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_700,a.N_.HALF_UNIT,a.DM.GRAY_300,a.DM.GRAY_400]]])+" emoji-category",children:[(0,u.jsx)("div",{className:r().dynamic([["3230217723",[a.DM.GRAY_300,a.N_.TWO_UNITS,a.DM.GRAY_400,o?"static":"absolute",a.N_.UNIT,a.DM.GRAY_400,a.DM.GRAY_900,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_700,a.N_.HALF_UNIT,a.DM.GRAY_300,a.DM.GRAY_400]]])+" category-title",children:n}),(0,u.jsx)("div",{className:r().dynamic([["3230217723",[a.DM.GRAY_300,a.N_.TWO_UNITS,a.DM.GRAY_400,o?"static":"absolute",a.N_.UNIT,a.DM.GRAY_400,a.DM.GRAY_900,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_700,a.N_.HALF_UNIT,a.DM.GRAY_300,a.DM.GRAY_400]]])+" emoji-grid",children:i.map(((i,s)=>(0,u.jsx)("button",{onClick:()=>(o=>{e(o),t()})(i),title:i,className:r().dynamic([["3230217723",[a.DM.GRAY_300,a.N_.TWO_UNITS,a.DM.GRAY_400,o?"static":"absolute",a.N_.UNIT,a.DM.GRAY_400,a.DM.GRAY_900,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_700,a.N_.HALF_UNIT,a.DM.GRAY_300,a.DM.GRAY_400]]])+" emoji-button",children:i},`${n}-${s}`)))})]},n)))}),(0,u.jsx)(r(),{id:"3230217723",dynamic:[a.DM.GRAY_300,a.N_.TWO_UNITS,a.DM.GRAY_400,o?"static":"absolute",a.N_.UNIT,a.DM.GRAY_400,a.DM.GRAY_900,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_700,a.N_.HALF_UNIT,a.DM.GRAY_300,a.DM.GRAY_400],children:[`.emoji-picker.__jsx-style-dynamic-selector{background:${a.DM.GRAY_300};border-radius:${a.N_.TWO_UNITS};box-shadow:0 10px 25px rgba(0,0,0,0.2);max-width:300px;max-height:200px;width:100%;min-width:250px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;border:1px solid ${a.DM.GRAY_400};position:${o?"static":"absolute"};z-index:1000;}`,`.emoji-picker-header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:${a.N_.UNIT};border-bottom:1px solid ${a.DM.GRAY_400};}`,`.emoji-picker-header.__jsx-style-dynamic-selector h3.__jsx-style-dynamic-selector{margin:0;font-size:12px;font-weight:600;color:${a.DM.GRAY_900};}`,`.emoji-picker-content.__jsx-style-dynamic-selector{-webkit-flex:1;-ms-flex:1;flex:1;overflow-y:auto;padding:${a.N_.UNIT};}`,`.emoji-category.__jsx-style-dynamic-selector{margin-bottom:${a.N_.UNIT};}`,`.category-title.__jsx-style-dynamic-selector{font-size:12px;font-weight:600;color:${a.DM.GRAY_700};margin-bottom:${a.N_.HALF_UNIT};text-transform:uppercase;-webkit-letter-spacing:0.5px;-moz-letter-spacing:0.5px;-ms-letter-spacing:0.5px;letter-spacing:0.5px;}`,".emoji-grid.__jsx-style-dynamic-selector{display:grid;grid-template-columns:repeat(auto-fill,minmax(32px,1fr));gap:4px;}",".emoji-button.__jsx-style-dynamic-selector{background:none;border:none;padding:4px;cursor:pointer;font-size:20px;border-radius:4px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;min-height:32px;-webkit-transition:background-color 0.2s ease;transition:background-color 0.2s ease;}",`.emoji-button.__jsx-style-dynamic-selector:hover{background-color:${a.DM.GRAY_300};}`,`.emoji-button.__jsx-style-dynamic-selector:active{background-color:${a.DM.GRAY_400};}`]})]});var m=o(893398);function y(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function g(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?y(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):y(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const f=({value:e,placeholder:t="Add a comment... Use @username to mention someone. Press Enter to submit, Shift+Enter for new line.",users:o,onChange:n,onSubmit:i,className:d="",autoFocus:y=!1,portalTarget:f=null,initialMentions:b={}})=>{const{0:I,1:v}=(0,s.useState)(b),{0:w,1:N}=(0,s.useState)(!1),{0:j,1:S}=(0,s.useState)(""),{0:D,1:T}=(0,s.useState)(0),{0:O,1:F}=(0,s.useState)(!1),{0:C,1:E}=(0,s.useState)(!1),{0:x,1:_}=(0,s.useState)(null),M=(0,s.useRef)(null),P=(0,s.useRef)(null),A=(0,s.useRef)(null),k=(0,s.useRef)(b),U=e.trim().length>0;(0,s.useEffect)((()=>{if((C||w)&&f){var e,t;(()=>{if(M.current&&f){const e=M.current.getBoundingClientRect();_({top:e.bottom,left:e.left,width:e.width})}})();const o=()=>{C&&E(!1),w&&(N(!1),S(""))},n=null===(e=document.getElementsByTagName("teleport-zoomable-container")[0])||void 0===e||null===(t=e.shadowRoot)||void 0===t?void 0:t.querySelector(".stage");return null===n||void 0===n||n.addEventListener("wheel",o),()=>{null===n||void 0===n||n.removeEventListener("wheel",o)}}}),[C,w,f]),(0,s.useEffect)((()=>{setTimeout((()=>{if(y&&M.current){M.current.focus({preventScroll:!0});const e=M.current.value.length;M.current.setSelectionRange(e,e),F(!0)}}),0)}),[y]),(0,s.useEffect)((()=>{if(w&&P.current){const e=P.current.children[D];e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}}),[D,w]),(0,s.useEffect)((()=>{if(O&&M.current&&document.activeElement!==M.current&&(M.current.focus({preventScroll:!0}),M.current.selectionStart===M.current.selectionEnd)){const e=M.current.value.length;M.current.setSelectionRange(e,e)}}),[O]),(0,s.useEffect)((()=>{JSON.stringify(k.current)!==JSON.stringify(b)&&(v(b),k.current=b)}),[b]);const R=o.filter((e=>e.name.toLowerCase().includes(j.toLowerCase()))),Z=t=>{if(!M.current)return;const o=M.current.selectionStart,i=e.slice(0,o)+t+e.slice(o),r=g({},I);Object.keys(r).forEach((e=>{const n=r[e];n.startIndex>=o&&(n.startIndex+=t.length)})),v(r),n(i,r),setTimeout((()=>{if(M.current){const e=o+t.length;M.current.focus({preventScroll:!0}),M.current.setSelectionRange(e,e),F(!0)}}),0)},L=()=>{E(!1),setTimeout((()=>{M.current&&(M.current.focus({preventScroll:!0}),F(!0))}),0)},$=p,B=()=>{M.current&&A.current&&(A.current.scrollTop=M.current.scrollTop)},G=t=>{if(!M.current)return;const o=M.current.selectionStart,i=e.slice(0,o);let r=-1;if(j&&(r=i.lastIndexOf(`@${j}`)),-1===r&&(r=i.lastIndexOf("@")),-1===r)return;const s=`@${t.name}`,a=r+(j?`@${j}`:"@").length,c=e.slice(0,r)+s+" "+e.slice(a),l=`mention-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,d={id:l,userId:t.id,userName:t.name,startIndex:r,length:s.length},p=g({},I);Object.keys(p).forEach((e=>{const t=p[e];t.startIndex+t.length>r&&t.startIndex<r+s.length&&delete p[e]})),p[l]=d,v(p),N(!1),S(""),n(c,p),setTimeout((()=>{if(M.current){const e=r+s.length+1;M.current.setSelectionRange(e,e),M.current.focus({preventScroll:!0})}}),0)};return(0,u.jsxs)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" "+`comment-textarea-container ${d}`,children:[(0,u.jsxs)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" textarea-wrapper",children:[(0,u.jsx)("div",{ref:A,className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" textarea-highlight-overlay",children:(()=>{if(0===Object.keys(I).length)return e;const t=Object.values(I).sort(((e,t)=>e.startIndex-t.startIndex)),o=[];let n=0;return t.forEach((t=>{t.startIndex>n&&o.push((0,u.jsx)("span",{children:e.slice(n,t.startIndex)},`text-${n}`)),o.push((0,u.jsxs)("span",{className:r().dynamic([["3749814622",[a.DM.ACCENT_500]]])+" mention-highlight",children:[e.slice(t.startIndex,t.startIndex+t.length),(0,u.jsx)(r(),{id:"3749814622",dynamic:[a.DM.ACCENT_500],children:[`.mention-highlight.__jsx-style-dynamic-selector{color:${a.DM.ACCENT_500};}`]})]},`mention-${t.id}`)),n=t.startIndex+t.length})),n<e.length&&o.push((0,u.jsx)("span",{children:e.slice(n)},`text-${n}`)),o})()}),(0,u.jsx)("textarea",{ref:M,value:e,placeholder:t,onChange:e=>(e=>{var t;const o=(null===(t=M.current)||void 0===t?void 0:t.selectionStart)||0;let i=e,r=0;Object.entries($).forEach((([e,t])=>{const n=i.slice(0,o+r),s=i.slice(o+r);if(n.endsWith(e)){const o=n[n.length-e.length-1];if(!o||/\s/.test(o)){const o=n.slice(0,-e.length)+t;i=o+s,r+=t.length-e.length}}})),0!==r&&setTimeout((()=>{if(M.current){const e=o+r;M.current.setSelectionRange(e,e)}}),0);const s=g({},I);let a=!1;0!==r&&Object.keys(s).forEach((e=>{const t=s[e];t.startIndex>=o-Math.abs(r)&&(t.startIndex+=r,a=!0)})),Object.keys(s).forEach((e=>{const t=s[e],o=i.slice(t.startIndex,t.startIndex+t.length);o.startsWith("@")&&o.includes(t.userName)||(delete s[e],a=!0)}));const c=o+r,l=i.slice(0,c).match(/@(\w*)$/);l?(S(l[1]),N(!0),T(0)):(N(!1),S("")),a?(v(s),n(i,s)):n(i,I)})(e.target.value),onKeyDown:t=>{if(w&&R.length>0)switch(t.key){case"ArrowDown":t.preventDefault(),T((e=>e<R.length-1?e+1:0));break;case"ArrowUp":t.preventDefault(),T((e=>e>0?e-1:R.length-1));break;case"Enter":case"Tab":t.preventDefault(),G(R[D]);break;case"Escape":N(!1)}else"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.trim()&&(null===i||void 0===i||i()));B()},onFocus:()=>{F(!0)},onBlur:e=>{const t=e.relatedTarget;t&&t.closest(".textarea-toolbar, .inline-send-button, .emoji-picker, .mentions-suggestions, .mentions-suggestions-portal")||(F(!1),C&&L(),w&&(N(!1),S("")))},onClick:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onScroll:B,className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" comment-textarea"}),!U&&(0,u.jsx)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" inline-send-button",children:(0,u.jsx)(c.z,{style:"solid",size:"tiny",colorScheme:"accent",shape:"square",cornerStyle:"round",isDisabled:!e.trim(),onClick:e=>{e.preventDefault(),e.stopPropagation(),null===i||void 0===i||i()},title:"Send",refAttrs:{type:"button",onMouseDown:e=>e.preventDefault()},children:(0,u.jsx)(l.J,{type:"flex/direction/column-reverse",size:12})})}),w&&R.length>0&&(f&&x?(0,u.jsx)(m.h_,{target:document.body,children:(0,u.jsx)("div",{ref:P,onMouseDown:e=>e.preventDefault(),style:{position:"absolute",top:`${x.top}px`,left:`${x.left}px`,width:`${x.width}px`,zIndex:1e3},className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" mentions-suggestions-portal",children:R.map(((e,t)=>(0,u.jsxs)("div",{onClick:()=>G(e),onMouseDown:e=>e.preventDefault(),className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" suggestion-item "+(t===D?"selected":""),children:[e.avatar&&(0,u.jsx)("img",{src:e.avatar,alt:e.name,className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" user-avatar"}),(0,u.jsxs)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" user-info",children:[(0,u.jsx)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" user-name",children:e.name}),(0,u.jsx)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" user-email",children:e.email})]})]},e.id)))})}):(0,u.jsx)("div",{ref:P,onMouseDown:e=>e.preventDefault(),className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" mentions-suggestions",children:R.map(((e,t)=>(0,u.jsxs)("div",{onClick:()=>G(e),onMouseDown:e=>e.preventDefault(),className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" suggestion-item "+(t===D?"selected":""),children:[e.avatar&&(0,u.jsx)("img",{src:e.avatar,alt:e.name,className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" user-avatar"}),(0,u.jsxs)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" user-info",children:[(0,u.jsx)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" user-name",children:e.name}),(0,u.jsx)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" user-email",children:e.email})]})]},e.id)))}))]}),U&&(0,u.jsxs)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" textarea-toolbar",children:[(0,u.jsxs)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" toolbar-left",children:[(0,u.jsx)(c.z,{style:"outline",size:"tiny",colorScheme:"neutral",shape:"square",cornerStyle:"round",onClick:e=>{e.preventDefault(),e.stopPropagation(),E(!0)},title:"Add emoji",refAttrs:{type:"button",onMouseDown:e=>e.preventDefault()},children:(0,u.jsx)(l.J,{type:"emoji",size:12,color:"transparent"})}),(0,u.jsx)(c.z,{style:"outline",size:"tiny",colorScheme:"neutral",shape:"square",cornerStyle:"round",onClick:t=>{if(t.preventDefault(),t.stopPropagation(),!M.current)return;const o=M.current.selectionStart,i=e.slice(0,o)+"@"+e.slice(o);n(i,I),setTimeout((()=>{if(M.current){const e=o+1;M.current.focus({preventScroll:!0}),M.current.setSelectionRange(e,e),F(!0),S(""),N(!0),T(0)}}),0)},title:"Mention someone",refAttrs:{type:"button",onMouseDown:e=>e.preventDefault()},children:"@"})]}),(0,u.jsx)("div",{className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]])+" toolbar-right",children:(0,u.jsx)(c.z,{style:"solid",size:"tiny",colorScheme:"accent",shape:"square",cornerStyle:"round",isDisabled:!e.trim(),onClick:e=>{e.preventDefault(),e.stopPropagation(),null===i||void 0===i||i()},title:"Send comment",refAttrs:{type:"button",onMouseDown:e=>e.preventDefault()},children:(0,u.jsx)(l.J,{type:"flex/direction/column-reverse",size:12})})})]}),C&&(f&&x?(0,u.jsx)(m.h_,{target:document.body,children:(0,u.jsx)("div",{style:{position:"fixed",top:`${x.top+4}px`,left:`${x.left}px`,zIndex:1e3},className:r().dynamic([["1873681348",[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600]]]),children:(0,u.jsx)(h,{onEmojiSelect:Z,onClose:L,portalTarget:f})})}):(0,u.jsx)(h,{onEmojiSelect:Z,onClose:L})),(0,u.jsx)(r(),{id:"1873681348",dynamic:[a.DM.GRAY_300,a.N_.UNIT,O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent",U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:a.N_.FIVE,a.N_.UNIT,a.DM.ACCENT_500,U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT,U?a.N_.UNIT:"40px",a.DM.GRAY_900,a.N_.UNIT,a.DM.GRAY_300,a.N_.UNIT,a.N_.HALF_UNIT,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_200,a.DM.GRAY_400,a.N_.UNIT,a.DM.GRAY_400,a.N_.UNIT,a.N_.UNIT,a.DM.GRAY_100,a.DM.GRAY_900,a.DM.GRAY_600],children:[`.__jsx-style-dynamic-selector{margin:0;border:none;border-radius:${a.N_.UNIT};background-color:transparent;}`,`.comment-textarea-container.__jsx-style-dynamic-selector{position:relative;width:100%;background-color:${a.DM.GRAY_300};border-radius:${a.N_.UNIT};border:${O?`1px solid ${a.DM.ACCENT_400}`:"1px solid transparent"};}`,".textarea-wrapper.__jsx-style-dynamic-selector{position:relative;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}",`.textarea-highlight-overlay.__jsx-style-dynamic-selector{position:absolute;top:0;left:0;right:0;bottom:0;font-family:inherit;font-size:12px;line-height:1.4;white-space:pre-wrap;word-wrap:break-word;pointer-events:none;color:transparent;z-index:3;overflow:auto;padding:${U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT};padding-right:${U?a.N_.UNIT:a.N_.FIVE};}`,`.mention-highlight.__jsx-style-dynamic-selector{color:${a.DM.ACCENT_500};background-color:transparent;}`,`.comment-textarea.__jsx-style-dynamic-selector{position:relative;z-index:2;width:100%;max-height:60px;field-sizing:content;padding:${U?`${a.N_.HALF_UNIT} ${a.N_.UNIT}`:a.N_.UNIT};padding-right:${U?a.N_.UNIT:"40px"};outline:none;resize:none;color:${a.DM.GRAY_900};border-radius:${a.N_.UNIT};background-color:${a.DM.GRAY_300};border:none;font-size:12px;line-height:1.4;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;white-space:pre-wrap;overflow-wrap:break-word;outline:none;}`,`.inline-send-button.__jsx-style-dynamic-selector{position:absolute;right:${a.N_.UNIT};top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);z-index:3;}`,`.textarea-toolbar.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:${a.N_.HALF_UNIT} ${a.N_.UNIT};border-top:1px solid ${a.DM.GRAY_400};border-radius:0 0 ${a.N_.UNIT} ${a.N_.UNIT};position:relative;}`,`.toolbar-left.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:${a.N_.UNIT};}`,".toolbar-right.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}",`.mentions-suggestions.__jsx-style-dynamic-selector{position:absolute;top:100%;left:0;right:0;background:${a.DM.GRAY_200};border:1px solid ${a.DM.GRAY_400};border-radius:${a.N_.UNIT};box-shadow:0 4px 12px rgba(0,0,0,0.1);max-height:155px;overflow-y:auto;z-index:1000;-webkit-scroll-behavior:smooth;-moz-scroll-behavior:smooth;-ms-scroll-behavior:smooth;scroll-behavior:smooth;}`,`.mentions-suggestions-portal.__jsx-style-dynamic-selector{background:${a.DM.GRAY_200};border:1px solid ${a.DM.GRAY_400};border-radius:${a.N_.UNIT};box-shadow:0 4px 12px rgba(0,0,0,0.1);max-height:155px;overflow-y:auto;-webkit-scroll-behavior:smooth;-moz-scroll-behavior:smooth;-ms-scroll-behavior:smooth;scroll-behavior:smooth;}`,`.suggestion-item.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:4px 8px;cursor:pointer;border-bottom:1px solid ${a.DM.GRAY_400};-webkit-transition:background-color 0.15s ease;transition:background-color 0.15s ease;border-radius:0;}`,".suggestion-item.__jsx-style-dynamic-selector:last-child{border-bottom:none;}",`.suggestion-item.__jsx-style-dynamic-selector:first-child{border-radius:${a.N_.UNIT} ${a.N_.UNIT} 0 0;}`,`.suggestion-item.__jsx-style-dynamic-selector:hover,.suggestion-item.selected.__jsx-style-dynamic-selector{background-color:${a.DM.GRAY_100};}`,".user-avatar.__jsx-style-dynamic-selector{width:24px;height:24px;border-radius:50%;margin-right:8px;}",".user-info.__jsx-style-dynamic-selector{-webkit-flex:1;-ms-flex:1;flex:1;}",`.user-name.__jsx-style-dynamic-selector{font-weight:500;font-size:12px;color:${a.DM.GRAY_900};}`,`.user-email.__jsx-style-dynamic-selector{font-size:10px;color:${a.DM.GRAY_600};}`]})]})}},183403:function(e,t,o){"use strict";o.d(t,{kb:function(){return n},Cr:function(){return i},K:function(){return r},un:function(){return s}});const n=e=>{const{source:t,target:o,type:n,modifier:i,eventParams:r}=e,s=e=>{(e=>{const{ev:t,target:o,modifier:n}=e;t.stopImmediatePropagation();const i=new CustomEvent(`proxy:${t.type}`,{detail:{originalEvent:t,modifier:n?n(t):{}},bubbles:!0,composed:!0,cancelable:!0});o.dispatchEvent(i)})({ev:e,modifier:i,target:o})};return r?t.addEventListener(n,s,r):t.addEventListener(n,s),()=>{t.removeEventListener(n,s)}},i=e=>{const{types:t,source:o,target:i,modifier:r}=e;return t.map((e=>n({type:e,source:o,target:i,modifier:r})))},r=e=>{const{callback:t,type:o,target:n}=e,i=e=>{const o=e.detail.originalEvent;t(o,e)};return n.addEventListener(`proxy:${o}`,i),()=>{n.removeEventListener(`proxy:${o}`,i)}},s=e=>{const{types:t,target:o,callback:n}=e;return t.map((e=>r({target:o,callback:n,type:e})))}},793206:function(e,t,o){"use strict";o.d(t,{v:function(){return a}});var n=o(676422),i=o.n(n),r=o(781872),s=(o(202784),o(552322));const a=e=>{const{children:t,backgroundColor:o,textColor:n,borderStyle:a,height:c=32,font:l}=e;return(0,s.jsxs)("div",{className:i().dynamic([["3849189519",["separator"===a?`border-top: 1px solid ${r.DM.GRAY_300};`:"",o?`background-color: ${o};`:"",n?`color: ${n};`:"",c,c,r.N_.TWO_UNITS,l?`font-family: ${l};`:"","separator"===a?`border-bottom: 1px solid ${r.DM.GRAY_300};`:""]]])+" list-entry",children:[t,(0,s.jsx)(i(),{id:"3849189519",dynamic:["separator"===a?`border-top: 1px solid ${r.DM.GRAY_300};`:"",o?`background-color: ${o};`:"",n?`color: ${n};`:"",c,c,r.N_.TWO_UNITS,l?`font-family: ${l};`:"","separator"===a?`border-bottom: 1px solid ${r.DM.GRAY_300};`:""],children:[`.list-entry.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;${"separator"===a?`border-top: 1px solid ${r.DM.GRAY_300};`:""};${o?`background-color: ${o};`:""} ${n?`color: ${n};`:""} min-height:${c}px;height:${c}px;width:100%;padding:0 ${r.N_.TWO_UNITS};${l?`font-family: ${l};`:""};}`,`.list-entry.__jsx-style-dynamic-selector:last-child{${"separator"===a?`border-bottom: 1px solid ${r.DM.GRAY_300};`:""};}`]})]})}},895563:function(e,t,o){"use strict";o.d(t,{a:function(){return a}});var n=o(676422),i=o.n(n),r=o(781872),s=(o(202784),o(552322));const a=e=>{const{children:t,header:o,footer:n}=e;return(0,s.jsxs)("div",{className:i().dynamic([["2041610853",[r.DM.GRAY_100,r.N_.ONE_AND_HALF,r.um.HEADING,r.Xw.MEDIUM_600,r.N_.ONE_AND_HALF]]])+" list-container",children:[o?(0,s.jsx)("div",{className:i().dynamic([["2041610853",[r.DM.GRAY_100,r.N_.ONE_AND_HALF,r.um.HEADING,r.Xw.MEDIUM_600,r.N_.ONE_AND_HALF]]])+" list-header",children:o}):null,t,n?(0,s.jsx)("div",{className:i().dynamic([["2041610853",[r.DM.GRAY_100,r.N_.ONE_AND_HALF,r.um.HEADING,r.Xw.MEDIUM_600,r.N_.ONE_AND_HALF]]])+" list-footer",children:n}):null,(0,s.jsx)(i(),{id:"2041610853",dynamic:[r.DM.GRAY_100,r.N_.ONE_AND_HALF,r.um.HEADING,r.Xw.MEDIUM_600,r.N_.ONE_AND_HALF],children:[`.list-container.__jsx-style-dynamic-selector{background-color:${r.DM.GRAY_100};}`,`.list-header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:48px;padding:0 ${r.N_.ONE_AND_HALF};font-size:${r.um.HEADING};font-weight:${r.Xw.MEDIUM_600};}`,`.list-footer.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 ${r.N_.ONE_AND_HALF};height:48px;}`]})]})}},183397:function(){},833196:function(){},38087:function(){},427464:function(){},839415:function(){},989773:function(){},667129:function(){},630633:function(){},220395:function(){},330488:function(){},187374:function(){},929285:function(){},806024:function(){},215862:function(){},357267:function(){},759255:function(){},543194:function(){},957017:function(){},616776:function(e,t,o){"use strict";o.d(t,{XM:function(){return i},GS:function(){return n},Wh:function(){return s},ND:function(){return r}});const n="https://unpkg.com/animate.css@4.1.1/animate.css",i=["none","bounce","flash","pulse","rubberBand","shakeX","shakeY","headShake","swing","tada","wobble","jello","heartBeat","backInDown","backInLeft","backInRight","backInUp","backOutDown","backOutLeft","backOutRight","backOutUp","bounceIn","bounceInDown","bounceInLeft","bounceInRight","bounceInUp","bounceOut","bounceOutDown","bounceOutLeft","bounceOutRight","bounceOutUp","fadeIn","fadeInDown","fadeInDownBig","fadeInLeft","fadeInLeftBig","fadeInRight","fadeInRightBig","fadeInUp","fadeInUpBig","fadeInTopLeft","fadeInTopRight","fadeInBottomLeft","fadeInBottomRight","fadeOut","fadeOutDown","fadeOutDownBig","fadeOutLeft","fadeOutLeftBig","fadeOutRight","fadeOutRightBig","fadeOutUp","fadeOutUpBig","fadeOutTopLeft","fadeOutTopRight","fadeOutBottomRight","fadeOutBottomLeft","flip","flipInX","flipInY","flipOutX","flipOutY","lightSpeedInRight","lightSpeedInLeft","lightSpeedOutRight","lightSpeedOutLeft","rotateIn","rotateInDownLeft","rotateInDownRight","rotateInUpLeft","rotateInUpRight","rotateOut","rotateOutDownLeft","rotateOutDownRight","rotateOutUpLeft","rotateOutUpRight","hinge","jackInTheBox","rollIn","rollOut","zoomIn","zoomInDown","zoomInLeft","zoomInRight","zoomInUp","zoomOut","zoomOutDown","zoomOutLeft","zoomOutRight","zoomOutUp","slideInDown","slideInLeft","slideInRight","slideInUp","slideOutDown","slideOutLeft","slideOutRight","slideOutUp"],r=["linear","ease","ease-in","ease-out","ease-in-out","step-start","step-end"],s=["normal","reverse","alternate","alternate-reverse"]}}]);
